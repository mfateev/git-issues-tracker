{
  "assignees": [],
  "author": {
    "id": "MDQ6VXNlcjUzMjEwOA==",
    "is_bot": false,
    "login": "Spikhalskiy",
    "name": "Dmitry Spikhalsky"
  },
  "body": "## Actual Behavior\r\n\r\nDuring a load test, the following exception happened once:\r\n\r\n```\r\n│ 19:42:15.247 [Workflow Executor taskQueue=\"xxx\", namespace=\"yyy\": 311] WARN  i.t.i.r.ReplayWorkflowTaskHandler - Workflow task processing failure. startedEventId=17, WorkflowId=89ecf1a │\r\n│ io.temporal.internal.statemachines.InternalWorkflowTaskException: Failure handling event 19 of type 'EVENT_TYPE_WORKFLOW_EXECUTION_TERMINATED' during replay. {WorkflowTaskStartedEventId=17, CurrentStartedEventId=1 │\r\n│     at io.temporal.internal.statemachines.WorkflowStateMachines.createEventProcessingException(WorkflowStateMachines.java:257)                                                                \r\n│     at io.temporal.internal.statemachines.WorkflowStateMachines.handleEventsBatch(WorkflowStateMachines.java:236)                                                                                   \r\n│     at io.temporal.internal.statemachines.WorkflowStateMachines.handleEvent(WorkflowStateMachines.java:208)                                                                                                \r\n│     at io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.applyServerHistory(ReplayWorkflowRunTaskHandler.java:208)                                                                                          \r\n│     at io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTaskImpl(ReplayWorkflowRunTaskHandler.java:192)                                                                                \r\n│     at io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTask(ReplayWorkflowRunTaskHandler.java:147)                                                                              \r\n│     at io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTaskWithQuery(ReplayWorkflowTaskHandler.java:132)                                                      \r\n│     at io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTask(ReplayWorkflowTaskHandler.java:97)                                                 \r\n│     at io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handleTask(WorkflowWorker.java:336)                                                                                     \r\n│     at io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:246)                                                                         \r\n│     at io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:188)                                                                                      \r\n│     at io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:93)                                                                   \r\n│     at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)                                          \r\n│     at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)                                            \r\n│     at java.base/java.lang.Thread.run(Thread.java:829)                                                                                                                    \r\n│ Caused by: java.lang.IllegalArgumentException: Unexpected event:event_id: 19                                                                              \r\n│ event_time {                                                                                                                                              \r\n│   seconds: 1664134935                                                                                                                              \r\n│   nanos: 131416185                                                                                                                                 \r\n│ }                                                                                                                                                                 \r\n│ event_type: EVENT_TYPE_WORKFLOW_EXECUTION_TERMINATED                                                                          \r\n│ version: 1023                                                                                                                                                \r\n│ task_id: 186665257                                                                                                                                     \r\n│ workflow_execution_terminated_event_attributes {                                                                                                 \r\n│ }                                                                                                                                                                                  \r\n│                                                                                                                                                                               \r\n│     at io.temporal.internal.statemachines.WorkflowStateMachines.handleNonStatefulEvent(WorkflowStateMachines.java:521)                                       \r\n│     at io.temporal.internal.statemachines.WorkflowStateMachines.handleSingleEvent(WorkflowStateMachines.java:282)                                                  \r\n│     at io.temporal.internal.statemachines.WorkflowStateMachines.handleEventsBatch(WorkflowStateMachines.java:234)                                                 \r\n│     ... 13 common frames omitted\r\n```\r\n\r\nThe history of this execution wasn't saved, but there are two full normal histories of Parent and Child workflows from that test attached.\r\n[histories.zip](https://github.com/temporalio/sdk-java/files/9641719/histories.zip)\r\n",
  "closedAt": null,
  "comments": [],
  "createdAt": "2022-09-25T20:28:34Z",
  "labels": [
    {
      "id": "MDU6TGFiZWwxNjIyNzE5ODQx",
      "name": "bug",
      "description": "Something isn't working",
      "color": "d73a4a"
    }
  ],
  "milestone": null,
  "number": 1457,
  "reactionGroups": [],
  "state": "OPEN",
  "title": "State machine exception during termination",
  "updatedAt": "2024-12-17T21:26:48Z",
  "url": "https://github.com/temporalio/sdk-java/issues/1457"
}
