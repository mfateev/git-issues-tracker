{
  "assignees": [],
  "author": {
    "id": "MDQ6VXNlcjE0NjM2MjI=",
    "is_bot": false,
    "login": "mfateev",
    "name": "Maxim Fateev"
  },
  "body": "## Expected Behavior\r\nWhen `WorkflowImplementationOptions.FailWorkflowExceptionTypes` is set to Throwable any workflow task failure leads to workflow failure.\r\n\r\n## Actual Behavior\r\nThe service rejecting workflow task completion doesn't fail the workflow.\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Set an invalid retry policy. For example, use a smaller maximumInterval than InitialInterval.\r\n  1. Set FailWorkflowExceptionTypes to Throwable.\r\n  1. Observe that workflow is stuck in workflow task failure retry loop.\r\n\r\nReproduction:\r\n\r\n```\r\npackage io.temporal.samples.hello;\r\n\r\nimport io.temporal.activity.ActivityInterface;\r\nimport io.temporal.activity.ActivityMethod;\r\nimport io.temporal.activity.ActivityOptions;\r\nimport io.temporal.client.WorkflowClient;\r\nimport io.temporal.client.WorkflowOptions;\r\nimport io.temporal.common.RetryOptions;\r\nimport io.temporal.serviceclient.WorkflowServiceStubs;\r\nimport io.temporal.worker.Worker;\r\nimport io.temporal.worker.WorkerFactory;\r\nimport io.temporal.worker.WorkflowImplementationOptions;\r\nimport io.temporal.workflow.Workflow;\r\nimport io.temporal.workflow.WorkflowInterface;\r\nimport io.temporal.workflow.WorkflowMethod;\r\nimport java.time.Duration;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\n\r\n/** Sample Temporal Workflow Definition that executes a single Activity. */\r\npublic class HelloActivity {\r\n\r\n  // Define the task queue name\r\n  static final String TASK_QUEUE = \"HelloActivityTaskQueue\";\r\n\r\n  // Define our workflow unique id\r\n  static final String WORKFLOW_ID = \"HelloActivityWorkflow\";\r\n\r\n  /**\r\n   * The Workflow Definition's Interface must contain one method annotated with @WorkflowMethod.\r\n   *\r\n   * <p>Workflow Definitions should not contain any heavyweight computations, non-deterministic\r\n   * code, network calls, database operations, etc. Those things should be handled by the\r\n   * Activities.\r\n   *\r\n   * @see io.temporal.workflow.WorkflowInterface\r\n   * @see io.temporal.workflow.WorkflowMethod\r\n   */\r\n  @WorkflowInterface\r\n  public interface GreetingWorkflow {\r\n\r\n    /**\r\n     * This is the method that is executed when the Workflow Execution is started. The Workflow\r\n     * Execution completes when this method finishes execution.\r\n     */\r\n    @WorkflowMethod\r\n    String getGreeting(String name);\r\n  }\r\n\r\n  /**\r\n   * This is the Activity Definition's Interface. Activities are building blocks of any Temporal\r\n   * Workflow and contain any business logic that could perform long running computation, network\r\n   * calls, etc.\r\n   *\r\n   * <p>Annotating Activity Definition methods with @ActivityMethod is optional.\r\n   *\r\n   * @see io.temporal.activity.ActivityInterface\r\n   * @see io.temporal.activity.ActivityMethod\r\n   */\r\n  @ActivityInterface\r\n  public interface GreetingActivities {\r\n\r\n    // Define your activity method which can be called during workflow execution\r\n    @ActivityMethod(name = \"greet\")\r\n    String composeGreeting(String greeting, String name);\r\n  }\r\n\r\n  // Define the workflow implementation which implements our getGreeting workflow method.\r\n  public static class GreetingWorkflowImpl implements GreetingWorkflow {\r\n\r\n    /**\r\n     * Define the GreetingActivities stub. Activity stubs are proxies for activity invocations that\r\n     * are executed outside of the workflow thread on the activity worker, that can be on a\r\n     * different host. Temporal is going to dispatch the activity results back to the workflow and\r\n     * unblock the stub as soon as activity is completed on the activity worker.\r\n     *\r\n     * <p>In the {@link ActivityOptions} definition the \"setStartToCloseTimeout\" option sets the\r\n     * overall timeout that our workflow is willing to wait for activity to complete. For this\r\n     * example it is set to 2 seconds.\r\n     */\r\n    private final GreetingActivities activities =\r\n        Workflow.newActivityStub(\r\n            GreetingActivities.class,\r\n            ActivityOptions.newBuilder()\r\n                .setStartToCloseTimeout(Duration.ofSeconds(2))\r\n                .setRetryOptions(\r\n                    RetryOptions.newBuilder()\r\n                        .setInitialInterval(Duration.ofSeconds(10))\r\n                        .setMaximumInterval(Duration.ofSeconds(5))\r\n                        .build())\r\n                .build());\r\n\r\n    @Override\r\n    public String getGreeting(String name) {\r\n      // This is a blocking call that returns only after the activity has completed.\r\n      return activities.composeGreeting(\"Hello\", name);\r\n    }\r\n  }\r\n\r\n  /** Simple activity implementation, that concatenates two strings. */\r\n  static class GreetingActivitiesImpl implements GreetingActivities {\r\n    private static final Logger log = LoggerFactory.getLogger(GreetingActivitiesImpl.class);\r\n\r\n    @Override\r\n    public String composeGreeting(String greeting, String name) {\r\n      log.info(\"Composing greeting...\");\r\n      return greeting + \" \" + name + \"!\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * With our Workflow and Activities defined, we can now start execution. The main method starts\r\n   * the worker and then the workflow.\r\n   */\r\n  public static void main(String[] args) {\r\n\r\n    // Get a Workflow service stub.\r\n    WorkflowServiceStubs service = WorkflowServiceStubs.newLocalServiceStubs();\r\n\r\n    /*\r\n     * Get a Workflow service client which can be used to start, Signal, and Query Workflow Executions.\r\n     */\r\n    WorkflowClient client = WorkflowClient.newInstance(service);\r\n\r\n    /*\r\n     * Define the workflow factory. It is used to create workflow workers for a specific task queue.\r\n     */\r\n    WorkerFactory factory = WorkerFactory.newInstance(client);\r\n\r\n    /*\r\n     * Define the workflow worker. Workflow workers listen to a defined task queue and process\r\n     * workflows and activities.\r\n     */\r\n    Worker worker = factory.newWorker(TASK_QUEUE);\r\n\r\n    /*\r\n     * Register our workflow implementation with the worker.\r\n     * Workflow implementations must be known to the worker at runtime in\r\n     * order to dispatch workflow tasks.\r\n     */\r\n    worker.registerWorkflowImplementationTypes(\r\n        WorkflowImplementationOptions.newBuilder()\r\n            .setFailWorkflowExceptionTypes(Throwable.class)\r\n            .build(),\r\n        GreetingWorkflowImpl.class);\r\n\r\n    /**\r\n     * Register our Activity Types with the Worker. Since Activities are stateless and thread-safe,\r\n     * the Activity Type is a shared instance.\r\n     */\r\n    worker.registerActivitiesImplementations(new GreetingActivitiesImpl());\r\n\r\n    /*\r\n     * Start all the workers registered for a specific task queue.\r\n     * The started workers then start polling for workflows and activities.\r\n     */\r\n    factory.start();\r\n\r\n    // Create the workflow client stub. It is used to start our workflow execution.\r\n    GreetingWorkflow workflow =\r\n        client.newWorkflowStub(\r\n            GreetingWorkflow.class,\r\n            WorkflowOptions.newBuilder()\r\n                .setWorkflowId(WORKFLOW_ID)\r\n                .setTaskQueue(TASK_QUEUE)\r\n                .build());\r\n\r\n    /*\r\n     * Execute our workflow and wait for it to complete. The call to our getGreeting method is\r\n     * synchronous.\r\n     *\r\n     * See {@link io.temporal.samples.hello.HelloSignal} for an example of starting workflow\r\n     * without waiting synchronously for its result.\r\n     */\r\n    String greeting = workflow.getGreeting(\"World\");\r\n\r\n    // Display workflow execution results\r\n    System.out.println(greeting);\r\n    System.exit(0);\r\n  }\r\n}\r\n\r\n```\r\n",
  "closedAt": null,
  "comments": [
    {
      "id": "IC_kwDODN12PM5XhYOK",
      "author": {
        "login": "Spikhalskiy"
      },
      "authorAssociation": "CONTRIBUTOR",
      "body": "This filter/rule is not applied for Service errors. The same way for other SDKs.\r\nI don't think it's an expected behavior either. Users expect exception types in this filter to be applied to workflow code only pretty much.\r\nIf we want to make deeper levels of failure tolerance adjustable - we need a separate, more detailed mechanism.",
      "createdAt": "2023-03-14T15:53:46Z",
      "includesCreatedEdit": true,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-1468367754",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDODN12PM5XhZOy",
      "author": {
        "login": "Spikhalskiy"
      },
      "authorAssociation": "CONTRIBUTOR",
      "body": "In addition, it's the Server that is failing the workflow task in this situation, not an SDK/Worker. When the workflow task is already failed by the Server, there is no way for SDK to fail the execution.",
      "createdAt": "2023-03-14T15:56:24Z",
      "includesCreatedEdit": true,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-1468371890",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDODN12PM5rVUFr",
      "author": {
        "login": "mfateev"
      },
      "authorAssociation": "MEMBER",
      "body": "SDK can fail the execution by emitting FailWorkflowExecution command.",
      "createdAt": "2023-11-08T00:38:59Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-1800749419",
      "viewerDidAuthor": true
    },
    {
      "id": "IC_kwDODN12PM6xn9a6",
      "author": {
        "login": "Domonion"
      },
      "authorAssociation": "NONE",
      "body": "are there any updates? \ncc @mfateev @Spikhalskiy ",
      "createdAt": "2025-06-17T11:42:10Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-2980042426",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDODN12PM6xrKNM",
      "author": {
        "login": "Quinn-With-Two-Ns"
      },
      "authorAssociation": "MEMBER",
      "body": "@Domonion The situation is still the same as described [here](https://github.com/temporalio/sdk-java/issues/1698#issuecomment-1468367754) ",
      "createdAt": "2025-06-17T15:42:37Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-2980881228",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDODN12PM6xsNbh",
      "author": {
        "login": "Domonion"
      },
      "authorAssociation": "NONE",
      "body": "@Quinn-With-Two-Ns are there any plans to change the situation? ",
      "createdAt": "2025-06-17T17:10:21Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-2981156577",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDODN12PM6xtsY9",
      "author": {
        "login": "Quinn-With-Two-Ns"
      },
      "authorAssociation": "MEMBER",
      "body": "There is no update on this specific issue. Without knowing more about the your problem I can't say if there is any plans. Temporal is always adding new features, If you can share the particular problem you are encountering then I can provide more detail.",
      "createdAt": "2025-06-17T19:10:05Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/temporalio/sdk-java/issues/1698#issuecomment-2981545533",
      "viewerDidAuthor": false
    }
  ],
  "createdAt": "2023-03-14T15:50:18Z",
  "labels": [
    {
      "id": "LA_kwDODN12PM7NRayD",
      "name": "wontfix",
      "description": "This will not be worked on",
      "color": "BFD4F2"
    }
  ],
  "milestone": null,
  "number": 1698,
  "reactionGroups": [],
  "state": "OPEN",
  "title": "WorkflowImplementationOptions.FailWorkflowExceptionTypes ignored for service failures",
  "updatedAt": "2025-06-17T19:10:05Z",
  "url": "https://github.com/temporalio/sdk-java/issues/1698"
}
