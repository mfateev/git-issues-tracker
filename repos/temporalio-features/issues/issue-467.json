{"assignees":[],"author":{"id":"U_kgDOCeuzXQ","is_bot":false,"login":"drewhoskins-temporal","name":"Drew Hoskins"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nIt seems continue-as-new can cause near-simultaneous updates to drop, and it's difficult to write the code to figure out what to do about it.\r\n\r\nAlso, I feel like many users will be caught unawares.  The docs call attention to this problem, which is good, but I feel lucky that I noticed that.\r\n\r\nAs far as remediating it in my code, the simplest version I thought of was to bookend every update with:\r\n\r\n```python\r\nself.num_running_updates += 1\r\n# do stuff\r\nself.num_running_updates -= 1\r\n```\r\n\r\nand then use \r\n```\r\nawait workflow.wait_condition(self.running_updates==0)\r\n```\r\n\r\nat the end.  But this was not easy to work out and feels \"advanced.\"\r\n\r\n<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->\r\n\r\n### Describe the solution you'd like\r\n\r\nI don't have a specific solution in mind, but I'd ideally like the SDK to prevent this from happening, or at least inform me that it is happening and provide a facility for me to track the outstanding updates so I can wait for them.\r\n\r\n<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context or screenshots about the feature request here. -->\r\n\r\n### Per-SDK Tickets\r\n\r\n<!-- Add links here once the tickets are created (no need to create them immediately). -->\r\n\r\n- [ ] Go - \r\n- [ ] Java - \r\n- [ ] Core - \r\n- [ ] TypeScript - \r\n- [ ] Python - \r\n- [ ] .NET - \r\n- [ ] PHP - \r\n- [ ] Temporal CLI - \r\n","closedAt":"2025-04-26T05:01:13Z","comments":[{"id":"IC_kwDOGflYbs57m1ZY","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Note the same applies to completing a workflow (since that is what continue as new is). When you complete a workflow all in-progress updates are dropped. I don't think we should build anything special for **just** continue as new. ie if we want to have some warning it should apply anytime a users tries to complete a workflow with non-complete updates,","createdAt":"2024-04-24T01:05:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2073777752","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs57rbZf","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"My preference: completing a workflow run today (via failure w/ retry, continue-as-new, etc) should consistently not carryover anything (signals, in-flight queries, in-flight updates, activities, child workflows, etc). We can have a general discussion about carryover on everything at some point though.\r\n\r\nFor pending admitted-only updates, we should reject workflow completion attempts with unhandled-command same as we do for signals. For accepted updates that are not completed by the workflow, we should fail the update as workflow completed.","createdAt":"2024-04-24T13:41:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2074981983","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs574dRI","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"@cretz I think it's too early to shut this conversation down.  I do agree we should consider other similar cases as we design it, but there's no reason update can't lead the way.  Update is also quite distinct from those other cases and enough different that impacts of shipping as-is should be considered separately.\r\n","createdAt":"2024-04-26T00:39:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2078397512","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5777HY","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> there's no reason update can't lead the way\r\n\r\nOn some things sure, but continue-as-new carryover I think is a large server side discussion that needs to be had holistically. At the least, the default behavior of update matching the default behavior of everything else is consistent while those discussions are being had. Meaning, you can easily support the consistent/simple approach today (it's needed anyways IMO), and then allow the carryover approach later if/when you develop it.","createdAt":"2024-04-26T12:38:03Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2079306200","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs57_eDW","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"I don't agree that consistency trumps other considerations here.  Consistency is one of several concerns to weigh.  \r\nI also wouldn't call the current approach simple--it's simple for us, but could be complex and mind-bending for the customers who encounter it.","createdAt":"2024-04-26T23:37:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2080235734","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs58Ilnc","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"It's not that consistence always trumps other things, it's that we have a chance to consistently solve for updates in the near term, and consistently solve for everything in the long term. But we are not considering solving for continue-as-new so we are not addressing the general problem. I don't believe giving update special continue-as-new behavior in the near term is valuable (in fact, if we care about this type value, we should do it with activities and child workflows immediately where there is arguably more value than update).","createdAt":"2024-04-29T12:40:19Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2082626012","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs58zcVO","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"Agreed that continue-as-new carryover is a larger discussion.  But I'm not ready to concede that we should do nothing now in hopes that it will happen one day.  I don't like to bank on things unless they're actually on the immediate roadmap.\r\n\r\nIn theory, you're right that activity is much more common.  But activities are usually kicked off by the Workflow and workflows are generally written in such a way that you hold onto a future with the activity and can await them before exiting/continuing.  Whereas signals and updates come from outside and are often handled out of the main workflow flow, making it both (a) much more likely (as a percentage) that they will run into trouble, and (b) harder to figure out what to do about it when it does happen.\r\n\r\nAll that's to say, the use cases are distinct and there may be strong and general mitigations we can do for the update/signal cases.\r\n","createdAt":"2024-05-03T22:52:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2093860174","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs58zclS","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"I want to raise the idea that the root cause here is the same as that for interleaved signals/updates: we're not serializing, which means it can race with all the things: other signals/updates, workflow code, or the end of the workflow.","createdAt":"2024-05-03T22:54:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2093861202","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6oyqlE","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"This was partially fixed by the addition of mutexes.","createdAt":"2025-04-26T05:01:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/467#issuecomment-2831853892","viewerDidAuthor":false}],"createdAt":"2024-04-24T00:57:02Z","labels":[{"id":"LA_kwDOGflYbs7XtLc6","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":467,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Updates getting dropped after continue as new","updatedAt":"2025-04-26T05:01:14Z","url":"https://github.com/temporalio/features/issues/467"}
