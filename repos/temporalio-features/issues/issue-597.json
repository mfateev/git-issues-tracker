{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the solution you'd like\n\nToday if a failure is too large, the server truncates. But the server can't truncate a stack trace for an \"encoded\" failure (i.e. one that is in the `encoded_attributes`), so that entire set of payloads is dropped which means the entire message and stack trace is gone, not just partial. So we need to do this SDK side.\n\nNeed to truncate the stack trace to a reasonably small size by default, ideally cutting out the middle frames only replacing them with \"...X frames omitted...\" or something. And this should be overridable in the failure converter options. First task is to find out what that number is, which likely requires consulting with the server to see what their default truncation size is and stay a bit under that (since theirs may be whole-proto size and ours is just stack trace).\n\n### Per-SDK Tickets\n\n- [ ] Go - \n- [ ] Java - \n- [ ] Core - \n- [ ] TypeScript - \n- [ ] Python -\n- [ ] .NET - \n- [ ] Ruby - https://github.com/temporalio/sdk-ruby/issues/319\n- [ ] PHP - \n- [x] Temporal CLI - N/A\n","closedAt":null,"comments":[{"id":"IC_kwDOGflYbs6-imFI","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Ruby users are hitting this more frequently. An early idea of client-side algorithm can be:\n\n```python\nif !failure.within_reasonable_size:\n    for stack_lines_to_preserve in [10, 4, None]\n        for cause in failure.causes_from_middle_out:\n            # Remove all but the first and last N lines from stack trace\n            # and replace with \"...<extra trace omitted>...\"\n            cause.remove_middle_lines_from_trace(stack_lines_to_preserve)\n            if failure.within_reasonable_size:\n                break\n```\n\nAlso:\n\n* Make sure that this is only done _after_ any logging (full traces should be available during logging)\n* Make the allowed max size of the failure customizable in failure converter creation (similar to \"encode common attributes\") and make sure there's a value that represents \"no max\" (i.e. do not do any trimming ever)","createdAt":"2025-08-18T13:04:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/597#issuecomment-3196739912","viewerDidAuthor":false}],"createdAt":"2025-02-12T20:05:19Z","labels":[{"id":"LA_kwDOGflYbs7XtLc6","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":597,"reactionGroups":[],"state":"OPEN","title":"Research/solve truncating failure stack traces SDK-side so they don't get truncated server side","updatedAt":"2025-08-19T21:26:19Z","url":"https://github.com/temporalio/features/issues/597"}
