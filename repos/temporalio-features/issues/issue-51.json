{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMzA0","is_bot":false,"login":"bergundy","name":"Roey Berman"},"body":"Up until now we've used a hack to get the list of registered queries from a workflow execution.\nThe hack is to send a query to a workflow, which responds with something like \"query not found, list of registered queries...\", parse the response and show in the UI.\n\nA standard way to support listing workflow queries would be to have a \"listQueries\" (name TBD) built-in query provided by the Workflow runtime.\n\nWe'd have to keep the hack around to support SDKs that still do not support the listQueries built-in query (all at the time of this writing).\n\nUPDATE: Here is the roadmap:\n\n* [x] API - https://github.com/temporalio/api/pull/336\n* [x] Go - https://github.com/temporalio/sdk-go/issues/601\n* [x] Java - https://github.com/temporalio/sdk-java/issues/335\n* [x] TypeScript - https://github.com/temporalio/sdk-typescript/pull/1319\n* [ ] Python - https://github.com/temporalio/sdk-python/issues/467\n* [x] .NET - https://github.com/temporalio/sdk-dotnet/issues/185","closedAt":null,"comments":[{"id":"IC_kwDOGflYbs5CnYfs","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"There are other things that are only registered at the SDK level, e.g. signal handlers. I wonder if we want a more generic \"get SDK workflow details\" query that also shows signal handlers and potentially any other SDK-side-only metadata. Whatever is decided, of course it needs to be well specified since all SDKs need to support it in the exact same way.","createdAt":"2021-11-01T17:49:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1117620204","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5CnYfv","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"That's a good suggestion @cretz, let's do that.","createdAt":"2021-11-01T19:25:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1117620207","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5CnYfx","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"We should define the message in the API proto repo","createdAt":"2022-01-07T03:05:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1117620209","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5J0mX4","author":{"login":"feedmeapples"},"authorAssociation":"NONE","body":"is it possible in theory to also provide input data type definitions? for both Queries and Signals in case we want to dynamically construct the UI ","createdAt":"2022-09-06T18:46:19Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1238525432","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5J0qAe","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"@feedmeapples - Can discuss in separate issue/discussion as that's much more complex (and due to signals persisting in history even on bad input poses some issues alleviated by the upcoming synchronous update feature).","createdAt":"2022-09-06T19:03:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1238540318","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5Yh3ib","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"### Implementation Thoughts\r\n\r\nThis should be represented as proto which every language and the UI can use. Granted the format will be JSON-based proto\r\nnot binary.\r\n\r\nHere would be my idea (expressed in TS terms, but applicable to all SDKs):\r\n\r\n```proto\r\n// This can be per workflow run or per workflow type\r\nmessage WorkflowMetadata {\r\n  WorkflowDefinition definition = 1;\r\n\r\n  // TODO(cretz): Future possibilities\r\n  // * Stack information\r\n  // * Worker metadata sans workflow list\r\n}\r\n\r\nmessage WorkflowDefinition {\r\n  // If empty, this is a \"dynamic\" form of the workflow\r\n  string type = 1;\r\n  // Optional\r\n  string description = 2;\r\n\r\n  // When fetching at a worker level these are obviously fixed to the workflow\r\n  // definition which means that languages like Go need to provide a way to\r\n  // allow developers to define these things ahead of time if they want (unlike\r\n  // today which is runtime). When fetching at a workflow level, these may be\r\n  // specific to a run since handlers can be added inside of workflows.\r\n  //\r\n  // We can break these out to separate message types for each definition type\r\n  // if/when there are fields specific to each.\r\n  repeated InteractionDefinition signal_definitions = 3;\r\n  repeated InteractionDefinition query_definitions = 4;\r\n  repeated InteractionDefinition update_definitions = 5;\r\n}\r\n\r\nmessage InteractionDefinition {\r\n  // If empty, this is a \"dynamic\" form of the interaction\r\n  string name = 1;\r\n\r\n  // Optional. While we can support type hinting information for callers in\r\n  // more well-typed fields in the future, it gets complicated quickly.\r\n  // Therefore, all information a caller may need should currently be in English\r\n  // in this field (even if it's generated by the SDK).\r\n  string description = 2;\r\n}\r\n\r\nmessage ActivityDefinition {\r\n  // If empty, this is a \"dynamic\" form of the activity\r\n  string type = 1;\r\n  // Optional\r\n  string description = 2;\r\n}\r\n\r\nmessage WorkerMetadata {\r\n  repeated WorkflowDefinition workflow_definitions = 1;\r\n  repeated ActivityDefinition activity_definitions = 2;\r\n\r\n  // TODO(cretz): There are so many options here to add things such as:\r\n  // * Registration/config options\r\n  // * Cache info\r\n  // * Identity information we usually have for workers\r\n  // * SDK language and version\r\n  // * General process/metric info (but don't overdo this)\r\n}\r\n```\r\n\r\nHere are the calls one can make:\r\n\r\n* \"get workflow metadata\" - Issued to workflow as a query\r\n* \"get worker metadata\" - Issued to the worker via a new concept I'm calling \"worker updates\". Implementation thoughts:\r\n  * New `UpdateWorker` top-level RPC call that accepts a task queue and optional worker identity\r\n  * The `repeated temporal.api.protocol.v1.Message messages` needs to also be added to `PollActivityTaskQueueResponse`\r\n  * Upon worker update, the next poll of `PollWorkflowTaskQueueResponse` or `PollActivityTaskQueueResponse` will be the\r\n    worker update which is represented as:\r\n    * Either a new \"task queue kind\" or special task queue name\r\n    * ^ Once that is seen, no task response is expected by server and anything else about the poll response except the\r\n      worker update is discarded (no need to piggyback on existing tasks I don't think, it adds confusion)\r\n    * Worker update request is inside the protocol message\r\n  * Workers response to worker updates via a new `RespondWorkerUpdate` top-level call which takes arbitrary protocol\r\n    messages/identifiers\r\n  * _Technically_ we can expose worker update handlers, but there is not much value today\r\n    * Consideration was given to just using activities or workflows as \"worker update\", but we can't guarantee what is\r\n      being polled on\r\n\r\nFor discussion:\r\n\r\n1. Is \"metadata\" a good word? Even though we are only talking about \"definitions\" here, I want to encompass the idea\r\n   of runtime information that is not necessarily definition based\r\n1. Maybe we should break \"description\" into \"summary\" and \"description\" to encourage one-liner \"summary\" for use in UI listing and other places\r\n1. Is there value yet in asking an activity for runtime \"metadata\" per activity run (obv as a request on a heartbeat\r\n   response)?\r\n1. How does each language represent its \"description\" information. Some languages like Python can do neat things like\r\n   grab the `__doc__` and also add type hint information, but most other languages do not have docs at runtime so a\r\n   separate field at the registration/declaration/definition/decoration/annotation/attribute site would be required\r\n1. How best to allow Go to predefine its interactions?\r\n1. Be sure to ask UI team if this works for them and/or if they have any suggestions\r\n1. For an initial version of this, we can just support the \"get workflow metadata\" operation as a query and ignore all that \"worker update\" business, but we need to keep it in mind so we design our metadata approach where it could be obtained at a worker level","createdAt":"2023-03-27T14:59:07Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1485273243","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5nxK57","author":{"login":"Alex-Tideman"},"authorAssociation":"MEMBER","body":"I would love to get this `listQueries` feature in all the SDKs. We are envisioning building custom UIs based on query names and it would be a lot nicer to do this without the current hack. Happy to work with whoever on this from the SDK side.","createdAt":"2023-09-29T13:59:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1740942971","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5t453x","author":{"login":"antlai-temporal"},"authorAssociation":"MEMBER","body":"> ```proto\r\n>   // If empty, this is a \"dynamic\" form of the workflow\r\n> ```\r\n@cretz I wonder if we need to report dynamic workflow/interactions at all. In particular, if they don't have a description either, there is no proper way to identify them...\r\n","createdAt":"2023-12-06T20:24:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1843633649","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5t5kUH","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> I wonder if we need to report dynamic workflow/interactions at all. In particular, if they don't have a description either, there is no proper way to identify them...\r\n\r\nThis is about providing information to the caller about the shape of what is defined on the workflow. The caller may want to know that _any_ query could be accepted because dynamic query is enabled. This can affect things like the UI where they may make it clear to a user that any arbitrary string query name would be accepted if they knew that dynamic queries were supported.\r\n\r\nBtw, if you are tackling this now, I would ignore anything about \"worker queries\" in this issue, that can be done somewhere else.","createdAt":"2023-12-06T22:43:46Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1843807495","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5t5-th","author":{"login":"antlai-temporal"},"authorAssociation":"MEMBER","body":"> . The caller may want to know that _any_ query could be accepted because dynamic query is enabled\r\nDo we have the same concept for updates and signals, or just only for queries? ~~The examples I'm seeing define a generic signal first, and add extra info in the payload, so `name` will not be missing...~~ Mistery solved, dynamic handlers are not supported in TS, only Java/Python/.Net, and go uses GetUnhandledSignalNames for signals. For update, there is no GetUnhandledUpdateNames in go (I'm adding an issue), Java seems to support it, not sure about .Net/Python... \r\n ","createdAt":"2023-12-07T00:10:38Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1843915617","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5t_ubM","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This issue is known and #201 exists to bring parity here.\r\n\r\nSignals in Go for this feature request are going to be a bit interesting. My suggestion: there is no such thing as a signal definition in Go so we should never populate that repeated field in metadata. However, we can create helper API in Go like `workflow.DefineSignalChannel(workflow.SignalDefinition{Name: \"my-signal\", Description: \"whatever\"})` and people can call that to populate this info but it won't relate to their actual channel use. It would be a bad idea IMO to populate Go signal definitions in this metadata just based on whether a signal channel was ever asked for and similarly bad if it included any signal name that had been seen.\r\n\r\nWe're going to need to design how to provide \"descriptions\" to these interactions in every language anyways. In Go, `SetUpdateHandlerWithOptions`'s options can have it, but you'd need a new `SetQueryHandlerWithOptions` for queries. In Java, Python, and .NET you can use a field on the annotation, decorator, and attribute respectively though you need to still accept them on runtime-added forms. In TS these are likely just options on the define calls.\r\n\r\nI can provide clarification here if unclear.","createdAt":"2023-12-07T14:17:31Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1845421772","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5yFkUc","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"This needs to be done in every SDK other than TypeScript","createdAt":"2024-01-29T06:46:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/51#issuecomment-1914062108","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5--T9q","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"Note from UI sync: Good idea to have an \"is visible in UI\" flag for interactions \r\n\r\nOther possible future options:\r\n* Disable cancel\r\n* possibility to customize input ui / forms etc\r\n* Some kind of markup for possible interactions / form in the UI for the workflow","createdAt":"2024-05-24T19:55:26Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/51#issuecomment-2130263914","viewerDidAuthor":false}],"createdAt":"2021-10-25T15:48:16Z","labels":[{"id":"LA_kwDOGflYbs7XtLc6","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":51,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Standardize method for listing workflow queries/signals (and maybe other things like registered activities/workflows and other metadata)","updatedAt":"2025-03-20T13:48:55Z","url":"https://github.com/temporalio/features/issues/51"}
