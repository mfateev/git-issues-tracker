{"assignees":[],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"**Is your feature request related to a problem? Please describe.**\r\nThere is a need to attach additional information to commands for troubleshooting and diagraming purposes. [For example ](https://community.temporal.io/t/is-worker-threadid-available-in-event-history/1290)thread-id of a thread that invoked an activity or scheduled a timer.\r\n\r\n**Describe the solution you'd like**\r\nThe proposal is to add a metadata field to the [Command](https://github.com/temporalio/api/blob/e1c0551f105bd580c286ce816f8e1b05faa48e4b/temporal/api/command/v1/message.proto#L174) protobuf. Then SDKs would be able to add use case specific information to commands.\r\n\r\n","closedAt":"2024-05-22T15:40:57Z","comments":[{"id":"IC_kwDOGflYbs5dnqNM","author":{"login":"williambanfield"},"authorAssociation":"NONE","body":"This would be pretty helpful for us. At the moment, I am planning on creating a small activity called 'annotate' that takes a list of strings so that the list of strings will be stored and output alongside workflow information.","createdAt":"2023-05-31T18:02:26Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1570677580","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5dnwm7","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"We have since added a SDK metadata command at https://github.com/temporalio/api/pull/259 but it is task level meant for SDK internal use.\r\n\r\n> I am planning on creating a small activity called 'annotate'\r\n\r\nNote, you'll probably want to make this a local activity that is a single-event marker instead of a full activity. But agreed, we should support arbitrary metadata on commands (and maybe an arbitrary log marker).","createdAt":"2023-05-31T18:21:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1570703803","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5dnzRR","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Another user [ask ](https://github.com/temporalio/sdk-java/issues/396#issuecomment-1553527210) that would be solved if we could attach metadata to commands","createdAt":"2023-05-31T18:29:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1570714705","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5dn3yM","author":{"login":"williambanfield"},"authorAssociation":"NONE","body":"@cretz \r\n\r\n>  single-event marker instead of a full activity\r\n\r\nHow does one go about doing this?","createdAt":"2023-05-31T18:41:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1570733196","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5dn4he","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Use a local activity. It's automatically an inline single-command/event thing as opposed to activities which is multi-event and may execute on a remote worker.","createdAt":"2023-05-31T18:44:27Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1570736222","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5v_AvT","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"To be more specific here, I think we take an approach similar to https://github.com/temporalio/api/pull/259 but for commands/events. We should add `temporal.api.sdk.v1.WorkflowEventMetadata` to both `temporal.api.command.v1.Command` and `temporal.api.history.v1.HistoryEvent` (or just to specific attributes we know can handle them). And server should put the metadata on the events created from the commands. `WorkflowEventMetadata` can have common, well-typed fields like `string friendly_name` or in generic cases in cahoots with UI, there can be a `map<string, string> ui_info` or similar.","createdAt":"2024-01-05T14:44:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1878789075","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs52ASwu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"After internal discussion, it was decided that the approach here is an event metadata that, for now, is a map of enumerate keys and payload values. The enumerate keys are well-known metadata keys that UI can leverage, and the payload values are encryptable. I will link an API PR when available. Arbitrary user-defined keys is not going to be available at this time, but the well-known keys will have lots of opportunity for users to provide extra event information.","createdAt":"2024-03-05T23:05:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-1979788334","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs53f9kF","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This has been changed to \"user metadata\" and after internal discussion, the initial API PR for public discussion is available at https://github.com/temporalio/api/pull/371.","createdAt":"2024-03-18T20:11:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-2004867333","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5-qq5k","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I am closing this in favor of the clearer #486.","createdAt":"2024-05-22T15:40:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/141#issuecomment-2125114980","viewerDidAuthor":false}],"createdAt":"2021-01-11T23:41:35Z","labels":[{"id":"LA_kwDOGflYbs7XtLc6","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":141,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":4}}],"state":"CLOSED","title":"User metadata","updatedAt":"2024-05-22T15:40:57Z","url":"https://github.com/temporalio/features/issues/141"}
