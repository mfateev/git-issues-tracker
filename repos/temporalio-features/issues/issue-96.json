{"assignees":[{"id":"MDQ6VXNlcjUxNzY4Mw==","login":"Sushisource","name":"Spencer Judge","databaseId":0},{"id":"MDQ6VXNlcjY0MTIxNjk=","login":"mjameswh","name":"James Watkins-Harvey","databaseId":0}],"author":{"id":"MDQ6VXNlcjg0NDExMDE0","is_bot":false,"login":"yiminc","name":"Yimin Chen"},"body":"### Is your feature request related to a problem? Please describe.\r\nSDK has built in retry policy, which works pretty well for transient errors. Usually, retry will recover from those transient errors with only small number of retry attempt. \r\nThere is a list of retry-able errors, including ResourceExhaustedError. However, we should backoff much more on resource exhausted error because it is a clear indication that server is not able to keep up and aggressive retry will worsen the situation and could lead to more serious outage.\r\n\r\n<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->\r\n\r\n### Describe the solution you'd like\r\nWhenever seeing resource exhausted error, we need to backoff further. We may need a different retry policy with larger backoff interval and smaller max attempt count.\r\n\r\n\r\n<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context or screenshots about the feature request here. -->\r\n\r\nChecklist:\r\n\r\n- [x] TypeScript\r\n- [x] Core (includes Python client)\n- [x] Go\r\n- [x] Java\n- [ ] PHP","closedAt":null,"comments":[{"id":"IC_kwDOGflYbs5HmODt","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Any specific ideas on implementation here? Specifically:\r\n\r\nWhat numbers do you propose? Right now in Go default gRPC retry is initial interval of 200ms w/ backoff exponent as 2 and max as 60s (or ctx deadline).\r\n\r\n> We may need a different retry policy with larger backoff interval and smaller max attempt count.\r\n\r\nCan you clarify the logic here when, after resource exhausted retry policy is set, what we do when we receive non-resource-exhausted error? Should we completely reset the retry policy? Same question if it's a non-resource-exhausted error and then a resource exhausted error.","createdAt":"2022-08-01T13:24:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/96#issuecomment-1201201389","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5H3jm8","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Here is an example of how it can be handled just to give some idea:\r\nhttps://github.com/temporalio/temporal/blob/3182dc2cde75e3e49fccb1de2905db5d30db58ab/common/backoff/retry.go#L204-L206","createdAt":"2022-08-04T20:41:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/96#issuecomment-1205746108","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5H4KSz","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@yiminc it would be ideal if the server let the SDK know what the base retry interval is for a given error so we don't have to update SDKs when the policy changes.\r\n\r\nFor now we will add the custom behavior as requested.\r\nNot sure we'd want to do what the server retry does, I'd expect that attempt is persisted and the backoff duration is calculated based on the error type and the current attempt. In the server retrier, if the error flakes from \"resource exhausted\" to another error the attempt number is effectively reset.\r\nSo we'd replace the `NextBackOff()` method with a `Backoff(attempt)` method.","createdAt":"2022-08-05T00:20:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/96#issuecomment-1205904563","viewerDidAuthor":false}],"createdAt":"2022-07-30T00:44:54Z","labels":[{"id":"LA_kwDOGflYbs7XtLc6","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":96,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Backoff more on resource exhausted error","updatedAt":"2023-01-10T17:21:50Z","url":"https://github.com/temporalio/features/issues/96"}
