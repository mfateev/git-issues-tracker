{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMzA0","is_bot":false,"login":"bergundy","name":"Roey Berman"},"body":"Different SDKs implement graceful shutdown differently.\r\n\r\nTypeScript traditionally treated the graceful shutdown period as \"give up on shutdown after this period\" and recently changed the semantics to be inline with Python / .NET where graceful shutdown refers to when to issue cancellations to running activities.\r\n\r\nBy default all Core based SDKs now will wait for activities to complete before returning from `Worker.run`.\r\n\r\nGo does not wait for activities to complete today and should change to be consistent with Core based SDKs.\r\nNeed to verify what Java does here.","closedAt":"2025-07-14T17:23:17Z","comments":[{"id":"IC_kwDOGflYbs5aql0z","author":{"login":"edmondop"},"authorAssociation":"NONE","body":"Do you have by chance the issue/review on Typescript so I can start to look there and write a draft for the spec? Also if you have spec of other features that I could use as a reference that would be useful\r\n","createdAt":"2023-04-25T03:40:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-1521114419","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5bBVeq","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Most of our specs are just written on the feature test for them for example https://github.com/temporalio/features/blob/main/features/activity/cancel_try_cancel/README.md\\\r\n\r\n","createdAt":"2023-04-28T06:54:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/features/issues/261#issuecomment-1527076778","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5bJLhe","author":{"login":"edmondop"},"authorAssociation":"NONE","body":"@Quinn-With-Two-Ns after our discussion, I am confused by the title of the issue. It looks like the spec already exist, and we are just missing the feature tests? https://github.com/temporalio/features/blob/main/features/activity/shutdown/README.md\r\n\r\nMaybe the right thing to do is just to:\r\n\r\n- [ ] write the tests\r\n- [ ] fix the non compliant SDK","createdAt":"2023-04-30T20:32:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-1529133150","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6F3SxT","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Note, https://github.com/temporalio/features/blob/main/features/activity/shutdown/README.md may be out of date and may not accurately reflect how we want to approach this with regards to graceful shutdown. It may be revisited as part of this issue.","createdAt":"2024-07-23T17:44:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-2245864531","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6hsNXI","author":{"login":"saward"},"authorAssociation":"NONE","body":"I've experienced an issue where when a worker is given the kill signal (SIGTERM I'm guessing), the server doesn't seem to know that the activity is no longer running in the worker, so doesn't retry until it times out.  Depending on timeout settings, this can take a long time.  I think it's related to this feature request.\n\nIs there a way right now with Go SDK to handle the killing of a worker, so that the temporal server knows immediately that the in-progress activities now need to be given to new workers?","createdAt":"2025-03-11T05:44:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-2712720840","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6hziZa","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"@saward - in Go, activity contexts are canceled on graceful worker shutdown (after optional grace period) and there are other values in the `activity` package that show a worker is shutting down. The retry policy governs when failed activities are retried (regardless of reason for failure, including caused by worker shutdown's context cancel). There are ways to capture this situation and instead return a special error that retries sooner.\n\nBut this GitHub issue is just about properly documenting. For Go-specific questions/support, can ask on Slack or our forums (see https://temporal.io/community), or open a cloud ticket if you're a cloud user.","createdAt":"2025-03-11T14:54:11Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-2714642010","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6tQ74b","author":{"login":"JCMais"},"authorAssociation":"NONE","body":"Reading the link above I see no mention of a grace period being given to activities _before_ the activity gets the WORKER SHUTDOWN cancellation signal, is that really the case?\n\nWhat is the grace period used for in that case? (e.g on TypeScript, where the worker has a shutdownGracePeriod option)","createdAt":"2025-05-24T15:41:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-2906897947","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6tnhxu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Reading the link above I see no mention of a grace period being given to activities before the activity gets the WORKER SHUTDOWN cancellation signal, is that really the case?\n\nhttps://typescript.temporal.io/api/interfaces/worker.WorkerOptions#shutdowngracetime mentions \"In-flight activities will be cancelled _after_ this period\" (emphasis mine)\n\nThis is a language specific question at this time (though we are hoping to write consistent spec/docs as part of this issue). Can ask in Slack or forums for the specific language concern.","createdAt":"2025-05-27T14:50:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/261#issuecomment-2912820334","viewerDidAuthor":false}],"createdAt":"2023-04-13T23:10:36Z","labels":[{"id":"LA_kwDOGflYbs8AAAABBOXxdg","name":"feature-test","description":"Related to implementation of a feature in the features/ directory","color":"F9D0C4"}],"milestone":null,"number":261,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Write spec for graceful worker shutdown","updatedAt":"2025-07-14T17:23:17Z","url":"https://github.com/temporalio/features/issues/261"}
