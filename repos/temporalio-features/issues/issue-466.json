{"assignees":[],"author":{"id":"U_kgDOCeuzXQ","is_bot":false,"login":"drewhoskins-temporal","name":"Drew Hoskins"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nIt's hard to tell when log lines occurred within an update (or signal, or query) handler.\r\n<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->\r\n\r\n### Describe the solution you'd like\r\n\r\nI logged from within an update handler in the python SDK with `self.logger.info`\r\nImagining I saw this line in production, and I didn’t build the workflow, I could be confused as to why this code is getting executed.  In fact, my update handler can also be called by the workflow itself, meaning it'd be nice if the context clarified whether I'm in an update handler or the main workflow.\r\n\r\nOr I might want to grep the logs for all the times when an update/signal/query was called.\r\n\r\n```\r\nINFO:batch_orchestrator:This is my log message. ({'attempt': 1, 'namespace': 'default', 'run_id': '183ba64c-a415-492a-b569-a0e97d1a3114', 'task_queue': 'my-task-queue', 'workflow_id': 'inflate_product_prices-37acbbae-d941-4be8-8242-56f15a91d892', 'workflow_type': 'BatchOrchestrator'})\r\n```\r\nI'd love if the context or prefix listed which handler it's in somehow and perhaps whether it was a signal/update/query.  In the case of an update, I'd like to see the update ID.\r\n\r\n<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context or screenshots about the feature request here. -->\r\n\r\n### Per-SDK Tickets\r\n\r\n<!-- Add links here once the tickets are created (no need to create them immediately). -->\r\n\r\n* [x] Go https://github.com/temporalio/sdk-go/issues/1648\r\n* [x] .NET https://github.com/temporalio/sdk-dotnet/issues/351\r\n* [x] Python https://github.com/temporalio/sdk-python/issues/648\r\n* [x] TypeScript https://github.com/temporalio/sdk-typescript/issues/1532\r\n* [x] Java https://github.com/temporalio/sdk-java/issues/2237\r\n* [x] PHP https://github.com/temporalio/sdk-php/issues/512\r\n","closedAt":"2025-01-29T19:58:33Z","comments":[{"id":"IC_kwDOGflYbs57mk7i","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":">Imagining I saw this line in production, and I didn’t build the workflow, I could be confused as to why this code is getting executed.\r\n\r\nIf you didn't write the workflow how will knowing what handler the log came from  really help? What if a user wants to know all the logs that came from a particular  update request? It doesn't  help with query or signal, but we could consider adding the updateID as another KV in the logger.","createdAt":"2024-04-24T00:32:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2073710306","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs57mnP3","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"> If you didn't write the workflow how will knowing what handler the log\r\ncame from really help?\r\nIf I'm debugging, it will help me understand at-a-glance that this event\r\ncame from an external source and not the workflow itself.  Suppose the\r\nworkflow is running, then there's an update, and the failure happens soon\r\nafterward, I can be like \"a ha!  This bug was triggered by an update!\"\r\n\r\nOn Tue, Apr 23, 2024 at 5:32 PM Quinn Klassen ***@***.***>\r\nwrote:\r\n\r\n> Imagining I saw this line in production, and I didn’t build the workflow,\r\n> I could be confused as to why this code is getting executed.\r\n>\r\n> If you didn't write the workflow how will knowing what handler the log\r\n> came from really help? What if a user wants to know all the logs that came\r\n> from a particular update request? It doesn't help with query or signal, but\r\n> we could consider adding the updateID as another KV in the logger.\r\n>\r\n> —\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/temporalio/features/issues/466#issuecomment-2073710306>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/BHV3GXIZUPOVF225K4AX2DTY634SHAVCNFSM6AAAAABGV4LGSSVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDANZTG4YTAMZQGY>\r\n> .\r\n> You are receiving this because you authored the thread.Message ID:\r\n> ***@***.***>\r\n>\r\n","createdAt":"2024-04-24T00:37:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2073719799","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs57mv9L","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"If you had multiple updates how would you tell which one caused your bug if all you  have is the handle?\r\n\r\n","createdAt":"2024-04-24T00:53:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2073755467","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs57rdJr","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"We/users can add logging scope if we need to in some langs, but in other langs that's non-standard. But it's important to understand that code that runs as a result of one of these interactions cannot always know it came from one of these interactions (e.g. a signal in Go is a channel, there's no handler, and e.g. many signal handlers just append something to a list to be processed by the primary coroutine). If it is important for a user to ship an action-specific logger around, they may.\r\n\r\nIn Python you might:\r\n\r\n```python\r\n@workflow.update\r\nasync def do_update(self, in: MyUpdateInput) -> MyUpdateOutput:\r\n    workflow.logger.info(\"This is my log message\", extra={\"handler\": \"do_update\"})\r\n    ...\r\n```\r\n\r\n^ This is how Python users are expected to add things to loggers. We only do workflow-level contextual information implicitly because the logger is workflow specific. Some languages (not Python) have a concept of scoped loggers, and some languages (Python) expect you to pass contextual information if you want it on your logs.\r\n\r\nWe can consider adding `contextvars` for logger, but in Python the common way is to carry state that the log caller sets on the log message or create an entirely new logger with an adapter (which is basically what we do at the workflow level). For other languages, we can discuss their most common way to add scope. But it is very important we are language idiomatic and that all languages approaches are understood well for issues like this.","createdAt":"2024-04-24T13:45:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2074989163","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs5_8ZbT","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"Max is bought in to doing something here.  I'm tagging it as part of update GA.","createdAt":"2024-06-04T03:58:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2146539219","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6NXrhU","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"Interesting somewhat-related conversation about tracing with a customer.  Because update is synchronous, and datadog doesn't support being part of two traces, they wanted their updates to be traced as part of the caller's traces rather than the workflow's.\r\nI think that may underscore that the user will want to see logs associated with the update operation even moreso than the workflow.  Even in the absence of tracing, logging the Update ID could help connect the client to the update handler in debugging scenarios, and the update name will greatly clarify what's going on.","createdAt":"2024-09-24T16:36:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2371795028","viewerDidAuthor":false},{"id":"IC_kwDOGflYbs6cU25N","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"This has been implemented across all SDKs.","createdAt":"2025-01-29T19:58:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/features/issues/466#issuecomment-2622713421","viewerDidAuthor":false}],"createdAt":"2024-04-24T00:22:21Z","labels":[{"id":"LA_kwDOGflYbs7XtLc6","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":466,"reactionGroups":[],"state":"CLOSED","title":"Show update handler and ID in logging context","updatedAt":"2025-01-29T19:58:34Z","url":"https://github.com/temporalio/features/issues/466"}
