{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the solution you'd like\n\nDuring [this CI run](https://github.com/temporalio/sdk-ruby/actions/runs/14978028437/job/42075181750?pr=263) (may be gone by the time this is being read), we got this error:\n\n```\nWorkerWorkflowTest#test_queue = I, [2025-05-12T17:04:51.532128 #12857]  INFO -- : Block completed, beginning worker shutdown\ntime=2025-05-12T17:04:51.654 level=ERROR msg=\"service failures\" operation=AddWorkflowTask wf-namespace=default grpc_code=Unavailable wf-id=wf-6d62c599-c9fb-440e-bba2-86be625ce346 wf-run-id=0196c574-163a-7888-95b9-58d59e75f99e error=\"sticky worker unavailable, please use original task queue.\"\nI, [2025-05-12T17:04:51.754911 #12857]  INFO -- : Block completed, beginning worker shutdown\nI, [2025-05-12T17:04:52.779953 #12857]  INFO -- : Block completed, beginning worker shutdown\nI, [2025-05-12T17:04:52.989104 #12857]  INFO -- : Block completed, beginning worker shutdown\ntime=2025-05-12T17:04:53.225 level=ERROR msg=\"service failures\" operation=AddWorkflowTask wf-namespace=default grpc_code=Unavailable wf-id=wf-d07f6b97-bfc0-4109-bce6-630a2440e540 wf-run-id=0196c574-1c5b-71fe-a17f-b73c02c59078 error=\"sticky worker unavailable, please use original task queue.\"\nE, [2025-05-12T17:04:54.834755 #12857] ERROR -- : Block failure (beginning worker shutdown)\nE, [2025-05-12T17:04:54.834808 #12857] ERROR -- : 1c1\n< \"0196c574-de2f-7532-8408-fe9253e8cb4a\"\n---\n> \"0196c574-e62d-7731-b052-6d233ceeb4fa\"\n (Minitest::Assertion)\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/vendor/bundle/ruby/3.4.0/gems/minitest-5.25.5/lib/minitest/assertions.rb:176:in 'Minitest::Assertions#assert'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/vendor/bundle/ruby/3.4.0/gems/minitest-5.25.5/lib/minitest/assertions.rb:216:in 'Minitest::Assertions#assert_equal'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/test/worker_workflow_test.rb:1399:in 'block in WorkerWorkflowTest#test_queue'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/test/workflow_utils.rb:63:in 'block in WorkflowUtils#execute_workflow'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/lib/temporalio/internal/worker/multi_runner.rb:42:in 'block in Temporalio::Internal::Worker::MultiRunner#apply_thread_or_fiber_block'\nFull cause chain:\nException: Minitest::Assertion - 1c1\n< \"0196c574-de2f-7532-8408-fe9253e8cb4a\"\n---\n> \"0196c574-e62d-7731-b052-6d233ceeb4fa\"\nBacktrace:\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/vendor/bundle/ruby/3.4.0/gems/minitest-5.25.5/lib/minitest/assertions.rb:176:in 'Minitest::Assertions#assert'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/vendor/bundle/ruby/3.4.0/gems/minitest-5.25.5/lib/minitest/assertions.rb:216:in 'Minitest::Assertions#assert_equal'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/test/worker_workflow_test.rb:1399:in 'block in WorkerWorkflowTest#test_queue'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/test/workflow_utils.rb:63:in 'block in WorkflowUtils#execute_workflow'\n/home/runner/work/sdk-ruby/sdk-ruby/temporalio/lib/temporalio/internal/worker/multi_runner.rb:42:in 'block in Temporalio::Internal::Worker::MultiRunner#apply_thread_or_fiber_block'\n```\n\nIt looks like the first workflow can complete before we start the second in rare cases. We need to also have a failed-only ID reuse policy on the last execute workflow of this test.","closedAt":"2025-07-24T16:12:12Z","comments":[{"id":"IC_kwDOHI0NyM65nLqr","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Have not seen this issue since Core upgrade, closing for now, but will reopen if seen again","createdAt":"2025-07-24T16:12:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/264#issuecomment-3114056363","viewerDidAuthor":false}],"createdAt":"2025-05-12T18:16:13Z","labels":[{"id":"LA_kwDOHI0NyM7vFHIK","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":264,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Investigate `test_queue` flake","updatedAt":"2025-07-24T16:12:12Z","url":"https://github.com/temporalio/sdk-ruby/issues/264"}
