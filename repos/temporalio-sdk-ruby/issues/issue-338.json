{"assignees":[],"author":{"id":"MDQ6VXNlcjEzMDMxNQ==","is_bot":false,"login":"laurynas","name":"Laurynas Butkus"},"body":"### What are you really trying to do?\n\nWe want activity to fail instantly on certain error types, for example `ActiveRecord::RecordNotFound`.\n\nWe use retry policy:\n\n```ruby\nTemporalio::RetryPolicy.new(\n  non_retryable_error_types: %w(ActiveRecord::RecordNotFound),\n)\n```\n\n### Describe the bug\n\nWhen `ActiveRecord::RecordNotFound` error is raised we expect workflow to fail, but it retries.\nHowever, if we specify error type without namespace, it works fine - fails instantly:\n\n```ruby\nTemporalio::RetryPolicy.new(\n  non_retryable_error_types: %w(RecordNotFound),\n)\n```\n\nAlso in Temporal UI it failure type shows without module:\n<img width=\"359\" height=\"110\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/73cd0fe9-f16a-436d-8749-3024797fa329\" />\n\n### Minimal Reproduction\n\nDetails in bug description.\n\n### Environment/Versions\n\nReproduced with Ruby SDK v0.5.0, v0.6.0\n\n### Additional context\n\nPossibly related to https://github.com/temporalio/sdk-ruby/issues/293","closedAt":"2025-09-15T09:00:49Z","comments":[{"id":"IC_kwDOHI0NyM7Dz92X","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is intentional. By default, exceptions raised from activity are converted to `ApplicationError` with the `type` as the _unqualified_ error type name. This is the same in all SDKs. We may need to document this better, but it is very much on purpose (so much so we actually had a bug where we weren't doing this originally but fixed in #294). If the default unqualified name is not specific enough, consider either catching the error and raising `ApplicationError` yourself w/ `non_retryable: true`, or raising `ApplicationError` with any `type` string you'd like corresponding to your retry policy.\n\nAlso, if wanting to discuss or have general questions, feel free to ask on the [forum](https://community.temporal.io) or [Slack](https://t.mp/slack) in the `#ruby-sdk` channel.","createdAt":"2025-09-12T12:54:41Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/338#issuecomment-3285179799","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM7D0GCs","author":{"login":"laurynas"},"authorAssociation":"NONE","body":"Thanks for the clarification and guidance. This is indeed unexpected and could cause some issues when migrating from Coinbase SDK. We'll try to find some generic solution. I guess we could use custom failure converter which would be extending default one. Does it make sense?","createdAt":"2025-09-12T13:03:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/338#issuecomment-3285213356","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM7D0vC7","author":{"login":"laurynas"},"authorAssociation":"NONE","body":"I managed to workaround it using custom failure converter, like this:\n\n```ruby\nrequire 'temporalio/converters/failure_converter'\n\nmodule TemporalioExt\n  module Converters\n    class FailureConverter < ::Temporalio::Converters::FailureConverter\n      def to_failure(error, converter)\n        failure = super\n\n        return failure if failure.application_failure_info.nil?\n\n        failure.application_failure_info.type = error.class.name\n        failure\n      end\n    end\n  end\nend\n```","createdAt":"2025-09-12T13:51:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/338#issuecomment-3285381307","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM7D2Gmg","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> I guess we could use custom failure converter which would be extending default one. Does it make sense?\n\nI think it would be better to change the retry policy. Custom failure converters are rare and you may not want to remember to install yours just for this one error type field.","createdAt":"2025-09-12T15:31:29Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/338#issuecomment-3285739936","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM7EJb5S","author":{"login":"laurynas"},"authorAssociation":"NONE","body":"Hey @cretz, thanks for the tip! I think I found a clean way to keep namespace as you have suggested - re-raising `ApplicationError` in the intereceptor:\n\n```ruby\nrequire 'temporalio/client/interceptor'\nrequire 'temporalio/worker/interceptor'\n\nmodule Vinted\n  module TemporalioExt\n    module Interceptors\n      class ActivityErrorType\n        include Temporalio::Client::Interceptor\n        include Temporalio::Worker::Interceptor::Activity\n\n        def intercept_activity(next_interceptor)\n          ActivityInbound.new(next_interceptor)\n        end\n\n        class ActivityInbound < Temporalio::Worker::Interceptor::Activity::Inbound\n          def execute(_input)\n            super\n          rescue Temporalio::Error => e\n            raise(e)\n          rescue StandardError => e\n            # raising ApplicationError manually to keep a full error type namespace\n            # https://github.com/temporalio/sdk-ruby/issues/338\n            raise Temporalio::Error::ApplicationError.new(e.message, type: e.class.name)\n          end\n        end\n      end\n    end\n  end\nend\n```","createdAt":"2025-09-15T07:21:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/338#issuecomment-3290807890","viewerDidAuthor":false}],"createdAt":"2025-09-12T12:32:47Z","labels":[{"id":"LA_kwDOHI0NyM7vFHIE","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":338,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Retry policy non_retryable_error_types does not respect error module/namespace","updatedAt":"2025-09-15T09:00:49Z","url":"https://github.com/temporalio/sdk-ruby/issues/338"}
