{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### What are you really trying to do?\n\n<!-- \nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \n-->\n\n### Describe the bug\n\nUser getting error like:\n\n```\n/Users/someuser/.dev/gem/somehash/gems/temporalio-0.4.0-arm64-darwin/lib/temporalio/workflow/definition.rb:287:in 'Temporalio::Workflow::Definition.singleton_method_added': Attempting to override Temporal-defined class definition method (RuntimeError)\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:555:in 'T::Private::Methods::SingletonMethodHooks#singleton_method_added'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/class_utils.rb:82:in 'Module#define_method'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/class_utils.rb:82:in 'block in T::Private::ClassUtils.def_with_visibility'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/class_utils.rb:73:in 'Module#module_exec'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/class_utils.rb:73:in 'T::Private::ClassUtils.def_with_visibility'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/call_validation.rb:31:in 'block (2 levels) in T::Private::Methods::CallValidation.wrap_method_if_needed'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/decl_state.rb:25:in 'T::Private::DeclState#without_on_method_added'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/call_validation.rb:30:in 'block in T::Private::Methods::CallValidation.wrap_method_if_needed'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/configuration.rb:533:in 'T::Configuration.without_ruby_warnings'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/call_validation.rb:28:in 'T::Private::Methods::CallValidation.wrap_method_if_needed'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:411:in 'T::Private::Methods.unwrap_method'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:353:in 'T::Private::Methods.run_sig'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:248:in 'block in T::Private::Methods._on_method_added'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:449:in 'T::Private::Methods.run_sig_block_for_key'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:469:in 'block in T::Private::Methods.run_all_sig_blocks'\n\tfrom <internal:kernel>:168:in 'Kernel#loop'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/private/methods/_methods.rb:466:in 'T::Private::Methods.run_all_sig_blocks'\n\tfrom /Users/someuser/.dev/gem/somehash/gems/sorbet-runtime-0.5.12164/lib/types/utils.rb:85:in 'T::Utils.run_all_sig_blocks'\n```\n\nSomehow Sorbet seems to be creating a duplicate singleton method _after_ (or when) we do. First, we need to replicate, which can probably be done with a simple signal like:\n\n```ruby\n    sig { void }\n    workflow_signal\n    def activate_program\n      # do something\n    end\n```\n\nUnderstand why Sorbet is adding singleton methods to our class and if we can avoid it. Second, solve. Worst case scenario we may have to detect the situation where it's Sorbet adding a method and ignore it.","closedAt":"2025-08-19T21:22:13Z","comments":[{"id":"IC_kwDOHI0NyM63NulE","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"We had created a similar issue for Sorbet at https://github.com/sorbet/sorbet/issues/8592. Basically they're doing singleton method stuff when decorating an instance method.","createdAt":"2025-07-15T14:22:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/292#issuecomment-3073829188","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM64J0uO","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"We have also created https://github.com/sorbet/sorbet/issues/9084 separately just in case it's not the exact same thing","createdAt":"2025-07-18T14:03:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/292#issuecomment-3089582990","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM6-3uK0","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Both of these issues are solved with recent Sorbet releases.","createdAt":"2025-08-19T21:22:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/292#issuecomment-3202278068","viewerDidAuthor":false}],"createdAt":"2025-06-27T21:10:49Z","labels":[{"id":"LA_kwDOHI0NyM7vFHIE","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":292,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Potential issue using runtime Sorbet and handlers","updatedAt":"2025-08-19T21:22:13Z","url":"https://github.com/temporalio/sdk-ruby/issues/292"}
