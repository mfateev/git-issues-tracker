{"assignees":[],"author":{"id":"MDQ6VXNlcjE3MTQ5MA==","is_bot":false,"login":"dipth","name":"Thomas Dippel"},"body":"### What are you really trying to do?\n\nThe `temporalio` gem fails to install.\n\n### Describe the bug\n\nInstalling the gem to a Rails application running in a Docker image by adding the following to `Gemfile`:\n\n```\ngem \"temporalio\", \"~> 0.4.0\"\n```\n\nresults in the following error message when running `bundle install`:\n\n```\nResolving dependencies...\nInstalling temporalio 0.4.0 with native extensions\nGem::Ext::BuildError: ERROR: Failed to build gem native extension.\n\n    error: failed to parse manifest at `/opt/bundle/ruby/3.4.0/gems/temporalio-0.4.0/ext/Cargo.toml`\n\nCaused by:\n  can't find library `temporalio_bridge`, rename file to `src/lib.rs` or specify lib.path\n```\n\n### Environment/Versions\n\n- Host OS processor: `M4 Mac OS 15.5 (24F74)`\n- Docker Image: `Linux 6.10.14-linuxkit #1 SMP Tue Apr 15 16:00:54 UTC 2025 aarch64 GNU/Linux`\n- Temporal Version: `1.3.0 (Server 1.27.1, UI 2.36.0)`\n- SDK Version: `0.4.0`\n- Ruby Version: `ruby 3.4.4 (2025-05-14 revision a38531fd3f) +PRISM [aarch64-linux]`\n- Rust Version: `rustc 1.87.0 (17067e9ac 2025-05-09)`","closedAt":"2025-06-26T12:18:57Z","comments":[{"id":"IC_kwDOHI0NyM6zKrxZ","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I think this is getting the source gem. This gem does not support building fro a source gem at this time (ref https://github.com/temporalio/sdk-ruby?tab=readme-ov-file#installation). I wonder why it is getting the source gem from https://rubygems.org/gems/temporalio/versions instead of the `aarch64-linux` one.\n\nCan you show the output of `bundle install --verbose`? Also can you show the output of `ruby -e 'puts RUBY_PLATFORM'` when running where you are installing?","createdAt":"2025-06-25T19:36:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/289#issuecomment-3005922393","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM6zToRv","author":{"login":"dipth"},"authorAssociation":"NONE","body":"```\n# => ruby -e 'puts RUBY_PLATFORM'\naarch64-linux\n```\n\n```\nRunning `bundle install --verbose` with bundler 2.5.11\nFound changes from the lockfile, re-resolving dependencies because the dependencies in your gemfile changed\n[...]\nInstalling temporalio 0.4.0 with native extensions\nBuilding native extensions. This could take a while...\nBundler::InstallError: Gem::Ext::BuildError: ERROR: Failed to build gem native extension.\n\n    error: failed to parse manifest at `/opt/bundle/ruby/3.4.0/gems/temporalio-0.4.0/ext/Cargo.toml`\n\nCaused by:\n  can't find library `temporalio_bridge`, rename file to `src/lib.rs` or specify lib.path\n\ncargo metadata failed, exit code 101\n\nGem files will remain installed in /opt/bundle/ruby/3.4.0/gems/temporalio-0.4.0 for inspection.\nResults logged to /opt/bundle/ruby/3.4.0/extensions/aarch64-linux/3.4.0/temporalio-0.4.0/gem_make.out\n\n  /usr/local/lib/ruby/3.4.0/rubygems/ext/cargo_builder.rb:225:in 'Gem::Ext::CargoBuilder#cargo_crate_name'\n  /usr/local/lib/ruby/3.4.0/rubygems/ext/cargo_builder.rb:31:in 'Gem::Ext::CargoBuilder#build'\n  /usr/local/lib/ruby/3.4.0/rubygems/ext/builder.rb:195:in 'Gem::Ext::Builder#build_extension'\n  /usr/local/lib/ruby/3.4.0/rubygems/ext/builder.rb:229:in 'block in Gem::Ext::Builder#build_extensions'\n  /usr/local/lib/ruby/3.4.0/rubygems/ext/builder.rb:226:in 'Array#each'\n  /usr/local/lib/ruby/3.4.0/rubygems/ext/builder.rb:226:in 'Gem::Ext::Builder#build_extensions'\n  /usr/local/lib/ruby/3.4.0/rubygems/installer.rb:844:in 'Gem::Installer#build_extensions'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/rubygems_gem_installer.rb:76:in 'Bundler::RubyGemsGemInstaller#build_extensions'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/rubygems_gem_installer.rb:28:in 'Bundler::RubyGemsGemInstaller#install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/source/rubygems.rb:206:in 'Bundler::Source::Rubygems#install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/gem_installer.rb:54:in 'Bundler::GemInstaller#install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/gem_installer.rb:16:in 'Bundler::GemInstaller#install_from_spec'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/parallel_installer.rb:132:in 'Bundler::ParallelInstaller#do_install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/parallel_installer.rb:123:in 'block in Bundler::ParallelInstaller#worker_pool'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/worker.rb:62:in 'Bundler::Worker#apply_func'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/worker.rb:57:in 'block in Bundler::Worker#process_queue'\n  <internal:kernel>:168:in 'Kernel#loop'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/worker.rb:54:in 'Bundler::Worker#process_queue'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/worker.rb:90:in 'block (2 levels) in Bundler::Worker#create_threads'\n\nAn error occurred while installing temporalio (0.4.0), and Bundler cannot continue.\n\nIn Gemfile:\n  temporalio\n\n/opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/parallel_installer.rb:166:in 'Bundler::ParallelInstaller#handle_error'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/parallel_installer.rb:96:in 'Bundler::ParallelInstaller#call'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer/parallel_installer.rb:66:in 'Bundler::ParallelInstaller.call'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer.rb:244:in 'Bundler::Installer#install_in_parallel'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer.rb:201:in 'Bundler::Installer#install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer.rb:89:in 'block in Bundler::Installer#run'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/process_lock.rb:12:in 'block in Bundler::ProcessLock.lock'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/process_lock.rb:9:in 'IO.open'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/process_lock.rb:9:in 'Bundler::ProcessLock.lock'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer.rb:71:in 'Bundler::Installer#run'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/installer.rb:23:in 'Bundler::Installer.install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/cli/install.rb:63:in 'Bundler::CLI::Install#run'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/cli.rb:247:in 'block in Bundler::CLI#install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/settings.rb:157:in 'Bundler::Settings#temporary'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/cli.rb:246:in 'Bundler::CLI#install'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/vendor/thor/lib/thor/command.rb:28:in 'Bundler::Thor::Command#run'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/vendor/thor/lib/thor/invocation.rb:127:in 'Bundler::Thor::Invocation#invoke_command'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/vendor/thor/lib/thor.rb:527:in 'Bundler::Thor.dispatch'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/cli.rb:35:in 'Bundler::CLI.dispatch'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/vendor/thor/lib/thor/base.rb:584:in 'Bundler::Thor::Base::ClassMethods#start'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/cli.rb:29:in 'Bundler::CLI.start'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/exe/bundle:28:in 'block in <top (required)>'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/lib/bundler/friendly_errors.rb:117:in 'Bundler.with_friendly_errors'\n  /opt/bundle/ruby/3.4.0/gems/bundler-2.5.11/exe/bundle:20:in '<top (required)>'\n  ./bin/bundle:108:in 'Kernel#load'\n  ./bin/bundle:108:in '<main>'\n```","createdAt":"2025-06-26T12:10:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/289#issuecomment-3008267375","viewerDidAuthor":false},{"id":"IC_kwDOHI0NyM6zTuKE","author":{"login":"dipth"},"authorAssociation":"NONE","body":"Adding `aarch64-linux` to the `PLATFORMS` section in `Gemfile.lock` seems to have solved the problem","createdAt":"2025-06-26T12:18:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-ruby/issues/289#issuecomment-3008291460","viewerDidAuthor":false}],"createdAt":"2025-06-25T10:05:24Z","labels":[{"id":"LA_kwDOHI0NyM7vFHIE","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":289,"reactionGroups":[],"state":"CLOSED","title":"[Bug] temporalio_bridge error when installing gem","updatedAt":"2025-06-26T12:18:57Z","url":"https://github.com/temporalio/sdk-ruby/issues/289"}
