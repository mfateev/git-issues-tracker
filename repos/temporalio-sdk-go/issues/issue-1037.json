{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNTA0MDQ5","is_bot":false,"login":"Quinn-With-Two-Ns","name":"Quinn Klassen"},"body":"## Expected Behavior\r\nThe call to work like it does in usual go code. The inverse does work in temporal ie calling a pointer receiver with a value type does work.\r\n\r\n## Actual Behavior\r\nPanic in the workflow\r\n```\r\n2023/02/13 08:16:28 ERROR Workflow panic Namespace default TaskQueue hello-world WorkerID 10319@Quinn-Klassens-MacBook-Pro.local@ WorkflowType Workflow WorkflowID hello_world_workflowID RunID 70d34349-a651-4924-b780-855af0c9ca6a Attempt 2 Error runtime error: invalid memory address or nil pointer dereference StackTrace coroutine root [panic]:\r\ngithub.com/temporalio/samples-go/helloworld.Workflow({0x1038a6860?, 0x14000362a50?}, {0x140000b0050, 0x8})\r\n        /Users/quinnklassen/Documents/Code/samples-go/helloworld/helloworld.go:23 +0xc4\r\nreflect.Value.call({0x1037740a0?, 0x103896c28?, 0x104398108?}, {0x10357a176, 0x4}, {0x14000362a80, 0x2, 0x10?})\r\n        /opt/homebrew/Cellar/go/1.19.3/libexec/src/reflect/value.go:584 +0x688\r\nreflect.Value.Call({0x1037740a0?, 0x103896c28?, 0x1400016fd18?}, {0x14000362a80?, 0x140001fa1c0?, 0x20?})\r\n        /opt/homebrew/Cellar/go/1.19.3/libexec/src/reflect/value.go:368 +0x90\r\ngo.temporal.io/sdk/internal.executeFunction({0x1037740a0, 0x103896c28}, {0x140001fa1c0, 0x2, 0x103e9faa0?})\r\n        /Users/quinnklassen/go/pkg/mod/go.temporal.io/sdk@v1.21.1/internal/internal_worker.go:1729 +0x140\r\ngo.temporal.io/sdk/internal.(*workflowEnvironmentInterceptor).ExecuteWorkflow(0x140003a8320, {0x1038a66d8?, 0x14000374300}, 0x1400019c600)\r\n        /Users/quinnklassen/go/pkg/mod/go.temporal.io/sdk@v1.21.1/internal/workflow.go:506 +0x14c\r\ngo.temporal.io/sdk/internal.(*workflowExecutor).Execute(0x1400029abc0, {0x1038a66d8, 0x14000374300}, 0x25?)\r\n        /Users/quinnklassen/go/pkg/mod/go.temporal.io/sdk@v1.21.1/internal/internal_worker.go:780 +0x238\r\ngo.temporal.io/sdk/internal.(*syncWorkflowDefinition).Execute.func1({0x1038a6860, 0x140003628d0})\r\n        /Users/quinnklassen/go/pkg/mod/go.temporal.io/sdk@v1.21.1/internal/internal_workflow.go:507 +0xd0\r\n```\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n```\r\nfunc Workflow(ctx workflow.Context, name string) (string, error) {\r\n\tao := workflow.ActivityOptions{\r\n\t\tStartToCloseTimeout: 10 * time.Second,\r\n\t}\r\n\tctx = workflow.WithActivityOptions(ctx, ao)\r\n\r\n\tvar result string\r\n\tvar a *ActivityStruct\r\n\t_ = workflow.ExecuteActivity(ctx, a.Activity, name).Get(ctx, &result)\r\n\treturn result, nil\r\n}\r\n\r\ntype ActivityStruct struct {\r\n}\r\n\r\nfunc (a ActivityStruct) Activity(ctx context.Context, name string) (string, error) {\r\n\tlogger := activity.GetLogger(ctx)\r\n\tlogger.Info(\"Activity\", \"name\", name)\r\n\treturn \"Hello \" + name + \"!\", nil\r\n}\r\n\r\n```\r\n## Specifications\r\n\r\n  - Version: 1.21\r\n  - Platform: M1 Mac\r\n","closedAt":null,"comments":[{"id":"IC_kwDODN1w685VIWFM","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I don't think you can fix this. That panic occurs before you have access. From spec at https://go.dev/ref/spec#Method_values:\r\n\r\n> As with [selectors](https://go.dev/ref/spec#Selectors), a reference to a non-interface method with a value receiver using a pointer will automatically dereference that pointer: pt.Mv is equivalent to (*pt).Mv.\r\n\r\nWhich of course is what causes the panic. There is an alternative in that we may be able to support `ActivityStruct.Activity` but that basically uncurries the first arg as the receiver which has other implications.","createdAt":"2023-02-13T16:32:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1037#issuecomment-1428250956","viewerDidAuthor":false},{"id":"IC_kwDODN1w685VIZGV","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Yeah I agree we can't fix it, the best we can do is add a check to the workflow checker for this. \r\n\r\n>There is an alternative in that we may be able to support ActivityStruct.Activity \r\n\r\nI actually like this approach because I see a lot users get confused about why they need to declare this empty struct when calling activities in a workflow. What are the other implications?","createdAt":"2023-02-13T16:40:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1037#issuecomment-1428263317","viewerDidAuthor":false},{"id":"IC_kwDODN1w685VIhnP","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> What are the other implications?\r\n\r\nIt is just a bit less clear to do with a pointer receiver. So we'll either have:\r\n\r\n> Use `var a *ActivityStruct` + `a.Activity` approach for pointer methods and `ActivityStruct.Activity` for non-pointer methods\r\n\r\nor\r\n\r\n> Use `(*ActivityStruct).Activity` for pointer methods or `ActivityStruct.Activity` for non-pointer methods\r\n\r\nBut it's probably OK. Also, you'll have to make some assumptions or do advanced checks, because reflection won't be able to tell the difference between: `func (ActivityStruct) Activity(context.Context)` and `func Activity(ActivityStruct, context.Context)` naively. You'll have to take the first param if it's not a context, check if there's a method of the same name, and maybe even use function pointer equality check to ensure it's a method and not a top-level function. But maybe you don't need to over-validate.","createdAt":"2023-02-13T16:59:36Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1037#issuecomment-1428298191","viewerDidAuthor":false}],"createdAt":"2023-02-13T16:21:14Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1037,"reactionGroups":[],"state":"OPEN","title":"Calling a value receiver method with a pointer type causes a panic when used through `ExecuteActivity`","updatedAt":"2023-02-13T17:02:57Z","url":"https://github.com/temporalio/sdk-go/issues/1037"}
