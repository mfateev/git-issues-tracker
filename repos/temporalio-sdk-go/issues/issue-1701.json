{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjQwMjc0","is_bot":false,"login":"cdimitroulas","name":"Christos Dimitroulas"},"body":"**Is your feature request related to a problem? Please describe.**\r\nIn order to be able to access spans from `workflow.Context` to be able to do things like add custom tags, it would be helpful if the `go.temporal.io/sdk/contrib/datadog/tracing` package exported `TracerSpan` and allowed setting a custom `SpanContextKey` in the tracer options.\r\n\r\nThis would enable code like the following to be written:\r\n```go\r\n// Assuming the following import:\r\n// import \t\"go.temporal.io/sdk/contrib/datadog/tracing\"\r\n\r\nval := ctx.Value(\"my_custom_context_key\")\r\nif val == nil {\r\n\treturn\r\n}\r\n\r\nspan := *val.(*tracing.TracerSpan)\r\nspan.SetTag(\"myCustomTag\", myCustomValue)\r\n```\r\n\r\n**Describe the solution you'd like**\r\ngo.temporal.io/sdk/contrib/datadog to export the TracerSpan struct (currently named `tracerSpan` so it isn't exported) and allow custom SpanContextKey in the `TracerOptions` struct.\r\n\r\nI have prepared some changes that solve this for my particular use-case which you can see here. Happy to open a PR if you agree that this feature makes sense for the library:\r\nhttps://github.com/temporalio/sdk-go/compare/master...cdimitroulas:temporal-sdk-go:christos/export-datadog-tracer-span-struct?expand=1\r\n\r\nThe customization of the context key is the same as what the OpenTelemetry tracing interceptor provides:\r\n- https://github.com/temporalio/sdk-go/blob/master/contrib/opentelemetry/tracing_interceptor.go#L80\r\n\r\n**Describe alternatives you've considered**\r\nI was not able to find an alternative solution that supports this use-case.\r\n\r\n**Additional context**\r\nN/A\r\n","closedAt":"2024-11-22T14:47:40Z","comments":[{"id":"IC_kwDODN1w686TVu1D","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"I think the feature ask here is totally resonable, I am not sure I agree with the approach. `tracerSpan` is an internal struct an not intended to be exposed. Really want you want to access is the underlying `ddtrace.Span`. The `datadog` API allows extracting the span from the `context` by calling `tracer.SpanFromContext`, the Temporal datadog interceptor could provide a similar API to extract the span from a `workflow.Context`. \r\n\r\nThat approach would make supporting a custom `SpanContextKey` difficult/impossible so the Temporal team still needs to discuss these tradeoffs.","createdAt":"2024-11-13T00:06:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1701#issuecomment-2471947587","viewerDidAuthor":false},{"id":"IC_kwDODN1w686ThRC6","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Discussion it seems like the preferred option is to add a function like `func SpanFromWorkflowContext(ctx workflow.Context) (Span, bool)` to https://github.com/temporalio/sdk-go/tree/master/contrib/datadog. That would allow you to get the datadog `Span` from a workflow function using a similar API to the activity.","createdAt":"2024-11-13T22:43:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1701#issuecomment-2474971322","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Tu8HO","author":{"login":"cdimitroulas"},"authorAssociation":"CONTRIBUTOR","body":"That makes sense, thanks for getting back to me and discussing with the team. Would you like me to take a stab at implementing this `SpanFromWorkflowContext` function @Quinn-With-Two-Ns?","createdAt":"2024-11-15T10:55:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1701#issuecomment-2478555598","viewerDidAuthor":false},{"id":"IC_kwDODN1w686TxrUe","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Sure, contributions always welcome!","createdAt":"2024-11-15T15:45:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1701#issuecomment-2479273246","viewerDidAuthor":false}],"createdAt":"2024-11-04T17:03:02Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1701,"reactionGroups":[],"state":"CLOSED","title":"go.temporal.io/sdk/contrib/datadog to provide way to access DataDog spans from within a workflow","updatedAt":"2024-11-22T14:47:40Z","url":"https://github.com/temporalio/sdk-go/issues/1701"}
