{"assignees":[],"author":{"id":"MDQ6VXNlcjkyMDc4NA==","is_bot":false,"login":"leowmjw","name":""},"body":"## Expected Behavior\r\n\r\nTestSuite should mimic actual behavior when workflow returns ApplicationError; which is to retry\r\n\r\n## Actual Behavior\r\n\r\nOnly one run happens, no retry\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nCode:\r\n```\r\nfunc (s *WorkflowTestSuiteUnitTest) Test_WorkflowRetry() {\r\n\ttrackFailure := 0\r\n\tworkflowFn := func(ctx Context) (string, error) {\r\n\t\ttrackFailure++\r\n\t\t// Happy path ..\r\n\t\tif trackFailure > 1 {\r\n\t\t\treturn \"s1s2\", nil\r\n\t\t}\r\n\t\treturn \"\", NewApplicationError(\"unlucky\", \"retry\", false, errors.New(\"try again\"))\r\n\t}\r\n\r\n\tenv := s.NewTestWorkflowEnvironment()\r\n\tenv.SetStartWorkflowOptions(StartWorkflowOptions{\r\n\t\tRetryPolicy: &RetryPolicy{\r\n\t\t\tInitialInterval: time.Second,\r\n\t\t\tMaximumAttempts: 5,\r\n\t\t},\r\n\t})\r\n\tenv.ExecuteWorkflow(workflowFn)\r\n\r\n\ts.True(env.IsWorkflowCompleted())\r\n\ts.NoError(env.GetWorkflowError())\r\n\tvar result string\r\n\t_ = env.GetWorkflowResult(&result)\r\n\ts.Equal(\"s1s2\", result)\r\n}\r\n\r\n```\r\n\r\nError:\r\n```\r\n=== RUN   TestUnitTestSuite/Test_WorkflowRetry\r\n    internal_workflow_testsuite_test.go:2670: \r\n        \tError Trace:\tinternal_workflow_testsuite_test.go:2670\r\n        \tError:      \tReceived unexpected error:\r\n        \t            \tworkflow execution error (type: func1, workflowID: default-test-workflow-id, runID: default-test-run-id): unlucky (type: retry, retryable: true): try again\r\n        \tTest:       \tTestUnitTestSuite/Test_WorkflowRetry\r\n\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: v1.8.0\r\n  - Platform: OSX\r\n","closedAt":null,"comments":[],"createdAt":"2021-07-17T23:41:38Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":491,"reactionGroups":[],"state":"OPEN","title":"Testsuite Workflow Retry not working","updatedAt":"2021-07-17T23:41:38Z","url":"https://github.com/temporalio/sdk-go/issues/491"}
