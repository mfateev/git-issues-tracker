{"assignees":[],"author":{"id":"MDQ6VXNlcjE3MzM1NTM=","is_bot":false,"login":"RamyElkest","name":"Ramy Elkest"},"body":"This is more of a request for information than a bug.\r\n\r\n## Expected Behavior\r\nReplaying a downloaded workflow history ending with workflow task (started) should not fail with a [[TMPRL1100] nondeterministic workflow: extra replay command](https://github.com/DataDog/sdk-go/blob/6580cbe0aa41a8b515791f95c2c15bb37db1dab1/internal/internal_task_handlers.go#L1200)\r\n\r\n## Actual Behavior\r\nReplaying a downloaded workflow history ending with workflow task (started) fails with an [[TMPRL1100] nondeterministic workflow: extra replay command](https://github.com/DataDog/sdk-go/blob/6580cbe0aa41a8b515791f95c2c15bb37db1dab1/internal/internal_task_handlers.go#L1200)\r\n\r\n## Steps to Reproduce the Problem\r\nReproducing test and detailed explanation: https://github.com/RamyElkest/sdk-go/pull/1\r\n\r\n## Specifications\r\n  - Version: `v1.26.0`\r\n  - Platform: `v1.23.1`\r\n","closedAt":"2025-02-03T21:32:24Z","comments":[{"id":"IC_kwDODN1w686PsoeW","author":{"login":"RamyElkest"},"authorAssociation":"NONE","body":"> Solution\r\nThe proposed solution here is to trim scheduled/started/completed workflow tasks with no follow-up events, this guarantees the workflow history is in a safely replayable state. For this there are three approaches:\r\n> 1. Trim the history in GetWorkflowHistory (to be discussed with upstream)\r\n> 2. Trim the history in our code before passing it to the Replayer\r\n> 3. Trim the history in the Replayer (to be discussed with upstream)\r\n\r\nCurious if you have any thoughts / preferences here.","createdAt":"2024-10-14T10:48:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1670#issuecomment-2410842006","viewerDidAuthor":false},{"id":"IC_kwDODN1w686P4qdv","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks for the report! Will confer with the team on replaying of mid-task history captures. While it makes sense to only replay up to the last completed or failed task, we may need to double check that people aren't running replays on the active task without the task failure to replicate failures (e.g. to replicate deadlock detection).","createdAt":"2024-10-15T13:56:32Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1670#issuecomment-2413995887","viewerDidAuthor":false},{"id":"IC_kwDODN1w686QHiCH","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Conferred with team, we consider this a bug. If we are in fact failing a replay with history that should succeed, we need to fix. It is likely we should not be performing history matching for non-determinism checks after the last task start (that doesn't have an end). This issue will be updated when we have a solution.","createdAt":"2024-10-16T20:32:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1670#issuecomment-2417893511","viewerDidAuthor":false}],"createdAt":"2024-10-14T10:44:33Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1670,"reactionGroups":[],"state":"CLOSED","title":"Erroneous extra replay command when replaying mid-workflow tasks","updatedAt":"2025-02-03T21:32:24Z","url":"https://github.com/temporalio/sdk-go/issues/1670"}
