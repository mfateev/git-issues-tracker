{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTg3MTAz","is_bot":false,"login":"yuandrew","name":"Andrew Yuan"},"body":"## Expected Behavior\n\nNo messages get lost\n\n## Actual Behavior\n\nMessages are getting lost. This bug was introduced in 1.35.0, from #1762\n\n\n## Steps to Reproduce the Problem\nSetting `unblockSelectorSignal` to `true` causes the lost items \n\n```\nfunc (s *WorkflowTestSuiteUnitTest) TestChannelWorkerPattern() {\n\tunblockSelectorSignal = true // test passes when set to false\n\n\tassert := s.Assert()\n\trequire := s.Require()\n\n\t// Test configuration\n\tnumWorkers := 10\n\tnumItems := 50\n\titems := make([]int, numItems)\n\tfor i := 0; i < numItems; i++ {\n\t\titems[i] = i\n\t}\n\t// Track which items were processed\n\tprocessedItems := make(map[int]int) // maps input -> output\n\t// Simple workflow that mimics the channel worker pattern\n\tworkflowFn := func(ctx Context) error {\n\t\t// Create input channel and feed items\n\t\tinputCh := NewChannel(ctx)\n\t\tGo(ctx, func(ctx Context) {\n\t\t\tfor _, item := range items {\n\t\t\t\tinputCh.Send(ctx, item)\n\t\t\t}\n\t\t\tinputCh.Close()\n\t\t})\n\n\t\t// Start workers\n\t\toutputCh := NewChannel(ctx)\n\t\twg := NewWaitGroup(ctx)\n\t\twg.Add(numWorkers)\n\t\t// Wait group cleanup goroutine\n\t\tGo(ctx, func(ctx Context) {\n\t\t\twg.Wait(ctx)\n\t\t\toutputCh.Close()\n\t\t})\n\t\t// Start worker goroutines\n\t\tfor i := 0; i < numWorkers; i++ {\n\t\t\tGo(ctx, func(ctx Context) {\n\t\t\t\tdefer wg.Done()\n\t\t\t\tstop := false\n\t\t\t\tselector := NewSelector(ctx)\n\t\t\t\t// Stop worker if workflow is cancelled\n\t\t\t\tselector.AddReceive(ctx.Done(), func(c ReceiveChannel, more bool) {\n\t\t\t\t\tstop = true\n\t\t\t\t})\n\t\t\t\t// Receive items from input channel\n\t\t\t\tselector.AddReceive(inputCh, func(ch ReceiveChannel, more bool) {\n\t\t\t\t\tstop = !more\n\t\t\t\t\tvar input int\n\t\t\t\t\tif ch.Receive(ctx, &input) {\n\t\t\t\t\t\toutput := input * 2\n\t\t\t\t\t\toutputCh.Send(ctx, output)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// Worker loop\n\t\t\t\tfor !stop {\n\t\t\t\t\tselector.Select(ctx)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\t// Collect outputs\n\t\tfor i := 0; i < numItems; i++ {\n\t\t\tvar output int\n\t\t\tif outputCh.Receive(ctx, &output) {\n\t\t\t\t// output = input * 2, so input = output / 2\n\t\t\t\tprocessedItems[output/2] = output\n\t\t\t}\n\t\t}\n\t\treturn nil\n\t}\n\tenv := s.NewTestWorkflowEnvironment()\n\tenv.RegisterWorkflow(workflowFn)\n\tenv.ExecuteWorkflow(workflowFn)\n\n\trequire.True(env.IsWorkflowCompleted())\n\trequire.NoError(env.GetWorkflowError())\n\n\t// Verify all items were processed exactly once\n\trequire.Len(processedItems, numItems, \"Not all items were processed\")\n\tfor i := 0; i < numItems; i++ {\n\t\toutput, ok := processedItems[i]\n\t\tassert.True(ok, \"Item %d was not processed\", i)\n\t\tassert.Equal(i*2, output, \"Item %d was not processed correctly\", i)\n\t}\n}\n```\n\n## Specifications\n\n  - Version: 1.35.0\n  - Platform:\n","closedAt":null,"comments":[{"id":"IC_kwDODN1w687JY9Ax","author":{"login":"yuandrew"},"authorAssociation":"MEMBER","body":"Looks like Test_SignalNotLost did not start failing when reverting the default SDK flag. Either something might be wrong with the test or the test itself may not be useful","createdAt":"2025-10-07T21:20:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/2066#issuecomment-3378761777","viewerDidAuthor":false},{"id":"IC_kwDODN1w687R-0Ig","author":{"login":"yuandrew"},"authorAssociation":"MEMBER","body":"Technically not an issue anymore, due to us reverting the SDK flag, but this will need to be addressed when re-enabling the flag","createdAt":"2025-11-12T16:49:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/2066#issuecomment-3522904608","viewerDidAuthor":false},{"id":"IC_kwDODN1w687Y3Czm","author":{"login":"yuandrew"},"authorAssociation":"MEMBER","body":"This turns out to be a new bug created from my fixing of the linked bug.","createdAt":"2025-12-10T17:57:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/2066#issuecomment-3638308070","viewerDidAuthor":false}],"createdAt":"2025-10-02T22:19:14Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":2066,"reactionGroups":[],"state":"OPEN","title":"Lost messages from workflow.NewChannel(ctx)","updatedAt":"2025-12-10T17:57:23Z","url":"https://github.com/temporalio/sdk-go/issues/2066"}
