{"assignees":[],"author":{"id":"MDQ6VXNlcjEwMTkz","is_bot":false,"login":"gsmcwhirter","name":"Gregory McWhirter"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nI'd like to use go:embed to access replay history files in the repository for testing. However, the current replay API seems to require me parsing the contents into a history object myself or not using go:embed and using a static file name instead.\r\n\r\n**Describe the solution you'd like**\r\n\r\nAdd `ReplayWorkflowHistoryFromReader(logger log.Logger, jsonFile io.Reader) error` and `ReplayPartialWorkflowHistoryFromReader(logger log.Logger, jsonfile io.Reader, lastEventID int64) error` (or similar) to the `WorkflowReplayer` interface and implementations. \r\n\r\n**Describe alternatives you've considered**\r\n\r\n\r\n**Additional context**\r\nAdding these APIs could also enable other future uses where replay histories were stored on a remote server, or stored gzipped, etc.\r\n","closedAt":"2022-06-30T11:24:55Z","comments":[{"id":"IC_kwDODN1w685DOYss","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"In retrospect I think we regret even having a file-reader call. Basically all you need is to take the JSON and `github.com/gogo/protobuf/jsonpb.Unmarshal` into a `go.temporal.io/api/history/v1.History` proto, then you can call `ReplayWorkflowHistory` directly.\r\n\r\nIs this an acceptable solution for you?","createdAt":"2022-05-16T15:52:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127844652","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DOZ3z","author":{"login":"gsmcwhirter"},"authorAssociation":"NONE","body":"From a test-writing perspective, it would be nice to not have to care about how to unmarshal the replay and just hand off the bytes to the replayer to figure out. \r\n\r\nAs a temporary workaround, your suggestion would probably work, at least for the non-partial case. In the partial case, putting the logic around extracting the part of the history to work with outside the go sdk seems brittle.","createdAt":"2022-05-16T15:57:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127849459","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DObIM","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Would a helper `func HistoryFromJSON(b []byte) (*history.History, error)` work? I am trying not to alter the interface and were I not concerned with backwards compatibility, I would also remove the file-based functions from the replayer interface.","createdAt":"2022-05-16T16:02:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127854604","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DOb2R","author":{"login":"gsmcwhirter"},"authorAssociation":"NONE","body":"A helper that took an `io.Reader` and maybe a `lastEventID` parameter instead of just `[]byte` would be more helpful I think, but `[]byte` could be made to work as well\r\n","createdAt":"2022-05-16T16:05:26Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127857553","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DOf9r","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Ok, I will use reader. The amount is expected to fit in memory anyways, so a reader isn't really necessary, but anyone can do `bytes.NewReader` if they want. I will also provide a \"partial\" form which accepts the last event ID though it's rare for people to use that (anyone can also trim off the events slice in the result themselves).","createdAt":"2022-05-16T16:20:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127874411","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DOg0t","author":{"login":"gsmcwhirter"},"authorAssociation":"NONE","body":"I personally haven't had a need to use partial replays yet, so if they're really not common, maybe it is enough for a user to trim down on their own. I do know that looking into the code for how the current versions work, it wasn't super clear to me how to slice history structure appropriately if there wasn't that example hanging around.","createdAt":"2022-05-16T16:23:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127877933","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DOhbm","author":{"login":"gsmcwhirter"},"authorAssociation":"NONE","body":"Also if the data is really that small, maybe `[]byte` is fine. From my reading, histories could get to something like 50k events before there's issues, which seems like it might be a decent bit of memory, but perhaps the expansion to actual memory size isn't as large as I imagine","createdAt":"2022-05-16T16:25:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127880422","viewerDidAuthor":false},{"id":"IC_kwDODN1w685DOk-T","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"It has to sit in the actual proto object anyways, which often takes more space than the serialized form (e.g. proto integers are variable length, false bools take no space, etc). But I'll use reader anyways.","createdAt":"2022-05-16T16:40:08Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/808#issuecomment-1127894931","viewerDidAuthor":false}],"createdAt":"2022-05-16T15:47:00Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":808,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Add ReplayWorkflowHistoryFromReader (or similar)","updatedAt":"2022-06-30T11:24:55Z","url":"https://github.com/temporalio/sdk-go/issues/808"}
