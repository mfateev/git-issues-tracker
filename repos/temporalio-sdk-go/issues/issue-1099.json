{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNTA0MDQ5","is_bot":false,"login":"Quinn-With-Two-Ns","name":"Quinn Klassen"},"body":"## Expected Behavior\r\nWorkflows that timeout from `TestWorkflowEnvironment.SetWorkflowRunTimeout` run `deferred` statements\r\n\r\n## Actual Behavior\r\nWorkflows that timeout from the real server do not run `defer` statements\r\n\r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDODN1w685bgrHu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Hrmm, I don't think this is possible in Go without leaking goroutines/memory. Panic and runtime.Goexit both call `defer`. You can't exit a function without calling defer in any way that I can think of. I'd be curious to know how we do cache eviction and if we run defer then and just discard commands. Seems likely. But it may be a big effort to discard everything instead of running mocks here, unsure.","createdAt":"2023-05-04T19:25:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1099#issuecomment-1535291886","viewerDidAuthor":false}],"createdAt":"2023-05-04T16:23:56Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1099,"reactionGroups":[],"state":"OPEN","title":"TestWorkflowEnvironment timeouts run defer statements","updatedAt":"2023-05-04T19:28:11Z","url":"https://github.com/temporalio/sdk-go/issues/1099"}
