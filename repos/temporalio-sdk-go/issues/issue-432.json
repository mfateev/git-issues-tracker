{"assignees":[{"id":"MDQ6VXNlcjEzMTE2OTQ=","login":"vitarb","name":"Vitali","databaseId":0}],"author":{"id":"MDQ6VXNlcjI0Njg0Nzcx","is_bot":false,"login":"DannyHinshaw","name":"Danny Hinshaw"},"body":"## Expected Behavior\r\n\r\nWhen an Activity tries to return a non-serializable type (such as an `error`), an error should be presented in the worker logs.\r\n\r\n## Actual Behavior\r\n\r\nCurrently the error is not output to logs, however it is possible to discover the issue by visiting the Temporal web app and inspect the Workflow execution history.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Return a struct with an `error` type attached to it from an Activity (make sure the response is an error and not `nil`).\r\n  1. See the Workflow fails\r\n  1. See there is no logging output in the worker logs.\r\n  \r\n  If you wish, I made a repo with a branch to repro this issue here: https://github.com/DannyHinshaw/go-temporal-sandbox/tree/issue/bad-json-silent-failure\r\n  You can clone that, run `docker-compose up -d` and then hit the endpoint `GET http://localhost:8080/workflow` to trigger a workflow that shows the issue. From there you can inspect the system logs and Temporal web app.","closedAt":"2021-06-15T04:29:31Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgzNjI4OTgxMw==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"Thanks for reporting this issue, failing silently definitely doesn't sound right, we'll take a look at it!","createdAt":"2021-05-10T07:23:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/432#issuecomment-836289813","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg1OTE2NTUxOQ==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"I've debugged this a bit and it looks like the problem is with default json converter, that returns no error if you marshal a struct with an error field into json, but then fails to unmarshal it back. This happens because error is an interface and serializer ends up having this confusing behavior.\r\n\r\nConsider following test code (passes):\r\n```\r\n\r\n\tpc := NewJSONPayloadConverter()\r\n\r\n\twt := testStructWithError{Name: \"qwe\", Error: errors.New(\"some error\")}\r\n\tpayload, err := pc.ToPayload(wt)\r\n\trequire.NoError(t, err) // Should this be an error since it's impossible to deserialize?\r\n\r\n\tvar deserialized testStructWithError\r\n\terr = pc.FromPayload(payload, &deserialized)\r\n\trequire.Error(t, err)\r\n\tassert.Equal(t, \"unable to decode: json: cannot unmarshal object into Go struct field testStructWithError.Error of type error\", err.Error())\r\n```\r\n\r\nSerialized data in this case would be:\r\n`{\"Name\":\"qwe\",\"Error\":{}}`\r\n\r\nThe reason why this doesn't produce any message when you complete an activity is because underlying json serializer succeeds and we successfully send bytes back to the server, and we get a failure only when we try to process subsequent workflow task, which fails to deserialize the payload. I'm not sure if there is a good general solution to this issue, I want to understand if this is considered a bug in the json serializer's behavior.\r\n\r\nYou may read through [this article](http://gregtrowbridge.com/golang-json-serialization-with-interfaces/) which provides some details about how to handle json serialization with interfaces (you may need to create your own type and define Marshal/Unmarshall Json functions).\r\n\r\nI don't know why authors of the json serializer decided that this behavior is optimal, but it doesn't look like something that we would be able to change. \r\n\r\nWe should also consider making [our documentation](https://docs.temporal.io/docs/go/activities#implementation) more clear about this case.","createdAt":"2021-06-11T00:05:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/432#issuecomment-859165519","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg2MTE2MDA1Nw==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"I'm going to resolve this issue for now, please reopen if you have more questions or find response unsatisfactory.","createdAt":"2021-06-15T04:29:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/432#issuecomment-861160057","viewerDidAuthor":false}],"createdAt":"2021-05-06T18:41:01Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":432,"reactionGroups":[],"state":"CLOSED","title":"JSON Serialization Errors From Activity Responses Fail Silently","updatedAt":"2021-06-15T04:29:31Z","url":"https://github.com/temporalio/sdk-go/issues/432"}
