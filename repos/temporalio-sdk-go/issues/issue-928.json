{"assignees":[],"author":{"id":"MDQ6VXNlcjE0MzYxNDg4","is_bot":false,"login":"muralisrini","name":""},"body":"## Expected Behavior\r\nThe delay between Scheduled Workflow task and actual start of the workflow should be quite small. It certainly should _not_ be order of a minute.\r\n\r\n## Actual Behavior\r\nWhen running multiple workflows in a loop see some of workflows waiting for a long time in scheduled state (order of a minute) before starting. For example from temporals Web UI:\r\n\r\n![image](https://user-images.githubusercontent.com/14361488/194949790-58ac7409-208a-4673-90b8-b26335f38753.png)\r\n\r\nThat task was scheduled at 17:07:28:35 and ran at 17:08:28:12.\r\n\r\nThis was seen with a modified [Mutex Sample](https://github.com/temporalio/samples-go/tree/main/mutex). See Steps below for details please.\r\n\r\nFew points:\r\n\r\n-  As mentioned, this does not happen with all workflows\r\n- We could not recreate with the Java SDK doing the equivalent of the Mutex Sample (in clojure actually)\r\n- We tried to keep close to the sample to avoid introducing extraneous parameters but it is possible some tweaks to the sample are required to run correctly. Having said that, we did try adding more parameters (such as `MaxConcurrentActivityTaskPollers`) to no avail.\r\n- While the recreate uses `temporalite`,  we first saw the problem in `temporal` service deployment.\r\n\r\nThere is also some discussion on the forum : https://community.temporal.io/t/delay-in-scheduling-a-workflow/5996\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nSetup \r\n  1. Pull https://github.com/muralisrini/samples-go/tree/mutex_add_workflows\r\n  2. cd to the `mutex/worker` directory and `go build`\r\n  3. cd to the `mutex/starter` directory and `go build`\r\n  4. run `./temporalite start --namespace default` \r\n  5. run `worker/worker`  # call this **Worker window**\r\n  \r\nStart\r\n\r\n1. run `starter/starter` # call this  **Starter window**\r\n\r\nThe starter runs the original starter code with 2 workflows -  but in a loop of 8 to make 18 works in total. You should see the \"Worker Window\" stall for a long time for some workflows. The Web UI should show delays similar to the one in the picture above.\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: v0.17.0\r\n  - Platform: Ubuntu\r\n","closedAt":"2025-02-04T18:27:24Z","comments":[{"id":"IC_kwDODN1w685QZ14m","author":{"login":"muralisrini"},"authorAssociation":"NONE","body":"Anyone take a look at this ?","createdAt":"2022-12-13T16:17:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1348951590","viewerDidAuthor":false},{"id":"IC_kwDODN1w685QdfTf","author":{"login":"tsurdilo"},"authorAssociation":"MEMBER","body":"I believe this is due to your starter explicitly waiting on workflow completion which would block on the lock:\r\n\r\nhttps://github.com/muralisrini/samples-go/blob/mutex_add_workflows/mutex/starter/main.go#L52-L60\r\n\r\nIf you remove this (start executions async and dont wait for result) you should not see the delay you are explaining in this issue","createdAt":"2022-12-13T22:29:13Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1349907679","viewerDidAuthor":false},{"id":"IC_kwDODN1w685QlpMs","author":{"login":"manetumatt"},"authorAssociation":"NONE","body":"I am seeing this issue as well without the start executions waiting for results at all.   The worker seems to stall/stop receiving tasks under certain conditions outlined here.  I have observed the following:\r\n\r\n- as long as a particular taskQueue is kept busy no delay will happen\r\n- when a taskQueue becomes empty and additional workflows are then submitted, the delay will be experienced \r\n- nothing seems to process for approx. 1m from the time the taskQueue becomes empty\r\n- during delay condition - If worker is stopped and restarted, workflows immediately start processing again\r\n- if multiple workers are servicing a taskQueue, delay will not happen\r\n\r\nI have reproduced this with simple changes to the mutex sample:\r\n\r\nstarter/main.go\r\n[https://github.com/manetumatt/samples-go/blob/debug1/mutex/starter/main.go](url)\r\n\r\nI also shortened the critical section delay to 500ms:\r\n\r\nmutex_workflow.go\r\n[https://github.com/manetumatt/samples-go/blob/debug1/mutex/mutex_workflow.go#L208](url)\r\n\r\nThis sample code executes 5 workflows which start processing immediately.  The code then sleeps for 10 seconds and then executes a second set of 5 workflows.  The second set will not start processing for nearly a minute.\r\n\r\n\r\n\r\n\r\n","createdAt":"2022-12-14T19:35:44Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1352045356","viewerDidAuthor":false},{"id":"IC_kwDODN1w685QmeMa","author":{"login":"tsurdilo"},"authorAssociation":"MEMBER","body":"Thanks for update. Can you share the server version you are running against?","createdAt":"2022-12-14T21:56:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1352262426","viewerDidAuthor":false},{"id":"IC_kwDODN1w685QmrZd","author":{"login":"manetumatt"},"authorAssociation":"NONE","body":"Thank you for the quick reply.  First encountered the issues against v1.18.0.  Switched to Temporalite v0.3.0 (server 1.19.0 I think) for local debugging and testing.  Saw the worker stall issue against both backends.\r\n\r\nfrom Temporalite:\r\n`(base) mltmbp:samples mtaylor$ tctl adm cl d\r\n{\r\n  \"supportedClients\": {\r\n    \"temporal-cli\": \"\\u003c2.0.0\",\r\n    \"temporal-go\": \"\\u003c2.0.0\",\r\n    \"temporal-java\": \"\\u003c2.0.0\",\r\n    \"temporal-php\": \"\\u003c2.0.0\",\r\n    \"temporal-server\": \"\\u003c2.0.0\",\r\n    \"temporal-typescript\": \"\\u003c2.0.0\",\r\n    \"temporal-ui\": \"\\u003c3.0.0\"\r\n  },\r\n  \"serverVersion\": \"1.19.0\",\r\n  \"membershipInfo\": {\r\n    \"currentHost\": {\r\n      \"identity\": \"127.0.0.1:7233\"`","createdAt":"2022-12-14T22:40:02Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1352316509","viewerDidAuthor":false},{"id":"IC_kwDODN1w685ZufBk","author":{"login":"manetumatt"},"authorAssociation":"NONE","body":"Still seeing this issue with latest version.  Anyone had a chance to look at this?","createdAt":"2023-04-12T14:15:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1505357924","viewerDidAuthor":false},{"id":"IC_kwDODN1w685iaPGN","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"I believe this is fixed by https://github.com/temporalio/temporal/pull/4562, which is included in server 1.21.1 and above. Please try the latest server version and see if you can still reproduce it.","createdAt":"2023-07-26T06:16:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-1651044749","viewerDidAuthor":false},{"id":"IC_kwDODN1w686dCxb9","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Closing as this was a support issue that appears resolved ","createdAt":"2025-02-04T18:27:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/928#issuecomment-2634749693","viewerDidAuthor":false}],"createdAt":"2022-10-10T21:25:19Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":928,"reactionGroups":[],"state":"CLOSED","title":"Delay in starting a scheduled workflow","updatedAt":"2025-02-04T18:27:26Z","url":"https://github.com/temporalio/sdk-go/issues/928"}
