{"assignees":[{"id":"MDQ6VXNlcjI3NTk0Nw==","login":"mmcshane","name":"Matt McShane","databaseId":0}],"author":{"id":"MDQ6VXNlcjI3NTk0Nw==","is_bot":false,"login":"mmcshane","name":"Matt McShane"},"body":"## Expected Behavior\r\nAn update should be accepted (or rejected) exactly once\r\n\r\n## Actual Behavior\r\nIf a workflow replays due to something like a worker crash while there is an update in-flight, we don't re-run the validator for the update but we _do_ call Accept() on the update state machine. That leads to an update.Acceptance message being sent on the WFTCompleted which is duly made durable into the history by the server.\r\n\r\nNote that one might consider the fact that the server doesn't catch the mistake to _also_ be a bug. That will be covered with a separate issue. \r\n\r\n## Steps to Reproduce the Problem\r\n\r\nThere will be a test in temporalio/features for this (it's how the problem was found in the first place). The general flow is:\r\n\r\n1. Start a workflow with separate activity and workflow workers\r\n1. Start an update that itself launches an activity\r\n1. Block in the activity\r\n1. Stop or otherwise kill the workflow worker\r\n1. Unblock the blocked activity\r\n1. Start the workflow worker again\r\n1. Observe that the workflow replays to rebuild state but that the incorrect extra UpdateAccepted event is added to the history. This history will not replay correctly.\r\n\r\n## Specifications\r\n\r\n  - Version: v1.21\r\n  - Platform: all\r\n","closedAt":"2023-03-17T16:41:05Z","comments":[{"id":"IC_kwDODN1w685X3STD","author":{"login":"mmcshane"},"authorAssociation":"CONTRIBUTOR","body":"Closed by #1059 ","createdAt":"2023-03-17T16:41:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1057#issuecomment-1474110659","viewerDidAuthor":false}],"createdAt":"2023-03-09T21:19:39Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1057,"reactionGroups":[],"state":"CLOSED","title":"Double Update Accepted Event Due to Replay","updatedAt":"2023-03-17T16:41:05Z","url":"https://github.com/temporalio/sdk-go/issues/1057"}
