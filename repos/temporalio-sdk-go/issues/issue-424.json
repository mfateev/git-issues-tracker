{"assignees":[{"id":"MDQ6VXNlcjUxNzY4Mw==","login":"Sushisource","name":"Spencer Judge","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"## Expected Behavior\r\n```go\r\n\tvar a *Activities\r\n\r\n\tvar greetResult string\r\n\terr := workflow.ExecuteLocalActivity(ctx, a.GetGreeting).Get(ctx, &greetResult)\r\n```\r\nshould work the same way it works for normal activities.\r\n\r\n## Actual Behavior\r\n```\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x18d07a4]\r\n\r\ngoroutine 70 [running]:\r\ngithub.com/temporalio/samples-go/greetings.(*Activities).GetGreeting(...)\r\n        /Users/maxim/temporal/temporal-go-samples/greetings/activities.go:17\r\nreflect.Value.call(0x19454c0, 0xc000165910, 0x13, 0x1a72c0b, 0x4, 0x0, 0x0, 0x0, 0x203000, 0x203000, ...)\r\n        /usr/local/go/src/reflect/value.go:476 +0x8c7\r\nreflect.Value.Call(0x19454c0, 0xc000165910, 0x13, 0x0, 0x0, 0x0, 0x100f5f0, 0xc000588790, 0x10)\r\n        /usr/local/go/src/reflect/value.go:337 +0xb9\r\ngo.temporal.io/sdk/internal.(*activityExecutor).executeWithActualArgsWithoutParseResult(0xc0005c2720, 0x1b801c0, 0xc000598ae0, 0x0, 0x0, 0x0, 0xc0005c09c0, 0x1b801c0, 0xc000598ae0)\r\n        /Users/maxim/go/pkg/mod/go.temporal.io/sdk@v1.6.0/internal/internal_worker.go:830 +0x24a\r\ngo.temporal.io/sdk/internal.(*activityExecutor).ExecuteWithActualArgs(0xc0005c2720, 0x1b801c0, 0xc000598ae0, 0x0, 0x0, 0x0, 0x20a66c0, 0x202c7a9, 0xb)\r\n        /Users/maxim/go/pkg/mod/go.temporal.io/sdk@v1.6.0/internal/internal_worker.go:804 +0x70\r\ngo.temporal.io/sdk/internal.(*localActivityTaskHandler).executeLocalActivityTask.func2(0x1b801c0, 0xc000598ae0, 0xc0004340e0, 0xc0005aaf00, 0xc0005c2720, 0xc00058c0d0, 0xc000588770, 0x1b88180, 0xc0005a2600, 0x2540be400, ...)\r\n        /Users/maxim/go/pkg/mod/go.temporal.io/sdk@v1.6.0/internal/internal_task_pollers.go:563 +0x185\r\ncreated by go.temporal.io/sdk/internal.(*localActivityTaskHandler).executeLocalActivityTask\r\n        /Users/maxim/go/pkg/mod/go.temporal.io/sdk@v1.6.0/internal/internal_task_pollers.go:559 +0xa45\r\n\r\nProcess finished with the exit code 2\r\n```\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nTake the greetings sample and change it to use local activities instead of the normal ones.\r\n\r\n","closedAt":"2021-05-12T18:42:50Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgzMjMwNTUxNw==","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"Looks like https://github.com/temporalio/sdk-go/issues/405","createdAt":"2021-05-04T23:10:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/424#issuecomment-832305517","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgzMjMyOTU3OQ==","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"@mfateev I don't think this can be fixed without a pretty big change in how local activities work. The problem seems to be if you pass a \"method value\" like `a.GetGreeting` there is no way to use reflection or anything else to access the receiver pointer, so we can't check that it's nil and assign it to a default (which still strikes me as a weird thing to do anyway).\r\n\r\nWe could instead look up the function name, and see if the activity struct has been registered and call it that way, but the problem is since we only know that a function was passed in, and we can't know about the receiver, the function looks valid and like we should try to call it rather than look it up in the registry, at which point it's too late.\r\n\r\nSo, I think we should just advise people to either initialize structs if they call this way (easiest by far), or to not do this at all, and instead call by string.\r\n\r\nTechnically we could also allow calling by \"method expression\", like `(*Activities).GetGreeting` but... not sure anyone cares.","createdAt":"2021-05-04T23:58:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/424#issuecomment-832329579","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg0MDAxMzg3Mw==","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"Should be fixed by #436 ","createdAt":"2021-05-12T18:42:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/424#issuecomment-840013873","viewerDidAuthor":false}],"createdAt":"2021-04-30T17:16:22Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":424,"reactionGroups":[],"state":"CLOSED","title":"Invocation of struct local activities is broken.","updatedAt":"2021-05-12T18:42:50Z","url":"https://github.com/temporalio/sdk-go/issues/424"}
