{"assignees":[],"author":{"id":"MDQ6VXNlcjQyNzM0OTA=","is_bot":false,"login":"koolay","name":"koolay"},"body":"## Expected Behavior\r\n\r\nCronJob works ok.\r\n\r\n## Actual Behavior\r\n\r\n`deadlock detected: workflow goroutine \"root\" didn't yield for over a second`\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n**Start workflow**\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"log\"\r\n\t\"time\"\r\n\r\n\t\"github.com/koolay/temporal-quickstart/pkg/workflows\"\r\n\t\"go.temporal.io/sdk/client\"\r\n\tclientSdk \"go.temporal.io/sdk/client\"\r\n)\r\n\r\nvar serverHost = \"localhost:7233\"\r\n\r\nfunc main() {\r\n\tclient, err := client.NewClient(client.Options{\r\n\t\tHostPort: serverHost,\r\n\t})\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"unable to create temporal client\", err)\r\n\t}\r\n\tdefer client.Close()\r\n\r\n\toptions := clientSdk.StartWorkflowOptions{\r\n\t\tID:                       workflows.CronWorkflowID,\r\n\t\tTaskQueue:                workflows.CronQueueName,\r\n\t\tCronSchedule:             \"@every 10s\",\r\n\t\tWorkflowRunTimeout:       5 * time.Second,\r\n\t\tWorkflowExecutionTimeout: 10 * time.Second,\r\n\t}\r\n\r\n\trunning, err := client.ExecuteWorkflow(context.Background(), options, workflows.CronWorkflow)\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"unable to start cron workflow\", err)\r\n\t}\r\n\r\n\tlog.Println(\"execute workflow:\", running.GetID(), running.GetRunID())\r\n}\r\n\r\n```\r\n\r\n`workflow`\r\n\r\n```go\r\nfunc CronWorkflow(ctx workflow.Context) error {\r\n\ttime.Sleep(time.Second)\r\n\tworkflow.GetLogger(ctx).Info(\"Cron workflow started.\", \"StartTime\", workflow.Now(ctx))\r\n\treturn nil\r\n}\r\n\r\n```\r\n\r\n**Run worker**\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"log\"\r\n\r\n\t\"github.com/koolay/temporal-quickstart/pkg/workflows\"\r\n\t\"go.temporal.io/sdk/client\"\r\n\t\"go.temporal.io/sdk/worker\"\r\n)\r\n\r\nvar serverHost = \"localhost:7233\"\r\n\r\nfunc main() {\r\n\t// The client and worker are heavyweight objects that should be created once per process.\r\n\tclient, err := client.NewClient(client.Options{\r\n\t\tHostPort:  serverHost,\r\n\t\tNamespace: \"default\",\r\n\t})\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"Unable to create client\", err)\r\n\t}\r\n\r\n\tdefer client.Close()\r\n\r\n\tw := worker.New(client, \"cron\", worker.Options{})\r\n\r\n\tw.RegisterWorkflow(workflows.CronWorkflow)\r\n\r\n\terr = w.Run(worker.InterruptCh())\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"Unable to start worker\", err)\r\n\t}\r\n}\r\n\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version:1.14.0\r\n  - Platform:docker\r\n","closedAt":"2022-04-12T13:17:01Z","comments":[{"id":"IC_kwDODN1w685BXo7G","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"You cannot sleep in workflows using `time.Sleep`. Please see https://docs.temporal.io/docs/go/how-to-develop-a-workflow-definition-in-go#workflow-logic-requirements-in-go and the documentation at the top of https://pkg.go.dev/go.temporal.io/sdk.","createdAt":"2022-04-12T13:17:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/773#issuecomment-1096715974","viewerDidAuthor":false}],"createdAt":"2022-04-12T06:39:43Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":773,"reactionGroups":[],"state":"CLOSED","title":"deadlock detected: workflow goroutine \"root\" didn't yield for over a second","updatedAt":"2022-04-12T13:17:17Z","url":"https://github.com/temporalio/sdk-go/issues/773"}
