{"assignees":[],"author":{"id":"MDQ6VXNlcjE0MzYxNDg4","is_bot":false,"login":"muralisrini","name":""},"body":"## Expected Behavior\nFIPS compatible protocols are in use and go runtime should not raise FIPS related panic\n\n## Actual Behavior\nPanic raised in GO runtime:\n\n```\npanic: crypto/md5: use of MD5 is not allowed in FIPS 140-only mode\n\ngoroutine 49 [running]:\ngo.temporal.io/sdk/internal.getBinaryChecksum()\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_worker.go:1246 +0xca\ngo.temporal.io/sdk/internal.(*workerExecutionParameters).getBuildID(...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_worker.go:291\ngo.temporal.io/sdk/internal.newWorkflowTaskHandler({{0x1d42a8c, 0x7}, {0x1dd9731, 0x18}, {0x2383840, 0xc000a894f0}, 0x40f86a0000000000, 0x5, 0x2, 0x40f86a0000000000, ...}, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_task_handlers.go:562 +0x54\ngo.temporal.io/sdk/internal.newWorkflowWorkerInternal(_, {{0x1d42a8c, 0x7}, {0x1dd9731, 0x18}, {0x2383840, 0xc000a894f0}, 0x40f86a0000000000, 0x5, 0x2, ...}, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_worker.go:320 +0xd0\ngo.temporal.io/sdk/internal.newWorkflowWorker(...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_worker.go:250\ngo.temporal.io/sdk/internal.NewAggregatedWorker(_, {_, _}, {0xc8, 0x0, 0xc8, 0x0, 0x0, 0x5, 0xc8, ...})\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_worker.go:1828 +0xeea\ngo.temporal.io/sdk/internal.NewWorker(...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/worker.go:360\ngo.temporal.io/sdk/worker.New({_, _}, {_, _}, {0xc8, 0x0, 0xc8, 0x0, 0x0, 0x5, ...})\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/worker/worker.go:259 +0x8c\n```\n\n\n## Steps to Reproduce the Problem\n\n  1. start a workflow using GO 1.24.1 with environment variable `GODEBUG=fips140=only` as described in https://go.dev/doc/security/fips140\n\n\n## Specifications\n\n  - Version: v1.33.0\n  - Platform: Ubuntu 24.04.1 LTS \n\n## Supplementary info \n\nTried to work around the problem using by setting `BuildID`:\n```\nworker.Options{\n                BuildID: \"manetu.\" + uuid.New().String(),\n...\n```\n\nThis passed both when not using FIPS or when using `GODEBUG=fips140=on`.\n\nHowever when using `GODEBUG=fips140=only` (the strictest mode), test failed with what appeared to be a timeout of some sort.  Ignoring application goroutines, see these on stack:\n\n```\ngoroutine 39 [select]:\ngoogle.golang.org/grpc/internal/grpcsync.(*CallbackSerializer).run(0xc000f822b0, {0x23fb9a0, 0xc0007d21e0})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/grpcsync/callback_serializer.go:88 +0x10c\ncreated by google.golang.org/grpc/internal/grpcsync.NewCallbackSerializer in goroutine 30\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/grpcsync/callback_serializer.go:52 +0x11a\n\ngoroutine 71 [select]:\ngoogle.golang.org/grpc/internal/transport.(*ClientStream).waitOnHeader(0xc0008827d0)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/transport/client_stream.go:92 +0x65\ngoogle.golang.org/grpc/internal/transport.(*ClientStream).RecvCompress(...)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/transport/client_stream.go:107\ngoogle.golang.org/grpc.(*csAttempt).recvMsg(0xc000f9e4e0, {0x1ce6140, 0xc000408460}, 0x1000000000000?)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/stream.go:1113 +0x117\ngoogle.golang.org/grpc.(*clientStream).RecvMsg.func1(0x136?)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/stream.go:970 +0x1f\ngoogle.golang.org/grpc.(*clientStream).withRetry(0xc000d90360, 0xc00006ec48, 0xc00006ec38)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/stream.go:790 +0x13b\ngoogle.golang.org/grpc.(*clientStream).RecvMsg(0xc000d90360, {0x1ce6140?, 0xc000408460?})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/stream.go:969 +0x155\ngoogle.golang.org/grpc.invoke({0x23fb968?, 0xc000bb8720?}, {0x1e947bf?, 0x465bd1?}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0x8?, {0xc000bdc500, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/call.go:73 +0xc4\ngo.temporal.io/sdk/internal.requiredInterceptors.namespaceProviderInterceptor.func6({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, 0x221f178, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/grpc_dialer.go:194 +0x192\ngoogle.golang.org/grpc.getChainUnaryInvoker.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, {0xc000bdc500, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/clientconn.go:489 +0x134\ngo.temporal.io/sdk/internal.requiredInterceptors.NewGRPCInterceptor.func3({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, 0xc000bb8690, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/common/metrics/grpc.go:80 +0x38d\ngoogle.golang.org/grpc.getChainUnaryInvoker.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, {0xc000bdc500, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/clientconn.go:489 +0x134\ngithub.com/grpc-ecosystem/go-grpc-middleware/retry.UnaryClientInterceptor.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, 0xc000bb8660, ...)\n        /home/muralisr/manetu/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.4.0/retry/retry.go:44 +0x53d\ngoogle.golang.org/grpc.getChainUnaryInvoker.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, {0xc001336840, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/clientconn.go:489 +0x134\ngo.temporal.io/sdk/internal.requiredInterceptors.NewRetryOptionsInterceptor.func2({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, 0xc000bb8630, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/common/retry/interceptor.go:168 +0x6c9\ngoogle.golang.org/grpc.getChainUnaryInvoker.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, {0xc000bb8570, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/clientconn.go:489 +0x134\ngo.temporal.io/sdk/internal.requiredInterceptors.NewGRPCInterceptor.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, 0xc000bb85d0, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/common/metrics/grpc.go:80 +0x38d\ngoogle.golang.org/grpc.getChainUnaryInvoker.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, {0xc000bb8570, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/clientconn.go:489 +0x134\ngo.temporal.io/sdk/internal.errorInterceptor({0x23fba10?, 0xc0004081c0?}, {0x1e947bf?, 0x1af2580?}, {0x1d0e380?, 0xc000408af0?}, {0x1ce6140?, 0xc000408460?}, 0x10?, 0xc000bb85a0, ...)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/grpc_dialer.go:223 +0x74\ngoogle.golang.org/grpc.NewClient.chainUnaryClientInterceptors.func1({0x23fba10, 0xc0004081c0}, {0x1e947bf, 0x4c}, {0x1d0e380, 0xc000408af0}, {0x1ce6140, 0xc000408460}, 0xc000f92008, 0x221f178, ...)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/clientconn.go:477 +0x10f\ngoogle.golang.org/grpc.(*ClientConn).Invoke(0xc000f92008, {0x23fba10?, 0xc0004081c0?}, {0x1e947bf?, 0x4c?}, {0x1d0e380?, 0xc000408af0?}, {0x1ce6140?, 0xc000408460?}, {0xc000ea01a0, ...})\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/call.go:35 +0x205\ngo.temporal.io/api/workflowservice/v1.(*workflowServiceClient).GetWorkflowExecutionHistory(0xc000f822c0, {0x23fba10, 0xc0004081c0}, 0xc000408af0, {0x0, 0x0, 0x50?})\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/api@v1.46.0/workflowservice/v1/service_grpc.pb.go:744 +0x167\ngo.temporal.io/sdk/internal.(*WorkflowClient).getWorkflowExecutionHistory(0xc00037be00, {0x23fb968, 0xc0011ffa70}, {0x23fc700, 0x35bba20}, 0x1, 0xc000408af0, 0x2)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_workflow_client.go:459 +0x1b1\ngo.temporal.io/sdk/internal.(*workflowClientInterceptor).ExecuteWorkflow.func1.(*WorkflowClient).getWorkflowHistory.1({0x0, 0x0, 0x0})\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_workflow_client.go:427 +0x1fd\ngo.temporal.io/sdk/internal.(*historyEventIteratorImpl).HasNext(0xc0013367e0)\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_workflow_client.go:1429 +0x62\ngo.temporal.io/sdk/internal.(*workflowRunImpl).GetWithOptions(0xc000408930, {0x23fb968, 0xc0011ffa70}, {0x19e2e80, 0xc0000aa448}, {0x1?})\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_workflow_client.go:1489 +0x99\ngo.temporal.io/sdk/internal.(*workflowRunImpl).Get(0xc000ecfa88?, {0x23fb968?, 0xc0011ffa70?}, {0x19e2e80?, 0xc0000aa448?})\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_workflow_client.go:1480 +0x2a\ngitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/cp/client/cp.CreateID({0x23fb968, 0xc0011ffa70}, {0x708818682198, 0xc00037be00}, 0xc0012120c0)\n        /home/muralisr/manetu/src/gitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/cp/client/cp/idcreate.go:43 +0x43d\ngitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors.createAdminIDCommand(0xc000f14500, {0xc0008f9530, 0x9}, {0xc0008f9508, 0x3}, {0xc0008f9550, 0x10, 0x10})\n        /home/muralisr/manetu/src/gitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors/utils.go:118 +0xdb3\ngitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors.(*ProviderCreatedEventHandler).createAdminIDCommand(0xc000c18cf0?, 0xc000f14500, {0xc0008f9530, 0x9}, 0xc000f15000)\n        /home/muralisr/manetu/src/gitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors/providercreated.go:105 +0x24e\ngitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors.(*ProviderCreatedEventHandler).Process(0x35bba20, 0xc000f14500, 0xc000fbff10, 0xc001037080)\n        /home/muralisr/manetu/src/gitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors/providercreated.go:48 +0x1ff\ngitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors_test.TestProviderCreatedProcess.func5(0xc0004c0fc0)\n        /home/muralisr/manetu/src/gitlab.com/manetu/platform/control-plane/mcp-iam-service/internal/event/processors/providercreated_test.go:167 +0x219\ntesting.tRunner(0xc0004c0fc0, 0xc00067e230)\n        /home/muralisr/go-1.24.1/src/testing/testing.go:1792 +0xf4\ncreated by testing.(*T).Run in goroutine 30\n        /home/muralisr/go-1.24.1/src/testing/testing.go:1851 +0x413\n\ngoroutine 54 [select]:\ngoogle.golang.org/grpc/internal/transport.(*controlBuffer).get(0xc000bdc180, 0x1)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/transport/controlbuf.go:412 +0x108\ngoogle.golang.org/grpc/internal/transport.(*loopyWriter).run(0xc000f96300)\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/transport/controlbuf.go:575 +0x78\ngoogle.golang.org/grpc/internal/transport.NewHTTP2Client.func6()\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/transport/http2_client.go:472 +0xd2\ncreated by google.golang.org/grpc/internal/transport.NewHTTP2Client in goroutine 85\n        /home/muralisr/manetu/pkg/mod/google.golang.org/grpc@v1.71.0/internal/transport/http2_client.go:470 +0x2452\n\ngoroutine 31 [syscall, 10 minutes]:\nos/signal.signal_recv()\n        /home/muralisr/go-1.24.1/src/runtime/sigqueue.go:152 +0x29\nos/signal.loop()\n        /home/muralisr/go-1.24.1/src/os/signal/signal_unix.go:23 +0x13\ncreated by os/signal.Notify.func1.1 in goroutine 45\n        /home/muralisr/go-1.24.1/src/os/signal/signal.go:152 +0x1f\n\ngoroutine 47 [chan receive, 10 minutes]:\ngo.temporal.io/sdk/internal.InterruptCh.func1()\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_utils.go:205 +0x2b\ncreated by go.temporal.io/sdk/internal.InterruptCh in goroutine 45\n        /home/muralisr/manetu/pkg/mod/go.temporal.io/sdk@v1.33.0/internal/internal_utils.go:204 +0xdc\n\n```\n\n\n","closedAt":"2025-03-27T18:17:51Z","comments":[],"createdAt":"2025-03-26T19:56:14Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1887,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"enabling FIPS only mode with go 1.24.1 raises panic related to MD5 usage","updatedAt":"2025-03-27T18:17:51Z","url":"https://github.com/temporalio/sdk-go/issues/1887"}
