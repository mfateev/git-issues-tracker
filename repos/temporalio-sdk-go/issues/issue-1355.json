{"assignees":[],"author":{"id":"MDQ6VXNlcjE1OTMyNjc3","is_bot":false,"login":"valentin-krasontovitsch","name":"Valentin Krasontovitsch"},"body":"**Is your feature request related to a problem? Please describe.**\r\nI'm always frustrated when I want to use a (specific instance of a) generic\r\nfunction for an activity, and I have to register it using a specific name I\r\npass in `activity.RegisterOptions` when calling `RegisterActivityWithOptions`.\r\n\r\nFor when I just use the function name, as in\r\n```\r\n    my_worker = worker.New(my_client, myQueue, worker.Options{})\r\n    my_worker.RegisterActivity(publishEvent[OrderEvent])\r\n    my_worker.RegisterActivity(publishEvent[ArchiveEvent])\r\n```\r\n\r\nI get an error on the second invaction:\r\n\r\n```\r\npanic: activity type \"]\" is already registered\r\n```\r\n\r\nI've traced the source to the `get_function_name` function in\r\n`internal/internal_worker.go` - the string returned by\r\n`runtime.FuncForPC(reflect.ValueOf(i).Pointer()).Name()` replaces the concrete\r\ntype in the generic function by `...`, resulting e.g. in `publishEvent[...]` -\r\nthe subsequent splitting on `.` and picking the last element results in a\r\nfunction name of `\"]\"`, which is of course non-sensical.\r\n\r\n**Describe the solution you'd like**\r\nImprove the parsing of function names to support generics, so generic functions\r\ncan be registered directly.\r\n\r\n**Describe alternatives you've considered**\r\nA functioning workaround is, as alluded above, to just use the following:\r\n```\r\n    my_worker.RegisterActivityWithOptions(\r\n      publishEvent[OrderEvent],\r\n      activity.RegisterOptions{Name: \"publishOrderEvent\"},\r\n    )\r\n    my_worker.RegisterActivityWithOptions(\r\n      publishEvent[ArchiveEvent],\r\n      activity.RegisterOptions{Name: \"publishArchiveEvent\"},\r\n    )\r\n```\r\nSo if you say this is a no-fix, and a note in the docs about this, I'll be\r\nhappy, too : )\r\n\r\nIf that's an option, I am also willing to try and contribute an MR.","closedAt":"2024-01-17T18:20:11Z","comments":[{"id":"IC_kwDODN1w685wzko-","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"We should definitely do better then registering the activity as \"]\"\r\n\r\nWhat would be the new proposed way to get the name of a function be? Since the current method `runtime.FuncForPC(reflect.ValueOf(i).Pointer()).Name()`   lacks the generic parameters in the output no amount of improved parsing of that result would let you register `publishEvent[OrderEvent]`  and `publishEvent[OrderEvent]` since they both output `publishEvent[...]` if I understand the issue.","createdAt":"2024-01-15T17:37:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1892567614","viewerDidAuthor":false},{"id":"IC_kwDODN1w685w4Dp_","author":{"login":"valentin-krasontovitsch"},"authorAssociation":"NONE","body":"hey, and thanks for the response : )\r\n\r\nyaa you're right on spot - that function is not good enough.\r\ni've never tried to look into behind the scenes of go, i.e. use runtime or reflect package, so this is all very new territory for me.\r\n\r\ni tried experimenting around a bit, and i got as far as looking at the type of the function pointer - that contains the types of the input arguments.\r\n\r\ni have a [little script for experimenting](https://gist.github.com/valentin-krasontovitsch/dc3786551cd2c85fb64ab845d76f05fb) that i uploaded as a gist. it produces for a function with one concrete and two generic inputs the following output consisting of\r\n- type\r\n- full name\r\n- return values of get function name func\r\n\r\n```\r\ntype of i: func(int, main.OrderEvent, string)\r\nfullName: main.Echo[...]\r\n] false\r\n```\r\n\r\nso this could be used to create a hereustic for making a function name that reflects the concrete types for generic functions.\r\nbut i see that the get function name for concrete functions doesn't take into account input types in general, which makes sense, as you cannot have two functions with same name but different input types.\r\n\r\nso maybe we just need to fix the get function name function to return what we would expect for a generic function, namely the function name, instead of `]`, and think about how to attack the issue of registering generic functions in general. and for that I have some vague ideas based on heuristics, but not enough experience with generics or typing in general (not a computer science major) to be confident to come up with a working strategy.\r\n\r\nwhat do SDKs for other languages do, in particular languages that perhaps allow overloading? maybe we can find some inspiration there?","createdAt":"2024-01-16T13:28:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1893743231","viewerDidAuthor":false},{"id":"IC_kwDODN1w685w4HHZ","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> what do SDKs for other languages do, in particular languages that perhaps allow overloading?\r\n\r\nNo SDKs allow generics in functions that they must reflectively call (e.g. workflows and activities) from what I'm aware of. As for overloading, depending on the SDK, actual functions are marked for use so concerns about overloading don't apply (though if you mark two things of the same name as activities, you'll surely get a duplicate-activity error upon registration).\r\n\r\nI would strongly suggest making a concrete non-generic function as your activity. If it needs to be a one-liner to a generic form, so be it.","createdAt":"2024-01-16T13:36:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1893757401","viewerDidAuthor":false},{"id":"IC_kwDODN1w685w5iEn","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Yeah as fair as I am aware there isn't a good way for the SDK to create a unique name at runtime for each instance of a generic function.","createdAt":"2024-01-16T16:50:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1894129959","viewerDidAuthor":false},{"id":"IC_kwDODN1w685w9y1y","author":{"login":"valentin-krasontovitsch"},"authorAssociation":"NONE","body":"alright, so i'm gonna close this as won't fix as there is a work-around (or even two! hadn't thought of making a one-liner concrete function that wraps an instance of the generic one)) with reasonably small overhead for developers. thanks for the discussion!","createdAt":"2024-01-17T07:40:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1895247218","viewerDidAuthor":false},{"id":"IC_kwDODN1w685xAUKf","author":{"login":"valentin-krasontovitsch"},"authorAssociation":"NONE","body":"argh i was too fast - how do you feel about adding a note about (one of the) workarounds in the docs?","createdAt":"2024-01-17T14:18:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1895907999","viewerDidAuthor":false},{"id":"IC_kwDODN1w685xCEyo","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I will bring up to the docs team internally","createdAt":"2024-01-17T18:20:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1355#issuecomment-1896369320","viewerDidAuthor":false}],"createdAt":"2024-01-15T10:02:49Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1355,"reactionGroups":[],"state":"CLOSED","title":"support generic functions for activites","updatedAt":"2024-01-17T18:20:11Z","url":"https://github.com/temporalio/sdk-go/issues/1355"}
