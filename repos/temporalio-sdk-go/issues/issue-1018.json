{"assignees":[],"author":{"id":"MDQ6VXNlcjY3OTM0OTg2","is_bot":false,"login":"RyanLettieri","name":"Ryan Lettieri"},"body":"Background: Developer on Dapr ( [GitHub - dapr/dapr: Dapr](https://github.com/dapr/dapr))\r\nWe are trying to include Temporal as a workflow engine in our current release (1.10)\r\n\r\nIssue: When including the SDK in our project our memory increase spikes up by around 7MB.\r\n\r\nSDK Versions:\r\n[go.temporal.io/api](http://go.temporal.io/api) v1.12.0\r\n[go.temporal.io/sdk](http://go.temporal.io/sdk) v1.17.0\r\n\r\nIs this the expected memory usage of the inclusion of the SDK? If so, is there a “lite” version of the SDK that won’t consume this amount of memory? If not, is there any way to decrease the memory usage that comes with the inclusion of the SDK?\r\n\r\n## Expected Behavior\r\nIncluding the go SDKs for temporal should be minor in terms of the memory usage.\r\n\r\n## Actual Behavior\r\n\r\nWhen including the temporal SDK into the project, the memory usage of the project increases by 7MB.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Include the temporal api and sdk into the project.\r\n  1. Run the project.\r\n  1.\r\n\r\n## Specifications\r\n\r\n  - Version: (api v1.12.0.) (SDK 1.17.0)\r\n  - Platform:\r\n\r\n","closedAt":"2023-01-31T16:20:10Z","comments":[{"id":"IC_kwDODN1w685T_SXu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Can you clarify memory usage? Are you saying the binary size are talking about runtime memory use? If runtime memory use, is it only after you start a Temporal worker or after you import a Temporal package? Client only or worker too? 7MB is usually not a heavy burden for a library like Temporal, but profiling can help determine where the memory is used.","createdAt":"2023-01-30T18:17:30Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409099246","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_g7p","author":{"login":"yaron2"},"authorAssociation":"NONE","body":"Hi, Dapr maintainer here. We're talking about runtime memory use.","createdAt":"2023-01-30T18:52:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409158889","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_hYR","author":{"login":"yaron2"},"authorAssociation":"NONE","body":"What we're seeing is increased memory after this method is executed: https://github.com/dapr/components-contrib/blob/master/workflows/temporal/temporal.go#LL49C2-L49C2.\r\n","createdAt":"2023-01-30T18:54:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409160721","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_ogd","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"7MB sounds within reasonable range for a full gRPC client of a reasonably large API and Temporal worker setup. For example, protobuf registers all types in a global map. It may be worth profiling and seeing if there's anything obvious. We can do the same if too problematic.","createdAt":"2023-01-30T19:12:36Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409189917","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_sU5","author":{"login":"yaron2"},"authorAssociation":"NONE","body":"Update: the memory increase occurs just by importing the package.\r\n\r\nCurrently, this type of memory increase prohibits us from including Temporal as a Workflows component in our upcoming release, so it would be great if there was a way to reduce the memory usage.","createdAt":"2023-01-30T19:20:24Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409205561","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_s68","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"That would make sense. Protobuf creates a big map of all registered types globally in `init()` clauses and we have a decent amount of protobufs. Though there may be other places too that a memory profile could uncover.","createdAt":"2023-01-30T19:22:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409207996","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_yZI","author":{"login":"RyanLettieri"},"authorAssociation":"NONE","body":"In lieu of the size of the import, is it possible to simply use the HTTP endpoint as a hackish workaround for the time being? If so, could you point me in the right direction to get started on that implementation?","createdAt":"2023-01-30T19:41:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409230408","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_zh_","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I am afraid we do not (yet) have a publicly facing HTTP interface for the low-level Temporal API. The Temporal API is a bit low-level and therefore can be difficult to navigate without the higher level client. The whole reason we lean on Protobuf is to have that type safety at an acceptable cost of a few megs.\r\n\r\nYou can use the CLI as a subprocess, but that CLI is gonna use more than 7MB too.","createdAt":"2023-01-30T19:45:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409235071","viewerDidAuthor":false},{"id":"IC_kwDODN1w685T_28t","author":{"login":"yaron2"},"authorAssociation":"NONE","body":"> I am afraid we do not (yet) have a publicly facing HTTP interface for the low-level Temporal API. The Temporal API is a bit low-level and therefore can be difficult to navigate without the higher level client. The whole reason we lean on Protobuf is to have that type safety at an acceptable cost of a few megs.\r\n> \r\n> You can use the CLI as a subprocess, but that CLI is gonna use more than 7MB too.\r\n\r\nThanks for the prompt response here, we appreciate this. We will remove Temporal support for 1.10 and look to include it again if anything changes in time for our 1.11 release.","createdAt":"2023-01-30T19:58:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1018#issuecomment-1409249069","viewerDidAuthor":false}],"createdAt":"2023-01-30T18:12:12Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1018,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"The memory usage from including the Temporal SDK is very large","updatedAt":"2023-01-31T16:20:10Z","url":"https://github.com/temporalio/sdk-go/issues/1018"}
