{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTg3MTAz","is_bot":false,"login":"yuandrew","name":"Andrew Yuan"},"body":"**Is your feature request related to a problem? Please describe.**\nA clear and concise description of what the problem is. Ex. I'm always frustrated when [...]\nWhen creating a `common.Payload` and marshaling it into an `Any` type, the visitor is not able to visit this scenario, due to a missing `case *common.Payload` in `visitPayloads()`.\n\nThis scenario is not used in our API today, but something we may want to support in the future. \n\n**Describe the solution you'd like**\nImplement this base case so we can visit this scenario.\n\n**Additional context**\nHere is a basic test I wrote to validate this new feature \n```\nfunc TestVisitPayloads_AnyPayload(t *testing.T) {\n\tmsg, err := anypb.New(inputPayload())\n\trequire.NoError(t, err)\n\troot := &protocol.Message{Body: msg}\n\tvar anyCount int\n\terr = VisitPayloads(context.Background(), root, VisitPayloadsOptions{\n\t\tVisitor: func(ctx *VisitPayloadsContext, p []*common.Payload) ([]*common.Payload, error) {\n\t\t\tanyCount++\n\t\t\t// Only mutate if the payloads has \"test\"\n\t\t\tif len(p) == 1 && string(p[0].Data) == \"test\" {\n\t\t\t\treturn []*common.Payload{{Data: []byte(\"new-val\")}}, nil\n\t\t\t}\n\t\t\treturn p, nil\n\t\t},\n\t})\n\trequire.NoError(t, err)\n\trequire.Equal(t, 1, anyCount)\n\tupdate1, err := root.Body.UnmarshalNew()\n\trequire.NoError(t, err)\n\trequire.Equal(t, \"new-val\", string(update1.(*common.Payload).Data))\n}\n```\n\nalso see https://github.com/temporalio/api-go/pull/202#discussion_r1920352920 for more context\n","closedAt":"2025-04-09T16:24:04Z","comments":[{"id":"IC_kwDODN1w686iCtCz","author":{"login":"yuandrew"},"authorAssociation":"MEMBER","body":"When this is implemented, this is another test that can be added\n```\nfunc TestProtocolMessage(t *testing.T) {\n\trequire := require.New(t)\n\n\tvar messageType protoreflect.MessageType\n\tprotoregistry.GlobalTypes.RangeMessages(func(mt protoreflect.MessageType) bool {\n\t\tif string(mt.Descriptor().FullName()) == \"temporal.api.protocol.v1.Message\" {\n\t\t\tmessageType = mt\n\t\t}\n\t\treturn true\n\t})\n\n\t// Create empty instance and populate with test values\n\tmsg := messageType.New().Interface().(proto.Message)\n\tvar totalCount, count int\n\tpopulatePayload(&msg, msg, require, &totalCount, &count)\n\n\trequire.Equal(0, count)\n\trequire.Equal(1, totalCount)\n}\n```","createdAt":"2025-03-12T17:30:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1862#issuecomment-2718617779","viewerDidAuthor":false}],"createdAt":"2025-03-11T21:25:14Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1862,"reactionGroups":[],"state":"CLOSED","title":"[api-go] Support direct Payload's and Payload`s at top-level of Any in payload visitor","updatedAt":"2025-04-09T16:24:05Z","url":"https://github.com/temporalio/sdk-go/issues/1862"}
