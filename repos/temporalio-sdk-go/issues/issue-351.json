{"assignees":[{"id":"MDQ6VXNlcjUxNzY4Mw==","login":"Sushisource","name":"Spencer Judge","databaseId":0}],"author":{"id":"MDQ6VXNlcjQ1OTUwNDM0","is_bot":false,"login":"sjmtan","name":"Shannon Tan"},"body":"Issue mentioned here: \r\n\r\nhttps://community.temporal.io/t/should-cancellation-termination-of-workflows-be-tested/1299\r\n\r\n## Expected Behavior\r\nWhen mocking a child workflow to run a function that cancels the parent workflow, it should return that the parent workflow was cancelled. This should be in line with how one tests cancellation on activity transitions (not cancelling activities).\r\n\r\n## Actual Behavior\r\nPanics/ChildWorkflowExecutionError results instead of cancellation error being returned.\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nParent workflow with child workflow:\r\n```\r\nctx = workflow.WithChildOptions(ctx, workflow.ChildWorkflowOptions{\r\n\t\tParentClosePolicy: enums.PARENT_CLOSE_POLICY_REQUEST_CANCEL,\r\n\t})\r\nrecurringWorkflowErr := workflow.ExecuteChildWorkflow(ctx, RecurringSubscription).Get(ctx, nil)\r\n```\r\n\r\n```\r\n       env.OnWorkflow(subscriptions.RecurringSubscription, mock.Anything).Run(func(args mock.Arguments) {\r\n\t\t\t\t\tenv.CancelWorkflow()\r\n\t\t\t\t})\r\n\tenv.ExecuteWorkflow(subscriptions.Subscription)\r\n\tExpect(env.IsWorkflowCompleted()).To(BeTrue())\r\n\tExpect(env.GetWorkflowError()).To(HaveOccurred())\r\n\tExpect(temporal.IsCanceledError(env.GetWorkflowError())).To(BeTrue()) // Fails here\r\n```\r\n\r\nThis results in a panic because there's no `Return` for the mock. Changing the mock to:\r\n\r\n```\r\n\t\t\t\tenv.OnWorkflow(subscriptions.RecurringSubscription, mock.Anything).Run(func(args mock.Arguments) {\r\n\t\t\t\t\tenv.CancelWorkflow()\r\n\t\t\t\t}).Return(func(ctx workflow.Context) error {\r\n\t\t\t\t\treturn nil\r\n\t\t\t\t})\r\n\t\t\t\t```\r\n\t\t\t\t\r\nThis results in no error, and the workflow isn't canceled.\r\n\r\n## Specifications\r\n\r\n  - Version: SDK 1.4.0\r\n  - Platform: Testing\r\n","closedAt":null,"comments":[],"createdAt":"2021-01-26T19:45:01Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":351,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"OPEN","title":"[Testing] Cancellation of Parent Workflow with Child Workflow Panics","updatedAt":"2021-01-26T19:51:31Z","url":"https://github.com/temporalio/sdk-go/issues/351"}
