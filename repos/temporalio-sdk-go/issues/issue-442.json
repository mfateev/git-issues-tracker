{"assignees":[],"author":{"id":"MDQ6VXNlcjU1NTIzODE=","is_bot":false,"login":"mastermanu","name":""},"body":"## Expected Behavior\r\nIf, due to some transient issue, the SDK fails on its first attempt to call Temporal, but succeeds on a retry, the metric reports 1 failure and 1 success, which could be misleading. This is because the metric emission happens on an interceptor that is triggered per-request:\r\n\r\n```\r\n// NewScopeInterceptor creates new metrics scope interceptor.\r\nfunc NewScopeInterceptor(defaultScope tally.Scope) grpc.UnaryClientInterceptor {\r\n\treturn func(ctx context.Context, method string, req, reply interface{}, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption) error {\r\n\t\tscope, ok := ctx.Value(ScopeContextKey).(tally.Scope)\r\n\t\tif !ok || scope == nil {\r\n\t\t\tscope = defaultScope\r\n\t\t}\r\n\t\tisLongPoll, ok := ctx.Value(LongPollContextKey).(bool)\r\n\t\tif !ok {\r\n\t\t\tisLongPoll = false\r\n\t\t}\r\n\t\trs := newRequestScope(scope, method, isLongPoll)\r\n\t\trs.recordStart()\r\n\t\terr := invoker(ctx, method, req, reply, cc, opts...)\r\n\t\trs.recordEnd(err)\r\n\t\treturn err\r\n\t}\r\n}\r\n```\r\n\r\nIdeal behavior would be to differentiate \"overall\" SLA vs SLA including retry failures.","closedAt":"2021-06-09T05:09:51Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDg0OTM3OTgwMg==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"I think existing metrics are good as they are because they give us detailed view of the server behavior. \r\nYour ask for a higher level metric that would exclude retries makes sense though, and we could add it on top of existing ones.\r\nIf I understand you correctly you want something like a replay aware `WorkflowOutboundCallsInterceptor` that would publish success/failure rate for all calls?","createdAt":"2021-05-27T06:52:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/442#issuecomment-849379802","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg1MDAwOTc4OA==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"Yes, an additional metric that excludes retries for ultimately successful calls would be useful.  Even though this metric would not include the intermediate retries, the retries should still be in the calculated latency.\r\n\r\nNot sure if this applies to any \"replay-aware\" interceptors though. This is purely about distinguishing between intermediate retries vs final success rate for gRPC calls to temporal server. Maybe I am misunderstanding where replay comes into the picture?","createdAt":"2021-05-27T23:37:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/442#issuecomment-850009788","viewerDidAuthor":false}],"createdAt":"2021-05-14T01:35:43Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":442,"reactionGroups":[],"state":"CLOSED","title":"Reported Metrics around availability include initial retry failures even if final call succeeds","updatedAt":"2021-06-09T05:09:51Z","url":"https://github.com/temporalio/sdk-go/issues/442"}
