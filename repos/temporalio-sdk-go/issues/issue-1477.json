{"assignees":[],"author":{"id":"MDQ6VXNlcjUxNDkzMg==","is_bot":false,"login":"antmendoza","name":"Antonio Mendoza PÃ©rez"},"body":"## Expected Behavior\r\nSDK should report the [slots available](https://docs.temporal.io/references/sdk-metrics#worker_task_slots_available) for workflow, activity and local activity worker \r\n\r\nit works as expected when the metrics handler is tally https://github.com/temporalio/samples-go/blob/main/metrics/worker/main.go#L18-L24 \r\n\r\n## Actual Behavior\r\nUsing the opentelemetry metrics handler \r\n\r\n```\r\n\texp, err := otlpmetrichttp.New(ctx, otlpmetrichttp.WithEndpointURL(\"http://localhost:4318\"))\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tmeterProvider := metric.NewMeterProvider(metric.WithReader(\r\n\t\tmetric.NewPeriodicReader(exp, metric.WithInterval(1*time.Second)),\r\n\t))\r\n\thandler := opentelemetry.NewMetricsHandler(\r\n\t\topentelemetry.MetricsHandlerOptions{\r\n\t\t\tMeter: meterProvider.Meter(\"temporal-sdk-go\"),\r\n\t\t},\r\n\t)\r\n\r\n```\r\nthe SDK only reports slots available for `worker_type=\"WorkflowWorker\"`\r\n\r\n![Screenshot 2024-05-17 at 17 22 44](https://github.com/temporalio/sdk-go/assets/514932/e636bea2-5478-45b1-8c8f-48fc67887537)\r\n\r\n\r\nOther metrics that have different values for workflow_type seem ok. \r\n\r\n![Screenshot 2024-05-17 at 17 22 27](https://github.com/temporalio/sdk-go/assets/514932/9e0825d1-ad8b-4f85-a9c8-7970c9875783)\r\n\r\n\r\nYou can find a repro here \r\n\r\nhttps://github.com/antmendoza/my-temporal-pocs/tree/main/go/_5888\r\n\r\n\r\n```\r\ngo.temporal.io/api v1.33.0\r\ngo.temporal.io/sdk v1.26.1\r\ngo.temporal.io/sdk/contrib/opentelemetry v0.5.0\r\n\r\n```\r\n\r\n","closedAt":"2024-05-22T21:24:56Z","comments":[{"id":"IC_kwDODN1w685-TdIC","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"This appears to be a regression or at least change in behaviour of the [OTEL Go SDK](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/metric) testing with version `1.21.0` then `temporal_worker_task_slots_available` is reported correctly, but testing with `1.26.0` it is not. I have a work around for our integration and will need to open up and issue with the OTEL Go SDK if this is intentional or not.","createdAt":"2024-05-18T23:31:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1477#issuecomment-2119029250","viewerDidAuthor":false}],"createdAt":"2024-05-17T16:16:49Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1477,"reactionGroups":[],"state":"CLOSED","title":"temporal_worker_task_slots_available only reports workflow slots when using opentelemetry metrics handler","updatedAt":"2024-05-22T21:24:56Z","url":"https://github.com/temporalio/sdk-go/issues/1477"}
