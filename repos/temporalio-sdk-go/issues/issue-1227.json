{"assignees":[],"author":{"id":"MDQ6VXNlcjg5NjU1NA==","is_bot":false,"login":"robindarby","name":"Robin Darby"},"body":"## Expected Behavior\nCalling workflow.CreateSessio, while using a versioned worker, creates a new session context for that worker.\n\n## Actual Behavior\nThe new session has no worker; \"internalSessionCreationActivity\" will timeout: \n`activity error (type: internalSessionCreationActivity, scheduledEventID: 6, startedEventID: 0, identity: ): activity ScheduleToStart timeout (type: ScheduleToStart) ;`\n\nCould it be because this internal activity has the following attribute: Use Compatible Version false (as seen in the UI)?\n\n## Steps to Reproduce the Problem\n1. set a worker version via the SDK as follows:\n\n```\nfunc setTemporalTaskQueueDefaultVersion(temporalClient client.Client, taskQueue string, buildId string) error {\n\tif err := temporalClient.UpdateWorkerBuildIdCompatibility(context.Background(), &client.UpdateWorkerBuildIdCompatibilityOptions{\n\t\tTaskQueue: taskQueue,\n\t\tOperation: &client.BuildIDOpAddNewIDInNewDefaultSet{\n\t\t\tBuildID: buildId,\n\t\t},\n\t}); err != nil {\n\t\treturn err\n\t}\n\treturn nil\n}\n```\n\n1. Then, use that version in the worker:\n\n```\n\tw := worker.New(temporalClient, workflows.QueueName, worker.Options{\n\t\tEnableSessionWorker:     true,\n\t\tBuildID:                 *buildId,\n\t\tUseBuildIDForVersioning: useBuildIDForVersioning,\n\t})\n```\n\n1. Now, in a workflow, when you call:\n\n```\n\tactivityOptions := workflow.ActivityOptions{\n\t\tStartToCloseTimeout: 60 * time.Minute,\n\t\tRetryPolicy: &temporal.RetryPolicy{\n\t\t\tMaximumAttempts: 2,\n\t\t},\n\t\tTaskQueue:        QueueName,\n\t}\n\tctx = workflow.WithActivityOptions(ctx, activityOptions)\n\n\tso := &workflow.SessionOptions{\n\t\tCreationTimeout:  time.Minute,\n\t\tExecutionTimeout: time.Hour,\n\t}\n\tctx, err := workflow.CreateSession(ctx, so)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer workflow.CompleteSession(ctx)\n```\n\n## Specifications\n* Version: v1.24.0\n* Platform: Linux\n\n","closedAt":null,"comments":[{"id":"IC_kwDODN1w685mFRYi","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Unfortunately worker versioning and sessions are not compatible at this time because the task queue used for `internalSessionCreationActivity` ,  the activity responsible for creating the session, does not have the same version info as the original task queue and the server has no way to link two task queues together.","createdAt":"2023-09-09T23:00:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1227#issuecomment-1712657954","viewerDidAuthor":false}],"createdAt":"2023-09-06T12:35:30Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1227,"reactionGroups":[],"state":"OPEN","title":"Worker versioning + workflow session","updatedAt":"2025-02-04T18:25:26Z","url":"https://github.com/temporalio/sdk-go/issues/1227"}
