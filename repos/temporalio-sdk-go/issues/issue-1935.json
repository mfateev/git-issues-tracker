{"assignees":[],"author":{"id":"MDQ6VXNlcjQ2Njg4MDQ3","is_bot":false,"login":"aentwist","name":"Anderson Entwistle"},"body":"## Expected Behavior\n\n```go\nc, err := client.Dial(client.Options{\n    HostPort: \"temporal:7233\",\n})\n```\n\n## Actual Behavior\n\n`context deadline exceeded`\n\n## Workaround\n\n-> `nslookup temporal`\n-> gives IP\n-> using that IP directly works\n\n```go\nc, err := client.Dial(client.Options{\n    HostPort: \"172.21.0.4:7233\",\n})\n```\n\n## Steps to Reproduce the Problem\n\n  1. Create Docker network `docker network create temporal-network`\n  1. Spin up official Docker Compose with `driver: bridge` changed to `external: true`. `docker compose -f docker-compose.yml up -d`\n  1. Create a minimal Go app that connects\n  1. Build that using the Go Docker image\n  1. Put it on the same network as the official Docker Compose example\n  1. `docker compose -f compose-app.yml up --build`\n\n<details>\n<summary>Go app</summary>\n<pre>\npackage main\n\nimport (\n\t\"log\"\n\n\t\"go.temporal.io/sdk/client\"\n)\n\nfunc main() {\n\tc, err := client.Dial(client.Options{\n\t\t// HostPort: client.DefaultHostPort,\n\t\tHostPort: \"temporal:7233\",\n\t\t// HostPort: \"172.21.0.4:7233\",\n\t})\n\tif err != nil {\n\t\tlog.Fatalf(\"Unable to create Temporal client: %v\", err)\n\t}\n\tdefer c.Close()\n\n\tlog.Println(\"Successfully connected to Temporal server\")\n}\n\n</pre>\n</details>\n\n<details>\n<summary>Dockerfile</summary>\n<pre>\nFROM golang:1.24\n\nWORKDIR /usr/src/app\n\nCOPY go.mod go.sum ./\nRUN go mod download\n\nCOPY . .\nRUN go build -v -o /usr/local/bin/app ./...\n\n\\# If you are spinning all up at once, app needs to wait\n\\# CMD sleep 15 && app\n\\# Otherwise this\nCMD [\"app\"]\n</pre>\n</details>\n\n<details>\n<summary>Docker Compose for the app compose-app.yml</summary>\nPut the app on the same network as the official example.\n<pre>\nservices:\n  app:\n    build: .\n    # network_mode: host\n    networks:\n      - temporal-network\nnetworks:\n  temporal-network:\n    external: true\n    name: temporal-network\n</pre>\n</details>\n\n## Specifications\n\n  - Version: 1.27.2\n  - Platform: linux/amd64, linux/arm64\n\n## See Also\n\n- https://community.temporal.io/t/does-this-project-run-can-i-get-paid-support-to-set-up-self-hosted/17240\n- https://github.com/temporalio/docker-compose/issues/225\n","closedAt":"2025-04-29T15:27:47Z","comments":[{"id":"IC_kwDODN1w686o2dlQ","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"First I would recommend updating your SDK `v1.27.2` is very out of date. The latest is [v1.34.0](https://github.com/temporalio/sdk-go/releases/tag/v1.34.0)\n\n`client.Dial` passes `HostPort` directly to [grpc-go](https://github.com/grpc/grpc-go) which follows [grpcs](https://grpc.io/docs/guides/custom-name-resolution/) , the standard grpc namespace resolution rules . To bypass name resolution you can set `passthrough:target` per the `grpc-go` docs","createdAt":"2025-04-27T01:10:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1935#issuecomment-2832849232","viewerDidAuthor":false},{"id":"IC_kwDODN1w686o2xoA","author":{"login":"aentwist"},"authorAssociation":"NONE","body":"Yeah so that's actually the Temporal version, my bad. I'm on SDK 1.33.1+.\n\n---\n\nI'm not sure how I would know to go read that docs page, but let's assume I knew.\n\n> When making a request with a gRPC client, by default, DNS name resolution is used.\n\nOK, it should be using DNS, great.\n\n> Name resolution is often thought to be the same as [DNS](https://www.ietf.org/rfc/rfc1035.txt). In practice however, DNS is usually augmented with extensions or completely replaced to enable name resolution.\n\nHm. Maybe this tells us that it won't work as expected? Since Docker could easily be 'augmenting it with an extension' or something.\n\n---\n\nAll I'm saying is, and here is my official workaround using [`net.LookupHost`](https://pkg.go.dev/net#LookupHost),\n\nThis doesn't work\n\n```go\nc, err := client.Dial(client.Options{\n\tHostPort: \"temporal:7233\",\n})\n```\n\nBut this works\n\n```go\naddrs, err := net.LookupHost(\"temporal\")\nif err != nil || len(addrs) != 1 {\n\tlog.Fatal(\"Unable to lookup temporal address\")\n}\nc, err := client.Dial(client.Options{\n\tHostPort: addrs[0] + \":7233\",\n})\n```\n\nAnd figuring that out cost me a LOT of time.","createdAt":"2025-04-27T03:14:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1935#issuecomment-2832931328","viewerDidAuthor":false},{"id":"IC_kwDODN1w686o2ypO","author":{"login":"aentwist"},"authorAssociation":"NONE","body":"OK it seems you're correct that buried in the grpc-go docs there is a passthrough option, so this is what it should look like instead:\n\n```go\nc, err := client.Dial(client.Options{\n\tHostPort: \"passthrough:///temporal:7233\",\n})\n```\n\nI have no idea how I would have ever gotten there on my own. Thanks.\n\nThis cost me such an absurd amount of resources and made me hate Temporal so much. Is there ANYWHERE in the docs or API docs that says 'resolved using grpc-go'?","createdAt":"2025-04-27T03:25:59Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1935#issuecomment-2832935502","viewerDidAuthor":false},{"id":"IC_kwDODN1w686o342g","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":">This cost me such an absurd amount of resources and made me hate Temporal so much. Is there ANYWHERE in the docs or API docs that says 'resolved using grpc-go'?\n\nI am sorry you had a bad experience here. Temporal uses grpc as a transport between server and client. The Go SDK uses `grpc-go` for this, that is a dependency of the Go SDK. The documentation for [Hostport](https://github.com/temporalio/sdk-go/blob/ee78d25974654b5132b08cb466a8d776d99d64a9/internal/client.go#L479) specifies it is a `grpc` address and that `dns` is the resolver. It also calls out specifying a customer `grpc-go` resolver. A quick look at the grpc go source code suggest it is using `net` for its DNS lookup as well.\n\nWe could add a note here calling out that `pasthrough:///` is a valid option as well.","createdAt":"2025-04-27T06:48:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1935#issuecomment-2833223072","viewerDidAuthor":false},{"id":"IC_kwDODN1w686o5sxm","author":{"login":"aentwist"},"authorAssociation":"NONE","body":"Well, you're right. Probably I saw that not knowing gRPC\n\nhttps://github.com/temporalio/sdk-go/blob/ee78d25974654b5132b08cb466a8d776d99d64a9/internal/client.go#L469-L473\n\nand literally thought 'I don't need to do anything custom, no custom resolvers, there is nothing unusual or custom going on here'. I suppose this is fine. If anything, I'd really like more documentation on the Docker side, probably. Docker is a common use case that is worthy of a special note, but Go doesn't deserve to cover it. It's gotta be the same in the other SDKs too right? So I think it is fine to close this issue.\n\nSometimes in software things just have it out for you. In reflection I don't think I could have done anything differently to avoid what happened. It just kinda majorly sucked. That's ok. Huge props to you and forum member [tihomir](https://community.temporal.io/u/tihomir) for the excellent assistance with this.\n\nNote that this converged with the CLI being bugged to absolutely screw me over. I went to the CLI pretty fast to debug the connection, but when the debug tool is bugged, it's bad news. Without that happening this would have taken me 1/4 the time, but with both converging at once, I was pretty doomed.","createdAt":"2025-04-27T23:40:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1935#issuecomment-2833697894","viewerDidAuthor":false}],"createdAt":"2025-04-26T23:38:52Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1935,"reactionGroups":[],"state":"CLOSED","title":"client.Dial HostPort does not resolve Docker container DNS names","updatedAt":"2025-04-29T15:27:47Z","url":"https://github.com/temporalio/sdk-go/issues/1935"}
