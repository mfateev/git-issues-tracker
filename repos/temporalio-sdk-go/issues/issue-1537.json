{"assignees":[],"author":{"id":"MDQ6VXNlcjE5MjI5NTc=","is_bot":false,"login":"theverything","name":"Jeffrey Horn"},"body":"## Expected Behavior\r\n\r\nWhen using the go SDK I should be able to connect to the server.\r\n\r\n## Actual Behavior\r\n\r\nWhen using go SDK version `1.27.0` I get `failed reaching server: context deadline exceeded` when trying to connect to the server.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nThe sdk version was bumped from `1.26.1` to `1.27.0` in the cli\r\n\r\n  1. use the `temporal` cli @v0.13.0 `temporal operator cluster system` call succeeds \r\n  1. use the `temporal` cli @v0.13.1 `temporal operator cluster system` call fails \r\n\r\n## Specifications\r\n\r\n  - Version: temporal server `v1.22.0`\r\n  - Platform: Mac\r\n","closedAt":"2024-07-03T20:45:56Z","comments":[{"id":"IC_kwDODN1w686Djc_P","author":{"login":"theverything"},"authorAssociation":"NONE","body":"I didn't see anything in the release notes about min version of temporal server required","createdAt":"2024-07-03T19:54:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207109071","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjdXY","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"The Go SDK has no minimum version of the server required","createdAt":"2024-07-03T19:55:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207110616","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjeRI","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"To be clear is the bug report the `temporal` cli cannot connect to the server or the Go SDK cannot connect?","createdAt":"2024-07-03T19:56:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207114312","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjorJ","author":{"login":"theverything"},"authorAssociation":"NONE","body":"> To be clear is the bug report the `temporal` cli cannot connect to the server or the Go SDK cannot connect?\r\n\r\nGo SDK. The reproduce steps use the temporal cli because it has the same issue.","createdAt":"2024-07-03T20:11:49Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207156937","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Djrrc","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Testing `temporal` `v0.13.0` and `v0.13.1` I have not issue connecting to my local Temporal server or Temporal Cloud. The Go SDK integration tests also verify connecting against a local server started with docker, a local server started with the CLI and Temporal Cloud. Could you provide some additional details about how you are setting up your server and trying to connect?","createdAt":"2024-07-03T20:17:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207169244","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjuBF","author":{"login":"theverything"},"authorAssociation":"NONE","body":"Additional context.\r\n\r\nWe use tls to connect. Here is a basic go program. This works with `v1.26.1` and fails with `1.27.0`\r\n\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"crypto/tls\"\r\n\t\"net\"\r\n\r\n\t\"go.temporal.io/sdk/client\"\r\n)\r\n\r\nfunc main() {\r\n\taddr := \"temporal-frontend.internal.net:443\"\r\n\thost, _, err := net.SplitHostPort(addr)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tc, err := client.Dial(client.Options{\r\n\t\tHostPort:  addr,\r\n\t\tNamespace: \"default\",\r\n\t\tConnectionOptions: client.ConnectionOptions{\r\n\t\t\tTLS: &tls.Config{\r\n\t\t\t\tMinVersion: tls.VersionTLS12,\r\n\t\t\t\tNextProtos: []string{\r\n\t\t\t\t\t\"h2\",\r\n\t\t\t\t},\r\n\t\t\t\tServerName:         host,\r\n\t\t\t\tInsecureSkipVerify: false,\r\n\t\t\t},\r\n\t\t},\r\n\t})\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tdefer c.Close()\r\n\r\n\t_, err = c.CheckHealth(context.Background(), &client.CheckHealthRequest{})\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tprintln(\"SERVING\")\r\n}\r\n```","createdAt":"2024-07-03T20:21:07Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207178821","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjwpO","author":{"login":"theverything"},"authorAssociation":"NONE","body":"The equivalent cli command would look like \r\n\r\n`temporal operator cluster health --address=temporal-frontend.internal.net:443 --tls`","createdAt":"2024-07-03T20:25:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207189582","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjwwZ","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Can you try  specifying `addr :=  \"passthrough:///temporal-frontend.internal.net:443\"`\r\n","createdAt":"2024-07-03T20:25:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207190041","viewerDidAuthor":false},{"id":"IC_kwDODN1w686DjyYL","author":{"login":"theverything"},"authorAssociation":"NONE","body":"> Can you try specifying `addr := \"passthrough:///temporal-frontend.internal.net:443\"`\r\n\r\n`address passthrough:///temporal-frontend.internal.net:443: too many colons in address`","createdAt":"2024-07-03T20:27:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207196683","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Dj0mD","author":{"login":"theverything"},"authorAssociation":"NONE","body":"Looks like I need to add the `passthrough:///` only to the `HostPort` config key. When I do that it works.\r\n\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"crypto/tls\"\r\n\t\"fmt\"\r\n\t\"net\"\r\n\r\n\t\"go.temporal.io/sdk/client\"\r\n)\r\n\r\nfunc main() {\r\n\taddr := \"axon-temporal-frontend.dna-compute-qa.zg-int.net:443\"\r\n\thost, _, err := net.SplitHostPort(addr)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tc, err := client.Dial(client.Options{\r\n\t\tHostPort:  fmt.Sprintf(\"passthrough:///%s\", addr),\r\n\t\tNamespace: \"default\",\r\n\t\tIdentity:  \"hello-world\",\r\n\t\tConnectionOptions: client.ConnectionOptions{\r\n\t\t\tTLS: &tls.Config{\r\n\t\t\t\tMinVersion: tls.VersionTLS12,\r\n\t\t\t\tNextProtos: []string{\r\n\t\t\t\t\t\"h2\",\r\n\t\t\t\t},\r\n\t\t\t\tServerName:         host,\r\n\t\t\t\tInsecureSkipVerify: false,\r\n\t\t\t},\r\n\t\t},\r\n\t})\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tdefer c.Close()\r\n\r\n\t_, err = c.CheckHealth(context.Background(), &client.CheckHealthRequest{})\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tprintln(\"SERVING\")\r\n}\r\n```","createdAt":"2024-07-03T20:31:03Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207205763","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Dj1OL","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Yes, sorry I missed the line where you are also trying to extract the host name as well.","createdAt":"2024-07-03T20:31:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207208331","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Dj10z","author":{"login":"theverything"},"authorAssociation":"NONE","body":"Is the `passthrough:///` documented somewhere? ","createdAt":"2024-07-03T20:32:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207210803","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Dj2_0","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Yes it is called out in the release notes \r\n\r\nedit: Specifically under `Internally call grpc.NewClient instead of grpc.Dial`\r\n\r\nhttps://github.com/temporalio/sdk-go/releases/tag/v1.27.0\r\n\r\nhttps://grpc.io/docs/guides/custom-name-resolution/","createdAt":"2024-07-03T20:34:33Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207215604","viewerDidAuthor":false},{"id":"IC_kwDODN1w686Dj5Mu","author":{"login":"theverything"},"authorAssociation":"NONE","body":"Thank you for your help @Quinn-With-Two-Ns ","createdAt":"2024-07-03T20:38:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1537#issuecomment-2207224622","viewerDidAuthor":false}],"createdAt":"2024-07-03T19:53:13Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1537,"reactionGroups":[],"state":"CLOSED","title":"Unable to connect to cluster after updating to 1.27.0","updatedAt":"2024-07-03T20:45:56Z","url":"https://github.com/temporalio/sdk-go/issues/1537"}
