{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nNo way to determine via metrics alone that all internal workers are busy and therefore not accepting new tasks.\r\n\r\n**Describe the solution you'd like**\r\n\r\nNeed at least a metric showing how many workers are busy/running (consider a label per worker type). If possible, include a metric showing that the system is blocked.\r\n\r\n**Additional context**\r\n\r\nNote, while a deadlock error does exist for workflows at https://github.com/temporalio/sdk-go/blob/6bbdd9eeef901bf5b7782114724d5ad906ba7f2e/internal/internal_workflow.go#L890 with a timeout, there may not be one for activities and we can consider such an option (keeping in mind that activity tasks are known to be potentially long running).\r\n","closedAt":"2021-11-23T17:28:02Z","comments":[{"id":"IC_kwDODN1w6844ZEUw","author":{"login":"jmoseley"},"authorAssociation":"NONE","body":"This is great. I think another useful metric would be a measure of how much of the thread pool is available. This would let us dynamically scale our fleet when we reach X% capacity.","createdAt":"2021-10-18T19:27:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/594#issuecomment-946095408","viewerDidAuthor":false},{"id":"IC_kwDODN1w6844cHjo","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"> Need at least a metric showing how many workers are busy/running (consider a label per worker type). If possible, include a metric showing that the system is blocked.\r\n\r\nFYI workers isn't the relevant metric here (users almost never will have more than one worker per process, they can, but it's unusual). The thing we're really looking for here is number of active workflows & activities, as in the options you can specify a max number of concurrent workflows/activities you'll allow (per worker). Possibly better is to actually report the number of currently free slots, rather than number used.\r\n\r\nAs for the deadlock, I don't think there's anything to be done automatically for activities. Heartbeating is the mechanism for ensuring running activities are making progress.\r\n","createdAt":"2021-10-19T16:29:07Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/594#issuecomment-946895080","viewerDidAuthor":false},{"id":"IC_kwDODN1w6844cKSz","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> FYI workers isn't the relevant metric here (users almost never will have more than one worker per process, they can, but it's unusual).\r\n\r\nYes, sorry, I meant the internal worker concept in the Go SDK, not Temporal workers. I should call this \"concurrent tasks\" or something.\r\n\r\n> As for the deadlock, I don't think there's anything to be done automatically for activities. Heartbeating is the mechanism for ensuring running activities are making progress.\r\n\r\nAgreed, I can't think of anything to do here to report activity blocking. I think all we can really do is have a gauge for running tasks and a fixed metric for max tasks (or maybe not so fixed once #569 is done).","createdAt":"2021-10-19T16:42:49Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/594#issuecomment-946906291","viewerDidAuthor":false},{"id":"IC_kwDODN1w6844cKtf","author":{"login":"jmoseley"},"authorAssociation":"NONE","body":"> a gauge for running tasks and a fixed metric for max tasks\r\n\r\nThat would let me determine if my fleet of workers is large enough for the workload or not, which would be very useful.","createdAt":"2021-10-19T16:44:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/594#issuecomment-946907999","viewerDidAuthor":false}],"createdAt":"2021-10-18T19:21:06Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":594,"reactionGroups":[],"state":"CLOSED","title":"Metric for determining task pool status","updatedAt":"2021-11-23T17:28:02Z","url":"https://github.com/temporalio/sdk-go/issues/594"}
