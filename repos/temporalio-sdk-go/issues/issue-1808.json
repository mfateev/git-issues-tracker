{"assignees":[],"author":{"id":"MDQ6VXNlcjEwMDgyNTI=","is_bot":false,"login":"timofurrer","name":"Timo Furrer"},"body":"**Is your feature request related to a problem? Please describe.**\n\nI want to be able to easily attach business-related log fields to the log messages the SDK logs internally for workflows and activities.\n\nOne of such logs is \n\nhttps://github.com/temporalio/sdk-go/blob/6e75f6d1f22170f2aa3f89348a237955f6a28e96/internal/internal_task_handlers.go#L2271\n\nThe business-related values I want to attach are only known during workflow and activity creation and NOT during worker initialization. \n\n**Describe the solution you'd like**\n\nConfiguring them via `StartWorkflowOptions` and `ActivityOptions` seems desirable. \n\n**Describe alternatives you've considered**\n\nI've looked into using Interceptors, but the problem with them is that I have to register them at worker initialization and don't know the values at that point. I've looked into using custom search attributes or memos - which both would work but only exist of Workflows and not Activities. I also haven't found a way to easily retrieve the search attributes / memos of the workflow given an activity context. \n\nThe elaborate on the search attributes / memos approach: I basically would register an interceptor that reads the search attributes / memos from the workflow context and create a new logger with them that is returned.\n\nWhat I want to avoid is having to query that data from within the activity interceptor from an \"external\" system.\n\n**Additional context**\nAdd any other context or screenshots about the feature request here.\n","closedAt":"2025-10-01T16:45:50Z","comments":[{"id":"IC_kwDODN1w686d2JcH","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> but the problem with them is that I have to register them at worker initialization and don't know the values at that point\n\nYou don't need to know the values at that point, both activity and workflow outbound interceptors have `GetLogger` you can customize when called. https://github.com/temporalio/samples-go/tree/main/interceptor shows how to write the interceptor, but you can use the workflow/activity context in the interceptor to get workflow/activity-specific things like memo (or values via context propagation which may make more sense).\n\nDoes this help?","createdAt":"2025-02-10T14:45:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1808#issuecomment-2648217351","viewerDidAuthor":false},{"id":"IC_kwDODN1w686d3ARW","author":{"login":"timofurrer"},"authorAssociation":"NONE","body":"> You don't need to know the values at that point, both activity and workflow outbound interceptors have `GetLogger` you can customize when called. https://github.com/temporalio/samples-go/tree/main/interceptor shows how to write the interceptor, but you can use the workflow/activity context in the interceptor to get workflow/activity-specific things like memo (or values via context propagation which may make more sense).\n\nAre context values being persisted across activity / workflow retries\nand such?\n","createdAt":"2025-02-10T15:42:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1808#issuecomment-2648441942","viewerDidAuthor":false},{"id":"IC_kwDODN1w686efvhY","author":{"login":"timofurrer"},"authorAssociation":"NONE","body":"@cretz while working on tracing for the SDK I implemented a context propagator - is that would I can use to persist the context values and use it for the logger? ","createdAt":"2025-02-14T11:44:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1808#issuecomment-2659121240","viewerDidAuthor":false},{"id":"IC_kwDODN1w686ehWJt","author":{"login":"timofurrer"},"authorAssociation":"NONE","body":"@cretz I'm still struggling to get this working with what you suggested. I've implemented a context propagator that records my \"values\" into the contexts. I've also implemented a worker interceptor that, through the chain of the other interceptor implements `GetLogger()`. Something along the lines of this:\n\n```go\npackage server\n\nimport (\n\t\"context\"\n\n\t\"gitlab.com/gitlab-org/cluster-integration/gitlab-agent/v17/internal/tool/logz\"\n\t\"go.temporal.io/sdk/interceptor\"\n\ttlog \"go.temporal.io/sdk/log\"\n\t\"go.temporal.io/sdk/workflow\"\n)\n\ntype loggerInterceptor struct {\n\tinterceptor.WorkerInterceptorBase\n}\n\nfunc newLoggerInterceptor() *loggerInterceptor {\n\treturn &loggerInterceptor{}\n}\n\nfunc (w *loggerInterceptor) InterceptActivity(ctx context.Context, next interceptor.ActivityInboundInterceptor) interceptor.ActivityInboundInterceptor {\n\ti := &loggerActivityInboundInterceptor{root: w}\n\ti.Next = next\n\treturn i\n}\n\ntype loggerActivityInboundInterceptor struct {\n\tinterceptor.ActivityInboundInterceptorBase\n\troot *loggerInterceptor\n}\n\nfunc (a *loggerActivityInboundInterceptor) Init(outbound interceptor.ActivityOutboundInterceptor) error {\n\ti := &loggerActivityOutboundInterceptor{root: a.root}\n\ti.Next = outbound\n\treturn a.Next.Init(i)\n}\n\ntype loggerActivityOutboundInterceptor struct {\n\tinterceptor.ActivityOutboundInterceptorBase\n\troot *loggerInterceptor\n}\n\nfunc (a *loggerActivityOutboundInterceptor) GetLogger(ctx context.Context) tlog.Logger {\n\tlogger := a.Next.GetLogger(ctx)\n\n\tvalues, ok := ctx.Value(contextPropagatorKey).(contextPropagatorValues)\n\tif !ok {\n\t\tlogger.Warn(\"the passed context to the interceptor didn't contain the expected context propagator values\")\n\t\treturn logger\n\t}\n\n\tlogger = tlog.With(logger,\n\t\tlogz.ProjectIDN(values.ProjectID), logz.EventID(values.EventID), logz.EventType(values.EventType))\n\treturn logger\n}\n\nfunc (w *loggerInterceptor) InterceptWorkflow(ctx workflow.Context, next interceptor.WorkflowInboundInterceptor) interceptor.WorkflowInboundInterceptor {\n\ti := &loggerWorkflowInboundInterceptor{root: w}\n\ti.Next = next\n\treturn i\n}\n\ntype loggerWorkflowInboundInterceptor struct {\n\tinterceptor.WorkflowInboundInterceptorBase\n\troot *loggerInterceptor\n}\n\nfunc (w *loggerWorkflowInboundInterceptor) Init(outbound interceptor.WorkflowOutboundInterceptor) error {\n\ti := &loggerWorkflowOutboundInterceptor{root: w.root}\n\ti.Next = outbound\n\treturn w.Next.Init(i)\n}\n\ntype loggerWorkflowOutboundInterceptor struct {\n\tinterceptor.WorkflowOutboundInterceptorBase\n\troot *loggerInterceptor\n}\n\nfunc (w *loggerWorkflowOutboundInterceptor) GetLogger(ctx workflow.Context) tlog.Logger {\n\tlogger := w.Next.GetLogger(ctx)\n\n\tvalues, ok := ctx.Value(contextPropagatorKey).(contextPropagatorValues)\n\tif !ok {\n\t\tlogger.Warn(\"the passed context to the interceptor didn't contain the expected context propagator values\")\n\t\treturn logger\n\t}\n\n\tlogger = tlog.With(logger,\n\t\tlogz.ProjectIDN(values.ProjectID), logz.EventID(values.EventID), logz.EventType(values.EventType))\n\treturn logger\n}\n```\n\nHowever, I'm only seeing \"my\" logger, with my fields for the logs I'm doing in the workflows and activities. That's desired, but all SDK internal logs are missing these fields - it's seems like it's not getting the logger through my `GetLogger()` implementations.\n\nSome example log calls I expect to have my fields:\n\n- https://github.com/temporalio/sdk-go/blob/4fb50dc4729f6dbd41874a8e303b5246f912b244/internal/internal_event_handlers.go#L775\n- https://github.com/temporalio/sdk-go/blob/4fb50dc4729f6dbd41874a8e303b5246f912b244/internal/internal_event_handlers.go#L625\n\n@cretz are we facing some variation of https://github.com/temporalio/sdk-go/issues/829 ?\n\ncc @ktenzer","createdAt":"2025-02-14T14:56:08Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1808#issuecomment-2659541613","viewerDidAuthor":false},{"id":"IC_kwDODN1w686ehxPu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Ah, the interceptor and customizations are for when you call `GetLogger` in your activity or workflow. Yes, this is a duplicate of #829 if you're trying to customize internal logger use on a per-workflow basis. For those two log situations, you should consider using your own log statements in your own interceptor instead of relying on debug logs from the internals of the SDK.","createdAt":"2025-02-14T15:38:30Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1808#issuecomment-2659652590","viewerDidAuthor":false},{"id":"IC_kwDODN1w686esIS5","author":{"login":"timofurrer"},"authorAssociation":"NONE","body":"> For those two log situations, you should consider using your own log statements in your own interceptor instead of relying on debug logs from the internals of the SDK.\n\n@cretz the two last examples I've referenced were indeed `Debug` logs, but the one I've referenced initially is an error log. (https://github.com/temporalio/sdk-go/blob/6e75f6d1f22170f2aa3f89348a237955f6a28e96/internal/internal_task_handlers.go#L2271) Those are especially useful if they would have the proper log fields. Yes, I may be able to use an interceptor to also log my own message on errors or maybe even just log the errors in the Workflows / Activities before returning one - but then we always have duplicate error logs which is not optimal. In addition, you may just introduce more logs to the SDK with different levels and \"pollute\" the app logs. \n\nHaving a solution for https://github.com/temporalio/sdk-go/issues/829 would help I suppose.\n","createdAt":"2025-02-17T08:22:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1808#issuecomment-2662368441","viewerDidAuthor":false}],"createdAt":"2025-02-10T13:43:01Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1808,"reactionGroups":[],"state":"CLOSED","title":"Configure extra log fields for SDK workflow and activity logs","updatedAt":"2025-10-01T16:45:50Z","url":"https://github.com/temporalio/sdk-go/issues/1808"}
