{"assignees":[],"author":{"id":"MDQ6VXNlcjIyNzIwNDc1","is_bot":false,"login":"phudtran","name":"Phu Tran"},"body":"## Expected Behavior\r\n\r\nWorker executes 1 workflow at a time.\r\n\r\n## Actual Behavior\r\n\r\nWorker does nothing\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a new worker\r\n  1. Set MaxConcurrentWorkflowTaskExecutionSize to 1 in the worker options\r\n\r\n## Specifications\r\n\r\n  - Version: v1.19.0\r\n  - Platform: Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-1026-aws x86_64)\r\n","closedAt":"2023-01-16T11:34:47Z","comments":[{"id":"IC_kwDODN1w685SZ3IC","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"The minimal size is 2 for it to work. This is known behavior and is documented. \r\nFor SDK to consider better handle this case either by automatically promote to 2 or error out.","createdAt":"2023-01-13T22:43:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1003#issuecomment-1382511106","viewerDidAuthor":false},{"id":"IC_kwDODN1w685SaVig","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"Sorry, I confused this setting with workflow task _pollers_ (which does have min 2) and mentioned it to Yimin, so that was my mistake. As far as I know this limitation is not documented or known.","createdAt":"2023-01-14T02:14:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1003#issuecomment-1382635680","viewerDidAuthor":false},{"id":"IC_kwDODN1w685SaV_V","author":{"login":"phudtran"},"authorAssociation":"NONE","body":"I noticed the other documented settings had this limitation so I tried setting MaxConcurrentWorkflowTaskExecutionSize to 2. It seems to do the correct behavior in my tests last week :grinning:\r\n","createdAt":"2023-01-14T02:23:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1003#issuecomment-1382637525","viewerDidAuthor":false},{"id":"IC_kwDODN1w685SaWg-","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"(Btw limiting concurrent workflow task execution is probably not the right solution for anything. If you share why you wanted to do this you might get a better alternative.)","createdAt":"2023-01-14T02:33:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1003#issuecomment-1382639678","viewerDidAuthor":false},{"id":"IC_kwDODN1w685SaYtO","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Looks like we limit the number of pollers to `MaxConcurrentWorkflowTaskExecutionSize ` so the worker will only be polling on the sticky queue, so it will never pick up work. So the root cause is the same reason we need 2 workflow task pollers\r\n\r\nNote: Technically we do create `maxConcurrentWorkflowTaskPollers ` number of pollers , but only really start `MaxConcurrentWorkflowTaskExecutionSize `\r\n\r\n`MaxConcurrentWorkflowTaskExecutionSize` should never be less than `MaxConcurrentWorkflowTaskPollers `\r\n\r\nWe call this out here https://docs.temporal.io/application-development/worker-performance#invariants but say it only applies to java which is not true it also applies to the go sdk from reading the code.\r\n\r\nBasically we need to document this and probably force `MaxConcurrentWorkflowTaskExecutionSize` to be greater than `MaxConcurrentWorkflowTaskPollers `","createdAt":"2023-01-14T03:23:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1003#issuecomment-1382648654","viewerDidAuthor":false},{"id":"IC_kwDODN1w685SaakS","author":{"login":"phudtran"},"authorAssociation":"NONE","body":"> (Btw limiting concurrent workflow task execution is probably not the right solution for anything. If you share why you wanted to do this you might get a better alternative.)\r\n\r\nWe're in the early stages of using Temporal for a cloud simulation project.\r\nIn our case, we're using workflows to represent a _set of VMs_ to be created on a Node, and activities representing each of the VMs to be created. I only stumbled upon this MaxConcurrentWorkflowTaskExecutionSize behavior because of a temporary accommodation for an upstream service in test. ","createdAt":"2023-01-14T04:15:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1003#issuecomment-1382656274","viewerDidAuthor":false}],"createdAt":"2023-01-06T23:31:36Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1003,"reactionGroups":[],"state":"CLOSED","title":"Setting MaxConcurrentWorkflowTaskExecutionSize to 1 results in worker not executing any tasks","updatedAt":"2023-01-16T11:34:47Z","url":"https://github.com/temporalio/sdk-go/issues/1003"}
