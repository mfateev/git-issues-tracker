{"assignees":[{"id":"MDQ6VXNlcjEzMTE2OTQ=","login":"vitarb","name":"Vitali","databaseId":0}],"author":{"id":"MDQ6VXNlcjEyODU5","is_bot":false,"login":"jmcnevin","name":"Jeremy McNevin"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nThis may be related to https://github.com/temporalio/sdk-go/issues/277.\r\n\r\nIn order to use a custom claims mapper / authorizer in the server, we need to be able to inject authorization metadata into the client request, but this isn't currently possible with the sdk.  I've been able to fork SDK to allow for the injection of a ` grpc.UnaryClientInterceptor` via the `ConnectionOptions` struct in order to do this, but I would like to see what the Temporal team's strategy is for doing this.\r\n\r\n**Describe the solution you'd like**\r\n\r\nAnything that will allow the injection of authorization metadata into the outgoing grpc context.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nThere are probably more elegant solutions than I've put together, including the creation of some sort of AuthTokenGetter interface.","closedAt":"2021-02-24T00:21:21Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc3MTE3NjY3MA==","author":{"login":"jmcnevin"},"authorAssociation":"NONE","body":"FWIW: this is the entirety of my current solution:\r\n\r\n```diff\r\ndiff --git a/internal/client.go b/internal/client.go\r\nindex 58c4fa6..6bfbcee 100644\r\n--- a/internal/client.go\r\n+++ b/internal/client.go\r\n@@ -393,9 +393,10 @@ type (\r\n\r\n        // ConnectionOptions is provided by SDK consumers to control optional connection params.\r\n        ConnectionOptions struct {\r\n-               TLS                *tls.Config\r\n-               DisableHealthCheck bool\r\n-               HealthCheckTimeout time.Duration\r\n+               TLS                    *tls.Config\r\n+               DisableHealthCheck     bool\r\n+               HealthCheckTimeout     time.Duration\r\n+               CredentialsInterceptor grpc.UnaryClientInterceptor\r\n        }\r\n\r\n        // StartWorkflowOptions configuration parameters for starting a workflow execution.\r\ndiff --git a/internal/grpc_dialer.go b/internal/grpc_dialer.go\r\nindex bf23eb7..382701a 100644\r\n--- a/internal/grpc_dialer.go\r\n+++ b/internal/grpc_dialer.go\r\n@@ -64,7 +64,6 @@ func dial(params dialParameters) (*grpc.ClientConn, error) {\r\n        if params.UserConnectionOptions.TLS != nil {\r\n@@ -64,7 +64,6 @@ func dial(params dialParameters) (*grpc.ClientConn, error) {\r\n        if params.UserConnectionOptions.TLS != nil {\r\n                grpcSecurityOptions = grpc.WithTransportCredentials(credentials.NewTLS(params.UserConnectionOptions.TLS))\r\n        }\r\n-\r\n        // gRPC maintains connection pool inside grpc.ClientConn.\r\n        // This connection pool has auto reconnect feature.\r\n        // If connection goes down, gRPC will try to reconnect using exponential backoff strategy:\r\n@@ -78,12 +77,19 @@ func dial(params dialParameters) (*grpc.ClientConn, error) {\r\n        cp.Backoff.BaseDelay = retryPollOperationInitialInterval\r\n        cp.Backoff.MaxDelay = retryPollOperationMaxInterval\r\n\r\n-       return grpc.Dial(params.HostPort,\r\n+       interceptors := params.RequiredInterceptors\r\n+       if i := params.UserConnectionOptions.CredentialsInterceptor; i != nil {\r\n+               interceptors = append(interceptors, i)\r\n+       }\r\n+\r\n+       dialOptions := []grpc.DialOption{\r\n                grpcSecurityOptions,\r\n-               grpc.WithChainUnaryInterceptor(params.RequiredInterceptors...),\r\n+               grpc.WithChainUnaryInterceptor(interceptors...),\r\n                grpc.WithDefaultServiceConfig(params.DefaultServiceConfig),\r\n                grpc.WithConnectParams(cp),\r\n-       )\r\n+       }\r\n+\r\n+       return grpc.Dial(params.HostPort, dialOptions...)\r\n }\r\n\r\n func requiredInterceptors(metricScope tally.Scope) []grpc.UnaryClientInterceptor {\r\n```","createdAt":"2021-02-01T21:38:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/353#issuecomment-771176670","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc4Mzg0NDk0Mg==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"#368 should address this issue.","createdAt":"2021-02-23T03:08:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/353#issuecomment-783844942","viewerDidAuthor":false}],"createdAt":"2021-02-01T21:36:45Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":353,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Allow the injection of additional grpc client interceptors","updatedAt":"2021-02-24T00:21:21Z","url":"https://github.com/temporalio/sdk-go/issues/353"}
