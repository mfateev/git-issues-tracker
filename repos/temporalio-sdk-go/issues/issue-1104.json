{"assignees":[],"author":{"id":"MDQ6VXNlcjc2OTc0ODQ=","is_bot":false,"login":"taonic","name":"Tao Guo"},"body":"## Expected Behavior\r\n\r\nWhen a context with timeout (e.g. 4s as duration) is passed into `client.ExecuteWorkflow`, and it gets a client-side context deadline exceeded error, the method should timeout and return after the designated duration.\r\n\r\n## Actual Behavior\r\n\r\nCurrently, the `client.ExecuteWorkflow` times out after half of the designated duration, 2s instead of 4s as an example.\r\n\r\nCode to reproduce:\r\n\r\n```go\r\n\ttimeout := 4 * time.Second\r\n\tctx, cancel := context.WithTimeout(context.Background(), timeout)\r\n\tdefer cancel()\r\n​\r\n\tworkflowOptions := client.StartWorkflowOptions{\r\n\t\tID:        workflowID,\r\n\t\tTaskQueue: \"cancel-activity\",\r\n\t}\r\n​\r\n\tthen := time.Now()\r\n\tfmt.Println(\"ctx before execute: \", ctx)\r\n​\r\n\twe, err := c.ExecuteWorkflow(ctx, workflowOptions, cancellation.YourWorkflow)\r\n\tif err != nil {\r\n\t\tfmt.Println(\"ctx after execute: \", ctx)\r\n\t\tfmt.Printf(\"Time elapsed: %v\", time.Since(then))\r\n\t\tlog.Fatalf(\"Unable to execute workflow %+v\\n\", err)\r\n\t}\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nctx before execute:  context.Background.WithDeadline(2023-05-16 22:12:16.653157 +1000 AEST m=+10.639604834 [3.999887833s])\r\nctx after execute:  context.Background.WithDeadline(2023-05-16 22:12:16.653157 +1000 AEST m=+10.639604834 [1.998066541s])\r\nTime elapsed: 2.001958166s\r\n2023/05/16 22:12:14 Unable to execute workflow context deadline exceeded\r\nexit status 1\r\n```\r\n\r\nWe suspect the behaviour was originally introduced as part of the dynamic retry policy for Cadence server: https://github.com/temporalio/sdk-go/commit/646d94de74a547ee7fa1c649142a9839a52d0a6e#diff-e0628cecb8a238a2d362a0ce845f7f8a8ff26d38942b471d09d7e079b5af55e7R110\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: v1.22.2","closedAt":null,"comments":[{"id":"IC_kwDODN1w685cdm_9","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"To add clarification, we halve the user-provided timeout so we can retry within it, but if server is down we don't retry we get user context deadline exceeded context error (not the server-side gRPC deadline exceeded error code) so it is effectively half. Making RPC timeout half the context timeout is fine, we just need to make sure to only halve the RPC timeout not the context timeout.","createdAt":"2023-05-17T12:00:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1104#issuecomment-1551265789","viewerDidAuthor":false}],"createdAt":"2023-05-17T07:36:11Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1104,"reactionGroups":[],"state":"OPEN","title":"Context timeout is halved on client.ExecuteWorkflow","updatedAt":"2023-05-17T12:00:49Z","url":"https://github.com/temporalio/sdk-go/issues/1104"}
