{"assignees":[],"author":{"id":"MDQ6VXNlcjYxMzA0NTk5","is_bot":false,"login":"emmaCullen","name":"Emma Cullen"},"body":"**Is your feature request related to a problem? Please describe.**\r\nWe would like a way to add the workflow ID as an attribute to spans generated by our GRPC client interceptor. The ID is present in the proto, but we do not always know where it will be and what all of the types are.\r\n\r\nAt the moment we are doing this using a switch as follows. This is brittle as we dont have internal knowledge and if the API changes.\r\n\r\n```\r\n\tswitch v := req.(type) {\r\n\tcase *proto.GetSystemInfoRequest:\r\n\tcase *proto.RegisterNamespaceRequest:\r\n\tcase *proto.ListNamespacesRequest:\r\n\tcase *proto.UpdateNamespaceRequest:\r\n\tcase *proto.DeprecateNamespaceRequest:\r\n\tcase *proto.PollWorkflowTaskQueueRequest:\r\n\tcase *proto.RespondWorkflowTaskCompletedRequest:\r\n\tcase *proto.RespondWorkflowTaskFailedRequest:\r\n\tcase *proto.PollActivityTaskQueueRequest:\r\n\tcase *proto.DescribeNamespaceRequest:\r\n\tcase *proto.RespondActivityTaskCompletedRequest:\r\n\tcase *proto.RequestCancelWorkflowExecutionRequest:\r\n\t\tif v.GetWorkflowExecution() != nil {\r\n\t\t\tid = v.GetWorkflowExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.SignalWorkflowExecutionRequest:\r\n\t\tif v.GetWorkflowExecution() != nil {\r\n\t\t\tid = v.GetWorkflowExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.ResetWorkflowExecutionRequest:\r\n\t\tif v.GetWorkflowExecution() != nil {\r\n\t\t\tid = v.GetWorkflowExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.UpdateWorkflowExecutionRequest:\r\n\t\tif v.GetWorkflowExecution() != nil {\r\n\t\t\tid = v.GetWorkflowExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.TerminateWorkflowExecutionRequest:\r\n\t\tif v.GetWorkflowExecution() != nil {\r\n\t\t\tid = v.GetWorkflowExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.DeleteWorkflowExecutionRequest:\r\n\t\tif v.GetWorkflowExecution() != nil {\r\n\t\t\tid = v.GetWorkflowExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.QueryWorkflowRequest:\r\n\t\tif v.GetExecution() != nil {\r\n\t\t\tid = v.GetExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.ResetStickyTaskQueueRequest:\r\n\t\tif v.GetExecution() != nil {\r\n\t\t\tid = v.GetExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.DescribeWorkflowExecutionRequest:\r\n\t\tif v.GetExecution() != nil {\r\n\t\t\tid = v.GetExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.GetWorkflowExecutionHistoryReverseRequest:\r\n\t\tif v.GetExecution() != nil {\r\n\t\t\tid = v.GetExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.GetWorkflowExecutionHistoryRequest:\r\n\t\tif v.GetExecution() != nil {\r\n\t\t\tid = v.GetExecution().WorkflowId\r\n\t\t}\r\n\tcase *proto.StartBatchOperationRequest:\r\n\t\tif v.GetExecutions() != nil {\r\n\t\t\texecution := v.GetExecutions()\r\n\t\t\tid = execution[0].WorkflowId\r\n\t\t}\r\n\tcase *proto.StartWorkflowExecutionRequest:\r\n\t\tid = v.GetWorkflowId()\r\n\tcase *proto.RecordActivityTaskHeartbeatByIdRequest:\r\n\t\tid = v.GetWorkflowId()\r\n\tcase *proto.RespondActivityTaskCanceledByIdRequest:\r\n\t\tid = v.GetWorkflowId()\r\n\tcase *proto.RespondActivityTaskFailedByIdRequest:\r\n\t\tid = v.GetWorkflowId()\r\n\tcase *proto.RespondActivityTaskCompletedByIdRequest:\r\n\t\tid = v.GetWorkflowId()\r\n\tcase *proto.SignalWithStartWorkflowExecutionRequest:\r\n\t\tid = v.GetWorkflowId()\r\n\tdefault:\r\n\t\tlog.Debug(ctx, fmt.Sprintf(\"Temporal Workflow Service Unknown request. %v\\n\", req))\r\n\t}\r\n```\r\n\r\n**Describe the solution you'd like**\r\nA function that we can use to pass a request/response and get the workflow ID\r\n\r\n**Describe alternatives you've considered**\r\nThe alternative is not to be able to attach workflow ID to these grpc client spans. Or we can continue to use the above switch statement.\r\n\r\n**Additional context**\r\nAdd any other context or screenshots about the feature request here.\r\n","closedAt":"2023-11-01T12:39:22Z","comments":[{"id":"IC_kwDODN1w685qKCZ2","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> This is brittle as we dont have internal knowledge and if the API changes.\r\n\r\nThe API is public, not internal, and doesn't upgrade unless you upgrade the SDK. The SDK, like anyone, consumes https://github.com/temporalio/api/tree/master/temporal/api/workflowservice/v1 (via https://github.com/temporalio/api-go) and may be upgraded when you upgrade the SDK. I am not sure us taking this same switch statement and putting it in the SDK for this specific use case has enough general-purpose value.\r\n\r\nI think the approach you are taking here makes sense, and we don't really change existing API (or even add workflow ID somewhere it wasn't before), though we may add some entirely new API with workflow ID upon creation.\r\n\r\nWhat many users do in situations where they need to future proof themselves on new API additions is just have a unit test which reflectively goes over the workflow service interface calling their function with an instantiated version of every request type and asserting none fail (i.e. have your method return false that you can ignore in prod but assert against during test). This way you can catch new API additions that are not accounted for.","createdAt":"2023-10-26T12:22:39Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1280#issuecomment-1781016182","viewerDidAuthor":false},{"id":"IC_kwDODN1w685qlIid","author":{"login":"emmaCullen"},"authorAssociation":"NONE","body":"Hi @cretz, yes true you make a good point. If you think our current approach is fine, then we will continue to do that switch ourselves and add that unit test.  \r\n\r\nThanks again for the suggestions.","createdAt":"2023-10-31T22:25:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1280#issuecomment-1788119197","viewerDidAuthor":false},{"id":"IC_kwDODN1w685qoD8C","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":":+1: I do think it is best as opposed to us exposing an extract-workflow-id-from-grpc-request in our public library API","createdAt":"2023-11-01T12:39:22Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1280#issuecomment-1788886786","viewerDidAuthor":false}],"createdAt":"2023-10-26T04:37:53Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1280,"reactionGroups":[],"state":"CLOSED","title":"Requesting a way to expose workflow IDs from relevant worker request response protos","updatedAt":"2023-11-01T12:39:30Z","url":"https://github.com/temporalio/sdk-go/issues/1280"}
