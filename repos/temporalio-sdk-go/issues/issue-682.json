{"assignees":[],"author":{"id":"MDQ6VXNlcjEwMTkxNzE5","is_bot":false,"login":"rainfd","name":"RainFD"},"body":"Cant' test an activity with logger. Is there a way to generate a context with activityInterceptorContextKey ?\r\n\r\n## Expected Behavior\r\n\r\n\r\n## Actual Behavior\r\n```\r\n// activity\r\nfunc (a *Activities) GetFile(ctx context.Context, fileID string) (string, error) {\r\n\tlogger := activity.GetLogger(ctx)\r\n        //...\r\n}\r\n// test method\r\nfunc (s *FileTestSuite) Test_GetFile() {\r\n\tvar err error\r\n\ts.testWavName, err = s.a.GetFile(context.TODO(), s.testWavID)\r\n\ts.NoError(err)\r\n}\r\n// panic code\r\nfunc getActivityOutboundInterceptor(ctx context.Context) ActivityOutboundInterceptor {\r\n\ta := ctx.Value(activityInterceptorContextKey)\r\n\tif a == nil {\r\n\t\tpanic(\"getActivityOutboundInterceptor: Not an activity context\")\r\n\t}\r\n\treturn a.(ActivityOutboundInterceptor)\r\n}\r\n```\r\n\r\n```\r\n--- FAIL: TestFileTestSuite (5.03s)\r\n    --- FAIL: TestFileTestSuite/Test_GetFile (5.01s)\r\n        suite.go:63: test panicked: getActivityOutboundInterceptor: Not an activity context\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: 1.12.0\r\n  - Platform: MacOs Monterey 12.1\r\n","closedAt":"2022-01-05T02:09:30Z","comments":[{"id":"IC_kwDODN1w68475U4F","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"If you want to use an activity context with all the activity bells and whistles, you need to use the `go.temporal.io/sdk/testsuite` package and create a suite and an activity environment.\r\n\r\nUnfortunately I don't see any samples for how to do this (opened https://github.com/temporalio/samples-go/issues/163). But basically it's (untested):\r\n\r\n```go\r\nvar suite testsuite.WorkflowTestSuite\r\nenv := suite.NewTestActivityEnvironment()\r\nvar a Activities\r\nenv.RegisterActivity(a)\r\nval, err := env.ExecuteActivity(a.GetFile, \"some file ID\")\r\n// ...\r\n```","createdAt":"2022-01-04T15:00:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/682#issuecomment-1004883461","viewerDidAuthor":false},{"id":"IC_kwDODN1w68476_nn","author":{"login":"rainfd"},"authorAssociation":"NONE","body":"@cretz Thanks for help. It works\r\n```golang\r\nfunc (s *ActivityTestSuite) TestGetFile() {\r\n        // BEFORE\r\n\t// var err error\r\n\t// s.testWavName, err = s.a.GetFile(context.TODO(), s.testWavID)\r\n\t// s.NoError(err)\r\n\t// defer os.Remove(s.testWavName)\r\n\t// _, err = os.Stat(s.testWavName)\r\n\t// s.NoError(err)\r\n\r\n         // AFTER\r\n\tvar fileName string\r\n\tval, err := s.env.ExecuteActivity(s.a.GetFile, s.testWavID)\r\n\ts.NoError(err)\r\n\r\n\terr = val.Get(&fileName)\r\n\ts.NoError(err)\r\n\r\n\ts.NotEqual(\"\", fileName)\r\n\tos.Remove(fileName)\r\n}\r\n```","createdAt":"2022-01-05T02:09:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/682#issuecomment-1005320679","viewerDidAuthor":false}],"createdAt":"2022-01-04T02:44:58Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":682,"reactionGroups":[],"state":"CLOSED","title":"Failed to test a activity with logger","updatedAt":"2022-01-05T02:09:30Z","url":"https://github.com/temporalio/sdk-go/issues/682"}
