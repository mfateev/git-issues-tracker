{"assignees":[],"author":{"id":"MDQ6VXNlcjEwNDY1NTEz","is_bot":false,"login":"wyrobnik","name":"David Wyrobnik"},"body":"## Expected Behavior\r\nWhen calling [DevServer.Stop()](https://pkg.go.dev/go.temporal.io/sdk/testsuite#DevServer.Stop) eventually the underlying process should stop and the call should return.\r\n\r\n## Actual Behavior\r\n`DevServer.Stop()` hangs and never returns causing test timeouts. Excerpt from the logs:\r\n\r\n```\r\n{\"level\":\"error\",\"ts\":\"2024-01-16T18:24:51.369Z\",\"msg\":\"Membership upsert failed.\",\"error\":\"context canceled\",\"logging-call-at\":\"monitor.go:310\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.22.2/common/log/zap_logger.go:156\\ngo.temporal.io/server/common/membership/ringpop.(*monitor).startHeartbeatUpsertLoop.func1\\n\\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.22.2/common/membership/ringpop/monitor.go:310\"}\r\n\r\n{\"level\":\"warn\",\"ts\":\"2024-01-16T18:12:21.982Z\",\"msg\":\"Failed to cancel outstanding poller.\",\"service\":\"frontend\",\"wf-task-queue-name\":\"localhost:945e3c13-795f-4add-b33d-043cd437ab5b\",\"error\":\"Not enough hosts to serve the request\",\"logging-call-at\":\"workflow_handler.go:4622\"}\r\n\r\n{\"level\":\"error\",\"ts\":\"2024-01-16T18:12:22.014Z\",\"msg\":\"service failures\",\"operation\":\"PollWorkflowTaskQueue\",\"wf-namespace\":\"temporal-system\",\"error\":\"Not enough hosts to serve the request\",\"logging-call-at\"\r\nerceptor.(*TelemetryInterceptor).handleError\\n\\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.22.2/common/rpc/interceptor/telemetry.go:341\\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryIntercept\r\nrg/grpc@v1.59.0/server.go:1163\\ngo.temporal.io/server/service/frontend.(*RedirectionInterceptor).handleRedirectAPIInvocation.func2\\n\\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.22.2/service/frontend/red\r\ny.go:125\\ngo.temporal.io/server/service/frontend.(*RedirectionInterceptor).handleRedirectAPIInvocation\\n\\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.22.2/service/frontend/redirection_interceptor.go:235\\\r\nhainUnaryHandler.func1\\n\\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.59.0/server.go:1163\\ngo.temporal.io/server/common/metrics.NewServerMetricsContextInjectorInterceptor.func1\\n\\t/home/runner/go/pkg/mo\r\nb/instrumentation/google.golang.org/grpc/otelgrpc.UnaryServerInterceptor.func1\\n\\t/home/runner/go/pkg/mod/go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc@v0.42.0/interceptor.go:344\r\n\\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.22.2/common/rpc/interceptor/namespace_logger.go:84\\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\\n\\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.59\r\npace_validator.go:111\\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\\n\\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.59.0/server.go:1163\\ngo.temporal.io/server/common/rpc.ServiceErrorInterceptor\\n\\t/\r\nporal.io/api/workflowservice/v1._WorkflowService_PollWorkflowTaskQueue_Handler\\n\\t/home/runner/go/pkg/mod/go.temporal.io/api@v1.25.0/workflowservice/v1/service.pb.go:1671\\ngoogle.golang.org/grpc.(*Server).pro\r\nogle.golang.org/grpc.(*Server).serveStreams.func1.1\\n\\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.59.0/server.go:986\"}                                                                                   \r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a dev server with `devServer, err := testsuite.StartDevServer`\r\n  1. Interact with it (e.g. start some workflows).\r\n  1. Call `devServer.Stop()`.\r\n\r\n## Specifications\r\n\r\n  - Version: temporal cli v0.10.7, sdk-go v1.25.1 \r\n  - Platform: Ubuntu 20.04.1\r\n","closedAt":null,"comments":[],"createdAt":"2024-01-16T18:35:07Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1360,"reactionGroups":[],"state":"OPEN","title":"`testsuite.DevServer` occasionally does not stop","updatedAt":"2024-01-16T18:35:07Z","url":"https://github.com/temporalio/sdk-go/issues/1360"}
