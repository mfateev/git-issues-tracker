{"assignees":[],"author":{"id":"MDQ6VXNlcjE1ODAwNjU0","is_bot":false,"login":"PatrikValo","name":"pvalo"},"body":"## Expected Behavior\nI would expect that when I test a workflow and I mock an activity with return values like following\n\n```go\ns.env.OnActivity(m.MyActivity, mock.Anything).Return(result, nil)\n```\n\nall executors defined in the test options\n\n```go\ns.env.SetWorkerOptions(\n  worker.Options{\n\t  Interceptors: ...\n  },\n)\n```\n\nare executed.\n\n## Actual Behavior\nIf I mock nonlocal activity with return values, interceptors are not executed. But for example if I mock the local activity in the tests with defined return values, interceptors are executed as expected. Also if I mock activities (local, nonlocal) with a function\n\n```go\ns.env.OnActivity(m.MyActivity, mock.Anything).Return(func (ctx context.Context) (int, error) {\n    return result, nil\n})\n```\n\nit works as expected and interceptors are executed.\n\n## Steps to Reproduce the Problem\n1. Define interceptors in the test environment\n1. Mock non local activity with return values\n1. Run workflow test\n\n## Specifications\n* Version: 1.26\n* Platform: I think problem is on all platforms\n\n## Thoughts\nI think the problematic code lives in the `internal/internal_workflow_testsuite.go`\nhttps://github.com/temporalio/sdk-go/blob/c69831e92d7f52e564421fcb99ed49f693c5acbe/internal/internal_workflow_testsuite.go#L1963-L1975\nIf the mock is a function, we execute the activity executor that calls all interceptors internally. On other if we directly specify return values, we don't use the activity executor and `m.getMockValue(mockRet)` is called. \n\nThere is a workaround to provide a mock function, but it is not comfortable and readable if I have to define a function that just returns values on all places. So theoretically an easy fix could be to just wrap the mocked return values to a function at sdk level and unify the execution paths.\n\n","closedAt":null,"comments":[{"id":"IC_kwDODN1w6859z69B","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Yes we should be consistent between local and normal activities. I'll have to verify what the Java SDK so we can align across SDKs","createdAt":"2024-05-14T17:27:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1468#issuecomment-2110762817","viewerDidAuthor":false},{"id":"IC_kwDODN1w685900rd","author":{"login":"PatrikValo"},"authorAssociation":"NONE","body":"Thanks! Meanwhile I have been looking into this issue and I created a commit - https://github.com/PatrikValo/sdk-go/commit/56f2c792a58e50c5568ecfba3f1fb86e0cce1702, I will not open PR for now and I will wait. Please let me know what you find about the java sdk.","createdAt":"2024-05-14T19:32:48Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1468#issuecomment-2110999261","viewerDidAuthor":false}],"createdAt":"2024-05-11T22:19:11Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1468,"reactionGroups":[],"state":"OPEN","title":"Interceptors are skipped for mocked activities","updatedAt":"2025-02-04T18:24:50Z","url":"https://github.com/temporalio/sdk-go/issues/1468"}
