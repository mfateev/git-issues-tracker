{"assignees":[],"author":{"id":"MDQ6VXNlcjM2NTYxMQ==","is_bot":false,"login":"shaunco","name":"Shaun"},"body":"## Expected Behavior\r\nCalling `RegisterActivity` or `RegisterActivityWithOptions` with a struct instance as the input should scope all struct methods in the Temporal registrations. That is:\r\n```go\r\ntype MyStruct struct {\r\n}\r\n\r\nfunc (m *MyStruct) Activity1(ctx context.Context, bla string) error {\r\n\treturn nil\r\n}\r\n\r\nfunc (m *MyStruct) Activity2(ctx context.Context, bla string) error {\r\n\treturn nil\r\n}\r\n\r\ntype MyOtherStruct struct {\r\n}\r\n\r\nfunc (m *MyOtherStruct) Activity1(ctx context.Context, bla string) error {\r\n\treturn nil\r\n}\r\n\r\nfunc (m *MyOtherStruct) Activity2(ctx context.Context, bla string) error {\r\n\treturn nil\r\n}\r\n\r\n...\r\nworker.RegisterActivity(&MyStruct{})\r\nworker.RegisterActivity(&MyOtherStruct{})\r\n```\r\n\r\nShould produce registrations for:\r\n- `MyStruct.Activity1`\r\n- `MyStruct.Activity2`\r\n- `MyOtherStruct.Activity1`\r\n- `MyOtherStruct.Activity2`\r\n\r\nAnd similarly, calling `ExecuteActivity` or `ExecuteLocalActivity` with a struct instance:\r\n```go\r\n    x := &MyStruct{}\r\n    ExecuteActivity(ctx, x.Activity1, \"test\")\r\n```\r\n\r\nshould similarly scope the activity with the reflected struct name (`MyStruct.Activity1`).\r\n\r\n## Actual Behavior\r\nAs on 1.5.0, this no longer works. When registering, `MyStruct` and `MyOtherStruct` produce naming conflicts. If I then add my own wrapper:\r\n```go\r\n\t\t// If this is a struct, we have to pass the struct type name\r\n\t\tfnType := reflect.TypeOf(act)\r\n\t\tif fnType.Kind() == reflect.Ptr && fnType.Elem().Kind() == reflect.Struct {\r\n\t\t\t// Struct\r\n\t\t\topts := activity.RegisterOptions{Name: fnType.Elem().Name()}\r\n\t\t\tworker.RegisterActivityWithOptions(act, opts)\r\n\t\t} else {\r\n\t\t\t// Regular function\r\n\t\t\tworker.RegisterActivity(act)\r\n\t\t}\r\n```\r\nThen the naming conflicts go away during registration, but the activities only work with `ExecuteLocalActivity` and not with `ExecuteActivity` (_unable to find activity_).\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Try with the 1.4.1 SDK - all is good\r\n2. Try with the 1.5.0 SDK - broken\r\n\r\n## Specifications\r\n\r\n  - Version: 1.5.0\r\n  - Platform: linux\r\n","closedAt":"2021-10-07T19:47:32Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc5MzEzNjc5MQ==","author":{"login":"shaunco"},"authorAssociation":"NONE","body":"Although this all worked great for us (across about 12 workers) pre 1.5.0, I can't find any changes in sdk-go that would have caused this...","createdAt":"2021-03-08T22:40:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/379#issuecomment-793136791","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc5ODgwNjY4NA==","author":{"login":"optiman"},"authorAssociation":"NONE","body":"Probably, this is the reason, but it was much earlier:\r\nhttps://github.com/temporalio/sdk-go/pull/92/files#diff-81f3fd107107ea44dc42925f83354a318280b38ddb7223548848cfc436c1da58\r\n\r\nIf you register activities as struct methods with `Name`, it will be used as prefix for all method names:\r\n```\r\nworker.RegisterActivityWithOptions(&MyStruct{}, activity.RegisterOptions{Name: \"MyStruct\"})\r\n```\r\nBut then you will need to pass string name to `ExecuteActivity`, not method itself:\r\n```\r\nworkflow.ExecuteActivity(ctx, \"MyStruct\" + \"Activity1\", \"test\")\r\n```","createdAt":"2021-03-14T00:20:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/379#issuecomment-798806684","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwMDM1MzE1Mg==","author":{"login":"shaunco"},"authorAssociation":"NONE","body":"Thanks. Could be losing my mind, but we almost exclusively use struct methods for activities and never had to set the Name prefix, \r\n pass a string name to ExecuteActivity, or had any method name conflicts until 1.5.0. The change you referenced looks pretty relevant, but we didn't start using Temporal until July of 2020, so not sure we would have ever seen the old version of that.","createdAt":"2021-03-16T15:17:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/379#issuecomment-800353152","viewerDidAuthor":false},{"id":"IC_kwDODN1w68436lRH","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I have confirmed, even in a fresh 1.4.1 clone, that activities are registered based on their non-qualified method name and to prevent ambiguity for the same method names on different structs a name prefix must be used. I am closing this issue as expected behavior, but please reopen if you feel this is in error. Thanks.","createdAt":"2021-10-07T19:47:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/379#issuecomment-938103879","viewerDidAuthor":false}],"createdAt":"2021-03-08T21:55:27Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":379,"reactionGroups":[],"state":"CLOSED","title":"Registering activities by struct is weird in 1.5.0","updatedAt":"2021-10-07T19:47:32Z","url":"https://github.com/temporalio/sdk-go/issues/379"}
