{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nToday for activities, when you return `temporal.CanceledError` or `context.Canceled`, we send back `RespondActivityTaskCanceledRequest` regardless of whether there was a cancellation in flight. See https://github.com/temporalio/sdk-go/blob/4d6762570b52a77fe6df5a644ca024a1191bc407/internal/internal_task_pollers.go#L974-L987.\r\n\r\n**Describe the solution you'd like**\r\n\r\n* Make sure to only handle those cancelled errors as actually sending a cancel to the server if the server sent us a cancel\r\n* Make sure to wrap `temporal.CanceledError` and `context.Canceled` into a normal retryable `ApplicationFailure` in other cases\r\n* Make sure other SDKs do the same\r\n* Write a test confirming what happens in these situations\r\n* Write a test confirming what happens if an activity is not heartbeating to receive a cancel and returns a failure\r\n* To check potential workflow behavior incompatibility, write a test to confirm what workflow does when we return a canceled error (or go canceled error) when a cancellation was requested and, most importantly, when it was not.","closedAt":"2022-01-14T14:50:22Z","comments":[{"id":"IC_kwDODN1w6847-HmT","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Also see server side PR that errors if you try to cancel activity not expecting it: https://github.com/temporalio/temporal/pull/2344","createdAt":"2022-01-05T22:51:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/686#issuecomment-1006139795","viewerDidAuthor":false}],"createdAt":"2022-01-05T22:41:05Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":686,"reactionGroups":[],"state":"CLOSED","title":"Manually returned activity cancel error without receiving a server-side cancellation","updatedAt":"2022-01-14T14:50:22Z","url":"https://github.com/temporalio/sdk-go/issues/686"}
