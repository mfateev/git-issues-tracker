{"assignees":[],"author":{"id":"MDQ6VXNlcjI2NDYwOA==","is_bot":false,"login":"alenkacz","name":"Alena Varkockova"},"body":"## Expected Behavior\r\nWorkflow will finish\r\n\r\n## Actual Behavior\r\n```\r\n{\"level\":\"warn\",\"ts\":1645115845.2496362,\"caller\":\"log/zap_logger.go:134\",\"msg\":\"Failed to process workflow task.\",\"Namespace\":\"default\",\"TaskQueue\":\"provisioner\",\"WorkerID\":\"1@ring0-provisioner-684cdd5678-mdgzw@\",\"WorkflowType\":\"UpsertDataClusterWorkflow\",\"WorkflowID\":\"CreateDataCluster_org2ctr909\",\"RunID\":\"4bd28470-fe4b-453d-8d26-d83c64ca318c\",\"Attempt\":46,\"Error\":\"lookup failed for scheduledEventID to activityID: scheduleEventID: 35, activityID: 35\",\"logging-call-at\":\"internal_task_pollers.go:308\"}\r\n{\"level\":\"error\",\"ts\":1645115875.377161,\"caller\":\"log/zap_logger.go:142\",\"msg\":\"Workflow panic\",\"Namespace\":\"default\",\"TaskQueue\":\"provisioner\",\"WorkerID\":\"1@ring0-provisioner-684cdd5678-mdgzw@\",\"WorkflowType\":\"UpsertDataClusterWorkflow\",\"WorkflowID\":\"CreateDataCluster_org2ctr909\",\"RunID\":\"4bd28470-fe4b-453d-8d26-d83c64ca318c\",\"Attempt\":49,\"Error\":\"lookup failed for scheduledEventID to activityID: scheduleEventID: 35, activityID: 35\",\"StackTrace\":\"process event for provisioner [panic]:\\ngo.temporal.io/sdk/internal.panicIllegalState(...)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_decision_state_machine.go:395\\ngo.temporal.io/sdk/internal.(*commandsHelper).handleActivityTaskScheduled(0xc00049f720, 0xc000022540, 0x2, 0x23)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_decision_state_machine.go:928 +0x165\\ngo.temporal.io/sdk/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0xc0006352c0, 0xc0007febc0, 0x1, 0x0, 0x0)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_event_handlers.go:824 +0x45b\\ngo.temporal.io/sdk/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0xc0003e81c0, 0xc0006bb140, 0x4514520, 0xc0003f3570, 0xc0003e81c0, 0x0)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_handlers.go:878 +0x7a5\\ngo.temporal.io/sdk/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0xc0001aa370, 0xc0006bb140, 0xc0005d3e30, 0x0, 0x0, 0x0, 0x0)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_handlers.go:727 +0x6d9\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).processWorkflowTask(0xc00065d930, 0xc0006bb140, 0x0, 0x0)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_pollers.go:284 +0x4ae\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).ProcessTask(0xc00065d930, 0x2582ac0, 0xc0006bb140, 0x0, 0x10000c00074b500)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_pollers.go:255 +0x85\\ngo.temporal.io/sdk/internal.(*baseWorker).processTask(0xc000418140, 0x2582680, 0xc000287d60)\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_worker_base.go:398 +0x115\\ncreated by go.temporal.io/sdk/internal.(*baseWorker).runTaskDispatcher\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_worker_base.go:302 +0xff\",\"logging-call-at\":\"internal_task_handlers.go:928\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/go/pkg/mod/go.temporal.io/server@v1.14.5/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/log.(*SdkLogger).Error\\n\\t/go/pkg/mod/go.temporal.io/server@v1.14.5/common/log/sdk_logger.go:83\\ngo.temporal.io/sdk/internal.(*workflowExecutionContextImpl).applyWorkflowPanicPolicy\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_handlers.go:950\\ngo.temporal.io/sdk/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_handlers.go:928\\ngo.temporal.io/sdk/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_handlers.go:727\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).processWorkflowTask\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_pollers.go:284\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).ProcessTask\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_task_pollers.go:255\\ngo.temporal.io/sdk/internal.(*baseWorker).processTask\\n\\t/go/pkg/mod/go.temporal.io/sdk@v1.13.0/internal/internal_worker_base.go:398\"}\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Start a workflow with session\r\n  1. in the middle of session, kill the worker pod\r\n  1. the workflow never finishes and yields the mentioned error\r\n\r\n## Specifications\r\n\r\n  - Version: 1.14.5 of server, 1.13.0 SDK\r\n  - Platform: kubernetes\r\n","closedAt":"2022-04-13T15:24:52Z","comments":[{"id":"IC_kwDODN1w684-LYcf","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I believe this is an offshoot of https://github.com/temporalio/sdk-go/issues/722. Basically if your worker stops mid-session your workflow won't properly work. We are actively addressing.","createdAt":"2022-02-17T16:45:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/732#issuecomment-1043171103","viewerDidAuthor":false},{"id":"IC_kwDODN1w684_QFSN","author":{"login":"simon0191"},"authorAssociation":"NONE","body":"Is this fixed by https://github.com/temporalio/sdk-go/pull/746?","createdAt":"2022-03-07T22:01:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/732#issuecomment-1061180557","viewerDidAuthor":false},{"id":"IC_kwDODN1w684_Srfh","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I do believe it is yes (sorry, forgot to update this when I updated #722). I will leave open until I make a release w/ that fix.","createdAt":"2022-03-08T14:51:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/732#issuecomment-1061861345","viewerDidAuthor":false},{"id":"IC_kwDODN1w685BdQSB","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This has since been released.","createdAt":"2022-04-13T15:24:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/732#issuecomment-1098187905","viewerDidAuthor":false}],"createdAt":"2022-02-17T16:43:23Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":732,"reactionGroups":[],"state":"CLOSED","title":"lookup failed for scheduledEventID to activityID","updatedAt":"2022-04-13T15:24:52Z","url":"https://github.com/temporalio/sdk-go/issues/732"}
