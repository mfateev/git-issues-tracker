{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjIyMzI1MjQ=","is_bot":false,"login":"alexshtin","name":"Alex Shtin"},"body":"Currently we have only [one way](https://github.com/temporalio/temporal-go-client/blob/master/client/client.go#L402) to construct go client:\r\n```\r\nfunc NewClient(service workflowservice.WorkflowServiceClient, domain string, options *Options) Client\r\n```\r\nAnd every caller (customer code) has to do something like [this](https://github.com/temporalio/temporal-go-samples/blob/master/cmd/samples/common/factory.go#L92):\r\n```\r\n\tconnection, err := grpc.Dial(hostPort, grpc.WithInsecure())\r\n\tif err != nil {\r\n\t\t// log error\r\n\t}\r\n\r\n\tclient := client.NewClient(workflowservice.NewWorkflowServiceClient(connection, \"domain\", options))\r\n```\r\nThis is overwhelming and requires deep understanding of go-client internals. Also, now I need to add mandatory interceptors (for error conversion, metrics, and client version headers) and configure default round robin load balancing, which can be done only using `grpc.DialOptions`.\r\n\r\nThe proposal is to change `NewClient` signature to:\r\n```\r\nfunc  NewClient(hostPort, domain string, options *Options) Client\r\n```\r\nand add `GRPCOptions []grpc.DialOptions` to [Options](https://github.com/temporalio/temporal-go-client/blob/master/internal/client.go#L323).\r\n\r\nInternally `NewClient` will merge passed `GRPCOptions` with default mandatory ones. This will keep same extensibility level, hide complexity, and set reasonable defaults.","closedAt":"2020-03-16T20:42:55Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDU5MTAwMjAxNQ==","author":{"login":"mfateev"},"authorAssociation":"MEMBER","body":"I propose to have three separate methods (naming is open for discussion):\r\n```\r\nNewClientLocal(domain string) Client\r\nNewClientByAddress(hostPort, domain string, options *Options) Client\r\nNewClientFromGRPC(service workflowservice.WorkflowServiceClient, domain string, options *Options) Client\r\n```\r\n","createdAt":"2020-02-25T18:35:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/39#issuecomment-591002015","viewerDidAuthor":true},{"id":"MDEyOklzc3VlQ29tbWVudDU5MTAwMzk0Nw==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Replace `status` with `serviceerror` everywhere in go-client tests and [here](https://github.com/temporalio/temporal/blob/master/tools/cli/app_test.go) after implementation.","createdAt":"2020-02-25T18:40:03Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/39#issuecomment-591003947","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDU5MTAwODIzMw==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"We can't continue to support this:\r\n```\r\nNewClientFromGRPC(service workflowservice.WorkflowServiceClient, domain string, options *Options) Client\r\n```\r\nbecause there is no way to add interceptors when you have only client interface and not a connection itself. Actually they can not be even added to existing connection, therefore connection needs to be created internally.\r\n\r\nHonestly, I don't see why we we might need to pass `workflowservice.WorkflowServiceClient`. There is no way to create it besides one single constructor which accepts only connection. And the only way to customize connection creation is to pass `grpc.DialOptions`.\r\n\r\n","createdAt":"2020-02-25T18:49:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/39#issuecomment-591008233","viewerDidAuthor":false}],"createdAt":"2020-02-25T18:15:51Z","labels":[],"milestone":null,"number":39,"reactionGroups":[],"state":"CLOSED","title":"Change client.NewClient signature","updatedAt":"2020-03-16T20:42:55Z","url":"https://github.com/temporalio/sdk-go/issues/39"}
