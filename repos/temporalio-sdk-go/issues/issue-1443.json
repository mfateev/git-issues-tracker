{"assignees":[],"author":{"id":"MDQ6VXNlcjkyMDg1","is_bot":false,"login":"nunofgs","name":"Nuno Sousa"},"body":"The `retry` package in grpc-ecosystem/go-grpc-middleware makes use of golang.org/x/net/trace, which in turn calls text/template, which calls `reflect.Value.MethodByName` severely hampering dead code elimination.\r\n\r\nYou can verify by pointing this with _whydeadcode_:\r\n\r\n```\r\n❯ go build -ldflags=-dumpdep ./cmd |& whydeadcode\r\nreflect.Value.MethodByName reachable from:\r\n\t text/template.(*state).evalField\r\n\t text/template.(*state).evalFieldChain\r\n\t text/template.(*state).evalFieldNode\r\n\t text/template.(*state).evalCommand\r\n\t text/template.(*state).evalPipeline\r\n\t text/template.(*state).walk\r\n\t text/template.(*Template).execute\r\n\t html/template.(*Template).Execute\r\n\t golang.org/x/net/trace.RenderEvents\r\n\t golang.org/x/net/trace.Events\r\n\t golang.org/x/net/trace.Events·f\r\n\t golang.org/x/net/trace.init.0\r\n\t golang.org/x/net/trace..inittask\r\n\t github.com/grpc-ecosystem/go-grpc-middleware/retry..inittask\r\n\t go.temporal.io/sdk/internal..inittask\r\n\t go.temporal.io/sdk/client..inittask\r\n\t main..inittask\r\n\t runtime.main\r\n\t runtime.mainPC\r\n\t runtime.rt0_go\r\n\t _rt0_arm64_darwin\r\n\t main\r\n\t _\r\n```\r\n\r\nIs it possible to work around it?\r\n\r\nAlso reported in https://github.com/grpc-ecosystem/go-grpc-middleware/issues/704.","closedAt":"2024-06-13T14:38:17Z","comments":[{"id":"IC_kwDODN1w68562ulC","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> which calls `reflect.Value.MethodByName` severely hampering dead code elimination.\r\n\r\nHow severely? And is it just this one reflection call or all of reflection? We also use reflection heavily, so unsure if removing that reflection call helps much.\r\n\r\n> Is it possible to work around it?\r\n\r\nI am not sure it's reasonable to work around this issue with a commonly used dependency like `go-grpc-middleware`. Of course if solved upstream we'd gladly take the benefits.","createdAt":"2024-04-17T12:39:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1443#issuecomment-2061166914","viewerDidAuthor":false},{"id":"IC_kwDODN1w686BGImK","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Nothing immediate we can do here `go-grpc-middleware` is a dependency of the SDK. if `go-grpc-middleware` resolves https://github.com/grpc-ecosystem/go-grpc-middleware/issues/704 then we would update to that version.","createdAt":"2024-06-13T14:38:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1443#issuecomment-2165868938","viewerDidAuthor":false}],"createdAt":"2024-04-16T21:54:47Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1443,"reactionGroups":[],"state":"CLOSED","title":"Use of grpc-ecosystem/go-grpc-middleware/retry prevents dead code elimination","updatedAt":"2024-06-13T14:38:17Z","url":"https://github.com/temporalio/sdk-go/issues/1443"}
