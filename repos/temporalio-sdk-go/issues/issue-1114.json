{"assignees":[],"author":{"id":"MDQ6VXNlcjYxODI1OA==","is_bot":false,"login":"aryzhov","name":"Alex Ryzhov"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nI need to make gRPC function calls from my workflows. All gRPC client functions generated by `protoc` have the variadic  parameter `grpc.CallOption`:\r\n\r\n```protobuf\r\ntype SomeClient interface {\r\n\tSomeMethod(ctx context.Context, in *SomeRequest, opts ...grpc.CallOption) (*SomeResponse, error)\r\n}\r\n```\r\n\r\nI am able to register `SomeMethod` as an activity but when I try calling it from a workflow, passing an empty array as the last argument, I get an error:\r\n\r\n```\r\nreflect: cannot use []grpc.CallOption as type grpc.CallOption in Call\r\n```\r\n\r\nI tried different ways of passing the `opts` parameter (omitting, null, a single instance of `grpc.CallOption`) but neither of these ways have worked. \r\n\r\nThe issue is generic and applies to all variadic functions regardless of parameter type. I was able to reproduce the problem by modifying `GreetingSample` and adding a variadic argument to the `GetGreeting` activity.\r\n\r\n**Describe the solution you'd like**\r\n\r\nI can see two ways of implementing this feature:\r\n\r\n1. Pass variadic args as an array to `ExecuteActivity()`. \r\n2. Pass variadic args as individual parameters to `ExecuteActivity()`. \r\n\r\nUpon examining source code, The first option needs a change to `executeFunction()` function in `internal_worker.go` to unpack the array. The second option requires a change to `decodeArgsToRawValues()`, also in `internal_worker.go`. I am not sure which option is better. \r\n\r\n**Describe alternatives you've considered**\r\n\r\nI was able to implement a workaround by creating a utility function:\r\n```golang\r\nfunc wrapGrpcActivity[P any, R any](f func(ctx context.Context, req *P, opts ...grpc.CallOption) (*R, error)) func(ctx context.Context, req *P, opts []grpc.CallOption) (*R, error) {\r\n\treturn func(ctx context.Context, req *P, opts []grpc.CallOption) (*R, error) {\r\n\t\treturn f(ctx, req, opts...)\r\n\t}\r\n}\r\n```\r\n\r\nThen I use the function when registering gRPC methods:\r\n```golang\r\nworker.RegisterActivityWithOptions(wrapGrpcActivity(someClient.SomeMethod), activity.RegisterOptions{Name: \"SomeMethod\"})\r\n```\r\n\r\nand I can invoke the activity as follows:\r\n\r\n```golang\r\nerr := workflow.ExecuteActivity(ctx, \"SomeMethod\", &some.SomeRequest{}, nil).Get(ctx, &resp)\r\n```\r\n\r\n**Additional context**\r\n\r\nI would like to add that supporting variadic args would allow developers more easily integrate existing third party APIs as activities into workflows without additional wrapping.\r\n\r\n\r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDODN1w685c1-s5","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Variadic arguments are supported I believe if you pass the slice instead of just a single value. I think this a reasonable compromise currently.\r\n\r\nYour code will not work anyways. `grpc.CallOption` is not a convertible/serializable value. You should use a wrapper, you cannot expose gRPC client calls directly with their non-serializable arugments as activities.","createdAt":"2023-05-22T17:55:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1114#issuecomment-1557654329","viewerDidAuthor":false},{"id":"IC_kwDODN1w685c2OmJ","author":{"login":"aryzhov"},"authorAssociation":"NONE","body":"@cretz Let me answer the two points you made separately. First, as I had indicated, this is a generic issue, not specific to gRPC. I was able to reproduce it with an example GreetingService. If I add a variadic parameter:\r\n```golang\r\nfunc (a *Activities) GetGreeting(p ...string) (string, error) {\r\n```\r\nand then change `GreetingSample` to pass this parameter:\r\n```golang\r\nerr := workflow.ExecuteActivity(ctx, a.GetGreeting, []string{\"a\", \"b\"}).Get(ctx, &greetResult)\r\n```\r\nI get an error:\r\n```\r\nreflect: cannot use []string as type string in Call\r\n```\r\nThere is a stack trace:\r\n```\r\nreflect.Value.call({0x103142400?, 0x140002a05c0?, 0x12af355e8?}, {0x102f8ba78, 0x4}, {0x140000a1428, 0x1, 0x0?})\r\n        /opt/homebrew/opt/go/libexec/src/reflect/value.go:453 +0x13c0\r\nreflect.Value.Call({0x103142400?, 0x140002a05c0?, 0x14000447778?}, {0x140000a1428?, 0x140000a4310?, 0x9?})\r\n        /opt/homebrew/opt/go/libexec/src/reflect/value.go:370 +0x90\r\ngo.temporal.io/sdk/internal.executeFunction({0x103142400, 0x140002a05c0}, {0x140001e8950, 0x1, 0x103275101?})\r\n        /Users/alex/go/pkg/mod/go.temporal.io/sdk@v1.22.2/internal/internal_worker.go:1796 +0x318\r\ngo.temporal.io/sdk/internal.executeFunctionWithContext({0x1032751b8?, 0x140004403c0}, {0x103142400, 0x140002a05c0}, {0x140001e8950, 0x1, 0x1})\r\n        /Users/alex/go/pkg/mod/go.temporal.io/sdk@v1.22.2/internal/internal_worker.go:1780 +0x160\r\ngo.temporal.io/sdk/internal.(*activityEnvironmentInterceptor).ExecuteActivity(0x140000b6a80, {0x103275180?, 0x14000440360?}, 0x140000a1410)\r\n```\r\n","createdAt":"2023-05-22T18:42:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1114#issuecomment-1557719433","viewerDidAuthor":false},{"id":"IC_kwDODN1w685c2Rh2","author":{"login":"aryzhov"},"authorAssociation":"NONE","body":"@cretz For your second point, I agree that `grpc.CallOption` is not convertible, and I would need a wrapper if I had wanted to use it. However, I don't want to pass any call options, and in many cases these call options aren't being used, in which case convertibility isn't an issue. Other gRPC parameters, as my experiment shows, are convertible just fine without wrapping, as `protoc` generates `json` annotations for each field.","createdAt":"2023-05-22T18:50:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1114#issuecomment-1557731446","viewerDidAuthor":false},{"id":"IC_kwDODN1w685c2SqO","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":":+1: Yeah we call https://pkg.go.dev/reflect#Value.Call not https://pkg.go.dev/reflect#Value.CallSlice. I assume `workflow.ExecuteActivity(ctx, a.GetGreeting, \"a\", \"b\").Get(ctx, &greetResult)` also doesn't work. I think we can support variadic args, but I think for compatibility it may have to be with how `Call` does it (so making what I put there work).\r\n\r\nI wouldn't count on non-convertible optional variadic options always being safe. We may have static analyzers or other things in the future that check entire signatures eagerly (e.g. at registration).","createdAt":"2023-05-22T18:53:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1114#issuecomment-1557736078","viewerDidAuthor":false},{"id":"IC_kwDODN1w685c2UKX","author":{"login":"aryzhov"},"authorAssociation":"NONE","body":"Yes, the second form (`err := workflow.ExecuteActivity(ctx, a.GetGreeting, \"a\", \"b\").Get(ctx, &greetResult)`) also doesn't work. It fails with a different error:\r\n```\r\nError unable to decode the activity function input payload with error: payload item 0: unable to decode: json: cannot unmarshal string into Go value of type []string for function name: GetGreeting\r\n```\r\n","createdAt":"2023-05-22T18:57:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-go/issues/1114#issuecomment-1557742231","viewerDidAuthor":false},{"id":"IC_kwDODN1w686n9LCO","author":{"login":"mashail"},"authorAssociation":"NONE","body":"I support @aryzhov in his quest. \nOur way is to create a wrapper around the rpcs just to have the method signature without variadic param ","createdAt":"2025-04-21T07:24:56Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1114#issuecomment-2817831054","viewerDidAuthor":false}],"createdAt":"2023-05-22T16:49:50Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1114,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"Support activity functions with variadic arguments  ","updatedAt":"2025-04-21T07:26:30Z","url":"https://github.com/temporalio/sdk-go/issues/1114"}
