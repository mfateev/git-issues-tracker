{"assignees":[],"author":{"id":"MDQ6VXNlcjU1Njk0NzQ=","is_bot":false,"login":"zoltanmaric","name":"Zoltán Marić"},"body":"Say I have a function in an activity that looks like this:\r\n\r\n```golang\r\nfunc logSomething(ctx context.Context) {\r\n  log := activity.GetLogger(ctx)\r\n  log.Info(\"logging something\")\r\n}\r\n```\r\n\r\nNow if I want to call that function from a test like this:\r\n```golang\r\nlogSomething(context.Background())\r\n```\r\n\r\nIt will fail with:\r\n```\r\ntest panicked: getActivityOutboundInterceptor: Not an activity context\r\n```\r\n\r\nHow do I get a proper activity context in a test? I tried tacking on an activity interceptor onto the context like this:\r\n```golang\r\nvar Logger logger.Logger = logger.NewLogger(zapcore.DebugLevel)\r\nvar TemporalLogger = logur.LoggerToKV(Logger)\r\n\r\ntype fakeTemporalActivityOutBoundInterceptor struct {\r\n\tinterceptor.ActivityOutboundInterceptorBase\r\n}\r\n\r\nfunc (f *fakeTemporalActivityOutBoundInterceptor) GetLogger(_ temporal_workflow.Context) temporal_log.Logger {\r\n\treturn TemporalLogger\r\n}\r\n\r\n\r\nctx := context.WithValue(\r\n\tcontext.Background(),\r\n\t\"activityInterceptor\",\r\n\t&fakeTemporalActivityOutBoundInterceptor{},\r\n)\r\n```\r\n\r\nBut `\"activityInterceptor\"` is not recognized as equal to [`activityInterceptorContextKey`](https://github.com/temporalio/sdk-go/blob/v1.17.0/internal/internal_activity.go#L155), so I still get the same error :/\r\n\r\nI'm using [`temporalio v1.17.0`](https://github.com/temporalio/sdk-go/tree/v1.17.0)\r\n","closedAt":"2023-03-21T18:27:47Z","comments":[{"id":"IC_kwDODN1w685VbDFR","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"For running activity tests with a properly setup context, you should use the `testsuite.WorkflowTestSuite` which can give you a `testsuite.ActivityTestEnvironment`. https://github.com/temporalio/samples-go/blob/86f65121e4fee9d4d32fccf05d342d7d372c66c1/helloworld/helloworld_test.go#L28-L39 is an example of testing an activity.","createdAt":"2023-02-16T14:14:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1042#issuecomment-1433153873","viewerDidAuthor":false},{"id":"IC_kwDODN1w685VbHU7","author":{"login":"zoltanmaric"},"authorAssociation":"NONE","body":"Thanks for the quick answer @cretz! In this case, I wanted to only test a function that's called inside the activity, which gets an activity context passed to it - not the full blown activity. Is there any way to carve out the activity context from a `testsuite.ActivityTestEnvironment`?","createdAt":"2023-02-16T14:27:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1042#issuecomment-1433171259","viewerDidAuthor":false},{"id":"IC_kwDODN1w685VbSoK","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"To the environment, there is (mostly) no difference between a \"full blown activity\" and \"a function that's called inside the activity\". That test environment is for all functions that accept an activity context. If there are issues with argument serialization or some other reason you can't invoke that function via the environment directly, you can make a simple activity-like function in your test case that just delegates to that function.","createdAt":"2023-02-16T14:58:42Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1042#issuecomment-1433217546","viewerDidAuthor":false},{"id":"IC_kwDODN1w685YHoIb","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Closing since there has been no activity","createdAt":"2023-03-21T18:27:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1042#issuecomment-1478394395","viewerDidAuthor":false}],"createdAt":"2023-02-16T14:07:18Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1042,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"How can I test Temporal code that uses `activity.GetLogger(ctx)`?","updatedAt":"2023-03-21T18:27:48Z","url":"https://github.com/temporalio/sdk-go/issues/1042"}
