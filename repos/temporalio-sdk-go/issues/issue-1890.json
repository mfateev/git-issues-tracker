{"assignees":[],"author":{"id":"U_kgDOCKBtKA","is_bot":false,"login":"stan-stately","name":""},"body":"## Expected Behavior\n- Ideally the context would not be mutated between the interceptor and the activity. If you need to strip headers you should probably do that before the interceptor\n\n\n## Actual Behavior\n- A header is removed using `context.WithValue()` [here](https://github.com/temporalio/sdk-go/blob/master/internal/workflow.go#L793)\n- This is a problem for my usecase because I want to create a custom context and pass it in to my activity:\n```go\nfunc (a *activityInboundInterceptor) ExecuteActivity(\n\tctx context.Context,\n\tin *interceptor.ExecuteActivityInput,\n) (any, error) {\n\tmCtx := NewCustomContext(ctx)\n    return a.Next.ExecuteActivity(mCtx, in)\n}\n\n...\n\nfunc MyActivity(ctx contet.Context) (any, error) {\n    mCtx := ctx.(CustomContext)\n    mCtx.Log(...) // or whatever else mCtx can do\n}\n```\n- Because you're doing a `context.WithValue()` i still end up with a `context.Context` in the activity and I cannot retrieve the parent context. Right now I am working around by \"smuggling\" in my context using `a.Next.ExecuteActivity(context.WithValue(ctx, CustomContextKey{}, mCtx), in)` but this is bad too because I have access to the headers that you stripped out lol. I assume you don't want this\n## Steps to Reproduce the Problem\n- Create inbound activity interceptor\n- Mutate context in the interceptor before `ExecuteActivity`\n- Try and read the mutated context inside the activity\n\n## Specifications\n\n  - Version: v1.33.0\n  - Platform: go\n","closedAt":"2025-03-26T22:59:19Z","comments":[{"id":"IC_kwDODN1w686kQ_cm","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"The SDK does not make any guarantee that the context is not mutated between interceptors and activity. If you want to pass a custom value into the context with a `https://pkg.go.dev/context#WithValue`","createdAt":"2025-03-26T22:56:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1890#issuecomment-2755917606","viewerDidAuthor":false},{"id":"IC_kwDODN1w686kRBQr","author":{"login":"stan-stately"},"authorAssociation":"NONE","body":"ok i will close","createdAt":"2025-03-26T22:59:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1890#issuecomment-2755925035","viewerDidAuthor":false},{"id":"IC_kwDODN1w686kREYX","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"If you do want to implement a custom context, I would encourage you to look at the Go source code for how their contexts are implemented https://cs.opensource.google/go/go/+/refs/tags/go1.24.1:src/context/context.go ","createdAt":"2025-03-26T23:03:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1890#issuecomment-2755937815","viewerDidAuthor":false}],"createdAt":"2025-03-26T22:52:49Z","labels":[],"milestone":null,"number":1890,"reactionGroups":[],"state":"CLOSED","title":"Context is mutated between interceptors and activity","updatedAt":"2025-03-26T23:03:37Z","url":"https://github.com/temporalio/sdk-go/issues/1890"}
