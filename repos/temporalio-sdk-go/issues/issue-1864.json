{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTg3MTAz","is_bot":false,"login":"yuandrew","name":"Andrew Yuan"},"body":"**Is your feature request related to a problem? Please describe.**\nToday our Payload visitor will visit Any fields, but we don't properly visit and parse through a map of Any's, i.e. [this repeated Any field](https://github.com/temporalio/api/blob/9156239c8272003b6f228951602ca2b130a55876/temporal/api/errordetails/v1/message.proto#L143) in our API.\n\n**Describe the solution you'd like**\nThis test should pass.\n```\nfunc TestVisitPayloads_ArrayAny(t *testing.T) {\n\tmsg, err := anypb.New(&update.Request{Input: &update.Input{Args: &common.Payloads{\n\t\tPayloads: []*common.Payload{{Data: []byte(\"orig-val\")}},\n\t}}})\n\trequire.NoError(t, err)\n\troot := &errordetails.MultiOperationExecutionFailure_OperationStatus{Details: []*anypb.Any{msg}}\n\tvar anyCount int\n\terr = VisitPayloads(context.Background(), root, VisitPayloadsOptions{\n\t\tVisitor: func(ctx *VisitPayloadsContext, p []*common.Payload) ([]*common.Payload, error) {\n\t\t\tanyCount++\n\t\t\t// Only mutate if the payloads has \"test\"\n\t\t\tif len(p) == 1 && string(p[0].Data) == \"orig-val\" {\n\t\t\t\treturn []*common.Payload{{Data: []byte(\"new-val\")}}, nil\n\t\t\t}\n\t\t\treturn p, nil\n\t\t},\n\t})\n\trequire.NoError(t, err)\n\trequire.Equal(t, 1, anyCount)\n\tupdate1, err := root.Details[0].UnmarshalNew()\n\n\trequire.NoError(t, err)\n\trequire.Equal(t, \"new-val\", string(update1.(*update.Request).Input.Args.Payloads[0].Data))\n}\n```\n\nLikely will require enhancing or creating a new case here https://github.com/temporalio/api-go/blob/4c00816d0d87af129f51a33be6f3b2ca20e3ccb7/cmd/proxygenerator/interceptor.go#L262\n\n**Additional context**\nAdd any other context or screenshots about the feature request here.\n","closedAt":"2025-04-09T16:22:18Z","comments":[{"id":"IC_kwDODN1w686iCsd_","author":{"login":"yuandrew"},"authorAssociation":"MEMBER","body":"When this is implemented, this is another test that could be added \n```\nfunc TestOperationStatus(t *testing.T) {\n\trequire := require.New(t)\n\n\tvar messageType protoreflect.MessageType\n\tprotoregistry.GlobalTypes.RangeMessages(func(mt protoreflect.MessageType) bool {\n\t\tif string(mt.Descriptor().FullName()) == \"temporal.api.errordetails.v1.MultiOperationExecutionFailure.OperationStatus\" { \n\t\t\tmessageType = mt\n\t\t}\n\t\treturn true\n\t})\n\n\t// Create empty instance and populate with test values\n\tmsg := messageType.New().Interface().(proto.Message)\n\tvar totalCount, count int\n\tpopulatePayload(&msg, msg, require, &totalCount, &count)\n\n\trequire.Equal(0, count)\n\trequire.Equal(1, totalCount)\n}\n```","createdAt":"2025-03-12T17:29:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1864#issuecomment-2718615423","viewerDidAuthor":false}],"createdAt":"2025-03-12T16:20:29Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1864,"reactionGroups":[],"state":"CLOSED","title":"[api-go] Support repeated Any fields","updatedAt":"2025-04-09T16:22:18Z","url":"https://github.com/temporalio/sdk-go/issues/1864"}
