{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyMjI1MTI=","is_bot":false,"login":"hazcod","name":"Niels Hofmans"},"body":"As reported on https://temporalio.slack.com/archives/CTDTU3J4T/p1597225501187900\r\nConflict with temporal/api/dependencies/gogo.proto\r\n\r\n## Expected Behavior\r\nA run works fine.\r\n\r\n## Actual Behavior\r\nGo code (api + worker) fails on startup with following error\r\n```\r\npanic: proto: duplicate extension registered: descriptor.EnumOptions 62001\r\n\r\ngoroutine 1 [running]:\r\ngithub.com/gogo/protobuf/proto.RegisterExtension(0x26e8620)\r\n        /go/src/app/vendor/github.com/gogo/protobuf/proto/extensions.go:595 +0x2cb\r\ngithub.com/gogo/protobuf/gogoproto.init.0()\r\n        /go/src/app/vendor/github.com/gogo/protobuf/gogoproto/gogo.pb.go:709 +0x31\r\npanic: proto: duplicate extension registered: descriptor.EnumOptions 62001\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\ngo.mod:\r\n```\r\n\tgo.temporal.io/api v0.28.0\r\n\tgo.temporal.io/sdk v0.28.2\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: 0.28.0\r\n  - Platform: docker\r\n","closedAt":"2020-08-31T20:24:46Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY3OTY4OTc1Mw==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"Same issue with 0.29 for SDK, API and Docker.","createdAt":"2020-08-25T05:19:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-679689753","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY3OTcxNDYxOQ==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"I see the same RegisterExtension calls in `gogo/protobuf/gogoproto` and `api/dependencies/gogoproto` ?\r\n![image](https://user-images.githubusercontent.com/5222512/91126625-b55cbc00-e6a4-11ea-8a89-6c09a101b915.png)\r\n","createdAt":"2020-08-25T05:29:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-679714619","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY3OTc0ODU5NA==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"Seems to work if I manually comment out the `RegisterExtension` calls in vendor/github.com/gogo/protobuf/gogoproro","createdAt":"2020-08-25T05:42:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-679748594","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY4Mjk5NDY2MA==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"Quote from @alexshtin:\r\n\r\nyou are on latest `go 1.14`, right? Go modules is on by default there. just delete `vendor` dir and run `go mod init` and then `go mod tidy`.","createdAt":"2020-08-28T17:58:38Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-682994660","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY4MzI4MDM4NQ==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"@alexshtin i'm actually still stuck with this; I have private go dependencies that cannot be fetched during the Docker build, since that would embed SSH keys in the eventual image. (and docker squash support isn't widespread)\r\nAlso, the path of SSH keys on systems differ.\r\n\r\nHow would I make this work with private go dependencies? I need to prevent a `go build` to check online for dependency updates, which only seems to work with `vendor/`?","createdAt":"2020-08-29T11:54:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-683280385","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY4MzYyNDA3NA==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"@alexshtin I am now doing it the recommended GOPATH/pkg/mod way, but I still receive this error, which is weird.\r\nI have no vendor directory on my or the containers filesystem.\r\n\r\nDockerfile:\r\n```docker\r\nCOPY go.mod go.sum /go/src/app/\r\nRUN if [ -n \"$GITHUB_TOKEN\" ]; then git config --global url.\"https://$GITHUB_TOKEN@github.com\".insteadOf \"https://github.com\"; fi \\\r\n    && go mod download\r\n\r\nCOPY . /go/src/app/\r\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags '-w -s -extldflags \"-static\"' \\\r\n    -o /go/bin/api ./cmd/api/ \\\r\n    && chmod u=rx,g=,o= /go/bin/api\r\n```\r\n\r\nAnd log:\r\n```\r\napi_1         | panic: proto: duplicate extension registered: descriptor.EnumOptions 62001\r\napi_1         | \r\napi_1         | goroutine 1 [running]:\r\napi_1         | github.com/gogo/protobuf/proto.RegisterExtension(0x277e240)\r\napi_1         |         /go/pkg/mod/github.com/gogo/protobuf@v1.3.1/proto/extensions.go:595 +0x2cb\r\napi_1         | github.com/gogo/protobuf/gogoproto.init.0()\r\napi_1         |         /go/pkg/mod/github.com/gogo/protobuf@v1.3.1/gogoproto/gogo.pb.go:709 +0x31\r\n```","createdAt":"2020-08-31T07:49:14Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-683624074","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY4MzczNTIxNA==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"Matches for `RegisterExtension` with `EnumOptions`:\r\n```\r\n/go/pkg/mod/github.com/cncf/udpa/go@v0.0.0-20191209042840-269d4d468f6f/udpa/annotations/migrate.pb.go:  ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/envoyproxy/protoc-gen-validate@v0.1.0/gogoproto/gogo.pb.go:      ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/envoyproxy/protoc-gen-validate@v0.1.0/gogoproto/gogo.pb.go:      ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/envoyproxy/protoc-gen-validate@v0.1.0/gogoproto/gogo.pb.go:      ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/envoyproxy/protoc-gen-validate@v0.1.0/gogoproto/gogo.pb.go:      ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/envoyproxy/protoc-gen-validate@v0.1.0/gogoproto/gogo.pb.go:      ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/gogo/protobuf@v1.3.1/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/gogo/protobuf@v1.3.1/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/gogo/protobuf@v1.3.1/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/gogo/protobuf@v1.3.1/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/gogo/protobuf@v1.3.1/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/lyft/protoc-gen-validate@v0.0.13/gogoproto/gogo.pb.go:   ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/lyft/protoc-gen-validate@v0.0.13/gogoproto/gogo.pb.go:   ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/lyft/protoc-gen-validate@v0.0.13/gogoproto/gogo.pb.go:   ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/lyft/protoc-gen-validate@v0.0.13/gogoproto/gogo.pb.go:   ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/github.com/lyft/protoc-gen-validate@v0.0.13/gogoproto/gogo.pb.go:   ExtendedType:  (*google_protobuf.EnumOptions)(nil),\r\n/go/pkg/mod/go.temporal.io/api@v0.29.0/dependencies/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/go.temporal.io/api@v0.29.0/dependencies/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/go.temporal.io/api@v0.29.0/dependencies/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/go.temporal.io/api@v0.29.0/dependencies/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/go.temporal.io/api@v0.29.0/dependencies/gogoproto/gogo.pb.go:       ExtendedType:  (*descriptor.EnumOptions)(nil),\r\n/go/pkg/mod/google.golang.org/protobuf@v1.25.0/internal/filetype/build.go:                              case \"EnumOptions\":\r\n```","createdAt":"2020-08-31T11:59:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-683735214","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY4NDQxMDg1NQ==","author":{"login":"hazcod"},"authorAssociation":"NONE","body":"Seems to be fixed with latest master commit hash @alexshtin , thank you.\r\nI'll keep an eye on the next release.","createdAt":"2020-09-01T06:09:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/236#issuecomment-684410855","viewerDidAuthor":false}],"createdAt":"2020-08-24T08:00:30Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":236,"reactionGroups":[],"state":"CLOSED","title":"panic: proto: duplicate extension registered","updatedAt":"2020-09-01T06:09:32Z","url":"https://github.com/temporalio/sdk-go/issues/236"}
