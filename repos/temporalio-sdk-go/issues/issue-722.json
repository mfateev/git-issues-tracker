{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nAt https://github.com/temporalio/sdk-go/commit/a88dec51b1767a1bab6426a602980d25a51d40eb#diff-5db8d6c4288666da4ff606f745645fe946e504370e93bbceb25402e0a520deb0 we inadvertently removed intentional retry-prevention to prevent session activity creation from retrying in all but the \"too many sessions\" case.\r\n\r\n**Describe the solution you'd like**\r\n\r\nDo not have session creation activity failure retry anything but \"too many sessions\".","closedAt":"2022-03-07T19:32:07Z","comments":[{"id":"IC_kwDODN1w6849o_Co","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Some additional context here, one of the purposes of session creation activity is monitoring the health of worker process. If worker restarts while a session is running, the creation activity should fail and all user activities within this session will be cancelled. If the creation activity is retried for errors like timeout, workflow won't know the worker for session tasklist has already gone and continue to schedule more activities to that worker-specific tasklist which now has no poller. ","createdAt":"2022-02-09T20:16:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1034154152","viewerDidAuthor":false},{"id":"IC_kwDODN1w6849shAk","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"It appears you can't really set start-to-close or heartbeat timeouts as non-retryable. Only application failures. How should we implement \"only retry a certain application error\"? Should we manually loop in the workflow with out own backoff?","createdAt":"2022-02-10T15:49:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1035079716","viewerDidAuthor":false},{"id":"IC_kwDODN1w6849ytCH","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"@cretz We will add support on server side for specifying timeout errors as non-retryable.","createdAt":"2022-02-11T22:41:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1036701831","viewerDidAuthor":false},{"id":"IC_kwDODN1w684-Il8N","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"https://github.com/temporalio/sdk-go/blob/master/internal/session.go#L526\r\n`errTooManySessions` is retryable so the third argument should actually `false` ","createdAt":"2022-02-17T00:26:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1042439949","viewerDidAuthor":false},{"id":"IC_kwDODN1w684-KnQM","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"@yycptt - Ok, I will make that non-retryable. I will wait on server update so that I can include in the same PR with a retry policy excluding timeouts from being retryable (please link issue here if/when available).","createdAt":"2022-02-17T13:50:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1042969612","viewerDidAuthor":false},{"id":"IC_kwDODN1w684-MWlv","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"After discussion, we think we can solve this by just disallowing all retries on create session. As for the one case where we did want retries - max sessions reached - we think we can solve this by using max concurrent activities. Hopefully implementation on this will begin shortly.","createdAt":"2022-02-17T20:52:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1043425647","viewerDidAuthor":false},{"id":"IC_kwDODN1w684-dyDF","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I am working to build a reproducer for this bug.","createdAt":"2022-02-22T16:43:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1047994565","viewerDidAuthor":false},{"id":"IC_kwDODN1w684-iCbz","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Reproducer is complete, I am now implementing the fix and the tests for the fix.","createdAt":"2022-02-23T19:00:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1049110259","viewerDidAuthor":false},{"id":"IC_kwDODN1w684-qfqU","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"#739 was attempted but deemed unsafe for session recreation. Instead we will leverage https://github.com/temporalio/temporal/pull/2524 the way the older set of code once did and disable timeout retries. This means to get full session safety functionality, a server upgrade will be required (I may make a note of this point in the docs).\r\n\r\nI will also cherry pick integration tests from #739 (that I didn't already for #741) and we will set max activity size on session creation activity worker (even though we know that is not enough to really solve the max across creation and recreation).\r\n\r\n","createdAt":"2022-02-25T22:35:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/722#issuecomment-1051327124","viewerDidAuthor":false}],"createdAt":"2022-02-09T19:19:11Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":722,"reactionGroups":[],"state":"CLOSED","title":"CreateSession improperly retrying errors it should not","updatedAt":"2022-03-07T19:32:07Z","url":"https://github.com/temporalio/sdk-go/issues/722"}
