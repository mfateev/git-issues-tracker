{"assignees":[],"author":{"id":"MDQ6VXNlcjIxMzI5NjY1","is_bot":false,"login":"ebrard","name":"Emmanuel"},"body":"## Expected Behavior\n\nGiven the following workflow definition:\n\n```go\nimport (\n\t\"time\"\n\n\t\"go.temporal.io/sdk/temporal\"\n\t\"go.temporal.io/sdk/workflow\"\n)\n\nfunc Act(input string) (output string, err error) {\n\toutput = input\n\treturn\n}\n\nfunc DummyWorkFlow(ctx workflow.Context, input string) (string, error) {\n\n\tretrypolicy := &temporal.RetryPolicy{\n\t\tInitialInterval:    time.Second,\n\t\tBackoffCoefficient: 2.0,\n\t\tMaximumInterval:    15 * time.Minute,\n\t\tMaximumAttempts:    500,\n\t}\n\n\toptions := workflow.ActivityOptions{\n\t\tStartToCloseTimeout: 3 * time.Hour,\n\t\tRetryPolicy:         retrypolicy,\n\t\tHeartbeatTimeout:    30 * time.Second,\n\t}\n\n\tvar result string\n\tif err := workflow.ExecuteActivity(workflow.WithActivityOptions(ctx, options), Act, input).Get(ctx, &result); err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn result, nil\n\n}\n```\n\nand the following test:\n\n```go\ntype UnitTestSuite struct {\n\tsuite.Suite\n\ttestsuite.WorkflowTestSuite\n\tenv *testsuite.TestWorkflowEnvironment\n}\n\nfunc (s *UnitTestSuite) SetupTest() {\n\ts.env = s.NewTestWorkflowEnvironment()\n\ts.env.SetTestTimeout(15 * time.Second)\n\ts.env.SetWorkflowRunTimeout(15 * time.Second)\n\n}\n\nfunc (s *UnitTestSuite) AfterTest(suiteName, testName string) {\n\ts.env.AssertExpectations(s.T())\n}\n\nfunc TestUnitTestSuite(t *testing.T) {\n\tsuite.Run(t, new(UnitTestSuite))\n}\n\nfunc (s *UnitTestSuite) Test_Dummy_Workflow_Succeeds() {\n\n\tactHandler := make(map[string]string)\n\n\ts.env.SetOnActivityStartedListener(func(activityInfo *activity.Info, ctx context.Context, args converter.EncodedValues) {\n\t\tslog.Info(\"activity started\", \"activity\", activityInfo.ActivityType.Name)\n\t\tvar val string\n\t\targs.Get(&val)\n\t\tactHandler[activityInfo.ActivityType.Name] = val\n\t})\n\n\ts.env.RegisterActivity(Act)\n\ts.env.ExecuteWorkflow(DummyWorkFlow, \"hello\")\n\ts.env.AssertActivityCalled(s.T(), \"Act\", \"hello\")\n\ts.True(s.env.IsWorkflowCompleted())\n\ts.NoError(s.env.GetWorkflowError())\n\tvar result string\n\ts.env.GetWorkflowResult(&result)\n\ts.Assertions.Equal(\"hello\", result)\n\ts.Assertions.Equal(\"hello\", actHandler[\"Act\"])\n}\n```\n\n## Actual Behavior\n\nI would expect the assertion `s.env.AssertActivityCalled(s.T(), \"Act\", \"hello\")` to pass but it fails with:\n\n```\n               Error:          Should have called with given arguments\n                Test:           TestUnitTestSuite/Test_Dummy_Workflow_Succeeds\n                Messages:       Expected \"Act\" to have been called with:\n                                [hello]\n                                but no actual calls happened\n```\n\nInterestingly the `s.Assertions.Equal(\"hello\", actHandler[\"Act\"])` call passes.\n\n## Steps to Reproduce the Problem\n\nSee code provided\n\n## Specifications\n\n  - Version: go 1.25, temporal go.temporal.io/sdk v1.36.0\n  - Platform: macos\n","closedAt":"2025-09-02T14:24:05Z","comments":[{"id":"IC_kwDODN1w687BcvY0","author":{"login":"ebrard"},"authorAssociation":"NONE","body":"If I mock the activity with:\n```go\n\ts.env.OnActivity(Act, mock.Anything).Return(func(input string) (string, error) {\n\t\treturn input, nil\n\t})\n```\nthen both assertions passes.","createdAt":"2025-09-02T14:13:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/2044#issuecomment-3245536820","viewerDidAuthor":false},{"id":"IC_kwDODN1w687Bc6nM","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"This is expected `AssertActivityCalled` is for asserting activity mocks are called","createdAt":"2025-09-02T14:24:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/2044#issuecomment-3245582796","viewerDidAuthor":false},{"id":"IC_kwDODN1w687Bc7J9","author":{"login":"ebrard"},"authorAssociation":"NONE","body":"That's fair, but the documentation is not clear enough about it, IMHO.","createdAt":"2025-09-02T14:24:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/2044#issuecomment-3245585021","viewerDidAuthor":false}],"createdAt":"2025-09-02T14:03:44Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDg2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":2044,"reactionGroups":[],"state":"CLOSED","title":"AssertActivityCalled does not capture calls or/and argument being passed","updatedAt":"2025-09-02T14:24:40Z","url":"https://github.com/temporalio/sdk-go/issues/2044"}
