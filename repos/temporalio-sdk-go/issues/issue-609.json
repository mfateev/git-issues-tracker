{"assignees":[],"author":{"id":"MDQ6VXNlcjcxMDI4ODk=","is_bot":false,"login":"lunne","name":"Mathias Ehrlin"},"body":"**Is your feature request related to a problem? Please describe.**\r\nI would like to test activities with the same name (different signature) on different task queues.\r\n\r\n**Describe the solution you'd like**\r\nSet what task queue the activity is being triggered on. If we could specify the task queue or something like that on the mock `.On()` we could keep the domain specific names for the acitivites.\r\n\r\n**Describe alternatives you've considered**\r\nThe other option we have is to rename activities on the different services so they dont have the same name. this would cause us a pattern like this:\r\n\r\ncar.GetCarById() \r\n\r\ninsetad of \r\ncar.GetById() \r\n\r\n\r\n**Additional context**\r\nThe following is a test that represent how the error is being triggered today. \r\n\r\n```\r\n// main.go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\r\n\t\"go.temporal.io/sdk/workflow\"\r\n)\r\n\r\ntype GetCarByIdParams struct{}\r\ntype Car struct{}\r\ntype activitiesCar struct{}\r\n\r\nfunc (a *activitiesCar) GetById(ctx context.Context, params *GetCarByIdParams) (*Car, error) {\r\n\treturn &Car{}, nil\r\n}\r\n\r\ntype GetBussByIdParams struct{}\r\ntype Buss struct{}\r\ntype activitiesBuss struct{}\r\n\r\nfunc (a *activitiesBuss) GetById(ctx context.Context, params *GetBussByIdParams) (*Buss, error) {\r\n\treturn &Buss{}, nil\r\n}\r\n\r\nvar actCar *activitiesCar\r\nvar actBuss *activitiesBuss\r\n\r\nfunc TestWorkflow(ctx workflow.Context) error {\r\n\r\n\t// get a car\r\n\r\n\topt := workflow.ActivityOptions{\r\n\t\tTaskQueue: \"temporal.Car.worker\",\r\n\t}\r\n\tvar car *Car\r\n\tif err := workflow.ExecuteActivity(\r\n\t\tworkflow.WithActivityOptions(ctx, opt),\r\n\t\tctx,\r\n\t\tactCar.GetById,\r\n\t\t&GetCarByIdParams{},\r\n\t).Get(ctx, car); err != nil {\r\n\t\treturn err\r\n\t}\r\n\r\n\topt = workflow.ActivityOptions{\r\n\t\tTaskQueue: \"temporal.Buss.worker\",\r\n\t}\r\n\tvar buss *Buss\r\n\tif err := workflow.ExecuteActivity(\r\n\t\tworkflow.WithActivityOptions(ctx, opt),\r\n\t\tactBuss.GetById,\r\n\t\t&GetBussByIdParams{},\r\n\t).Get(ctx, buss); err != nil {\r\n\t\treturn err\r\n\t}\r\n\r\n\treturn nil\r\n}\r\n\r\n```\r\n\r\n```\r\n//main_test.go\r\npackage main\r\n\r\nimport (\r\n\t\"testing\"\r\n\r\n\t\"github.com/stretchr/testify/mock\"\r\n\t\"github.com/stretchr/testify/suite\"\r\n\t\"go.temporal.io/sdk/testsuite\"\r\n)\r\n\r\ntype UnitTestSuite struct {\r\n\tsuite.Suite\r\n\ttestsuite.WorkflowTestSuite\r\n\r\n\tenv *testsuite.TestWorkflowEnvironment\r\n}\r\n\r\nfunc (s *UnitTestSuite) SetupTest() {\r\n\ts.env = s.NewTestWorkflowEnvironment()\r\n\r\n\ts.env.RegisterWorkflow(TestWorkflow)\r\n\r\n}\r\n\r\nfunc (s *UnitTestSuite) AfterTest(suiteName, testName string) {\r\n\ts.env.AssertExpectations(s.T())\r\n}\r\n\r\nfunc Test_NetworkService_Workflow_Tests(t *testing.T) {\r\n\tsuite.Run(t, new(UnitTestSuite))\r\n}\r\n\r\nfunc (t *UnitTestSuite) Test_TestWorkflow() {\r\n\r\n\tt.env.OnActivity(actBuss.GetById, mock.Anything, &GetBussByIdParams{}).Return(&Buss{}, nil).Once()\r\n\tt.env.OnActivity(actCar.GetById, mock.Anything, &GetCarByIdParams{}).Return(&Car{}, nil).Once()\r\n\r\n\tt.env.ExecuteWorkflow(TestWorkflow)\r\n\r\n\tt.True(t.env.IsWorkflowCompleted())\r\n\tt.NoError(t.env.GetWorkflowError())\r\n}\r\n\r\n```\r\n","closedAt":"2021-11-16T18:52:11Z","comments":[{"id":"IC_kwDODN1w6844_yyz","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks for the report! I will investigate options on how to mock activities specifically by task queue.\r\n\r\nIn the meantime, another alternative is to just have a callback that checks the info like:\r\n\r\n```go\r\nt.env.OnActivity(\"GetById\", mock.Anything, mock.Anything).Return(func(ctx context.Context, params interface{}) (interface{}, error) {\r\n  if activity.GetInfo(ctx).TaskQueue == \"temporal.Car.worker\" {\r\n    return &Car{}, nil\r\n  }\r\n  return &Buss{}, nil\r\n})\r\n```\r\n\r\nI haven't tested this, just hand-typed here, but the idea is there (will have to confirm whether empty interface param/return there works as expected). Granted this isn't as robust as potentially making a way to filter mocks on contextual information, so I will see if it is feasible to add such filtering.\r\n\r\nFor UI and other use cases, disambiguating the activity name may also have general value.","createdAt":"2021-11-01T13:45:36Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/609#issuecomment-956247219","viewerDidAuthor":false},{"id":"IC_kwDODN1w6845WCwE","author":{"login":"lunne"},"authorAssociation":"NONE","body":"The proposed solution does not work. The mock needs too done with the correct signature.\r\n\r\nYes, you are correct. In the UI it will be more clear if the resource is included in the name. Were are going in a direction where we rename the activities as we go instead. GetById will become GetCarById  and so on. \r\n\r\nSo for our part this ticket could be closed but it might still be good to be able to select which queue tasks are being put on to test that activities is run on the correct queue?\r\n","createdAt":"2021-11-05T17:25:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/609#issuecomment-962079748","viewerDidAuthor":false},{"id":"IC_kwDODN1w68452b_m","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Yeah, I'm afraid `TestWorkflowEnvironment.OnActivity` for a single environment is similar to `Worker.RegisterActivity` for a single worker in that you cannot pick which task queue it each one applies to. This actually calls `RegisterActivity` internally which does not take a task queue option.\r\n\r\nIt would be a significant change I'm afraid to have task-queue specific registration and mocking inside the test suite.","createdAt":"2021-11-16T18:52:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/609#issuecomment-970571750","viewerDidAuthor":false}],"createdAt":"2021-10-27T15:33:23Z","labels":[],"milestone":null,"number":609,"reactionGroups":[],"state":"CLOSED","title":"Test activities with same name on different queues (run from the same workflow)","updatedAt":"2021-11-16T18:52:12Z","url":"https://github.com/temporalio/sdk-go/issues/609"}
