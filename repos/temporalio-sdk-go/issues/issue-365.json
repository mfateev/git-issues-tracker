{"assignees":[{"id":"MDQ6VXNlcjExODM4OTgx","login":"feedmeapples","name":"Ruslan","databaseId":0}],"author":{"id":"MDQ6VXNlcjEwMjMzNDQy","is_bot":false,"login":"vavsab","name":"Ivan Sabelnikov"},"body":"**Describe the bug**\r\nI'm getting error in temporal-web while trying to view workflow that contains local activities without return parameters.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. I took an example from the [Go getting started guide](https://docs.temporal.io/docs/go-run-your-first-app?_ga=2.131416204.2088473206.1612883624-657308480.1606319036) and changed it to use Local Activities.\r\n![image](https://user-images.githubusercontent.com/10233442/107386506-96d86900-6afc-11eb-954c-9a0b54d58b83.png)\r\n2. After I run this sample, I get “13 INTERNAL: Failed to parse server response” while viewing the workflow inside of temporal-web\r\n![image](https://user-images.githubusercontent.com/10233442/107386586-a9eb3900-6afc-11eb-8c7d-ca1f04d4b549.png)\r\n3. I also get this error inside of temporal-web docker container\r\n![image](https://user-images.githubusercontent.com/10233442/107386633-b66f9180-6afc-11eb-8ec0-188f95082004.png)\r\n\r\n**Expected behavior**\r\nI can view such workflows without getting an error\r\n\r\n**Desktop**\r\n - OS: Windows\r\n - Browser: Chrome\r\n - Temporal Web Version: 1.5.2 (Docker) \r\n - Temporal Version: 1.6.0 (Docker)\r\n \r\n **Additional details**\r\n1. I also noticed that as soon as I add at least an empty return result to the activities, it starts to open without any error\r\n \r\n![image](https://user-images.githubusercontent.com/10233442/107386949-077f8580-6afd-11eb-99a3-76a0ec3cb4fa.png)\r\n2. I have started a [discussion in community](https://community.temporal.io/t/error-while-viewing-workflow-that-contains-local-activities-13-internal-failed-to-parse-server-response/1378)\r\n","closedAt":"2021-02-23T06:07:25Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc3ODE0MzQ3Mg==","author":{"login":"feedmeapples"},"authorAssociation":"CONTRIBUTOR","body":"Seems node grpc is failing at parsing MarkerRecordEvent when the `result` key is set to null (which corresponds to returning nil error in activity implementation)\r\n![image](https://user-images.githubusercontent.com/11838981/107762995-b8934500-6ce2-11eb-97b4-2101cd9bc2b4.png)\r\n\r\nIn case of returning `(interface {}, error)`, the result payload is filled:\r\n![image](https://user-images.githubusercontent.com/11838981/107763339-58e96980-6ce3-11eb-800e-72cac8b90af3.png)\r\n","createdAt":"2021-02-12T11:35:29Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/365#issuecomment-778143472","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc4MDMzNTcyNQ==","author":{"login":"feedmeapples"},"authorAssociation":"CONTRIBUTOR","body":"I'm considering changing the `result` key's value in map<string, Payloads> from nil to empty array. Asked the temporal server side of the team whether this would be a backwards compatible change\r\n\r\nSome details:\r\non temporal server side, when we add Marker Recorded event, we populate the `details` field with `map<string, Payloads>`\r\nThen the `result` key value may be set to nil if activity's return type is error (set to nil). Empty payloads instead of nil could solve the issue with node grpc\r\n\r\n![image](https://user-images.githubusercontent.com/11838981/108164770-4df95500-70a6-11eb-9650-14001ddfacfb.png)","createdAt":"2021-02-17T06:28:38Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/365#issuecomment-780335725","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc4MTY4MTQxMA==","author":{"login":"feedmeapples"},"authorAssociation":"CONTRIBUTOR","body":"we've discussed with the SDK team: there is no value from having empty result in the `MarkerRecordedEventAttributes.details` of type `map<string, Payloads>`. Both old [grpc](https://www.npmjs.com/package/grpc) and new [@grpc/grpc-js](https://www.npmjs.com/package/@grpc/grpc-js) libs fail to process such payload. The easiest is to fix this in go SDK itself\r\n\r\nThe issue didn't repro with sdk-java as it doesn't set `null` value in details of type `map<string, Payloads>`","createdAt":"2021-02-18T22:37:06Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/365#issuecomment-781681410","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc4MTcyNjUwNg==","author":{"login":"feedmeapples"},"authorAssociation":"CONTRIBUTOR","body":"- for quick fix: Addressing this in sdk-go\r\n- additional fix to prevent similar cases in future: Filing a bug to @grpc/grpc-js","createdAt":"2021-02-19T00:26:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/365#issuecomment-781726506","viewerDidAuthor":false}],"createdAt":"2021-02-09T15:35:03Z","labels":[],"milestone":null,"number":365,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Local Activities fail to deserialize at gRPC if return type is error","updatedAt":"2021-02-23T06:07:25Z","url":"https://github.com/temporalio/sdk-go/issues/365"}
