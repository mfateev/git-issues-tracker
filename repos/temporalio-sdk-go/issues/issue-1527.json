{"assignees":[],"author":{"id":"MDQ6VXNlcjg4MzIwNTA=","is_bot":false,"login":"dmateusp","name":"Daniel Mateus Pires"},"body":"## Is your feature request related to a problem? Please describe.\r\n\r\nI have an activity that checks some external condition, and doesn't run if that external condition is not fulfilled.\r\n\r\nIn that scenario I would like to see it as cancelled in Temporal, so I tried to return `temporal.NewCanceledError(...)` from within the activity.\r\n\r\nHowever, temporal is currently wrapping my error in `fmt.Errorf(\"unexpected activity cancel error: %w\", err)`, and I think that's happening [here](https://github.com/temporalio/sdk-go/blob/3ceb659a84817915261d0577e4627e0d8dff0916/internal/internal_task_pollers.go#L1155C9-L1155C64). This actually causes my error to be retried as any other error would.\r\n\r\nI think this is happening because I'm trying to return that cancel error from an activity directly instead of having a workflow initiate an activity context cancel, see the check [here](https://github.com/temporalio/sdk-go/blob/3ceb659a84817915261d0577e4627e0d8dff0916/internal/internal_task_handlers.go#L2186)\r\n\r\n## Describe the solution you'd like\r\nI would like temporal to stop checking that the context was cancelled when handling CanceledError\r\n\r\n## Describe alternatives you've considered\r\nRight now I'm going to have to return a non-retryable error, but this stop scenario is not technically an error.\r\n\r\n\r\n","closedAt":"2024-06-21T16:56:52Z","comments":[{"id":"IC_kwDODN1w686CHhF_","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> In that scenario I would like to see it as cancelled in Temporal\r\n\r\nActivity cancellation can only result from the server issuing a cancellation, an activity cannot appear cancelled just by returning cancelled. This is Temporal platform/server behavior and not Go SDK (it will reject SDK attempts to mark activities as cancelled if a cancellation wasn't requested server side, which is why SDK must convert it to a normal error).","createdAt":"2024-06-21T15:50:15Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1527#issuecomment-2183008639","viewerDidAuthor":false},{"id":"IC_kwDODN1w686CH50L","author":{"login":"dmateusp"},"authorAssociation":"NONE","body":"thanks @cretz for the explanation, I'll close this issue and keep using a non-retryable error ","createdAt":"2024-06-21T16:56:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/1527#issuecomment-2183109899","viewerDidAuthor":false}],"createdAt":"2024-06-21T15:22:00Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1527,"reactionGroups":[],"state":"CLOSED","title":"Stop checking that context is cancelled when a `CanceledError` is received","updatedAt":"2024-06-21T17:45:51Z","url":"https://github.com/temporalio/sdk-go/issues/1527"}
