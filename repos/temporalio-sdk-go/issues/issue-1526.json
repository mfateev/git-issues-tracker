{"assignees":[],"author":{"id":"MDQ6VXNlcjIxODM5MDQ=","is_bot":false,"login":"tomwheeler","name":"Tom Wheeler"},"body":"## Expected Behavior\r\n\r\nI would expect that if I start the [Dev Server](https://pkg.go.dev/go.temporal.io/sdk@v1.27.0/testsuite#StartDevServer), a valid functional test would pass regardless of how the DevServerOptions' `EnableUI` attribute was set.\r\n\r\n## Actual Behavior\r\n\r\nA [functional test](https://github.com/temporalio/reference-app-orders-go/blob/4546fb2a41cacd84bd4158728808aa74cd188e8f/app/test/order_test.go) written by a co-worker [started](https://github.com/temporalio/reference-app-orders-go/blob/4546fb2a41cacd84bd4158728808aa74cd188e8f/app/test/order_test.go#L76-L81) the Dev Server, setting `EnableUI` to `true`. I found that this caused a failure in at least one case because the SDK calculated an invalid (out of range) port number.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nI cannot reliably reproduce the problem and would imagine that it happens quite infrequently, but here's the output from a time when it failed:\r\n\r\n```\r\ngo test -cover ./app/test -coverpkg ./... -args -test.gocoverdir=D:/a/tora-for-ci-testing/tora-for-ci-testing/.coverage/functional\r\n2024/06/20 19:57:34 INFO  Downloading temporal CLI Url https://temporal.download/assets/temporalio/cli/releases/download/v0.13.1/temporal_cli_0.13.1_windows_amd64.zip ExePath C:\\Users\\RUNNER~1\\AppData\\Local\\Temp\\temporal-cli-go-sdk-1.26.0.exe\r\n2024/06/20 19:57:36 INFO  Starting DevServer ExePath C:\\Users\\RUNNER~1\\AppData\\Local\\Temp\\temporal-cli-go-sdk-1.26.0.exe Args [server start-dev --ip 127.0.0.1 --port 65146 --namespace default --dynamic-config-value frontend.enableServerVersionCheck=false --dynamic-config-value system.forceSearchAttributesCacheRefreshOnRead=true]\r\ntime=2024-06-20T19:57:36.436 level=ERROR msg=\"can't use default UI port 66146 (65146 + 1000): listen tcp: address 66146: invalid port\"\r\n--- FAIL: Test_Order (67.38s)\r\n    order_test.go:81: \r\n            Error Trace:    D:/a/tora-for-ci-testing/tora-for-ci-testing/app/test/order_test.go:81\r\n            Error:          Received unexpected error:\r\n                            failed connecting after timeout, last error: failed reaching server: last connection error: connection error: desc = \"transport: Error while dialing: dial tcp 127.0.0.1:65146: connectex: No connection could be made because the target machine actively refused it.\"\r\n```\r\n\r\nThis occurred when testing on Windows, although I doubt that it's limited to that platform. The heart of the problem seems to be the \"listen tcp: address 66146: invalid port\" message; the part preceding it suggests that it's calculating a port number without considering whether the result exceeds the allowed range. \r\n\r\n## Specifications\r\n\r\n  - Version: v1.27.0\r\n  - Platform: Windows \r\n","closedAt":"2025-02-04T18:13:39Z","comments":[{"id":"IC_kwDODN1w686CHNXD","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I think the solution here is to have a `UIPort` option, and its default should be random if server port is random, +1000 if server port is present, or allow it to be set explicitly.","createdAt":"2024-06-21T15:04:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1526#issuecomment-2182927811","viewerDidAuthor":false},{"id":"IC_kwDODN1w686dCqUW","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Closed by https://github.com/temporalio/cli/commit/469e8cf4a2a5743e829a19b209f1fa499665d2cf","createdAt":"2025-02-04T18:13:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/1526#issuecomment-2634720534","viewerDidAuthor":false}],"createdAt":"2024-06-20T22:38:16Z","labels":[{"id":"MDU6TGFiZWwyMDUzODEzNTY0","name":"potential-bug","description":"","color":"90c109"}],"milestone":null,"number":1526,"reactionGroups":[],"state":"CLOSED","title":"Starting DevServer with UI Enabled May Fail Due to Invalid Port Number","updatedAt":"2025-02-04T18:13:40Z","url":"https://github.com/temporalio/sdk-go/issues/1526"}
