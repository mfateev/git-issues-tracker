{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nRight now the timer in `AwaitWithTimeout` does not get cancelled when it's no longer needed. This means an erroneous workflow task is created when timer does fire.\r\n\r\n**Describe the solution you'd like**\r\n\r\nSee if we can compatibly start cancelling these timers. @mfateev has suggested we add a SDK version marker to the beginning of all workflows to be able to make these kinds of changes henceforth. Should be discussed.","closedAt":null,"comments":[{"id":"IC_kwDODN1w685RQmaw","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Is there any consequences to an erroneous workflow task being created? Just me being lazy, but do we have short example that triggers this already? ","createdAt":"2022-12-22T20:17:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/986#issuecomment-1363306160","viewerDidAuthor":false},{"id":"IC_kwDODN1w685RQpk3","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Is there any consequences to an erroneous workflow task being created?\r\n\r\nYes, lots. An otherwise idle workflow is now woken up to run. It'll be put to the top of LRU cache, replay itself, etc. We should reduce workflow tasks as much as is reasonable.\r\n\r\n> Just me being lazy, but do we have short example that triggers this already?\r\n\r\nWe don't, but it'd be easy to do, just `workflow.AwaitWithTimeout(ctx, 5 * time.Second, func() bool { return true })` then sleep for 10 seconds and confirm via history your now-not-needed timer was fired at 5 seconds.","createdAt":"2022-12-22T20:35:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-go/issues/986#issuecomment-1363319095","viewerDidAuthor":false},{"id":"IC_kwDODN1w685Rt1id","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"After discussion, we are going to look into a way to set some kind of SDK version on the first wft completed that works like a version marker which will let us make going-forward-only fixes to things like this.","createdAt":"2023-01-04T14:05:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/986#issuecomment-1370970269","viewerDidAuthor":false},{"id":"IC_kwDODN1w686bZSNn","author":{"login":"captchanjack-anzx"},"authorAssociation":"NONE","body":"Any update on this? With the new UI it's pretty clear timers are still not being cancelled from signals are received\n\n<img width=\"420\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/6d3c965c-8565-40d0-9b80-41612817ab91\" />\n\nmy implementation:\n```\n\texit := false\n\tfor !exit {\n\t\tvar got SignalPayload[T]\n\t\tok, more := s.receiveChannel.ReceiveWithTimeout(ctx, s.timeout, &got)\n\t\tif !ok {\n\t\t\treturn ErrSignalReceiverTimeout\n\t\t}\n\n\t\texit = signalCallback(got)\n\t\tif exit || !more {\n\t\t\tbreak\n\t\t}\n\t}\n\n\treturn nil\n```","createdAt":"2025-01-22T12:17:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/986#issuecomment-2607096679","viewerDidAuthor":false},{"id":"IC_kwDODN1w686bZ1RA","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This seems to be a duplicate post that was also made at https://github.com/temporalio/sdk-go/issues/1125#issuecomment-2607097161, answering there.","createdAt":"2025-01-22T13:22:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-go/issues/986#issuecomment-2607240256","viewerDidAuthor":false}],"createdAt":"2022-12-22T19:57:28Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzA3NDky","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":986,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"AwaitWithTimeout does not cancel its timer when condition is satisfied","updatedAt":"2025-01-22T13:23:00Z","url":"https://github.com/temporalio/sdk-go/issues/986"}
