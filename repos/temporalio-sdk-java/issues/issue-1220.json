{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjkxODEy","is_bot":false,"login":"macrogreg","name":"macrogreg"},"body":"I am running an integration test that is passing fine on both, a local docker-compose based server and on Temporal Cloud. But on the test server it fails immediately, and the server throws an internal exception.\r\n\r\n\r\n* The test starts a workflow. (That succeeds.)\r\n\r\n* Then it attempts to start a workflow with the _same_ Workflow Id as the workflow just started.\r\n\r\n* The test expects to get an `AlreadyExists` gRPC status / error from the `StartWorkflowExecution(..)` gRPC call.\r\n\r\n* Instead, it gets an unspecified gRPC error and the test server displays the following:\r\n```\r\nPS > .\\temporal-test-server.exe 7233\r\nMay 14, 2022 2:06:22 AM io.grpc.internal.SerializingExecutor run\r\nSEVERE: Exception while executing runnable io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed@6bb8cba3\r\njava.lang.RuntimeException: Generated message class \"io.temporal.api.errordetails.v1.WorkflowExecutionAlreadyStartedFailure\" missing method \"getStartRequestId\".\r\n        at com.google.protobuf.GeneratedMessageV3.getMethodOrDie(GeneratedMessageV3.java:1847)\r\n        at com.google.protobuf.GeneratedMessageV3.access$1000(GeneratedMessageV3.java:79)\r\n        at com.google.protobuf.GeneratedMessageV3$FieldAccessorTable$SingularFieldAccessor$ReflectionInvoker.<init>(GeneratedMessageV3.java:2176)\r\n        at com.google.protobuf.GeneratedMessageV3$FieldAccessorTable$SingularFieldAccessor.<init>(GeneratedMessageV3.java:2248)\r\n        at com.google.protobuf.GeneratedMessageV3$FieldAccessorTable$SingularStringFieldAccessor.<init>(GeneratedMessageV3.java:2916)\r\n        at com.google.protobuf.GeneratedMessageV3$FieldAccessorTable.ensureFieldAccessorsInitialized(GeneratedMessageV3.java:1977)\r\n        at io.temporal.api.errordetails.v1.WorkflowExecutionAlreadyStartedFailure.internalGetFieldAccessorTable(WorkflowExecutionAlreadyStartedFailure.java:93)\r\n        at com.google.protobuf.GeneratedMessageV3.getDescriptorForType(GeneratedMessageV3.java:133)\r\n        at com.google.protobuf.Any.pack(Any.java:183)\r\n        at io.temporal.serviceclient.StatusUtils.newException(StatusUtils.java:82)\r\n        at io.temporal.internal.testservice.TestWorkflowService.throwDuplicatedWorkflow(TestWorkflowService.java:286)\r\n        at io.temporal.internal.testservice.TestWorkflowService.startWorkflowExecutionImpl(TestWorkflowService.java:231)\r\n        at io.temporal.internal.testservice.TestWorkflowService.startWorkflowExecution(TestWorkflowService.java:204)\r\n        at io.temporal.api.workflowservice.v1.WorkflowServiceGrpc$MethodHandlers.invoke(WorkflowServiceGrpc.java:3822)\r\n        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)\r\n        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:340)\r\n        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)\r\n        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\r\n        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        at java.lang.Thread.run(Thread.java:833)\r\n        at com.oracle.svm.core.thread.PlatformThreads.threadStartRoutine(PlatformThreads.java:704)\r\n        at com.oracle.svm.core.windows.WindowsPlatformThreads.osThreadStartRoutine(WindowsPlatformThreads.java:143)\r\nCaused by: java.lang.NoSuchMethodException: io.temporal.api.errordetails.v1.WorkflowExecutionAlreadyStartedFailure.getStartRequestId()\r\n        at java.lang.Class.getMethod(DynamicHub.java:2227)\r\n        at com.google.protobuf.GeneratedMessageV3.getMethodOrDie(GeneratedMessageV3.java:1844)\r\n        ... 23 more\r\n```","closedAt":"2022-09-15T14:32:57Z","comments":[{"id":"IC_kwDODN12PM5KT8DA","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is likely a graal-specific issue because those protos are not available via reflection and using status details inside proto probably uses reflection. I only see `io.temporal.api.errordetails.v1.WorkflowExecutionAlreadyStartedFailure` and `io.temporal.api.errordetails.v1.QueryFailedFailure` being used as status details, but should probably make that whole `errordetails.v1` package available for reflecting.","createdAt":"2022-09-14T13:08:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1220#issuecomment-1246740672","viewerDidAuthor":false}],"createdAt":"2022-05-17T20:57:16Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":19,"title":"1.17.0","description":"","dueOn":"2022-09-26T00:00:00Z"},"number":1220,"reactionGroups":[],"state":"CLOSED","title":"Test Server fails when starting a workflow that already exists.","updatedAt":"2022-09-15T14:32:57Z","url":"https://github.com/temporalio/sdk-java/issues/1220"}
