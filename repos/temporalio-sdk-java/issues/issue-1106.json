{"assignees":[],"author":{"id":"MDQ6VXNlcjUzMjEwOA==","is_bot":false,"login":"Spikhalskiy","name":"Dmitry Spikhalsky"},"body":"## Expected Behavior\r\n\r\n```\r\n@WorkflowInterface\r\npublic interface ReportingWorkflow extends TemporalWorkflow<ReportQueriesResponse> {\r\n  @WorkflowMethod\r\n  ReportQueriesResponse runReport(ReportQueries reportQueries);\r\n}\r\n\r\npublic interface TemporalWorkflow<T> extends TemporalRunnable {\r\n  @QueryMethod\r\n  T getResults();\r\n}\r\n```\r\n\r\nTemporal JavaSDK should be able to understand that `ReportingWorkflow#getResults` returns ReportQueriesResponse and use this class as a target in data conversion.\r\n\r\n## Actual Behavior\r\n\r\nData Converters try to decode query results into `Object`.\r\n\r\n## Notes\r\n\r\nWorth checking the same problem for Activity Metadata resolution. \r\n\r\n## Specifications\r\n\r\n  - Version: 1.8.x\r\n","closedAt":"2024-09-01T23:24:21Z","comments":[{"id":"IC_kwDODN12PM5QPaIS","author":{"login":"mfateev"},"authorAssociation":"MEMBER","body":"I don't think this is a bug. Given that Java erases generics information at runtime, it is impossible to implement.","createdAt":"2022-12-12T10:12:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1106#issuecomment-1346216466","viewerDidAuthor":true},{"id":"IC_kwDODN12PM5QQWN8","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> it is impossible to implement.\r\n\r\nTrue, but there are utilities if we ever want to have user-specified generic values (e.g. maybe a default method that returns https://guava.dev/releases/21.0/api/docs/com/google/common/reflect/TypeToken.html for `T`)\r\n\r\nBut what I would recommend is to disallow annotations on generic methods. If Temporal needs to know concrete types, it should be an error not to be able to reflectively obtain them. So in the pasted sample, they'd need to provide an annotation on the concrete interface override instead.","createdAt":"2022-12-12T13:07:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1106#issuecomment-1346462588","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5QRM8Z","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"> Given that Java erases generics information at runtime, it is impossible to implement.\r\n\r\nIt's not exactly true. Java erases generic information for dynamically created instances of gentrified classes. But Java do preserve information about generic typed for defined standalone classes. Basically, if you have `class A extends/implements B<C>` - type of C is preserved and can be got from reflection.\r\nIt's possible and it's a bug (or missing and never implemented feature) from my point of view.","createdAt":"2022-12-12T15:19:08Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1106#issuecomment-1346686745","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5QRVu2","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"You're going to have to have really complicated rules about how to derive `C` in complicated inheritance scenarios. And what if they never provide a type parameter? in an inherited interface? Or what if they do `? extends List<String>` or something. Or additional type constraints in multiple levels? Or if they have another that uses a more specific generic value than the base interface but still generic?\r\n\r\nI think this is a can of worms that you can only half support. I can give lots of confusing scenarios. To me the most straightforward answer is \"you cannot define Temporal annotations on generic items\". It's harmless to ask someone to have a concrete override for use by stubs and other items.\r\n\r\nIf you're afraid of compatibility, leave current `Object` behavior and log warning.","createdAt":"2022-12-12T15:35:30Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1106#issuecomment-1346722742","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5QRdHT","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"> I think this is a can of worms that you can only half support.\r\nThat's fine. Most things that user need is a very straightforward 1-1 unbounded resolution we 100% can and should support.\r\n\r\nAn implementer of this feature should think about scenarios and may ban some specific scenarios and throw an exception if something is too complicated to resolve like it's already done now we a diamond inheritance.\r\n\r\nWhat most people want from this feature of supporting generics is totally doable and non-ambiguous. \r\n\r\n","createdAt":"2022-12-12T15:46:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1106#issuecomment-1346752979","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5QRotu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"```java\r\n@WorkflowInterface\r\npublic interface ReportingWorkflow<T extends ReportQueriesResponse> extends TemporalRunnable {\r\n  @WorkflowMethod\r\n  String runReport(ReportQueries reportQueries);\r\n\r\n  @QueryMethod\r\n  T getResults();\r\n}\r\n```\r\n\r\nIf I register this interface, will you support this use case? If clear, no prob, just want to make sure the rules will be clear and users aren't surprised when something silently is not supported while something else silently is.","createdAt":"2022-12-12T16:07:42Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1106#issuecomment-1346800494","viewerDidAuthor":false}],"createdAt":"2022-03-31T00:35:29Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1106,"reactionGroups":[],"state":"CLOSED","title":"Workflow metadata resolution code doesn't respect generics specified down the hierarchy","updatedAt":"2024-09-01T23:24:21Z","url":"https://github.com/temporalio/sdk-java/issues/1106"}
