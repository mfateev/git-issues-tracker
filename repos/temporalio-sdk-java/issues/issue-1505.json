{"assignees":[],"author":{"id":"MDQ6VXNlcjExOTQyMg==","is_bot":false,"login":"tsurdilo","name":"Tihomir Surdilovic"},"body":"Forum posts:\r\nhttps://community.temporal.io/t/unexpected-signal-received-after-workflow-error/6405\r\nhttps://community.temporal.io/t/signal-received-after-workflow-is-closed/6379\r\n\r\nWorking on a proper sdk test but just wanted to report and will update when test is done. \r\nHere is the code the i used to reproduce: https://gist.github.com/tsurdilo/14f538881c511ab0c1c2162fc7286eb0\r\n( you have to start it and let it run for a while sometimes, you might see multiple ContinuedAsNew executions before error happens as signal has to hit the right time)\r\n\r\n* Have a workflow that starts a long running activity (in loop) inside cancellation scope. Loop is for 10 activity invocations, then it calls continueasnew\r\n* Workflow has a signal method which cancels the scope of the currently running activity inside that loop in wf\r\n* Client keeps sending signals for cancellation to this workflow\r\n\r\nSeems that when a signal comes in at same time as workflow calls continueasnew, worker raises UnhandledCommand to extend the workflow task and handle that signal, on next workflow task the signal is processed, tries to cancel CancellationScope and the wf task fails again with:\r\n\r\n<img width=\"1686\" alt=\"Screen Shot 2022-11-05 at 9 39 04 PM\" src=\"https://user-images.githubusercontent.com/119422/200150501-1979159d-52c8-4f66-bb1c-c99a54b69eee.png\">\r\n\r\nat this point the workflow task keeps failing and replaying.\r\n","closedAt":"2023-11-09T16:39:45Z","comments":[{"id":"IC_kwDODN12PM5q6HoL","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Testing the reproduction on the latest SDK https://gist.github.com/tsurdilo/14f538881c511ab0c1c2162fc7286eb0 it does not cause any `IllegalStateException` on the latest SDK","createdAt":"2023-11-05T03:18:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1505#issuecomment-1793620491","viewerDidAuthor":false}],"createdAt":"2022-11-06T01:56:51Z","labels":[],"milestone":{"number":12,"title":"Next","description":"","dueOn":null},"number":1505,"reactionGroups":[],"state":"CLOSED","title":"IllegalStateException: Signal received after workflow is closed","updatedAt":"2023-11-09T16:39:45Z","url":"https://github.com/temporalio/sdk-java/issues/1505"}
