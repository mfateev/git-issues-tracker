{"assignees":[],"author":{"id":"MDQ6VXNlcjExODExNDQ4","is_bot":false,"login":"Bennett-Lynch","name":"Bennett Lynch"},"body":"I'd like to create base interfaces and abstract classes for common workflow patterns. While possible, Temporal does not discover the `@WorkflowMethod` annotation from parent classes:\r\n\r\n> You can create interface inheritance hierarchies to reuse components across other Workflow interfaces. The interface inheritance approach does not apply to `@WorkflowMethod` annotations. [[source]](https://legacy-documentation-sdks.temporal.io/java/how-to-develop-a-workflow-definition-in-java)\r\n\r\nIs there any reason for this limitation? If the risk is multi-inheritance of `@WorkflowMethod` methods, could that simply be a runtime violation or unspecified behavior?\r\n\r\nThe workaround is to redeclare and annotate the method, which results in unnecessary code and may be more error prone.","closedAt":"2023-02-22T18:56:49Z","comments":[{"id":"IC_kwDODN12PM5V3hVI","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I'll let @Spikhalskiy answer for Java, but I can say we have the same intentional attribute/decorator inheritance limitation in .NET/Python very specifically because we _want_ you to have to annotate the most overridden form. These annotations mark methods as special and therefore hiding whether they are special up the inheritance chain is error prone.\r\n\r\n> which results in unnecessary code and may be more error prone.\r\n\r\nWe intentionally accept that it adds more code, but how is it more error prone?","createdAt":"2023-02-22T18:50:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440617800","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V3jE-","author":{"login":"Bennett-Lynch"},"authorAssociation":"NONE","body":"It can be more error prone in that someone implementing an abstract workflow class may not know they need to redeclare and annotate methods, and these misses may not be discovered until runtime (often with obscure serialization errors). It's counter-intuitive to how people normally interact with abstract classes.","createdAt":"2023-02-22T18:55:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440624958","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V3jnK","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@WorkflowMethod annotation pretty much defines a specific workflow type and there should be one workflow of the specific type in most apps.\r\n```\r\npublic @interface WorkflowMethod {\r\n  /** Name of the workflow type. Default is {short class name} */\r\n  String name() default \"\";\r\n}\r\n```\r\n\r\nWe don't want this annotation to be placed on a parent class with multiple children explicitly to point this out.\r\n\r\nYou can still use inheritance and have several implementations of the same type if you want to. Just implement the workflow method in the parent without an annotation, override the method in the child, annotate it with a right @WorkflowMethod and delegate it to the parent.","createdAt":"2023-02-22T18:56:49Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440627146","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V3lRP","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> these misses may not be discovered until runtime (often with obscure serialization errors)\r\n\r\nIn some languages we validate up the inheritance chain at registration time. So if you have an override that doesn't define the Temporal annotation its base signature does, we error at registration time. I could see that extra validation having value.","createdAt":"2023-02-22T18:58:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440633935","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V3obB","author":{"login":"Bennett-Lynch"},"authorAssociation":"NONE","body":"> @WorkflowMethod annotation pretty much defines a specific workflow type and there should be one workflow of the specific type in most apps.\r\n\r\nIsn't this true for `@WorkflowInterface` but not necessarily `@WorkflowMethod`?\r\n\r\nI'll give a slightly more concrete example for a use case I have in mind:\r\n\r\nI'm designing an interface and corresponding abstract class for a workflow that is primarily signal-driven. The abstract class facilitates polling for signals, deduplicating signals, etc. Implementations of the abstract class can then simply instrument the behavior to react to the signal and decide if it's terminal.\r\n\r\nIn this scenario I want to offer this abstract class as a library, and there may be multiple implementations of it within a single application. So I would not wish to declare `@WorkflowInterface` at the parent interface level, but it does make sense to declare `@WorkflowMethod` at the parent interface level.\r\n\r\nImplementations of the parent interface then need to mostly pointlessly redeclare the `startworkflow` method just to add an annotation. In my opinion it makes sense and offers value for Temporal to be able to discover this annotation through inheritance. It should probably be used with caution, but I'd rather leave that judgment to the interface author.","createdAt":"2023-02-22T19:06:21Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440646849","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V3vtQ","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"We don't want `@WorkflowMethod`'s to be flying around and leaking without any attachment to the `@WorkflowInterface`, this is the idea and a design.\r\nBoth `@WorkflowInterface` and `@WorkflowMethod` work together to define a workflow type.\r\nWhat a `@WorkflowMethod` annotation with a specified `name` in the parent class means if it's not a WorkflowInterface implementation at all?\r\n\r\n> So I would not wish to declare @WorkflowInterface at the parent interface level, but it does make sense to declare @WorkflowMethod at the parent interface level.\r\n\r\nYou parent class is not implementing a @WorkflowInterface, it shouldn't have WorkflowMethods. It's not workflow methods. It's just methods.\r\nChildren that implement @WorkflowInterface may MAKE them @WorkflowMethod by overriding them. \r\nIf you want to make clear for your library users what method of a parent class is intended to be a workflow method, you can make your own documenting annotation like @WorkflowMethodCandidate or @WorkflowMethodArchetype. But they are not @WorkflowMethod without @WorkflowInterface.","createdAt":"2023-02-22T19:27:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440676688","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V3znO","author":{"login":"Bennett-Lynch"},"authorAssociation":"NONE","body":"Thanks @Spikhalskiy. I can understand that reasoning even if I'm not 100% in agreement with the design.\r\n\r\nHowever, if you argue that these workflow-related annotations are meaningless when not associated with a workflow interface, wouldn't the same be true for something like `@Signal`? But the documentation [here](https://legacy-documentation-sdks.temporal.io/java/workflows) suggests creating reusable interface components as follows:\r\n\r\n```\r\npublic interface Retryable {\r\n    @SignalMethod\r\n    void retryNow();\r\n}\r\n```\r\n\r\n```\r\n@WorkflowInterface\r\npublic interface MediaProcessingWorkflow extends Retryable {\r\n\r\n    @WorkflowMethod\r\n    String processBlob(Arguments args);\r\n}\r\n```\r\n\r\n`Retryable` is not a workflow interface so by the same logic it should not be allowed to contain any workflow-related annotations. (I understand that a workflow can have multiple `@SignalMethod`s and only one `@WorkflowMethod`, but I think the same logic still applies.)\r\n\r\n(In my opinion the above pattern _does_ offer value and the same value could be extended to `@WorkflowMethod`. However I'm also not sure if the documentation is correct. From my local testing it does not seem that `@SignalMethod` is discoverable via inheritance either.)","createdAt":"2023-02-22T19:38:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440692686","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V4S5g","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"\"Mixins\" (not a term you hear in Java much but applicable in other langs where we have this same rule) and multi-inherited interfaces can have value for signals and queries which can have > 1 arity and be composable with unrelated sets of each other, but workflow methods are singular and not composable in that way.","createdAt":"2023-02-22T21:26:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440820832","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5V4YIO","author":{"login":"Bennett-Lynch"},"authorAssociation":"NONE","body":"IMHO, regardless of arity, inheritance is just a way to help organize and abstract code and it would be nice if the Temporal SDK allowed developers to make their own judgment call on how it is structured. I'll make one final plea to consider the same and otherwise I appreciate the opinions and respect the design decision. :)","createdAt":"2023-02-22T21:43:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1669#issuecomment-1440842254","viewerDidAuthor":false}],"createdAt":"2023-02-22T18:48:26Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ4","name":"question","description":"Further information is requested","color":"BFD4F2"},{"id":"LA_kwDODN12PM7NRayD","name":"wontfix","description":"This will not be worked on","color":"BFD4F2"}],"milestone":null,"number":1669,"reactionGroups":[],"state":"CLOSED","title":"Inheritance with @WorkflowMethod annotation","updatedAt":"2023-02-22T21:43:07Z","url":"https://github.com/temporalio/sdk-java/issues/1669"}
