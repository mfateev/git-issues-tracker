{"assignees":[],"author":{"id":"U_kgDOBaJ48w","is_bot":false,"login":"ddavidyuk","name":""},"body":"## Expected Behavior\r\n`WorkflowHistoryLoader` should be able to load history from a file downloaded via Temporal UI / Temporal Cloud UI with \"Decode History\" option.\r\n\r\n## Actual Behavior\r\n`WorkflowHistoryLoader` fails when loading a file downloaded via Temporal UI / Temporal Cloud UI with \"Decode History\" option.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Open any completed workflow execution in Temporal UI or Temporal Cloud UI\r\n2. Click Download History with checked \"Decode History\" option.\r\n3. Try to load the history from the downloaded file via `WorkflowHistoryLoader` API: `WorkflowHistoryLoader.readHistory(<path to the history JSON file>)`\r\n4. `WorkflowHistoryLoader` fails with this exception (the actual payload replaced with ..., cannot provide it here):\r\n```\r\nio.temporal.common.converter.DataConverterException: com.google.protobuf.InvalidProtocolBufferException: Invalid value: {...} for expected type: BYTES\r\n\tat io.temporal.common.WorkflowExecutionHistory.fromJson(WorkflowExecutionHistory.java:79)\r\n\tat io.temporal.common.WorkflowExecutionHistory.fromJson(WorkflowExecutionHistory.java:63)\r\n\tat io.temporal.testing.WorkflowHistoryLoader.readHistory(WorkflowHistoryLoader.java:60)\r\n...\r\nCaused by: com.google.protobuf.InvalidProtocolBufferException: Invalid value: {...} for expected type: BYTES\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.parseFieldValue(JsonFormat.java:1971)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeField(JsonFormat.java:1669)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeMessage(JsonFormat.java:1500)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.merge(JsonFormat.java:1458)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.parseFieldValue(JsonFormat.java:2018)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeRepeatedField(JsonFormat.java:1733)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeField(JsonFormat.java:1665)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeMessage(JsonFormat.java:1500)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.merge(JsonFormat.java:1458)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.parseFieldValue(JsonFormat.java:2018)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeField(JsonFormat.java:1669)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeMessage(JsonFormat.java:1500)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.merge(JsonFormat.java:1458)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.parseFieldValue(JsonFormat.java:2018)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeOneofField(JsonFormat.java:1708)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeField(JsonFormat.java:1667)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeMessage(JsonFormat.java:1500)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.merge(JsonFormat.java:1458)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.parseFieldValue(JsonFormat.java:2018)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeRepeatedField(JsonFormat.java:1733)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeField(JsonFormat.java:1665)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.mergeMessage(JsonFormat.java:1500)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.merge(JsonFormat.java:1458)\r\n\tat com.google.protobuf.util.JsonFormat$ParserImpl.merge(JsonFormat.java:1340)\r\n\tat com.google.protobuf.util.JsonFormat$Parser.merge(JsonFormat.java:472)\r\n\tat io.temporal.common.WorkflowExecutionHistory.fromJson(WorkflowExecutionHistory.java:77)\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: Temporal Java SDK 1.23.2\r\n  - Platform: Temporal Cloud UI, same issue with Temporal UI\r\n\r\n## Additional details\r\n\r\nWe are testing our encrypting / compressing DataConverter, and would like to be able to download decoded event history for local testing with WorkflowReplayer class (to make sure the changes we make to our workflows are compatible with prior event histories).","closedAt":"2024-06-13T15:55:27Z","comments":[{"id":"IC_kwDODN12PM6BG8WC","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"The UI \"Decode History\" is designed for human consumption not SDK consumption and is not intended to be compatible with SDKs so it is not expected to work. Our docs generally recommend downloading history from the CLI or SDK to replay https://docs.temporal.io/develop/java/testing-suite#replay. \r\n\r\nWe do also plan to add utilities inside the SDK to make it easier to decode encrypted payloads in history to make replay easier as well.\r\n\r\nhttps://github.com/temporalio/features/issues/468","createdAt":"2024-06-13T15:55:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2109#issuecomment-2166080898","viewerDidAuthor":false}],"createdAt":"2024-06-13T11:45:58Z","labels":[],"milestone":null,"number":2109,"reactionGroups":[],"state":"CLOSED","title":"WorkflowHistoryLoader fails to load decoded event history","updatedAt":"2024-06-13T15:55:27Z","url":"https://github.com/temporalio/sdk-java/issues/2109"}
