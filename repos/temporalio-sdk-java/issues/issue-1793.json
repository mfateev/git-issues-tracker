{"assignees":[],"author":{"id":"U_kgDOBaJ48w","is_bot":false,"login":"ddavidyuk","name":""},"body":"**Is your feature request related to a problem? Please describe.**\r\nWe would like to implement a generic interceptor that can detect that the workflow is about to fail and in this case invoke an activity (send email / post a message to kafka / alert).\r\n\r\n**Describe the solution you'd like**\r\nImplement `WorkflowInbouldCallsInterceptor.execute`, wrap the code in try / catch and catch the exception. In the catch block invoke our activity. Would be nice to have some static utility method that could tell us that the current exception will fail the workflow, the method should take into account `WorkflowImplementationOptions.failWorkflowExceptionTypes`.\r\n\r\n**Describe alternatives you've considered**\r\nThe alternative is to use a base workflow class / utility class with try / catch, but still there is no generic way to tell if the current exception will fail the workflow (`WorkflowImplementationOptions.failWorkflowExceptionTypes`).\r\n","closedAt":"2023-11-29T15:11:48Z","comments":[{"id":"IC_kwDODN12PM5fXUsC","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"There are a few problems with this idea. \r\n\r\nThe Temporal service owns workflow execution and could fail a workflow in certain situations without the worker being notified to handle it. An example would be a workflow timeout. \r\n\r\nIf we are only talking about workflow failures from exceptions then it is possible, ~but should probably be done in the workflow code.~","createdAt":"2023-06-21T01:50:47Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1599949570","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5fYgTv","author":{"login":"ddavidyuk"},"authorAssociation":"NONE","body":"Hello @Quinn-With-Two-Ns ! I was referring to an already existing interface `io.temporal.common.interceptors.WorkflowInboundCallsInterceptor#execute`, my understanding is that it already executes as part of the workflow code, so the interceptor code will be replayed in case of worker restart for example.","createdAt":"2023-06-21T06:30:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1600259311","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5fZDRv","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"hm yes you are correcy, my apologies.\r\n\r\n Originally I thought this should be done in the workflow, but looks like the Java SDK does not store `failWorkflowExceptionTypes` in history so exposing in workflows or workflows interceptors exposes a potential non determinism \r\n \r\n I wonder if you could just catch  `WorkflowExecutionException` in the interceptor?  That should be thrown if the workflow has failed.","createdAt":"2023-06-21T08:20:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1600402543","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5fZqB0","author":{"login":"ddavidyuk"},"authorAssociation":"NONE","body":"I'll check, but looking at the Temporal SDK code it looks like this exception is thrown one level above the interceptor. Also good point about non-deterministic behaviour, isn't it the case already now? If I replay a workflow with different `WorkflowImplementationOptions.failWorkflowExceptionTypes` I might get different results?\r\n","createdAt":"2023-06-21T10:08:02Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1600561268","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5h-9LF","author":{"login":"ddavidyuk"},"authorAssociation":"NONE","body":"Apologies for the late response, I've checked and `WorkflowExecutionException` is not available to the interceptor, we only get `ActivityFailure` in case activity fails for example. `WorkflowExecutionException` is generated further up the stack.","createdAt":"2023-07-20T13:06:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1643893445","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5h_xAJ","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"hm yes I believe you are correct. \r\n\r\nSince calling an activity conditional on an exception matching `failWorkflowExceptionTypes` is not deterministic I don't think we would want to add any feature that encourages this in the SDK.\r\n\r\nIf you still want to do this you can write your own interceptor or base worker and inject your `failWorkflowExceptionTypes` , but you  would need to be careful if you ever wanted to change `failWorkflowExceptionTypes` while you have workflows running","createdAt":"2023-07-20T15:10:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1644105737","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5tM2jQ","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Closing as not planned since such a utility would not be deterministic. If a users really wants it they can implmenet it themselves since they control `failWorkflowExceptionTypes` and take on the risk of using it correctly.","createdAt":"2023-11-29T15:11:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1793#issuecomment-1832085712","viewerDidAuthor":false}],"createdAt":"2023-06-20T07:56:49Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ0","name":"enhancement","description":"User experience","color":"a2eeef"}],"milestone":null,"number":1793,"reactionGroups":[],"state":"CLOSED","title":"Support for generic workflow failure handler via interceptor","updatedAt":"2023-11-29T15:11:48Z","url":"https://github.com/temporalio/sdk-java/issues/1793"}
