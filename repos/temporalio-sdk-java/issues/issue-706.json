{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjI2MzY5OTM=","is_bot":false,"login":"jonsie","name":"Chris Smalley"},"body":"Not sure if this is a bug report or a feature request - I could see it being a feature request.  Additionally I'm not sure if this issue is isolated to the Java SDK.\r\n\r\n## Expected Behavior\r\n\r\nOnce all workflows that are running on the old version are completed, one should be able to remove that code path (which is possible today) -- **including** the call to `Workflow#getVersion`.  This way, the codebase does not have to contain calls to `Workflow#getVersion` that signify nothing.\r\n\r\n## Actual Behavior\r\n\r\nRemoving the call to `Workflow#getVersion` is not safe and breaks workflow replay.\r\n\r\nIf you have a workflow history that contains a version marker (just a call to `Workflow#getVersion`), and you remove that version marker from a workflow it breaks replay when running the history via `Worker#replayWorkflowExecution`.\r\n\r\nThis means that if you expect your workflows to replay (queried, activity retries, etc), you can never remove a call to `Workflow#getVersion` without breaking the replay.\r\n\r\nThe documentation recommends a two step process to remove the version code:  https://docs.temporal.io/docs/java/versioning/\r\n\r\nIt includes the comment:\r\n\r\n```\r\n// getVersion call is left here to ensure that any attempt to replay history\r\n// for a different version fails. It can be removed later when there is no possibility\r\n// of this happening.\r\n``` \r\n\r\nHowever, I am not clear on what \"different version\" means here - any attempt to replay history with the version marker in the history (which all versions will have) but with the `Workflow#getVersion` call removed from the code will break replay-ability.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.  Create a workflow with a call to `Workflow#getVersion`\r\n  1.  Run the workflow and export the history\r\n  1.  Remove the call to `Workflow#getVersion`\r\n  1.  Replay the workflow history via  `Worker#replayWorkflowExecution`\r\n\r\n## Specifications\r\n\r\n  - Version:  v1.2.0\r\n  - Platform:  MacOS\r\n","closedAt":"2021-10-27T18:24:27Z","comments":[{"id":"IC_kwDODN12PM42vRpb","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"```\r\n// getVersion call is left here to ensure that any attempt to replay history\r\n// for a different version fails. It can be removed later when there is no possibility\r\n// of this happening.\r\n```\r\n\r\nThis is how it's designed, yes. \r\nVersion marker should be ignored if `getVersion` call is removed and it's a supported behavior.\r\nSo it looks like java-sdk Version state machine bug for me.","createdAt":"2021-09-13T16:26:11Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/706#issuecomment-918362715","viewerDidAuthor":false}],"createdAt":"2021-09-09T21:46:41Z","labels":[],"milestone":{"number":6,"title":"1.5.0","description":"","dueOn":"2021-11-02T00:00:00Z"},"number":706,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"Unable to remove`Workflow#getVersion` calls once added to a workflow","updatedAt":"2021-10-27T18:24:27Z","url":"https://github.com/temporalio/sdk-java/issues/706"}
