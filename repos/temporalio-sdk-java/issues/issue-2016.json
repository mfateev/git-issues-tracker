{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNTA0MDQ5","is_bot":false,"login":"Quinn-With-Two-Ns","name":"Quinn Klassen"},"body":"## Expected Behavior\r\n`isReplaying()`  is true when replaying and false when not replaying\r\n\r\n## Actual Behavior\r\n`isReplaying()`  is false when the workflow is replaying for a query\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.Start a workflow that immediately waits for a signal\r\n  2.Restart the worker running the above workflow\r\n  3.Send a query to the workflow\r\n\r\n## Specifications\r\n\r\n  - Version: v1.23.0\r\n  - Platform: mac \r\n","closedAt":"2024-05-08T14:59:40Z","comments":[{"id":"IC_kwDODN12PM55L5iP","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Auditing the replay code \r\n\r\n```\r\n    if (replaying\r\n        && !hasNextEvent\r\n        && (event.getEventType() == EventType.EVENT_TYPE_WORKFLOW_TASK_STARTED\r\n            || WorkflowExecutionUtils.isWorkflowTaskClosedEvent(event))) {\r\n      replaying = false;\r\n    }\r\n```\r\n\r\nhttps://github.com/temporalio/sdk-java/blob/bc726c9ad4646fc5d14e91bcea11190ff7537ca0/temporal-sdk/src/main/java/io/temporal/internal/statemachines/WorkflowStateMachines.java#L427\r\n\r\nThis check is flawed since if we receive a query after a workflow task that didn't generate a command will cause the Java SDK to incorrectly assume the workflow is no longer replaying.  \r\n\r\n","createdAt":"2024-04-02T21:47:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2016#issuecomment-2033162383","viewerDidAuthor":false}],"createdAt":"2024-03-26T17:48:01Z","labels":[],"milestone":null,"number":2016,"reactionGroups":[],"state":"CLOSED","title":"Investigate bad `isReplaying` value on direct query when workflow is not in cache","updatedAt":"2024-05-08T14:59:40Z","url":"https://github.com/temporalio/sdk-java/issues/2016"}
