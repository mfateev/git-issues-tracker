{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjUzMjEwOA==","is_bot":false,"login":"Spikhalskiy","name":"Dmitry Spikhalsky"},"body":"## Actual Behavior\r\n\r\n[Currently](https://github.com/temporalio/sdk-java/blob/37a0e463fae2312882b5c946f423a0dbf85f9666/temporal-sdk/src/main/java/io/temporal/internal/worker/QueryReplayHelper.java#L76) during a full replay that is explicitly exposed to users using `Worker#replayWorkflowExecution`, JavaSDK supplies [fake](https://github.com/temporalio/sdk-java/blob/37a0e463fae2312882b5c946f423a0dbf85f9666/temporal-sdk/src/main/java/io/temporal/internal/common/WorkflowExecutionHistory.java#L115) WorkflowId which can break determinism if workflow code depends on these values.\r\n\r\n## Expected Behavior\r\n\r\nActual values from the history should be taken and supplied to the Workflow in WorkflowInfo during replay.\r\n\r\n## Additional context\r\n\r\nhttps://community.temporal.io/t/recommended-approach-to-testing-backwards-compatibility/5511\r\n\r\nGood catch from Max that the same shouldn't apply to RunID, because usage of runId in workflow code is non-deterministic (think of reset)","closedAt":"2023-01-26T19:05:14Z","comments":[{"id":"IC_kwDODN12PM5IxWek","author":{"login":"mfateev"},"authorAssociation":"MEMBER","body":" The workflow code must not depend on runId as reset operation changes it.","createdAt":"2022-08-19T17:03:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1378#issuecomment-1220896676","viewerDidAuthor":true},{"id":"IC_kwDODN12PM5Ixa6T","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@mfateev Fair, good catch on runId. I will add this comment on WorkflowInfo#getRunId javadoc, because I don't think we state this unobvious fact anywhere.","createdAt":"2022-08-19T17:24:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1378#issuecomment-1220914835","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Ixttv","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"We should consider putting run_id in unsafe (might be too late though), the only issue is that the current run_id isn't stored in history so we can't provide it to the replayer, we only have original_run_id in WorkflowExecutionStarted which is the closest thing.","createdAt":"2022-08-19T18:41:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1378#issuecomment-1220991855","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Iyf4O","author":{"login":"mfateev"},"authorAssociation":"MEMBER","body":"There is [originalRunId](https://github.com/temporalio/api/blob/79e9495c8f2c2518bb29cb72056c796b5b9fc26a/temporal/api/history/v1/message.proto#L77) that is preserved on reset.","createdAt":"2022-08-20T01:14:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1378#issuecomment-1221197326","viewerDidAuthor":true},{"id":"IC_kwDODN12PM5TxcXH","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Addressed by #1497","createdAt":"2023-01-26T19:05:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1378#issuecomment-1405470151","viewerDidAuthor":false}],"createdAt":"2022-08-19T05:18:19Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":20,"title":"1.18.0","description":"","dueOn":"2022-11-29T00:00:00Z"},"number":1378,"reactionGroups":[],"state":"CLOSED","title":"Pass real WorkflowId for full replay exposed to users in Worker#replayWorkflowExecution","updatedAt":"2023-01-26T19:05:15Z","url":"https://github.com/temporalio/sdk-java/issues/1378"}
