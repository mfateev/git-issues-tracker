{"assignees":[],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"## Expected Behavior\r\n\r\n`Activity.wrap(new ActivityFailure(100, 1234,\"\", \"234\", RetryStatus.RETRY_STATUS_INTERNAL_SERVER_ERROR, \"runId\", new Throwable()))\r\n`\r\nshould work\r\n\r\n## Actual Behavior\r\nFails with ClassCastException:\r\n\r\n```\r\njava.lang.RuntimeException: Failure processing local activity task.\r\n\tat io.temporal.internal.worker.LocalActivityWorker$TaskHandlerImpl.wrapFailure(LocalActivityWorker.java:229)\r\n\tat io.temporal.internal.worker.LocalActivityWorker$TaskHandlerImpl.wrapFailure(LocalActivityWorker.java:189)\r\n\tat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:79)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\nCaused by: java.lang.ClassCastException: class java.lang.Throwable cannot be cast to class java.lang.Exception (java.lang.Throwable and java.lang.Exception are in module java.base of loader 'bootstrap')\r\n\tat io.temporal.internal.common.CheckedExceptionWrapper.unwrap(CheckedExceptionWrapper.java:94)\r\n\tat io.temporal.failure.FailureConverter.exceptionToFailure(FailureConverter.java:182)\r\n\tat io.temporal.failure.FailureConverter.exceptionToFailureNoUnwrapping(FailureConverter.java:201)\r\n\tat io.temporal.failure.FailureConverter.exceptionToFailure(FailureConverter.java:183)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler.mapToActivityFailure(POJOActivityTaskHandler.java:128)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler.access$400(POJOActivityTaskHandler.java:54)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler$POJOLocalActivityImplementation.execute(POJOActivityTaskHandler.java:257)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler.handle(POJOActivityTaskHandler.java:176)\r\n\tat io.temporal.internal.worker.LocalActivityWorker$TaskHandlerImpl.handleLocalActivity(LocalActivityWorker.java:270)\r\n\tat io.temporal.internal.worker.LocalActivityWorker$TaskHandlerImpl.handle(LocalActivityWorker.java:200)\r\n\tat io.temporal.internal.worker.LocalActivityWorker$TaskHandlerImpl.handle(LocalActivityWorker.java:189)\r\n\tat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:73)\r\n\t... 3 common frames omitted\r\n\r\n```\r\n\r\nThe bug is in the CheckedExceptionWrapper.unwrap which assumes that a cause of an exception is either Error or Exception, but never any other child of Throwable or Throwable itself.\r\n","closedAt":"2020-08-23T01:34:59Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY3ODcxNzU0Mg==","author":{"login":"mfateev"},"authorAssociation":"MEMBER","body":"Fixed by https://github.com/temporalio/java-sdk/pull/172. Validated by #194 ","createdAt":"2020-08-23T01:34:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/149#issuecomment-678717542","viewerDidAuthor":true}],"createdAt":"2020-07-13T23:53:45Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":149,"reactionGroups":[],"state":"CLOSED","title":"Workflow.wrap and Activity.wrap fail on chained Throwable","updatedAt":"2020-08-23T01:34:59Z","url":"https://github.com/temporalio/sdk-java/issues/149"}
