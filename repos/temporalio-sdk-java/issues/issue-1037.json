{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjUzMjEwOA==","is_bot":false,"login":"Spikhalskiy","name":"Dmitry Spikhalsky"},"body":"## Expected Behavior\r\n\r\nAsynchronously scheduled child workflow that was not yet scheduled on the server can be successfully canceled.\r\n\r\n## Actual Behavior\r\n\r\nhttps://community.temporal.io/t/cancel-of-a-cancellationscope-not-working-as-expected/3885/10\r\nIt looks like there is a state machines problem:\r\n\r\n```\r\n12:34:08.580 [TemporalShutdownManager: 1] WARN  i.t.i.sync.DeterministicRunnerImpl - Promise completed with exception and was never accessed. The ignored exception:\r\njava.lang.RuntimeException: ChildWorkflow: failure executing START_COMMAND_CREATED->CANCEL, transition history is [CREATED->SCHEDULE]\r\n\tat io.temporal.internal.statemachines.StateMachine.executeTransition(StateMachine.java:151)\r\n\tat io.temporal.internal.statemachines.StateMachine.handleExplicitEvent(StateMachine.java:91)\r\n\tat io.temporal.internal.statemachines.EntityStateMachineBase.explicitEvent(EntityStateMachineBase.java:78)\r\n\tat io.temporal.internal.statemachines.ChildWorkflowStateMachine.cancel(ChildWorkflowStateMachine.java:204)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.lambda$startChildWorkflow$3c6a4bb6$1(WorkflowStateMachines.java:583)\r\n\tat io.temporal.internal.replay.ReplayWorkflowContextImpl.lambda$startChildWorkflow$547d36$1(ReplayWorkflowContextImpl.java:229)\r\n\tat io.temporal.internal.sync.SyncWorkflowContext.lambda$executeChildWorkflow$8d8a678d$1(SyncWorkflowContext.java:513)\r\n\tat io.temporal.internal.sync.CompletablePromiseImpl.lambda$thenApply$2df5ef44$1(CompletablePromiseImpl.java:210)\r\n\tat io.temporal.internal.sync.CompletablePromiseImpl.lambda$handle$6a2a7e3d$1(CompletablePromiseImpl.java:219)\r\n\tat io.temporal.internal.sync.CompletablePromiseImpl.lambda$then$16b0e4cc$1(CompletablePromiseImpl.java:268)\r\n\tat io.temporal.internal.sync.CompletablePromiseImpl.invokeHandlers(CompletablePromiseImpl.java:276)\r\n\tat io.temporal.internal.sync.CompletablePromiseImpl.complete(CompletablePromiseImpl.java:167)\r\n\tat io.temporal.internal.sync.CancellationScopeImpl.cancel(CancellationScopeImpl.java:120)\r\n\tat io.temporal.workflow.MaximCodeModified$ParentWorkflowImpl.ParentGreeting(MaximCodeModified.java:148)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat io.temporal.internal.sync.POJOWorkflowImplementationFactory$POJOWorkflowImplementation$RootWorkflowInboundCallsInterceptor.execute(POJOWorkflowImplementationFactory.java:317)\r\n\tat io.temporal.internal.sync.POJOWorkflowImplementationFactory$POJOWorkflowImplementation.execute(POJOWorkflowImplementationFactory.java:292)\r\n\tat io.temporal.internal.sync.WorkflowExecuteRunnable.run(WorkflowExecuteRunnable.java:72)\r\n\tat io.temporal.internal.sync.SyncWorkflow.lambda$start$0(SyncWorkflow.java:137)\r\n\tat io.temporal.internal.sync.CancellationScopeImpl.run(CancellationScopeImpl.java:101)\r\n\tat io.temporal.internal.sync.WorkflowThreadImpl$RunnableWrapper.run(WorkflowThreadImpl.java:111)\r\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tat java.base/java.lang.Thread.run(Thread.java:829)\r\nCaused by: java.lang.NullPointerException: null\r\n\tat java.base/java.util.Objects.requireNonNull(Objects.java:221)\r\n\tat io.temporal.failure.CanceledFailure.<init>(CanceledFailure.java:32)\r\nCaused by: java.lang.NullPointerException: null\r\n\r\n\tat io.temporal.internal.statemachines.ChildWorkflowStateMachine.cancelStartChildCommand(ChildWorkflowStateMachine.java:215)\r\n\tat io.temporal.internal.statemachines.FixedTransitionAction.apply(FixedTransitionAction.java:45)\r\n\tat io.temporal.internal.statemachines.StateMachine.executeTransition(StateMachine.java:147)\r\n```","closedAt":"2022-06-19T23:53:37Z","comments":[],"createdAt":"2022-02-10T18:26:17Z","labels":[],"milestone":{"number":15,"title":"1.13.0","description":"","dueOn":"2022-06-28T00:00:00Z"},"number":1037,"reactionGroups":[],"state":"CLOSED","title":"Canceling of child workflow schedule command problem","updatedAt":"2022-06-19T23:53:37Z","url":"https://github.com/temporalio/sdk-java/issues/1037"}
