{"assignees":[],"author":{"id":"MDQ6VXNlcjUxNDkzMg==","is_bot":false,"login":"antmendoza","name":"Antonio Mendoza PÃ©rez"},"body":"## Expected Behavior\r\n\r\nreported here https://community.temporal.io/t/workflow-task-metrics-only-have-labels-with-the-workflow-type-none-for-the-java-sdk/5942\r\n\r\nThere is no alignment in the tags pupulated by both metrics (_temporal_activity_schedule_to_start_latency_seconds_bucket_ and _temporal_workflow_task_schedule_to_start_latency_seconds_bucket_). Either both should populate their respective tags, or none of them should. That is:\r\n- _activity_type_ tag for _temporal_activity_schedule_to_start_latency_seconds_bucket_ . Right now this metric has both tags _activity_type_ and  _workflow_type_  populated.\r\n\r\n\r\ni.e.: `temporal_activity_schedule_to_start_latency_seconds_bucket{activity_type=\"PerformB\",exception=\"none\",namespace=\"default\",operation=\"none\",query_type=\"none\",signal_name=\"none\",status_code=\"none\",task_queue=\"metricsqueue\",workerCustomTag1=\"workerCustomTag1Value\",workerCustomTag2=\"workerCustomTag2Value\",worker_type=\"ActivityWorker\",workflow_type=\"MetricsWorkflow\",le=\"0.001\",} 0.0`\r\n\r\n- _workflow_type_ tag for _temporal_workflow_task_schedule_to_start_latency_seconds_bucket_ . Right now this metric doesn't have the tag _workflow_type_ populated.\r\n\r\ni.e.: `temporal_workflow_task_schedule_to_start_latency_seconds_bucket{activity_type=\"none\",exception=\"none\",namespace=\"default\",operation=\"none\",query_type=\"none\",signal_name=\"none\",status_code=\"none\",task_queue=\"metricsqueue\",workerCustomTag1=\"workerCustomTag1Value\",workerCustomTag2=\"workerCustomTag2Value\",worker_type=\"WorkflowWorker\",workflow_type=\"none\",le=\"0.001\",} 0.0`\r\n\r\n\r\n\r\nThe documentation should be fixed:\r\n- https://docs.temporal.io/references/sdk-metrics/#workflow_task_schedule_to_start_latency\r\n- https://docs.temporal.io/references/sdk-metrics/#activity_schedule_to_start_latency\r\n\r\n## Actual Behavior\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. run https://github.com/temporalio/samples-java/tree/main/src/main/java/io/temporal/samples/metrics\r\n  1. navigate to worker metrics\r\n  1. search for temporal_workflow_task_schedule_to_start_latency_seconds_bucket and temporal_activity_schedule_to_start_latency_seconds_bucket\r\n\r\n## Specifications\r\n\r\n  - Version: sdk-java 1.16.0\r\n  - Platform:\r\n","closedAt":"2025-05-16T22:40:26Z","comments":[{"id":"IC_kwDODN12PM5KJvTn","author":{"login":"andrey-dubnik"},"authorAssociation":"NONE","body":"Hi, considering one worker may service multiple workflow and activities types I would rather have everything populated. This seem reproduces self in Java SDK where for Go it worked fine with all the tags present (last time I checked)\n\nThanks,\nA","createdAt":"2022-09-12T17:28:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1244067047","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5KJwaL","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"This metric doesn't apply to workflow type (and activity type). \"Schedule to start\" is a metric of a poller. Poller works on a task queue level. Poller doesn't know about workflow or activity types and doesn't discriminate by them. So, this metric makes sense only for the whole task queue, not per workflow/activity types. Populating this field only creates more metrics with fewer samples for each of them, so damaging the sample size and blurring the meaning of the metric. \"Type\" tag on this metric is now just artificial for an underlying abstraction, but also detrimental to the usability of the metric.\r\n\r\nWe will discuss internally if we should just easy-fix this and populate `workflow_type` in Java. Or, actually, `workflow_type` and `activity_type` should be removed from this metric on all SDKs.","createdAt":"2022-09-12T17:32:50Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1244071563","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5KJ1cU","author":{"login":"antmendoza"},"authorAssociation":"MEMBER","body":"Please also review https://docs.temporal.io/references/sdk-metrics/#workflow_task_queue_poll_succeed , the documentation mention that the tag workflow_type should be present but it isn't \r\n\r\n`temporal_workflow_task_queue_poll_succeed_total{activity_type=\"none\",exception=\"none\",namespace=\"default\",operation=\"none\",query_type=\"none\",signal_name=\"none\",status_code=\"none\",task_queue=\"sticky\",workerCustomTag1=\"workerCustomTag1Value\",workerCustomTag2=\"workerCustomTag2Value\",worker_type=\"none\",workflow_type=\"none\",} 3.0`","createdAt":"2022-09-12T17:49:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1244092180","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5KOVwi","author":{"login":"andrey-dubnik"},"authorAssociation":"NONE","body":"adding a suggestion per the conversation in the community forum\r\n\r\nIt is not clear from the documentation when the metric is worker/poller specific or a workflow/activity aware as there is a group of metrics specific to the worker which does not apply to the workflow/activity. It would be great if documentation enabled the simplified grouping of such metrics (e.g. additional tag) or had a separate section related to the poller/worker.","createdAt":"2022-09-13T11:25:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1245273122","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5g4snZ","author":{"login":"fitialovks"},"authorAssociation":"NONE","body":"We have also found that in Java SDK `workflow_task_queue_poll_succeed` counter doesn't have a `workflow_type` label. It is present in Go SDK and can be easily added in Java, unless there is some performance consideration.\r\n\r\nhttps://github.com/temporalio/sdk-java/blob/15337d9a7cfd12ca1d3096034e017a82f167ea45/temporal-sdk/src/main/java/io/temporal/internal/worker/WorkflowPollTask.java#L172\r\n\r\nSee also `response.getWorkflowType()` a few lines above.","createdAt":"2023-07-07T14:11:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1625475545","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5g4_WZ","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"There is no performance consideration. The reason it is not included is because this metric doesn't apply to workflow type because pollers works on a task queue level","createdAt":"2023-07-07T15:06:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1625552281","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5g5NKp","author":{"login":"fitialovks"},"authorAssociation":"NONE","body":"Would this be a correct summary of the `workflow_task_queue_poll_succeed` counter state?\r\n1. Java SDK does not have a `workflow_type` label because it's irrelevant for the poller.\r\n2. Go SDK and the dashboard example keep the label for backwards compatibility.\r\n\r\nHere is the suggested dashboard https://github.com/temporalio/dashboards/blob/fe62b4e4567951497c511696b527b9037ef0a04f/sdk/sdk-general.json#L834\r\n\r\nWhile irrelevant for the poller, the workflow type may be used for diagnostics. This seems to be the only metric marking a workflow task execution start. In case they are starting and not finishing (no success or failure events) I'd rather know which type it is. Current behavior may force us to use a queue per workflow just to get better metrics.","createdAt":"2023-07-07T15:47:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1625608873","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5g7LW8","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Spoke with the team the conclusion was `workflow_type` label is only supported on the Go SDK and should be removed from the documentation since it is not relevant to pollers. I will open an issue with docs to remove.\r\n\r\n@fitialovks for your use case you I think the best solution is a server side metric for workflow task timeout https://github.com/temporalio/temporal/issues/2526","createdAt":"2023-07-07T21:10:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1417#issuecomment-1626125756","viewerDidAuthor":false}],"createdAt":"2022-09-12T16:54:13Z","labels":[],"milestone":null,"number":1417,"reactionGroups":[],"state":"CLOSED","title":"Aling information provided by metrics temporal_activity_schedule_to_start_latency_seconds_bucket and temporal_workflow_task_schedule_to_start_latency_seconds_bucket","updatedAt":"2025-05-16T22:40:26Z","url":"https://github.com/temporalio/sdk-java/issues/1417"}
