{"assignees":[],"author":{"id":"MDQ6VXNlcjExMjc1","is_bot":false,"login":"mnichols","name":"Mike Nichols"},"body":"**Is your feature request related to a problem? Please describe.**\r\nRunId is not included in `HasWorkflowSerializationContext`. This makes it hard for PayloadCodec implementations that are caching payloads to disambiguate execution runs that have been ContinuedAsNew, Reset, etc.  \r\n\r\n**Describe the solution you'd like**\r\nExtend the implementations of HasWorkflowSerializationContext to accept RunId where possible. This is possible to set in all cases except ClientInterceptor concerns, so can be `null`. \r\n\r\n**Describe alternatives you've considered**\r\nThe concrete case this solves is where a user must set the TTL to expire payloads based on retention policy, but if an execution has been ContinuedAsNew only the payloads which correspond to the Runs which have been Completed/Canceled should be expired. Marking the entire payload history as expired by `WorkflowID` would be incorrect since the latest run might remain open for some time.\r\n\r\nMore broadly, having the RunID is so common across the execution `info` we expose elsewhere, it makes sense to pass this important identification of _which_ run we are dealing with all the way down here as well.","closedAt":"2024-03-08T20:11:40Z","comments":[{"id":"IC_kwDODN12PM506eIg","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":">Extend the implementations of HasWorkflowSerializationContext to accept RunId where possible. This is possible to set in all cases except ClientInterceptor concerns,\r\n\r\nIt is true that a workflow context has a runID, but it will often not be the correct runID. For example in the continue as new case the SDK does not know the runID of the new workflow execution.\r\n\r\n> The concrete case this solves is where a user must set the TTL to expire payloads based on retention policy\r\n\r\nBased on this use case I am not sure this is an appropriate solution given the SDK does not always have visibility into a workflows lifecycle. This would require to have some server sent events to fully capture a workflow/activity lifecycle to make decisions on payloads \r\n\r\nhttps://github.com/temporalio/temporal/issues/3709\r\n\r\n`SerializationContext` is meant to provide information needed to serialize a payload, if that information cannot be consistently provided then it can't be used to serialize the payload and I don't think it belongs in `SerializationContext` \r\n\r\n","createdAt":"2024-02-23T14:59:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1994#issuecomment-1961484832","viewerDidAuthor":false},{"id":"IC_kwDODN12PM506wh3","author":{"login":"mnichols"},"authorAssociation":"MEMBER","body":"I actually implemented the changes last night to see if RunId was available and apart from the Client interceptor found it was always there, but is this an example of where the runId being passed in might `not be the correct runID`??: \r\n\r\nhttps://github.com/temporalio/sdk-java/blob/hasworkflowserialization-context-runid/temporal-sdk/src/main/java/io/temporal/internal/sync/SyncWorkflowContext.java#L140\r\n\r\nOr is it in the POJO bit here: https://github.com/temporalio/sdk-java/blob/hasworkflowserialization-context-runid/temporal-sdk/src/main/java/io/temporal/internal/sync/POJOWorkflowImplementationFactory.java#L260 ?\r\n\r\nI'm trying to learn where the wrong runID might be getting inserted into this instance.","createdAt":"2024-02-23T15:43:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1994#issuecomment-1961560183","viewerDidAuthor":false},{"id":"IC_kwDODN12PM506z5s","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":">I actually implemented the changes last night to see if RunId was available and apart from the Client interceptor found it was always there, but is this an example of where the runId being passed in might not be the correct runID??:\r\n\r\nYes, any case involving reset, continue as new, last workflow result or child workflows you will get the runID for the current execution not the new execution since the runID is generated on the server.","createdAt":"2024-02-23T15:52:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1994#issuecomment-1961573996","viewerDidAuthor":false},{"id":"IC_kwDODN12PM52ZVkH","author":{"login":"mnichols"},"authorAssociation":"MEMBER","body":"Closing this out as it is not a tenable solution","createdAt":"2024-03-08T20:11:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1994#issuecomment-1986353415","viewerDidAuthor":false}],"createdAt":"2024-02-23T07:10:15Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ0","name":"enhancement","description":"User experience","color":"a2eeef"}],"milestone":null,"number":1994,"reactionGroups":[],"state":"CLOSED","title":"RunID is needed oftimes when relying on HasWorkflowSerializationContext in a PayloadCodec or Converter","updatedAt":"2024-03-08T20:11:40Z","url":"https://github.com/temporalio/sdk-java/issues/1994"}
