{"assignees":[],"author":{"id":"MDQ6VXNlcjEyODg0NDY5","is_bot":false,"login":"isacandrei","name":"Isac Andrei"},"body":"**Is your feature request related to a problem? Please describe.**\r\nWe are currently using Quarkus 3.6.9 with the Temporal Java SDK to run Temporal workers. Quakus typically enforces quite a recent version of the `grpc-bom`. In the above mentioned version, it is `1.59.0`, but in the soon to be releases LTS version it will most likely be `1.61.1`.\r\n\r\nThe problem is that this version introduces breaking changes - [v1.59.0](https://github.com/grpc/grpc-java/releases/tag/v1.59.0), which forces us to enforce a lower version of the GRPC libraries in all projects using the Temporal SDK.\r\n\r\n**Describe the solution you'd like**\r\nUpgrade the grpc dependencies to a version > 1.59.\r\n\r\n**Describe alternatives you've considered**\r\nRight now, we pinpointing an older version for the `grpc-bom` and that works just fine as long as we don't use grpc for any other use-case within the same service.\r\n\r\n","closedAt":"2024-02-07T18:24:29Z","comments":[{"id":"IC_kwDODN12PM5y3vZz","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"What breaking changes in `1.59.0` are you referring to? The Java SDK with its current dependencies is not affected by the ABI breakage in `1.59.0` I am aware of users successfully using `1.59.0` with the Java SDK.","createdAt":"2024-02-05T15:07:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-1927214707","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5y3zt0","author":{"login":"isacandrei"},"authorAssociation":"NONE","body":"The problem I ran into was coming from the the test tooling:\r\n```\r\norg.junit.jupiter.api.extension.TestInstantiationException: Failed to create test instance\r\n        at app//io.quarkus.test.junit.QuarkusTestExtension.initTestState(QuarkusTestExtension.java:784)\r\n        at app//io.quarkus.test.junit.QuarkusTestExtension.interceptTestClassConstructor(QuarkusTestExtension.java:750)\r\n        at java.base@17.0.9/java.util.Optional.orElseGet(Optional.java:364)\r\n        at java.base@17.0.9/java.util.ArrayList.forEach(ArrayList.java:1511)\r\n        at java.base@17.0.9/java.util.ArrayList.forEach(ArrayList.java:1511)\r\n\r\n        Caused by:\r\n        java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\r\n            at io.quarkus.runner.bootstrap.RunningQuarkusApplicationImpl.instance(RunningQuarkusApplicationImpl.java:90)\r\n            at io.quarkus.test.junit.QuarkusTestExtension.createActualTestInstance(QuarkusTestExtension.java:790)\r\n            at io.quarkus.test.junit.QuarkusTestExtension.initTestState(QuarkusTestExtension.java:778)\r\n            ... 4 more\r\n\r\n            Caused by:\r\n            java.lang.reflect.InvocationTargetException\r\n                at java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n                at io.quarkus.runner.bootstrap.RunningQuarkusApplicationImpl.instance(RunningQuarkusApplicationImpl.java:88)\r\n                ... 6 more\r\n\r\n                Caused by:\r\n                java.lang.NoClassDefFoundError: io/grpc/inprocess/InProcessServerBuilder\r\n                    at io.temporal.internal.testservice.TestWorkflowService$Client.<init>(TestWorkflowService.java:135)\r\n                    at io.temporal.internal.testservice.TestWorkflowService.<init>(TestWorkflowService.java:170)\r\n                    at io.temporal.testing.TestWorkflowEnvironmentInternal.<init>(TestWorkflowEnvironmentInternal.java:64)\r\n                    at io.temporal.testing.TestWorkflowEnvironment.newInstance(TestWorkflowEnvironment.java:95)\r\n                    at io.beekeeper.data.governance.service.helpers.TemporalTestSupport.produceTestWorkflowEnvironment(TemporalTestSupport.java:43)\r\n                    at io.beekeeper.data.governance.service.helpers.TemporalTestSupport_ProducerMethod_produceTestWorkflowEnvironment_de1jZMWvwvWHAR2TO30lLYEL0qE_Bean.doCreate(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.helpers.TemporalTestSupport_ProducerMethod_produceTestWorkflowEnvironment_de1jZMWvwvWHAR2TO30lLYEL0qE_Bean.create(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.helpers.TemporalTestSupport_ProducerMethod_produceTestWorkflowEnvironment_de1jZMWvwvWHAR2TO30lLYEL0qE_Bean.get(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.helpers.TemporalTestSupport_ProducerMethod_produceTestWorkflowEnvironment_de1jZMWvwvWHAR2TO30lLYEL0qE_Bean.get(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.workflows.definitions.TenantDataCleanupWorkflowTest_Bean.doCreate(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.workflows.definitions.TenantDataCleanupWorkflowTest_Bean.create(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.workflows.definitions.TenantDataCleanupWorkflowTest_Bean.get(Unknown Source)\r\n                    at io.beekeeper.data.governance.service.workflows.definitions.TenantDataCleanupWorkflowTest_Bean.get(Unknown Source)\r\n                    at io.quarkus.arc.impl.InstanceImpl.getBeanInstance(InstanceImpl.java:325)\r\n                    at io.quarkus.arc.impl.InstanceImpl.getInternal(InstanceImpl.java:309)\r\n                    at io.quarkus.arc.impl.InstanceImpl.get(InstanceImpl.java:190)\r\n                    ... 8 more\r\n\r\n                    Caused by:\r\n                    java.lang.ClassNotFoundException: io.grpc.inprocess.InProcessServerBuilder\r\n                        at io.temporal.internal.testservice.TestWorkflowService$Client.<init>(TestWorkflowService.java:135)\r\n                        ... 23 more\r\n```","createdAt":"2024-02-05T15:16:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-1927232372","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5zLqpx","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"I don't believe `InProcessServerBuilder` is affected by the ABI breakage. I am not familiar with Quarkus, but I can post a sample showing the `Java-SDK` working with the latest `grpc`.","createdAt":"2024-02-07T16:37:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-1932438129","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5zMZGS","author":{"login":"isacandrei"},"authorAssociation":"NONE","body":"ok, I dug a little bit more into it. The problem is that the class `io/grpc/inprocess/InProcessServerBuilder` was moved from `io.grpc:grpc-core` to `io.grpc:grpc-inprocess`, which is not included in the temporal-sdk, as it only has been [published](https://mvnrepository.com/artifact/io.grpc/grpc-inprocess) since version 1.58.\r\n\r\n","createdAt":"2024-02-07T18:24:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-1932628370","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6IEmEt","author":{"login":"ggrebert"},"authorAssociation":"NONE","body":"@Quinn-With-Two-Ns\r\n \r\nI have the same issue\r\n\r\nDescription from le GRPC release [1.59.0](https://github.com/grpc/grpc-java/releases/tag/v1.59.0):\r\n\r\n> Class io.grpc.internal.AbstractServerImplBuilder is deleted, and no longer in the class hierarchy of the server builders:\r\n> \r\n> io.grpc.netty.NettyServerBuilder\r\n> io.grpc.inprocess.InProcessServerBuilder\r\n\r\nSo `InProcessServerBuilder` is inpacted. And in Quarkus, which is using a resent GRPC version this class is not found.\r\n\r\n","createdAt":"2024-08-11T22:14:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-2282905901","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6IEo_V","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"@ggrebert as the issue suggest you may need to include `io.grpc:grpc-inprocess`. The Java SDK is not effected by the issue you liked to.\r\n\r\n>Users that recompiled their code using grpc-java [v1.36.0](https://github.com/grpc/grpc-java/releases/tag/v1.36.0) (released on Feb 23, 2021) and later, ARE NOT AFFECTED.","createdAt":"2024-08-11T23:04:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-2282917845","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6IEu9G","author":{"login":"ggrebert"},"authorAssociation":"NONE","body":"thank tou @Quinn-With-Two-Ns .\r\n\r\nIn fact, it works by adding the following deps:\r\n\r\n```xml\r\n<dependency>\r\n    <groupId>io.grpc</groupId>\r\n    <artifactId>grpc-inprocess</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.grpc</groupId>\r\n    <artifactId>grpc-services</artifactId>\r\n</dependency>\r\n```\r\n","createdAt":"2024-08-12T00:17:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1985#issuecomment-2282942278","viewerDidAuthor":false}],"createdAt":"2024-02-05T14:56:02Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ0","name":"enhancement","description":"User experience","color":"a2eeef"},{"id":"MDU6TGFiZWwxNjIyNzE5ODQ4","name":"question","description":"Further information is requested","color":"BFD4F2"}],"milestone":null,"number":1985,"reactionGroups":[],"state":"CLOSED","title":"Upgrade grpc dependencies","updatedAt":"2024-08-12T00:17:52Z","url":"https://github.com/temporalio/sdk-java/issues/1985"}
