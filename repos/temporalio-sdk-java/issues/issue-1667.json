{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"U_kgDOBaJ48w","is_bot":false,"login":"ddavidyuk","name":""},"body":"Some of our unit tests start workflows via `WorkflowStub.fromTyped(workflowStub).signalWithStart()` API and then invoke `WorkflowStub.fromTyped(workflowStub).getExecution()` for some checks down the line.\r\nWe've upgraded to Temporal Java SDK 1.18.1 and now `WorkflowStub.getExecution()` returns null and so our unit tests are failing.\r\n\r\n## Expected Behavior\r\n`WorkflowStub.fromTyped(workflowStub).getExecution()` should not return null after the workflow is started via `signalWithStart`\r\n\r\n## Actual Behavior\r\n`WorkflowStub.fromTyped(workflowStub).getExecution()` returns null after the workflow is started via `signalWithStart`\r\n\r\n## Steps to Reproduce the Problem\r\nThis unit test demonstrates the bug:\r\n```java\r\npublic class DemoBugTest {\r\n    @RegisterExtension\r\n    public static final TestWorkflowExtension TEST_WORKFLOW_EXTENSION =\r\n            TestWorkflowExtension.newBuilder()\r\n                    .setUseTimeskipping(false)\r\n                    .setDoNotStart(true)\r\n                    .build();\r\n\r\n    @WorkflowInterface\r\n    public interface TestWorkflow {\r\n        @SignalMethod\r\n        void setEvent(String event);\r\n        @WorkflowMethod\r\n        String execute();\r\n    }\r\n\r\n    public static class TestWorkflowImpl implements TestWorkflow {\r\n        private String event;\r\n        @Override\r\n        public void setEvent(String event) {\r\n            this.event = event;\r\n        }\r\n        @Override\r\n        public String execute() {\r\n            Workflow.await(() -> event != null);\r\n\r\n            return \"Processed \" + event;\r\n        }\r\n    }\r\n\r\n    private TestWorkflow workflowStub;\r\n\r\n    @BeforeEach\r\n    void setUpTemporal(TestWorkflowEnvironment testEnv,\r\n                       Worker worker,\r\n                       WorkflowClient workflowClient,\r\n                       WorkflowOptions workflowOptions) {\r\n\r\n        worker.registerWorkflowImplementationTypes(TestWorkflowImpl.class);\r\n        testEnv.start();\r\n\r\n        workflowStub = workflowClient.newWorkflowStub(TestWorkflow.class, workflowOptions);\r\n    }\r\n\r\n    @Test\r\n    public void testDemoBug() {\r\n        WorkflowStub.fromTyped(workflowStub).signalWithStart(\"setEvent\",\r\n                new Object[]{\"testEvent\"},\r\n                new Object[0]);\r\n\r\n        String result = WorkflowStub.fromTyped(workflowStub).getResult(String.class);\r\n        // The assertion below fails on Temporal Java SDK 1.18.1 but succeeds with 1.17.0\r\n        assertThat(WorkflowStub.fromTyped(workflowStub).getExecution()).isNotNull();\r\n    }\r\n}\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: Temporal Java SDK 1.18.1\r\n  - Platform:\r\n","closedAt":"2023-02-23T14:56:29Z","comments":[{"id":"IC_kwDODN12PM5V9WgP","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Patch release v1.18.2 that has a fix for this issue is out","createdAt":"2023-02-23T17:17:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1667#issuecomment-1442146319","viewerDidAuthor":false}],"createdAt":"2023-02-22T14:03:47Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":24,"title":"1.18.2","description":"","dueOn":"2023-02-23T00:00:00Z"},"number":1667,"reactionGroups":[],"state":"CLOSED","title":"WorkflowStub.getExecution returns null on Temporal Java SDK 1.18.1 when workflow is started via signalWithStart","updatedAt":"2023-02-23T17:17:30Z","url":"https://github.com/temporalio/sdk-java/issues/1667"}
