{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjE5OTQ1NjI5","is_bot":false,"login":"shubhati","name":"Shubham Tiwari"},"body":"While running workflow worker in kubernetes pod, the below error is seen \r\n```\r\n A fatal error has been detected by the Java Runtime Environment:\r\n\r\n  SIGSEGV (0xb) at pc=0x0000000000003fd6, pid=7, tid=0x00007fc7329e8ae8\r\n\r\n JRE version: OpenJDK Runtime Environment (8.0_275-b01) (build 1.8.0_275-b01)\r\n Java VM: OpenJDK 64-Bit Server VM (25.275-b01 mixed mode linux-amd64 compressed oops)\r\n Derivative: IcedTea 3.17.1\r\n Distribution: Custom build (Tue Feb 16 18:40:09 UTC 2021)\r\n Problematic frame:\r\n C  0x0000000000003fd6\r\n\r\n Core dump written. Default location: //core or core.7\r\n\r\n An error report file with more information is saved as:\r\n //hs_err_pid7.log\r\n```\r\n If you would like to submit a bug report, please include\r\n instructions on how to reproduce the bug and visit:\r\n   https://icedtea.classpath.org/bugzilla \r\n\r\n\r\nthe hs_err_pid7.log file is uploaded with this issue. The error occurs when newservicestub method is called to start the workflow worker. The code is below\r\n```\r\nPrometheusMeterRegistry registry = new PrometheusMeterRegistry(PrometheusConfig.DEFAULT);\r\n        StatsReporter reporter = new MicrometerClientStatsReporter(registry);\r\n        Scope scope = new RootScopeBuilder()\r\n                .reporter(reporter)\r\n                .reportEvery(com.uber.m3.util.Duration.ofSeconds(10));\r\n        HttpServer scrapeEndpoint = startPrometheusScrapeEndpoint(registry, 8002);\r\n        Runtime.getRuntime().addShutdownHook(new Thread(() -> scrapeEndpoint.stop(1)));\r\n        WorkflowServiceStubsOptions options = WorkflowServiceStubsOptions.newBuilder()\r\n                .setMetricsScope(scope)\r\n                .setTarget(\"temporaltest-frontend.temporal.svc.cluster.local:7233\")\r\n                .build();\r\n        WorkflowServiceStubs stubs = WorkflowServiceStubs.newServiceStubs(options);\r\n```\r\n\r\nNot able to proceed because of this error. please help me out\r\n[hs_err_pid7.log](https://github.com/temporalio/sdk-java/files/9222049/hs_err_pid7.log)\r\n\r\n## Expected Behavior\r\n\r\n## Actual Behavior\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.\r\n  1.\r\n  1.\r\n\r\n## Specifications\r\n\r\n  - Version: sdk version 1.12.0\r\n  - Platform: linux machine kubernetes pod\r\n","closedAt":"2022-08-01T00:23:06Z","comments":[{"id":"IC_kwDODN12PM5Hg0y3","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"What specific Linux distribution is used?","createdAt":"2022-07-29T17:33:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1199787191","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5HjdLS","author":{"login":"shubhati"},"authorAssociation":"NONE","body":"Linux version: `Linux version 5.4.196-108.356.amzn2.x86_64 (mockbuild@ip) (gcc version 7.3.1 20180712 (Red Hat 7.3.1-13) (GCC)) #1 SMP Thu May 26 12:49:47 UTC 2022`\r\n","createdAt":"2022-07-31T18:35:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1200476882","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Hjs2R","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@shubhati I don't think the dump attached to this issue happened on Red Hat Enterprise Linux. I see this in the dump:\r\n\r\n```\r\n---------------  S Y S T E M  ---------------\r\n\r\nOS:NAME=\"Alpine Linux\"\r\nID=alpine\r\nVERSION_ID=3.8.2\r\nPRETTY_NAME=\"Alpine Linux v3.8\"\r\nHOME_URL=\"http://alpinelinux.org\"\r\nBUG_REPORT_URL=\"http://bugs.alpinelinux.org\"\r\n```\r\n\r\nSo, this crash likely happened on Alpine.","createdAt":"2022-08-01T00:22:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1200541073","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Hjs6p","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Please reference https://github.com/grpc/grpc-java/issues/8751 for a solution.\r\nBasically, you have three options (other than moving from Alpine):\r\n1. Passing `-Dio.grpc.netty.shaded.io.netty.transport.noNative=true` to JVM. I don't recommend this option long-term as it will have performance implications, but it may be a temporary workaround.\r\n2. LD_PRELOAD fix: https://github.com/grpc/grpc-java/issues/8751#issuecomment-998199569\r\n3. Wait for the v1.15 release of Temporal JavaSDK that brings an updated [grpc-java 1.48 with an updated netty 4.1.77](https://github.com/grpc/grpc-java/releases/tag/v1.48.0) with a [change](https://github.com/netty/netty/pull/12313) that MAY help this issue. UPDATE: v1.15.1 is out.\r\n\r\nClosing as this issue is not caused and can't be solved in Temporal JavaSDK.","createdAt":"2022-08-01T00:23:05Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1200541353","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5HkW0-","author":{"login":"shubhati"},"authorAssociation":"NONE","body":"Strange, the output was the content of `/proc/version` file of the pod's VM. But surely will try the solutions suggested. Thanks a lot for quick help @Spikhalskiy ","createdAt":"2022-08-01T05:07:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1200713022","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5IMulz","author":{"login":"deltamualpha"},"authorAssociation":"NONE","body":"I ran into this issue with alpine and 1.14.0 of the SDK; the same version of alpine combined with 1.15.0 did not exhibit the crash after upgrade.","createdAt":"2022-08-10T21:28:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1211296115","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5IMxuE","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Thanks, @deltamualpha for the confirmation that it's indeed fixed in the new Netty.","createdAt":"2022-08-10T21:41:19Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1332#issuecomment-1211308932","viewerDidAuthor":false}],"createdAt":"2022-07-29T17:27:11Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":17,"title":"1.15.0","description":"","dueOn":"2022-07-19T00:00:00Z"},"number":1332,"reactionGroups":[],"state":"CLOSED","title":"Seeing SIGSEGV error while calling WorkflowServiceStubs.newServiceStub","updatedAt":"2022-08-10T21:41:36Z","url":"https://github.com/temporalio/sdk-java/issues/1332"}
