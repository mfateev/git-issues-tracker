{"assignees":[],"author":{"id":"MDQ6VXNlcjIyOTY3MDk0","is_bot":false,"login":"fcruzel","name":"Fran"},"body":"Running Temporal with Spring generates some exceptions that are not thrown in a standalone Temporal instance.\r\n\r\n```java\r\n// App.java \r\n\r\n@ComponentScan\r\n@EnableAutoConfiguration(exclude = {MetricFilterAutoConfiguration.class, MetricRepositoryAutoConfiguration.class})\r\n@EnableConfigurationProperties({LiquibaseProperties.class, ApplicationProperties.class, JHipsterExtraProperties.class})\r\npublic class App {\r\n  public static void main(String[] args) {\r\n    SpringApplication app = new SpringApplication(App.class);\r\n\r\n    // some calls here ...\r\n\r\n    // Init Temporal\r\n    WorkflowServiceStubs service = WorkflowServiceStubs.newInstance();\r\n    WorkflowClient client = WorkflowClient.newInstance(service);\r\n    WorkerFactory factory = WorkerFactory.newInstance(client);\r\n\r\n    Worker worker = factory.newWorker(\"Queue1\");\r\n    worker.registerWorkflowImplementationTypes(HelloWorldImpl.class); // workflow calls the activity and returns the result\r\n    worker.registerActivitiesImplementations(new SayHiActivityImpl()); // activity returns \"Hello world\"\r\n\r\n    factory.start();\r\n\r\n    HelloWorld workflow = client.newWorkflowStub(HelloWorld.class, WorkflowOptions.newBuilder().setTaskQueue(\"Queue1\").build());\r\n\r\n    System.out.println(\"Workflow result: \" + workflow.sayHello()); // prints \"Hello World\"\r\n  }\r\n}\r\n```\r\n\r\nWith this code, several exceptions are generated. However, they do not prevent the workflow and the activity from being correctly executed.\r\n\r\n---\r\n\r\nThis next exceptions are thrown on line 84, which corresponds to the line `WorkflowServiceStubs service = WorkflowServiceStubs.newInstance()`;\r\n\r\n```stacktrace\r\n2020-07-27 09:43:17.509 [main] DEBUG\r\n        i.g.netty.shaded.io.grpc.netty.Utils - Epoll is not available, using Nio. \r\njava.lang.ExceptionInInitializerError: null\r\n\tat io.grpc.netty.shaded.io.netty.channel.epoll.Epoll.<clinit>(Epoll.java:39)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.grpc.netty.shaded.io.grpc.netty.Utils.isEpollAvailable(Utils.java:284)\r\n\tat io.grpc.netty.shaded.io.grpc.netty.Utils.<clinit>(Utils.java:107)\r\n\tat io.grpc.netty.shaded.io.grpc.netty.NettyChannelBuilder.<clinit>(NettyChannelBuilder.java:74)\r\n\tat io.temporal.internal.grpc.WorkflowServiceStubsImpl.<init>(WorkflowServiceStubsImpl.java:108)\r\n\tat io.temporal.serviceclient.WorkflowServiceStubs.newInstance(WorkflowServiceStubs.java:34)\r\n\tat my.App.main(App.java:84)\r\nCaused by: java.lang.IllegalStateException: Only supported on Linux\r\n\tat io.grpc.netty.shaded.io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:225)\r\n\tat io.grpc.netty.shaded.io.netty.channel.epoll.Native.<clinit>(Native.java:58)\r\n\t... 9 common frames omitted\r\n```\r\n\r\n```stacktrace\r\n2020-07-27 09:43:17.603 [main] DEBUG\r\n        i.g.i.AbstractManagedChannelImplBuilder - Unable to apply census stats \r\njava.lang.ClassNotFoundException: io.grpc.census.InternalCensusStatsAccessor\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:418)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:351)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.grpc.internal.AbstractManagedChannelImplBuilder.getEffectiveInterceptors(AbstractManagedChannelImplBuilder.java:534)\r\n\tat io.grpc.internal.AbstractManagedChannelImplBuilder.build(AbstractManagedChannelImplBuilder.java:517)\r\n\tat io.temporal.internal.grpc.WorkflowServiceStubsImpl.<init>(WorkflowServiceStubsImpl.java:119)\r\n\tat io.temporal.serviceclient.WorkflowServiceStubs.newInstance(WorkflowServiceStubs.java:34)\r\n\tat my.App.main(App.java:84)\r\n2020-07-27 09:43:17.603 [main] DEBUG\r\n        i.g.i.AbstractManagedChannelImplBuilder - Unable to apply census stats \r\njava.lang.ClassNotFoundException: io.grpc.census.InternalCensusTracingAccessor\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:418)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:351)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.grpc.internal.AbstractManagedChannelImplBuilder.getEffectiveInterceptors(AbstractManagedChannelImplBuilder.java:569)\r\n\tat io.grpc.internal.AbstractManagedChannelImplBuilder.build(AbstractManagedChannelImplBuilder.java:517)\r\n\tat io.temporal.internal.grpc.WorkflowServiceStubsImpl.<init>(WorkflowServiceStubsImpl.java:119)\r\n\tat io.temporal.serviceclient.WorkflowServiceStubs.newInstance(WorkflowServiceStubs.java:34)\r\n\tat my.App.main(App.java:84)\r\n```\r\n\r\n---\r\n\r\nAnd this one is thrown after client.newWorkflowStub is called.\r\n\r\n```stacktrace\r\n2020-07-27 09:43:17.992 [Activity Poller taskQueue=\"Queue1\", namespace=\"default\": 3] DEBUG\r\n        io.perfmark.PerfMark - Error during PerfMark.<clinit> \r\njava.lang.ClassNotFoundException: io.perfmark.impl.SecretPerfMarkImpl$PerfMarkImpl\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:418)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:351)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.perfmark.PerfMark.<clinit>(PerfMark.java:36)\r\n\tat io.grpc.internal.ClientCallImpl.<init>(ClientCallImpl.java:109)\r\n\tat io.grpc.internal.ManagedChannelImpl$RealChannel.newCall(ManagedChannelImpl.java:890)\r\n\tat io.grpc.internal.ServiceConfigInterceptor.interceptCall(ServiceConfigInterceptor.java:137)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.internal.ManagedChannelImpl.newCall(ManagedChannelImpl.java:855)\r\n\tat io.grpc.internal.ForwardingManagedChannel.newCall(ForwardingManagedChannel.java:63)\r\n\tat io.temporal.internal.grpc.GrpcMetricsInterceptor$MetricsClientCall.<init>(GrpcMetricsInterceptor.java:88)\r\n\tat io.temporal.internal.grpc.GrpcMetricsInterceptor.interceptCall(GrpcMetricsInterceptor.java:74)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.temporal.internal.grpc.GrpcDeadlineInterceptor.interceptCall(GrpcDeadlineInterceptor.java:69)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.stub.MetadataUtils$HeaderAttachingClientInterceptor.interceptCall(MetadataUtils.java:74)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:128)\r\n\tat io.temporal.api.workflowservice.v1.WorkflowServiceGrpc$WorkflowServiceBlockingStub.pollActivityTaskQueue(WorkflowServiceGrpc.java:2682)\r\n\tat io.temporal.internal.worker.ActivityPollTask.poll(ActivityPollTask.java:95)\r\n\tat io.temporal.internal.worker.ActivityPollTask.poll(ActivityPollTask.java:38)\r\n\tat io.temporal.internal.worker.Poller$PollExecutionTask.run(Poller.java:273)\r\n\tat io.temporal.internal.worker.Poller$PollLoopTask.run(Poller.java:242)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n```\r\n2020-07-27 09:43:18.009 [Activity Poller taskQueue=\"Queue1\", namespace=\"default\": 3] DEBUG\r\n        io.grpc.Context - Storage override doesn't exist. Using default \r\njava.lang.ClassNotFoundException: io.grpc.override.ContextStorageOverride\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:418)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:351)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.grpc.Context$LazyStorage.createStorage(Context.java:142)\r\n\tat io.grpc.Context$LazyStorage.<clinit>(Context.java:131)\r\n\tat io.grpc.Context.storage(Context.java:119)\r\n\tat io.grpc.Context.current(Context.java:185)\r\n\tat io.grpc.internal.ClientCallImpl.<init>(ClientCallImpl.java:118)\r\n\tat io.grpc.internal.ManagedChannelImpl$RealChannel.newCall(ManagedChannelImpl.java:890)\r\n\tat io.grpc.internal.ServiceConfigInterceptor.interceptCall(ServiceConfigInterceptor.java:137)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.internal.ManagedChannelImpl.newCall(ManagedChannelImpl.java:855)\r\n\tat io.grpc.internal.ForwardingManagedChannel.newCall(ForwardingManagedChannel.java:63)\r\n\tat io.temporal.internal.grpc.GrpcMetricsInterceptor$MetricsClientCall.<init>(GrpcMetricsInterceptor.java:88)\r\n\tat io.temporal.internal.grpc.GrpcMetricsInterceptor.interceptCall(GrpcMetricsInterceptor.java:74)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.temporal.internal.grpc.GrpcDeadlineInterceptor.interceptCall(GrpcDeadlineInterceptor.java:69)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.stub.MetadataUtils$HeaderAttachingClientInterceptor.interceptCall(MetadataUtils.java:74)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:128)\r\n\tat io.temporal.api.workflowservice.v1.WorkflowServiceGrpc$WorkflowServiceBlockingStub.pollActivityTaskQueue(WorkflowServiceGrpc.java:2682)\r\n\tat io.temporal.internal.worker.ActivityPollTask.poll(ActivityPollTask.java:95)\r\n\tat io.temporal.internal.worker.ActivityPollTask.poll(ActivityPollTask.java:38)\r\n\tat io.temporal.internal.worker.Poller$PollExecutionTask.run(Poller.java:273)\r\n\tat io.temporal.internal.worker.Poller$PollLoopTask.run(Poller.java:242)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n---\r\n\r\n## Expected Behavior\r\n\r\nExceptions should not be thrown.\r\n\r\n## Actual Behavior\r\n\r\nExceptions are thrown for no apparent reason, since the same code in a standalone Temporal application doesn't throw any exceptions.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Use Temporal with a Spring app.\r\n  1. Register a workflow.\r\n  1. Execute it.\r\n\r\n## Specifications\r\n\r\n  - Version: v0.2.7\r\n  - Platform: Windows 10\r\n","closedAt":"2022-05-20T17:37:49Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY4MTUzMjA4MQ==","author":{"login":"kkcmadhu"},"authorAssociation":"NONE","body":"Ok, my understanding was ideally  this should not clash, cause library conflicts etc https://temporalio.slack.com/archives/CTT84KXK9/p1591634665191200\r\n\r\ncould this be the jhipster or @metricautoconfig related?\r\ni dont see these in my spring boot apps, but i don't use the metric or jhipster related annotations as well..\r\n\r\nmy set of annotation presently are @SpringBootApplication,@EnableTransactionManagement,@EnableJpaRepositories,@EntityScan,@EnableCaching","createdAt":"2020-08-27T05:25:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-681532081","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxNDU4NDU4Ng==","author":{"login":"ponson-thankavel-finastra"},"authorAssociation":"NONE","body":"I am facing exactly the same problem. @fcruzel, were you able to resolve this problem?","createdAt":"2021-04-07T04:07:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-814584586","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxNDYzNDUyNA==","author":{"login":"fcruzel"},"authorAssociation":"NONE","body":"@ponson-thankavel-finastra I stopped working on this and couldn't investigate further down","createdAt":"2021-04-07T06:17:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-814634524","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5DinY2","author":{"login":"J-DK"},"authorAssociation":"NONE","body":"Is there any update on this?","createdAt":"2022-05-20T17:26:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1133147702","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Dioza","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@J-DK Do you experience this issue?\r\nThis issue is stale, doesn't have a reproduction, and looks like a misconfigured classpath and logger.\r\n\r\n\r\nTemporal obviously has nothing to do with `ClassNotFoundException`, especially from classes Temporal doesn't need and use like `java.lang.ClassNotFoundException: io.perfmark.impl.SecretPerfMarkImpl$PerfMarkImpl`\r\nUsers need to make sure the right classes are available in the classpath.\r\n\r\n```\r\n2020-07-27 09:43:17.509 [main] DEBUG\r\n        i.g.netty.shaded.io.grpc.netty.Utils - Epoll is not available, using Nio. \r\njava.lang.ExceptionInInitializerError: null\r\n\tat io.grpc.netty.shaded.io.netty.channel.epoll.Epoll.<clinit>(Epoll.java:39)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.grpc.netty.shaded.io.grpc.netty.Utils.isEpollAvailable(Utils.java:284)\r\n\tat io.grpc.netty.shaded.io.grpc.netty.Utils.<clinit>(Utils.java:107)\r\n\tat io.grpc.netty.shaded.io.grpc.netty.NettyChannelBuilder.<clinit>(NettyChannelBuilder.java:74)\r\n\tat io.temporal.internal.grpc.WorkflowServiceStubsImpl.<init>(WorkflowServiceStubsImpl.java:108)\r\n\tat io.temporal.serviceclient.WorkflowServiceStubs.newInstance(WorkflowServiceStubs.java:34)\r\n\tat my.App.main(App.java:84)\r\nCaused by: java.lang.IllegalStateException: Only supported on Linux\r\n\tat io.grpc.netty.shaded.io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:225)\r\n\tat io.grpc.netty.shaded.io.netty.channel.epoll.Native.<clinit>(Native.java:58)\r\n\t... 9 common frames omitted\r\n```\r\n\r\nThis is not even a problem, it's gRPC logging an internal exception and diagnostic information with DEBUG level. Just configure the logger if you don't want to see it.","createdAt":"2022-05-20T17:34:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1133153498","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5DipfK","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"I'm going to close this issue, it's not actionable and it looks like not a temporal sdk issue, but user side configuration issue. \r\n@J-DK if you experience the issue, feel free to submit a new one and we can investigate there.","createdAt":"2022-05-20T17:37:49Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1133156298","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5DiyLe","author":{"login":"J-DK"},"authorAssociation":"NONE","body":"\r\n\r\n```\r\ni.g.stub.ClientCalls$ThreadlessExecutor : Runnable threw exception\r\njava.lang.NoClassDefFoundError: io/perfmark/PerfMark\r\nat io.grpc.internal.ClientCallImpl.<init>(ClientCallImpl.java:106) ~[grpc-core-1.43.0.jar:1.43.0]\r\n```\r\n\r\n\r\n\r\nI faced the above issue and it is fixed by explicitly adding the below dependency in the build file \r\n`implementation 'io.perfmark:perfmark-api:0.25.0' `","createdAt":"2022-05-20T18:25:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1133191902","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Dizp6","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@J-DK It looks like the correct thing to do here. Temporal JavaSDK doesn't use or need perfmark itself, so we are not going to add it as a transitive dependency.","createdAt":"2022-05-20T18:33:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1133197946","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5On_VV","author":{"login":"CharlieReitzel"},"authorAssociation":"NONE","body":"My application stops at `factory.start()` because the `java.lang.ClassNotFoundException: io.grpc.override.ContextStorageOverride` exception is thrown.  I'll try to pull in the jar as a direct dependency, but this appears to be a transitive dependency of Temporal that is missing.\r\n\r\nThe comment in WorkerFactory.java, lines 216-218, looks relevant:\r\n```\r\n    // Workers check and require that Temporal Server is available during start to fail-fast in case\r\n    // of configuration issues.\r\n    workflowClient.getWorkflowServiceStubs().connect(null);\r\n```\r\nI am connecting to a remote Temporal instance attempting use a mix of 1 local workflow and some remote activities.","createdAt":"2022-11-17T19:31:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1319105877","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5OoA_s","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@CharlieReitzel Temporal SDK doesn't use `ContextStorageOverride` or any classes from \"io.grpc.override\". So, Temporal will not be providing them.\r\nThe only place across all our transitive dependencies that uses this class is this one method in `io.grpc.Context` from io.grpc:grpc-context and it doesn't throw if the class is not available:\r\n\r\n```\r\n    private static Storage createStorage(\r\n        AtomicReference<? super ClassNotFoundException> deferredStorageFailure) {\r\n      try {\r\n        Class<?> clazz = Class.forName(\"io.grpc.override.ContextStorageOverride\");\r\n        // The override's constructor is prohibited from triggering any code that can loop back to\r\n        // Context\r\n        return clazz.asSubclass(Storage.class).getConstructor().newInstance();\r\n      } catch (ClassNotFoundException e) {\r\n        deferredStorageFailure.set(e);\r\n        return new ThreadLocalContextStorage();\r\n      } catch (Exception e) {\r\n        throw new RuntimeException(\"Storage override failed to initialize\", e);\r\n      }\r\n    }\r\n```\r\n\r\nit just logs it later:\r\n\r\n\r\n```\r\n      storage = createStorage(deferredStorageFailure);\r\n      Throwable failure = deferredStorageFailure.get();\r\n      // Logging must happen after storage has been set, as loggers may use Context.\r\n      if (failure != null) {\r\n        log.log(Level.FINE, \"Storage override doesn't exist. Using default\", failure);\r\n      }\r\n```\r\n\r\nPlease post the full exception you are getting.","createdAt":"2022-11-17T19:38:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1319112684","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Tz5t-","author":{"login":"Nishant-Pathak"},"authorAssociation":"NONE","body":"Hitting the same issue, not sure if this is Closed in the right way.","createdAt":"2023-01-27T07:19:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1406114686","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5T0q9t","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"It's Closed as unrelated to Temporal and something that can't and will not be addressed in Java SDK as I provided more context above.\r\nJavaSDK doesn't use `io.grpc.override.ContextStorageOverride` or any other classes from `io.grpc.override.*`. If your application needs this class for any reason, it's the responsibility of your application to make sure this class is present in a classpath.\r\n\r\nI also don't see how this exception\r\n\r\n```\r\njava.lang.ClassNotFoundException: io.grpc.override.ContextStorageOverride\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:418)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:351)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:264)\r\n\tat io.grpc.Context$LazyStorage.createStorage(Context.java:142)\r\n\tat io.grpc.Context$LazyStorage.<clinit>(Context.java:131)\r\n\tat io.grpc.Context.storage(Context.java:119)\r\n\tat io.grpc.Context.current(Context.java:185)\r\n\tat io.grpc.internal.ClientCallImpl.<init>(ClientCallImpl.java:118)\r\n\tat io.grpc.internal.ManagedChannelImpl$RealChannel.newCall(ManagedChannelImpl.java:890)\r\n\tat io.grpc.internal.ServiceConfigInterceptor.interceptCall(ServiceConfigInterceptor.java:137)\r\n\tat io.grpc.ClientInterceptors$InterceptorChannel.newCall(ClientInterceptors.java:156)\r\n\tat io.grpc.internal.ManagedChannelImpl.newCall(ManagedChannelImpl.java:855)\r\n\tat io.grpc.internal.ForwardingManagedChannel.newCall(ForwardingManagedChannel.java:63)\r\n```\r\n\r\nis possible on any modern grpc version, because `ClassNotFoundException` from the unavailability of `io.grpc.override.ContextStorageOverride` is getting gracefully handled in grpc-java: https://github.com/grpc/grpc-java/blob/master/context/src/main/java/io/grpc/Context.java#L134\r\n\r\nI may be able to help if you submit a reproduction. Otherwise, it's not a java-sdk issue and it doesn't reproduce with the dependencies java-sdk currently uses.","createdAt":"2023-01-27T10:36:00Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1406316397","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5T2Lka","author":{"login":"Nishant-Pathak"},"authorAssociation":"NONE","body":"Sure, here are my setup details\r\n\r\nJava version\r\n```\r\nâžœ  test git:(prod) java --version\r\nopenjdk 17.0.5 2022-10-18\r\nOpenJDK Runtime Environment (build 17.0.5+8-Ubuntu-2ubuntu122.04)\r\nOpenJDK 64-Bit Server VM (build 17.0.5+8-Ubuntu-2ubuntu122.04, mixed mode, sharing)\r\n```\r\n`Spring boot` Running Spring Boot 2.7.3\r\n\r\nTemporal `'io.temporal:temporal-sdk:1.17.0'`\r\n\r\nDo let me know if you need more info to reproduce. Else I am happy to jump over call and show the issue.\r\n","createdAt":"2023-01-27T16:11:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1406712090","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5T2kIq","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"This setup (Java 17, Spring Boot 2.7.3) works just fine and it's one of the configurations we routinely test as a part of our CI. This is not enough information for me to reproduce. Because the problem is with your application, your specific dependencies graph or classpath, not with JavaSDK.\r\nIf you need help with your application, I can take a peek. But I need a minimal reproduction: source code that I can run that fails with the same error that you observe. Only then I can tell you what's up with that reproduction and probably your application.\r\n\r\nYou can also try to post a runtime dependency tree of your project and the specific exception you observe. That may show something.","createdAt":"2023-01-27T17:22:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/162#issuecomment-1406812714","viewerDidAuthor":false}],"createdAt":"2020-07-30T06:10:34Z","labels":[],"milestone":null,"number":162,"reactionGroups":[],"state":"CLOSED","title":"Exceptions being thrown on execution with Spring related to gRPC and PerfMark","updatedAt":"2023-01-27T17:28:16Z","url":"https://github.com/temporalio/sdk-java/issues/162"}
