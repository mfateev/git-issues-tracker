{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjUzMjEwOA==","is_bot":false,"login":"Spikhalskiy","name":"Dmitry Spikhalsky"},"body":"The following code path leads to an unreleased thread in the case of the worker / state machine exceptions (or RejectedExecutionException):\r\n\r\n```\r\nio.temporal.internal.worker.WorkflowExecutionException: java.util.concurrent.RejectedExecutionException: Task java.util.concurrent.FutureTask@4176e14b[Not completed, task = java.util.concurrent.Executors$RunnableAdapter@4beb70[Wrapped task = io.temporal.internal.sync.WorkflowThreadImpl$RunnableWrapper@4747fa1]] rejected from java.util.concurrent.ThreadPoolExecutor@1faac87d[Running, pool size = 600, active threads = 600, queued tasks = 0, completed tasks = 14007]\r\nat io.temporal.internal.sync.POJOWorkflowImplementationFactory.mapToWorkflowExecutionException(POJOWorkflowImplementationFactory.java:359)\r\nat io.temporal.internal.sync.SyncWorkflow.mapUnexpectedException(SyncWorkflow.java:192)\r\nat io.temporal.internal.replay.ReplayWorkflowExecutor.mapUnexpectedException(ReplayWorkflowExecutor.java:152)\r\nat io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTaskImpl(ReplayWorkflowRunTaskHandler.java:191)\r\nat io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleQueryWorkflowTask(ReplayWorkflowRunTaskHandler.java:246)\r\nat io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleQueryOnlyWorkflowTask(ReplayWorkflowTaskHandler.java:267)\r\nat io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTask(ReplayWorkflowTaskHandler.java:107)\r\nat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:314)\r\nat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:274)\r\nat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:73)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\nat java.base/java.lang.Thread.run(Thread.java:829)\r\n```","closedAt":"2021-11-18T07:00:40Z","comments":[],"createdAt":"2021-11-17T06:07:16Z","labels":[],"milestone":{"number":7,"title":"1.6.0","description":"","dueOn":"2021-12-07T00:00:00Z"},"number":880,"reactionGroups":[],"state":"CLOSED","title":"Legacy query path leads to thread leaks in case of state machine exceptions","updatedAt":"2021-11-18T07:00:40Z","url":"https://github.com/temporalio/sdk-java/issues/880"}
