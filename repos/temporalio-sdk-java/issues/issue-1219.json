{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjE2NTMzMTY4","is_bot":false,"login":"joshchoo","name":"Josh"},"body":"## Expected Behavior\r\n\r\nWhen time skipping is disabled in the `TestEnvironmentOptions`, calling `WorkflowStub.getResult` should not re-enable it.\r\n\r\n## Actual Behavior\r\n\r\nCalling `WorkflowStub.getResult` appears to call the `temporal.api.testservice.v1.TestService/UnlockTimeSkipping` API, which fast-forwards the workflow execution and causes the workflow to time-out. When asynchronous operations (CompletableFuture, Kafka, etc) attempt to interact (e.g. execute workflow signals) with the workflow they would fail because the workflow has already timed out.\r\n\r\n**`temporal.api.testservice.v1.TestService/UnlockTimeSkipping` logs:**\r\n```\r\n18:39:00.875 [Test worker] TRACE i.t.s.GrpcDeadlineInterceptor - method=temporal.api.testservice.v1.TestService/UnlockTimeSkipping, timeoutMs=9223372036854775807\r\n18:39:00.876 [Test worker] TRACE i.t.s.GrpcTracingInterceptor - Invoking \"temporal.api.testservice.v1.TestService/UnlockTimeSkipping\" with input: \r\n```\r\n\r\nThis problem was introduced in Temporal Java SDK version **1.9.0**. For info, this issue is not present in **1.8.1**.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nI have created a reproduction of the issue in this repo: [temporal-bug-reproduction](https://github.com/joshchoo/temporal-bug-reproduction)\r\n\r\nHere is the commit with the failing test case: https://github.com/joshchoo/temporal-bug-reproduction/commit/3abe213cd4ec5e8818508e9b0ed8bb46276b6fa7\r\n\r\n1. Run the `HelloSignalTest.testSignal` test case. It will fail and the logs show that `temporal.api.testservice.v1.TestService/UnlockTimeSkipping` is called.\r\n\r\n## Issue not present in v1.8.1\r\n\r\nHere's the same test with sdk-java v1.8.1, which passes: https://github.com/joshchoo/temporal-bug-reproduction/tree/disable-time-skip-works-1.8.1\r\n\r\n## Specifications\r\n\r\n  - Version: sdk-java v1.9.0+\r\n  - Platform: MacOS - local development\r\n","closedAt":"2022-05-17T13:47:01Z","comments":[{"id":"IC_kwDODN12PM5DSYsD","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"This problem should be already fixed by https://github.com/temporalio/sdk-java/pull/1210 and be a part of the next release.","createdAt":"2022-05-17T13:47:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1219#issuecomment-1128893187","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5DUZxa","author":{"login":"joshchoo"},"authorAssociation":"NONE","body":"Gotcha @Spikhalskiy, thanks for the fix and heads-up!","createdAt":"2022-05-17T23:41:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1219#issuecomment-1129421914","viewerDidAuthor":false}],"createdAt":"2022-05-17T10:53:28Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":14,"title":"1.12.0","description":"","dueOn":"2022-05-19T00:00:00Z"},"number":1219,"reactionGroups":[],"state":"CLOSED","title":"Disabled time skipping becomes re-enabled when calling `WorkflowStub.getResult`","updatedAt":"2022-05-18T20:53:58Z","url":"https://github.com/temporalio/sdk-java/issues/1219"}
