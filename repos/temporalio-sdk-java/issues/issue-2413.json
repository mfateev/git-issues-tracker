{"assignees":[],"author":{"id":"MDQ6VXNlcjUxNDkzMg==","is_bot":false,"login":"antmendoza","name":"Antonio Mendoza PÃ©rez"},"body":"## Expected Behavior\nAdding new parameters to running/closed workflows should be safe for the data converter and converted to null during replay\n\n## Actual Behavior\n\n#### Adding a new parameter of type List to a workflow input causes the data converter to fail.\n\nFrom: \n```\n        @WorkflowMethod\n        String execute(String name);\n```\nto :\n\n```\n        @WorkflowMethod\n        String execute(String name, List<String> names);\n```\n\nthrows during replay \n\n```\nCaused by: java.lang.ClassCastException: class sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl cannot be cast to class java.lang.Class (sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl and java.lang.Class are in module java.base of loader 'bootstrap')\n\tat io.temporal.common.converter.DataConverter.fromPayloads(DataConverter.java:162)\n\tat io.temporal.internal.sync.POJOWorkflowImplementationFactory$POJOWorkflowImplementation.execute(POJOWorkflowImplementationFactory.java:349)\n\tat io.temporal.internal.sync.WorkflowExecutionHandler.runWorkflowMethod(WorkflowExecutionHandler.java:71)\n```\n\n#### Adding a new parameter of type String or Custom object works as expected.\n\n\nFrom: \n```\n        @WorkflowMethod\n        String execute(String name);\n```\nto :\n\n```\n        @WorkflowMethod\n        String execute(String name, String names);\n\n        @WorkflowMethod\n        String execute(String name, MyObject names);\n```\n\n \n\n## Steps to Reproduce the Problem\n\nI have attached a project that reproduces the issue \n\n[Archive.zip](https://github.com/user-attachments/files/18751454/Archive.zip)\n\n## Specifications\n\n  - Version: SDK 1.27.1\n  - Platform:\n","closedAt":"2025-08-12T16:21:35Z","comments":[{"id":"IC_kwDODN12PM6eB4f6","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Adding new parameters to running/closed workflows should be safe for the data converter and converted to null during replay\n\n~Hrmm, I am not sure this is true across all SDKs. We discard _extra_ arguments if too many come in, but I am not sure we make empty/zero values in all SDKs if the value is not there. In Go we might default to zero value because zero values are clear, but this is not necessarily the case with all SDKs. In .NET for instance we even have a specific error saying not enough payloads are present. If I had strict Java null annotation checking on in my analyzer and I only use the type-safe client calls, and my analyzer expects this parameter to be non-null, it would be surprising/bad if we just made it null. I believe adding a parameter is a backwards incompatible operation and is why we encourage using objects where fields can be added instead.~\n\n~@Quinn-With-Two-Ns may need to double-check my assertions here.~\n\nEDIT: Ignore this, this issue is about Java's inconsistency with itself on extra parameters (generic vs non), not new functionality.","createdAt":"2025-02-11T16:12:31Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2413#issuecomment-2651293690","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6eDVV1","author":{"login":"antmendoza"},"authorAssociation":"MEMBER","body":"> I believe adding a parameter is a backwards incompatible operation and is why we encourage using objects where fields can be added instead.\n\nAgreed Chad. \nI can update the request to have the data converter behaving consistently, regardless of the parameter type (meaning it should either always fail or never fail).","createdAt":"2025-02-11T18:32:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2413#issuecomment-2651673973","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6eED-U","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Oh, I see now, we do allow extra non-generic parameters, we just don't allow generic parameters due to a bug. Disregard my comments, we should fix it to be consistent I agree.","createdAt":"2025-02-11T19:27:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/2413#issuecomment-2651864980","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6eHjVg","author":{"login":"antmendoza"},"authorAssociation":"MEMBER","body":"thanks @cretz ","createdAt":"2025-02-12T06:28:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2413#issuecomment-2652779872","viewerDidAuthor":false}],"createdAt":"2025-02-11T14:32:23Z","labels":[],"milestone":null,"number":2413,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Adding a new parameter type List to a workflow input causes the data converter to fail","updatedAt":"2025-08-12T16:21:35Z","url":"https://github.com/temporalio/sdk-java/issues/2413"}
