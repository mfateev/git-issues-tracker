{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjUzMjEwOA==","is_bot":false,"login":"Spikhalskiy","name":"Dmitry Spikhalsky"},"body":"When JavaSDK detects a potential deadlock, it creates a stack trace for the suspect thread in one place and creates the dump of other workflow threads in another place. Even more, it calls for stacktraces of each individual thread separately.\r\n\r\nThis leads to the situation that each stacktrace may be collected at a different safepoint and they may be inconsistent.\r\n\r\nThe relevant pieces of code:\r\n\r\n```\r\nthrow new PotentialDeadlockException(currentThread.getName(), currentThread.getStackTrace(), this);\r\n```\r\n```\r\nStringBuilder dump = new StringBuilder();\r\nfor (WorkflowThread t : threads) {\r\n  if (t.getWorkflowThreadContext() != e.getWorkflowThreadContext()) {\r\n    if (dump.length() > 0) {\r\n      dump.append(\"\\n\");\r\n    }\r\n    dump.append(t.getStackTrace());\r\n  }\r\n}\r\ne.setStackDump(dump.toString());\r\n```","closedAt":"2022-04-19T15:55:39Z","comments":[{"id":"IC_kwDODN12PM5Bu7UV","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Closed by #1152","createdAt":"2022-04-19T15:55:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1125#issuecomment-1102820629","viewerDidAuthor":false}],"createdAt":"2022-04-10T17:16:42Z","labels":[],"milestone":{"number":11,"title":"1.10.0","description":"","dueOn":"2022-05-03T00:00:00Z"},"number":1125,"reactionGroups":[],"state":"CLOSED","title":"PotentialDeadlockException may collect inconsistent stacktraces ","updatedAt":"2022-04-19T15:55:39Z","url":"https://github.com/temporalio/sdk-java/issues/1125"}
