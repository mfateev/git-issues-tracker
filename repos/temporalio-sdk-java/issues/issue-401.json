{"assignees":[],"author":{"id":"MDQ6VXNlcjIzMDA4NjU5","is_bot":false,"login":"arjunacharya10","name":"Arjun Acharya"},"body":"A Cron workflow which is triggered once every 30 days, if an activity throws error twice before returning the expected value. If we forward the testEnv to 90 days, then:\r\n\r\n## Expected Behavior\r\nThe activity is called 3(number of times workflow is triggered in 90 days) * 3(number of times activity is called per workflow trigger) times = 9 times\r\n\r\n## Actual Behavior\r\nThe activity is called 3 times, i.e not retried\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. In a test case, Start a workflow as a cron job, which runs once every 30 days\r\n  2. Use a mock activity to throw IllegalStateException twice before returning the expected value\r\n  3. Assert how many times the activity was called\r\n\r\n## Specifications\r\n\r\n  - Version: temporal-sdk:1.0.6, temporal-testing:1.0.6, temporal-testing-junit4:1.0.6\r\n  - Platform:\r\n","closedAt":"2021-05-26T00:18:42Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgxMTY0NjU5NQ==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"Hey Arjun, thanks for reporting this issue, I'm not sure if I understand your issue correctly, but I've tried to reproduce it, slightly modifying CronSample (see [here](https://github.com/vitarb/samples-java/commit/387d87f1817a6866e28554fb91939a0f6b699dad)) to throw exception 2 times in the activity before succeeding.\r\nAs expected I've seen 3 attempts for each workflow run:\r\n```\r\nStarted workflow_id: \"HelloCron\"\r\nrun_id: \"b378177e-cfa4-49d2-b975-b8367b8a68af\"\r\n\r\n21:58:00.441 [Activity Executor taskQueue=\"HelloCron\", namespace=\"default\": 1] WARN  i.t.i.sync.POJOActivityTaskHandler - Activity failure. ActivityId=cddb2eb7-c7b6-39b5-96d6-ab1edf74bb26, activityType=Greet, attempt=1\r\njava.lang.IllegalStateException: Failing activity for HelloCron because execution attempt was 1\r\n\tat io.temporal.samples.hello.HelloCron$GreetingActivitiesImpl.greet(HelloCron.java:83)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler$POJOActivityInboundCallsInterceptor.execute(POJOActivityTaskHandler.java:293)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler$POJOActivityImplementation.execute(POJOActivityTaskHandler.java:252)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler.handle(POJOActivityTaskHandler.java:211)\r\n\tat io.temporal.internal.worker.ActivityWorker$TaskHandlerImpl.handle(ActivityWorker.java:192)\r\n\tat io.temporal.internal.worker.ActivityWorker$TaskHandlerImpl.handle(ActivityWorker.java:154)\r\n\tat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:73)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n21:58:01.458 [Activity Executor taskQueue=\"HelloCron\", namespace=\"default\": 2] WARN  i.t.i.sync.POJOActivityTaskHandler - Activity failure. ActivityId=cddb2eb7-c7b6-39b5-96d6-ab1edf74bb26, activityType=Greet, attempt=2\r\njava.lang.IllegalStateException: Failing activity for HelloCron because execution attempt was 2\r\n\tat io.temporal.samples.hello.HelloCron$GreetingActivitiesImpl.greet(HelloCron.java:83)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler$POJOActivityInboundCallsInterceptor.execute(POJOActivityTaskHandler.java:293)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler$POJOActivityImplementation.execute(POJOActivityTaskHandler.java:252)\r\n\tat io.temporal.internal.sync.POJOActivityTaskHandler.handle(POJOActivityTaskHandler.java:211)\r\n\tat io.temporal.internal.worker.ActivityWorker$TaskHandlerImpl.handle(ActivityWorker.java:192)\r\n\tat io.temporal.internal.worker.ActivityWorker$TaskHandlerImpl.handle(ActivityWorker.java:154)\r\n\tat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:73)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nFrom HelloCron: Hello World!\r\n```\r\n\r\nIt would help if you could provide a minimal sample that reproduces the issue you are talking about or a unit test.","createdAt":"2021-04-01T05:20:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/401#issuecomment-811646595","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg0ODM2NTU2Nw==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"Resolving as there was no response.","createdAt":"2021-05-26T00:18:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/401#issuecomment-848365567","viewerDidAuthor":false}],"createdAt":"2021-03-25T06:01:09Z","labels":[],"milestone":null,"number":401,"reactionGroups":[],"state":"CLOSED","title":"Activity retry not happening in cron workflow","updatedAt":"2021-05-26T00:18:42Z","url":"https://github.com/temporalio/sdk-java/issues/401"}
