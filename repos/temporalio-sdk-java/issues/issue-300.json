{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjYxNTY4","is_bot":false,"login":"GreyTeardrop","name":"Mykola Rybak"},"body":"## Overview & Expected Behavior\r\n\r\nThis issue was discovered when I tried to re-create the workflow replay test from the [samples-go](https://github.com/temporalio/samples-go/blob/29f9a20ae56155fe1f273c29a0488c5be1c898b1/helloworld/replay_test.go) project with Java SDK via `WorkflowReplayer`. Here's the test code:\r\n\r\n```java\r\nimport io.temporal.testing.WorkflowReplayer;\r\nimport org.junit.jupiter.api.Test;\r\n\r\npublic class SubmissionWorkflowReplayTest {\r\n\r\n    @Test\r\n    public void replayTest() throws Exception {\r\n        WorkflowReplayer.replayWorkflowExecutionFromResource(\r\n            \"submission_workflow.json\",\r\n            SubmissionWorkflowImpl.class\r\n        );\r\n    }\r\n}\r\n```\r\n\r\nAs there doesn't seem to be a documented way to get JSON workflow history for replay tests (or I've missed it), I tried 2 approaches\r\n\r\n1. Via the web console's \"export JSON history\".\r\n2. Via CLI with `tctl workflow show -w <workflow-id> -r <rid> --of <file> `.\r\n\r\nI would have expected both options to provide the same JSON model that could later be used to replay workflow via `WorkflowReplayer`.\r\n\r\n**Update**: I've found that [WorkflowTest](https://github.com/temporalio/sdk-java/blob/24a55be08d8cfaf0b8bb2bb49aab38e8344ce08c/temporal-sdk/src/test/java/io/temporal/workflow/WorkflowTest.java#L1041-L1063) has the code to fetch workflow history in the exact format the SDK expects. Nevertheless, it would have been great, if Java and Go SDKs supported the same JSON history formats - that might become useful if workflow logic is to be migrated from Go to Java or vice versa.\r\n\r\n## Actual Behavior\r\n\r\nBoth web console history export and CLI history export provide JSONs of different schemes, although the contents seem to be mostly the same. Tctl JSON format seems to match the one used on [go samples](https://github.com/temporalio/samples-go/blob/29f9a20ae56155fe1f273c29a0488c5be1c898b1/helloworld/helloworld.json) and is readable by Go SDK.\r\n\r\nBoth formats do not work with Java SDK's `WorkflowReplayer` and fail when it tries to run `WorkflowExecutionHistory.fromJson()` due to various JSON deserialization issues. \r\n\r\nSeems like `WorkflowExecutionHistory.fromJson()` is unable to read date/time fields from the \"web console JSON\" and enums from the \"tctl JSON\".\r\n\r\nI was able to make `WorkflowExecutionHistory.fromJson()` work and to proceed further with the `WorkflowReplayer` test by taking \"tctl JSON\" and manually replacing all enum values in it with matching enum values from the \"web console JSON\".\r\n\r\nTo illustrate the difference here's the diff of 2 JSON representations of the `WorkflowExecutionStarted` event\r\n```diff\r\n--- submission_workflow_console__started.json\t2021-01-11 16:21:06.000000000 +0200\r\n+++ submission_workflow_tctl__started.json\t2021-01-11 16:15:32.000000000 +0200\r\n@@ -1,22 +1,15 @@\r\n {\r\n   \"eventId\": \"1\",\r\n-  \"eventTime\": {\r\n-    \"seconds\": \"1610308631\",\r\n-    \"nanos\": 207997800\r\n-  },\r\n-  \"eventType\": \"EVENT_TYPE_WORKFLOW_EXECUTION_STARTED\",\r\n-  \"version\": \"0\",\r\n+  \"eventTime\": \"2021-01-10T19:57:11.207997800Z\",\r\n+  \"eventType\": \"WorkflowExecutionStarted\",\r\n   \"taskId\": \"2097152\",\r\n-  \"attributes\": \"workflowExecutionStartedEventAttributes\",\r\n   \"workflowExecutionStartedEventAttributes\": {\r\n     \"workflowType\": {\r\n       \"name\": \"SubmissionWorkflow\"\r\n     },\r\n-    \"parentWorkflowNamespace\": \"\",\r\n-    \"parentInitiatedEventId\": \"0\",\r\n     \"taskQueue\": {\r\n       \"name\": \"Submission\",\r\n-      \"kind\": \"TASK_QUEUE_KIND_NORMAL\"\r\n+      \"kind\": \"Normal\"\r\n     },\r\n     \"input\": {\r\n       \"payloads\": [\r\n@@ -28,28 +21,13 @@\r\n         }\r\n       ]\r\n     },\r\n-    \"workflowExecutionTimeout\": {\r\n-      \"seconds\": \"0\",\r\n-      \"nanos\": 0\r\n-    },\r\n-    \"workflowRunTimeout\": {\r\n-      \"seconds\": \"0\",\r\n-      \"nanos\": 0\r\n-    },\r\n-    \"workflowTaskTimeout\": {\r\n-      \"seconds\": \"10\",\r\n-      \"nanos\": 0\r\n-    },\r\n-    \"continuedExecutionRunId\": \"\",\r\n-    \"initiator\": \"CONTINUE_AS_NEW_INITIATOR_UNSPECIFIED\",\r\n+    \"workflowExecutionTimeout\": \"0s\",\r\n+    \"workflowRunTimeout\": \"0s\",\r\n+    \"workflowTaskTimeout\": \"10s\",\r\n     \"originalExecutionRunId\": \"3341c57e-42c9-491d-a0b9-843af9887c6c\",\r\n     \"identity\": \"27852@CRD-MBP-0260\",\r\n     \"firstExecutionRunId\": \"3341c57e-42c9-491d-a0b9-843af9887c6c\",\r\n     \"attempt\": 1,\r\n-    \"cronSchedule\": \"\",\r\n-    \"firstWorkflowTaskBackoff\": {\r\n-      \"seconds\": \"0\",\r\n-      \"nanos\": 0\r\n-    }\r\n+    \"firstWorkflowTaskBackoff\": \"0s\"\r\n   }\r\n }\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Export workflow history from the Temporal server.\r\n2. Feed it to Java SDK's `WorkflowReplayer`.\r\n3. See JSON deserialization issues.\r\n\r\n## Specifications\r\n\r\n  - Version: Temporal server 1.5.1, Temporal Java SDK 1.0.4\r\n  - Platform: macOS\r\n","closedAt":"2021-09-16T18:00:01Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc4MDAzODY5NQ==","author":{"login":"GreyTeardrop"},"authorAssociation":"CONTRIBUTOR","body":"Related issue: https://github.com/temporalio/web/issues/268","createdAt":"2021-02-16T18:39:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/300#issuecomment-780038695","viewerDidAuthor":false}],"createdAt":"2021-01-11T14:30:43Z","labels":[],"milestone":{"number":4,"title":"1.4.0","description":"","dueOn":"2021-10-06T00:00:00Z"},"number":300,"reactionGroups":[],"state":"CLOSED","title":"WorkflowExecutionHistory.fromJson does not support JSONs exported via Web console or CLI ","updatedAt":"2021-09-16T20:47:32Z","url":"https://github.com/temporalio/sdk-java/issues/300"}
