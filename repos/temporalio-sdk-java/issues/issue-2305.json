{"assignees":[],"author":{"id":"MDQ6VXNlcjUzMDQ5","is_bot":false,"login":"rocketraman","name":"Raman Gupta"},"body":"**Is your feature request related to a problem? Please describe.**\r\nWhen using the Temporal test environment, if an activity is run which is not registered, the test hangs, and apparently forever. I've set the `scheduleToStartTimeout` to a few seconds but apparently the test Temporal server ignores it.\r\n\r\n**Describe the solution you'd like**\r\nTests should fail immediately when an activity is called that is not registered. Alternatively, or in addition, the `scheduleToStartTimeout` should be respected.\r\n\r\n**Describe alternatives you've considered**\r\nNone\r\n\r\n**Additional context**\r\nTemporal SDK 1.26.1\r\n","closedAt":"2024-10-31T17:11:33Z","comments":[{"id":"IC_kwDODN12PM6SDKA7","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Can confirm Test server does support `scheduleToStartTimeout ` timeout \r\n\r\nhttps://github.com/temporalio/sdk-java/blob/b45e40d4056d4efc522a1e47ad83b1d0a434ecfa/temporal-sdk/src/test/java/io/temporal/workflow/activityTests/ActivityTimeoutTest.java#L282\r\n\r\n`scheduleToStartTimeout` is not the right timeout to set if you want the activity to fail in this scenario since even if an activity is not registered on the worker, the server can still attempt to start it as long as a worker is listening on the underlying task queue. You want to set a `*ToCloseTimeout`. The behaviour you are describing is the same behaviour as the real Temporal Server. We do have another feature request for using a different retry policies when under test https://github.com/temporalio/sdk-java/issues/626.","createdAt":"2024-10-31T16:24:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450300987","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6SDN77","author":{"login":"rocketraman"},"authorAssociation":"NONE","body":"> scheduleToStartTimeout is not the right timeout to set if you want the activity to fail in this scenario since even if an activity is not registered on the worker, the server can still attempt to start it as long as a worker is listening on the underlying task queue.\r\n\r\nAh, really? Looking at [this blog post](https://temporal.io/blog/activity-timeouts), `ScheduleToStart` should be a smaller timeout than any of the `ToClose` timeouts.\r\n\r\n[The documentation](https://www.javadoc.io/doc/io.temporal/temporal-sdk/latest/io/temporal/activity/ActivityOptions.Builder.html#setScheduleToStartTimeout(java.time.Duration)) says this:\r\n\r\n> Time that the Activity Task can stay in the Task Queue before it is picked up by a Worker.\r\n\r\nSo if the activity task remains in the task queue (despite workers listening), why wouldn't the `ScheduleToStart` timeout apply?\r\n\r\nIf what you are saying is true, how would I configure the case in which my workflow can take hours or days of real time (and in my test environment I would use time skipping), but if its not started very quickly I want to bail out?\r\n","createdAt":"2024-10-31T16:32:02Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450317051","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6SDPLc","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":">how would I configure the case in which my workflow can take hours or days of real time, but if its not started very quickly I want to bail out?\r\n\r\nYou would use `ScheduleToStart `, but as I said an activity type not being registered does NOT cause any issue scheduling an activity, it only causes an issue when executing the activity. ","createdAt":"2024-10-31T16:34:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450322140","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6SDXcY","author":{"login":"rocketraman"},"authorAssociation":"NONE","body":"> > how would I configure the case in which my workflow can take hours or days of real time, but if its not started very quickly I want to bail out?\r\n> \r\n> You would use `ScheduleToStart `, but as I said an activity type not being registered does NOT cause any issue scheduling an activity, it only causes an issue when executing the activity.\r\n\r\nOk. Isn't that weird and confusing? If an activity type is not registered and therefore an activity is scheduled, but not started, why would `ScheduleToStart` which subsumes both endpoints of this time, not apply? Is there a tracking issue or something I can follow for a timeout that covers the case of an activity not being started because no activity is registered?","createdAt":"2024-10-31T16:49:07Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450355992","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6SDjEb","author":{"login":"rocketraman"},"authorAssociation":"NONE","body":"Closing this because the behavior is working as designed (though the design seems questionable). I've opened [this community form post](https://community.temporal.io/t/understanding-schedule-to-start-timeout/14937) to explore this topic.","createdAt":"2024-10-31T17:11:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450403611","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6SDj04","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"I think there is a misunderstanding here, to be clear, If an activity type is not registered, but was scheduled **it will still be started** if any worker is listenting on the task queue.\r\n\r\nThis is how the protocol between the Temporal worker and server works and is important to safely roll out new Workflow/Activity types. Workers poll for work by task queue , not by activity type, if a worker is listening on a task queue it can get any tasks assigned to that task queue. Once a worker picks up a task the server considers that task as started. If the worker does not know how to handle that activity type then the worker will fail that activity attempt, but from the servers perspective the task was started. This behaviour is important when rolling out new types of activities/workflows that old workers may not understand ","createdAt":"2024-10-31T17:13:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450406712","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6SD3U0","author":{"login":"rocketraman"},"authorAssociation":"NONE","body":"Thank you for the explanation about what \"started\" actually means. I think it would be helpful if the docs included this information because this technical definition of \"started\" would not match most people's mental model of an activity being \"started\".","createdAt":"2024-10-31T17:53:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2305#issuecomment-2450486580","viewerDidAuthor":false}],"createdAt":"2024-10-31T15:58:13Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ0","name":"enhancement","description":"User experience","color":"a2eeef"}],"milestone":null,"number":2305,"reactionGroups":[],"state":"CLOSED","title":"Test environment hangs if activity is not defined, and `scheduleToStartTimeout` is ignored","updatedAt":"2024-10-31T17:53:25Z","url":"https://github.com/temporalio/sdk-java/issues/2305"}
