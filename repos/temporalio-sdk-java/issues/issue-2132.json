{"assignees":[],"author":{"id":"MDQ6VXNlcjM0MTgzODcw","is_bot":false,"login":"fextr","name":""},"body":"## Expected Behavior\r\n\r\nWhen I [setRpcTimeout](https://github.com/temporalio/sdk-java/blob/abd9f2d1371a0355c01e85bc03763c79b1846ace/temporal-serviceclient/src/main/java/io/temporal/serviceclient/ServiceStubsOptions.java#L774) in WorkflowServiceStubsOptions it overrides the deadline in [getServerCapabilitiesWithRetryOrThrow](https://github.com/temporalio/sdk-java/blob/abd9f2d1371a0355c01e85bc03763c79b1846ace/temporal-serviceclient/src/main/java/io/temporal/serviceclient/SystemInfoInterceptor.java#L95)\r\n\r\n## Actual Behavior\r\n\r\nI'm enforced to use deprecated [setHealthCheckAttemptTimeout](https://github.com/temporalio/sdk-java/blob/abd9f2d1371a0355c01e85bc03763c79b1846ace/temporal-serviceclient/src/main/java/io/temporal/serviceclient/ServiceStubsOptions.java#L696) because it is still used in the [ChannelManager](https://github.com/temporalio/sdk-java/blob/master/temporal-serviceclient/src/main/java/io/temporal/serviceclient/ChannelManager.java#L327)\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Set `rpcTimeout` in `WorkflowServiceStubsOptions`.\r\n2. Observe that it does not override the deadline in `getServerCapabilitiesWithRetryOrThrow`\r\n3. Note the usage of the deprecated `healthCheckAttemptTimeout` in `ChannelManager`.\r\n\r\n## Specifications\r\n\r\n  - Version: Java SDK 1.24.0\r\n","closedAt":"2024-09-25T20:59:57Z","comments":[{"id":"IC_kwDODN12PM6DSxUh","author":{"login":"fextr"},"authorAssociation":"NONE","body":"If that is acceptable, I want to contribute to the project and fix this issue.","createdAt":"2024-07-02T10:57:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2132#issuecomment-2202735905","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6DVPX5","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":" `getServerCapabilities` is intentionally overriding the rpc timeout. If you need to configure a different deadline on  `getServerCapabilities` it would need to be a separate option.","createdAt":"2024-07-02T14:33:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2132#issuecomment-2203383289","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6DdDnO","author":{"login":"fextr"},"authorAssociation":"NONE","body":"> `getServerCapabilities` is intentionally overriding the rpc timeout. If you need to configure a different deadline on `getServerCapabilities` it would need to be a separate option.\r\n\r\nHey @Quinn-With-Two-Ns \r\n\r\nIs your suggestion to introduce a new option, such as `serverCapabilitiesTimeout`, in the `ServiceStubsOptions` correct?","createdAt":"2024-07-03T08:39:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2132#issuecomment-2205432270","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6Dji7Y","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Yes, it should be called `getSystemInfoTimeout` though `serverCapabilities` is just an internal name to the Java SDK.","createdAt":"2024-07-03T20:02:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2132#issuecomment-2207133400","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6DjjRw","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Why do you need to configure the deadline on `getSystemInfo`?","createdAt":"2024-07-03T20:03:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2132#issuecomment-2207134832","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6DnZjC","author":{"login":"fextr"},"authorAssociation":"NONE","body":"> Why do you need to configure the deadline on `getSystemInfo`?\r\n\r\nWe have encountered a problem connecting to Temporal after upgrading Java SDK from version 1.23.2 to 1.24.0. When we increased the timeout problem was solved. Stack trace:\r\n\r\n``` java\r\n| 2024-07-01 04:59:31.284 | at io.temporal.internal.retryer.GrpcRetryer.retryWithResult(GrpcRetryer.java:60) |\r\n| 2024-07-01 04:59:31.280 | at io.temporal.api.workflowservice.v1.WorkflowServiceGrpc$WorkflowServiceBlockingStub.getSystemInfo(WorkflowServiceGrpc.java:4645) |\r\n| 2024-07-01 04:59:31.280 | at io.temporal.serviceclient.SystemInfoInterceptor.getServerCapabilitiesOrThrow(SystemInfoInterceptor.java:132) |\r\n| 2024-07-01 04:59:31.280 | at io.temporal.serviceclient.SystemInfoInterceptor.lambda$getServerCapabilitiesWithRetryOrThrow$0(SystemInfoInterceptor.java:118) |\r\n| 2024-07-01 04:59:31.280 | at io.temporal.internal.retryer.GrpcSyncRetryer.retry(GrpcSyncRetryer.java:69) |\r\n| 2024-07-01 04:59:31.279 | io.grpc.StatusRuntimeException: DEADLINE_EXCEEDED: deadline exceeded after 0.398648053s. Name resolution delay 2.493018773 seconds. [closed=[], open=[[buffered_nanos=695520709, remote_addr=namespace-dev.etmgc.tmprl.cloud/18.157.55.99:7233]]] |\r\n| 2024-07-01 04:59:31.279 | at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268) |\r\n| 2024-07-01 04:59:31.279 | at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249) |\r\n| 2024-07-01 04:59:31.279 | at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:167) |\r\n| 2024-07-01 04:59:24.584 | 04:59:24.584 [:] [main] INFO  i.t.s.WorkflowServiceStubsImpl - Created WorkflowServiceStubs for channel: ManagedChannelOrphanWrapper{delegate=ManagedChannelImpl{logId=1, target=namespace-dev.etmgc.tmprl.cloud:7233}} |\r\n```\r\n\r\nPS: Actual namespace name is different\r\n","createdAt":"2024-07-04T05:25:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2132#issuecomment-2208143554","viewerDidAuthor":false}],"createdAt":"2024-07-02T10:56:34Z","labels":[],"milestone":null,"number":2132,"reactionGroups":[],"state":"CLOSED","title":"Add option to configure the deadline of `ChannelManager#getServerCapabilities`","updatedAt":"2024-09-25T20:59:57Z","url":"https://github.com/temporalio/sdk-java/issues/2132"}
