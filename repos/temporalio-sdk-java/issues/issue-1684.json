{"assignees":[],"author":{"id":"MDQ6VXNlcjUyNDgz","is_bot":false,"login":"tylercunnion","name":"Tyler Cunnion"},"body":"## Expected Behavior\r\nCreating a subscope using code such as:\r\n```java\r\nScope taggedScope = Workflow.getMetricsScope().tagged(\r\n    Map.of(\"tag\", \"value\")\r\n);\r\n```\r\nproduces a new instance of ReplayAwareScope including the tag. Since this is an instance of `Scope` and thus `AutoCloseable`, the IDE is going to suggest it be wrapped in a `try-by-resources` (or at least raise some kind of warning that the object should be closed). \r\n\r\nMy **expected behavior** is that invoking `close()` on this object should only close this object itself, ie the subscope would no longer be available for use. \r\n\r\n## Actual Behavior\r\n\r\nClosing the subscope invokes the `close()` method of `ReplayAwareScope`, which in turn closes its contained instance of `Scope`; the effect is that the metrics scope for the _entire worker_ is silently closed, and no more metrics will be reported.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a subscope using `.tagged()` or `.subscope()`. \r\n  1. Call the `close()` method, either explicitly or implicitly using `try-with-resources`. \r\n\r\n## Specifications\r\n\r\n  - Version: 1.18.2\r\n  - Platform: linux\r\n","closedAt":"2023-03-03T00:08:09Z","comments":[{"id":"IC_kwDODN12PM5WlzDx","author":{"login":"tylercunnion"},"authorAssociation":"CONTRIBUTOR","body":"This may just need to be a documentation enhancement honestly, but it's bitten me twice now (after I completely forgot about the problem between the first and second) so I figured it was worth raising.","createdAt":"2023-03-03T00:04:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1684#issuecomment-1452749041","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Wlz0q","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Scope abstraction, contracts and implementation is not Temporal Java SDK abstraction, it’s uber-tally, our transitive dependency. \r\nIf and when we create our own Scope abstraction, it will be one of the things that we will do differently.\r\nSo, while I agree with you on your points in terms of user friendliness, we don’t control tally’s abstractions, we use them.","createdAt":"2023-03-03T00:08:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1684#issuecomment-1452752170","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5Wl16T","author":{"login":"tylercunnion"},"authorAssociation":"CONTRIBUTOR","body":"Got it - I was thinking the issue was specifically ReplayAwareScope closing its inner Scope but I see that tally's subscopes close their reporter as well so it's really moot. Thanks for the quick response!","createdAt":"2023-03-03T00:21:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1684#issuecomment-1452760723","viewerDidAuthor":false}],"createdAt":"2023-03-03T00:02:13Z","labels":[{"id":"LA_kwDODN12PM7NRayD","name":"wontfix","description":"This will not be worked on","color":"BFD4F2"}],"milestone":null,"number":1684,"reactionGroups":[],"state":"CLOSED","title":"Closing metric subscopes surprisingly closes the parent scope as well","updatedAt":"2023-03-03T00:21:49Z","url":"https://github.com/temporalio/sdk-java/issues/1684"}
