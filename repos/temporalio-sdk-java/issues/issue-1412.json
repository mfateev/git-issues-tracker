{"assignees":[{"id":"MDQ6VXNlcjUzMjEwOA==","login":"Spikhalskiy","name":"Dmitry Spikhalsky","databaseId":0}],"author":{"id":"MDQ6VXNlcjg3NzIxNjE=","is_bot":false,"login":"pratyoosh","name":"prat"},"body":"## Expected Behavior\r\nCreate TestEnvironmentOptions with you MeterRegistry \r\n```\r\nTestEnvironmentOptions testEnvironmentOptions = TestEnvironmentOptions.newBuilder().setWorkflowServiceStubsOptions(\r\n                        WorkflowServiceStubsOptions.newBuilder()\r\n                                .setMetricsScope(new RootScopeBuilder()\r\n                                        .reporter(new MicrometerClientStatsReporter(meterRegistry))\r\n                                        .reportEvery(com.uber.m3.util.Duration.ofSeconds(10)))\r\n                                .build()\r\n                )...\r\n```\r\n                \r\nCreate TestEnvironment for your tests using `TestWorkflowEnvironment.newInstance(testEnvironmentOptions);`\r\nExecute your tests, check metrics for Worker & Client were reported to your MeterRegistry.\r\n## Actual Behavior\r\nWorker & Client are not reported to your MeterRegistry, unless MeterRegistry is registered using \r\n```\r\ntestEnvironmentOptions = TestEnvironmentOptions.newBuilder()\r\n                .setMetricsScope(new RootScopeBuilder()\r\n                        .reporter(new MicrometerClientStatsReporter(temporalConfig.getTelemetryConfig().getMeterRegistry()))\r\n                        .reportEvery(com.uber.m3.util.Duration.ofSeconds(10)))\r\n\r\n```\r\nThis is different that documented behavior where Metrics scope must be supplied via WorkflowServiceOptions\r\n\r\n## Specifications\r\n\r\n  - Version: SDK 1.14\r\n  - Platform: Mac OS 12.5/ Open JDK 11 \r\n","closedAt":"2022-11-18T14:47:07Z","comments":[],"createdAt":"2022-09-09T22:33:49Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":20,"title":"1.18.0","description":"","dueOn":"2022-11-29T00:00:00Z"},"number":1412,"reactionGroups":[],"state":"CLOSED","title":"Setting MetricsScope on TestEnvironmentOptions is confusing ","updatedAt":"2022-11-18T14:47:07Z","url":"https://github.com/temporalio/sdk-java/issues/1412"}
