{"assignees":[{"id":"MDQ6VXNlcjIwNTI3OTk5","login":"vkoby","name":"Vera","databaseId":0}],"author":{"id":"MDQ6VXNlcjk0OTQwOA==","is_bot":false,"login":"srekapalli","name":"Sairam Rekapalli"},"body":"## Expected Behavior\r\n\r\nAfter adding conditional logic based on the version , workflow replay should be able to process event history .\r\n\r\n```\r\n// Before\r\nlocalActivityStub.process()\r\n\r\n// After\r\nint version = Workflow.getVersion(\"noLocalActivity\", Workflow.DEFAULT_VERSION, 1)\r\nif (version == Workflow.DEFAULT_VERSION) {\r\n    // call Local activity\r\n   localActivityStub.process()\r\n} else {\r\n    // directly set properties on the workflow result\r\n}\r\n```\r\n\r\n## Actual Behavior\r\n\r\nReceiving an error \r\n\r\n```\r\nCaused by: java.lang.IllegalStateException: Unexpected local activity id: 7f5f265e-9487-3fa6-8bf1-37d3d70222ea\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleLocalActivityMarker(WorkflowStateMachines.java:369)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleCommandEvent(WorkflowStateMachines.java:231)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleEventImpl(WorkflowStateMachines.java:199)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleEvent(WorkflowStateMachines.java:178)\r\n```\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: 1.0.7 ( Java SDK)\r\n  - Platform:\r\n","closedAt":"2021-07-09T18:15:36Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgzNzk5MzY5Ng==","author":{"login":"vitarb"},"authorAssociation":"CONTRIBUTOR","body":"Thanks for reporting an issue, we are going to investigate it soon.","createdAt":"2021-05-11T07:34:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/482#issuecomment-837993696","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg2MjYwODg0Ng==","author":{"login":"vkoby"},"authorAssociation":"CONTRIBUTOR","body":"@srekapalli, I attempted to reproduce this scenario but everything seems to behave correctly for me. Could you please look at the draft PR above and let me know if this test accurately describes your case?","createdAt":"2021-06-16T18:22:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/482#issuecomment-862608846","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3NzM2OTk4NA==","author":{"login":"vkoby"},"authorAssociation":"CONTRIBUTOR","body":"Going to close, but please feel free to reopen with a reproduction.","createdAt":"2021-07-09T18:15:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/482#issuecomment-877369984","viewerDidAuthor":false}],"createdAt":"2021-05-11T01:06:49Z","labels":[],"milestone":null,"number":482,"reactionGroups":[],"state":"CLOSED","title":"Unable to replay a workflow after adding workflow versioning","updatedAt":"2021-07-09T18:15:36Z","url":"https://github.com/temporalio/sdk-java/issues/482"}
