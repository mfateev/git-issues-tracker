{"assignees":[],"author":{"id":"MDQ6VXNlcjI3OTY2MDcw","is_bot":false,"login":"Duzhinsky","name":"Dmitrii Duzhinskii"},"body":"## Expected Behavior\r\n\r\nWhen `java.util.Duration` is `null` in an options class like `SchedulePolicy` it is treated as an unset value in a protobuf message _in some cases_\r\n\r\n## Actual Behavior\r\n\r\n`null` values are sent as zero duration. There was a TODO in the appropriate method about refactoring this behaviour, but was removed in #1950\r\n\r\nhttps://github.com/temporalio/sdk-java/blob/ec18bc86d52f23add2dc97682d94c629e6282bf1/temporal-sdk/src/main/java/io/temporal/internal/common/ProtobufTimeUtils.java#L43-L48\r\n\r\n## A problem \r\n\r\nI'm creating schedules using the following code:\r\n```java\r\n...\r\nvar policy = SchedulePolicy.newBuilder()\r\n                .setOverlap(ScheduleOverlapPolicy.SCHEDULE_OVERLAP_POLICY_BUFFER_ONE)\r\n                .build();\r\nvar schedule Schedule.newBuilder()\r\n                .setAction(actionStartWorkflow)\r\n                .setSpec(spec)\r\n                .setPolicy(policy)\r\n                .build();\r\n```\r\nWhich causes sending `0` in the `catchupWindow` property of `SchedulePolicy`. Hence, server side treats it as `0` and uses `MinCatchupWindow` (=10 sec) instead of expected `DefaultCatchupWindow` (=1yr)\r\n\r\nhttps://github.com/temporalio/temporal/blob/aca0d911a908b2584f4cffcc73425c5119dbe722/service/worker/scheduler/workflow.go#L750-L759\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a schedule using the code above\r\n  2. Check its catchupWindow\r\n\r\n\r\n","closedAt":"2024-05-21T14:35:31Z","comments":[{"id":"IC_kwDODN12PM5-J8O7","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Most of time the Temporal server treats zero and unset durations the same, unfortunately it seems like schedules makes a distinction. Probably need to add conversion functions for that preserve null for time conversion.","createdAt":"2024-05-17T02:51:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2065#issuecomment-2116535227","viewerDidAuthor":false}],"createdAt":"2024-05-16T19:44:46Z","labels":[],"milestone":null,"number":2065,"reactionGroups":[],"state":"CLOSED","title":"It's impossible to send unset duration","updatedAt":"2024-05-21T14:35:31Z","url":"https://github.com/temporalio/sdk-java/issues/2065"}
