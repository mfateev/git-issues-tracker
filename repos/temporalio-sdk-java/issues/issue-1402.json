{"assignees":[],"author":{"id":"U_kgDOBaJ48w","is_bot":false,"login":"ddavidyuk","name":""},"body":"**Is your feature request related to a problem? Please describe.**\r\nThere are multiple microservices, each one using a different encoding scheme for outgoing Temporal payloads, e.g.:\r\nMicroservice A: binary/gzip\r\nMicroservice B: binary/encrypt\r\n\r\nEach microservice hosts its own activities and workflows that invoke each other.\r\n\r\n**Describe the solution you'd like**\r\nWe should be able to configure Java SDK on Microservice A to encode payloads using binary/gzip but decode the incoming payloads using either binary/gzip or binary/encrypt. Same for Microservice B (but use binary/encrypt for encoding).\r\n\r\nHere are some code examples:\r\n```java\r\npublic interface PayloadEncoder {\r\n    ByteString getEncoding();\r\n\r\n    Payload encode(Payload payload) throws DataConverterException;\r\n}\r\n\r\npublic interface PayloadDecoder {\r\n    ByteString getEncoding();\r\n\r\n    Payload decode(Payload payload) throws DataConverterException;\r\n\r\n    default boolean willDecode(Payload payload) {\r\n        ByteString encoding = payload.getMetadataOrDefault(EncodingKeys.METADATA_ENCODING_KEY, null);\r\n        return getEncoding().equals(encoding);\r\n    }\r\n}\r\n\r\npublic class PayloadCodecs {\r\n    final List<PayloadEncoder> encoders;\r\n    final List<PayloadDecoder> decoders;\r\n\r\n    public Payload encode(Payload payload) throws DataConverterException {\r\n        Payload result = payload;\r\n        for (PayloadEncoder encoder : encoders) {\r\n            result = encoder.encode(result);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public Payload decode(Payload payload) throws DataConverterException {\r\n        return decoders.stream().filter(decoder -> decoder.willDecode(payload))\r\n                .findFirst()\r\n                .map(decoder -> decode(decoder.decode(payload))) // !!! recursive call\r\n                .orElse(payload);\r\n    }\r\n}\r\n\r\n```\r\nThis can also be integrated into a Spring Boot module like this:\r\n```java\r\n@Bean\r\n// get all PayloadEncoder/Decoder beans, use all decoder beans for decoding (will be selected based on \r\n// the Payload's encoding header)\r\n// use only select encoder beans for encoding\r\n// example: temporal.payload-encoding=binary/encrypt,binary/gzip - first gzip the payload and then encrypt\r\npublic PayloadCodecs payloadCodecs(List<PayloadDecoder> decoders, \r\nList<PayloadEncoders> encoders, \r\n@Value(\"${temporal.payload-encoding}\") List<String> encodings ) {\r\n       return new PayloadCodecs(selectEncoders(encoders, encodings), decoders);\r\n}\r\n```\r\n\r\n**Describe alternatives you've considered**\r\nUse our own library on top of Temporal Java SDK\r\n\r\n**Additional context**\r\nAdd any other context or screenshots about the feature request here.\r\n","closedAt":"2024-12-23T10:06:55Z","comments":[{"id":"IC_kwDODN12PM6YjKXb","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"We have no plan to make breaking changes to the `PayloadCodec` interface. In general if you want complex conditional logic that can be done in the `PayloadCodec` or a custom `CodecDataConverter`","createdAt":"2024-12-23T10:06:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1402#issuecomment-2559354331","viewerDidAuthor":false}],"createdAt":"2022-08-31T19:30:23Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ0","name":"enhancement","description":"User experience","color":"a2eeef"}],"milestone":null,"number":1402,"reactionGroups":[],"state":"CLOSED","title":"Split PayloadCodec into two Encoder/Decoder interfaces and have a separate config for each","updatedAt":"2024-12-23T10:06:55Z","url":"https://github.com/temporalio/sdk-java/issues/1402"}
