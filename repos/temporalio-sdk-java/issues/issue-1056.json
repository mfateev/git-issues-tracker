{"assignees":[],"author":{"id":"MDQ6VXNlcjMyNjQzMzg=","is_bot":false,"login":"geirhoe","name":""},"body":"When starting a workflow, the worker using temporal-sdk 1.6.0 fails with the following error\r\n\r\n13:34:33.608 [Workflow Executor taskQueue=\"test-queue\", namespace=\"pmdi.o11n.test-namespace\": 4] ERROR i.t.internal.worker.PollerOptions - uncaught exception\r\njava.lang.RuntimeException: Failure processing workflow task. WorkflowId=3dfcaab2-7d2d-4b75-b013-abdea39bdf10, RunId=c5d10d3e-a77a-49dc-ae0d-1e09d25d842f, Attempt=3\r\n\tat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.wrapFailure(WorkflowWorker.java:297)\r\n\tat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.wrapFailure(WorkflowWorker.java:195)\r\n\tat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:79)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: io.temporal.internal.replay.InternalWorkflowTaskException: Failure handling event 6 of type 'EVENT_TYPE_WORKFLOW_TASK_STARTED' during execution. {PreviousStartedEventId=6, workflowTaskStartedEventId=6, Currently Processing StartedEventId=6}\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.createEventProcessingException(WorkflowStateMachines.java:223)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleEventsBatch(WorkflowStateMachines.java:202)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleEvent(WorkflowStateMachines.java:176)\r\n\tat io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTaskImpl(ReplayWorkflowRunTaskHandler.java:176)\r\n\tat io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTask(ReplayWorkflowRunTaskHandler.java:145)\r\n\tat io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTaskWithQuery(ReplayWorkflowTaskHandler.java:122)\r\n\tat io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTask(ReplayWorkflowTaskHandler.java:97)\r\n\tat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:237)\r\n\tat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:195)\r\n\tat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:73)\r\n\t... 3 common frames omitted\r\nCaused by: java.lang.RuntimeException: WorkflowTask: failure executing SCHEDULED->WORKFLOW_TASK_STARTED, transition history is [CREATED->WORKFLOW_TASK_SCHEDULED]\r\n\tat io.temporal.internal.statemachines.StateMachine.executeTransition(StateMachine.java:151)\r\n\tat io.temporal.internal.statemachines.StateMachine.handleHistoryEvent(StateMachine.java:101)\r\n\tat io.temporal.internal.statemachines.EntityStateMachineBase.handleEvent(EntityStateMachineBase.java:67)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleSingleEvent(WorkflowStateMachines.java:236)\r\n\tat io.temporal.internal.statemachines.WorkflowStateMachines.handleEventsBatch(WorkflowStateMachines.java:200)\r\n\t... 11 common frames omitted\r\nCaused by: java.lang.ClassCastException: class sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl cannot be cast to class java.lang.Class (sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl and java.lang.Class are in module java.base of loader 'bootstrap')\r\n\tat io.temporal.common.converter.DataConverter.arrayFromPayloads(DataConverter.java:92)\r\n\tat io.temporal.internal.sync.POJOWorkflowImplementationFactory$POJOWorkflowImplementation.execute(POJOWorkflowImplementationFactory.java:285)\r\n\tat io.temporal.internal.sync.WorkflowExecuteRunnable.run(WorkflowExecuteRunnable.java:72)\r\n\tat io.temporal.internal.sync.SyncWorkflow.lambda$start$0(SyncWorkflow.java:137)\r\n\tat io.temporal.internal.sync.CancellationScopeImpl.run(CancellationScopeImpl.java:101)\r\n\tat io.temporal.internal.sync.WorkflowThreadImpl$RunnableWrapper.run(WorkflowThreadImpl.java:111)\r\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\t... 3 common frames omitted\r\n\r\n\r\nI have created a small sample project that shows the error, please give me an email adress I can send it to","closedAt":"2024-12-23T13:01:09Z","comments":[{"id":"IC_kwDODN12PM4-zSQz","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"@geirhoe feel free to send the reproduction to dmitry@temporal.io","createdAt":"2022-02-27T17:56:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1056#issuecomment-1053631539","viewerDidAuthor":false},{"id":"IC_kwDODN12PM4-1zFq","author":{"login":"geirhoe"},"authorAssociation":"NONE","body":"This is caused by user error.\r\n\r\nThe workflow expects a map, and none is provided by the start workflow command. Using this start command, the worker works without error:\r\n\r\ntctl --namespace pmdi.o11n.test-namespace workflow start --taskqueue test-queue --workflow_type LogVarsWorkflow --input '{\"test\":\"test\"}'\r\n\r\nPerhaps she sdk should report this a an error instead of causing this stack trace ?","createdAt":"2022-02-28T14:05:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/1056#issuecomment-1054290282","viewerDidAuthor":false},{"id":"IC_kwDODN12PM4-62EI","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"I agree that this stacktrace is cryptic and doesn't communicate the underlying reason clearly. I will take a look into improving this.","createdAt":"2022-03-01T16:16:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1056#issuecomment-1055613192","viewerDidAuthor":false},{"id":"IC_kwDODN12PM5vcwIm","author":{"login":"josh-berry"},"authorAssociation":"NONE","body":"Not sure if this is still an issue since this was reported quite some time ago. Sounds like the actual issue here is: when an invalid (non-map-shaped) input is provided to a workflow, the reported stack trace is confusing. Is that a fair summary?\r\n\r\nDo we know if this is still an issue in recent Java SDKs?","createdAt":"2023-12-26T22:49:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1056#issuecomment-1869808166","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6YkXDS","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"The error handling here is very different from when this issue was first open so the underlying user error should be more understandable.","createdAt":"2024-12-23T13:01:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/1056#issuecomment-2559668434","viewerDidAuthor":false}],"createdAt":"2022-02-27T13:36:02Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQx","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1056,"reactionGroups":[],"state":"CLOSED","title":"ParameterizedTypeImpl class cast exception","updatedAt":"2024-12-23T13:01:10Z","url":"https://github.com/temporalio/sdk-java/issues/1056"}
