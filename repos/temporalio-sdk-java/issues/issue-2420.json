{"assignees":[],"author":{"id":"MDQ6VXNlcjE4NzYyNTQ=","is_bot":false,"login":"RomanVlasenko","name":"Roman Vlasenko"},"body":"All classes in the `io.temporal.api` package of `io.temporal:temporal-serviceclient` seem to extend `GeneratedMessageV3`, which is deprecated and removed in protobuf-java 4.x. The Temporal SDK documentation states that it is compatible with protobuf-java 4.x, but in practice, it fails at runtime.\n\n## Expected Behavior\nTemporal Java SDK is compatible with protobuf-java 4.x and higher, or the documentation is updated accordingly.\n\n## Actual Behavior\n```\nio.temporal.payload.codec.PayloadCodecException: java.lang.NoSuchMethodError: 'void io.temporal.api.common.v1.Payload.makeExtensionsImmutable()'\n--\n  | at com.fivetran.temporal.api.CryptoCodec.decodePayload(CryptoCodec.java:113)\n  | at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n  | at java.base/java.util.AbstractList$RandomAccessSpliterator.forEachRemaining(AbstractList.java:720)\n  | at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n  | at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n  | at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n  | at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n  | at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n  | at com.fivetran.temporal.api.CryptoCodec.decode(CryptoCodec.java:76)\n  | at com.fivetran.temporal.api.CryptoCodecSpec.cryptoCodec_shouldEncryptAndDecrypt(CryptoCodecSpec.java:28)\n  | at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  | at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:373)\n  | at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)\n  | at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)\n  | at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)\n  | at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)\n  | Caused by: java.lang.NoSuchMethodError: 'void io.temporal.api.common.v1.Payload.makeExtensionsImmutable()'\n  | at io.temporal.api.common.v1.Payload.<init>(Payload.java:94)\n  | at io.temporal.api.common.v1.Payload.<init>(Payload.java:16)\n  | at io.temporal.api.common.v1.Payload$1.parsePartialFrom(Payload.java:755)\n  | at io.temporal.api.common.v1.Payload$1.parsePartialFrom(Payload.java:749)\n  | at com.google.protobuf.AbstractParser.parsePartialFrom(AbstractParser.java:135)\n  | at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:168)\n  | at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:180)\n  | at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:185)\n  | at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:25)\n  | at io.temporal.api.common.v1.Payload.parseFrom(Payload.java:319)\n  | at com.fivetran.temporal.api.CryptoCodec.decodePayload(CryptoCodec.java:111)\n  | ... 15 more\n```\n\n## Steps to Reproduce the Problem\n\n  1. Configure a project that uses `io.temporal:temporal-serviceclient:1.27.1` and `com.google.protobuf:protobuf-java:4.29.3`\n  1. Call `Payload.parseFrom` on an arbitrary value (e.g. `Payload.parseFrom(\"\".getBytes(StandardCharsets.UTF_8))`)\n  1. As a result, an exception will be thrown: `java.lang.NoSuchMethodError: 'void io.temporal.api.common.v1.Payload.makeExtensionsImmutable()'`\n\n## Specifications\n\n  - Version: 1.27.1\n  - Platform: Ubuntu Linux, MacOS\n","closedAt":"2025-02-19T15:16:44Z","comments":[{"id":"IC_kwDODN12PM6fFQm1","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"The head of master is compatible with protobuf v4, `v1.27.1` is not. The next release `v1.28.0` will be compatible as is our [snapshot release](https://github.com/temporalio/sdk-java?tab=readme-ov-file#snapshot-release)","createdAt":"2025-02-19T15:16:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/2420#issuecomment-2668956085","viewerDidAuthor":false}],"createdAt":"2025-02-19T10:21:26Z","labels":[],"milestone":null,"number":2420,"reactionGroups":[],"state":"CLOSED","title":"`temporal-serviceclient` library is incompatible with `protobuf-java` 4.x","updatedAt":"2025-02-19T15:16:45Z","url":"https://github.com/temporalio/sdk-java/issues/2420"}
