{"assignees":[],"author":{"id":"MDQ6VXNlcjI5NTA2OTAw","is_bot":false,"login":"IgorMaj","name":""},"body":"We're using Temporal and have several workflows. Some of these workflows rely on `Workflow.currentTimeMillis()` to get the current time.  We're having trouble injecting mocked time into it. While Mockito can mock static methods of classes like Workflow or WorkflowInternal, it fails silently because the test environment spawns another thread.  Java ignores mocked classes/methods if they are called from another thread. \r\n\r\nA simple setter inside `TestWorkflowEnvironment` could allow us to set the desired time, before starting a workflow.  The setter's name is not that important.  It could be added to the `WorkflowOptions` class?\r\n\r\nI've skimmed the library implementation and found various interfaces which could potentially be implemented and injected to achieve the desired behavior.  `WorkflowOutboundCallsInterceptor` looks like a candidate, although it seems to be buried deep in the system internals. \r\n\r\nThank you for your help and for taking the time to read this. \r\n\r\nP.S Does writing a wrapper, and using it instead make sense?\r\n\r\n`\r\n public static long currentTimeMillis() {\r\n        return testMode ?  MockableTime.toEpochMilli() : Workflow.currentTimeMillis();\r\n    }\r\n`\r\n","closedAt":"2024-11-26T16:00:08Z","comments":[{"id":"IC_kwDODN12PM6VFftH","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"To control the initial in the test environment use `setInitialTime`.\r\n\r\n```\r\n    TestEnvironmentOptions testEnvOptions =\r\n        TestEnvironmentOptions.newBuilder().setInitialTime(WORKFLOW_START_TIME).build();\r\n    testEnv = TestWorkflowEnvironment.newInstance(testEnvOptions);\r\n```","createdAt":"2024-11-26T16:00:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-java/issues/2329#issuecomment-2501245767","viewerDidAuthor":false},{"id":"IC_kwDODN12PM6VFpdD","author":{"login":"IgorMaj"},"authorAssociation":"NONE","body":"Thank you for the answer.  Don't know How I missed that. ","createdAt":"2024-11-26T16:16:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2329#issuecomment-2501285699","viewerDidAuthor":false}],"createdAt":"2024-11-26T09:38:37Z","labels":[{"id":"MDU6TGFiZWwxNjIyNzE5ODQ0","name":"enhancement","description":"User experience","color":"a2eeef"}],"milestone":null,"number":2329,"reactionGroups":[],"state":"CLOSED","title":"Mock Workflow.currentTimeMillis() return value in test environment","updatedAt":"2024-11-26T16:16:41Z","url":"https://github.com/temporalio/sdk-java/issues/2329"}
