{"assignees":[],"author":{"id":"U_kgDOB9FEhw","is_bot":false,"login":"kulikj01","name":""},"body":"## Expected Behavior\n\nWhen specifying a list of packages for workers-auto-discovery in the Temporal Spring Boot starter, only workflows and activities from the explicitly listed packages should be scanned and registered.\n\nExample project structure:\n```\nsrc/main/java/com/example:\n  migration -> contains workflow and activity definitions -> taskQueues = migration-queue\n  publication -> contains workflow and activity definitions -> taskQueues = publication-queue\n```\n\nExample configuration:\n\n```\nspring:\n  temporal:\n    start-workers: true\n    workers-auto-discovery:\n      packages:\n        - com.example.publication\n```\nOnly classes under com.example.publication should be discovered and registered.\n\n## Actual Behavior\n`2025-06-18T11:05:29.610+02:00  INFO 21486 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Activity Poller taskQueue=\"migration-queue\", namespace=\"default\", identity=21486@PL-WAR-M2QWQ05P}\n2025-06-18T11:05:29.617+02:00  INFO 21486 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Workflow Poller taskQueue=\"publication-queue\", namespace=\"default\", identity=21486@PL-WAR-M2QWQ05P}\n2025-06-18T11:05:29.620+02:00  INFO 21486 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Activity Poller taskQueue=\"publication-queue\", namespace=\"default\", identity=21486@PL-WAR-M2QWQ05P}`\n\nEven though \"migration\" package has not been specified in packages, worker is started.\n\n## Side note\nSame issue happens if extra namespaces are defined:\n```\nspring:\n  temporal:\n    namespaces:\n      - namespace: migration\n        alias: migration\n        start-workers: true\n        workers-auto-discovery:\n          packages:\n            - com.example.migration\n    start-workers: true\n    workers-auto-discovery:\n      packages:\n        - com.example.publication\n```\nAll packages are registered in every namespace.\n```\n2025-04-02T13:45:26.601+02:00  INFO 27170 --- [           main] i.t.s.b.a.template.WorkersTemplate       : Registering auto-discovered activity bean 'publicationActivityImpl' of class class com.example.publication.PublicationActivityImpl on a worker  with a task queue 'publication-queue'\n2025-04-02T13:45:26.991+02:00  INFO 27170 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Workflow Poller taskQueue=\"migration-queue\", namespace=\"migration\", identity=27170@EPHUSZEW003C}\n2025-04-02T13:45:27.008+02:00  INFO 27170 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Activity Poller taskQueue=\"migration-queue\", namespace=\"migration\", identity=27170@EPHUSZEW003C}\n2025-04-02T13:45:27.040+02:00  INFO 27170 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Activity Poller taskQueue=\"publication-queue\", namespace=\"migration\", identity=27170@EPHUSZEW003C}\n2025-04-02T13:45:27.045+02:00  INFO 27170 --- [           main] .s.b.a.NonRootNamespaceAutoConfiguration : started workers for non-root namespace [migration]\n2025-04-02T13:45:27.046+02:00  INFO 27170 --- [           main] c.stepstone.poc.TemporalMultiNamespace   : Started TemporalMultiNamespace in 8.119 seconds (process running for 10.491)\n2025-04-02T13:45:27.069+02:00  INFO 27170 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Activity Poller taskQueue=\"migration-queue\", namespace=\"default\", identity=27170@EPHUSZEW003C}\n2025-04-02T13:45:27.075+02:00  INFO 27170 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Workflow Poller taskQueue=\"publication-queue\", namespace=\"default\", identity=27170@EPHUSZEW003C}\n2025-04-02T13:45:27.079+02:00  INFO 27170 --- [           main] io.temporal.internal.worker.Poller       : start: Poller{name=Activity Poller taskQueue=\"publication-queue\", namespace=\"default\", identity=27170@EPHUSZEW003C}\n```\n## Steps to Reproduce the Problem\n\n  1. Create two packages with workflow/activity\n  2. Reference only one package in workers-auto-discovery config\n  3. See other package being registered\n\n## Specifications\n\n  - Version: 1.28.3/1.29.0\n  - Platform: 21.0.4/MacOS\n","closedAt":"2025-09-11T15:05:23Z","comments":[{"id":"IC_kwDODN12PM7DjNQp","author":{"login":"kunalvarpe"},"authorAssociation":"NONE","body":"I would like to contribute over this issue fix.","createdAt":"2025-09-11T13:43:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2564#issuecomment-3280786473","viewerDidAuthor":false},{"id":"IC_kwDODN12PM7DlMA-","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"This is expected behaviour see the [documentation](https://docs.temporal.io/develop/java/spring-boot-integration#auto-discovery) for what is auto discovered . ","createdAt":"2025-09-11T15:07:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2564#issuecomment-3281305662","viewerDidAuthor":false},{"id":"IC_kwDODN12PM7DpEwQ","author":{"login":"kunalvarpe"},"authorAssociation":"NONE","body":"> This is expected behaviour see the [documentation](https://docs.temporal.io/develop/java/spring-boot-integration#auto-discovery) for what is auto discovered .\n\n@Quinn-With-Two-Ns \nAs per documentation implementation is correct. But in multi namespace configuration the expectation would be that the mentioned  workflow implementation and activities under the namespaces configuration should take precedence rather that activities present in spring context. \n\nFor e.g.,\n```yaml\nspring:\n     temporal:\n    connection:\n      target: \"127.0.0.1:7233\"\n    namespaces:\n      - namespace: \"demo\"\n        workers-auto-discovery:\n          packages:\n            - \"com.example.demo.workflow\"\n            - \"com.example.demo.activity\"\n      - namespace: \"demo2\"\n        workers-auto-discovery:\n          packages:\n            - \"com.example.demo1.workflow\"\n            - \"com.example.demo1.activity\"\n\n```\nWith above configuration what is happening is worker is register for demo and demo1 namespace from respective package configuration. But activities within demo package will get register in demo1 namespace as well and vice versa. But here expectation would be only specific activities only registered. Spring context activities should be for a option where intention is to share the activities between namespaces.\n\nI believe we should consider the scenario and spent some time to discuss this.","createdAt":"2025-09-11T19:16:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2564#issuecomment-3282324496","viewerDidAuthor":false},{"id":"IC_kwDODN12PM7DrZ5C","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"All activities beans registered in the spring context are registered according to their task queue/worker. Have you looked at the options under `@ActivityImpl` there are ways to control what worker an auto discovered activity would register for.\n\nNote, Spring Beans are objects they don't really have a \"package\" at all, that concept only applies to workflow implementations since we register workflow classes not Beans. ","createdAt":"2025-09-11T23:18:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-java/issues/2564#issuecomment-3282935362","viewerDidAuthor":false}],"createdAt":"2025-06-18T10:05:21Z","labels":[],"milestone":null,"number":2564,"reactionGroups":[],"state":"CLOSED","title":"Bug: workers-auto-discovery in Spring Boot scans packages not in specified list","updatedAt":"2025-09-11T23:18:08Z","url":"https://github.com/temporalio/sdk-java/issues/2564"}
