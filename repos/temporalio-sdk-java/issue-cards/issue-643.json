{
  "summary": "Workflow Task Completed events are unexpectedly being replayed and causing state machine failures in Java SDK benchmarks, particularly in the reactor_stress test with sticky worker eviction. The state machines receive duplicate events they've already processed, leading to workflow execution failures.",
  "category": "bug",
  "subcategory": "workflow-replay",
  "apis": [],
  "components": [
    "state-machines",
    "replay-handler",
    "sticky-worker",
    "workflow-cache"
  ],
  "concepts": [
    "event-replay",
    "cache-eviction",
    "state-machine",
    "workflow-task",
    "sticky-queue",
    "history-replay"
  ],
  "severity": "high",
  "userImpact": "Workflows can fail or hang during query operations after cache eviction, causing timeouts in stress test scenarios and production workloads.",
  "rootCause": "When workflows are evicted from the cache and queried, the sticky queue contains events that are then replayed as part of the new workflow task. State machines don't allow partial histories to contain events already processed, causing IllegalArgumentException on duplicate EVENT_TYPE_WORKFLOW_TASK_COMPLETED events.",
  "proposedFix": "Two solutions identified: (1) State machines should allow partial histories to contain events already handled, and (2) Reset sticky queue on cache invalidation or eviction (related to issue #883).",
  "workaround": null,
  "resolution": "fixed",
  "resolutionDetails": "Fixed by addressing state machine handling of duplicate events in partial histories and implementing sticky queue reset on cache eviction.",
  "related": [
    883
  ],
  "keyQuote": "State machines should allow partial histories sent with Workflow Tasks to contain events that were already handled",
  "number": 643,
  "repo": "temporalio-sdk-java",
  "generatedAt": "2026-01-11T18:31:37.001Z"
}