{
  "summary": "Workflow.await(duration, condition) doesn't properly handle workflow cancellation, throwing CanceledFailure but then causing a \"closed\" error. WorkflowStub.getResult() also fails to return when await has a duration, unlike the working await(condition) variant.",
  "category": "bug",
  "subcategory": "workflow-cancellation",
  "apis": [
    "Workflow.await"
  ],
  "components": [
    "timer-state-machine",
    "deterministic-runner",
    "workflow-executor",
    "cancellation-handler"
  ],
  "concepts": [
    "cancellation",
    "await",
    "duration",
    "timer",
    "workflow-execution",
    "state-machine"
  ],
  "severity": "high",
  "userImpact": "Workflows using await with duration and cancelation experience crashes instead of proper cancellation, preventing graceful shutdown and hanging getResult() calls.",
  "rootCause": "Timer callback tries to execute in workflow thread after DeterministicRunner is closed, causing cascading failure in state machine handling.",
  "proposedFix": null,
  "workaround": null,
  "resolution": "fixed",
  "resolutionDetails": "Fixed by properly handling cancellation in the timer state machine to avoid executing callbacks on closed deterministic runner.",
  "related": [],
  "keyQuote": "CanceledFailure is thrown but after that, it's followed by: java.lang.Error: closed",
  "number": 816,
  "repo": "temporalio-sdk-java",
  "generatedAt": "2026-01-11T18:44:09.921Z"
}