{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0},{"id":"MDQ6VXNlcjg0NDExMDE0","login":"yiminc","name":"Yimin Chen","databaseId":0}],"author":{"id":"MDQ6VXNlcjU1MTU2Nzg=","is_bot":false,"login":"shawnhathaway","name":"Shawn Hathaway"},"body":"During the clusterMembership table schema creation, I found MySQL has some hidden default value behavior for Timestamp columns that are declared NOT NULL in some cases. This caused the schema to work correctly on my local mysql (version: 8.0.19 Homebrew) but failed on the server mysql (version: 5.7).\r\n\r\nFrom https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_explicit_defaults_for_timestamp:\r\n\r\n>If explicit_defaults_for_timestamp is disabled, the server enables the nonstandard behaviors and handles TIMESTAMP columns as follows:\r\n\r\n>TIMESTAMP columns not explicitly declared with the NULL attribute are automatically declared with the NOT NULL attribute. Assigning such a column a value of NULL is permitted and sets the column to the current timestamp.\r\n\r\n>The first TIMESTAMP column in a table, if not explicitly declared with the NULL attribute or an explicit DEFAULT or ON UPDATE attribute, is automatically declared with the DEFAULT CURRENT_TIMESTAMP and ON UPDATE CURRENT_TIMESTAMP attributes.\r\n\r\n>TIMESTAMP columns following the first one, if not explicitly declared with the NULL attribute or an explicit DEFAULT attribute, are automatically declared as DEFAULT '0000-00-00 00:00:00' (the “zero” timestamp). For inserted rows that specify no explicit value for such a column, the column is assigned '0000-00-00 00:00:00' and no warning occurs.\r\n\r\n>Depending on whether strict SQL mode or the NO_ZERO_DATE SQL mode is enabled, a default value of '0000-00-00 00:00:00' may be invalid. Be aware that the TRADITIONAL SQL mode includes strict mode and NO_ZERO_DATE. See Section 5.1.10, “Server SQL Modes”. \r\n\r\n\r\n\r\n","closedAt":"2022-10-03T09:30:20Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY2NzI3MDgwOA==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"Moving to stabilization.  This is backwards compatible change.","createdAt":"2020-07-31T18:11:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-667270808","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3MzQ3ODkzNA==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"@yiminc @wxing1292 can you confirm if this is still relevant?","createdAt":"2021-07-03T22:28:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-873478934","viewerDidAuthor":false},{"id":"IC_kwDODNqesM40jN4C","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"we will re-evaluate this issue when supporting mysql 8.0","createdAt":"2021-07-16T18:47:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-881647106","viewerDidAuthor":false},{"id":"IC_kwDODNqesM49z3Pm","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"now server support mysql 8.0.19. https://github.com/temporalio/temporal/pull/2210","createdAt":"2022-02-12T05:45:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-1037005798","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5ID380","author":{"login":"qiuyuzhou"},"authorAssociation":"NONE","body":"> In temporal v1.7:  `TIMESTAMP DEFAULT '1970-01-01 00:00:01'`\r\n\r\nThis don't work when the time zone is '+8:00', because it would be  subtracted 8 hours when convert it to `UTC`  time zone, then would be an invalid value.\r\n\r\n> In temporal master branch: `TIMESTAMP DEFAULT '1970-01-01 00:00:01+00:00'`\r\n\r\nThe timezone offset is only supported from mysql `v8.0.19`.\r\nThis format has failed on my mysql v8.0.13 server.\r\n","createdAt":"2022-08-09T06:40:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-1208975156","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5K4zcK","author":{"login":"robholland"},"authorAssociation":"MEMBER","body":"Lets set it to '1970-01-02 00:00:01' so that it's safe against timezone adjustment but doesn't require any particular MySQL release.","createdAt":"2022-09-23T16:12:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-1256404746","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5K4zqe","author":{"login":"robholland"},"authorAssociation":"MEMBER","body":"This is preventing install on the current MariaDB version on AWS RDS (10.6.8).","createdAt":"2022-09-23T16:13:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/119#issuecomment-1256405662","viewerDidAuthor":false}],"createdAt":"2020-02-06T18:38:02Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"},{"id":"MDU6TGFiZWwyNTk0NTYwMDQy","name":"backlog","description":"","color":"0144E5"},{"id":"MDU6TGFiZWwzMTM4ODUyODY2","name":"needs-investigation","description":"","color":"0052cc"}],"milestone":{"number":1,"title":"Initial Temporal Release","description":"","dueOn":null},"number":119,"reactionGroups":[],"state":"CLOSED","title":"Set Explicit Default for all Timestamp Values in MySQL Schema","updatedAt":"2022-10-03T09:30:21Z","url":"https://github.com/temporalio/temporal/issues/119"}
