{"assignees":[{"id":"MDQ6VXNlcjg0NDExMDE0","login":"yiminc","name":"Yimin Chen","databaseId":0}],"author":{"id":"MDQ6VXNlcjg3NjI4OTM=","is_bot":false,"login":"wxing1292","name":"Wenquan Xing"},"body":"## Expected Behavior\r\nRetry should only be done few times, from the caller side, e.g.\r\n* client can retry 2 times\r\n* service (within network interceptor) can retry 2 times\r\n* async task processing can retry\r\n* no retry within business logic \r\n\r\n## Actual Behavior\r\nThere are multiple retry logic in different layers in history service logic. e.g.\r\nclient layer:\r\n[client layer retry](https://github.com/temporalio/temporal/blob/v1.14.0/common/resource/fx.go#L331-L339)\r\n\r\nnetwork API layer:\r\n[api layer retry](https://github.com/temporalio/temporal/blob/v1.14.0/service/history/historyEngine.go#L2508-L2558)\r\n\r\nPersistence transaction layer:\r\n[create workflow](https://github.com/temporalio/temporal/blob/v1.14.0/service/history/workflow/transaction_impl.go#L302-L313)\r\n[conflict resolve workflow](https://github.com/temporalio/temporal/blob/v1.14.0/service/history/workflow/transaction_impl.go#L350-L361)\r\n[update workflow](https://github.com/temporalio/temporal/blob/v1.14.0/service/history/workflow/transaction_impl.go#L453-L463)\r\n[get workflow](https://github.com/temporalio/temporal/blob/v1.14.0/service/history/workflow/transaction_impl.go#L407-L419)\r\n\r\nWhen error actually happen, e.g. resource limit exceeded, retry will be done in multiple layer, causing even more requests sent to e.g. history service\r\n","closedAt":"2023-08-10T19:02:40Z","comments":[{"id":"IC_kwDODNqesM5jw3TD","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"I believe this is done.","createdAt":"2023-08-10T19:02:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2306#issuecomment-1673753795","viewerDidAuthor":false}],"createdAt":"2021-12-16T00:37:27Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2306,"reactionGroups":[],"state":"CLOSED","title":"Properly retry persistence call","updatedAt":"2023-08-10T19:02:41Z","url":"https://github.com/temporalio/temporal/issues/2306"}
