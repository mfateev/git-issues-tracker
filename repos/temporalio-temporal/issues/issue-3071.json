{"assignees":[],"author":{"id":"MDQ6VXNlcjI4NTMxNDk3","is_bot":false,"login":"0xdu","name":"Duo"},"body":"When calling multi-goroutine ExecuteActivity inside WorkFlow the program throws an exception `panic: getState: illegal access from outside of workflow context`. \r\nTo understand let's see my example. I can't call multi goroutine `TestActivity`  in `TestWorkFlow`,  an exception throw: `panic: getState: illegal access from outside of workflow context`. This is the same when calling multi goroutine ExecuteChildWorkflow inside WorkFlow\r\n\r\n```go\r\nfunc TestWorkFlow(ctx workflow.Context) (bool, error) {\r\n\tao := workflow.ActivityOptions{\r\n\t\tStartToCloseTimeout: 24 * time.Hour,\r\n\t}\r\n\tctx = workflow.WithActivityOptions(ctx, ao)\r\n\tgologger.Info().Msg(\"start test workflow\")\r\n\tvar wg sync.WaitGroup\r\n\tfor i := 0; i < 5; i++ {\r\n\t\twg.Add(1)\r\n\t\tfuture := workflow.ExecuteActivity(ctx, TestActivity, i+1)\r\n\t\tgo func(future workflow.Future) {\r\n\t\t\tdefer wg.Done()\r\n\t\t\tvar done bool\r\n\t\t\tfuture.Get(ctx, &done)\r\n\t\t}(future)\r\n\t\ttime.Sleep(time.Second)\r\n\t}\r\n\twg.Wait()\r\n\tgologger.Info().Msg(\"complete test workflow\")\r\n\treturn true, nil\r\n}\r\n\r\nfunc TestActivity(ctx context.Context, index int) (bool, error) {\r\n\tgologger.Info().Msgf(\"start activity test %d\", index)\r\n\ttime.Sleep(5 * time.Second)\r\n\tgologger.Info().Msgf(\"complete activity test %d\", index)\r\n\treturn true, nil\r\n}\r\n```\r\n\r\nMy question is how to call multi goroutine `ExecuteActivity`  or `ExecuteChildWorkflow` insite a Workflow\r\n## Specifications\r\n\r\n  - Version: latest\r\n  - Platform: windows 10\r\n","closedAt":"2022-07-08T08:00:23Z","comments":[{"id":"IC_kwDODNqesM5GQOFM","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Workflow code must be deterministic, so `go` can't be used inside workflow definition. Please use the [`workflow.Go`](https://pkg.go.dev/go.temporal.io/sdk@v1.15.0/workflow#Go) instead.\r\n\r\n`time.Sleep` also should not be used. Use [`workflow.Sleep`](https://pkg.go.dev/go.temporal.io/sdk@v1.15.0/workflow#Sleep) instead.\r\n\r\nYou don't have to use `workflow.Go` in order to run activities in parallel. As long as the first activity future.Get call is after all `workflow.ExecuteActivity`, those activities will run in parallel. \r\n\r\nSo all that's needed is a for loop to execute all activities and then another for loop to call Get on the futures.\r\n\r\n","createdAt":"2022-07-08T07:34:48Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/temporal/issues/3071#issuecomment-1178657100","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5GQTor","author":{"login":"0xdu"},"authorAssociation":"NONE","body":"> Workflow code must be deterministic, so `go` can't be used inside workflow definition. Please use the [`workflow.Go`](https://pkg.go.dev/go.temporal.io/sdk@v1.15.0/workflow#Go) instead.\r\n> \r\n> `time.Sleep` also should not be used. Use [`workflow.Sleep`](https://pkg.go.dev/go.temporal.io/sdk@v1.15.0/workflow#Sleep) instead.\r\n> \r\n> You don't have to use `workflow.Go` in order to run activities in parallel. As long as the first activity future.Get call is after all `workflow.ExecuteActivity`, those activities will run in parallel.\r\n> \r\n> So all that's needed is a for loop to execute all activities and then another for loop to call Get on the futures.\r\n\r\nThank @yycptt for your response. \r\n\r\nAfter modifying my code according to your instructions, my code worked as expected","createdAt":"2022-07-08T08:00:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/3071#issuecomment-1178679851","viewerDidAuthor":false}],"createdAt":"2022-07-07T16:16:49Z","labels":[],"milestone":null,"number":3071,"reactionGroups":[],"state":"CLOSED","title":"Can't call multi  goroutine ExecuteActivity, ExecuteChildWorkflow  inside WorkFlow","updatedAt":"2022-07-08T08:00:24Z","url":"https://github.com/temporalio/temporal/issues/3071"}
