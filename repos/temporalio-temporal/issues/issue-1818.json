{"assignees":[{"id":"MDQ6VXNlcjQ2NjcyMw==","login":"dnr","name":"David Reiss","databaseId":0}],"author":{"id":"MDQ6VXNlcjg1ODEyNjI=","is_bot":false,"login":"zydovech","name":""},"body":"\r\n## Expected Behavior\r\n     \r\n    my CronSchedule is   */2 * * * *  。\r\n    I expect to be executed every two minutes\r\n    \r\n## Actual Behavior\r\n    \r\n  Sometimes it was executed twice in two minutes\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. run cron workflow\r\n  \r\n   i see the change in https://github.com/temporalio/temporal/pull/560 , \r\n\r\n  I think the following changes caused multiple implementation issues\r\n  \r\n```\r\n\tif nowUTC.Before(scheduledUTCTime) { //this code is new for 560 。\r\n\t\tnextScheduleTime = scheduledUTCTime\r\n\t} else {\r\n\t\tnextScheduleTime = schedule.Next(scheduledUTCTime)\r\n\t\t// Calculate the next schedule start time which is nearest to now (right after now).\r\n\t\tfor nextScheduleTime.Before(nowUTC) {\r\n\t\t\tnextScheduleTime = schedule.Next(nextScheduleTime)\r\n\t\t}\r\n\t}\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version:  v1.11.2\r\n  - Platform: linux\r\n","closedAt":"2021-08-19T12:24:06Z","comments":[{"id":"IC_kwDODNqesM41rLMp","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"This PR https://github.com/temporalio/temporal/pull/1828 should have fixed this cron schedule issue.","createdAt":"2021-08-17T17:52:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1818#issuecomment-900510505","viewerDidAuthor":false},{"id":"IC_kwDODNqesM41ry7h","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"After talking with @wxing1292 , we're not really sure that his PR fully fixes this issue (though it may help). There still might be another bug here, so we'll keep it open while I investigate more.","createdAt":"2021-08-17T22:29:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1818#issuecomment-900673249","viewerDidAuthor":false},{"id":"IC_kwDODNqesM41sHQx","author":{"login":"zydovech"},"authorAssociation":"NONE","body":" I am not too clear about the whole process of workflow, I am still learning， I looked at the code of cadence，\r\nThere is no ```nowUTC.Before(scheduledUTCTime) ``` judgment . \r\n \r\nin my case ,  nowUTC is before scheduledUTCTime, nextScheduleTime is set to scheduledUTCTime，Resulted in another dispatch immediately，After I deleted the if judgment, directly set nextScheduleTime = schedule.Next(scheduledUTCTime), there is no repeated execution","createdAt":"2021-08-18T02:07:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1818#issuecomment-900756529","viewerDidAuthor":false},{"id":"IC_kwDODNqesM41vLBA","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"Could you please try again with the just-released 1.11.4 patch release? It includes two fixes to cron scheduling that we believe should address this.\r\n\r\nI've looked at the code you pointed out and I believe it's correct. In general, that clause shouldn't occur in normal operation: `now` should always be after `scheduled`, otherwise we wouldn't be checking the next backoff. The reason you're seeing it is because of separate bugs that caused `scheduled` to be set to an incorrect value too far in the future.","createdAt":"2021-08-19T02:22:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1818#issuecomment-901558336","viewerDidAuthor":false},{"id":"IC_kwDODNqesM41wXQ4","author":{"login":"zydovech"},"authorAssociation":"NONE","body":"Hi , i try again , this problem have fixed . thanks a lot 。","createdAt":"2021-08-19T12:23:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1818#issuecomment-901870648","viewerDidAuthor":false}],"createdAt":"2021-08-12T12:37:28Z","labels":[],"milestone":null,"number":1818,"reactionGroups":[{"content":"LAUGH","users":{"totalCount":1}}],"state":"CLOSED","title":"CronSchedule workflow issue","updatedAt":"2021-08-19T12:24:06Z","url":"https://github.com/temporalio/temporal/issues/1818"}
