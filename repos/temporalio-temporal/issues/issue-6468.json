{"assignees":[],"author":{"id":"MDQ6VXNlcjI5NjM1NA==","is_bot":false,"login":"hferentschik","name":"Hardy Ferentschik"},"body":"## Expected Behavior\r\n\r\nWhen generating replication tasks in [GenerateReplicationTasks](https://github.com/temporalio/temporal/blob/0836b0fff0bbd6637ea1723f7e5a675519029354/service/worker/migration/activities.go#L427), not found errors from the underlying `historyClient.GenerateLastHistoryReplicationTasks` should only be logged.\r\n\r\nWorkflows can for example be archived between being listed and then processed in `GenerateReplicationTasks`. A not found history should just be logged. Returning the error keep retrying the activity\r\n\r\n## Actual Behavior\r\n\r\nDue to returning the error the activity gets retried and does not make any progress anymore.\r\n\r\n```Go\r\n\tfor i := startIndex; i < len(request.Executions); i++ {\r\n\t\twe := request.Executions[i]\r\n\t\tif err := a.generateWorkflowReplicationTask(ctx, rateLimiter, definition.NewWorkflowKey(request.NamespaceID, we.WorkflowId, we.RunId)); err != nil {\r\n\t\t\tif !isNotFoundServiceError(err) {\r\n\t\t\t\ta.logger.Error(\"force-replication failed to generate replication task\", tag.WorkflowNamespaceID(request.NamespaceID), tag.WorkflowID(we.WorkflowId), tag.WorkflowRunID(we.RunId), tag.Error(err))\r\n\t\t\t\treturn err\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tactivity.RecordHeartbeat(ctx, i)\r\n\t}\r\n```\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Execute a ForceReplicationWorkflow run for a given workflow which will archive directly once completed\r\n  1. Complete the workflow in between `ListWorkflows` and `GenerateReplicationTasks`\r\n\r\n## Specifications\r\n\r\n  - Version: `main`\r\n  - Platform:\r\n","closedAt":null,"comments":[],"createdAt":"2024-08-30T10:29:50Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":6468,"reactionGroups":[],"state":"OPEN","title":"GenerateReplicationTasks activity of ForceReplicationWorkflow should only log not found errors opposed to returning the error as well","updatedAt":"2024-08-30T10:29:50Z","url":"https://github.com/temporalio/temporal/issues/6468"}
