{"assignees":[],"author":{"id":"MDQ6VXNlcjExMzU5Mjkx","is_bot":false,"login":"aidanSoles","name":"Aidan Daniels-Soles"},"body":"**NOTE**: The below is an issue I've been hitting when trying to use the Temporal dev server (with SQLite persistence) for local dev. This could be a PEBKAC, but I wanted to create this issue in the case that it isn't.\n\n## Background\n\nI'm using the Temporal dev server with SQLite persistence (`temporal server start-dev --db-filename ...`) to test a feature for a tool that's backed by Temporal. For my local environment, the stack consists of:\n\n* A FastAPI process, that fronts the Temporal server via the Python SDK.\n* The Temporal dev server with SQLite persistence (`temporal server start-dev --db-filename ...`).\n* A worker that, once again, uses the Python SDK.\n\nI wanted to create a SQLite DB to use for a test, so I did the following:\n\n1. Wrote a test script that made 512 requests (with small sleeps in between each request) with real test data to the FastAPI server (which would result in 512 workflows being run).\n2. Started FastAPI, the Temporal dev server (with SQLite persistence), and the worker process.\n3. Ran the test script from step 1.\n4. Let Temporal/the worker process finish running all the workflows.\n5. Stopped the FastAPI server, the Temporal dev server, and the worker.\n6. Committed the resulting `.db` file from the test run (via Git LFS).\n\n## Expected Behavior\n\nI expected that when I started the server up again with the `temporal server start-dev --db-filename ...` command, the my workflow history would be there.\n\n## Actual Behavior\n\nWhen I started the server up again with the `temporal server start-dev --db-filename ...` command, the my workflow history was totally gone.\n\n## Steps to Reproduce the Problem\n\n  1. Open the SQLite DB and inspect the `count` in the `history_tree` table. *DISCLAIMER*: I am not sure if this is the right way to prove that the event history was deleted.\n  2. Run the Temporal dev server while passing the existing SQLite DB to the `--db-filename` argument.\n  3. Open the SQLite DB and inspect the `count` in the `history_tree` table. The `count` in the `history_tree` table should have almost entirely reset.\n\nI ran the above process and the output is as follows:\n\n```\n$ sqlite3 test.db\nSQLite version 3.43.2 2023-10-10 13:08:14\nEnter \".help\" for usage hints.\nsqlite> select count(*) from history_tree;\n526\nsqlite> ^D\n\n$ temporal server start-dev --log-level=error --db-filename test.db # Running this with error-level debugging to reduce noise.\nCLI 1.3.0 (Server 1.27.1, UI 2.36.0)\n\nServer:  localhost:7233\nUI:      http://localhost:8233\nMetrics: http://localhost:51209/metrics\n^CStopping server...\n\n# aidansoles @ MC-JNQ2XR2RK7 in ~/dev/bowser/tests/test_dbs on git:ads/cron-worker-0 x [13:34:10]\n$ sqlite3 test.db\nSQLite version 3.43.2 2023-10-10 13:08:14\nEnter \".help\" for usage hints.\nsqlite> select count(*) from history_tree;\n4\n```\n\nAs you can see from the above, the `count` went from `526` to `4` just by starting the server.\n\n## Specifications\n\n  - Version:\n```\n$ temporal --version\ntemporal version 1.3.0 (Server 1.27.1, UI 2.36.0)\n```\n  - Platform:\n```\n$ uname -a\nDarwin MC-JNQ2XR2RK7 24.5.0 Darwin Kernel Version 24.5.0: Tue Apr 22 19:54:29 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6030 arm64\n```","closedAt":"2025-07-10T22:19:55Z","comments":[{"id":"IC_kwDODNqesM6xJJ1f","author":{"login":"kevinawoo"},"authorAssociation":"MEMBER","body":"Hey @aidanSoles, seems to work for me. Could you run it with `--log-level debug` and send in your logs, either here on the Github issue, or in your support ticket?","createdAt":"2025-06-13T23:37:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7919#issuecomment-2971966815","viewerDidAuthor":false},{"id":"IC_kwDODNqesM62WVLP","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I cannot reproduce this (using the latest CLI - 1.4.0) but there are no known differences since 1.3.0.\nThe current theory is that retention timers were triggered on the workflows stored in the DB.\nI would also recommend using the temporal CLI's `workflow list` command or using the UI to inspect the system instead of looking at the internal DB state.\n\nPlease reopen if you manage to provide a reliable reproduction.\n","createdAt":"2025-07-10T22:19:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7919#issuecomment-3059307215","viewerDidAuthor":false}],"createdAt":"2025-06-13T20:40:28Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7919,"reactionGroups":[],"state":"CLOSED","title":"No workflows found upon server restart when using SQLite persistence (--db-filename)","updatedAt":"2025-07-10T22:19:55Z","url":"https://github.com/temporalio/temporal/issues/7919"}
