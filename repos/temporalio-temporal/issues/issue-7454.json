{"assignees":[],"author":{"id":"MDQ6VXNlcjY5NTExNDA=","is_bot":false,"login":"san127127","name":"Gary Lee"},"body":"## Expected Behavior\nupdate-schema should work correctly on windows\n\n## Actual Behavior\nupdate-schema doesn't work correctly on windows\n\n## Steps to Reproduce the Problem\n\n  1. Download the temporal-sql-tool and the SQL scripts\n  2. Start a postgres DB\n  3. Create a DB and setup the schema version tables\n      - `.\\temporal-sql-tool.exe --ep \"127.0.0.1\" -p \"5432\" -u \"postgres\" -pw \"123456\" --plugin postgres12 --db temporal setup-schema -v 0.0`\n  4. Run `.\\temporal-sql-tool.exe --ep \"127.0.0.1\" -p \"5432\" -u \"postgres\" -pw \"123456\" --plugin postgres12 --db temporal update-schema -d \"./postgresql/v12/temporal/versioned\"`\n  5. Will get the following error:\n```\nERROR   Unable to update SQL schema.    {\"error\": \"error processing manifest for version v1.0:readfile v1.0\\\\manifest.json: invalid argument\", \"logging-call-at\": \"/home/runner/work/temporal/temporal/tools/sql/handler.go:77\"}\n```\n## Specifications\n\n  - Version: 1.27.1\n  - Platform: windows 11\n\n## Remarks\nThe problem seems to be due to the use of `filepath.Join()`.\nOn windows, `filepath.Join()` returns a path with \"\\\\\" as the separator like `v1.0\\manifest.json` and paths like this don't work with `fs.ReadFile()`.\nHere is a code snippet to reproduce the problem:\n```\nvar fsys = os.DirFS(\"./schema/postgresql/v12/temporal/versioned\")\n_, err := fs.ReadFile(fsys, \"v1.0/manifest.json\") // this works fine\n_, err2 := fs.ReadFile(fsys, \"v1.0\\\\manifest.json\") // this returns error\n```\nI tried to change `filepath.Join()` to `path.Join()`, which returns a path using \"/\" as the separator, in `updatetask.go` and the update-schema will work.\n\nI am not familiar with golang and this project, therefore I am not sure what is the correct way to fix this and I can't raise a PR for this. :disappointed_relieved:\n","closedAt":"2025-04-12T02:21:13Z","comments":[{"id":"IC_kwDODNqesM6jbTju","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Hi, thanks for reporting the issue! We will look into it.","createdAt":"2025-03-20T22:58:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2741844206","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6jsQvR","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@san127127 would you be interest to put up a PR to fix this issue?","createdAt":"2025-03-23T16:05:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2746289105","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6juRKn","author":{"login":"san127127"},"authorAssociation":"CONTRIBUTOR","body":"@yiminc \nNot sure if it is indeed the correct fix, but here it is","createdAt":"2025-03-24T03:53:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2746815143","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6l8yZW","author":{"login":"gow"},"authorAssociation":"MEMBER","body":"@san127127 your change looks good. Could you please send a pull request in this repo so that we can merge it? You might need to fix the corresponding test (`TestReadManifest`) in `updatetask_test.go`\nOtherwise, I can send your changes as a PR here along with the test fix. Please let me know.","createdAt":"2025-04-07T18:12:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2784175702","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6mYF0r","author":{"login":"san127127"},"authorAssociation":"CONTRIBUTOR","body":"hi @gow \nThe `TestReadManifest` is still passing. I supposed we don't need to update the tests.\nPerhaps I am not very familiar with contributing open source projects ðŸ˜… \nWhat do you mean by \"send a pull request in this repo so that we can merge it\"? \nI thought you can merge the PR already once you approve itðŸ¤” \n","createdAt":"2025-04-10T01:38:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2791333163","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6mwnKL","author":{"login":"gow"},"authorAssociation":"MEMBER","body":"> What do you mean by \"send a pull request in this repo so that we can merge it\"?\n\nMy mistake. I thought the commit referenced was in a forked repo.\n\nThis looks good.\nApparently the issue is in embed stdlib. It doesn't consider OS specific paths and the recommended solution is to use `path.Join()` - https://github.com/golang/go/issues/44305\n@san127127 assuming you tested it on windows, this is good to go once the CI passes. I will merge it after that. Thank you for the fix and contributing to temporal.","createdAt":"2025-04-11T18:43:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2797761163","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6qd_g3","author":{"login":"prabhpahul"},"authorAssociation":"NONE","body":"Hi, was this fix released, facing same problem on windows using latest 1.27.2 release.\n\nThank you.","createdAt":"2025-05-07T19:28:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2859989047","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6qiMt1","author":{"login":"san127127"},"authorAssociation":"CONTRIBUTOR","body":"@prabhpahul \nNo, looks like we need to wait for 1.28","createdAt":"2025-05-08T01:08:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2861091701","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6scvgT","author":{"login":"gw-ubunye"},"authorAssociation":"NONE","body":"What is the ETA of 1.28? Is there a work-around for the meantime?","createdAt":"2025-05-20T07:10:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7454#issuecomment-2893215763","viewerDidAuthor":false}],"createdAt":"2025-03-12T14:42:46Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7454,"reactionGroups":[],"state":"CLOSED","title":"SQL tool update-schema not working on windows","updatedAt":"2025-05-20T07:10:33Z","url":"https://github.com/temporalio/temporal/issues/7454"}
