{"assignees":[{"id":"MDQ6VXNlcjg0NDExMDE0","login":"yiminc","name":"Yimin Chen","databaseId":0}],"author":{"id":"MDQ6VXNlcjU1NTIzODE=","is_bot":false,"login":"mastermanu","name":""},"body":"## Expected Behavior\r\nIf temporal-sql-tool fails halfway through running (e.g. connection to SQL server cut), re-running the same command should succeed.\r\n\r\n## Actual Behavior\r\nTool repeated fails because some of the tables were already created. This clearly happens when going from version 0 to version 1.0. It means the user has to then drop and re-create the schema.\r\n\r\nWe should also make sure that v1.0 --> v1.1 upgrade and so on are also idempotent\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.\r\n  1.\r\n  1.\r\n\r\n## Specifications\r\n\r\n  - Version:\r\n  - Platform:\r\n","closedAt":"2021-10-29T06:02:56Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc5NjkyNjg4NA==","author":{"login":"drewhoskins-stripe"},"authorAssociation":"NONE","body":"+1 to this!","createdAt":"2021-03-11T17:57:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1087#issuecomment-796926884","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc5NjkyOTg0Mg==","author":{"login":"drewhoskins-stripe"},"authorAssociation":"NONE","body":"related: https://github.com/temporalio/temporal/issues/1370","createdAt":"2021-03-11T18:01:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1087#issuecomment-796929842","viewerDidAuthor":false},{"id":"IC_kwDODNqesM41uvux","author":{"login":"michaeldop"},"authorAssociation":"NONE","body":"Another note to add here around this issue as I ran into this as I was upgrading to the newer version:\r\n\r\nSince the auto-setup.sh script exits on any errors now (https://github.com/temporalio/temporal/blob/master/docker/auto-setup.sh#L3) you can never get past this line https://github.com/temporalio/temporal/blob/master/docker/auto-setup.sh#L167 if you have already run the auto-setup script. You will see something like this on a pre-existing installation:\r\n\r\n`Error 1050: Table 'schema_version' already exists`\r\n\r\nOn an older version of temporal (v1.6.7) the `start.sh` script would not exit and continue on to the `update-schema` step of the tool allowing for the database to migrated. \r\n\r\nSo I think the `auto-setup` as is today will only work on brand new installations.\r\n","createdAt":"2021-08-18T21:37:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/1087#issuecomment-901446577","viewerDidAuthor":false}],"createdAt":"2020-12-14T04:57:20Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"},{"id":"MDU6TGFiZWwyNTc2NTM1ODQ2","name":"difficulty: easy","description":"","color":"68d662"},{"id":"MDU6TGFiZWwyODE3MDk3ODQ0","name":"planning","description":"","color":"006b75"}],"milestone":null,"number":1087,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"temporal-sql-tool not idempotent","updatedAt":"2021-10-29T06:02:56Z","url":"https://github.com/temporalio/temporal/issues/1087"}
