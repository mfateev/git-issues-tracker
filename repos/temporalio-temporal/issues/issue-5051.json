{"assignees":[],"author":{"id":"MDQ6VXNlcjM2Mjk0NjM=","is_bot":false,"login":"denniskniep","name":"Dennis Kniep"},"body":"**Is your feature request related to a problem? Please describe.**\r\nI´m running temporal with the HelmChart in a K8s EKS Cluster. And configured archival with S3.\r\nI can´t get [IRSA](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) work. Maybe it´s not supported yet?\r\n\r\nThe temporal pods are getting automatically following env vars:\r\n```\r\nAWS_DEFAULT_REGION\r\nAWS_REGION\r\nAWS_ROLE_ARN \r\nAWS_STS_REGIONAL_ENDPOINTS \r\nAWS_WEB_IDENTITY_TOKEN_FILE \r\n```\r\n\r\nFurthermore the currently used [Go SDK is supported](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-minimum-sdk.html), right?\r\n\r\nIf I update my namespace to use archival \r\n` temporal operator namespace update --visibility-archival-state enabled --history-archival-state enabled <namespace>`\r\n\r\nI get following error:\r\n```\r\nnamespace update failed: Forbidden: Forbidden  status code: 403,\r\n```\r\n\r\nStacktrace is not helpful due to following issue: https://github.com/temporalio/temporal/issues/983\r\n\r\nAccording to several comments and PR´s from different projects:\r\n\r\nAWS Go SDK´s `session.NewSession` must be probably replaced with `session.NewSessionWithOptions` [here](https://github.com/temporalio/temporal/blob/01d3e7fdeaedf6375426684fc5671185de3ba695/common/archiver/s3store/history_archiver.go#L113)\r\n* https://github.com/aws/aws-sdk-go/issues/3101#issuecomment-604739840\r\n* https://github.com/zalando-incubator/kube-metrics-adapter/pull/230\r\n\r\n\r\n\r\n","closedAt":"2023-12-27T21:11:19Z","comments":[{"id":"IC_kwDODNqesM5qlDBV","author":{"login":"denniskniep"},"authorAssociation":"CONTRIBUTOR","body":"Update: Turned out, `403 Forbidden` error was due to missing S3 Permission in the RolePolicy and authentication via IRSA was already successfully executed.\r\n\r\nIt would be really helpful if one can activate debug logging of aws sdk if necessary for troubleshooting.","createdAt":"2023-10-31T22:00:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5051#issuecomment-1788096597","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5qlFw_","author":{"login":"denniskniep"},"authorAssociation":"CONTRIBUTOR","body":"Created that PR #5059 which provides the ability to activate debug logging of aws sdk if necessary for troubleshooting.","createdAt":"2023-10-31T22:12:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5051#issuecomment-1788107839","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5vfkLh","author":{"login":"MichaelSnowden"},"authorAssociation":"CONTRIBUTOR","body":"@denniskniep thanks for addressing this; can this issue now be closed?","createdAt":"2023-12-27T18:45:25Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/5051#issuecomment-1870545633","viewerDidAuthor":false}],"createdAt":"2023-10-30T22:36:27Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":5051,"reactionGroups":[],"state":"CLOSED","title":"Allow authentication with IRSA on archival with AWS S3 ","updatedAt":"2023-12-27T21:11:19Z","url":"https://github.com/temporalio/temporal/issues/5051"}
