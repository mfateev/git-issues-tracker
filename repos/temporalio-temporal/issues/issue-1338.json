{"assignees":[],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"**Is your feature request related to a problem? Please describe.**\r\n`tctl workflow reset` supports `reset_type` argument. The ResetWorkflowExecution gRPC API accepts only `workflow_task_finish_event_id`. So all the logic of finding reset point resides in the tctl. This makes the logic not reusable when SDKs invoke reset operation directly.\r\n\r\n**Describe the solution you'd like**\r\nMove logic of finding reset point to the service by adding reset_type argument to ResetWorkflowExecutionRequest.\r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM40-vzp","author":{"login":"bisakhmondal"},"authorAssociation":"NONE","body":"Hey, @mfateev would you mind, if I work on this issue? I have been using temporal.io for quite a long time and want to contribute something : )\r\nThanks.","createdAt":"2021-07-29T07:15:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1338#issuecomment-888863977","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5YYY8Z","author":{"login":"sstro"},"authorAssociation":"NONE","body":"Hello,\r\n\r\nIn case there are parallel branches in a workflow it can be difficult to find the \"reset point\" event corresponding to the branch one wishes to restart. In the Java SDK, we haven't found any correlation between the \"workflow task started\" event and activity events that follow.\r\n\r\nIf the logic of determining the reset point were moved to the service, ideally one could just invoke an API to e.g. \"reset a workflow to the point preceding the first failure\".\r\n\r\nThanks","createdAt":"2023-03-24T13:21:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1338#issuecomment-1482788633","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6tEAKV","author":{"login":"Shridhar2104"},"authorAssociation":"NONE","body":"## Auto‐select reset point when not provided\n\n### Problem\nBy default the Reset API requires clients to supply a `WorkflowTaskFinishEventId`, forcing callers to inspect history and pick an internal event ID themselves. This makes resets brittle and user‐unfriendly.\n\n### Solution\nIf the client omits `WorkflowTaskFinishEventId` (i.e. it’s zero), the service will:\n\n1. Read the workflow’s history branch up to `(NextEventID – 1)`.\n2. Scan the returned `HistoryEvents` for the last `WORKFLOW_TASK_COMPLETED` event.\n3. Set `WorkflowTaskFinishEventId` to that event’s ID, so the reset will roll back to just before it completed.\n4. Proceed with the existing validation and reset logic.\n\n### Key Code Snippet\n\n```go\n// in service/history/api/resetworkflow/api.go → Invoke(...)\nbaseMutableState := baseLease.GetMutableState()\n\n// 1) Auto‐select finish ID if caller omitted it\nif req.GetWorkflowTaskFinishEventId() == 0 {\n  // read history up to last event\n  resp, err := shardCtx.GetExecutionManager().ReadHistoryBranch(ctx, &persistence.ReadHistoryBranchRequest{\n    BranchToken: baseMutableState.GetExecutionInfo().GetCurrentBranchToken(),\n    MinEventID:  common.FirstEventID,\n    MaxEventID:  baseMutableState.GetNextEventID() - 1,\n    PageSize:    defaultPageSize,\n  })\n  if err != nil {\n    return nil, serviceerror.NewInternal(\"fetching history for reset: \" + err.Error())\n  }\n\n  // 2) find last WorkflowTaskCompleted\n  var lastComplete int64\n  for _, ev := range resp.HistoryEvents {\n    if ev.GetEventType() == enumspb.EVENT_TYPE_WORKFLOW_TASK_COMPLETED {\n      lastComplete = ev.GetEventId()\n    }\n  }\n  if lastComplete <= common.FirstEventID {\n    return nil, serviceerror.NewInvalidArgument(\"no completed workflow task found to reset to\")\n  }\n\n  // 3) use that as the finish‐event ID\n  req.WorkflowTaskFinishEventId = lastComplete\n}\n\n// 4) existing validation now passes, then core reset logic runs...\n","createdAt":"2025-05-23T07:18:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1338#issuecomment-2903507605","viewerDidAuthor":false}],"createdAt":"2021-03-01T16:25:54Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxNjIxMDMwNzg5","name":"good first issue","description":"Good for newcomers","color":"7057ff"},{"id":"MDU6TGFiZWwxNzkwMTM1NzM5","name":"refactoring","description":"","color":"e8b181"},{"id":"MDU6TGFiZWwzMTM4ODI4MTE3","name":"up-for-grabs","description":"Issues to consider for external contribution","color":"69CD90"}],"milestone":null,"number":1338,"reactionGroups":[],"state":"OPEN","title":"Workflow Reset: add logic of determining the reset point to the service","updatedAt":"2025-05-23T07:18:50Z","url":"https://github.com/temporalio/temporal/issues/1338"}
