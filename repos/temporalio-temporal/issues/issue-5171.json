{"assignees":[],"author":{"id":"MDQ6VXNlcjEyNTc0OTY=","is_bot":false,"login":"jontro","name":"Jonas Trollvik"},"body":"## Expected Behavior\r\nThe client should throw an exception immidiatley\r\n\r\n## Actual Behavior\r\nCalling activityCompletionClient.complete with an invalid task token, gives a timeout after a while instead of an error. \r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1.\r\n```\r\n    workflowClient.newActivityCompletionClient().complete(\r\n        \"bogus\".toByteArray(), \"\"\r\n    )\r\n```\r\n2. Timeout occurs after a while with the following exception:\r\n`Caused by: io.grpc.StatusRuntimeException: UNKNOWN: unexpected EOF`\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: [v1.20.0](https://github.com/temporalio/temporal/releases/tag/v1.20.0)\r\n  - Platform: amd64\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5tNAy3","author":{"login":"phongcao"},"authorAssociation":"NONE","body":"This is not a bug of the temporal server. When we debugged, the server realized the invalid task token and returned the error immediately to the client. However, by design [the `grpcRetryer` implementation on the sdk-java](https://github.com/temporalio/sdk-java/blob/master/temporal-sdk/src/main/java/io/temporal/internal/client/external/ManualActivityCompletionClientImpl.java#LL111C20-L111C20) catches this error, keeps retrying until expiration and finally prints out the error after a couple minutes.\r\nThis implementation doesn't exist in other sdks such as: `sdk-go`, `sdk-typescript` and `sdk-python`.","createdAt":"2023-05-30T15:46:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5171#issuecomment-1832127671","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5tNAzB","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Checking the Go SDK it also returns a timeout so this is not a Java excl. If the server is returning an `UNKNOWN` status code then most SDKs should consider that retry-able. ","createdAt":"2023-10-22T02:05:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5171#issuecomment-1832127681","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5tNAzR","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"Confirmed all SDKs consider `UNKNOWN` retry-able. So all SDKs will timeout on an invalid task token.\r\n\r\nhttps://github.com/temporalio/sdk-typescript/blob/4dcc82aa48fc285119978bd2a93acc3a0e9fd231/packages/client/src/grpc-retry.ts#L100\r\n\r\nhttps://github.com/temporalio/sdk-core/blob/45d2bc997fd25bf24d347b04d519e7279851aea4/client/src/retry.rs#L22\r\n\r\nI think the simplest fix is for server to return a different status code like `INVALID_ARGUMENTS` in this case.","createdAt":"2023-10-22T22:58:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5171#issuecomment-1832127697","viewerDidAuthor":false}],"createdAt":"2023-03-14T21:16:56Z","labels":[],"milestone":null,"number":5171,"reactionGroups":[],"state":"OPEN","title":"Timeout on complete when invalid task token passed","updatedAt":"2023-11-29T15:29:07Z","url":"https://github.com/temporalio/temporal/issues/5171"}
