{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyMjI1MTI=","is_bot":false,"login":"hazcod","name":"Niels Hofmans"},"body":"## Expected Behavior\r\nStartup temporal/auto-setup in google cloud.\r\n\r\n## Actual Behavior\r\n```\r\n\r\n\r\n2020-10-24 16:52:33.965 CEST2020/10/24 14:52:33 pq: relation \"schema_version\" already exists\r\n\r\n2020-10-24 16:52:33.968 CEST+ temporal-sql-tool --plugin postgres --ep 10.47.192.6 -u postgres -p 5432 --db temporal_visibility update-schema -d /etc/temporal/schema/postgres/visibility/versioned\r\n\r\n2020-10-24 16:52:34.006 CEST2020/10/24 14:52:34 UpdateSchemeTask started, config=&{DBName: TargetVersion: SchemaDir:/etc/temporal/schema/postgres/visibility/versioned IsDryRun:false}\r\n\r\n2020-10-24 16:52:34.011 CEST2020/10/24 14:52:34 error listing schema dir:open /etc/temporal/schema/postgres/visibility/versioned: no such file or directory\r\n\r\n2020-10-24 16:52:34.014 CEST+ '[' true '!=' true ']'\r\n\r\n2020-10-24 16:52:34.014 CEST+ '[' false == true ']'\r\n\r\n2020-10-24 16:52:34.014 CEST+ exec bash /start-temporal.sh\r\n\r\n2020-10-24 16:52:34.024 CEST+ dockerize -template /etc/temporal/config/config_template.yaml:/etc/temporal/config/docker.yaml\r\n\r\n2020-10-24 16:52:34.048 CEST+ exec temporal-server --root /etc/temporal --env docker start --services=history,matching,frontend,worker\r\n\r\n2020-10-24 16:52:34.078 CEST2020/10/24 14:52:34 Loading config; env=docker,zone=,configDir=/etc/temporal/config\r\n\r\n2020-10-24 16:52:34.078 CEST2020/10/24 14:52:34 Loading config files=[/etc/temporal/config/docker.yaml]\r\n\r\n2020-10-24 16:52:34.102 CESTUnable to start server: sql schema version compatibility check failed: version mismatch for keyspace/database: \"temporal\". Expected version: 1.1 cannot be greater than Actual version: 0.0.\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n```yaml\r\n   spec:\r\n      containerConcurrency: 80\r\n      timeoutSeconds: 300\r\n      containers:\r\n      - image: temporalio/auto-setup@1.1.1\r\n        ports:\r\n        - containerPort: 7233\r\n        env:\r\n        - name: LOG_LEVEL\r\n          value: INFO\r\n        - name: AUTO_SETUP\r\n          value: 'TRUE'\r\n        - name: DB\r\n          value: postgres\r\n        - name: DB_PORT\r\n          value: '5432'\r\n        - name: POSTGRES_USER\r\n          value: postgres\r\n        - name: POSTGRES_PWD\r\n          value: M4KaY8kpJ6fzM$2YGoiKx\r\n        - name: POSTGRES_SEEDS\r\n          value: 10.47.192.6\r\n        - name: SKIP_DEFAULT_NAMESPACE_CREATION\r\n          value: 'true'\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version:\r\n  - Platform:\r\n","closedAt":"2020-10-27T21:40:56Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDcxNTk3MjA3Mw==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"PostgreSQL is not officially supported.\n\nWe are doing necessary pre release tests and the official support is on the way.\n\nThe issue you are seeing is due the the move of the schema dir for better version control / support, similar to MySQL.","createdAt":"2020-10-24T16:25:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/896#issuecomment-715972073","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxNTk4MDIwMA==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"duplicate of #862 ","createdAt":"2020-10-24T16:36:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/896#issuecomment-715980200","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxNzU1NjgzMw==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"solved in 1.2.1 release\r\nhttps://github.com/temporalio/temporal/releases/tag/v1.2.1","createdAt":"2020-10-27T21:40:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/896#issuecomment-717556833","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6Nifoz","author":{"login":"jorgecuesta"},"authorAssociation":"NONE","body":"A side note for those that could came later on time here like me, check the `admin-tools` and `server` versions are on the same range, like `1.25` (at the start of the name) because that was the issue for me.\r\nMy `admin-tools` was on `1.24` and the server was on `1.25`. The chart uses the `admin-tool.image.tag` because use the same docker image for the database/schema setup.","createdAt":"2024-09-25T16:54:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/896#issuecomment-2374629939","viewerDidAuthor":false}],"createdAt":"2020-10-24T15:41:57Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":896,"reactionGroups":[],"state":"CLOSED","title":"sql schema version compatibility check failed","updatedAt":"2024-09-25T16:54:51Z","url":"https://github.com/temporalio/temporal/issues/896"}
