{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjYyMzYzMzA=","is_bot":false,"login":"kfoxb","name":"Kyle Bradford"},"body":"## Expected Behavior\r\nAdding the correct endpoint, port, and scheme to the config pointing to an aws elasticsearch instance should connect and allow advanced visibility features.\r\n\r\n## Actual Behavior\r\nTemporal shuts down and an error is reported:\r\n`error creating elastic search client: context deadline exceeded`\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create an aws elasticsearch cluster (https://aws.amazon.com/elasticsearch-service/)\r\n  1. Use the connection information from the cluster in your Temporal config. I'm using the helm chart for this.\r\n  1. Deploy Temporal\r\n\r\n## Specifications\r\n\r\n  - Version: v0.27.0\r\n  - Platform: Docker/Kubernetes\r\n\r\n## Additional Details\r\nAfter some research and trial and error I think I've found the problem. AWS only supports HTTP for their Elasticsearch instances on port 80 or port 443. Elasticsearch doesn't support sniffing on those particular ports, you need to be using TCP on port 9200.\r\n\r\nI found an issue with the upstream Elasticsearch client Temporal is using [here](https://github.com/olivere/elastic/issues/880). The solution proposed in that seemed to work for me. I added just this line `elastic.SetSniff(false)` when creating a new Elasticsearch client and I was able to connect.\r\n\r\nTo me it seems like the solution is to add a flag to the config to be able to disable this for customers that run Elasticsearch on port 80/443, but I'm opening this issue to see if there are other solutions that may be better.","closedAt":"2021-02-17T00:53:00Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc4MDIxNjI1MQ==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Sniffing is disable by default in Temporal. We may add config param later.","createdAt":"2021-02-17T00:53:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/621#issuecomment-780216251","viewerDidAuthor":false}],"createdAt":"2020-07-28T17:54:39Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":621,"reactionGroups":[{"content":"ROCKET","users":{"totalCount":2}}],"state":"CLOSED","title":"Unable to connect to AWS hosted elasticsearch","updatedAt":"2021-02-17T00:53:00Z","url":"https://github.com/temporalio/temporal/issues/621"}
