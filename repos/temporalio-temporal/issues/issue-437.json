{"assignees":[{"id":"MDQ6VXNlcjU1NTIzODE=","login":"mastermanu","name":"","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"## Expected Behavior\r\nChild workflow is retried on failures if retryPolicy is set.\r\n\r\n## Actual Behavior\r\nChild workflow fails without retry. It is retried if retryPolicy.maximumAttempts is set.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a child workflow that always returns an error with retryPolicy withy 0 maximumAttempts.\r\n  1. Execute child from a parent\r\n  1. Witness that the child is not retried.\r\n\r\n## Specifications\r\n\r\n  - Version: temporalio/auto-setup:0.23.1\r\n  - Platform: mac\r\n","closedAt":"2020-08-04T18:38:46Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY2NzI4Mzg4OQ==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"Can you try to reproduce with latest bits.  Close if it does not otherwise move to stabilization.","createdAt":"2020-07-31T18:21:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/437#issuecomment-667283889","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY2NzMwNjI5Nw==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"Behavior is confirmed on latest master:\r\n\r\n\tcwo := workflow.ChildWorkflowOptions{\r\n\t\tWorkflowID:               \"sanity-\" + pandemicType + \"-\" + workflow.Now(ctx).Format(time.RFC3339),\r\n\t\tWorkflowExecutionTimeout: time.Second * time.Duration(targetTimeInSeconds+10),\r\n\t\tRetryPolicy: &temporal.RetryPolicy{\r\n\t\t\tInitialInterval: time.Second * 1, <-- retries even if 0 if others are set\r\n\t\t\tMaximumAttempts: 0, <-- no retries if 0, but if I set it to 5, it retries 5 times.\r\n\t\t\tMaximumInterval: time.Second * 5, <-- retries even if 0 if others are set\r\n\t\t},\r\n\t}\r\n\r\nAlso no retries if MaximumAttempts is set and both InitialInterval and MaximumInterval is set to 0\r\nWe need to basically set intelligent defaults for ChildWorkflowOptions on the server.\r\n\r\nFurthermore, go client appears to be setting BackOffCoefficient of 2:\r\n\r\nfunc convertRetryPolicy(retryPolicy *RetryPolicy) *commonpb.RetryPolicy {\r\n\tif retryPolicy == nil {\r\n\t\treturn nil\r\n\t}\r\n\tif retryPolicy.BackoffCoefficient == 0 {\r\n\t\tretryPolicy.BackoffCoefficient = backoff.DefaultBackoffCoefficient\r\n\t}\r\n\treturn &commonpb.RetryPolicy{\r\n\t\tMaximumIntervalInSeconds: common.Int32Ceil(retryPolicy.MaximumInterval.Seconds()),\r\n\t\tInitialIntervalInSeconds: common.Int32Ceil(retryPolicy.InitialInterval.Seconds()),\r\n\t\tBackoffCoefficient:       retryPolicy.BackoffCoefficient,\r\n\t\tMaximumAttempts:          retryPolicy.MaximumAttempts,\r\n\t\tNonRetryableErrorTypes:   retryPolicy.NonRetryableErrorTypes,\r\n\t}\r\n}\r\n\r\nWe should remove this and rely on the server settings ideally.\r\n","createdAt":"2020-07-31T19:11:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/437#issuecomment-667306297","viewerDidAuthor":false}],"createdAt":"2020-06-06T19:21:30Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":{"number":2,"title":"Code Complete","description":"","dueOn":"2020-07-31T00:00:00Z"},"number":437,"reactionGroups":[],"state":"CLOSED","title":"Child workflow is not retried if retryPolicy.maximumAttempts is not set","updatedAt":"2020-08-04T18:38:46Z","url":"https://github.com/temporalio/temporal/issues/437"}
