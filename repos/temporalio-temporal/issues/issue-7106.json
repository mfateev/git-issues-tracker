{"assignees":[],"author":{"id":"U_kgDOCQB52w","is_bot":false,"login":"synack-mdevy","name":""},"body":"## Expected Behavior\nWhen running temporal with an external PostgreSQL backend, and the namespace doesn't currently exist\n\n```sh\ntctl n l\nName: temporal-system\nId: 32049b68-7872-4094-8e63-d0dd59896a83\nDescription: Temporal internal system namespace\nOwnerEmail: temporal-core@temporal.io\nNamespaceData: map[string]string(nil)\nState: Registered\nRetention: 168h0m0s\nActiveClusterName: active\nClusters: active\nHistoryArchivalState: Disabled\nIsGlobalNamespace: false\nFailoverVersion: 0\nFailoverHistory: []\nVisibilityArchivalState: Disabled\nBad binaries to reset:\n+-----------------+----------+------------+--------+\n| BINARY CHECKSUM | OPERATOR | START TIME | REASON |\n+-----------------+----------+------------+--------+\n+-----------------+----------+------------+--------+\nName: default\nId: db457208-1382-4c4c-989e-da784c6e329a\nDescription:\nOwnerEmail:\nNamespaceData: map[string]string(nil)\nState: Registered\nRetention: 1h0m0s\nActiveClusterName: active\nClusters: active\nHistoryArchivalState: Enabled\nIsGlobalNamespace: false\nFailoverVersion: 0\nFailoverHistory: []\nHistoryArchivalURI: <REDACTED>\nVisibilityArchivalState: Enabled\nVisibilityArchivalURI: <REDACTED>\nBad binaries to reset:\n+-----------------+----------+------------+--------+\n| BINARY CHECKSUM | OPERATOR | START TIME | REASON |\n+-----------------+----------+------------+--------+\n+-----------------+----------+------------+--------+\n```\n\nWhen running \n```sh\ntctl n re test\n```\n\nIt should create the namespace `test`\n\n## Actual Behavior\nInstead I get this error\n\n```sh\nError: Register namespace operation failed.\nError Details: rpc error: code = AlreadyExists desc = Namespace already exists.\n('export TEMPORAL_CLI_SHOW_STACKS=1' to see stack traces)\n```\n\nRe-running with TEMPORAL_CLI_SHOW_STACKS=1\n\n```sh\n tctl n re test\nError: Register namespace operation failed.\nError Details: rpc error: code = AlreadyExists desc = Namespace already exists.\nStack trace:\ngoroutine 1 [running]:\nruntime/debug.Stack()\n        /opt/hostedtoolcache/go/1.22.3/x64/src/runtime/debug/stack.go:24 +0x5e\nruntime/debug.PrintStack()\n        /opt/hostedtoolcache/go/1.22.3/x64/src/runtime/debug/stack.go:16 +0x13\ngithub.com/temporalio/tctl/cli_curr.printError({0x19b0e08, 0x24}, {0x1edb400, 0xc000718098})\n        /home/runner/work/docker-builds/docker-builds/tctl/cli_curr/util.go:393 +0x218\ngithub.com/temporalio/tctl/cli_curr.ErrorAndExit({0x19b0e08?, 0x1eeeb50?}, {0x1edb400?, 0xc000718098?})\n        /home/runner/work/docker-builds/docker-builds/tctl/cli_curr/util.go:404 +0x25\ngithub.com/temporalio/tctl/cli_curr.(*namespaceCLIImpl).RegisterNamespace(0xc0007be618, 0xc00016e420)\n        /home/runner/work/docker-builds/docker-builds/tctl/cli_curr/namespaceCommands.go:140 +0x92b\ngithub.com/temporalio/tctl/cli_curr.newNamespaceCommands.func1(0xc00016e420)\n        /home/runner/work/docker-builds/docker-builds/tctl/cli_curr/namespace.go:77 +0x4c\ngithub.com/urfave/cli.HandleAction({0x16ba300?, 0x1a54110?}, 0x8?)\n        /home/runner/go/pkg/mod/github.com/urfave/cli@v1.22.10/app.go:526 +0x75\ngithub.com/urfave/cli.Command.Run({{0x197527e, 0x8}, {0x0, 0x0}, {0xc000618ce0, 0x1, 0x1}, {0x199aa05, 0x1b}, {0x0, ...}, ...}, ...)\n        /home/runner/go/pkg/mod/github.com/urfave/cli@v1.22.10/command.go:173 +0x685\ngithub.com/urfave/cli.(*App).RunAsSubcommand(0xc0005028c0, 0xc00016e000)\n        /home/runner/go/pkg/mod/github.com/urfave/cli@v1.22.10/app.go:405 +0xdfb\ngithub.com/urfave/cli.Command.startApp({{0x1977538, 0x9}, {0x0, 0x0}, {0xc000619230, 0x1, 0x1}, {0x1998873, 0x1a}, {0x0, ...}, ...}, ...)\n        /home/runner/go/pkg/mod/github.com/urfave/cli@v1.22.10/command.go:378 +0xb1e\ngithub.com/urfave/cli.Command.Run({{0x1977538, 0x9}, {0x0, 0x0}, {0xc000619230, 0x1, 0x1}, {0x1998873, 0x1a}, {0x0, ...}, ...}, ...)\n        /home/runner/go/pkg/mod/github.com/urfave/cli@v1.22.10/command.go:102 +0x7c5\ngithub.com/urfave/cli.(*App).Run(0xc000502540, {0xc00003e0c0, 0x4, 0x4})\n        /home/runner/go/pkg/mod/github.com/urfave/cli@v1.22.10/app.go:277 +0xb3b\nmain.main()\n        /home/runner/work/docker-builds/docker-builds/tctl/cmd/tctl/main.go:47 +0xa5\n```\n\n## Steps to Reproduce the Problem\n\n  1. Run temporal with an external PostgreSQL database\n  2. Use tctl to create 1 namespace `default` (succeeds)\n  3. Use tctl to create a 2nd namespace `test` (fails)\n\n## Specifications\n\n  - Version: 1.25.1\n  - Platform: Self-hosted (K8s) \n","closedAt":"2025-01-24T05:22:16Z","comments":[{"id":"IC_kwDODNqesM6bo89D","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"This isn't a server bug, it's misuse of the `tctl` command (which is deprecated by the way), could you try with the newer `temporal` [CLI](https://docs.temporal.io/cli) and see if you get a better experience?\n\nWe could also include the namespace name in the error message from the server to be more helpful for when this happens next time.","createdAt":"2025-01-23T23:13:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7106#issuecomment-2611203907","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6b7AMm","author":{"login":"synack-mdevy"},"authorAssociation":"NONE","body":"> This isn't a server bug, it's misuse of the `tctl` command (which is deprecated by the way), could you try with the newer `temporal` [CLI](https://docs.temporal.io/cli) and see if you get a better experience?\n> \n> We could also include the namespace name in the error message from the server to be more helpful for when this happens next time.\n\nPerfect, this solved the issue, I didn't realise tctl was deprecated. Thank you for the information!","createdAt":"2025-01-27T14:37:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7106#issuecomment-2615935782","viewerDidAuthor":false}],"createdAt":"2025-01-17T14:10:34Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7106,"reactionGroups":[],"state":"CLOSED","title":"Unable to register more than one namespace","updatedAt":"2025-01-27T14:37:32Z","url":"https://github.com/temporalio/temporal/issues/7106"}
