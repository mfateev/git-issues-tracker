{"assignees":[],"author":{"id":"U_kgDOCJUwfQ","is_bot":false,"login":"xtyinbiao","name":"尹彪"},"body":"## Expected Behavior\r\nthis is create schedule function:\r\n\r\npublic String createSchedule(TemporalScheduleBO temporalScheduleBO) {\r\n        try {\r\n            ScheduleClient client = ScheduleClient.newInstance(\r\n                    service(), ScheduleClientOptions.newBuilder().setNamespace(temporalScheduleBO.getNamespace()).build());\r\n\r\n            Schedule schedule =\r\n                    Schedule.newBuilder()\r\n                            .setAction(ScheduleActionStartWorkflow.newBuilder()\r\n                                    .setArguments(temporalScheduleBO.getParams())\r\n                                    .setWorkflowType(temporalScheduleBO.getWorkflowTypeName())\r\n                                    .setOptions(WorkflowOptions.newBuilder()\r\n                                            .setTaskQueue(temporalScheduleBO.getTaskQueueName())\r\n                                            .setWorkflowId(temporalScheduleBO.getWorkflowId())\r\n                                            .build())\r\n                                    .build())\r\n                            .setSpec(ScheduleSpec.newBuilder()\r\n                                    .setCronExpressions(temporalScheduleBO.getCronString())\r\n//                                    .setIntervals(temporalScheduleBO.getInterval())\r\n//                                    .setCalendars(temporalScheduleBO.getCalendar())\r\n                                    .build())\r\n                            .setPolicy(SchedulePolicy.newBuilder()\r\n                                    .setOverlap(ScheduleOverlapPolicy.SCHEDULE_OVERLAP_POLICY_ALLOW_ALL)\r\n                                    .setCatchupWindow(Duration.ofSeconds(30))\r\n                                    .build())\r\n                            .setState(ScheduleState.newBuilder()\r\n                                    .setLimitedAction(false)\r\n                                    .setRemainingActions(30)\r\n                                    .build())\r\n                            .build();\r\n\r\n            ScheduleHandle handle =\r\n                    client.createSchedule(temporalScheduleBO.getName(), schedule, ScheduleOptions.newBuilder().build());\r\n            return handle.getId();\r\n\r\n        } catch (ScheduleAlreadyRunningException e) {\r\n            log.info(\"schedule already exists, is running, skip create: {}\", temporalScheduleBO.getWorkflowId());\r\n            return temporalScheduleBO.getName();\r\n        } catch (ScheduleException e) {\r\n            if(e.getCause().getMessage().contains(\"ALREADY_EXISTS\")) {\r\n                log.info(\"schedule already exists, skip create: {}\", temporalScheduleBO.getWorkflowId());\r\n                return temporalScheduleBO.getName();\r\n            } else {\r\n                throw e;\r\n            }\r\n        }\r\n    }\r\n\r\nExpect to run every 5 minutes\r\n\r\n\r\n\r\n## Actual Behavior\r\nRandomly miss a run\r\n\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.\r\n  1.\r\n  1.\r\n\r\n## Specifications\r\n\r\n  - Version: 2.22.3\r\n  - Platform: Linux temporal-worker-5f4dfdbb94-dfv8l 5.4.228-1.el7.elrepo.x86_64 #1 SMP Thu Dec 15 18:03:40 EST 2022 x86_64 Linux\r\n","closedAt":"2024-11-17T02:40:58Z","comments":[{"id":"IC_kwDODNqesM6TsYX_","author":{"login":"xtyinbiao"},"authorAssociation":"NONE","body":"![9684309E-1BD3-4ED1-A686-B3F483A6886B](https://github.com/user-attachments/assets/e2d43040-ecec-4e74-b257-f19b66ca456b)\r\n","createdAt":"2024-11-15T03:34:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6820#issuecomment-2477884927","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6Tvu51","author":{"login":"xtyinbiao"},"authorAssociation":"NONE","body":"{\"level\":\"warn\",\"ts\":\"2024-11-15T12:56:18.462Z\",\"msg\":\"Schedule missed catchup window\",\"service\":\"worker\",\"Namespace\":\"eagleeye\",\"TaskQueue\":\"temporal-sys-per-ns-tq\",\"WorkerID\":\"server-worker@1@temporal-worker-86d8bb7b8c-jhrdp@eagleeye\",\"WorkflowType\":\"temporal-sys-scheduler-workflow\",\"WorkflowID\":\"temporal-sys-scheduler:18910#shprod\",\"RunID\":\"473bc143-08d9-41d5-9d75-c91d96fae837\",\"Attempt\":1,\"wf-namespace\":\"eagleeye\",\"schedule-id\":\"18910#shprod\",\"now\":\"2024-11-15T12:56:18.226Z\",\"time\":\"2024-11-15T12:55:00.000Z\",\"logging-call-at\":\"workflow.go:223\"}\r\n\r\nhow to avoid Schedule missed？","createdAt":"2024-11-15T13:01:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6820#issuecomment-2478763637","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6TzKpF","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"Please use the forums https://community.temporal.io/ or slack https://t.mp/slack for support.\r\n\r\nIt looks like your cluster has significant performance problems if it's regularly starting scheduled workflows 5 or 6 or 14 seconds after the scheduled time. It's not too surprising that sometimes the delay might exceed the 30 second catchup window that you set. Take a look at some of the self-hosted scaling resources like https://temporal.io/blog/scaling-temporal-the-basics\r\n\r\nIf you have a large number of schedules in your namespace, you can tune the internal worker similarly to an external worker using the dynamic config setting `worker.perNamespaceWorkerOptions`","createdAt":"2024-11-15T18:20:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/6820#issuecomment-2479663685","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6T08kK","author":{"login":"xtyinbiao"},"authorAssociation":"NONE","body":"> Please use the forums https://community.temporal.io/ or slack https://t.mp/slack for support.\r\n> \r\n> It looks like your cluster has significant performance problems if it's regularly starting scheduled workflows 5 or 6 or 14 seconds after the scheduled time. It's not too surprising that sometimes the delay might exceed the 30 second catchup window that you set. Take a look at some of the self-hosted scaling resources like https://temporal.io/blog/scaling-temporal-the-basics\r\n> \r\n> If you have a large number of schedules in your namespace, you can tune the internal worker similarly to an external worker using the dynamic config setting `worker.perNamespaceWorkerOptions`\r\n\r\nwhen i set setJitter(Duration.ofSeconds(30)) then no missed, it's should be heavy load.  \r\nAt first I set up backfill but it had no effect.  \r\nIs there any way to accept delays to avoid missing out rather than scaling ？\r\n\r\n","createdAt":"2024-11-15T23:35:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6820#issuecomment-2480130314","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6T1EVV","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"`setCatchupWindow(Duration.ofSeconds(30))` means \"don't start a workflow if it would be more than 30 seconds late\". You can leave that at the default (1 year) and then you'll just get a longer delay if the cluster is overloaded.","createdAt":"2024-11-15T23:57:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6820#issuecomment-2480162133","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6T34HQ","author":{"login":"xtyinbiao"},"authorAssociation":"NONE","body":"> `setCatchupWindow(Duration.ofSeconds(30))` means \"don't start a workflow if it would be more than 30 seconds late\". You can leave that at the default (1 year) and then you'll just get a longer delay if the cluster is overloaded.\r\n\r\nThank you very much for your reply","createdAt":"2024-11-17T02:40:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6820#issuecomment-2480898512","viewerDidAuthor":false}],"createdAt":"2024-11-15T03:31:26Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":6820,"reactionGroups":[],"state":"CLOSED","title":"Schedule workflow randomly skipping execution cycles","updatedAt":"2024-11-17T02:40:58Z","url":"https://github.com/temporalio/temporal/issues/6820"}
