{"assignees":[],"author":{"id":"U_kgDODAjaog","is_bot":false,"login":"vy-kauppinen","name":"Vy Kauppinen"},"body":"### Describe the bug\n\nI'm trying to deploy Temporal with our persistence PostgreSQL on our cloud service. I managed to set up the databases and schema for Temporal. However, when I run the worker and set up a Temporal Schedule, the workflow fails, and the UI continues to return the error message: \"Unable to query workflow due to Workflow Task in failed state.\" I'm not sure what's causing this issue. I tried switching to MySQL, and after some time, the issue also occurred.\n\n#### values.postgresql.yaml\n\n```yaml\nserver:\n  config:\n    persistence:\n      default:\n        driver: \"sql\"\n\n        sql:\n          driver: \"postgres12\"\n          host: MY_HOST_IP\n          port: 5432\n          database: temporal\n          user: temporal\n          password: PASSWORD\n          # for a production deployment use this instead of `password` and provision the secret beforehand e.g. with a sealed secret\n          # it has a single key called `password`\n          # existingSecret: temporal-default-store\n          maxConns: 20\n          maxIdleConns: 20\n          maxConnLifetime: \"1h\"\n          # tls:\n          #  enabled: true\n          #  enableHostVerification: true\n          #  serverName: _HOST_ # this is strictly required when using serverless CRDB offerings\n          #  caFile: /path/to/certs/<CA-file> # Here we assumed that caFile, certFile, keyFile are stored in one secret mounted as 'secret-with-certs' (see: server.additionalVolumes and server.additionalVolumeMounts sections).\n          #  certFile: /path/to/certs/<client-cert-file>\n          #  keyFile: /path/to/certs/<client-key-file>\n\n      visibility:\n        driver: \"sql\"\n\n        sql:\n          driver: \"postgres12\"\n          host: MY_HOST_IP\n          port: 5432\n          database: temporal_visibility\n          user: temporal\n          password: MY_PASSWORD\n          # for a production deployment use this instead of `password` and provision the secret beforehand e.g. with a sealed secret\n          # it has a single key called `password`\n          # existingSecret: temporal-visibility-store\n          maxConns: 20\n          maxIdleConns: 20\n          maxConnLifetime: \"1h\"\n          # tls:\n          #  enabled: true\n          #  enableHostVerification: true\n          #  serverName: _HOST_ # this is strictly required when using serverless CRDB offerings\n          #  caFile: /path/to/certs/<CA-file> # Here we assumed that caFile, certFile, keyFile are stored in one secret mounted as 'secret-with-certs' (see: server.additionalVolumes and server.additionalVolumeMounts sections).\n          #  certFile: /path/to/certs/<client-cert-file>\n          #  keyFile: /path/to/certs/<client-key-file>\n\n  # additionalVolumes:\n  #   - name: secret-with-certs\n  #     secret:\n  #       secretName: secret-with-certs\n  # additionalVolumeMounts:\n  #   - name: secret-with-certs\n  #     mountPath: /path/to/certs/\n\ncassandra:\n  enabled: false\n\nmysql:\n  enabled: false\n\npostgresql:\n  enabled: true\n\nprometheus:\n  enabled: false\n\ngrafana:\n  enabled: false\n  \nelasticsearch:\n  enabled: false\n\nschema:\n  createDatabase:\n    enabled: true\n  setup:\n    enabled: false\n  update:\n    enabled: false\n\n```\n\n<img width=\"1682\" height=\"182\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/9e07d378-1478-4822-8174-8e4b179b53aa\" />\n\n####Response\n\n```json\n{\n  \"code\": 9,\n  \"message\": \"Unable to query workflow due to Workflow Task in failed state.\",\n  \"details\": [\n    {\n      \"@type\": \"type.googleapis.com/temporal.api.errordetails.v1.WorkflowNotReadyFailure\"\n    }\n  ]\n}\n\n```\n\n### Minimal Reproduction\n\n# Create and initialize database\n# in https://github.com/temporalio/temporal git repo dir\nexport SQL_PLUGIN=postgres12\nexport SQL_HOST=postgresql_host\nexport SQL_PORT=5432\nexport SQL_USER=temporal\nexport SQL_PASSWORD=postgresql_password\n\nmake temporal-sql-tool\n\n./temporal-sql-tool --database temporal create-database\nSQL_DATABASE=temporal ./temporal-sql-tool setup-schema -v 0.0\nSQL_DATABASE=temporal ./temporal-sql-tool update -schema-dir schema/postgresql/v12/temporal/versioned\n\n./temporal-sql-tool --database temporal_visibility create-database\nSQL_DATABASE=temporal_visibility ./temporal-sql-tool setup-schema -v 0.0\nSQL_DATABASE=temporal_visibility ./temporal-sql-tool update -schema-dir schema/postgresql/v12/visibility/versioned\n\n\n# I had to grant permission for temporal user for schema for each database\nGRANT ALL ON SCHEMA public TO temporal;\nGRANT ALL ON ALL TABLES IN SCHEMA public TO temporal;\nGRANT ALL ON ALL SEQUENCES IN SCHEMA public TO temporal;\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO temporal;\nGRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO temporal;\nALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO temporal;\nALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO temporal;\n\n\nhelm install -f ./temporal/values/values.postgresql.yaml temporal ./temporal --timeout 900s\n\nkubectl --namespace=default get pods -l \"app.kubernetes.io/instance=temporal\"\n\n\nkubectl port-forward services/temporal-frontend 7233:7233\n\nkubectl port-forward services/temporal-web 8080:8080\n\n### Environment/Versions\n\n<!-- Please complete the following information where relevant. -->\n\n- OS and processor: Linux\n- Temporal Version: 1.29.1\n- Are you using Docker or Kubernetes or building Temporal from source? - Kubernetes\n\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM7eHHp5","author":{"login":"gow"},"authorAssociation":"MEMBER","body":"Looks like there is something wrong with the temporal scheduler. \nCould you please do the following?\n1. Query the workflow list with this query.`TemporalNamespaceDivision = \"TemporalScheduler\"` (make sure to switch to manual query mode in the UI). This will show internal scheduler workflows. \n2. Once you have this please identify the internal scheduler workflow (this would contain your schedule-id). \n3. Check its history and please report so that we can continue the debugging?","createdAt":"2026-01-08T23:48:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8864#issuecomment-3726408313","viewerDidAuthor":false}],"createdAt":"2025-12-18T09:00:33Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":8864,"reactionGroups":[],"state":"OPEN","title":"Workflow cannot run with the dedicated cloud PostgreSQL: \"Unable to query workflow due to Workflow Task in failed state.\"","updatedAt":"2026-01-08T23:48:56Z","url":"https://github.com/temporalio/temporal/issues/8864"}
