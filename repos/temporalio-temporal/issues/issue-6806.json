{"assignees":[],"author":{"id":"MDQ6VXNlcjM3OTIzMzEw","is_bot":false,"login":"mikellxy","name":""},"body":"hi, I apologize for using an issue to seek help.\r\n\r\n## Expected Behavior\r\nIn my workflow worker, firstly I start a timer to wait for the biz data to be ready. Then 1,000 activies are submitted, i expected that all these activities can be scheduled and run asynchronously after the submission. Then I wait for the results of the 1,000 Future object like a wait group model. \r\n\r\nThis is a simplified version of my code:\r\n```go\r\nfunc (w *Worker) Start(wfCtx workflow.Context, req *Req) (result string, err error) {\r\n\tif err := workflow.Sleep(wfCtx, 30*time.Second); err != nil {\r\n\t\treturn err.Error(), err\r\n\t}\r\n        // submit 1000 activities\r\n        var futures []workflow.Future\r\n\tfor i:=0;i<1000;i++ {\r\n                 f := workflow.ExecuteActivity(wfCtx, w.Act, req, i)\r\n\t         futures = append(futures, f)\r\n\t}\r\n        //  Wait for all tasks to run successfully\r\n\tfor _, f := range futures {\r\n\t\tres := new(Result)\r\n\t\terr := f.Get(wfCtx, res)\r\n\t\tif err != nil {\r\n\t\t\treturn err.Error(), err\r\n\t\t}\r\n\t\tif res.KnownErr != \"\" {\r\n\t\t\tlogger.Info(\"known error: %v, workflow can return directly\")\r\n\t\t\treturn res.KnownErr, nil\r\n\t\t}\r\n\t}\r\n}\r\n```\r\nthe activity options as follow:  \r\n```go\r\nfunc (w *Worker) GetActivityContext(wfCtx workflow.Context) workflow.Context {\r\n\treturn workflow.WithActivityOptions(wfCtx, workflow.ActivityOptions{\r\n\t\tScheduleToCloseTimeout: time.Hour,\r\n\t\tStartToCloseTimeout:    time.Hour,\r\n\t\tWaitForCancellation:    false,\r\n\t\tRetryPolicy: &temporal.RetryPolicy{\r\n\t\t\tMaximumAttempts:        20,         \r\n\t\t\tNonRetryableErrorTypes: []string{}, \r\n\t\t},\r\n\t})\r\n}\r\n```\r\nthe workflow options:  \r\n```json\r\n\"start_workflow_options\": {\r\n            \"workflow_run_timeout\": \"1d\",\r\n            \"workflow_task_timeout\": \"90m\",\r\n            \"retry_policy\": {\r\n              \"initial_interval\": \"1s\",\r\n              \"backoff_coefficient\": 2.0,\r\n              \"maximum_interval\": \"1h\",\r\n              \"maximum_attempts\": 3\r\n            }\r\n          }\r\n```\r\nthe worker options:  \r\n```json\r\n\"options\": {\r\n            \"max_concurrent_activity_execution_size\": 10\r\n          }\r\n```\r\n\r\n## Actual Behavior\r\nIt reports WorkflowTaskTimeOut, and none of the activities was scheduled. \r\nThe timeline is as follow:\r\n1. WorkflowExecutionStarted\r\n2. WorkflowTaskScheduled\r\n3. WorkflowTaskStarted\r\n4. WorkflowTaskCompleted\r\n5. TimerStarted\r\n6. TimerFired\r\n7. WorkflowTaskScheduled  (happend at time T)\r\n8. WorkflowTaskStarted\r\n9. WorkflowTaskTimedOut (happend at time T+2 minutes, timeout Type was StartToClose. but my activities' StartToCloseTimeout option is one hour)\r\n\r\np.s. if i reduce the number of activities to 100, all the activities run successfully.\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.\r\n  1.\r\n  1.\r\n\r\n## Specifications\r\n\r\n  - Version:\r\n  - Platform:\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM6TrXgH","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"There's a hard coded 4 MB limit for a gRPC response. If the accumulated size of the schedule activity commands goes above that limit the RespondWorkflowTaskCompleted request will be rejected and it will manifest as a timeout.\r\n\r\nThis is a known issue without a good mitigation today.\r\nPlease confirm this theory, there may be some logs emitted by the Go SDK.\r\nAs a workaround, you can add a sleep after every 100 activities scheduled.","createdAt":"2024-11-14T23:30:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6806#issuecomment-2477619207","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6Trfai","author":{"login":"drewhoskins-temporal"},"authorAssociation":"MEMBER","body":"There's a feature request open for a possible fix to this issue: https://github.com/temporalio/features/issues/363","createdAt":"2024-11-14T23:55:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6806#issuecomment-2477651618","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7JX8-F","author":{"login":"garfieldnate"},"authorAssociation":"NONE","body":">As a workaround, you can add a sleep after every 100 activities scheduled.\n\n@bergundy How long of a sleep is required? Or, just a sleep(0) to allow a message-sending task to take precedent?","createdAt":"2025-10-07T19:54:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6806#issuecomment-3378499461","viewerDidAuthor":false}],"createdAt":"2024-11-13T11:59:23Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":6806,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":3}}],"state":"OPEN","title":"WorkflowTaskTimedOut if submiting a large number of activiteis within one workflow","updatedAt":"2025-10-07T19:54:47Z","url":"https://github.com/temporalio/temporal/issues/6806"}
