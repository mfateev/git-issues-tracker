{"assignees":[],"author":{"id":"MDQ6VXNlcjQyNjYwMw==","is_bot":false,"login":"itayd","name":"Itay Donanhirsh"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nWe need to run some function that might block for a while (up to 10s, usually) during a Temporal workflow. That function cannot receive a Temporal workflow context. It also has to run every time the workflow runs, including replays. Further operations during this workflow rely on this function being run first.\r\n\r\nCurrently when we do this, the deadlock detection mechanism panics.\r\n\r\n**Describe the solution you'd like**\r\n\r\nAllow to disable the deadlock detection for a specific scope. Possible just making https://github.com/temporalio/sdk-go/blob/master/internal/workflow_deadlock.go#L51 and its friend public.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nWe tried running the function in a separate go routine, and while it's running sleeping on Temporal. The problem is that this is non-deterministic, and we don't know how much Sleep we need to get.\r\n\r\n**Additional context**\r\n\r\nI initially really really really didn't want to open this issue. I really think that the deadlock detection is a Good Thing. I discussed this with @mfateev and Chad (no idea what's his alias here), and at the end came to a conclusion that there's no avoiding this.\r\n\r\n@mfateev suggested (ab)using the `DataConverterWithoutDeadlockDetection`, but I'd rather do it in a more polite fashion. ","closedAt":null,"comments":[{"id":"IC_kwDODNqesM6NQtUY","author":{"login":"itayd"},"authorAssociation":"NONE","body":"Just for fun, this is what I can do to abuse the data convertor:\r\n\r\n```go\r\n\r\nimport (\r\n\t\"context\"\r\n\r\n\tcommonpb \"go.temporal.io/api/common/v1\"\r\n\t\"go.temporal.io/sdk/workflow\"\r\n)\r\n\r\ntype deadlockDetectorAbuser func()\r\n\r\nfunc (deadlockDetectorAbuser) ToPayload(interface{}) (*commonpb.Payload, error)      { return nil, nil }\r\nfunc (deadlockDetectorAbuser) FromPayload(*commonpb.Payload, interface{}) error      { return nil }\r\nfunc (deadlockDetectorAbuser) ToPayloads(...interface{}) (*commonpb.Payloads, error) { return nil, nil }\r\nfunc (deadlockDetectorAbuser) FromPayloads(*commonpb.Payloads, ...interface{}) error { return nil }\r\nfunc (deadlockDetectorAbuser) ToString(*commonpb.Payload) string                     { return \"\" }\r\n\r\nfunc (dd deadlockDetectorAbuser) ToStrings(*commonpb.Payloads) []string {\r\n\tdd()\r\n\treturn nil\r\n}\r\n\r\nfunc WithoutDeadlockDetection(ctx workflow.Context, f func())  {\r\n\tcvt := workflow.DataConverterWithoutDeadlockDetection(deadlockDetectorAbuser(f))\r\n\tcvt = cvt.(workflow.ContextAware).WithWorkflowContext(ctx)\r\n\t_ = cvt.ToStrings(nil)\r\n}\r\n```\r\n\r\nedit: need to supply workflow context to the converter.","createdAt":"2024-09-24T02:09:29Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6546#issuecomment-2369967384","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6NQuZT","author":{"login":"itayd"},"authorAssociation":"NONE","body":"tbh, it's so ugly i kinda like it.","createdAt":"2024-09-24T02:14:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6546#issuecomment-2369971795","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6NRD97","author":{"login":"itayd"},"authorAssociation":"NONE","body":"Proposed https://github.com/temporalio/sdk-go/pull/1647.","createdAt":"2024-09-24T03:45:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6546#issuecomment-2370060155","viewerDidAuthor":false}],"createdAt":"2024-09-24T01:52:52Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":6546,"reactionGroups":[],"state":"OPEN","title":"Allow to disable workflow deadlock detector","updatedAt":"2024-10-02T07:39:08Z","url":"https://github.com/temporalio/temporal/issues/6546"}
