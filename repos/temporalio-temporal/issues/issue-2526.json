{"assignees":[],"author":{"id":"MDQ6VXNlcjUzMjEwOA==","is_bot":false,"login":"Spikhalskiy","name":"Dmitry Spikhalsky"},"body":"**Is your feature request related to a problem? Please describe.**\r\nOne specific Temporal workflow may be completely stuck because something causes Workflow Tasks to repetitively fail or timeout. \r\nSDKs don't report Workflow Task Timeout and generally do their best to avoid them. Hence, when Workflow Task Timeout happens, something went wrong on the SDK side and SDK shouldn't be trusted in this situation. Temporal Server enforces the timeout and should be responsible for producing the metric.\r\n\r\n**Describe the solution you'd like**\r\nTemporal Server already has LOGGING about some workflows reaching a threshold of workflow task timeouts in a row: \r\nhttps://github.com/temporalio/temporal/blob/61b9b65744e455d4a85681b117e8315287911621/service/history/workflow/workflow_task_state_machine.go#L763\r\nThis should be exposed as a metric reporting a number of workflows that have more than N failed workflow tasks in a row to simplify detection of this situation by the users.\r\nThis may also be exposed as a histogram where x is an amount of failed workflow tasks in a row and y is number of workflows to don't bring some artificial static system-wide limit that has to be reached before the metric is reported.\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM4-euIj","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"The # of attempts for a workflow task is emitted as a distribution on L759 in the linked file. Is that something you are looking for?","createdAt":"2022-02-22T21:43:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2526#issuecomment-1048240675","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-qhY-","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"The number of workflows can probably be estimated by the rate of a certain histogram bucket. It's not exact but should be very close.","createdAt":"2022-02-25T22:49:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2526#issuecomment-1051334206","viewerDidAuthor":false}],"createdAt":"2022-02-22T01:49:39Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":2526,"reactionGroups":[{"content":"EYES","users":{"totalCount":1}}],"state":"OPEN","title":"Metric on workflows not progressing because of repetitive Workflow Task Timeouts / Failures","updatedAt":"2023-03-03T20:20:40Z","url":"https://github.com/temporalio/temporal/issues/2526"}
