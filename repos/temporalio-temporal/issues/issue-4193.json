{"assignees":[],"author":{"id":"MDQ6VXNlcjQ4NjIzMzU3","is_bot":false,"login":"jixiezhixin","name":""},"body":"\r\nWhy does temporal call mysql so frequently, calling mysql more than 2000 times in 30 seconds, and it is under no-load conditions\r\n\r\nWill high-frequency operations cause excessive pressure on mysql?\r\n\r\n## Expected Behavior\r\nnomral operate mysql\r\n\r\n## Actual Behavior\r\nData are as follows\r\nSELECT count(user_host) as count_user,user_host from mysql.general_log group by user_host order by count_user DESC;\r\n\r\n±-----------±--------------------------------------------+\r\n| count_user | user_host |\r\n±-----------±--------------------------------------------+\r\n| 36772 | temporal[temporal] @ [10.131.136.10] |\r\n| 2625 | n9e_hbs[n9e_hbs] @ [10.131.136.10] |\r\n| 788 | [temporal] @ [10.131.136.10] |\r\n| 567 | root[root] @ localhost  |\r\n| 406 | keystone[keystone] @ [10.131.136.20] |\r\n| 306 | root[root] @ [10.131.136.10] |\r\n| 220 | n9e_mon[n9e_mon] @ [10.131.136.10] |\r\n| 112 | region_mgmt[region_mgmt] @ [10.131.136.10] |\r\n| 55 | [root] @ localhost  |\r\n| 19 | skyops[skyops] @ [10.131.136.20] |\r\n| 17 | atreus[atreus] @ [10.131.136.10] |\r\n| 14 | skyops[skyops] @ [10.131.136.10] |\r\n| 12 | atreus[atreus] @ [10.131.136.20] |\r\n| 7 | [keystone] @ [10.131.136.20] |\r\n| 3 | [skyops] @ [10.131.136.10] |\r\n| 2 | kingcobra[kingcobra] @ [10.131.136.10] |\r\n| 2 | [atreus] @ [10.131.136.20] |\r\n| 2 | [atreus] @ [10.131.136.10] |\r\n| 1 | [kingcobra] @ [10.131.136.10] |\r\n| 1 | [skyops] @ [10.131.136.20] |\r\n±-----------±--------------------------------------------+\r\n\r\n\r\n## Steps to Reproduce the Problem\r\nSELECT count(user_host) as count_user,user_host from mysql.general_log group by user_host order by count_user DESC;\r\n\r\n## Specifications\r\n\r\n  - Version: docker build 1.18.0\r\n  - Platform:\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5agBE_","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"How many shard do you have?\r\nEach shard will have some task pump to read DB peroidically for tasks to be processed. So if your shard count is too large it would have considerable overhead cost. \r\nCould you share some of the query statements to help understand what they are.","createdAt":"2023-04-21T21:15:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4193#issuecomment-1518342463","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6P0Me1","author":{"login":"jixiezhixin"},"authorAssociation":"NONE","body":"> How many shard do you have? Each shard will have some task pump to read DB peroidically for tasks to be processed. So if your shard count is too large it would have considerable overhead cost. Could you share some of the query statements to help understand what they are.\r\n\r\nI'm sorry for taking so long to reply.\r\ntctl admin cl describe\r\n{\r\n\"supportedClients\": {\r\n\"temporal-cli\": \"\\u003c2.0.0\",\r\n\"temporal-go\": \"\\u003c2.0.0\",\r\n\"temporal-java\": \"\\u003c2.0.0\",\r\n\"temporal-php\": \"\\u003c2.0.0\",\r\n\"temporal-server\": \"\\u003c2.0.0\",\r\n\"temporal-typescript\": \"\\u003c2.0.0\",\r\n\"temporal-ui\": \"\\u003c3.0.0\"\r\n},\r\n\"serverVersion\": \"1.22.7\",\r\n\"membershipInfo\": {\r\n\"currentHost\": {\r\n\"identity\": \"10.244.2.129:7233\"\r\n},\r\n\"reachableMembers\": [\r\n\"10.244.2.193:6934\",\r\n\"10.244.1.71:6933\",\r\n\"10.244.1.123:6935\",\r\n\"10.244.1.88:6939\",\r\n\"10.244.2.146:6935\",\r\n\"10.244.2.129:6933\",\r\n\"10.244.1.53:6934\",\r\n\"10.244.2.178:6935\",\r\n\"10.244.2.170:6933\",\r\n\"10.244.2.192:6934\",\r\n\"10.244.2.150:6939\",\r\n\"10.244.1.58:6939\"\r\n],\r\n\"rings\": [\r\n{\r\n\"role\": \"frontend\",\r\n\"memberCount\": 3,\r\n\"members\": [\r\n{\r\n\"identity\": \"10.244.1.71:7233\"\r\n},\r\n{\r\n\"identity\": \"10.244.2.129:7233\"\r\n},\r\n{\r\n\"identity\": \"10.244.2.170:7233\"\r\n}\r\n]\r\n},\r\n{\r\n\"role\": \"history\",\r\n\"memberCount\": 3,\r\n\"members\": [\r\n{\r\n\"identity\": \"10.244.1.53:7234\"\r\n},\r\n{\r\n\"identity\": \"10.244.2.193:7234\"\r\n},\r\n{\r\n\"identity\": \"10.244.2.192:7234\"\r\n}\r\n]\r\n},\r\n{\r\n\"role\": \"matching\",\r\n\"memberCount\": 3,\r\n\"members\": [\r\n{\r\n\"identity\": \"10.244.2.178:7235\"\r\n},\r\n{\r\n\"identity\": \"10.244.2.146:7235\"\r\n},\r\n{\r\n\"identity\": \"10.244.1.123:7235\"\r\n}\r\n]\r\n},\r\n{\r\n\"role\": \"worker\",\r\n\"memberCount\": 3,\r\n\"members\": [\r\n{\r\n\"identity\": \"10.244.1.88:7239\"\r\n},\r\n{\r\n\"identity\": \"10.244.1.58:7239\"\r\n},\r\n{\r\n\"identity\": \"10.244.2.150:7239\"\r\n}\r\n]\r\n}\r\n]\r\n},\r\n\"clusterId\": \"6e34652b-4564-4202-be62-cf1680157ec5\",\r\n\"clusterName\": \"active\",\r\n\"historyShardCount\": 512,\r\n\"persistenceStore\": \"mysql\",\r\n\"visibilityStore\": \"mysql,elasticsearch\",\r\n\"failoverVersionIncrement\": \"10\",\r\n\"initialFailoverVersion\": \"1\"\r\n}","createdAt":"2024-10-15T03:32:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4193#issuecomment-2412824501","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6P1gHh","author":{"login":"jixiezhixin"},"authorAssociation":"NONE","body":"same as https://community.temporal.io/t/large-number-of-database-calls-by-temporal-to-datastax-cassandra/6789/3","createdAt":"2024-10-15T08:00:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4193#issuecomment-2413167073","viewerDidAuthor":false}],"createdAt":"2023-04-20T03:02:45Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4193,"reactionGroups":[],"state":"OPEN","title":"High frequency query mysql","updatedAt":"2024-10-15T08:00:44Z","url":"https://github.com/temporalio/temporal/issues/4193"}
