{"assignees":[{"id":"MDQ6VXNlcjYzNTAzMDE=","login":"jbreiding","name":"Jeremy","databaseId":0}],"author":{"id":"MDQ6VXNlcjM2MDA3OTE5","is_bot":false,"login":"ai-zelenin","name":"ARTEM ZELENIN"},"body":"I try deploy temporal cluster on docker swarm(need concept proof(scalability/limitations) before we will use it in prod).\r\nKuber+helm too cumbersome for my laptop(and i have not too much expertise in it (i am developer not a devops))\r\nWe face problems with BIND_ON_IP (it sets only on one interface and cannot see requests from others) and\r\nTEMPORAL_BROADCAST_ADDRESS(we can not set a dns name as address(validation failure ringpop.go:75) can not understand reason for this restriction) \r\n\r\n**Probable solution**\r\nTEMPORAL_BROADCAST_ADDRESS(BroadcastAddress) can be dns name\r\nBIND_ON_IP is 0.0.0.0 by default\r\n\r\n\r\n**Alternatives solution**\r\nMaybe you can add a swarm config in docker-compose repo for concept proof purpose.\r\nSingle node deployment not enough to be sure in scalability and see bottlenecks. \r\n\r\nSorry for bothering))\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5AV7-s","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"I think its a good idea to have a sample for docker-compose in swarm mode.\r\n\r\nThese two settings have different meanings:\r\n\r\nBIND_ON_IP is the local IP address to bind on.\r\n0.0.0.0 represents all interfaces and is needed for containerized services.\r\nlocalhost in the context of a container process is not accessible to other containers, generally not exposed.\r\n\r\nTEMPORAL_BROADCAST_ADDRESS is the address that is reachable by other temporal services.\r\n\r\nTogether these settings enable the membership coordination.\r\n\r\nIn Kubernetes this is the pod IP address, I am not sure of the analog in docker swarm mode.\r\nThis is the IP that would be provided and showing the network the containers are connected to.\r\n\r\nI can see how an example would help make this clearer.\r\nI will have to dig around docker docs and see what I can come up with.","createdAt":"2022-03-25T22:36:31Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2630#issuecomment-1079492524","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AbC0w","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"This is the functionality from Kubernetes that enables this to work.\r\nhttps://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/\r\n\r\nI so far haven't been able to locate the docker equivalent. A DNS name is not going to be sufficient as this value needs to be unique per replica, this represents the IP reachable by other pods in the docker network.\r\n\r\nYou could allocate static IPs for each replica in the docker network, and then configure this per replica.\r\n\r\nTo be honest it is going to be more complicate than just using Kubernetes and helm.\r\n\r\nHave you given [k3d.io](https://k3d.io/v5.4.0/) a try?\r\n\r\n","createdAt":"2022-03-28T16:00:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2630#issuecomment-1080831280","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AeNeL","author":{"login":"ai-zelenin"},"authorAssociation":"NONE","body":"Make unique dns names much more simpler.\r\nIf broadcast address can accept a dns name i can just launch it without containers and set a bunch of names in /etc/hosts\r\nI think an application can not require for k8 or any other orchestrator for launching in local environment\r\nDevelopers rarely have such expertise. And i can not blame them)) k8 is not very developer friendly","createdAt":"2022-03-29T09:48:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2630#issuecomment-1081661323","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AfZLY","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Without containers and on a local system using `127.0.0.1` with different unique ports in the services section.\r\n\r\nDocker in swarm mode is where the problem occurs.\r\n\r\nYou do not `need` Kubernetes.\r\nRight now we have helm for helping simplify running temporal with multiple replicas in a production scenario.\r\n\r\nTemporal is a go binary and can be run without containers.","createdAt":"2022-03-29T14:52:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2630#issuecomment-1081971416","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5DhKhU","author":{"login":"Sanil2108"},"authorAssociation":"NONE","body":"@ai-zelenin I am also looking into similar issues, adding my two cents for adding DNS names for docker configuration if it helps anyone.\r\n\r\nYou can write a bit of code to resolve DNS names at container startup and set the appropriate value for `TEMPORAL_BROADCAST_ADDRESS`.\r\n\r\nFor example, I added these couple of lines of code in `entrypoint.sh`\r\n```\r\n: \"${TEMPORAL_BROADCAST_ADDRESS:=$(hostname -i)}\"\r\nexport TEMPORAL_BROADCAST_ADDRESS\r\n```","createdAt":"2022-05-20T10:59:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":2}}],"url":"https://github.com/temporalio/temporal/issues/2630#issuecomment-1132767316","viewerDidAuthor":false}],"createdAt":"2022-03-22T09:36:23Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":2630,"reactionGroups":[],"state":"OPEN","title":"DNS name in BroadcastAddress ","updatedAt":"2023-03-03T20:20:47Z","url":"https://github.com/temporalio/temporal/issues/2630"}
