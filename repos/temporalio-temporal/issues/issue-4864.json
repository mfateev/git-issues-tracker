{"assignees":[],"author":{"id":"MDQ6VXNlcjkxNjk0Nzk=","is_bot":false,"login":"smndtrl","name":"Simon"},"body":"## Expected Behavior\r\nTemporal Server starts with authz enabled\r\n\r\n## Actual Behavior\r\n\r\n```\r\ntemporal-server  | {\"level\":\"fatal\",\"ts\":\"2023-09-12T07:33:13.082Z\",\"msg\":\"error starting scanner\",\"service\":\"worker\",\"error\":\"Request unauthorized.\",\"logging-call-at\":\"service.go:501\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Fatal\\n\\t/home/builder/temporal/common/log/zap_logger.go:180\\ngo.temporal.io/server/service/worker.(*Service).startScanner\\n\\t/home/builder/temporal/service/worker/service.go:501\\ngo.temporal.io/server/service/worker.(*Service).Start\\n\\t/home/builder/temporal/service/worker/service.go:396\\ngo.uber.org/fx/internal/lifecycle.Wrap[...].func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/internal/lifecycle/lifecycle.go:80\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/internal/lifecycle/lifecycle.go:256\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/internal/lifecycle/lifecycle.go:216\\ngo.uber.org/fx.(*App).start.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/app.go:679\\ngo.uber.org/fx.(*App).withRollback\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/app.go:661\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/app.go:678\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.20.0/app.go:782\"}\r\n```\r\n## Steps to Reproduce the Problem\r\n\r\n* add\r\n```\r\n  global:\r\n  authorization:\r\n    authorizer: \"default\"\r\n    claimMapper: \"default\"\r\n    jwtKeyProvider:\r\n...\r\n```\r\n* `make start-dependencies`\r\n* `./temporal-server --env development start`\r\n\r\nor use `temporalio/server` docker image\r\n\r\n## Specifications\r\n\r\n  - Version: temporalio/server:latest\r\n  - Platform: linux/arm64\r\n","closedAt":"2023-09-12T19:36:11Z","comments":[{"id":"IC_kwDODNqesM5mTMUG","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"There's no (easy) way to get the worker role to pass a JWT that the frontend will accept. The most practical solution is to use internal-frontend so the worker connects to a different frontend that doesn't check JWT. See the \"Internal frontend\" section in the [1.20.0 release notes](https://github.com/temporalio/temporal/releases/tag/v1.20.0).","createdAt":"2023-09-12T19:36:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4864#issuecomment-1716307206","viewerDidAuthor":false}],"createdAt":"2023-09-12T07:35:22Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4864,"reactionGroups":[],"state":"CLOSED","title":"server fails to start with claimMapper `default`","updatedAt":"2023-09-12T19:36:11Z","url":"https://github.com/temporalio/temporal/issues/4864"}
