{"assignees":[],"author":{"id":"MDQ6VXNlcjM1OTE5NjQz","is_bot":false,"login":"archine","name":"gjing"},"body":"## Expected Behavior\r\nCorrect stop\r\n\r\n## Actual Behavior\r\nIt keeps trying even after the activity is canceled\r\n\r\n## Steps to Reproduce the Problem\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"go.temporal.io/sdk/client\"\r\n\t\"go.temporal.io/sdk/temporal\"\r\n\t\"go.temporal.io/sdk/worker\"\r\n\t\"go.temporal.io/sdk/workflow\"\r\n\t\"log\"\r\n\t\"time\"\r\n)\r\n\r\nfunc main() {\r\n\t// The client and worker are heavyweight objects that should be created once per process.\r\n\tc, err := client.Dial(client.Options{})\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"Unable to create client\", err)\r\n\t}\r\n\tdefer c.Close()\r\n\r\n\tw := worker.New(c, \"hello-queue\", worker.Options{\r\n\t\tMaxConcurrentActivityTaskPollers: 100,\r\n\t})\r\n\r\n\tw.RegisterWorkflow(DemoWorkflow)\r\n\tw.RegisterActivity(Activity1)\r\n\r\n\terr = w.Run(worker.InterruptCh())\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"Unable to start worker\", err)\r\n\t}\r\n}\r\n\r\nfunc DemoWorkflow(ctx workflow.Context) error {\r\n\tactivityContext, cancel := workflow.WithCancel(ctx)\r\n\tactivityContext = workflow.WithActivityOptions(ctx, workflow.ActivityOptions{\r\n\t\tStartToCloseTimeout: 1 * time.Hour,\r\n\t\tRetryPolicy: &temporal.RetryPolicy{\r\n\t\t\tMaximumAttempts:        1,\r\n\t\t\tNonRetryableErrorTypes: []string{\"Canceled\"},\r\n\t\t},\r\n\t})\r\n\tf1 := workflow.ExecuteActivity(activityContext, Activity1)\r\n\ttime.Sleep(5 * time.Second)\r\n\tcancel()\r\n\t_ = f1.Get(ctx,nil)\r\n\tlog.Println(\"=======complete=======\")\r\n\treturn nil\r\n}\r\n\r\nfunc Activity1(ctx context.Context) error {\r\n\tfor {\r\n\t\tselect {\r\n\t\tcase <-ctx.Done():\r\n\t\t\tlog.Println(\"======> 1 is canceled\")\r\n\t\t\treturn ctx.Err()\r\n\t\tcase <-time.After(1 * time.Second):\r\n\t\t\tlog.Println(\"======> 1111111\")\r\n\t\t}\r\n\t}\r\n}\r\n\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version:  go.temporal.io/sdk v1.25.1\r\n  - Platform: mac\r\n","closedAt":"2024-01-26T22:45:28Z","comments":[{"id":"IC_kwDODNqesM5xJckv","author":{"login":"archine"},"authorAssociation":"NONE","body":"The activity did not receive the ctx.Done event","createdAt":"2024-01-18T11:28:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5316#issuecomment-1898301743","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5yAuiP","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Activity needs to do heartbeat to know that context is cancelled. See more https://docs.temporal.io/activities#activity-heartbeat","createdAt":"2024-01-26T22:45:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5316#issuecomment-1912793231","viewerDidAuthor":false}],"createdAt":"2024-01-18T10:41:26Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5316,"reactionGroups":[],"state":"CLOSED","title":"When I try to cancel an activity in the workflow, it keeps trying even after the activity is canceled","updatedAt":"2024-01-26T22:45:28Z","url":"https://github.com/temporalio/temporal/issues/5316"}
