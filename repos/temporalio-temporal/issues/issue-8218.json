{"assignees":[],"author":{"id":"MDQ6VXNlcjYzMzY1ODM=","is_bot":false,"login":"pritam-ajmire","name":"Pritam Ajmire"},"body":"## Expected Behavior\nThe default JWT claim mapper should allow configuration of the subject claim name, similar to how permissionsClaimName is configurable or optional if not mandatory. Users should be able to specify which JWT claim contains the subject identifier.\nExample configuration:\n\n```\n    authorization:\n    authorizer: \"default\"\n    claimMapper: \"default\"\n    permissionsClaimName: \"scope\"\n    subjectClaimName: \"client_id\"     # Should be configurable\n    jwtKeyProvider:\n      keySourceURIs: [\"https://domain.com/.well-known/jwks.json\"]\n```\n\nExpected JWT token support:\n```\n{\n  \"client_id\": \"addafb4d3c5c924fefb787328452628sea64\",\n  \"scope\": [\"temporal-system:read\", \"namespace:role\"],\n  \"iss\": \"https://domain.com\",\n  \"exp\": 1755629838\n}\n```\n\n## Actual Behavior\nThe default JWT claim mapper hardcodes the subject claim name as \"sub\" in common/authorization/default_jwt_claim_mapper.go:\n\n```\nconst (\n    headerSubject = \"sub\"  // ← Hardcoded, line 19\n)\n\nfunc (a *defaultJWTClaimMapper) GetClaims(authInfo *AuthInfo) (*Claims, error) {\n    // ...\n    subject, ok := jwtClaims[headerSubject].(string)  // ← Always looks for \"sub\", line 97\n    if !ok {\n        return nil, serviceerror.NewPermissionDenied(\"unexpected value type of \\\"sub\\\" claim\", \"\")\n    }\n    // ...\n}\n\n```\nwhich results in error as - \"Authorization error: unexpected value type of \"sub\" claim\".\nThis blocking us whose identity providers use different subject claim names (client_id, user_id, username, etc.) & not having 'sub' in claim.\n\n\n\n## Specifications\n\nVersion: 1.27.2\nHelm Chart: temporal/temporal:0.62.0\nIdentity Provider: Enterprise OAuth2/OIDC (cannot modify token structure)\n\n## Proposed Solution:\nAdd subjectClaimName configuration to Authorization struct, defaulting to \"sub\" for backward compatibility, following the existing pattern of permissionsClaimName.\n","closedAt":"2025-10-30T22:38:58Z","comments":[{"id":"IC_kwDODNqesM7CE-0J","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Thanks for reporting the issue. I've forwarded the request to our team and asked them to assess the work needed here. \nWill update here once I hear back from them.","createdAt":"2025-09-04T22:40:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8218#issuecomment-3256085769","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7CTbnA","author":{"login":"simvlad"},"authorAssociation":"MEMBER","body":"Thanks for creating this issue. I believe [RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519) makes `sub` optional only because JWT may have no subject at all - not because it may appear under a different claim name. If your IdP issues tokens with a subject in `client_id`, `user_id` or `username` instead of `sub` that's non-standard choice. The clean fix is to configure the IdP to supply the proper `sub` (for example OIDC guarantees it is present). But if that's not possible, you can transform token on the Temporal side by implementing a custom ClaimMapper that maps the claim your IdP provides into `sub`. ","createdAt":"2025-09-05T22:05:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8218#issuecomment-3259873728","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7HKbvi","author":{"login":"pritam-ajmire"},"authorAssociation":"NONE","body":"Thanks @simvlad , I tried custom claim mapper, but for that I need to keep copy of temporal source code. To keeping source code copy will miss the new updates/fixes of future version. Which I dont want.","createdAt":"2025-09-27T08:30:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8218#issuecomment-3341401058","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7HkQ-A","author":{"login":"simvlad"},"authorAssociation":"MEMBER","body":"@pritam-ajmire, see https://docs.temporal.io/references/server-options. It tells you how to customize Temporal Server with options, such as the custom Claim Mapper. You can pin go.temporal.io/server/temporal to the version and upgrade as needed, without having to pull any source code changes.","createdAt":"2025-09-29T17:29:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8218#issuecomment-3348172672","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7O27mK","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Closing because there is no follow up from the OP.","createdAt":"2025-10-30T22:38:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8218#issuecomment-3470506378","viewerDidAuthor":false}],"createdAt":"2025-08-20T07:20:20Z","labels":[{"id":"MDU6TGFiZWwyMTU4ODQ2NzIw","name":"security","description":"","color":"f72e32"},{"id":"LA_kwDODNqesM7-SUnK","name":"feature-request","description":"","color":"4C2E9C"}],"milestone":null,"number":8218,"reactionGroups":[],"state":"CLOSED","title":"JWT 'sub' claim requirement blocking to use default temporal authorizer & claimMapper- add subjectClaimName configuration","updatedAt":"2025-10-30T22:38:58Z","url":"https://github.com/temporalio/temporal/issues/8218"}
