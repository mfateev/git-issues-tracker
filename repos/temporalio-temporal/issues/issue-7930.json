{"assignees":[{"id":"MDQ6VXNlcjIwNjgxMjQ=","login":"rodrigozhou","name":"Rodrigo Zhou","databaseId":0}],"author":{"id":"MDQ6VXNlcjEzNzE0NjI0","is_bot":false,"login":"jmbarzee","name":"Jacob Barzee"},"body":"**Is your feature request related to a problem? Please describe.**\ngithub.com/olivere/elastic is deprecated.\n\n**Describe the solution you'd like**\nReplace with official version github.com/elastic/go-elasticsearch\n\n**Describe alternatives you've considered**\nThere aren't other alternatives. Most community projects have been deprecated in favor of the official client.\n\n**Additional context**\nNope.\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM6xweKW","author":{"login":"jmbarzee"},"authorAssociation":"MEMBER","body":"This is quite a large change but, its not overly complicated, Its mostly just a client swap. I\n\nWe should probably leave the bulk client/processor till later in the work. It is a bit more complex and will require more verification. We can test a branch locally even if we are still using both clients. We should consider starting with a single method in common/persistence/visibility/store/elasticsearch/client/client.go Its implementation is in common/persistence/visibility/store/elasticsearch/client/client_v7.go","createdAt":"2025-06-18T01:04:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-2982273686","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6yN7MJ","author":{"login":"lakshya8066"},"authorAssociation":"NONE","body":"Hi @jmbarzee I'd like to work on this if it is open. Can you assign it to me?\n\nThe interface common/persistence/visibility/store/elasticsearch/client/client.go uses github.com/olivere/elastic as the return instance, so I think a new client interface is also needed and then we can implement it's methods in common/persistence/visibility/store/elasticsearch/client/client_v8.go","createdAt":"2025-06-20T06:50:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-2989994761","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6yPeT9","author":{"login":"vaibhavyadav-dev"},"authorAssociation":"CONTRIBUTOR","body":"Okay @jmbarzee , this looks great, I can take this one.","createdAt":"2025-06-20T09:11:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-2990400765","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6z0aQQ","author":{"login":"lakshya8066"},"authorAssociation":"NONE","body":"Hi @jmbarzee I have raised a PR for the migration. There are multiple functions to be migrated, I have started with a few and we can track the others in the PR description. \n\n@vaibhavyadav-dev - I see that you are working on it as well.ðŸ˜… Do you want to collaborate on the PR? We can each pick functions and implement them, it will make the migration faster. \n\nI guess the first starting point of discussion is should we go with go-elasticsearch v8 or v9. \nMy thought process with going with v8 was:\n1. v8 is more mature compared to v9 \n2. It has lower migration risk since migrating directly to v9 from v7 can have breaking changes. \n3. With v8 it is easier to maintain backward compatibility.\n4. v9.0.0 was released a few months ago, maybe we should wait for it to get more stable?\n\nJacob - what do you think? ","createdAt":"2025-06-29T16:57:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3016860688","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6z0ypo","author":{"login":"vaibhavyadav-dev"},"authorAssociation":"CONTRIBUTOR","body":"Hey @lakshya8066 , this one is currently assigned specifically to me, but I also appreciate your effort on it. \nSince thereâ€™s been parallel work, Iâ€™ll leave it to @jmbarzee  and @bergundy to decide which one to looks best.\nWell, It look like v8 would be much better than v9 as of now.\n\nAlso, itâ€™d be great to comment, before starting work on an issue, just to avoid any overlap. \nThanks!","createdAt":"2025-06-29T18:32:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3016960616","viewerDidAuthor":false},{"id":"IC_kwDODNqesM610Ge8","author":{"login":"jmbarzee"},"authorAssociation":"MEMBER","body":"Wow, Amazing assertiveness from the both of you.\n\n@vaibhavyadav-dev, I see in the community slack that Roey found different work for you. I'll support you in that direction, though the changes will probably be reviewed by someone with more experience in that section.\n\n@lakshya8066 Great questions, I'm sorry I didn't get to them before you got to implementation.\n\n@Apurer I saw you submitted a very similar PR. Lets coordinate here.","createdAt":"2025-07-08T21:21:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3050334140","viewerDidAuthor":false},{"id":"IC_kwDODNqesM610KIi","author":{"login":"jmbarzee"},"authorAssociation":"MEMBER","body":"First: lets coordinate to reduce duplicated work.\n\nSecond: Ideally, most code looks the same and the import paths just change. I've done some quick prototyping of this and haven't found that its quite this perfect, but in most cases it was at least close.\n\n**Now, details:**\n\n- We need to stay on ES v7. We need to decouple the migration to the official library from the version migration.\n- The official client has the bulk of the implementation we need. Reimplementing clients that are already implemented there would defeat the purpose of depending on the official package. \n- In cases where we accept/return structs that are defined in olivere, we should find the corresponding structs in the official client and aim for the most minimal change possible. \n\nHappy to answer further questions or address anything I've missed\n","createdAt":"2025-07-08T21:29:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3050349090","viewerDidAuthor":false},{"id":"IC_kwDODNqesM64MgtR","author":{"login":"lakshya8066"},"authorAssociation":"NONE","body":"@jmbarzee thanks for the clarifications! I agree it is probably better to move to v7 first. Although migrating to v8 whenever we decide to would be exciting because of the [typedapis](https://github.com/elastic/go-elasticsearch/tree/v8.18.1/typedapi) ðŸ™‚ \n\nWhat do you think should be our merging strategy? Do we want to merge everything except the bulk processor in one go or we can keep implementing functions and keep merging?","createdAt":"2025-07-18T18:16:23Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3090287441","viewerDidAuthor":false},{"id":"IC_kwDODNqesM64e8gZ","author":{"login":"lakshya8066"},"authorAssociation":"NONE","body":"If we want to completely remove dependency from Oliver Elasticsearch and move to official v7 client, it would require implementing all the custom query builder that Oliver has. I was also thinking since we will lose all the types available in Oliver, there has to be an extensive JSON marshaling and unmarsheling logic written. We would also lose compile-time type safety and would need extensive runtime JSON validation. The official client mostly return raw json, PIT operations would also be affected. Just thinking out loud, do you think this migration would call for a reimplementation of the entire client code?","createdAt":"2025-07-21T03:34:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3095119897","viewerDidAuthor":false},{"id":"IC_kwDODNqesM65m-p-","author":{"login":"hferentschik"},"authorAssociation":"NONE","body":"ðŸ‘‹ hi, we are also interested in this migration. Not so much because the driver is deprecated, but also because it depends on the AWS SDK v1 which has reached EOL. This relates to https://github.com/temporalio/temporal/pull/4499 which addresses the second functional area (archival) where Temporal has a dependency to the AWS SDK v1. \n\nMaybe anyone from Temporal can provide an update on when they expect this elastic search driver migration to land and in extension when we can expect a Temporal server free of a dependency to AWS SDK v1?","createdAt":"2025-07-24T15:55:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3114003070","viewerDidAuthor":false},{"id":"IC_kwDODNqesM65nC7S","author":{"login":"hferentschik"},"authorAssociation":"NONE","body":"On a different note, is elastic/go-elasticsearch working with OpenSearch? I believe v7 does, but not sure about later versions and whether there would be potential problems. See also https://github.com/temporalio/temporal/issues/5680.\n\nI know that there is a OpenSearch specific go driver (https://github.com/opensearch-project/opensearch-go), but I am not sure what the compatibility guarantees there are between OpenSearch and ElasticSearch and the various drivers. Does the driver in the new solution need to be pluggable in some form?","createdAt":"2025-07-24T16:01:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3114020562","viewerDidAuthor":false},{"id":"IC_kwDODNqesM66xppn","author":{"login":"damar-block"},"authorAssociation":"NONE","body":"Hey, will that change break compatibility with OpenSearch? ","createdAt":"2025-07-29T18:20:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3133577831","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6_li95","author":{"login":"hferentschik"},"authorAssociation":"NONE","body":"ðŸ‘‹ any update on this issue? \n\nI already asked about making the driver pluggable related to OpenSearch, but there is another use case. We have a custom driver wrapping the go-elastic driver. It implements amongst other things other forms of authentication. It would be awesome to be able to have a way to configure your driver. At the very least provide a custom transport. Wdyt?","createdAt":"2025-08-22T12:56:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3214290809","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7ba0fo","author":{"login":"omerlic"},"authorAssociation":"NONE","body":"ðŸ‘‹ any update on this issue?","createdAt":"2025-12-22T09:38:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7930#issuecomment-3681241064","viewerDidAuthor":false}],"createdAt":"2025-06-18T00:55:01Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":7930,"reactionGroups":[],"state":"OPEN","title":"Replace \"github.com/olivere/elastic/v7\" with the official client \"github.com/elastic/go-elasticsearch\"","updatedAt":"2025-12-22T09:38:03Z","url":"https://github.com/temporalio/temporal/issues/7930"}
