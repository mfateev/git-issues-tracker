{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjE1ODE3MjY=","is_bot":false,"login":"ajbeach2","name":"kanto-bot"},"body":"## Expected Behavior\r\n\r\nAdding custom search attributes should be searchable, following the documentation here:\r\nhttps://docs.temporal.io/docs/tctl/#add-new-search-attributes\r\nhttps://docs.temporal.io/docs/server-workflow-search/\r\n\r\n## Actual Behavior\r\n\r\nThe elasticsearch mapping has dynamic: false which means any added attributes are not indexed, and therefore not searchable in the Advanced search.\r\n\r\n```json\r\n    \"mappings\": {\r\n      \"dynamic\": \"false\",\r\n      \"properties\": {\r\n        \"Attr\": {\r\n          \"properties\": {\r\n            \"BinaryChecksums\": {\r\n              \"type\": \"keyword\"\r\n            },\r\n            \"CustomBoolField\": {\r\n              \"type\": \"boolean\"\r\n            },\r\n            \"CustomDatetimeField\": {\r\n              \"type\": \"date\"\r\n            },\r\n            \"CustomDoubleField\": {\r\n              \"type\": \"double\"\r\n            },\r\n            \"CustomIntField\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"CustomKeywordField\": {\r\n              \"type\": \"keyword\"\r\n            },\r\n            \"CustomNamespace\": {\r\n              \"type\": \"keyword\"\r\n            },\r\n            \"CustomStringField\": {\r\n              \"type\": \"text\"\r\n            },\r\n            \"Operator\": {\r\n              \"type\": \"keyword\"\r\n            },\r\n            \"TemporalChangeVersion\": {\r\n              \"type\": \"keyword\"\r\n            }\r\n          }\r\n        }\r\n```\r\n        \r\n\r\n## Steps to Reproduce the Problem\r\n\r\nDeploy with ES and look at _mappings for the visibility index\r\n\r\n## Specifications\r\n\r\n  - Version: 1.8.1\r\n","closedAt":"2021-07-13T01:23:42Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgxNTkwNzcwNg==","author":{"login":"ajbeach2"},"authorAssociation":"NONE","body":"I was able to get this to work by manually updating the mapping so that Attr is dynamic true, even if the root mapping is dynamic false.\r\n\r\nI think this may be a bug, Attr should be dynamic or the dynamic config attributes should be added to the mapping.\r\n\r\n```\r\nPUT /temporal-visibility-dev/_mapping\r\n{\r\n    \"properties\": {\r\n        \"Attr\": {\r\n            \"dynamic\": \"true\",\r\n            \"properties\": {\r\n                \"BinaryChecksums\": {\r\n                    \"type\": \"keyword\"\r\n                },\r\n                \"CustomBoolField\": {\r\n                    \"type\": \"boolean\"\r\n                },\r\n                \"CustomDatetimeField\": {\r\n                    \"type\": \"date\"\r\n                },\r\n                \"CustomDoubleField\": {\r\n                    \"type\": \"double\"\r\n                },\r\n                \"CustomIntField\": {\r\n                    \"type\": \"long\"\r\n                },\r\n                \"CustomKeywordField\": {\r\n                    \"type\": \"keyword\"\r\n                },\r\n                \"CustomNamespace\": {\r\n                    \"type\": \"keyword\"\r\n                },\r\n                \"CustomStringField\": {\r\n                    \"type\": \"text\"\r\n                },\r\n                \"Operator\": {\r\n                    \"type\": \"keyword\"\r\n                },\r\n                \"TemporalChangeVersion\": {\r\n                    \"type\": \"keyword\"\r\n                }\r\n            }\r\n        },\r\n        \"CloseTime\": {\r\n            \"type\": \"long\"\r\n        },\r\n        \"Encoding\": {\r\n            \"type\": \"keyword\"\r\n        },\r\n        \"ExecutionStatus\": {\r\n            \"type\": \"long\"\r\n        },\r\n        \"ExecutionTime\": {\r\n            \"type\": \"long\"\r\n        },\r\n        \"HistoryLength\": {\r\n            \"type\": \"long\"\r\n        },\r\n        \"NamespaceId\": {\r\n            \"type\": \"keyword\"\r\n        },\r\n        \"RunId\": {\r\n            \"type\": \"keyword\"\r\n        },\r\n        \"StartTime\": {\r\n            \"type\": \"long\"\r\n        },\r\n        \"TaskQueue\": {\r\n            \"type\": \"keyword\"\r\n        },\r\n        \"WorkflowId\": {\r\n            \"type\": \"keyword\"\r\n        },\r\n        \"WorkflowType\": {\r\n            \"type\": \"keyword\"\r\n        }\r\n    }\r\n}\r\n````\r\n\r\n","createdAt":"2021-04-08T15:16:32Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/1442#issuecomment-815907706","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxNjk4MTEwNQ==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Yes, this experience is pretty weak now. Thanks for reporting it. I am already actively working on improvements and we will fix it soon.","createdAt":"2021-04-09T21:26:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1442#issuecomment-816981105","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgyODY5NDY1Ng==","author":{"login":"cmagorian"},"authorAssociation":"NONE","body":"Just echoing that this resolved my issues as well. I found that if I setup the dynamic_config manually with the SearchAttributes I wanted with their ES types and performed a PUT /temporal-visibility-dev/_mappings with the payload of the new fields, and updated the `dynamic = true` on the whole index, I was able to get my Custom SearchAttributes working.\r\n\r\nLet us know how we can help!","createdAt":"2021-04-28T18:46:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1442#issuecomment-828694656","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3ODcwNTA1Mw==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Starting from v1.10.0 dynamic config is no longer used for custom search attributes and `tctl admin cluster add-search-attributes` command should update both internal metadata and Elasticsearch schema.\r\n\r\n`\"dynamic\"` must always be set to \"false\" to control number of index fields.","createdAt":"2021-07-13T01:23:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1442#issuecomment-878705053","viewerDidAuthor":false}],"createdAt":"2021-04-08T14:45:25Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"MDU6TGFiZWwyMDE5OTIzNjU1","name":"devexp","description":"","color":"9350b7"},{"id":"MDU6TGFiZWwyNTc2NTM1ODQ2","name":"difficulty: easy","description":"","color":"68d662"},{"id":"MDU6TGFiZWwzMDAxNDk5NzYw","name":"operations","description":"","color":"f9d0c4"}],"milestone":null,"number":1442,"reactionGroups":[],"state":"CLOSED","title":"Custom Search attributes aren't usable because mappings are dynamic = False","updatedAt":"2021-07-13T01:23:42Z","url":"https://github.com/temporalio/temporal/issues/1442"}
