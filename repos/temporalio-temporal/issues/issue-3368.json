{"assignees":[{"id":"MDQ6VXNlcjU5NDI5NjM=","login":"MichaelSnowden","name":"Michael Snowden","databaseId":0}],"author":{"id":"MDQ6VXNlcjM3NzA0Nzg=","is_bot":false,"login":"yux0","name":"Yu Xia"},"body":"**Is your feature request related to a problem? Please describe.**\r\nCurrently, the behavior of delete workflow execution depends on the state of the task processing. (https://github.com/temporalio/temporal/blob/master/service/history/workflow/delete_manager.go#L117-L147) \r\n\r\nThis is not a good model to understanding. We should move this part into task processing.\r\n\r\n**Describe the solution you'd like**\r\nIt compares the ack levels in transfer queue and visibility queue. \r\n\r\nIn transfer queue, when processing a delete task, it can load the mutable state to get the close transfer task id. Then it knows if it is ok to process the task.\r\n\r\nIn visibility queue, we need to store the closed visibility task id as the mutable state may be deleted prior to this task. \r\n\r\n**Describe alternatives you've considered**\r\nCheck the visibility queue state when processing the deletion transfer task. But this is not a good option as it couples two queues.\r\n\r\n**Additional context**\r\n","closedAt":"2022-10-11T17:32:07Z","comments":[],"createdAt":"2022-09-12T20:45:11Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":3368,"reactionGroups":[],"state":"CLOSED","title":"Move task queue state validation logic from delete manager to task processing","updatedAt":"2022-10-11T17:32:07Z","url":"https://github.com/temporalio/temporal/issues/3368"}
