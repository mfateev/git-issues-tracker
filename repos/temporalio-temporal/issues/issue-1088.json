{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMjI1MTI=","is_bot":false,"login":"hazcod","name":"Niels Hofmans"},"body":"## Expected Behavior\r\nSetup all necessary stuff in the psql database.\r\n\r\n## Actual Behavior\r\nService fails wtih `relation \"schema_version\" does not exist.`.\r\n\r\n## Steps to Reproduce the Problem\r\ndocker-compose:\r\n```yaml\r\nservices:\r\n\r\n  temporaldb:\r\n    image: cockroachdb/cockroach:v20.1.9\r\n    volumes:\r\n    - data-temporal:/cockroach/cockroach-data\r\n    tty: false\r\n    restart: \"on-failure:5\"\r\n    security_opt:\r\n    - \"no-new-privileges\"\r\n    read_only: true\r\n    cap_drop:\r\n    - ALL\r\n    networks:\r\n    - backend\r\n\r\n  temporal:\r\n    image: temporalio/server:1.4.1\r\n    restart: \"on-failure:5\"\r\n    environment:\r\n    - \"LOG_LEVEL=warn\"\r\n    - \"AUTO_SETUP=true\"\r\n    - \"DB=postgresql\"\r\n    - \"DB_PORT=26257\"\r\n    - \"POSTGRES_USER=root\"\r\n    - \"POSTGRES_PWD=postgres\"\r\n    - \"POSTGRES_SEEDS=postgres\"\r\n    - \"SKIP_DEFAULT_NAMESPACE_CREATION=true\"\r\n    links:\r\n    - temporaldb:postgres\r\n    ports:\r\n    - 7233\r\n    depends_on:\r\n    - temporaldb\r\n```\r\n\r\nLogs:\r\n```\r\n+ DB=postgresql\r\n\r\n+ ENABLE_ES=false\r\n\r\n+ ES_SCHEMA_SETUP_TIMEOUT_IN_SECONDS=0\r\n\r\n+ ES_PORT=9200\r\n\r\n+ ES_SCHEME=http\r\n\r\n+ ES_VIS_INDEX=temporal-visibility-dev\r\n\r\n+ RF=1\r\n\r\n+ DEFAULT_NAMESPACE=default\r\n\r\n+ DEFAULT_NAMESPACE_RETENTION=1\r\n\r\n+ CASSANDRA_PORT=9042\r\n\r\n+ export TEMPORAL_CLI_ADDRESS=172.18.0.4:7233\r\n\r\n+ TEMPORAL_CLI_ADDRESS=172.18.0.4:7233\r\n\r\n+ export KEYSPACE=temporal\r\n\r\n+ KEYSPACE=temporal\r\n\r\n+ export VISIBILITY_KEYSPACE=temporal_visibility\r\n\r\n+ VISIBILITY_KEYSPACE=temporal_visibility\r\n\r\n+ export DBNAME=temporal\r\n\r\n+ DBNAME=temporal\r\n\r\n+ export VISIBILITY_DBNAME=temporal_visibility\r\n\r\n+ VISIBILITY_DBNAME=temporal_visibility\r\n\r\n+ export DB_PORT=26257\r\n\r\n+ DB_PORT=26257\r\n\r\n+ '[' '' = autosetup ']'\r\n\r\n+ '[' false == true ']'\r\n\r\n+ exec bash /start-temporal.sh\r\n\r\n+ dockerize -template /etc/temporal/config/config_template.yaml:/etc/temporal/config/docker.yaml\r\n\r\n+ IFS=:,\r\n\r\n+ read -ra SERVICE_LIST\r\n\r\n++ printf -- '--service=%s ' history matching frontend worker\r\n\r\n+ SERVICE_ARGS='--service=history --service=matching --service=frontend --service=worker '\r\n\r\n+ exec temporal-server --root /etc/temporal --env docker start --service=history --service=matching --service=frontend --service=worker\r\n\r\n2020/12/14 08:26:43 Loading config; env=docker,zone=,configDir=/etc/temporal/config\r\n\r\n2020/12/14 08:26:43 Loading config files=[/etc/temporal/config/docker.yaml]\r\n\r\nUnable to start server: sql schema version compatibility check failed: unable to read DB schema version keyspace/database: temporal error: pq: relation \"schema_version\" does not exist.\r\n```\r\n","closedAt":"2020-12-14T18:40:20Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc0NDYzMDI1Mg==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"should be \r\n```yaml\r\nimage: temporalio/auto-setup:1.4.1\r\n```","createdAt":"2020-12-14T18:35:34Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1088#issuecomment-744630252","viewerDidAuthor":false}],"createdAt":"2020-12-14T08:33:30Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":1088,"reactionGroups":[],"state":"CLOSED","title":"relation \"schema_version\" does not exist on fresh postgresql DB","updatedAt":"2020-12-14T18:40:20Z","url":"https://github.com/temporalio/temporal/issues/1088"}
