{"assignees":[{"id":"MDQ6VXNlcjYzNTAzMDE=","login":"jbreiding","name":"Jeremy","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyODQ1MTI=","is_bot":false,"login":"diddowill","name":""},"body":"## Expected Behavior\r\nWhen a customized DB_PORT is specified, for example 3307 for mysql, it would report error and stop the server:\r\n`ERROR\tUnable to create SQL database.\t{\"error\": \"dial tcp 10.168.168.221:3306: connect: connection refused\", \"logging-call-at\": \"handler.go:98\"}` \r\n\r\nauto-setup.sh misses the DB_PORT parameter in mysql and cassandra connection:\r\n` SCHEMA_DIR=${TEMPORAL_HOME}/schema/mysql/v57/temporal/versioned\r\n    if [[ ${SKIP_DB_CREATE} != true ]]; then\r\n        temporal-sql-tool --ep \"${MYSQL_SEEDS}\" -u \"${MYSQL_USER}\" \"${MYSQL_CONNECT_ATTR[@]}\" create --db \"${DBNAME}\"\r\n    fi\r\n    temporal-sql-tool --ep \"${MYSQL_SEEDS}\" -u \"${MYSQL_USER}\" \"${MYSQL_CONNECT_ATTR[@]}\" --db \"${DBNAME}\" setup-schema -v 0.0\r\n    temporal-sql-tool --ep \"${MYSQL_SEEDS}\" -u \"${MYSQL_USER}\" \"${MYSQL_CONNECT_ATTR[@]}\" --db \"${DBNAME}\" update-schema -d \"${SCHEMA_DIR}\"\r\n\r\n    VISIBILITY_SCHEMA_DIR=${TEMPORAL_HOME}/schema/mysql/v57/visibility/versioned\r\n    if [[ ${SKIP_DB_CREATE} != true ]]; then\r\n        temporal-sql-tool --ep \"${MYSQL_SEEDS}\" -u \"${MYSQL_USER}\" \"${MYSQL_CONNECT_ATTR[@]}\" create --db \"${VISIBILITY_DBNAME}\"\r\n    fi\r\n    temporal-sql-tool --ep \"${MYSQL_SEEDS}\" -u \"${MYSQL_USER}\" \"${MYSQL_CONNECT_ATTR[@]}\" --db \"${VISIBILITY_DBNAME}\" setup-schema -v 0.0\r\n    temporal-sql-tool --ep \"${MYSQL_SEEDS}\" -u \"${MYSQL_USER}\" \"${MYSQL_CONNECT_ATTR[@]}\" --db \"${VISIBILITY_DBNAME}\" update-schema -d \"${VISIBILITY_SCHEMA_DIR}\"`\r\n\r\n\r\n## Actual Behavior\r\nuse the specified DB_PORT and connect to database correctly \r\n\r\n## Specifications\r\n\r\n  - Version: 15.2\r\n  - Platform: Linux\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5BR754","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Thanks for the issue, we are going to track this under a larger effort to refactor all of the different ways to configure temporal server.","createdAt":"2022-04-11T15:44:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2615#issuecomment-1095220856","viewerDidAuthor":false}],"createdAt":"2022-03-16T08:21:13Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODEzMzk5","name":"config","description":"","color":"a5a1f4"},{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2615,"reactionGroups":[],"state":"OPEN","title":"auto-setup does not use DB_PORT for mysql and cassandra ","updatedAt":"2023-03-03T20:20:45Z","url":"https://github.com/temporalio/temporal/issues/2615"}
