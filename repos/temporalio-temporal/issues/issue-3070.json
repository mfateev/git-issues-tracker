{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjMzMjEx","is_bot":false,"login":"luckysanbao","name":""},"body":"**The operation steps are as follows:**\r\n\r\n[root@reg temporal]# git status\r\nHEAD detached at v1.17.0\r\nnothing to commit, working tree clean\r\n\r\n[root@reg temporal]# export SQL_PLUGIN=mysql\r\n[root@reg temporal]# export SQL_HOST=192.168.16.200\r\n[root@reg temporal]# export SQL_PORT=32306\r\n[root@reg temporal]# export SQL_USER=root\r\n[root@reg temporal]# export SQL_PASSWORD=x113\r\n\r\n\r\n[root@reg temporal]#  ./temporal-sql-tool create-database -database temporal\r\n[root@reg temporal]#  SQL_DATABASE=temporal ./temporal-sql-tool setup-schema -v 0.0\r\n2022-07-07T18:12:28.017+0800\tINFO\tStarting schema setup\t{\"config\": {\"SchemaFilePath\":\"\",\"InitialVersion\":\"0.0\",\"Overwrite\":false,\"DisableVersioning\":false}, \"logging-call-at\": \"setuptask.go:57\"}\r\n2022-07-07T18:12:28.017+0800\tDEBUG\tSetting up version tables\t{\"logging-call-at\": \"setuptask.go:67\"}\r\n2022-07-07T18:12:28.050+0800\tDEBUG\tSetting initial schema version to 0.0\t{\"logging-call-at\": \"setuptask.go:118\"}\r\n2022-07-07T18:12:28.052+0800\tDEBUG\tUpdating schema update log\t{\"logging-call-at\": \"setuptask.go:123\"}\r\n2022-07-07T18:12:28.055+0800\tINFO\tSchema setup complete\t{\"logging-call-at\": \"setuptask.go:131\"}\r\n\r\n**#####  The error message is as follows**\r\n\r\n[root@reg temporal]#  SQL_DATABASE=temporal ./temporal-sql-tool update -schema-dir schema/mysql/v57/temporal/versioned\r\n2022-07-07T18:12:30.640+0800\tINFO\tUpdateSchemeTask started\t{\"config\": {\"DBName\":\"\",\"TargetVersion\":\"\",\"SchemaDir\":\"schema/mysql/v57/temporal/versioned\",\"IsDryRun\":false}, \"logging-call-at\": \"updatetask.go:97\"}\r\n2022-07-07T18:12:30.644+0800\tDEBUG\tSchema Dirs: [v1.0 v1.1 v1.2 v1.3 v1.4 v1.5 v1.6 v1.7 v1.8]\t{\"logging-call-at\": \"updatetask.go:186\"}\r\n2022-07-07T18:12:30.644+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.0/schema.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.645+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.1/cluster_metadata.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.646+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.2/queue.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.646+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.2/blob_size.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.646+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.3/visibility_tasks.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.646+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.4/cluster_metadata.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.647+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.5/event.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.647+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.5/executions.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.647+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.5/cluster_membership.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.647+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.6/queue_metadata.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.647+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.7/cluster_metadata_info.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.648+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.7/no_start_version.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.648+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.7/tiered_storage_tasks.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.648+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.8/drop_unused_tasks_table.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.648+0800\tINFO\tProcessing schema file: schema/mysql/v57/temporal/versioned/v1.8/alter_columns.sql\t{\"logging-call-at\": \"updatetask.go:232\"}\r\n2022-07-07T18:12:30.648+0800\tDEBUG\t---- Executing updates for version 1.0 ----\t{\"logging-call-at\": \"updatetask.go:150\"}\r\n2022-07-07T18:12:30.648+0800\tDEBUG\tCREATE TABLE namespaces(partition_id INT NOT NULL,id BINARY(16) NOT NULL,name VARCHAR(255) UNIQUE NOT NULL,notification_version BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,is_global TINYINT(1) NOT NULL,PRIMARY KEY(partition_id, id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.663+0800\tDEBUG\tCREATE TABLE namespace_metadata (partition_id INT NOT NULL,notification_version BIGINT NOT NULL,PRIMARY KEY(partition_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.674+0800\tDEBUG\tINSERT INTO namespace_metadata (partition_id, notification_version) VALUES (54321, 1);\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.677+0800\tDEBUG\tCREATE TABLE shards (shard_id INT NOT NULL,range_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.689+0800\tDEBUG\tCREATE TABLE transfer_tasks(shard_id INT NOT NULL,task_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, task_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.703+0800\tDEBUG\tCREATE TABLE executions(shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,next_event_id BIGINT NOT NULL,last_write_version BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,state BLOB NOT NULL,state_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.714+0800\tDEBUG\tCREATE TABLE current_executions(shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,create_request_id VARCHAR(64) NOT NULL,state INT NOT NULL,status INT NOT NULL,start_version BIGINT NOT NULL,last_write_version BIGINT NOT NULL,PRIMARY KEY (shard_id, namespace_id, workflow_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.725+0800\tDEBUG\tCREATE TABLE buffered_events (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,id BIGINT AUTO_INCREMENT NOT NULL UNIQUE,data MEDIUMBLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.736+0800\tDEBUG\tCREATE TABLE tasks (range_hash INT UNSIGNED NOT NULL,task_queue_id VARBINARY(272) NOT NULL,task_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (range_hash, task_queue_id, task_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.744+0800\tDEBUG\tCREATE TABLE task_queues (range_hash INT UNSIGNED NOT NULL,task_queue_id VARBINARY(272) NOT NULL,range_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (range_hash, task_queue_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.752+0800\tDEBUG\tCREATE TABLE replication_tasks (shard_id INT NOT NULL,task_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, task_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.761+0800\tDEBUG\tCREATE TABLE replication_tasks_dlq (source_cluster_name VARCHAR(255) NOT NULL,shard_id INT NOT NULL,task_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (source_cluster_name, shard_id, task_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.769+0800\tDEBUG\tCREATE TABLE timer_tasks (shard_id INT NOT NULL,visibility_timestamp DATETIME(6) NOT NULL,task_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, visibility_timestamp, task_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.780+0800\tDEBUG\tCREATE TABLE activity_info_maps (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,schedule_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16),PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, schedule_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.790+0800\tDEBUG\tCREATE TABLE timer_info_maps (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,timer_id VARCHAR(255) NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16),PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, timer_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.802+0800\tDEBUG\tCREATE TABLE child_execution_info_maps (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,initiated_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16),PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, initiated_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.813+0800\tDEBUG\tCREATE TABLE request_cancel_info_maps (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,initiated_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16),PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, initiated_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.824+0800\tDEBUG\tCREATE TABLE signal_info_maps (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,initiated_id BIGINT NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16),PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, initiated_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.835+0800\tDEBUG\tCREATE TABLE signals_requested_sets (shard_id INT NOT NULL,namespace_id BINARY(16) NOT NULL,workflow_id VARCHAR(255) NOT NULL,run_id BINARY(16) NOT NULL,signal_id VARCHAR(64) NOT NULL,PRIMARY KEY (shard_id, namespace_id, workflow_id, run_id, signal_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.846+0800\tDEBUG\tCREATE TABLE history_node (shard_id INT NOT NULL,tree_id BINARY(16) NOT NULL,branch_id BINARY(16) NOT NULL,node_id BIGINT NOT NULL,txn_id BIGINT NOT NULL,data MEDIUMBLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, tree_id, branch_id, node_id, txn_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.858+0800\tDEBUG\tCREATE TABLE history_tree (shard_id INT NOT NULL,tree_id BINARY(16) NOT NULL,branch_id BINARY(16) NOT NULL,data BLOB NOT NULL,data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY (shard_id, tree_id, branch_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.868+0800\tDEBUG\tCREATE TABLE queue (queue_type INT NOT NULL,message_id BIGINT NOT NULL,message_payload BLOB NOT NULL,PRIMARY KEY(queue_type, message_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.877+0800\tDEBUG\tCREATE TABLE queue_metadata (queue_type INT NOT NULL,data BLOB NOT NULL,PRIMARY KEY(queue_type));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.887+0800\tDEBUG\tCREATE TABLE cluster_metadata (metadata_partition INT NOT NULL,immutable_data BLOB NOT NULL,immutable_data_encoding VARCHAR(16) NOT NULL,PRIMARY KEY(metadata_partition));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.900+0800\tDEBUG\tCREATE TABLE cluster_membership(membership_partition INT NOT NULL,host_id BINARY(16) NOT NULL,rpc_address VARCHAR(15) NOT NULL,rpc_port SMALLINT NOT NULL,role TINYINT NOT NULL,session_start TIMESTAMP DEFAULT '1970-01-01 00:00:01',last_heartbeat TIMESTAMP DEFAULT '1970-01-01 00:00:01',record_expiry TIMESTAMP DEFAULT '1970-01-01 00:00:01',INDEX (role, host_id),INDEX (role, last_heartbeat),INDEX (rpc_address, role),INDEX (last_heartbeat),INDEX (record_expiry),PRIMARY KEY (membership_partition, host_id));\t{\"logging-call-at\": \"updatetask.go:152\"}\r\n2022-07-07T18:12:30.901+0800\tERROR\tUnable to update SQL schema.\t{\"error\": \"error executing statement:Error 1067: Invalid default value for 'session_start'\", \"logging-call-at\": \"handler.go:80\"}\r\n\r\n**####  How to fix the above error**\r\n","closedAt":"2022-07-08T22:18:08Z","comments":[{"id":"IC_kwDODNqesM5GTEAw","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"This is due to your timezone. Workaround is to set UTC time zone for MySQL. I fixed it in #3012 but it is not in 1.17 (will go to 1.18).","createdAt":"2022-07-08T22:18:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/3070#issuecomment-1179402288","viewerDidAuthor":false}],"createdAt":"2022-07-07T10:16:00Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":3070,"reactionGroups":[],"state":"CLOSED","title":"An error occurred when using temporal-sql-tool to initialize the mysql database. Procedure","updatedAt":"2022-07-08T22:18:08Z","url":"https://github.com/temporalio/temporal/issues/3070"}
