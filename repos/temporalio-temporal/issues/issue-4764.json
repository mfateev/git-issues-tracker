{"assignees":[],"author":{"id":"MDQ6VXNlcjE2MTg0","is_bot":false,"login":"neelance","name":"Richard Musiol"},"body":"We started to see a number of `ServiceError: Failed to signalWithStart Workflow` errors recently. The error message `Error: 9 FAILED_PRECONDITION: workflow operation rejected because workflow is closing` seems to be related.\r\n\r\nIt started around August 2nd. We are using Temporal Cloud. I do not immediately see any change on our end that could cause the issues. Even if there was some change, I would expect that `signalWithStart` should not error like this.\r\n\r\nAny ideas?","closedAt":"2023-10-05T23:40:49Z","comments":[{"id":"IC_kwDODNqesM5jx998","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"This is due to a change made in server 1.21, where if a workflow execution is trying to complete, the server rejects signals for that execution.\r\n\r\nThis error should not use a [non retryable](https://github.com/temporalio/sdk-typescript/blob/27b2a22ce1e16472431948cddd7ab4ced5bde4fd/packages/client/src/grpc-retry.ts#L100) FAILED_PRECONDITION code.\r\nThere are discussion to change to a retryable RESOURCE_EXHAUSTED in the near future and later on to carry over these signals to the next execution on continue-as-new.\r\n\r\nI'm transferring this issue to the server repo as it is a server issue.","createdAt":"2023-08-10T23:19:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4764#issuecomment-1674043260","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5jyDCE","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Short term fix here: https://github.com/temporalio/temporal/pull/4765\r\nIt will be included in the upcoming 1.21.5 release and deployed to Cloud in the near future.","createdAt":"2023-08-10T23:53:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4764#issuecomment-1674064004","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5jySG8","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"This error happen when signals coming to a workflow is faster than the workflow could handle and the workflow already expressed intention to close itself. Keep accepting new signals will prevent the workflow from closing and could lead to more serious system stability issue. The mitigation is to return a retryable error (ResourceExhaustedError with cause set to WorkflowBusy) so SDK could backoff a little bit given the workflow a chance to close itself. Hopefully by the time of retry, the workflow already closed and SignalWithStart would start a new run. \r\nBefore that mitigation is deployed to server, a slow retry on client side could also mitigate this issue.","createdAt":"2023-08-11T01:49:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4764#issuecomment-1674125756","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5oS82_","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"The short term fix is included in 1.21.5 and 1.22 as well.","createdAt":"2023-10-05T23:40:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4764#issuecomment-1749798335","viewerDidAuthor":false}],"createdAt":"2023-08-10T15:55:15Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":4764,"reactionGroups":[],"state":"CLOSED","title":"[Bug] ServiceError: Failed to signalWithStart Workflow","updatedAt":"2023-10-05T23:40:49Z","url":"https://github.com/temporalio/temporal/issues/4764"}
