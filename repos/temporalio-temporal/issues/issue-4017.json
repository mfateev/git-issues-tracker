{"assignees":[{"id":"MDQ6VXNlcjIwNjgxMjQ=","login":"rodrigozhou","name":"Rodrigo Zhou","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyMzA0","is_bot":false,"login":"bergundy","name":"Roey Berman"},"body":"## Expected Behavior\nStarting a workflow immediately after registering a search attribute should succeed.\n\n## Actual Behavior\nStarting a workflow immediately after registering a search attribute fails with:\n\n```\nINVALID_ARGUMENT: Namespace default has no mapping defined for search attribute foo\n```\n\n## Steps to Reproduce the Problem\n1. Start Temporal server with SQLite (or any other SQL backend), for convenience use the `Debug Server with SQLite` VS Code launch config.\n1. Register a namespace: `temporal operator namespace create default`\n1. Use a client to add a search attribute\n1. Start a workflow with the added search attribute\n1. Observe the INVALID_ARGUMENT error\n\nTypeScript snippet:\n\n```ts\n  await connection.operatorService.addSearchAttributes({\n    namespace: 'default',\n    searchAttributes: { foo: temporal.api.enums.v1.IndexedValueType.INDEXED_VALUE_TYPE_KEYWORD },\n  });\n  const client = new Client({ connection });\n  const result = await client.workflow.execute(workflowType, {\n    workflowId,\n    taskQueue: 'test',\n    args,\n    searchAttributes: { foo: ['bar'] },\n  });\n```\n\n## Specifications\n* Version: latest master\n\n","closedAt":"2023-05-25T22:19:52Z","comments":[],"createdAt":"2023-03-06T18:56:59Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4017,"reactionGroups":[],"state":"CLOSED","title":"Regression: namespace specific search attributes have registration delay with `system.forceSearchAttributesCacheRefreshOnRead=true`","updatedAt":"2023-05-25T22:19:52Z","url":"https://github.com/temporalio/temporal/issues/4017"}
