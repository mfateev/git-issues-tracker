{"assignees":[{"id":"MDQ6VXNlcjM3NzA0Nzg=","login":"yux0","name":"Yu Xia","databaseId":0}],"author":{"id":"MDQ6VXNlcjg3NjI4OTM=","is_bot":false,"login":"wxing1292","name":"Wenquan Xing"},"body":"## Expected Behavior\r\nIf DB is not initialized, static config of cluster metadata should be \r\n* either respected & persisted into DB\r\n* or deprecated completely\r\n\r\n## Actual Behavior\r\n```\r\nclusterMetadata:\r\n  enableGlobalNamespace: true\r\n  failoverVersionIncrement: 10\r\n  masterClusterName: \"cluster-a\"\r\n  currentClusterName: \"cluster-a\"\r\n  clusterInformation:\r\n    cluster-a:\r\n      enabled: true\r\n      initialFailoverVersion: 3\r\n      rpcName: \"frontend\"\r\n      rpcAddress: \"localhost:7233\"\r\n    cluster-b:\r\n      enabled: true\r\n      initialFailoverVersion: 2\r\n      rpcName: \"frontend\"\r\n      rpcAddress: \"localhost:8233\"\r\n```      \r\nUsing above static config & clean DB & after 1s ish, the `cluster-b` section will be deleted \r\n\r\n## Steps to Reproduce the Problem\r\nSee above\r\n\r\n## Specifications\r\n\r\n  - Version: 1.16.x+\r\n  - Platform: Mac & Intel\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5GsIOT","author":{"login":"yux0"},"authorAssociation":"MEMBER","body":"The add cluster from config is deprecated and a warning log will show if you figure it via config.\r\n\r\n`{\"level\":\"warn\",\"ts\":\"2022-07-15T14:38:43.425-0700\",\"msg\":\"ClusterInformation in ClusterMetadata config is deprecated. Please use TCTL admin tool to configure remote cluster connections\",\"component\":\"metadata-initializer\",\"key\":\"clusterInformation\",\"cluster-name\":\"standby\",\"ignored-value\":{\"Enabled\":true,\"InitialFailoverVersion\":2,\"RPCAddress\":\"localhost:8233\"},\"logging-call-at\":\"fx.go:615\"}`","createdAt":"2022-07-15T21:50:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/3104#issuecomment-1185973139","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5GsJAR","author":{"login":"yux0"},"authorAssociation":"MEMBER","body":"We cannot deprecate the clusterMetadata because we need to know the current cluster and load it from DB. I agree we can do better to refine this cluster metadata. But there will be questions about how to enable global namespace? How to deal with the primary cluster?  How to set initialFailoverVersion and failoverVersionIncrement in first cluster initialization? How to be backward-compatible? Before solving those, the clusterMetadata will stay.","createdAt":"2022-07-15T21:55:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/3104#issuecomment-1185976337","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5GsVJT","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"warn log says ClusterInformation is deprecated, but it did not say anything about ignoring cluster-b (non current cluster)\n\nSilent failure is misleading, either complete deprecate the cluster metadata by using a new structure or improve the logging ","createdAt":"2022-07-15T23:44:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/3104#issuecomment-1186026067","viewerDidAuthor":false}],"createdAt":"2022-07-14T23:25:06Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":3104,"reactionGroups":[],"state":"OPEN","title":"Surprising clusterMetadata override","updatedAt":"2023-03-03T20:19:40Z","url":"https://github.com/temporalio/temporal/issues/3104"}
