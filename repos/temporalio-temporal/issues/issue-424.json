{"assignees":[],"author":{"id":"MDQ6VXNlcjY2Mjc1OTA5","is_bot":false,"login":"arvindsampath","name":""},"body":"## Expected Behavior\r\nWorkflows configured to run on a CRON schedule run at the configured frequency until the temporal service is shut down if they are not cancelled\r\n\r\n## Actual Behavior\r\nCRON workflows stop executing after a few times. This issue is observed in the server release version 0.23.1. There are some WARN level logs in the service console with the below message\r\n\r\n> \"msg\":\"New timer generated is less than read level\"\r\n\r\nThey work well in the server version 0.21.1 and Java SDK 0.19.0.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Start a workflow with the CRON Pattern \"*/2 * * * *\" to execute the workflow every 2 minutes\r\n \r\n\r\n## Specifications\r\n\r\n  - Version: 0.23.1\r\n  - Platform: Java SDK, Service runs inside a docker container\r\n","closedAt":"2020-06-03T00:31:15Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDYzNzEwMzU1OA==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"Can you share the history of last execution of workflow?  \r\n\r\nMake sure your workflow timeouts are not very aggressive.  Let's say your workflow timeout is 5 minute and Temporal server is down for more than 5 minutes than it may timeout the workflow instead of firing off cron run.","createdAt":"2020-06-01T21:10:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/424#issuecomment-637103558","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYzNzExMDAyNg==","author":{"login":"arvindsampath"},"authorAssociation":"NONE","body":"I will run new tests and share the artifacts. In my case, the workflow wasn't doing much and returning right away. We had changed the various options timeout options to match the new SDK library APIs. I will double check them and post here. ","createdAt":"2020-06-01T21:24:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/424#issuecomment-637110026","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYzNzI1NzcyNg==","author":{"login":"arvindsampath"},"authorAssociation":"NONE","body":"Thanks for the tip @samarabbas. I revisited the timeout options and was able to get past the issue. In the previous version of the SDK, we had used \"setExecutionStartToCloseTimeout()\". The signatures changed a bit with the new release and we now the options \"setWorkflowRunTimeout()\" and \"setWorkflowExecutionTimeout()\". We updated the option from \"setExecutionStartToCloseTimeout()\" to  \"setWorkflowExecutionTimeout()\". I think this is causing the CRON to timeout after the specified duration. I was able to get past the issue by using \"setWorkflowRunTimeout()\".\r\n\r\n**SDK version 0.19.0 (works)**\r\n`WorkflowOptions.newBuilder()\r\n                .setExecutionStartToCloseTimeout(Duration.ofMinutes(6))\r\n                .setTaskStartToCloseTimeout(Duration.ofMinutes(1))`\r\n\r\n**SDK version 0.23.1 (CRON workflow stops executing after couple runs)**\r\n`WorkflowOptions.newBuilder()\r\n                .setWorkflowExecutionTimeout(Duration.ofMinutes(6))\r\n                .setWorkflowTaskTimeout(Duration.ofMinutes(1))`\r\n\r\n**SDK version 0.23.1 (CRON workflow runs as expected)**\r\n`WorkflowOptions.newBuilder()\r\n                .setWorkflowRunTimeout(Duration.ofMinutes(6))\r\n                .setWorkflowTaskTimeout(Duration.ofMinutes(1))`\r\n\r\nIn summary, \"WorkflowRunTimeout\" is the timeout for each workflow run whereas \"WorkflowExecutionTimeout\" is the timeout for the overall execution and in the case of CRON workflows, since the same workflow ID is used for each periodic execution, this parameter caps the total duration till which the workflow schedule is valid.The previous version of the SDK had just one timeout parameter and that was applied to each periodic run.","createdAt":"2020-06-02T04:02:35Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/424#issuecomment-637257726","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYzNzg4NTA5NA==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"Cool.  WorkflowExecutionTimeout is applicable across all runs of an execution.  Set WorkflowRunTimeout for cron use cases which runs for ever and do not set WorkflowExecutionTimeout.","createdAt":"2020-06-03T00:31:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/424#issuecomment-637885094","viewerDidAuthor":false}],"createdAt":"2020-06-01T19:54:57Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":424,"reactionGroups":[],"state":"CLOSED","title":"Workflows configured to run on a CRON schedule stop after a few executions","updatedAt":"2020-06-03T00:31:15Z","url":"https://github.com/temporalio/temporal/issues/424"}
