{"assignees":[{"id":"MDQ6VXNlcjgyNDg4MDY=","login":"sergeybykov","name":"Sergey Bykov","databaseId":0}],"author":{"id":"MDQ6VXNlcjU5Njg4OTE=","is_bot":false,"login":"7eben","name":"Zebensui MÃ©ndez Corujo"},"body":"## Expected Behavior\r\nConfigure only one keySourceUURI in jwtKeyProvider, through variable TEMPORAL_JWT_KEY_SOURCE1\r\n\r\n## Actual Behavior\r\nWhen a URI is configured through TEMPORAL_JWT_KEY_SOURCE1, and authorization and the default JWT claim mapper are enabled, no request can be authenticated since the second variable in the template (TEMPORAL_JWT_KEY_SOURCE2) is left with an empty value (\"\") and the code that updates the keys from URIs fails trying to fetch the empty string.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Configure authentication and authorization in the configuration template\r\n  2. Set JWT configuration\r\n```\r\nTEMPORAL_JWT_KEY_SOURCE1=https://host/jwks.json\r\nTEMPORAL_AUTH_AUTHORIZER=default\r\nTEMPORAL_AUTH_CLAIM_MAPPER=default\r\n```\r\n  3. Try to make a authentication request:\r\n  \r\n`$ docker run --rm -it -v /etc/certs:/etc/certs --entrypoint tctl --network host --env-file dev-environment.env temporalio/admin-tools:1.12.2`\r\n\r\n```\r\n $cat dev-environment.env\r\nTEMPORAL_CLI_ADDRESS=localhost:7233\r\nTEMPORAL_CLI_TLS_SERVER_NAME=localhost\r\nTEMPORAL_CLI_TLS_CERT=/etc/certs/server.crt\r\nTEMPORAL_CLI_TLS_KEY=/etc/certs/server.key\r\nTEMPORAL_CLI_TLS_CA=/etc/certs/ca.crt\r\n```\r\nServer logs will show:\r\n\r\n> kf-temporal             | {\"level\":\"error\",\"ts\":\"2021-11-04T13:07:45.520Z\",\"msg\":\"error while refreshing token keys: \",\"error\":\"Get \\\"\\\": unsupported protocol scheme \\\"\\\"\",\"logging-call-at\":\"default_token_key_provider.go:123\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/go/pkg/mod/go.temporal.io/server@v1.12.2/common/log/zap_logger.go:143\\ngo.temporal.io/server/common/authorization.(*defaultTokenKeyProvider).timerCallback\\n\\t/go/pkg/mod/go.temporal.io/server@v1.12.2/common/authorization/default_token_key_provider.go:123\"}\r\n\r\n## Specifications\r\n\r\n  - Version: 1.12.2\r\n  - Platform: Linux\r\n","closedAt":"2021-11-12T03:09:47Z","comments":[{"id":"IC_kwDODNqesM45S9qf","author":{"login":"7eben"},"authorAssociation":"NONE","body":"Bug code:\r\n\r\n[https://github.com/temporalio/temporal/blob/0917c302b6e4463a48844a3a12b19168e9779312/common/authorization/default_token_key_provider.go#L157](https://github.com/temporalio/temporal/blob/0917c302b6e4463a48844a3a12b19168e9779312/common/authorization/default_token_key_provider.go#L157)\r\n\r\n","createdAt":"2021-11-04T17:40:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2134#issuecomment-961272479","viewerDidAuthor":false},{"id":"IC_kwDODNqesM45WSlV","author":{"login":"sergeybykov"},"authorAssociation":"MEMBER","body":"@7eben Thank you for reporting this!\r\nDefinitely an issue we need to address.","createdAt":"2021-11-05T19:04:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2134#issuecomment-962144597","viewerDidAuthor":false}],"createdAt":"2021-11-04T17:38:46Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2134,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Unable to configure only one JWKS provider URI in configuration template","updatedAt":"2021-11-12T03:09:47Z","url":"https://github.com/temporalio/temporal/issues/2134"}
