{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjM2Mjk0NjM=","is_bot":false,"login":"denniskniep","name":"Dennis Kniep"},"body":"## Actual Behavior\r\nIf a namespace is created, deleted, created and again deleted, then there is sometimes the behavior, that temporal cli reports:\r\n```\r\nError: unable to delete namespace: Namespace has invalid state: Deleted. Must be Registered or Deprecated.\r\n```\r\nBut an invocation of list command will return that the namespace is registered:\r\n```\r\nNamespaceInfo.Name                    test0815 \r\nNamespaceInfo.State                   Registered \r\n```\r\n## Expected Behavior\r\nNamespace state should be \"Deleted\" OR Namespace should be removed after a delete call \r\n\r\n## Steps to Reproduce the Problem\r\nstart this file with `docker-compose`\r\n```\r\nversion: \"3.8\"\r\nservices:\r\n  temporal:\r\n    image: temporalio/auto-setup:1.22.3.0 \r\n    container_name: temporal-for-tests\r\n    environment:\r\n      - DB=postgres12\r\n      - DB_PORT=5432\r\n      - POSTGRES_USER=temporal\r\n      - POSTGRES_PWD=temporal\r\n      - POSTGRES_SEEDS=postgresql \r\n    ports:\r\n      - 7233:7233\r\n    depends_on:\r\n      - postgresql\r\n\r\n  postgresql:\r\n    image: postgres:13\r\n    environment:\r\n      POSTGRES_PASSWORD: temporal\r\n      POSTGRES_USER: temporal    \r\n    ports:\r\n      - 5432:5432\r\n    volumes:\r\n      - /var/lib/postgresql/data\r\n```\r\n\r\nI wrote a little bash script to reproduce the problem. It consistently reproduces the issue for me. Please let me know if this is not the case for you:\r\n```\r\nwhile true; do sleep 1;temporal operator namespace create test0815; temporal operator namespace delete -y test0815; temporal operator namespace list; echo \"###########################\"; done\r\n```","closedAt":"2024-10-31T20:17:33Z","comments":[{"id":"IC_kwDODNqesM6SE1OX","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"I can't repro this issue anymore on the current `1.25.0` release. I believe it is because on Aug 2024 there was a major refactoring of namespace registry.\r\nAlso please note that there is still a namespace cache refresh interval (default `10s`) and in multi node setup, propagation of namespace changes might take up to 10s. ","createdAt":"2024-10-31T20:17:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5250#issuecomment-2450740119","viewerDidAuthor":false}],"createdAt":"2023-12-29T22:51:27Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5250,"reactionGroups":[],"state":"CLOSED","title":"Deleted Namespace is still listed with state Registered","updatedAt":"2024-10-31T20:17:34Z","url":"https://github.com/temporalio/temporal/issues/5250"}
