{"assignees":[{"id":"U_kgDODSi3zA","login":"simvlad","name":"Vladyslav Simonenko","databaseId":0}],"author":{"id":"MDQ6VXNlcjI5NjA1OTA=","is_bot":false,"login":"vitorvezani","name":"Vitor Rodrigo Vezani"},"body":"I was trying to install the latest Temporal using the Temporal chart and Postgres as default and visibility stores.\nI managed to get the schema job working, but other workloads that connect to Postgres failed with a **generic** error.\n\n## Expected Behavior\nReceive a helpful error message that assists in debugging while using Postgres for both default and visibility stores. For example:\nWhen using Temporal chart 0.55 with Temporal server 1.24.2, I got the following error:\n\n```\nsql schema version compatibility check failed: pq: Private key has world access. Permissions should be u=rw,g=r (0640) if owned by root, or u=rw (0600), or less\n```\n\nThis clearly explains the root cause of the failure.\n\n## Actual Behavior\nWhen using chart 0.63.0 and Temporal server 1.27.2, I received this error:\n\n```\nsql schema version compatibility check failed: unable to read DB schema version keyspace/database: temporal error: no usable database connection found\n```\n\nThis message is too generic and doesn't help with debugging.\n\n## Steps to Reproduce the Problem\n\n  1.\n  1.\n  1.\n\n## Specifications\n\n  - Version: 1.27.2\n  - Platform: Kubernetes + SQL\n","closedAt":"2025-07-28T18:47:15Z","comments":[{"id":"IC_kwDODNqesM6yVT5s","author":{"login":"abusutil"},"authorAssociation":"NONE","body":"Hi @vitorvezani I have same issue with my temporal cluster (same version).\n\nI have 2 replicas of temporal services, and sometimes, one of them pass in failed state with this error.\n\nI ran Postgres on RDS\n\n```\nTEMPORAL_ADDRESS is not set, setting it to 10.1.144.137:7233\n2025/06/20 14:40:12 Loading config; env=docker,zone=,configDir=config\n2025/06/20 14:40:12 Loading config files=[config/docker.yaml]\n[Fx] PROVIDE\tfx.Lifecycle <= go.uber.org/fx.New.func1()\n[Fx] PROVIDE\tfx.Shutdowner <= go.uber.org/fx.(*App).shutdowner-fm()\n[Fx] PROVIDE\tfx.DotGraph <= go.uber.org/fx.(*App).dotGraph-fm()\n[Fx] PROVIDE\t*temporal.ServerImpl <= go.temporal.io/server/temporal.NewServerFxImpl()\n[Fx] PROVIDE\t*temporal.serverOptions <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tchan interface {} <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\ttemporal.synchronizationModeParams <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\t*config.Config <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\t*config.PProf <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tlog.Config <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tresource.ServiceNames <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tresource.NamespaceLogger <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tresolver.ServiceResolver <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tclient.AbstractDataStoreFactory <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tvisibility.VisibilityStoreFactory <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tsearchattribute.Mapper <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\t[]grpc.UnaryServerInterceptor <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tauthorization.Authorizer <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tauthorization.ClaimMapper <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tauthorization.JWTAudienceMapper <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tmap[primitives.ServiceName]static.Hosts <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tlog.Logger <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tclient.FactoryProvider <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tdynamicconfig.Client <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tencryption.TLSConfigProvider <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\t*client.Config <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tclient.Client <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tmetrics.Handler <= go.temporal.io/server/temporal.ServerOptionsProvider()\n[Fx] PROVIDE\tarchiver.ArchivalMetadata <= go.temporal.io/server/common/resource.ArchivalMetadataProvider()\n[Fx] PROVIDE\ttasks.TaskCategoryRegistry <= go.temporal.io/server/temporal.TaskCategoryRegistryProvider()\n[Fx] PROVIDE\tclient.FactoryProviderFn <= go.temporal.io/server/temporal.PersistenceFactoryProvider()\n[Fx] PROVIDE\t*temporal.ServicesMetadata[group = \"services\"] <= go.temporal.io/server/temporal.HistoryServiceProvider()\n[Fx] PROVIDE\t*temporal.ServicesMetadata[group = \"services\"] <= go.temporal.io/server/temporal.MatchingServiceProvider()\n[Fx] PROVIDE\t*temporal.ServicesMetadata[group = \"services\"] <= go.temporal.io/server/temporal.FrontendServiceProvider()\n[Fx] PROVIDE\t*temporal.ServicesMetadata[group = \"services\"] <= go.temporal.io/server/temporal.InternalFrontendServiceProvider()\n[Fx] PROVIDE\t*temporal.ServicesMetadata[group = \"services\"] <= go.temporal.io/server/temporal.WorkerServiceProvider()\n[Fx] PROVIDE\t*cluster.Config <= go.temporal.io/server/temporal.ApplyClusterMetadataConfigProvider()\n[Fx] PROVIDE\tconfig.Persistence <= go.temporal.io/server/temporal.ApplyClusterMetadataConfigProvider()\n[Fx] PROVIDE\t*dynamicconfig.Collection <= go.temporal.io/server/common/dynamicconfig.init.func1()\n[Fx] PROVIDE\tpingable.Pingable[group = \"deadlockDetectorRoots\"] <= fx.Annotate(go.temporal.io/server/common/dynamicconfig.init.func2(), fx.ResultTags([\"group:\\\"deadlockDetectorRoots\\\"\"])\n[Fx] PROVIDE\t*pprof.PProfInitializerImpl <= go.temporal.io/server/common/pprof.NewInitializer()\n[Fx] PROVIDE\t[]trace.SpanExporter <= go.temporal.io/server/temporal.init.func2()\n[Fx] SUPPLY\t[]temporal.ServerOption\n[Fx] RUN\tsupply: stub([]temporal.ServerOption) in 7.035Âµs\n[Fx] RUN\tprovide: go.temporal.io/server/temporal.ServerOptionsProvider() in 4m26.292986253s\n[Fx] Error returned: received non-nil error from function \"go.temporal.io/server/temporal\".ServerOptionsProvider\n\t/home/runner/work/docker-builds/docker-builds/temporal/temporal/fx.go:182:\nsql schema version compatibility check failed: unable to read DB schema version keyspace/database: temporal error: no usable database connection found\n[Fx] ERROR\t\tFailed to initialize custom logger: could not build arguments for function \"go.uber.org/fx\".(*module).constructCustomLogger.func2\n\t/home/runner/go/pkg/mod/go.uber.org/fx@v1.23.0/module.go:294:\nfailed to build fxevent.Logger:\ncould not build arguments for function \"go.temporal.io/server/temporal\".init.func7\n\t/home/runner/work/docker-builds/docker-builds/temporal/temporal/fx.go:1008:\nfailed to build log.Logger:\nreceived non-nil error from function \"go.temporal.io/server/temporal\".ServerOptionsProvider\n\t/home/runner/work/docker-builds/docker-builds/temporal/temporal/fx.go:182:\nsql schema version compatibility check failed: unable to read DB schema version keyspace/database: temporal error: no usable database connection found\nUnable to create server. Error: could not build arguments for function \"go.uber.org/fx\".(*module).constructCustomLogger.func2 (/home/runner/go/pkg/mod/go.uber.org/fx@v1.23.0/module.go:294): failed to build fxevent.Logger: could not build arguments for function \"go.temporal.io/server/temporal\".init.func7 (/home/runner/work/docker-builds/docker-builds/temporal/temporal/fx.go:1008): failed to build log.Logger: received non-nil error from function \"go.temporal.io/server/temporal\".ServerOptionsProvider (/home/runner/work/docker-builds/docker-builds/temporal/temporal/fx.go:182): sql schema version compatibility check failed: unable to read DB schema version keyspace/database: temporal error: no usable database connection found.\n```","createdAt":"2025-06-20T14:55:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7939#issuecomment-2991930988","viewerDidAuthor":false},{"id":"IC_kwDODNqesM61yF8r","author":{"login":"sstaley-hioscar"},"authorAssociation":"NONE","body":"Also seeing this.","createdAt":"2025-07-08T17:48:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7939#issuecomment-3049807659","viewerDidAuthor":false},{"id":"IC_kwDODNqesM62WaU6","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@yycptt will take a look, thanks for reporting.","createdAt":"2025-07-10T22:25:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7939#issuecomment-3059328314","viewerDidAuthor":false},{"id":"IC_kwDODNqesM62XQ2T","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Looks like the error message regression was introduced in [this](https://github.com/temporalio/temporal/pull/5926) change and the connection error only got logged [here](https://github.com/temporalio/temporal/pull/5926/files#diff-9e5283ffb69214de32387c03d7730f0694113e7957cd0ceba91da6c68e84f96eR125) but not returned.\n\nShouldn't be hard to just return the connection error from the `reconnect` method. I will find some time try doing that. ","createdAt":"2025-07-10T23:43:33Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7939#issuecomment-3059551635","viewerDidAuthor":false}],"createdAt":"2025-06-18T20:03:40Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7939,"reactionGroups":[],"state":"CLOSED","title":"Unclear error message on Postgres misconfiguration: 'no usable database connection found'","updatedAt":"2025-07-28T18:47:15Z","url":"https://github.com/temporalio/temporal/issues/7939"}
