{"assignees":[],"author":{"id":"MDQ6VXNlcjEyMDM4OTM=","is_bot":false,"login":"josh-berry","name":"Josh Berry"},"body":"## Expected Behavior\r\n\r\nServer rejects the RPC with an error, but continues to run.\r\n\r\n## Actual Behavior\r\n\r\nServer crashes (that is, `temporal server start-dev` exits with error code 1).\r\n\r\nError log message: `{\"level\":\"fatal\",...,\"msg\":\"Invalid rpcAddress for remote cluster\",\"error\":\"address asdf: missing port in address\",\"logging-call-at\":\"rpc.go:191\",` ...\r\n\r\nStack trace:\r\n\r\n```\r\ngo.temporal.io/server/common/log.(*zapLogger).Fatal\r\n        go.temporal.io/server@v1.22.4/common/log/zap_logger.go:180\r\ngo.temporal.io/server/common/rpc.(*RPCFactory).CreateRemoteFrontendGRPCConnection\r\n        go.temporal.io/server@v1.22.4/common/rpc/rpc.go:191\r\ngo.temporal.io/server/client.(*rpcClientFactory).NewRemoteAdminClientWithTimeout\r\n        go.temporal.io/server@v1.22.4/client/clientfactory.go:195\r\ngo.temporal.io/server/service/frontend.(*OperatorHandlerImpl).AddOrUpdateRemoteCluster\r\n        go.temporal.io/server@v1.22.4/service/frontend/operator_handler.go:607\r\ngo.temporal.io/api/operatorservice/v1._OperatorService_AddOrUpdateRemoteCluster_Handler.func1\r\n        go.temporal.io/api@v1.26.0/operatorservice/v1/service.pb.go:347\r\ngo.temporal.io/server/common/rpc/interceptor.(*RetryableInterceptor).Intercept.func1\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/retry.go:63\r\ngo.temporal.io/server/common/backoff.ThrottleRetryContext\r\n        go.temporal.io/server@v1.22.4/common/backoff/retry.go:145\r\ngo.temporal.io/server/common/rpc/interceptor.(*RetryableInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/retry.go:67\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*CallerInfoInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/caller_info.go:80\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*SDKVersionInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/sdk_version.go:69\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*RateLimitInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/rate_limit.go:88\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceRateLimitInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/namespace_rate_limit.go:93\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*ConcurrentRequestLimitInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/concurrent_request_limit.go:121\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceValidatorInterceptor).StateValidationIntercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/namespace_validator.go:194\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryInterceptor).UnaryIntercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/telemetry.go:165\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/service/frontend.(*RedirectionInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/service/frontend/redirection_interceptor.go:180\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/authorization.(*interceptor).Interceptor\r\n        go.temporal.io/server@v1.22.4/common/authorization/interceptor.go:158\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/service/frontend.GrpcServerOptionsProvider.NewServerMetricsContextInjectorInterceptor.func1\r\n        go.temporal.io/server@v1.22.4/common/metrics/grpc.go:66\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc.UnaryServerInterceptor.func1\r\n        go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc@v0.42.0/interceptor.go:344\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceLogInterceptor).Intercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/namespace_logger.go:84\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceValidatorInterceptor).NamespaceValidateIntercept\r\n        go.temporal.io/server@v1.22.4/common/rpc/interceptor/namespace_validator.go:111\r\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1163\r\ngo.temporal.io/server/common/rpc.ServiceErrorInterceptor\r\n        go.temporal.io/server@v1.22.4/common/rpc/grpc.go:145\r\ngoogle.golang.org/grpc.NewServer.chainUnaryServerInterceptors.chainUnaryInterceptors.func1\r\n        google.golang.org/grpc@v1.59.0/server.go:1154\r\ngo.temporal.io/api/operatorservice/v1._OperatorService_AddOrUpdateRemoteCluster_Handler\r\n        go.temporal.io/api@v1.26.0/operatorservice/v1/service.pb.go:349\r\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\r\n        google.golang.org/grpc@v1.59.0/server.go:1343\r\ngoogle.golang.org/grpc.(*Server).handleStream\r\n        google.golang.org/grpc@v1.59.0/server.go:1737\r\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.1\r\n        google.golang.org/grpc@v1.59.0/server.go:986\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. `temporal server start-dev`\r\n  1. `temporal operator cluster upsert --frontend-address=asdf`\r\n  1. Server process exits with error code 1.\r\n\r\n(I'm not sure if this is repro'able on an actual server, but the crash is coming from within server code, so I would assume soâ€”hence why I'm filing the issue here instead of against the CLI.)\r\n\r\n## Specifications\r\n\r\n  - Version: `temporal version 0.11.0 (server 1.22.4) (ui 2.21.3)`\r\n  - Platform: Mac ARM\r\n","closedAt":null,"comments":[],"createdAt":"2024-03-22T22:09:35Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5587,"reactionGroups":[],"state":"OPEN","title":"dev-server crash on AddOrUpdateRemoteCluster RPC with invalid frontend address","updatedAt":"2024-03-22T22:09:35Z","url":"https://github.com/temporalio/temporal/issues/5587"}
