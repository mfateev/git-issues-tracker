{"assignees":[{"id":"MDQ6VXNlcjEyNjAyNTAy","login":"Ardagan","name":"Mikhail Gryzykhin","databaseId":0},{"id":"MDQ6VXNlcjg0NDExMDE0","login":"yiminc","name":"Yimin Chen","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0ODAyNTI=","is_bot":false,"login":"nvtkaszpir","name":"Michał Sochoń"},"body":"## Expected Behavior\r\ntemporal-cassandra-tool  update would work even if previous exetutions were aborted,\r\nThis means temporal-cassandra-tool queries should be idempotent.\r\n\r\n## Actual Behavior\r\nif previous execution was aborted then temporal-cassandra-tool execution will end with error.\r\n\r\n```text\r\nbash-5.0$ temporal-cassandra-tool -k temporal update -schema-dir /etc/temporal/schema/cassandra/temporal/versioned\r\n2021/09/27 12:49:23 validating connection to cassandra cluster\r\n2021/09/27 12:49:23 connection validation succeeded\r\n2021/09/27 12:49:23 UpdateSchemeTask started, config=&{DBName: TargetVersion: SchemaDir:/etc/temporal/schema/cassandra/temporal/versioned IsDryRun:false}\r\n2021/09/27 12:49:23 ---- Executing updates for version 1.0 ----\r\n2021/09/27 12:49:23 CREATE TYPE serialized_event_batch (encoding_type text,version int,data blob,);\r\n2021/09/27 12:49:23 error executing statement:A user type of name temporal.serialized_event_batch already exists\r\n\r\n```\r\n\r\n## Suggested fix\r\n\r\nChange `CREATE TYPE` to `CREATE TYPE IF NOT EXISTS`\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. spawn cassandra, start invoking commands to create temporal setup schema and update schema\r\n  1. abort command in the middle of the execition\r\n  1. try to execute again\r\n  1. see error logs and cry \r\n\r\n## Specifications\r\n\r\n  - Version: 1.11.4\r\n  - Platform: kubernetes\r\n","closedAt":"2023-08-27T17:47:17Z","comments":[{"id":"IC_kwDODNqesM5IeuyF","author":{"login":"brianlu-scale"},"authorAssociation":"NONE","body":"Hello, has there been any update to this? Running into a similar problem and wanted to see how to resolve it.","createdAt":"2022-08-16T00:33:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1981#issuecomment-1216015493","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5iUgwi","author":{"login":"jackingyu"},"authorAssociation":"NONE","body":"Will this be fixed?","createdAt":"2023-07-25T10:18:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1981#issuecomment-1649544226","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lA3C3","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"This is fixed as part of https://github.com/temporalio/temporal/pull/4761","createdAt":"2023-08-27T17:47:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1981#issuecomment-1694724279","viewerDidAuthor":false}],"createdAt":"2021-09-27T12:55:11Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":1981,"reactionGroups":[],"state":"CLOSED","title":"temporal-cassandra-tool update schema fails if previous execution was aborted","updatedAt":"2023-08-27T17:47:18Z","url":"https://github.com/temporalio/temporal/issues/1981"}
