{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMzE1MA==","is_bot":false,"login":"pauldotknopf","name":"Paul Knopf"},"body":"## Expected Behavior\r\n\r\nI expected it to use the database name that's configured in the helm chart.\r\n\r\nHere is the init container that's created from the helm chart\r\n\r\n```yaml\r\n- command:\r\n    - temporal-sql-tool\r\n    - create-database\r\n    env:\r\n    - name: SQL_PLUGIN\r\n      value: postgres12\r\n    - name: SQL_HOST\r\n      value: 10.63.7.94\r\n    - name: SQL_PORT\r\n      value: \"5432\"\r\n    - name: SQL_DATABASE\r\n      value: citus\r\n    - name: SQL_USER\r\n      value: citus\r\n    - name: SQL_PASSWORD\r\n      valueFrom:\r\n        secretKeyRef:\r\n          key: password\r\n          name: temporal-default-store\r\n    image: temporalio/admin-tools:1.24.2-tctl-1.18.1-cli-0.13.0\r\n    imagePullPolicy: IfNotPresent\r\n    name: create-default-store\r\n    resources: {}\r\n    terminationMessagePath: /dev/termination-log\r\n    terminationMessagePolicy: File\r\n    volumeMounts:\r\n    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount\r\n      name: kube-api-access-lxgvw\r\n      readOnly: true\r\n```\r\n\r\nHere is the yaml used for the helm chart:\r\n\r\n```yaml\r\nvalues:\r\n    cassandra:\r\n      enabled: false\r\n    prometheus:\r\n      enabled: false\r\n    elasticsearch:\r\n      enabled: false\r\n    grafana:\r\n      enabled: false\r\n    server:\r\n      config:\r\n        persistence:\r\n          default:\r\n            driver: \"sql\"\r\n            sql:\r\n              driver: \"postgres12\"\r\n              host: 0.0.0.0 # omited\r\n              port: 5432\r\n              database: citus\r\n              user: citus\r\n              password: blah #omited\r\n              maxConns: 20\r\n              maxConnLifetime: \"1h\"\r\n             \r\n          visibility:\r\n            driver: \"sql\"\r\n\r\n            sql:\r\n              driver: \"postgres12\"\r\n              host: 0.0.0.0 #omited\r\n              port: 5432\r\n              database: citus\r\n              user: citus\r\n              password: blah #omited\r\n              maxConns: 20\r\n              maxConnLifetime: \"1h\"\r\n```\r\n\r\n## Actual Behavior\r\n\r\nI expected it to use the ```citus``` database referenced.\r\n\r\n```bash\r\n> kubectl logs temporal-schema-ttjv2 -c create-default-store\r\n2024-08-23T10:04:50.384Z\tERROR\tUnable to create SQL database.\t{\"error\": \"unable to connect to DB, tried default DB names: postgres,defaultdb, errors: [pq: no pg_hba.conf entry for host \\\"fd40:6eea:20:81c1:8220:100:a45:1008\\\", user \\\"citus\\\", database \\\"postgres\\\", no encryption pq: no pg_hba.conf entry for host \\\"fd40:6eea:20:81c1:8220:100:a45:1008\\\", user \\\"citus\\\", database \\\"defaultdb\\\", no encryption]\", \"logging-call-at\": \"handler.go:94\"}\r\n```\r\n","closedAt":"2024-08-23T13:40:39Z","comments":[{"id":"IC_kwDODNqesM6Jflko","author":{"login":"pauldotknopf"},"authorAssociation":"NONE","body":"I'm realizing this is a bug related to the helm charts, so I posted this issue to that repo to ([here](https://github.com/temporalio/helm-charts/issues/549)).","createdAt":"2024-08-23T10:08:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6435#issuecomment-2306758952","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6Jg9-R","author":{"login":"pauldotknopf"},"authorAssociation":"NONE","body":"I need to enable TLS and disable host verification.","createdAt":"2024-08-23T13:40:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6435#issuecomment-2307121041","viewerDidAuthor":false}],"createdAt":"2024-08-23T10:06:43Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":6435,"reactionGroups":[],"state":"CLOSED","title":"helmchart create-database error \"unable to connect to DB, tried default DB names: postgres,defaultdb\"","updatedAt":"2024-08-23T13:40:40Z","url":"https://github.com/temporalio/temporal/issues/6435"}
