{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ☺️"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nCall `client.workflow.list` and then do `for await (const workflow of list) {`.\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\nExecution doesn't reach inside the loop. Instead, after several seconds, I get:\r\n\r\n```\r\nError: 2 UNKNOWN: unexpected end of JSON input\r\n  at Object.callErrorFromStatus (/Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/call.js:31:19)\r\n  at Object.onReceiveStatus (/Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/client.js:195:52)\r\n  at /Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/call-stream.js:111:35\r\n  at Object.onReceiveStatus (/Users/me/test/temporal-delivery/node_modules/@temporalio/client/lib/grpc-retry.  at Object.onReceiveStatus (/Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/ 65:141)\r\n  at Object.onReceiveStatus (/Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/ 28:181)\r\n  at /Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/call-stream.js:188:78\r\n  at processTicksAndRejections (node:internal/process/task_queues:78:11)\r\n  call at\r\n  at ServiceClientImpl.makeUnaryRequest (/Users/me/test/temporal-delivery/node_modules/@grpc/grpc-js/build/src/client.  at Service.rpcImpl (/Users/me/test/temporal-delivery/node_modules/@temporalio/client/lib/connection.js:206:27)\r\n  at Service.rpcCall (/Users/me/test/temporal-delivery/node_modules/protobufjs/src/rpc/service.js:94:21)\r\n  at executor (/Users/me/test/temporal-delivery/node_modules/@protobufjs/aspromise/index.js:44:16)\r\n  at new Promise (<anonymous>)\r\n  at Object.asPromise (/Users/me/test/temporal-delivery/node_modules/@protobufjs/aspromise/index.js:28:12)\r\n  at Service.rpcCall (/Users/me/test/temporal-delivery/node_modules/protobufjs/src/rpc/service.js:86:21)\r\n  at Service.listWorkflowExecutions (eval at Codegen (/Users/me/test/temporal-delivery/node_modules/@protobufjs/  <anonymous>:4:15)\r\n  at WorkflowClient._list (/Users/me/test/temporal-delivery/node_modules/@temporalio/client/lib/workflow-client.  at _list.next (<anonymous>)\r\n  at eval (webpack-internal:///(api)/./pages/api/[trpc].ts:29:26)\r\n  at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n  at async resolveMiddleware (file:///Users/me/test/temporal-delivery/node_modules/@trpc/server/dist/index.mjs:383:30)\r\n  at async callRecursive (file:///Users/me/test/temporal-delivery/node_modules/@trpc/server/dist/index.mjs:419:32)\r\n  at async next (file:///Users/me/test/temporal-delivery/node_modules/@trpc/server/dist/index.mjs:427:32) {\r\n```\r\n\r\nThis happens with CLI:\r\n\r\n```\r\n$ temporal -v\r\ntemporal version 0.6.0 (server 1.20.0) (ui 2.11.0)\r\n```\r\n\r\nbut it works fine with:\r\n\r\n```\r\n$ temporalite -v\r\ntemporalite version (devel) (server 1.17.3)\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\n```\r\nnpx @temporalio/create@latest ./temporal-delivery --sample food-delivery\r\ncd ./temporal-delivery\r\nnpm run dev\r\n```\r\n\r\nOpen localhost:3000, click order button, open localhost:3001. You'll see the error in the terminal. Execution doesn't get past this line: https://github.com/temporalio/samples-typescript/blob/ba6208155bc7b547c76931b7e14e92ce4594af28/food-delivery/apps/driver/pages/api/%5Btrpc%5D.ts#L24","closedAt":"2023-03-21T23:21:43Z","comments":[{"id":"IC_kwDODNqesM5Xh_e_","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"`ListWorkflowExecutions` gRPC method works both with `temporalite` and `temporal`.\r\n\r\n![image](https://user-images.githubusercontent.com/251288/224906451-1ac486ff-e583-4d94-8e53-6cd4b34f21e9.png)\r\n","createdAt":"2023-03-14T05:39:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4053#issuecomment-1468528575","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5Xh_he","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"This is is a server issue, transferring.","createdAt":"2023-03-14T17:29:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4053#issuecomment-1468528734","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5X6ne8","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@bergundy could you provide more context on why you think this is server issue? ","createdAt":"2023-03-18T20:23:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4053#issuecomment-1474983868","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5YCFW2","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Server returned this issue while processing `listWorkflowExecutions`:\r\n```\r\nError: 2 UNKNOWN: unexpected end of JSON input\r\n```","createdAt":"2023-03-20T21:11:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4053#issuecomment-1476941238","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5YIkpu","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"Found the bug. It only happens with new SQL DB configs (with advanced visibility).\r\nThe API is making a call with token being `[]byte{}` and the code is only checking against `nil`, not empty data.\r\nPR https://github.com/temporalio/temporal/pull/4074 fixes it.","createdAt":"2023-03-21T21:57:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4053#issuecomment-1478642286","viewerDidAuthor":false}],"createdAt":"2023-03-14T05:37:39Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":4053,"reactionGroups":[],"state":"CLOSED","title":"[Bug] `unexpected end of JSON input` with latest CLI","updatedAt":"2023-03-21T23:21:43Z","url":"https://github.com/temporalio/temporal/issues/4053"}
