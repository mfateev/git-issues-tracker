{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjM3MjE0MQ==","is_bot":false,"login":"skrul","name":"Steve Krulewitz"},"body":"Back in the Temporal 1.3.2 days, I used the following command to create the visibility db, accidentally specifying the wrong version number:\r\n```\r\ntemporal-sql-tool \\\r\n  --endpoint $VISIBILITY_HOST \\\r\n  --port $VISIBILITY_PORT \\\r\n  --database $VISIBILITY_DATABASE \\\r\n  setup-schema \\\r\n  --version 1.1 \\\r\n  --schema-file /etc/temporal/schema/mysql/v57/visibility/schema.sql\r\n```\r\n\r\nThe visibility database schema was only at version 1.0 at the time, but this command did run successfully. The result was that I had a database with the 1.0 schema but the `schema_version` and `schema_update_history` tables said it was version 1.1.\r\n\r\nIdeally I would not have been allowed to make this mistake!\r\n","closedAt":"2021-03-24T19:56:20Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc2NTc0NDM1MQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"hi,\r\n\r\ni checked the code logic. \r\n\r\nthe command used above is actually one supported feature, i.e. combining multiple version worth of schema changes into one file to reduce number of changes.\r\n\r\nhere is usually how we setup / upgrade the schema in dev env:\r\nhttps://github.com/temporalio/temporal/blob/v1.6.0/Makefile#L324-L325\r\nhttps://github.com/temporalio/temporal/blob/v1.6.0/Makefile#L328-L329\r\n\r\nbtw, i will keep the issue open in case","createdAt":"2021-01-22T23:35:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1215#issuecomment-765744351","viewerDidAuthor":false}],"createdAt":"2021-01-22T21:38:22Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"},{"id":"MDU6TGFiZWwyNzcwMzY2NzYw","name":"close-after-30-days","description":"","color":"1d76db"}],"milestone":null,"number":1215,"reactionGroups":[],"state":"CLOSED","title":"Possible to set up new cluster with bad database version","updatedAt":"2021-03-24T19:56:20Z","url":"https://github.com/temporalio/temporal/issues/1215"}
