{"assignees":[],"author":{"id":"MDQ6VXNlcjM3MDcwMzc0","is_bot":false,"login":"Frank-linkin","name":""},"body":"## Expected Behavior\r\n\r\nExpect temporal-server will close smoothly.\r\n\r\n## Actual Behavior\r\n\r\npanic.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. temporal start and almost simultaneously stop signal arrival.\r\n  2. sometimes panic will raise（Must be quick） \r\n\r\n## Specifications\r\n\r\nWorker, history, frontend, and matching service are expected to start. But when starting, the stop signal arrives, and the panic will raise. But must be quick. If you find my description is ambiguous, compare the log in 2022-05-17T06:56 with others, combining what I said above, you will see what I am referring to. panic occurred exactly in 2022-05-17T06:56.\r\n\r\n```bash\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:21:21.648+0800\",\"msg\":\"worker starting\",\"service\":\"worker\",\"component\":\"worker\",\"logging-call-at\":\"service.go:314\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:21:21.654+0800\",\"msg\":\"history starting\",\"service\":\"history\",\"logging-call-at\":\"service.go:100\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:21:21.662+0800\",\"msg\":\"frontend starting\",\"service\":\"frontend\",\"logging-call-at\":\"service.go:236\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:21:21.672+0800\",\"msg\":\"matching starting\",\"service\":\"matching\",\"logging-call-at\":\"service.go:92\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:21:41.511+0800\",\"msg\":\"Received interrupt signal, stopping the server.\",\"value\":\"terminated\",\"logging-call-at\":\"server_impl.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:21:41.511+0800\",\"msg\":\"worker service stopped\",\"service\":\"worker\",\"component\":\"worker\",\"address\":\"0.0.0.0:17003\",\"logging-call-at\":\"service.go:383\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:42:22.854+0800\",\"msg\":\"frontend starting\",\"service\":\"frontend\",\"logging-call-at\":\"service.go:236\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:42:22.862+0800\",\"msg\":\"matching starting\",\"service\":\"matching\",\"logging-call-at\":\"service.go:92\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:42:22.868+0800\",\"msg\":\"history starting\",\"service\":\"history\",\"logging-call-at\":\"service.go:100\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:42:26.887+0800\",\"msg\":\"worker starting\",\"service\":\"worker\",\"component\":\"worker\",\"logging-call-at\":\"service.go:314\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:43:09.335+0800\",\"msg\":\"Received interrupt signal, stopping the server.\",\"value\":\"terminated\",\"logging-call-at\":\"server_impl.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:43:09.336+0800\",\"msg\":\"worker service stopped\",\"service\":\"worker\",\"component\":\"worker\",\"address\":\"0.0.0.0:17003\",\"logging-call-at\":\"service.go:383\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:52:34.308+0800\",\"msg\":\"matching starting\",\"service\":\"matching\",\"logging-call-at\":\"service.go:92\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:52:34.317+0800\",\"msg\":\"frontend starting\",\"service\":\"frontend\",\"logging-call-at\":\"service.go:236\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:52:34.319+0800\",\"msg\":\"history starting\",\"service\":\"history\",\"logging-call-at\":\"service.go:100\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:52:40.665+0800\",\"msg\":\"worker starting\",\"service\":\"worker\",\"component\":\"worker\",\"logging-call-at\":\"service.go:314\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:53:13.666+0800\",\"msg\":\"Received interrupt signal, stopping the server.\",\"value\":\"terminated\",\"logging-call-at\":\"server_impl.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:53:13.668+0800\",\"msg\":\"worker service stopped\",\"service\":\"worker\",\"component\":\"worker\",\"address\":\"0.0.0.0:17003\",\"logging-call-at\":\"service.go:383\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:56:50.625+0800\",\"msg\":\"matching starting\",\"service\":\"matching\",\"logging-call-at\":\"service.go:92\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:56:51.057+0800\",\"msg\":\"frontend starting\",\"service\":\"frontend\",\"logging-call-at\":\"service.go:236\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:56:51.273+0800\",\"msg\":\"Received interrupt signal, stopping the server.\",\"value\":\"terminated\",\"logging-call-at\":\"server_impl.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T06:56:51.273+0800\",\"msg\":\"worker starting\",\"service\":\"worker\",\"component\":\"worker\",\"logging-call-at\":\"service.go:314\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T07:00:23.183+0800\",\"msg\":\"history starting\",\"service\":\"history\",\"logging-call-at\":\"service.go:100\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T07:00:23.190+0800\",\"msg\":\"frontend starting\",\"service\":\"frontend\",\"logging-call-at\":\"service.go:236\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T07:00:23.198+0800\",\"msg\":\"worker starting\",\"service\":\"worker\",\"component\":\"worker\",\"logging-call-at\":\"service.go:314\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T07:00:23.204+0800\",\"msg\":\"matching starting\",\"service\":\"matching\",\"logging-call-at\":\"service.go:92\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-17T07:00:44.205+0800\",\"msg\":\"Received interrupt signal, stopping the server.\",\"value\":\"terminated\",\"logging-call-at\":\"server_impl.go:142\"}\r\n```\r\n\r\nfrom code service/worker/services.go, it seems that you just checked whether start() is invoked but did check whether it is complete. So I raise this issue. But I don't think any one in practical will do this to trigger the panic, except those software testor :).\r\n\r\n\r\n  - Version:v0.11.0\r\n  - Platform:","closedAt":"2023-11-14T02:27:32Z","comments":[{"id":"IC_kwDODNqesM5r2eh2","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Tried with latest server, start and then Ctrl+C right away, not able to repro. I'm not sure if your version v0.11.0 is correct. \r\n\r\nPlease reopen this if you could provide a panic log that could help us debug further. ","createdAt":"2023-11-14T02:27:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2899#issuecomment-1809442934","viewerDidAuthor":false}],"createdAt":"2022-05-25T09:48:33Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2899,"reactionGroups":[],"state":"CLOSED","title":"Panic will raise if shutdown temporal in a very shorttime from starting(Must be almost simultaneous)","updatedAt":"2023-11-14T02:27:32Z","url":"https://github.com/temporalio/temporal/issues/2899"}
