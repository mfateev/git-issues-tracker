{"assignees":[{"id":"MDQ6VXNlcjEzNzE0NjI0","login":"jmbarzee","name":"Jacob Barzee","databaseId":0}],"author":{"id":"U_kgDOCHqfmQ","is_bot":false,"login":"natenjoy","name":"Nathaniel Allred"},"body":"## Expected Behavior\r\nQuery from the command line returns a result for the query that is still in `Running` status. Query:\r\n\r\n```\r\ntemporal workflow list -n preflight --address 10.43.63.119:7233 -q 'CloseTime is null AND WorkflowId = \"S329229X8820832\"'\r\n```\r\n\r\n## Actual Behavior\r\nQuery returns no results.\r\n\r\nOddly, if I do the same query but query where close time is not null (`CloseTime it not null`), I get results for all past workflows AND the currently running workflow. \r\n\r\nIf I further do a json-formatted output on the list, the one that is running does not show a close time. (query `temporal workflow list -n preflight --address 10.43.63.119:7233 -q 'CloseTime is not null AND WorkflowId = \"S329229X8820832\"' -o json`)\r\n```\r\n{\r\n    \"execution\": {\r\n      \"workflow_id\": \"S329229X8820832\",\r\n      \"run_id\": \"8b9279db-15e6-4296-bb71-e1c2569af382\"\r\n    },\r\n    \"type\": {\r\n      \"name\": \"Preflight\"\r\n    },\r\n    \"start_time\": \"2024-09-30T17:19:35.465393Z\",\r\n    \"status\": 1,\r\n    \"execution_time\": \"2024-09-30T17:19:35.465393Z\",\r\n    \"memo\": {},\r\n    \"search_attributes\": {\r\n      \"indexed_fields\": {\r\n        \"BuildIds\": {\r\n          \"metadata\": {\r\n            \"encoding\": \"anNvbi9wbGFpbg==\",\r\n            \"type\": \"S2V5d29yZExpc3Q=\"\r\n          },\r\n          \"data\": \"WyJ1bnZlcnNpb25lZCIsInVudmVyc2lvbmVkOjczMTQwYjk0MmMzNmQyOWM0YTBjNWY3NTBiMWNjMTEyIl0=\"\r\n        }\r\n      }\r\n    },\r\n    \"task_queue\": \"PREFLIGHT\"\r\n  }\r\n```\r\n\r\nOne of the closed ones that does have a close time, does show the close time in the output:\r\n```\r\n{\r\n    \"execution\": {\r\n      \"workflow_id\": \"S329229X8820832\",\r\n      \"run_id\": \"d3324372-98e0-40e9-a874-326bd48cfc0e\"\r\n    },\r\n    \"type\": {\r\n      \"name\": \"Preflight\"\r\n    },\r\n    \"start_time\": \"2024-09-19T20:52:55.034558Z\",\r\n    \"close_time\": \"2024-09-26T20:21:24.576403Z\",\r\n    \"status\": 4,\r\n    \"history_length\": 24,\r\n    \"execution_time\": \"2024-09-19T20:52:55.034558Z\",\r\n    \"memo\": {},\r\n    \"search_attributes\": {\r\n      \"indexed_fields\": {\r\n        \"BuildIds\": {\r\n          \"metadata\": {\r\n            \"encoding\": \"anNvbi9wbGFpbg==\",\r\n            \"type\": \"S2V5d29yZExpc3Q=\"\r\n          },\r\n          \"data\": \"WyJ1bnZlcnNpb25lZCIsInVudmVyc2lvbmVkOjhkN2JlMGQwYWNiOTUyMDkxOGFiODc3N2I2MTk5NzE2IiwidW52ZXJzaW9uZWQ6NzMxNDBiOTQyYzM2ZDI5YzRhMGM1Zjc1MGIxY2MxMTIiXQ==\"\r\n        }\r\n      }\r\n    },\r\n    \"task_queue\": \"PREFLIGHT\",\r\n    \"state_transition_count\": 16,\r\n    \"history_size_bytes\": 11290\r\n  }\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a workflow that stays running long enough to run queries.\r\n  1. Run the query.\r\n\r\n## Specifications\r\nThe query has worked *locally* using https://temporal.io/blog/auto-setup and the docker hub image https://hub.docker.com/r/temporalio/server, but does not work in a self hosted environment. Description of the self hosted envrionment:\r\n* Runs in kubernetes\r\n* Set up following https://github.com/temporalio/helm-charts, with chart deployetemporal-0.37.0 , version 1.23.1\r\n* Visibility store is set up against a postgres:16.3 running in the same kube cluster\r\n* As stated in the chart, temporal version is 1.23.1\r\n","closedAt":"2024-12-24T17:06:11Z","comments":[{"id":"IC_kwDODNqesM6SFvQT","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Thanks, we will take a look.","createdAt":"2024-10-31T22:46:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/6576#issuecomment-2450977811","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6VzJ8k","author":{"login":"jmbarzee"},"authorAssociation":"MEMBER","body":"Thanks @natenjoy. We've found the cause and evaluating solutions.\r\n\r\nFor a work around, you can query based on the execution status (in the UI, `status` in the output you posted). Any case where you would expect `close_time` to be `null`  `status` will be `Running`","createdAt":"2024-12-02T23:50:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6576#issuecomment-2513215268","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6VztY-","author":{"login":"natenjoy"},"authorAssociation":"NONE","body":"Thanks. Discovered that workaround for close_time/status. IIRC I was also seeing it when trying to query for null/not null for other things like custom Keywords.","createdAt":"2024-12-03T01:48:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6576#issuecomment-2513360446","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6W-KHN","author":{"login":"jmbarzee"},"authorAssociation":"MEMBER","body":"The issue we've identified is exclusively related to close_time. The custom Keywords is likely another issue.\r\n\r\n If you have reproduction steps for the custom keyword I would be grateful to have a separate issue filled in the repo to track it. Could you add some clarifying details on what you are seeing there? ","createdAt":"2024-12-10T20:57:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6576#issuecomment-2532876749","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6YqkRv","author":{"login":"jmbarzee"},"authorAssociation":"MEMBER","body":"#6965 Addressed this issue.","createdAt":"2024-12-24T17:05:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/6576#issuecomment-2561295471","viewerDidAuthor":false}],"createdAt":"2024-09-30T17:43:42Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":6576,"reactionGroups":[],"state":"CLOSED","title":"Query for `CloseTime is null` does not return results","updatedAt":"2024-12-24T17:06:11Z","url":"https://github.com/temporalio/temporal/issues/6576"}
