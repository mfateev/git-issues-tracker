{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nToday shutting down a single-binary server gives something like:\r\n\r\n```\r\n2023-05-11T14:45:49.683-0700\tERROR\tError looking up host for shardID\t{\"component\": \"shard-controller\", \"address\": \"127.0.0.1:33401\", \"error\": \"Not enough hosts to serve the request\", \"operation-result\": \"OperationFailed\", \"shard-id\": 1, \"logging-call-at\": \"controller_impl.go:387\"}\r\ngo.temporal.io/server/common/log.(*zapLogger).Error\r\n\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.20.1/common/log/zap_logger.go:150\r\ngo.temporal.io/server/service/history/shard.(*ControllerImpl).acquireShards.func2\r\n\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.20.1/service/history/shard/controller_impl.go:387\r\ngo.temporal.io/server/service/history/shard.(*ControllerImpl).acquireShards.func3\r\n\t/home/runner/go/pkg/mod/go.temporal.io/server@v1.20.1/service/history/shard/controller_impl.go:427\r\n2023-05-11T14:45:50.685-0700\tWARN\tFailed to poll for task.\t{\"service\": \"worker\", \"Namespace\": \"temporal-system\", \"TaskQueue\": \"temporal-sys-tq-scanner-taskqueue-0\", \"WorkerID\": \"431854@monolith@\", \"WorkerType\": \"WorkflowWorker\", \"Error\": \"error reading from server: EOF\", \"logging-call-at\": \"internal_worker_base.go:308\"}\r\n2023-05-11T14:45:50.685-0700\tWARN\tFailed to poll for task.\t{\"service\": \"worker\", \"Namespace\": \"temporal-system\", \"TaskQueue\": \"temporal-sys-processor-parent-close-policy\", \"WorkerID\": \"431854@monolith@\", \"WorkerType\": \"WorkflowWorker\", \"Error\": \"error reading from server: EOF\", \"logging-call-at\": \"internal_worker_base.go:308\"}\r\n2023-05-11T14:45:50.685-0700\tWARN\tFailed to poll for task.\t{\"service\": \"worker\", \"Namespace\": \"temporal-system\", \"TaskQueue\": \"temporal-sys-history-scanner-taskqueue-0\", \"WorkerID\": \"431854@monolith@\", \"WorkerType\": \"ActivityWorker\", \"Error\": \"error reading from server: EOF\", \"logging-call-at\": \"internal_worker_base.go:308\"}\r\n2023-05-11T14:45:50.685-0700\tWARN\tFailed to poll for task.\t{\"service\": \"worker\", \"Namespace\": \"temporal-system\", \"TaskQueue\": \"temporal-sys-tq-scanner-taskqueue-0\", \"WorkerID\": \"431854@monolith@\", \"WorkerType\": \"ActivityWorker\", \"Error\": \"error reading from server: EOF\", \"logging-call-at\": \"internal_worker_base.go:308\"}\r\n2023-05-11T14:45:50.685-0700\tWARN\tFailed to poll for task.\t{\"service\": \"worker\", \"Namespace\": \"temporal-system\", \"TaskQueue\": \"temporal-sys-batcher-taskqueue\", \"WorkerID\": \"431854@monolith@\", \"WorkerType\": \"ActivityWorker\", \"Error\": \"error reading from server: EOF\", \"logging-call-at\": \"internal_worker_base.go:308\"}\r\n2023-05-11T14:45:50.685-0700\tWARN\tFailed to poll for task.\t{\"service\": \"worker\", \"Namespace\": \"temporal-system\", \"TaskQueue\": \"temporal-sys-history-scanner-taskqueue-0\", \"WorkerID\": \"431854@monolith@\", \"WorkerType\": \"WorkflowWorker\", \"Error\": \"error reading from server: EOF\", \"logging-call-at\": \"internal_worker_base.go:308\"}\r\n```\r\n\r\n**Describe the solution you'd like**\r\n\r\nAny solution that does not make a user think there is an error when they see logs. If this needs to be only half-done here and then something done at https://github.com/temporalio/cli to properly shutdown or swallow or something, no prob.","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5oPFvp","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Also, sometimes you get:\r\n\r\n```\r\n2023-10-05T11:58:24.496+0300\tERROR\tUnable to call matching.PollActivityTaskQueue.\t{\"service\": \"frontend\", \"wf-task-queue-name\": \"/_sys/temporal-sys-history-scanner-taskqueue-0/2\", \"timeout\": \"1m9.999694s\", \"error\": \"error reading from server: EOF\", \"logging-call-at\": \"workflow_handler.go:1133\"}\r\n```\r\n\r\nWith a full trace.","createdAt":"2023-10-05T12:21:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4383#issuecomment-1748786153","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5v_6ox","author":{"login":"garrettks"},"authorAssociation":"NONE","body":"And by \"full trace\", @cretz means a V E R Y full trace ðŸ˜…","createdAt":"2024-01-05T17:31:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4383#issuecomment-1879026225","viewerDidAuthor":false}],"createdAt":"2023-05-22T21:10:40Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":4383,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":10}}],"state":"OPEN","title":"Support log-less graceful shutdown without \"Error looking up host for shardID\" errors","updatedAt":"2024-01-05T17:31:15Z","url":"https://github.com/temporalio/temporal/issues/4383"}
