{"assignees":[],"author":{"id":"MDQ6VXNlcjQ1MjM5NTU=","is_bot":false,"login":"longquanzheng","name":"Quanzheng Long"},"body":"**Is your feature request related to a problem? Please describe.**\r\nWhen workflow is closing(continueAsNew/fail/complete), the workflow task would fail if there is any signals received but not processed. This is designed to prevent signals being lost(continueAsNew with unhandled signals). \r\n\r\nThis is problematic especially for continueAsNew. In a valid design, workflow should do continueAsNew after processing too many signals, to avoid blowing up the history. However, when signals are coming too fast, workflow task won't be able to process, and failing in a loop \r\n* WFT scheduled/started\r\n* WFT fail when attempt to continueAsNew, because a signal is received when WFT is completing\r\n* WFT scheduled/started\r\n* ...\r\nAs a result, workflow will either get terminated because of history length/size limit (50K events or 50MB) it can't process the signals, or there are too many signals that it can't carry over to next run(limit of workflow input). \r\n\r\n\r\n**Describe the solution you'd like**\r\nOption 1: DescribeWF response will return why the last workflow task is failing -- is it trying to do a continueAsNew. So that app can use it to decide rejecting the signals\r\nOption 2: Temporal server will reject the signals based on last continueAsNew failure.\r\nOption 3: instead of failing, apply the buffered signals to next run if workflow is doing continueAsNew, as described in https://github.com/temporalio/temporal/issues/1289 \r\n\r\n**Describe alternatives you've considered**\r\nA workaround today is that application will describe workflow to check a pending workflow task attempt, and just reject signals when attempt >1 see https://github.com/indeedeng/iwf/issues/236\r\n\r\n**Additional context**\r\n\r\n\r\nhttps://temporalio.slack.com/archives/CTQU95E84/p1680537731857359\r\n","closedAt":"2023-08-10T17:46:20Z","comments":[{"id":"IC_kwDODNqesM5jwdYZ","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Fixed in https://github.com/temporalio/temporal/pull/4395","createdAt":"2023-08-10T17:46:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4137#issuecomment-1673647641","viewerDidAuthor":false}],"createdAt":"2023-04-03T16:00:24Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":4137,"reactionGroups":[],"state":"CLOSED","title":"Reject fast signals when workflow task is failing at continueAsNew","updatedAt":"2023-08-10T17:46:20Z","url":"https://github.com/temporalio/temporal/issues/4137"}
