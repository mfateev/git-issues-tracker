{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyMjI1MTI=","is_bot":false,"login":"hazcod","name":"Niels Hofmans"},"body":"## Expected Behavior\r\n`temporal/auto-setup:latest` should bind on `0.0.0.0` in docker scenarios, instead of binding to specific IPs.\r\n\r\n## Actual Behavior\r\nBinding multiple networks to the temporal docker container results in:\r\n```\r\n {\"level\":\"fatal\",\"ts\":\"2020-06-19T08:24:43.081Z\",\"msg\":\"ListenIP failed, unable to parse bindOnIP value %q or it is not IPv4 address\",\"address\":\"172.23.0.4 172.19.0.3\",\"logging-call-at\":\"rpc.go:186\",\"stacktrace\":\"github.com/temporalio/temporal/common/log/loggerimpl.(*loggerImpl).Fatal\\n\\t/temporal/common/log/loggerimpl/logger.go:144\\ngithub.com/temporalio/temporal/common/rpc.getListenIP\\n\\t/temporal/common/rpc/rpc.go:186\\ngithub.com/temporalio/temporal/common/rpc.(*RPCFactory).GetGRPCListener\\n\\t/temporal/common/rpc/rpc.go:126\\ngithub.com/temporalio/temporal/common/resource.New\\n\\t/temporal/common/resource/resourceImpl.go:154\\ngithub.com/temporalio/temporal/service/history.NewService\\n\\t/temporal/service/history/service.go:471\\ngithub.com/temporalio/temporal/cmd/server/temporal.(*server).startService\\n\\t/temporal/cmd/server/temporal/server.go:262\\ngithub.com/temporalio/temporal/cmd/server/temporal.(*server).Start\\n\\t/temporal/cmd/server/temporal/server.go:85\\ngithub.com/temporalio/temporal/cmd/server/temporal.startHandler\\n\\t/temporal/cmd/server/temporal/temporal.go:91\\ngithub.com/temporalio/temporal/cmd/server/temporal.BuildCLI.func1\\n\\t/temporal/cmd/server/temporal/temporal.go:211\\ngithub.com/urfave/cli.HandleAction\\n\\t/go/pkg/mod/github.com/urfave/cli@v1.22.4/app.go:528\\ngithub.com/urfave/cli.Command.Run\\n\\t/go/pkg/mod/github.com/urfave/cli@v1.22.4/command.go:174\\ngithub.com/urfave/cli.(*App).Run\\n\\t/go/pkg/mod/github.com/urfave/cli@v1.22.4/app.go:279\\nmain.main\\n\\t/temporal/cmd/server/main.go:38\\nruntime.main\\n\\t/usr/local/go/src/runtime/proc.go:203\"}\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n```yaml\r\n  temporal:\r\n    image: temporalio/auto-setup:latest\r\n    restart: \"on-failure:5\"\r\n    networks:\r\n    - backend\r\n    - backend2\r\n    environment:\r\n      - \"DB=postgres\"\r\n      - \"DB_PORT=26257\"\r\n      - \"POSTGRES_USER=root\"\r\n      - \"POSTGRES_PWD=postgres\"\r\n      - \"POSTGRES_SEEDS=postgres\"\r\n    ports:\r\n    - 7233\r\n```\r\n\r\n","closedAt":null,"comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY4ODUxMTkxNg==","author":{"login":"mikhailshilkov"},"authorAssociation":"NONE","body":"I'm hitting the same error on Azure App Service. My `docker-compose.yml` is very similar to the default one, just without a cassandra container. No explicit `networks` configuration.\r\n\r\nI get\r\n\r\n```\r\n{\"level\":\"fatal\",\"ts\":\"2020-09-07T21:00:28.845Z\",\"msg\":\"ListenIP failed, unable to parse bindOnIP value or it \r\nis not IPv4 address\",\"address\":\"172.16.3.2 172.16.0.3\",\"logging-call-at\":\"rpc.go:186\",\"stacktrace\":\r\n\"go.temporal.io/server/common/log/loggerimpl.(*loggerImpl).Fatal\\n\\t/temporal/common/log/loggerimpl/logger.go:144\r\n\\ngo.temporal.io/server/common/rpc.getListenIP\\n\\t/temporal/common/rpc/rpc.go:186\r\n\\ngo.temporal.io/server/common/rpc.(*RPCFactory).GetGRPCListener\\n\\t/temporal/common/rpc/rpc.go:126\r\n\\ngo.temporal.io/server/common/resource.New\\n\\t/temporal/common/resource/resourceImpl.go:154\r\n\\ngo.temporal.io/server/service/history.NewService\\n\\t/temporal/service/history/service.go:479\r\n\\ngo.temporal.io/server/cmd/server/temporal.(*server).startService\\n\\t/temporal/cmd/server/temporal/server.go:265\r\n\\ngo.temporal.io/server/cmd/server/temporal.(*server).Start\\n\\t/temporal/cmd/server/temporal/server.go:85\r\n\\ngo.temporal.io/server/cmd/server/temporal.startHandler\\n\\t/temporal/cmd/server/temporal/temporal.go:91\r\n\\ngo.temporal.io/server/cmd/server/temporal.BuildCLI.func1\\n\\t/temporal/cmd/server/temporal/temporal.go:211\r\n\\ngithub.com/urfave/cli.HandleAction\\n\\t/go/pkg/mod/github.com/urfave/cli@v1.22.4/app.go:528\r\n\\ngithub.com/urfave/cli.Command.Run\\n\\t/go/pkg/mod/github.com/urfave/cli@v1.22.4/command.go:174\r\n\\ngithub.com/urfave/cli.(*App).Run\\n\\t/go/pkg/mod/github.com/urfave/cli@v1.22.4/app.go:279\r\n\\nmain.main\\n\\t/temporal/cmd/server/main.go:38\\nruntime.main\\n\\t/usr/local/go/src/runtime/proc.go:203\"}\r\n```\r\n\r\nAny workarounds?","createdAt":"2020-09-07T21:10:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-688511916","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3MzQ4MjAwMw==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"@wxing1292 can you confirm if this is still a problem?","createdAt":"2021-07-03T23:04:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-873482003","viewerDidAuthor":false},{"id":"IC_kwDODNqesM408028","author":{"login":"Miha-ha"},"authorAssociation":"NONE","body":"I got the same error as soon as I added the second network:    \r\n```\r\nnetworks:\r\n    - backend\r\n    - backend2\r\n```","createdAt":"2021-07-28T14:34:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-888360380","viewerDidAuthor":false},{"id":"IC_kwDODNqesM41XB7Q","author":{"login":"Miha-ha"},"authorAssociation":"NONE","body":"Please clarify if a solution to this problem is planned?","createdAt":"2021-08-09T13:37:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-895229648","viewerDidAuthor":false},{"id":"IC_kwDODNqesM47i7Yh","author":{"login":"programmador"},"authorAssociation":"NONE","body":"Crazyness, I've broken my brain solving it especially when there is actually no documentation for:\r\n* this config: https://github.com/temporalio/temporal/blob/master/docker/config_template.yaml\r\n* this config: https://github.com/temporalio/temporal/blob/master/config/dynamicconfig/development_es.yaml\r\n* explanation how exactly the second of abovementioned configs should be used to overwrite the first one (They have different structure! Actually I cannot see what's common between them at all - they do not seem to share same keys, at least in abovementioned examples provided. For instance You won't find a word \"system\" in file which the first link is pointing to). The only documentation is \"you can\" [here](https://github.com/temporalio/temporal/blob/master/config/dynamicconfig/README.md). Wow... Thanks... It helped (sarcasm).\r\n* explanation of environment variables used by temporal server. The only explanation on temporal.io website is about temporal-web, not about temporal server itself.\r\n\r\nSo after an evening of investigeting I've come across these issues:\r\n* https://community.temporal.io/t/temporalio-temporal-server-overwrite-the-127-0-0-1-7233-ip-address-to-something-else/544\r\n* https://github.com/temporalio/temporal/blob/master/docker/config_template.yaml#L214\r\n* https://github.com/temporalio/temporal/blob/master/config/dynamicconfig/README.md\r\nFrom which I've indirectly understood that could bind 0.0.0.0. Of course I could - this is first what I did but immediately encountered another error: I should propagate broadcastAddress. I had no Idea how (see my mention about docs above). And I still have no idea how to make it via config. I've also understood that broadcastAddress is used only for cluster intercommunication. Also I've seen mentions about few interesting env vars in those issues.\r\n\r\nSo this seems to work:\r\n```\r\n    temporal:\r\n        depends_on:\r\n            - mysql\r\n            - elasticsearch\r\n        environment:\r\n            DBNAME: temporal\r\n            VISIBILITY_DBNAME: temporal_visibility\r\n            DB: mysql\r\n            MYSQL_USER: temporal\r\n            MYSQL_PWD: <passwd_here>\r\n            MYSQL_SEEDS: mysql\r\n            DYNAMIC_CONFIG_FILE_PATH: config/dynamicconfig/development_es.yaml\r\n            ENABLE_ES: true\r\n            ES_SEEDS: elasticsearch\r\n            ES_VERSION: v7\r\n            BIND_ON_IP: 0.0.0.0\r\n            TEMPORAL_BROADCAST_ADDRESS: 127.0.0.1\r\n        image: temporalio/auto-setup:1.14.0\r\n        volumes:\r\n            - ./dynamicconfig:/etc/temporal/config/dynamicconfig\r\n        networks:\r\n            - default # perform DB queries\r\n            - traefik # receive requests from a load balancer\r\n        labels:\r\n            traefik.enable: 'true'\r\n            traefik.frontend.rule: 'Host: temporal.local'\r\n            traefik.port: '7233'\r\n            traefik.protocol: 'h2c'\r\n\r\n```\r\n\r\n**The solution is the latter two env vars**. You could bind 0.0.0.0 though using 127.0.0.1 for cluster intercom:\r\n```\r\n            BIND_ON_IP: 0.0.0.0\r\n            TEMPORAL_BROADCAST_ADDRESS: 127.0.0.1\r\n```\r\n\r\nSeems like not many people are encountering this problem if it wasn't answered 1.5 years.\r\nDoes everyone just expose a new port for every single stuff instead of using custom CA or LetsEncrypt and a load balancer? Really? Guuuuyz! How do you remember all those port numbers at all?\r\n\r\nAnd one more thing. **This is not a bug**. Because:\r\n* You **are able** to bind 0.0.0.0\r\n* You **have to** know your node IP adress to set up production cluster environment (when 127.0.0.1 is not an option)\r\n\r\nAs for me the issue could be resolved as the above solution seems to work. Though would be nice to improve the doc. Yes I know I'm free to contribute instead of complaining :-)\r\n\r\nBTW other solution would a way to disable cluster intercom at all if it is optional. I beleive it's optional if 127.0.0.1 is okay.","createdAt":"2021-12-21T18:46:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":29}},{"content":"EYES","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-999011873","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6GxsH_","author":{"login":"aleclerc-cio"},"authorAssociation":"NONE","body":"Trying to add a healthcheck to temporal is tough since I can't curl since we're not bound to 127.0.0.1.\r\n\r\n```\r\n    healthcheck:\r\n      test: [\"CMD-SHELL\", \"curl -s http://localhost:7233/health || exit 1\"]\r\n```\r\n","createdAt":"2024-07-31T18:39:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-2261172735","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7Ij7u0","author":{"login":"emalihin"},"authorAssociation":"NONE","body":"`command: [\"CMD-SHELL\", 'temporal operator cluster health --address $(hostname -i):7233']` if temporal is bound to an interface","createdAt":"2025-10-03T08:59:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/471#issuecomment-3364862900","viewerDidAuthor":false}],"createdAt":"2020-06-19T08:28:09Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"},{"id":"MDU6TGFiZWwzMDAxNDk5NzYw","name":"operations","description":"","color":"f9d0c4"},{"id":"MDU6TGFiZWwzMTM4ODUyODY2","name":"needs-investigation","description":"","color":"0052cc"}],"milestone":null,"number":471,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"temporal Docker fails to bind on multiple interfaces","updatedAt":"2025-10-03T08:59:32Z","url":"https://github.com/temporalio/temporal/issues/471"}
