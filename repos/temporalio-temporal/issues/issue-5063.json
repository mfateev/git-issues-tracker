{"assignees":[{"id":"MDQ6VXNlcjIxMDEzNjI4","login":"carlydf","name":"Carly de Frondeville","databaseId":0}],"author":{"id":"MDQ6VXNlcjUxNzY4Mw==","is_bot":false,"login":"Sushisource","name":"Spencer Judge"},"body":"## Expected Behavior\r\nWhen setting https://github.com/temporalio/api/blob/master/temporal/api/workflowservice/v1/request_response.proto#L158 I expect workflow tasks to always time out with the specified duration.\r\n\r\n## Actual Behavior\r\nSometimes the timeout may not be respected. In particular, if the task is being processed on a sticky queue. I have attached a history where the execution started event clearly shows a 1s task timeout, but there is a task timeout that doesn't happen for 10 seconds: \r\n[a20228ec-d12b-43dc-91e7-f00350e3f2dc_events.json](https://github.com/temporalio/temporal/files/13230283/a20228ec-d12b-43dc-91e7-f00350e3f2dc_events.json)\r\n\r\n\r\n## Steps to Reproduce the Problem\r\nI want to say that I've seen this work properly on sticky queues before, but in my case I had to explicitly call reset on the sticky queue to get things to proceed quickly. In my test, there is an outstanding workflow update while the task times out. Perhaps it's a contributing factor.\r\n\r\nThis diff can be applied to the test added [here](https://github.com/temporalio/sdk-core/pull/624) to repro\r\n```\r\ndiff --git a/tests/integ_tests/update_tests.rs b/tests/integ_tests/update_tests.rs\r\nindex 26254d40e..9eea536df 100644\r\n--- a/tests/integ_tests/update_tests.rs\r\n+++ b/tests/integ_tests/update_tests.rs\r\n@@ -814,6 +814,7 @@ async fn task_failure_after_update() {\r\n async fn worker_restarted_in_middle_of_update() {\r\n     let wf_name = \"worker_restarted_in_middle_of_update\";\r\n     let mut starter = CoreWfStarter::new(wf_name);\r\n+    starter.workflow_options.task_timeout = Some(Duration::from_secs(1));\r\n     let mut worker = starter.worker().await;\r\n     let client = starter.get_client().await;\r\n\r\n@@ -886,10 +887,10 @@ async fn worker_restarted_in_middle_of_update() {\r\n         // Allow it to start again, the second time\r\n         BARR.wait().await;\r\n         // Poke the workflow off the sticky queue to get it to complete faster than WFT timeout\r\n-        client\r\n-            .reset_sticky_task_queue(wf_id.clone(), run_id.clone())\r\n-            .await\r\n-            .unwrap();\r\n+        // client\r\n+        //     .reset_sticky_task_queue(wf_id.clone(), run_id.clone())\r\n+        //     .await\r\n+        //     .unwrap();\r\n     };\r\n     let run = async {\r\n         // This run attempt will get shut down\r\n```         \r\n\r\n## Specifications\r\n\r\n  - Version:\r\n  - Platform:\r\n","closedAt":null,"comments":[],"createdAt":"2023-11-01T18:04:00Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5063,"reactionGroups":[],"state":"OPEN","title":"Workflow Task Timeout not always respected","updatedAt":"2023-11-17T22:46:34Z","url":"https://github.com/temporalio/temporal/issues/5063"}
