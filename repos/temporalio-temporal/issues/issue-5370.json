{"assignees":[],"author":{"id":"MDQ6VXNlcjU1MzYwNTE=","is_bot":false,"login":"Zylius","name":"Zigmas SatkeviÄius"},"body":"Yesterday we upgraded namespace retention settings, but they keep on being deleted after 3 days.\r\n\r\n## Expected Behavior\r\n\r\nUpdating retention with `tctl n default --retnetion 31` should change retention to 31 days (744 hours). I.E. Workflows should exist \r\n\r\n## Actual Behavior\r\n\r\nRetention remains default 3 days.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a blank temporal server\r\n  2. Update retention to 31 days\r\n  3. Retention is reported as changed everywhere, but the workflows are still deleted.\r\n\r\n## Specifications\r\n\r\n  - Temporal Server Version: 1.22.4\r\n  - Platform: Astra DB Cassandra 4.0.0.6816, PHP 8.1+ Roadrunner/Go services\r\n \r\n## More info:\r\n I've looked at data `0x0a310a2435643039653865302d336266622d346261662d613565352d38656536336662333133363410011a0764656661756c74120d0a050880bda3011a00200130011a120a06616374697665120661637469766518012004` stored in cassandra and decoded it with [NamespaceResponse](https://github.com/temporalio/temporal/blob/main/proto/internal/temporal/server/api/persistence/v1/namespaces.proto#L35) structure it seems that we have 2678400 seconds stored, which is correct 31 days.\r\n\r\nAlso screenshots from tctl, elastika, temporal-web\r\n![image](https://github.com/temporalio/temporal/assets/5536051/6aad5ea9-459d-4c68-ab02-e7f1fbc1af00)\r\n![image](https://github.com/temporalio/temporal/assets/5536051/d491df58-24de-4a38-8779-cb628b4e61bb)\r\n![image](https://github.com/temporalio/temporal/assets/5536051/fe7b1f2a-cfee-4138-a2ba-040b3a962726)\r\n\r\nShowing that it's actually still deleting is a lil bit hard, but you get the point. I hope you can recreate it.\r\nWhat's going on? Why is it still picking default 3 days?\r\n\r\nAm I missing something?","closedAt":"2024-01-30T20:47:20Z","comments":[{"id":"IC_kwDODNqesM5yS97f","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"Did the workflow that are being deleted after 3 days complete before or after the retention setting was changed? The retention timer is applied at workflow close time, so only workflows that complete (or fail) after the setting was changed will get the new retention.","createdAt":"2024-01-30T17:46:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5370#issuecomment-1917574879","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5yUFDd","author":{"login":"Zylius"},"authorAssociation":"NONE","body":"> Did the workflow that are being deleted after 3 days complete before or after the retention setting was changed? The retention timer is applied at workflow close time, so only workflows that complete (or fail) after the setting was changed will get the new retention.\r\n\r\nAhh I see, didn't know that the record itself stores retention time. Closing this issue ;) Thank you!","createdAt":"2024-01-30T20:47:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5370#issuecomment-1917866205","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6kYnvy","author":{"login":"r00ta"},"authorAssociation":"NONE","body":"For the posterity, in case you have an old DB dump that you need to inspect and to attach the temporal server/UI you have to move back the clock of you machine ;) ","createdAt":"2025-03-27T12:47:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5370#issuecomment-2757917682","viewerDidAuthor":false}],"createdAt":"2024-01-30T14:41:03Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5370,"reactionGroups":[],"state":"CLOSED","title":"Retention update ignored","updatedAt":"2025-03-27T12:47:32Z","url":"https://github.com/temporalio/temporal/issues/5370"}
