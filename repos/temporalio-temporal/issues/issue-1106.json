{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjM3MjE0MQ==","is_bot":false,"login":"skrul","name":"Steve Krulewitz"},"body":"## Expected Behavior\r\n\r\nHitting the workflow list page of the Temporal UI should be fast regardless of number of workflows in the visibility database\r\n\r\n## Actual Behavior\r\n\r\nCurrently it takes around 20 to 30 seconds to view the list of workflows in a namespace that has nearly 10 million records in the visibility database.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nExplain the visibility query on a large db:\r\n```\r\nmysql> explain SELECT workflow_id, run_id, start_time, execution_time, workflow_type_name, status, memo, encoding, close_time, history_length\r\n    -> FROM executions_visibility\r\n    -> WHERE status != 1  AND namespace_id = 'badd3e8c-17c4-4e72-9a25-3e7f50e21da6'\r\n    -> AND ((run_id > '78ebd418-ca0c-41f3-a973-4a8973423125' and close_time = '2020-12-15 00:00:00') OR (close_time < '2020-12-15 00:10:00'))\r\n    -> AND close_time >= '2020-12-15 00:00:00'\r\n    -> AND close_time <= '2020-12-15 00:10:00'\r\n    -> ORDER BY close_time DESC\r\n    -> LIMIT 100\\G\r\n*************************** 1. row ***************************\r\n           id: 1\r\n  select_type: SIMPLE\r\n        table: executions_visibility\r\n   partitions: NULL\r\n         type: ref\r\npossible_keys: PRIMARY,by_type_start_time,by_workflow_id_start_time,by_status_by_start_time,by_type_close_time,by_workflow_id_close_time,by_status_by_close_time\r\n          key: PRIMARY\r\n      key_len: 192\r\n          ref: const\r\n         rows: 7707072\r\n     filtered: 3.55\r\n        Extra: Using where; Using filesort\r\n1 row in set, 1 warning (0.00 sec)\r\n```\r\n\r\nThe query planner is choosing the `PRIMARY` index which is nearly a table scan. Actually executing this query takes 20 to 30 seconds to complete.\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: temporal 1.3.2\r\n  - Platform: linux\r\n\r\n","closedAt":"2020-12-17T01:35:33Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc0NzE0Njk1OQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"Thanks for reporting the issue","createdAt":"2020-12-17T01:35:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1106#issuecomment-747146959","viewerDidAuthor":false}],"createdAt":"2020-12-17T00:17:32Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"},{"id":"MDU6TGFiZWwyMDE5OTE1MjIx","name":"performance","description":"","color":"f4f275"}],"milestone":null,"number":1106,"reactionGroups":[],"state":"CLOSED","title":"Workflow visibility query is slow on large MySQL visibility database ","updatedAt":"2020-12-17T01:35:45Z","url":"https://github.com/temporalio/temporal/issues/1106"}
