{"assignees":[{"id":"MDQ6VXNlcjYzNTAzMDE=","login":"jbreiding","name":"Jeremy","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0NjYwNzA=","is_bot":false,"login":"AndreevDm","name":"Dmitry Andreev"},"body":"**Is your feature request related to a problem? Please describe.**\r\nHi. I am using Elasticsearch cluster witch is available only via https with self-singed сert. [Details](https://cloud.yandex.com/en-ru/docs/managed-elasticsearch/quickstart#connect).\r\nThis does not allow me to use auto-setup.sh because [curl](https://github.com/temporalio/temporal/blob/master/docker/auto-setup.sh#L245) crashes on such requests.\r\n\r\n**Describe the solution you'd like**\r\nTo make it work, I need either to call curl with `-k` (``--insecure``) or with `--cacert  cert.crt` param.\r\nPerhaps a more universal approach would be just to add the ES_CURL_PARAMS option.\r\n\r\n**Describe alternatives you've considered**\r\nThe only alternative I can imagine is to write my own script. Which of course doesn't look like a good solution.\r\n\r\n","closedAt":"2022-04-11T15:46:44Z","comments":[{"id":"IC_kwDODNqesM4-GUgH","author":{"login":"AndreevDm"},"authorAssociation":"NONE","body":"If we agree on the name of the parameter, I can make pull request myself.","createdAt":"2022-02-16T16:24:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1041844231","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-eM0B","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Hi @AndreevDm \r\n\r\nThanks for creating the issue and explanation of the issue.\r\n\r\nI am looking into this a bit deeper and will come back with a suggestion.\r\n","createdAt":"2022-02-22T18:46:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1048104193","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-lkgp","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Digging a little bit deeper just adding this to curl options won't completely enable this scenario.\r\n\r\nI am working through an example that will add an option to `auto-setup.sh` for this.","createdAt":"2022-02-24T16:30:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1050036265","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-mskI","author":{"login":"AndreevDm"},"authorAssociation":"NONE","body":"We are running temporal via binary in our own containers. Сustom certificate is already installed there, so everything works fine.\r\nConfig for elactic:\r\n```yaml  \r\n   es-visibility:\r\n      elasticsearch:\r\n        version: \"v7\"\r\n        url:\r\n          scheme: \"https\"\r\n          host: \"${ELASTIC_ADDRESS}\"\r\n        username: admin\r\n        password: ${ELASTIC_PASSWORD}\r\n        indices:\r\n          visibility: temporal_visibility_v1_dev\r\n```\r\n\r\nWe wan't to use auto-setup docker image for initial db configuration and schema update. \r\n\r\nBut you are absolutely right that in general, when using temporal-provided docker images, problems will arise.","createdAt":"2022-02-24T22:38:19Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1050331400","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-mv_s","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Then it sounds like the simplest path forward for you right now would be using the custom image as a base image for a custom auto-setup which only executes the schema creation.\r\n\r\nThe details are here\r\nhttps://github.com/temporalio/temporal/blob/master/Dockerfile#L42\r\nand here\r\nhttps://github.com/temporalio/temporal/blob/master/docker/auto-setup.sh\r\n\r\nThe trouble is auto-setup sets up temporal and schema and then runs temporal.\r\n\r\nauto-setup does not run as root so there is no option to copy in the ca cert and run update-ca-certificates at runtime.","createdAt":"2022-02-24T23:01:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1050345452","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-2D_s","author":{"login":"AndreevDm"},"authorAssociation":"NONE","body":"I think it will work, but it doesn't look like an easy way. We would really like to do the initial setup (and update) just using temporary-provided docker image.\r\n\r\nSomething like\r\n```\r\ndocker run -i --rm --name temporal-auto-setup ${VARS} temporalio/auto-setup:${TEMPORAL_VERSION}\r\n```","createdAt":"2022-02-28T15:16:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1054359532","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-2WH1","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"I don't believe any of the provided images will work with your private certificate at the moment.\r\n\r\nAnother option would be `temporal-admin-tools` image. This is probably a better choice.\r\n\r\nWith that image you could map in your private certificate to a volume and a modified portion of the `auto-setup` script.\r\n\r\nModify this section\r\nhttps://github.com/temporalio/temporal/blob/faa1dc135aacd9b78cd856f313e13a5919980a0d/docker/auto-setup.sh#L265","createdAt":"2022-02-28T16:27:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1054433781","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5BR9V0","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Once this PR lands, https://github.com/temporalio/docker-compose/pull/82, there will be an example of how use self-signed certificates for some temporal dependencies.","createdAt":"2022-04-11T15:46:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2502#issuecomment-1095226740","viewerDidAuthor":false}],"createdAt":"2022-02-14T14:26:44Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwyNzcwMzY2NzYw","name":"close-after-30-days","description":"","color":"1d76db"}],"milestone":null,"number":2502,"reactionGroups":[],"state":"CLOSED","title":"Elasticsearch over https with self-signed certificate in auto-setup","updatedAt":"2022-04-11T15:46:44Z","url":"https://github.com/temporalio/temporal/issues/2502"}
