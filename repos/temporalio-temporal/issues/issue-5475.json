{"assignees":[],"author":{"id":"MDQ6VXNlcjQwODk3NjMx","is_bot":false,"login":"prashanthzen","name":""},"body":"I have a temporal setup as following:\r\ndefaultstore: postgres\r\nadvancedVisibilityStore: es-visibility (the database behind es-visiblity is opensearch cluster)\r\nI ran some workflows and I see the data going into the opensearch. But the temporal UI does not show any data. Neither do I see any error logs from the temporal pods.\r\nThe configmap for the temporal services look as following:\r\n(.venv) temporal prashanth$ kubectl get cm ft1-mm-temporal-frontend-config -o yaml\r\napiVersion: v1\r\ndata:\r\n  config_template.yaml: |-\r\n    log:\r\n      stdout: true\r\n      level: \"debug,info\"\r\n\r\n    persistence:\r\n      defaultStore: default\r\n      advancedVisibilityStore: es-visibility\r\n      numHistoryShards: 512\r\n      datastores:\r\n        default:\r\n          sql:\r\n            pluginName: \"postgres12\"\r\n            driverName: \"postgres12\"\r\n            databaseName: \"temporal\"\r\n            connectAddr: \"db-console-pg.ft1.dev.xxx.com:5432\"\r\n            connectProtocol: \"tcp\"\r\n            user: temporal\r\n            password: \"{{ .Env.TEMPORAL_STORE_PASSWORD }}\"\r\n            maxConnLifetime: 1h\r\n            maxConns: 20\r\n            secretName: \"\"\r\n        visibility:\r\n          sql:\r\n            pluginName: \"postgres12\"\r\n            driverName: \"postgres12\"\r\n            databaseName: \"temporal\"\r\n            connectAddr: \"db-console-pg.ft1.dev.xxx.com:5432\"\r\n            connectProtocol: \"tcp\"\r\n            user: \"temporal\"\r\n            password: \"{{ .Env.TEMPORAL_VISIBILITY_STORE_PASSWORD }}\"\r\n            maxConnLifetime: 1h\r\n            maxConns: 20\r\n            secretName: \"\"\r\n        es-visibility:\r\n            elasticsearch:\r\n                version: \"v7\"\r\n                url:\r\n                    scheme: \"https\"\r\n                    host: \"es.mgmt.dev.xxx.com:443\"\r\n                username: \"temporal_visibility\"\r\n                password: \"<placeholder>\"\r\n                logLevel: \"error\"\r\n                indices:\r\n                    visibility: \"temporal-visibility\"\r\n\r\n    global:\r\n      membership:\r\n        name: temporal\r\n        maxJoinDuration: 30s\r\n        broadcastAddress: {{ default .Env.POD_IP \"0.0.0.0\" }}\r\n\r\n      pprof:\r\n        port: 7936\r\n\r\n      metrics:\r\n        tags:\r\n          type: frontend\r\n        prometheus:\r\n          timerType: histogram\r\n          listenAddress: \"0.0.0.0:9090\"\r\n\r\n    services:\r\n      frontend:\r\n        rpc:\r\n          grpcPort: 7233\r\n          membershipPort: 7933\r\n          bindOnIP: \"0.0.0.0\"\r\n\r\n      history:\r\n        rpc:\r\n          grpcPort: 7234\r\n          membershipPort: 7934\r\n          bindOnIP: \"0.0.0.0\"\r\n\r\n      matching:\r\n        rpc:\r\n          grpcPort: 7235\r\n          membershipPort: 7935\r\n          bindOnIP: \"0.0.0.0\"\r\n\r\n      worker:\r\n        rpc:\r\n          grpcPort: 7239\r\n          membershipPort: 7939\r\n          bindOnIP: \"0.0.0.0\"\r\n    clusterMetadata:\r\n      enableGlobalDomain: false\r\n      failoverVersionIncrement: 10\r\n      masterClusterName: \"active\"\r\n      currentClusterName: \"active\"\r\n      clusterInformation:\r\n        active:\r\n          enabled: true\r\n          initialFailoverVersion: 1\r\n          rpcName: \"temporal-frontend\"\r\n          rpcAddress: \"127.0.0.1:7933\"\r\n    dcRedirectionPolicy:\r\n      policy: \"noop\"\r\n      toDC: \"\"\r\n    archival:\r\n      status: \"disabled\"\r\n\r\n    publicClient:\r\n      hostPort: \"ft1-mm-temporal-frontend:7233\"\r\n\r\n    dynamicConfigClient:\r\n      filepath: \"/etc/temporal/dynamic_config/dynamic_config.yaml\"\r\n      pollInterval: \"10s\"\r\nUI:\r\n![Screenshot 2024-02-29 at 3 39 19 PM](https://github.com/temporalio/temporal/assets/40897631/fd6e159d-9afd-4dba-8a37-cf47f9cb7d49)\r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM51qzI5","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Can you try to remove all filters? Or try using temporal/CLI to see if you can list workflow from using the CLI. \r\n","createdAt":"2024-03-02T01:08:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5475#issuecomment-1974153785","viewerDidAuthor":false},{"id":"IC_kwDODNqesM512scL","author":{"login":"prashanthzen"},"authorAssociation":"NONE","body":"After changing the index name from temporal-visibility to temporal_visibility_v1_dev in the es-visibility visibilityStore configuration, the UI started working as expected.","createdAt":"2024-03-04T19:07:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5475#issuecomment-1977272075","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6PDgQQ","author":{"login":"phuongdnguyen"},"authorAssociation":"CONTRIBUTOR","body":"@yiminc We've encountered this issue to when trying to plug 2 different temporal cluster on a same elasticsearch cluster with different index name. It's because pattern for template index is [fixed](https://github.com/temporalio/temporal/blob/06a8e35a96a349ab84f61571d74682a3f9817edd/schema/elasticsearch/visibility/versioned/v7/index_template_v7.json#L3) to match index with prefix of `temporal_visibility_v1`. Changing index to have name prefix of `temporal_visibility_v1` fix the issue for us. However, seems like it's a good chance to have this implication mentioned somewhere.","createdAt":"2024-10-08T14:45:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5475#issuecomment-2400060432","viewerDidAuthor":false}],"createdAt":"2024-03-01T19:10:24Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5475,"reactionGroups":[],"state":"OPEN","title":"temporal frontend unable to connect to elasticsearch visibilitystore","updatedAt":"2024-10-08T14:45:43Z","url":"https://github.com/temporalio/temporal/issues/5475"}
