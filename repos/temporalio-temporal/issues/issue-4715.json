{"assignees":[],"author":{"id":"MDQ6VXNlcjgxNzU5MzI=","is_bot":false,"login":"vanhtuan0409","name":"Tuấn Vương"},"body":"## Expected Behavior\r\n\r\nAble to upgrade temporal cluster from 1.20.4 to 1.21.4 with archival disabled\r\n\r\n\r\n## Actual Behavior\r\n\r\nServer crash after upgrading to 1.21.4\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Start cluster 1.20 with the bellow config\r\n  2. Let's the cluster run for a while\r\n  3. Upgrade cluster to 1.21.4\r\n\r\n```\r\narchival:\r\n  history:\r\n    state: \"disabled\"\r\n  visibility:\r\n    state: \"disabled\"\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: 1.21.4\r\n  - Platform: Linux\r\n \r\nSuspect related issue: https://github.com/temporalio/temporal/issues/4638\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5jiSGd","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@vanhtuan0409 did you have archival enabled on your v1.20.4 server before upgrade to 1.21?","createdAt":"2023-08-08T16:24:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4715#issuecomment-1669931421","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5jiS4x","author":{"login":"vanhtuan0409"},"authorAssociation":"CONTRIBUTOR","body":"@yiminc no I dont have","createdAt":"2023-08-08T16:25:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4715#issuecomment-1669934641","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5ji8-C","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@vanhtuan0409 could you paste the error logs you get from server.","createdAt":"2023-08-08T18:33:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4715#issuecomment-1670107010","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5j3RPH","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Oh sorry, just saw that archival is not enable before. Plz ignore my commit below\r\n\r\n~~This is expected if the cluster previously has archival queue enabled since the behavior will be very confusing and undefined.~~\r\n~~See more discussion here: https://github.com/temporalio/temporal/pull/4634~~\r\n\r\n~~Archival can still be disabled on namespace level.~~","createdAt":"2023-08-11T21:41:41Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4715#issuecomment-1675432903","viewerDidAuthor":false}],"createdAt":"2023-08-02T07:08:12Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4715,"reactionGroups":[],"state":"OPEN","title":"Unable to start 1.21.4 cluster with archival disabled","updatedAt":"2023-08-11T21:43:50Z","url":"https://github.com/temporalio/temporal/issues/4715"}
