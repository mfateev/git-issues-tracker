{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjIwNTExMQ==","is_bot":false,"login":"deltasquare4","name":"Rakshit Menpara"},"body":"## Expected Behavior\r\nIt should not crash, and not throw the pg protocol error below.\r\n\r\n## Actual Behavior\r\nIt crashes with error `unknown protocol version 80877102` when we enabled Archival. With Archival disabled, it runs fine. Seems to be related to use of cancel query. See https://github.com/cockroachdb/cockroach/issues/31763 for corresponding issue on CockroachDB repo.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Deploy Temporal using official Helm chart on Kubernetes 1.16. Configure cockroachdb as a backend to both the databases.\r\n  1. Enable Archival by adding custom configuration.\r\n \r\n## Specifications\r\n\r\n  - Version: 1.7.0\r\n  - Platform: Kubernetes 1.16 + CockroachDB 20.2.5\r\n","closedAt":"2021-09-20T08:53:25Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc5NzM3OTQ1NQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"about `unknown protocol version 80877102`, can you provide the stack trace?","createdAt":"2021-03-12T10:00:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1369#issuecomment-797379455","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg1Nzg4NzcwNg==","author":{"login":"fire"},"authorAssociation":"NONE","body":"Is there anything I can push for CockroachDB support here?","createdAt":"2021-06-09T17:24:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1369#issuecomment-857887706","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg1ODA5OTA1Ng==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"> Is there anything I can push for CockroachDB support here?\r\n\r\n@fire\r\nCockroachDB [claims](https://www.cockroachlabs.com/docs/v20.2/postgresql-compatibility) to be wire compatible with PostgreSQL 9.5\r\n\r\nFrom my local unit testing, all queries used by Temporal works.\r\nRight now the only reason that CockroachDB is not officially supported is we do not have CICD setup for CockroachDB.\r\n\r\nabout `unknown protocol version 80877102`, not entirely sure what happened here, at least if you do not use archival (which is experimental) you should be fine.","createdAt":"2021-06-09T21:03:03Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/1369#issuecomment-858099056","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3MzY2NDUzOA==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"@wxing1292 is this still actionable?  Or should we close the issue?","createdAt":"2021-07-04T21:19:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1369#issuecomment-873664538","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3MzY3OTExMQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"We can choose to close this issue for now and welcome contribution due to the following reason:\n\n* the error seems to be cockroach db not entirely compatible with postgresql 9.5 protocol?\n* other oss & cockroach db users did not report this issue\n* archival is still experimental\n* we currently only officially support postgresql 9.6\n","createdAt":"2021-07-04T23:00:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1369#issuecomment-873679111","viewerDidAuthor":false},{"id":"IC_kwDODNqesM42_-n5","author":{"login":"deltasquare4"},"authorAssociation":"NONE","body":"I'm sorry, I missed the email notifiactions from earlier. We have since moved on to using postgres backing Temporal, so I cannot provide a stacktrace at the moment. Closing this for now until we have more people wanting to use CockroachDB with Temporal.","createdAt":"2021-09-20T08:53:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1369#issuecomment-922741241","viewerDidAuthor":false}],"createdAt":"2021-03-11T11:11:56Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":1369,"reactionGroups":[],"state":"CLOSED","title":"temporal-history throws \"unknown protocol version 80877102\" for CockroachDB","updatedAt":"2021-09-20T08:53:25Z","url":"https://github.com/temporalio/temporal/issues/1369"}
