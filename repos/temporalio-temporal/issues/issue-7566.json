{"assignees":[],"author":{"id":"U_kgDOCjqgQQ","is_bot":false,"login":"lina-temporal","name":"Lina Jodoin"},"body":"## Expected Behavior\nWhen a Workflow Task (WFT) is scheduled, it will wait indefinitely (modulus workflow timeout parameters) for a worker to come online without timing itself out. This is working as expected when the workflow has no sticky worker set.\n\n## Actual Behavior\nAfter and despite `ShutdownWorker` being called to indicate graceful worker shutdowns, if no workers are available at the time of WFT scheduling (such as after a timer firing event), a WFT failure with the now-shutdown sticky queue may be observed. After the WFT failure, the workflow will show a WFT being scheduled on the normal queue, which will wait indefinitely for a worker to become available, as usual.\n\nThe bug here is mostly cosmetic, as if there *are* other workers available on the normal queue, they will immediately receive the pending WFT. Still, a WFT failure should not be observable in a workflow's history if all workers are shut down gracefully. \n\n## Steps to Reproduce the Problem\n\n  1. Start a single worker for a target task queue.\n  1. Start a workflow that creates a timer firing after >10s. \n  1. Kill the worker after the workflow's \"Timer Started\" event has been written (but before the timer fires event).\n  1. Observe that, following the \"Timer Fired\" event, a failed WFT that appears to have been destined for the shutdown sticky queue will be observable in workflow history.\n\n","closedAt":null,"comments":[],"createdAt":"2025-04-03T20:20:57Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":7566,"reactionGroups":[],"state":"OPEN","title":"A workflow task following ShutdownWorker should not time out if no workers are available","updatedAt":"2025-04-03T20:20:57Z","url":"https://github.com/temporalio/temporal/issues/7566"}
