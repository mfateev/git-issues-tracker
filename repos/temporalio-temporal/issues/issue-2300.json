{"assignees":[{"id":"MDQ6VXNlcjQ2NjcyMw==","login":"dnr","name":"David Reiss","databaseId":0}],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nQueries for workflows that are scheduled but not started are causing an issue in the Go SDK (see https://github.com/temporalio/sdk-go/issues/475). This is because the SDK expects the workflow to be started before handling queries. This can happen on workflow retry, cron, and I believe also on continue-as-new.\r\n\r\n**Describe the solution you'd like**\r\n\r\n@mfateev suggests the server return an error in this case that the SDK will propagate to the user. One approach would be to have `temporal.api.enums.v1.QueryResultType` have a new `QUERY_RESULT_TYPE_AWAITING_EXECUTION` enum and the SDK can return a typed error in these cases.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nWe could fail on the worker side in each SDK, but there is no benefit.\r\n\r\nAnother possible alternative is to run the query on the last run workflow for that ID since the new one hasn't started yet, but I suspect that gets messy.","closedAt":"2022-05-11T00:21:00Z","comments":[{"id":"IC_kwDODNqesM47c80e","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"dup of https://github.com/temporalio/temporal/issues/1310","createdAt":"2021-12-19T19:10:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2300#issuecomment-997444894","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5C30Dt","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Please note that the same problem will happen if the workflow did actually start, but the first workflow task failed or timed out. SDK can't execute a direct query correctly in this case because the event loop can't be triggered during replay (think about local activities), but registration of queries is performed in the event loop. Static queries are getting registered on the first triggering of the event loop.\r\nThis is true at least for JavaSDK.\r\n\r\nThere is another solution to this problem. \r\nWe do allow a signal to a workflow that didn't start yet. Why should a query be disallowed? \r\nWe can implement a workaround with the registration of static queues ahead of time, so they will be able to answer for workflows with 0 completed workflow tasks. Dynamic queries that are registered inside the workflow method will not answer in this situation. But even dynamic queries may be able to work in the future if we implement \"init\" method this way or another: https://github.com/temporalio/sdk-java/issues/865\r\n\r\nI much prefer this solution, because it decreases the number of states and combinations users need to think about. `QUERY_RESULT_TYPE_AWAITING_EXECUTION` will be one more thing people will have to discover through tries and fails.","createdAt":"2022-05-10T04:45:29Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2300#issuecomment-1121927405","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5C8BE4","author":{"login":"Spikhalskiy"},"authorAssociation":"CONTRIBUTOR","body":"Closed by #2826?","createdAt":"2022-05-11T00:05:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2300#issuecomment-1123029304","viewerDidAuthor":false}],"createdAt":"2021-12-14T16:52:22Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":2300,"reactionGroups":[],"state":"CLOSED","title":"Eagerly error/return on queries for workflows waiting to start","updatedAt":"2022-05-11T00:21:01Z","url":"https://github.com/temporalio/temporal/issues/2300"}
