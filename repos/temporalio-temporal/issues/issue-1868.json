{"assignees":[],"author":{"id":"MDQ6VXNlcjI0OTY2NzQ=","is_bot":false,"login":"mattes3","name":"Matthias Bohlen"},"body":"## Expected Behavior\r\n\r\nI expect Temporal Java SDK to run with JDK 16.\r\n\r\n## Actual Behavior\r\n\r\nTemporal's internal exception handling code (the static initializer block of class `CheckedExceptionWrapper`) produces additional exceptions when it is run under JDK 16!\r\n\r\nThis is because Temporal accesses a private member `Throwable.cause` by means of reflection which is now denied by default (new behaviour in JDK 16).\r\n\r\nSee the exact description of the change in JDK 16 here: https://www.oracle.com/java/technologies/javase/16-relnotes.html#JDK-8256299\r\n\r\n## Workaround for now\r\n\r\nSuch code can be made to run on JDK 16 by specifying `--illegal-access=permit` on the `java` command line. That option will, however, be removed in a future release of the JDK.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Run a Temporal workflow where one activity causes an exception.\r\n  1. Watch the exception handling code crash with a new RuntimeException:\r\n\r\n```\r\njava.lang.RuntimeException: Failure processing workflow task. WorkflowId=REDACTED, RunId=REDACTED\r\nat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.wrapFailure(WorkflowWorker.java:337)\r\nat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.wrapFailure(WorkflowWorker.java:275)\r\nat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:79)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\nat java.base/java.lang.Thread.run(Unknown Source)\r\n\r\n\r\n==== this is the crime scene ===\r\n\r\nCaused by: java.lang.NoClassDefFoundError: Could not initialize class io.temporal.internal.common.CheckedExceptionWrapper\r\nat io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTaskImpl(ReplayWorkflowRunTaskHandler.java:203)\r\n\r\n=========================\r\n\r\nat io.temporal.internal.replay.ReplayWorkflowRunTaskHandler.handleWorkflowTask(ReplayWorkflowRunTaskHandler.java:150)\r\nat io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTaskWithEmbeddedQuery(ReplayWorkflowTaskHandler.java:202)\r\nat io.temporal.internal.replay.ReplayWorkflowTaskHandler.handleWorkflowTask(ReplayWorkflowTaskHandler.java:112)\r\nat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:309)\r\nat io.temporal.internal.worker.WorkflowWorker$TaskHandlerImpl.handle(WorkflowWorker.java:275)\r\nat io.temporal.internal.worker.PollTaskExecutor.lambda$process$0(PollTaskExecutor.java:73)\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: Temporal 1.10.5 with Temporal Java SDK 1.0.0\r\n  - Platform: https://adoptopenjdk.net/ JDK 16 on Debian Linux\r\n","closedAt":"2021-08-29T17:42:04Z","comments":[{"id":"IC_kwDODNqesM42G0uK","author":{"login":"mattes3"},"authorAssociation":"NONE","body":"Oops, I just realized that this can be solved simply by upgrading the Temporal SDK for Java to version 1.2.0. Sorry, folks, I should have tried this first!","createdAt":"2021-08-29T09:20:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1868#issuecomment-907758474","viewerDidAuthor":false},{"id":"IC_kwDODNqesM42HHrw","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Glad that the problem is solved. ","createdAt":"2021-08-29T17:42:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1868#issuecomment-907836144","viewerDidAuthor":false}],"createdAt":"2021-08-29T08:44:04Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":1868,"reactionGroups":[],"state":"CLOSED","title":"Temporal Java SDK causes exceptions when being run on JDK 16 (illegal access to internal field of Throwable class)","updatedAt":"2021-08-29T17:42:04Z","url":"https://github.com/temporalio/temporal/issues/1868"}
