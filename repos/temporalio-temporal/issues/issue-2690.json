{"assignees":[],"author":{"id":"MDQ6VXNlcjEzMTYyOTI1","is_bot":false,"login":"matianjun1","name":"matianjun1"},"body":"## Expected Behavior\r\n\r\nSorry to use the bug report to ask my question. Temporal has less docs for production than for development.\r\n\r\nI have try my best to read the source code and the `development.yaml` at temporalio/docker-builds.\r\n\r\nBut I still can't let the production service run correctly.\r\n\r\nI have 8 instances to deploy such 4 services(frontend, matching, history and worker)\r\n\r\nThey just have their own static ips.\r\n\r\nFor `frontend` are 10.114.1.1 and 10.114.1.2\r\n\r\nFor `matching` are 10.114.2.1 and 10.114.2.2\r\n\r\nFor `history` are 10.114.3.1 and 10.114.3.2\r\n\r\nFor `worker` are 10.114.4.1 and 10.114.4.2\r\n\r\nHow can I write the deployment_mysql.yaml for those services.\r\n\r\n## Actual Behavior\r\n\r\n`unable to bootstrap ringpop. retrying\",\"service\":\"frontend\",\"error\":\"join duration of 42.398613557s exceeded max 30s`\r\n\r\nMy yaml config is\r\n\r\n```yaml\r\nlog:\r\n  stdout: true\r\n  level: info\r\n\r\npersistence:\r\n  defaultStore: mysql-default\r\n  visibilityStore: mysql-visibility\r\n  numHistoryShards: 2000\r\n  datastores:\r\n    mysql-default:\r\n      sql:\r\n        pluginName: \"mysql\"\r\n        databaseName: \"temporal\"\r\n        connectAddr: \"xxx:6409\"\r\n        connectProtocol: \"tcp\"\r\n        user: \"user_temporal\"\r\n        password: \"xxx\"\r\n        maxConns: 20\r\n        maxIdleConns: 20\r\n        maxConnLifetime: \"1h\"\r\n    mysql-visibility:\r\n      sql:\r\n        pluginName: \"mysql\"\r\n        databaseName: \"temporal_visibility\"\r\n        connectAddr: \"xxx:6409\"\r\n        connectProtocol: \"tcp\"\r\n        user: \"user_temporal_visibility\"\r\n        password: \"xxx\"\r\n        maxConns: 2\r\n        maxIdleConns: 2\r\n        maxConnLifetime: \"1h\"\r\n\r\nglobal:\r\n  membership:\r\n    maxJoinDuration: 30s\r\n    broadcastAddress: 0.0.0.0\r\n  pprof:\r\n    port: 8081\r\n  metrics:\r\n    prometheus:\r\n      timerType: \"histogram\"\r\n      listenAddress: \"0.0.0.0:2112\"\r\n\r\nservices:\r\n  frontend:\r\n    rpc:\r\n      grpcPort: 7233\r\n      membershipPort: 6933\r\n      bindOnIP: 0.0.0.0\r\n\r\n  matching:\r\n    rpc:\r\n      grpcPort: 7235\r\n      membershipPort: 6935\r\n      bindOnIP: 0.0.0.0\r\n\r\n  history:\r\n    rpc:\r\n      grpcPort: 7234\r\n      membershipPort: 6934\r\n      bindOnIP: 0.0.0.0\r\n\r\n  worker:\r\n    rpc:\r\n      grpcPort: 7239\r\n      membershipPort: 6939\r\n      bindOnIP: 0.0.0.0\r\n\r\nclusterMetadata:\r\n  enableGlobalNamespace: false\r\n  failoverVersionIncrement: 10\r\n  masterClusterName: \"active\"\r\n  currentClusterName: \"active\"\r\n  clusterInformation:\r\n    active:\r\n      enabled: true\r\n      initialFailoverVersion: 1\r\n      rpcName: \"frontend\"\r\n      rpcAddress: \"10.114.1.1:7233,10.114.1.2:7233\"\r\n\r\ndcRedirectionPolicy:\r\n  policy: \"noop\"\r\n  toDC: \"\"\r\n\r\narchival:\r\n  history:\r\n    state: \"enabled\"\r\n    enableRead: true\r\n    provider:\r\n      filestore:\r\n        fileMode: \"0666\"\r\n        dirMode: \"0766\"\r\n  visibility:\r\n    state: \"enabled\"\r\n    enableRead: true\r\n    provider:\r\n      filestore:\r\n        fileMode: \"0666\"\r\n        dirMode: \"0766\"\r\n\r\nnamespaceDefaults:\r\n  archival:\r\n    history:\r\n      state: \"disabled\"\r\n      URI: \"file:///tmp/temporal_archival/development\"\r\n    visibility:\r\n      state: \"disabled\"\r\n      URI: \"file:///tmp/temporal_vis_archival/development\"\r\n\r\npublicClient:\r\n  hostPort: \"10.114.1.2:7233,10.114.1.2:7233\"\r\n\r\ndynamicConfigClient:\r\n  filepath: \"config/dynamicconfig/development_sql.yaml\"\r\n  pollInterval: \"10s\"\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\ndocker run envs\r\n\r\n```\r\nSERVICES=frontend\r\nLOG_LEVEL=debug,info\r\n```\r\n\r\n```\r\nSERVICES=matching\r\nLOG_LEVEL=debug,info\r\n```\r\n\r\n```\r\nSERVICES=history\r\nLOG_LEVEL=debug,info\r\n```\r\n\r\n```\r\nSERVICES=worker\r\nLOG_LEVEL=debug,info\r\n```\r\n\r\n1. frontend logs\r\n\r\n```\r\n2022/03/31 17:55:49 Loading config; env=docker,zone=,configDir=config\r\n2022/03/31 17:55:49 Loading config files=[config/docker.yaml]\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.181+0800\",\"msg\":\"Build info\",\"timestamp\":\"2022-03-05T07:15:32.000+0800\",\"git-revision\":\"2540bc79c\",\"platform\":\"amd64\",\"go-version\":\"go1.17.6\",\"server-version\":\"1.15.2\",\"logging-call-at\":\"main.go:136\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.182+0800\",\"msg\":\"Updated dynamic config\",\"logging-call-at\":\"file_based_client.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.202+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"history\",\"logging-call-at\":\"fx.go:255\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.203+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"matching\",\"logging-call-at\":\"fx.go:311\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.208+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.persistenceMaxQPS\",\"value\":3000,\"default-value\":2000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.213+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.enableRingpopTLS\",\"value\":false,\"default-value\":false,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.rps\",\"value\":2400,\"default-value\":2400,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAliveMinTime\",\"value\":10,\"default-value\":10,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAlivePermitWithoutStream\",\"value\":true,\"default-value\":true,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAliveMaxConnectionIdle\",\"value\":120,\"default-value\":120,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAliveMaxConnectionAge\",\"value\":300,\"default-value\":300,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAliveMaxConnectionAgeGrace\",\"value\":70,\"default-value\":70,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAliveTime\",\"value\":60,\"default-value\":60,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.215+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.keepAliveTimeout\",\"value\":10,\"default-value\":10,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.217+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.standardVisibilityPersistenceMaxReadQPS\",\"value\":9000,\"default-value\":9000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.217+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.standardVisibilityPersistenceMaxWriteQPS\",\"value\":9000,\"default-value\":9000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.217+0800\",\"msg\":\"Get dynamic config\",\"name\":\"frontend.throttledLogRPS\",\"value\":20,\"default-value\":20,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.218+0800\",\"msg\":\"Created gRPC listener\",\"service\":\"frontend\",\"address\":\"0.0.0.0:7233\",\"logging-call-at\":\"rpc.go:156\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.218+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"worker\",\"logging-call-at\":\"fx.go:423\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.219+0800\",\"msg\":\"Starting server for services\",\"value\":{\"frontend\":{}},\"logging-call-at\":\"server_impl.go:114\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.219+0800\",\"msg\":\"PProf listen on \",\"port\":8081,\"logging-call-at\":\"pprof.go:73\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.227+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.clusterMetadataRefreshInterval\",\"value\":60,\"default-value\":60,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.230+0800\",\"msg\":\"Membership heartbeat upserted successfully\",\"service\":\"frontend\",\"address\":\"0.0.0.0\",\"port\":6933,\"hostId\":\"be33f6a0-b0d8-11ec-bafb-8efb3947b537\",\"logging-call-at\":\"rpMonitor.go:222\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:55:49.231+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"frontend\",\"bootstrap-hostports\":\"0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933,0.0.0.0:6935\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:56:26.811+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"frontend\",\"error\":\"join duration of 37.579119552s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:56:36.812+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"frontend\",\"bootstrap-hostports\":\"0.0.0.0:6933,0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:57:20.885+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"frontend\",\"error\":\"join duration of 44.072535926s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:30.886+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"frontend\",\"bootstrap-hostports\":\"0.0.0.0:6939,0.0.0.0:6933,0.0.0.0:6935,0.0.0.0:6934\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:58:11.530+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"frontend\",\"error\":\"join duration of 40.643779233s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:21.532+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"frontend\",\"bootstrap-hostports\":\"0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933,0.0.0.0:6935\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n```\r\n\r\n1. matching logs\r\n\r\n```\r\n2022/03/31 17:57:35 Loading config; env=docker,zone=,configDir=config\r\n2022/03/31 17:57:35 Loading config files=[config/docker.yaml]\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.590+0800\",\"msg\":\"Build info\",\"timestamp\":\"2022-03-05T07:15:32.000+0800\",\"git-revision\":\"2540bc79c\",\"platform\":\"amd64\",\"go-version\":\"go1.17.6\",\"server-version\":\"1.15.2\",\"logging-call-at\":\"main.go:136\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.591+0800\",\"msg\":\"Updated dynamic config\",\"logging-call-at\":\"file_based_client.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.609+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"history\",\"logging-call-at\":\"fx.go:255\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.612+0800\",\"msg\":\"Get dynamic config\",\"name\":\"matching.persistenceMaxQPS\",\"value\":3000,\"default-value\":3000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.616+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.enableRingpopTLS\",\"value\":false,\"default-value\":false,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.617+0800\",\"msg\":\"Get dynamic config\",\"name\":\"matching.rps\",\"value\":1200,\"default-value\":1200,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.617+0800\",\"msg\":\"Created gRPC listener\",\"service\":\"matching\",\"address\":\"0.0.0.0:7235\",\"logging-call-at\":\"rpc.go:156\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.618+0800\",\"msg\":\"Get dynamic config\",\"name\":\"matching.throttledLogRPS\",\"value\":20,\"default-value\":20,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.618+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"frontend\",\"logging-call-at\":\"fx.go:367\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.618+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"worker\",\"logging-call-at\":\"fx.go:423\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.618+0800\",\"msg\":\"Starting server for services\",\"value\":{\"matching\":{}},\"logging-call-at\":\"server_impl.go:114\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.618+0800\",\"msg\":\"PProf listen on \",\"port\":8081,\"logging-call-at\":\"pprof.go:73\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.627+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.clusterMetadataRefreshInterval\",\"value\":60,\"default-value\":60,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.629+0800\",\"msg\":\"Membership heartbeat upserted successfully\",\"service\":\"matching\",\"address\":\"0.0.0.0\",\"port\":6935,\"hostId\":\"fd9fb9f2-b0d8-11ec-92f2-7a701029af6d\",\"logging-call-at\":\"rpMonitor.go:222\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:57:35.630+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"matching\",\"bootstrap-hostports\":\"0.0.0.0:6939,0.0.0.0:6933,0.0.0.0:6935,0.0.0.0:6934\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:58:06.425+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"matching\",\"error\":\"join duration of 30.793952274s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:16.426+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"matching\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:58:56.500+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"matching\",\"error\":\"join duration of 40.073966967s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:59:06.501+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"matching\",\"bootstrap-hostports\":\"0.0.0.0:6939,0.0.0.0:6933,0.0.0.0:6935,0.0.0.0:6934\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:59:46.633+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"matching\",\"error\":\"join duration of 40.130988533s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:59:56.634+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"matching\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n```\r\n\r\n1. history logs\r\n\r\n```\r\n2022/03/31 17:58:56 Loading config; env=docker,zone=,configDir=config\r\n2022/03/31 17:58:56 Loading config files=[config/docker.yaml]\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.852+0800\",\"msg\":\"Build info\",\"timestamp\":\"2022-03-05T07:15:32.000+0800\",\"git-revision\":\"2540bc79c\",\"platform\":\"amd64\",\"go-version\":\"go1.17.6\",\"server-version\":\"1.15.2\",\"logging-call-at\":\"main.go:136\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.853+0800\",\"msg\":\"Updated dynamic config\",\"logging-call-at\":\"file_based_client.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.877+0800\",\"msg\":\"Get dynamic config\",\"name\":\"history.persistenceMaxQPS\",\"value\":3000,\"default-value\":9000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.881+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.enableRingpopTLS\",\"value\":false,\"default-value\":false,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.882+0800\",\"msg\":\"Get dynamic config\",\"name\":\"history.rps\",\"value\":3000,\"default-value\":3000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.884+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.standardVisibilityPersistenceMaxReadQPS\",\"value\":9000,\"default-value\":9000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.884+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.standardVisibilityPersistenceMaxWriteQPS\",\"value\":9000,\"default-value\":9000,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.884+0800\",\"msg\":\"Get dynamic config\",\"name\":\"history.throttledLogRPS\",\"value\":4,\"default-value\":4,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.885+0800\",\"msg\":\"Created gRPC listener\",\"service\":\"history\",\"address\":\"0.0.0.0:7234\",\"logging-call-at\":\"rpc.go:156\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.885+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"matching\",\"logging-call-at\":\"fx.go:311\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.885+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"frontend\",\"logging-call-at\":\"fx.go:367\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.885+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"worker\",\"logging-call-at\":\"fx.go:423\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.886+0800\",\"msg\":\"Starting server for services\",\"value\":{\"history\":{}},\"logging-call-at\":\"server_impl.go:114\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.886+0800\",\"msg\":\"PProf listen on \",\"port\":8081,\"logging-call-at\":\"pprof.go:73\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.894+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.clusterMetadataRefreshInterval\",\"value\":60,\"default-value\":60,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.896+0800\",\"msg\":\"Membership heartbeat upserted successfully\",\"service\":\"history\",\"address\":\"0.0.0.0\",\"port\":6934,\"hostId\":\"2e0fb0ec-b0d9-11ec-93b8-d625e5f93c37\",\"logging-call-at\":\"rpMonitor.go:222\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:58:56.897+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"history\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T17:59:36.108+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"history\",\"error\":\"join duration of 39.211232123s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T17:59:46.110+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"history\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T18:00:19.799+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"history\",\"error\":\"join duration of 33.688164938s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:29.800+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"history\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n```\r\n\r\n1. worker logs\r\n\r\n```\r\n2022/03/31 18:00:10 Loading config; env=docker,zone=,configDir=config\r\n2022/03/31 18:00:10 Loading config files=[config/docker.yaml]\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.278+0800\",\"msg\":\"Build info\",\"timestamp\":\"2022-03-05T07:15:32.000+0800\",\"git-revision\":\"2540bc79c\",\"platform\":\"amd64\",\"go-version\":\"go1.17.6\",\"server-version\":\"1.15.2\",\"logging-call-at\":\"main.go:136\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.279+0800\",\"msg\":\"Updated dynamic config\",\"logging-call-at\":\"file_based_client.go:142\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.474+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"history\",\"logging-call-at\":\"fx.go:255\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.474+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"matching\",\"logging-call-at\":\"fx.go:311\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.474+0800\",\"msg\":\"Service is not requested, skipping initialization.\",\"service\":\"frontend\",\"logging-call-at\":\"fx.go:367\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.477+0800\",\"msg\":\"Get dynamic config\",\"name\":\"worker.persistenceMaxQPS\",\"value\":500,\"default-value\":500,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.481+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.enableRingpopTLS\",\"value\":false,\"default-value\":false,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.551+0800\",\"msg\":\"Get dynamic config\",\"name\":\"worker.throttledLogRPS\",\"value\":20,\"default-value\":20,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.552+0800\",\"msg\":\"Starting server for services\",\"value\":{\"worker\":{}},\"logging-call-at\":\"server_impl.go:114\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.552+0800\",\"msg\":\"PProf listen on \",\"port\":8081,\"logging-call-at\":\"pprof.go:73\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.560+0800\",\"msg\":\"Get dynamic config\",\"name\":\"system.clusterMetadataRefreshInterval\",\"value\":60,\"default-value\":60,\"logging-call-at\":\"config.go:79\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.563+0800\",\"msg\":\"Membership heartbeat upserted successfully\",\"service\":\"worker\",\"address\":\"0.0.0.0\",\"port\":6939,\"hostId\":\"59ee6186-b0d9-11ec-9b2c-061d0b8e0498\",\"logging-call-at\":\"rpMonitor.go:222\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:10.564+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"worker\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n{\"level\":\"error\",\"ts\":\"2022-03-31T18:00:49.214+0800\",\"msg\":\"unable to bootstrap ringpop. retrying\",\"service\":\"worker\",\"error\":\"join duration of 38.650072825s exceeded max 30s\",\"logging-call-at\":\"ringpop.go:114\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/common/membership.(*RingPop).bootstrap\\n\\t/temporal/common/membership/ringpop.go:114\\ngo.temporal.io/server/common/membership.(*RingPop).Start\\n\\t/temporal/common/membership/ringpop.go:83\\ngo.temporal.io/server/common/membership.(*ringpopMonitor).Start\\n\\t/temporal/common/membership/rpMonitor.go:120\\ngo.temporal.io/server/common/membership.MonitorLifetimeHooks.func1\\n\\t/temporal/common/membership/fx.go:44\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).runStartHook\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:120\\ngo.uber.org/fx/internal/lifecycle.(*Lifecycle).Start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/internal/lifecycle/lifecycle.go:85\\ngo.uber.org/fx.(*App).start\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:749\\ngo.uber.org/fx.withTimeout.func1\\n\\t/go/pkg/mod/go.uber.org/fx@v1.16.0/app.go:989\"}\r\n{\"level\":\"info\",\"ts\":\"2022-03-31T18:00:59.216+0800\",\"msg\":\"bootstrap hosts fetched\",\"service\":\"worker\",\"bootstrap-hostports\":\"0.0.0.0:6935,0.0.0.0:6934,0.0.0.0:6939,0.0.0.0:6933\",\"logging-call-at\":\"rpMonitor.go:263\"}\r\n```\r\n\r\n## Specifications\r\n\r\n- Version: temporalio/server:1.15.2\r\n- Platform: Docker\r\n","closedAt":"2022-04-04T11:28:29Z","comments":[{"id":"IC_kwDODNqesM5AsqFC","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"I think the broadcastAddress should be actual IP address.","createdAt":"2022-04-01T05:45:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2690#issuecomment-1085448514","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5Aw-8F","author":{"login":"rainfd"},"authorAssociation":"NONE","body":"You can send this question to https://community.temporal.io/","createdAt":"2022-04-02T08:03:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2690#issuecomment-1086582533","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5QYbwO","author":{"login":"arvin-pjr"},"authorAssociation":"NONE","body":"set `global.membership.broadcastAddress: 127.0.0.1`. should work.","createdAt":"2022-12-13T13:39:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2690#issuecomment-1348582414","viewerDidAuthor":false}],"createdAt":"2022-03-31T10:06:56Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2690,"reactionGroups":[],"state":"CLOSED","title":"How to deploy temporal at production","updatedAt":"2022-12-13T13:39:04Z","url":"https://github.com/temporalio/temporal/issues/2690"}
