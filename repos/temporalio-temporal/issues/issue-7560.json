{"assignees":[],"author":{"id":"MDQ6VXNlcjY0NDkwNTk=","is_bot":false,"login":"adamko147","name":"Adam Horacek"},"body":"**Is your feature request related to a problem? Please describe.**\nWe're currently using self hosted temporal server with custom JWT auth plugin as described at https://docs.temporal.io/self-hosted-guide/security#plugins\nThe only reason we need to maintain custom auth plugin is missing claim mapper configuration to parse permissions from claims. Unfortunately we don't have an option to configure JWT issuer to pass permissions in form `namespace:role` as expected by default JWT claim mapper. \n\n**Describe the solution you'd like**\nDefault JWT authorization included in temporal server is almost sufficient for our use case (including issuer and audience validation), except for configuration how to parse permissions from JTW claims. An option for configuration `permissionPattern` in form of regular expression with named groups would cover our use case (as well as others potentially) and avoid overhead related to maintaining customer auth plugin and therefore significantly simplifying our setup.\n\n**Suggested solution**\nAdd `PermissionsPattern` into `Authorization` Config. If configured, it would be used to parse the claim in defaultJWTClaimMapper.extractPermissions. If not configured, fall back to original code. An example of such pattern could be \n- `prefix-i-cannot-change\\.(?P<namespace>\\w+)\\.(?P<role>\\w+)`, or \n- `(?P<namespace>\\w+)\\.(?P<role>\\w+)` to use `.` as separator (instead of `:` because that character is not allowed by JWT issuer), etc...\n\nI'm pretty ok with go and I would like to contribute by raising a PR with the new code if the owners/community agree this is viable option.\n\n**Describe alternatives you've considered**\nAs mentioned above, authorization plugin is an alternative, but it requires maintaining custom temporal build, additional CI/CD steps to build the code, create docker image, etc...\n\nThank you,\nAdam\n\nPS: And yes, for our use case, I'm ok to sacrifice performance of strings.Split vs regex.FindStringSubmatch for the benefit of not maintaining our temporal build :)\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM6liA-Q","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Hi @adamko147, thanks for the proposal!\n\nI will bring this issue to team and get relevant folks involved to review the approach described. ","createdAt":"2025-04-03T22:46:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7560#issuecomment-2777157520","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6lsKWY","author":{"login":"adamko147"},"authorAssociation":"CONTRIBUTOR","body":"> Hi [@adamko147](https://github.com/adamko147), thanks for the proposal!\n> \n> I will bring this issue to team and get relevant folks involved to review the approach described.\n\nThank you @yycptt. Meanwhile I've created #7574 with initial implementation. Early feedback from community/maintainers is very welcome! I'm also looking around the code base for places to adjust (e.g. helm charts) and trying to bring the change into our self hosted environment to verify with functional testing (in addition to unit tests included in the pull request)","createdAt":"2025-04-04T22:17:53Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7560#issuecomment-2779817368","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6uDRbc","author":{"login":"adamko147"},"authorAssociation":"CONTRIBUTOR","body":"Hi @yycptt did you have a chance to discuss this issue with team already? Thanks in advance for any update on this.","createdAt":"2025-05-29T17:31:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7560#issuecomment-2920093404","viewerDidAuthor":false}],"createdAt":"2025-04-03T05:21:20Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":7560,"reactionGroups":[],"state":"OPEN","title":"Default JWT claim mapper support for permissions parsing using regular expression","updatedAt":"2025-05-29T17:31:07Z","url":"https://github.com/temporalio/temporal/issues/7560"}
