{"assignees":[],"author":{"id":"MDQ6VXNlcjM3MjE0MQ==","is_bot":false,"login":"skrul","name":"Steve Krulewitz"},"body":"## Expected Behavior\r\n\r\nThe \"reset\" canary should complete without returning an error.\r\n\r\n## Actual Behavior\r\n\r\nIt fails. Some logs from the canary process:\r\n```\r\n{\"level\":\"error\",\"ts\":\"2020-05-28T15:00:40.405-0700\",\"msg\":\"Workflow panic.\",\"Namespace\":\"skrul-canary\",\"TaskList\":\"canary-task-queue\",\"WorkerID\":\"19948@steve-krulewitzs-MacBook-Pro.local@\",\"WorkflowID\":\"workflow.reset.base-a42f6a5e-112b-43fa-8d24-33ba860b567d\",\"RunID\":\"084c6650-9fe8-4b40-b61b-3be1e82a6a9e\",\"PanicError\":\"lookup failed for scheduledID to activityID: scheduleID: 8, activity: 8\",\"PanicStack\":\"process event for canary-task-queue [panic]:\\ngo.temporal.io/temporal/internal.panicIllegalState(...)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_decision_state_machine.go:344\\ngo.temporal.io/temporal/internal.(*decisionsHelper).handleActivityTaskScheduled(0xc0004d6bd0, 0x8, 0x55d45d8, 0x1)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_decision_state_machine.go:766 +0x175\\ngo.temporal.io/temporal/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0xc000465ce0, 0xc0003eb840, 0x1, 0x0, 0x0)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_event_handlers.go:802 +0x593\\ngo.temporal.io/temporal/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0xc0006f49a0, 0xc0003bd770, 0x5632500, 0xc0004206c0, 0xc0006f49a0, 0x0)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_handlers.go:871 +0xf15\\ngo.temporal.io/temporal/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0xc0006280a0, 0xc0003bd770, 0xc0004d6a80, 0x0, 0x0, 0x0, 0x0)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_handlers.go:770 +0x4a9\\ngo.temporal.io/temporal/internal.(*workflowTaskPoller).processWorkflowTask(0xc00046a180, 0xc0003bd770, 0x0, 0x0)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_pollers.go:285 +0x42f\\ngo.temporal.io/temporal/internal.(*workflowTaskPoller).ProcessTask(0xc00046a180, 0x4b23360, 0xc0003bd770, 0x47cef35, 0xc00066c0f0)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_pollers.go:258 +0xda\\ngo.temporal.io/temporal/internal.(*baseWorker).processTask(0xc00061e0e0, 0x4b23360, 0xc0003bd770)\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_worker_base.go:307 +0x127\\ncreated by go.temporal.io/temporal/internal.(*baseWorker).runTaskDispatcher\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_worker_base.go:254 +0x105\",\"stacktrace\":\"go.temporal.io/temporal/internal.(*workflowTaskHandlerImpl).completeWorkflow\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_handlers.go:1468\\ngo.temporal.io/temporal/internal.(*workflowExecutionContextImpl).CompleteDecisionTask\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_handlers.go:1088\\ngo.temporal.io/temporal/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_handlers.go:946\\ngo.temporal.io/temporal/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_handlers.go:770\\ngo.temporal.io/temporal/internal.(*workflowTaskPoller).processWorkflowTask\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_pollers.go:285\\ngo.temporal.io/temporal/internal.(*workflowTaskPoller).ProcessTask\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_task_pollers.go:258\\ngo.temporal.io/temporal/internal.(*baseWorker).processTask\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_worker_base.go:307\"}\r\n{\"level\":\"error\",\"ts\":\"2020-05-28T15:00:40.448-0700\",\"msg\":\"child workflow failed\",\"Namespace\":\"skrul-canary\",\"TaskList\":\"canary-task-queue\",\"WorkerID\":\"19948@steve-krulewitzs-MacBook-Pro.local@\",\"WorkflowType\":\"workflow.sanity\",\"WorkflowID\":\"cadence.canary.cron-workflow.sanity-2020-05-28T14:59:36-07:00\",\"RunID\":\"06c0c71e-52a3-4421-aabc-47eba68dceed\",\"error\":\"new execution triggered by reset is not completed\",\"stacktrace\":\"github.com/temporalio/temporal/canary.forkChildWorkflows.func1\\n\\t/Users/skrul/go/src/github.com/skrul/temporal/canary/sanity.go:96\\ngo.temporal.io/temporal/internal.(*selectorImpl).Select.func8.1\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_workflow.go:1084\\ngo.temporal.io/temporal/internal.(*selectorImpl).Select\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_workflow.go:1114\\ngithub.com/temporalio/temporal/canary.joinChildWorkflows\\n\\t/Users/skrul/go/src/github.com/skrul/temporal/canary/sanity.go:112\\ngithub.com/temporalio/temporal/canary.sanityWorkflow\\n\\t/Users/skrul/go/src/github.com/skrul/temporal/canary/sanity.go:72\\nreflect.Value.call\\n\\t/usr/local/Cellar/go/1.13.8/libexec/src/reflect/value.go:460\\nreflect.Value.Call\\n\\t/usr/local/Cellar/go/1.13.8/libexec/src/reflect/value.go:321\\ngo.temporal.io/temporal/internal.(*workflowEnvironmentInterceptor).ExecuteWorkflow\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/workflow.go:369\\ngo.temporal.io/temporal/internal.(*workflowExecutor).Execute\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_worker.go:844\\ngo.temporal.io/temporal/internal.(*syncWorkflowDefinition).Execute.func1\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_workflow.go:467\\ngo.temporal.io/temporal/internal.(*dispatcherImpl).newNamedCoroutine.func1\\n\\t/Users/skrul/go/pkg/mod/go.temporal.io/temporal@v0.22.8/internal/internal_workflow.go:878\"}\r\n```\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Run the canary\r\n\r\n## Specifications\r\n\r\n  - Version: v0.23.0\r\n  - Platform:\r\n","closedAt":"2020-07-14T19:14:50Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDYzNzA4MzI3MQ==","author":{"login":"skrul"},"authorAssociation":"NONE","body":"This may be related to the canary in release v0.23.0 depends on an older version of temporal. Will try to update this and see if it fixes the issue.\r\n","createdAt":"2020-06-01T20:24:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/420#issuecomment-637083271","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY1ODM2Mjg2Ng==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"I believe this is fixed on both canary and SDK sides.","createdAt":"2020-07-14T19:14:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/420#issuecomment-658362866","viewerDidAuthor":false}],"createdAt":"2020-05-28T22:24:36Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":420,"reactionGroups":[],"state":"CLOSED","title":"\"reset\" canary fails with panic \"lookup failed for scheduledID to activityID: scheduleID: 8, activity: 8\"","updatedAt":"2020-07-14T19:14:50Z","url":"https://github.com/temporalio/temporal/issues/420"}
