{"assignees":[{"id":"MDQ6VXNlcjU5NDI5NjM=","login":"MichaelSnowden","name":"Michael Snowden","databaseId":0}],"author":{"id":"MDQ6VXNlcjE1ODI5MTU3","is_bot":false,"login":"jupudibhaskar967","name":"Naga Jupudi"},"body":"Workflow executions after they are archived after completion are showing up multiple times via UI in the \"archived\" workflows section. This is the same behavior with temporal cli.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Bringup temporal server on kubernetes with archival enabled.\r\n2. Execute a workflow to completion.\r\n3. After couple of minutes, find the same workflow execution listed multiple times on the UI.\r\n\r\nUI status:\r\n\r\n![image](https://github.com/temporalio/temporal/assets/15829157/0b187198-faa4-4166-a6ef-e8a7a4f3c984)\r\n![image](https://github.com/temporalio/temporal/assets/15829157/843d6b40-7bcc-46f3-a400-69fc7fee3e97)\r\n\r\nTemporal cli:\r\n![image](https://github.com/temporalio/temporal/assets/15829157/3b1ef458-9b8e-4e33-9d81-9ef85310aff7)\r\n\r\nNOTE:\r\nThere is only one copy in S3 bucket for this workflow execution that means the archival is happening correctly. We think that this is a problem with the gRPC api on the server.\r\n\r\n## Specifications\r\ntemporal server: 1.20.3\r\nUI version: 2.15.0\r\nPlatform: kubernetes\r\ndefault and visibility store: postgres13\r\nArchival store: AWS S3\r\n","closedAt":"2023-08-07T22:37:39Z","comments":[{"id":"IC_kwDODNqesM5fFxj5","author":{"login":"jupudibhaskar967"},"authorAssociation":"NONE","body":"Update:  This is happening when archived workflow executions are queried without any filters. For S3 driver, the temporal UI is making an API call without any filters. Can someone please confirm?\r\n\r\ncc: @MichaelSnowden @yiminc ","createdAt":"2023-06-16T21:45:23Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4432#issuecomment-1595349241","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5jALf0","author":{"login":"jupudibhaskar967"},"authorAssociation":"NONE","body":"@MichaelSnowden  @yiminc  Is there any plan to address this in the near future?","createdAt":"2023-08-01T19:57:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4432#issuecomment-1660991476","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5jAgyw","author":{"login":"MichaelSnowden"},"authorAssociation":"CONTRIBUTOR","body":"Sorry about letting this slip! I was just able to reproduce it. I suspect you're right that this is an issue with the the gRPC  API which fetches the actual workflows as there are no duplicates in S3.\r\n\r\n\r\n### S3 Bucket\r\n\r\nThere are no duplicates here:\r\n\r\n```\r\naws --endpoint-url=http://localhost:4566 s3 ls --recursive s3://temporal-development\r\n2023-08-01 13:51:06       4473 48632fdc-54e9-449e-92b6-ab80e5921c1c/history/hello_world_workflowID/a9c567eb-d034-4f73-a895-86fcdddc1089/0/0\r\n2023-08-01 13:51:06        523 48632fdc-54e9-449e-92b6-ab80e5921c1c/visibility/workflowID/hello_world_workflowID/closeTimeout/2023-08-01T20:51:03Z/a9c567eb-d034-4f73-a895-86fcdddc1089\r\n2023-08-01 13:51:06        523 48632fdc-54e9-449e-92b6-ab80e5921c1c/visibility/workflowID/hello_world_workflowID/startTimeout/2023-08-01T20:51:03Z/a9c567eb-d034-4f73-a895-86fcdddc1089\r\n2023-08-01 13:51:06        523 48632fdc-54e9-449e-92b6-ab80e5921c1c/visibility/workflowTypeName/Workflow/closeTimeout/2023-08-01T20:51:03Z/a9c567eb-d034-4f73-a895-86fcdddc1089\r\n2023-08-01 13:51:06        523 48632fdc-54e9-449e-92b6-ab80e5921c1c/visibility/workflowTypeName/Workflow/startTimeout/2023-08-01T20:51:03Z/a9c567eb-d034-4f73-a895-86fcdddc1089\r\n```\r\n\r\n### TCTL\r\n\r\nThere are 3 duplicates of the same workflow here:\r\n\r\n<img width=\"935\" alt=\"image\" src=\"https://github.com/temporalio/temporal/assets/5942963/76838631-93f4-40a2-8f04-e54b53452d57\">\r\n\r\nI'll take a look and see what's going on.\r\n","createdAt":"2023-08-01T20:54:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4432#issuecomment-1661078704","viewerDidAuthor":false}],"createdAt":"2023-06-02T17:28:35Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4432,"reactionGroups":[],"state":"CLOSED","title":"Duplicate archival workflow executions are listed via UI / temporal CLI","updatedAt":"2023-08-07T22:37:39Z","url":"https://github.com/temporalio/temporal/issues/4432"}
