{"assignees":[{"id":"MDQ6VXNlcjEyNjAyNTAy","login":"Ardagan","name":"Mikhail Gryzykhin","databaseId":0}],"author":{"id":"MDQ6VXNlcjM3MjE0MQ==","is_bot":false,"login":"skrul","name":"Steve Krulewitz"},"body":"## Expected Behavior\r\n\r\nNo errors :)\r\n\r\n## Actual Behavior\r\n\r\nOn v0.23.0 when running only the echo canary, I am seeing various errors when deploying a dynamicconfig with the following settings:\r\n```\r\nmatching.numTasklistWritePartitions:\r\n- value: 10\r\n  constraints: {}\r\nmatching.numTasklistReadPartitions:\r\n- value: 10\r\n  constraints: {}\r\n```\r\n\r\nThe history service logs errors that look like this\r\n```\r\n{\"level\":\"error\",\"ts\":\"2020-07-09T17:39:23.515Z\",\"msg\":\"Error updating timer ack level for shard\",\"service\":\"history\",\"shard-id\":389,\"address\":\"100.64.42.181:7234\",\"component\":\"timer-queue-processor\",\"cluster-name\":\"active\",\"error\":\"Failed to update shard. Previous range ID: 46; new range ID: 47\",\"logging-call-at\":\"timerQueueAckMgr.go:393\",\"stacktrace\":\"github.com/temporalio/temporal/common/log/loggerimpl.(*loggerImpl).Error\\n\\t/temporal/common/log/loggerimpl/logger.go:138\\ngithub.com/temporalio/temporal/service/history.(*timerQueueAckMgrImpl).updateAckLevel\\n\\t/temporal/service/history/timerQueueAckMgr.go:393\\ngithub.com/temporalio/temporal/service/history.(*timerQueueProcessorBase).internalProcessor\\n\\t/temporal/service/history/timerQueueProcessorBase.go:328\\ngithub.com/temporalio/temporal/service/history.(*timerQueueProcessorBase).processorPump\\n\\t/temporal/service/history/timerQueueProcessorBase.go:195\"}\r\n```\r\n\r\nAdditionally, here are a few metrics from the matching service that are getting triggered while the task list partitioning is enabled.  During this test (starting at 14:00 on the graphs) I ran the canary first with just echo, then added query, then signal, then concurrent execution. \r\n\r\n![image](https://user-images.githubusercontent.com/372141/87190132-c72a0180-c2a6-11ea-8827-77e3b6236104.png)\r\nYellow is operation:adddecisiontask and blue is operation:addactivitytask (which started to appear when the concurrent execution canary was enabled)\r\n\r\n![image](https://user-images.githubusercontent.com/372141/87190240-fe001780-c2a6-11ea-9052-56cf47342cda.png)\r\n\r\nThese persistence errors on operation:updatetasklist happened first when enabling the partitioning then disabling it:\r\n![image](https://user-images.githubusercontent.com/372141/87190356-2be55c00-c2a7-11ea-9fc5-0ec9cad76094.png)\r\n\r\nAlso note that even though there were errors, none of the canary workflow executions failed.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Run temporal v0.23.0\r\n  2. Enable task list partitioning\r\n  3. Run the echo canary\r\n\r\n## Specifications\r\n\r\n  - Version: v0.23.0\r\n  - Platform: k8s\r\n","closedAt":"2021-02-25T00:06:37Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc4NTQ3NjMzNQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"close due to issue too old, plus did not seen similar issue during load testing\r\n\r\nplz reopen if latest version 1.7.x+ has similar issue","createdAt":"2021-02-25T00:06:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/530#issuecomment-785476335","viewerDidAuthor":false}],"createdAt":"2020-07-10T19:21:25Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":530,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"\"Error updating timer ack level for shard\" errors when enabling task list partitioning","updatedAt":"2021-02-25T00:06:37Z","url":"https://github.com/temporalio/temporal/issues/530"}
