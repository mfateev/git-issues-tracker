{"assignees":[],"author":{"id":"MDQ6VXNlcjExMDEyMw==","is_bot":false,"login":"pquerna","name":"Paul Querna"},"body":"## Expected Behavior\r\nWhen SQL connection is misconfigured, show a more accurate error message.\r\n\r\n## Actual Behavior\r\nI had misconfigured TLS client certificates when using the autosetup container, using Postgres\r\n\r\nThis was difficult to debug, because the container would log like this:\r\n```\r\n+ SCHEMA_DIR=/etc/temporal/schema/postgresql/v96/temporal/versioned\r\n+ temporal-sql-tool --plugin postgres --ep 127.0.0.1 -u postgres -p 5432 create --db temporal\r\n2021/05/27 21:22:03 error creating database:unable to connect to DB, tried default DB names: postgres,defaultdb\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nWhen ` temporal-sql-tool` is invoked with create, it sets the DatabaseName to \"\", and then invokes tryConnect/sqlx.Connect:\r\n\r\nhttps://github.com/temporalio/temporal/blob/2e3332f292d1353afad76d26ab3e23634fa975f1/common/persistence/sql/sqlplugin/postgresql/plugin.go#L117-L138\r\n\r\nErrors from the loop of trying different default DB names are ignored - instead a static string error is returned. Ideally this message would also include the Last error (or all of the errors) -- this would of made it more obvious I had misconfigured TLS.","closedAt":"2021-05-28T00:42:45Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDg0OTk2NTg1Mg==","author":{"login":"pquerna"},"authorAssociation":"CONTRIBUTOR","body":"Looks like change was recently changed via https://github.com/temporalio/temporal/pull/1413","createdAt":"2021-05-27T21:51:40Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1577#issuecomment-849965852","viewerDidAuthor":false}],"createdAt":"2021-05-27T21:46:33Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":1577,"reactionGroups":[],"state":"CLOSED","title":"SQL Connect errors are hard to debug in autosetup with Postgres","updatedAt":"2021-05-28T00:42:45Z","url":"https://github.com/temporalio/temporal/issues/1577"}
