{"assignees":[{"id":"MDQ6VXNlcjIwNjgxMjQ=","login":"rodrigozhou","name":"Rodrigo Zhou","databaseId":0},{"id":"MDQ6VXNlcjExODM4OTgx","login":"feedmeapples","name":"Ruslan","databaseId":0}],"author":{"id":"MDQ6VXNlcjE3MjQ2OTky","is_bot":false,"login":"mortvest","name":"Dmitry Serykh"},"body":"### What are you really trying to do?\r\n\r\nI am trying to create a new search attribute\r\n\r\n### Describe the bug\r\n\r\nCustom attribute creation produces the `unable to add search attributes: Search attribute already exists`  error:\r\n\r\n```\r\n$ temporal operator search-attribute list -n production\r\n             Name                Type      \r\n  BatcherNamespace            Keyword      \r\n  BatcherUser                 Keyword      \r\n  BinaryChecksums             KeywordList  \r\n  CloseTime                   Datetime     \r\n  ExecutionDuration           Int          \r\n  ExecutionStatus             Keyword      \r\n  ExecutionTime               Datetime     \r\n  HistoryLength               Int          \r\n  HistorySizeBytes            Int          \r\n  RunId                       Keyword      \r\n  StartTime                   Datetime     \r\n  StartedByUser               Keyword      \r\n  StateTransitionCount        Int          \r\n  TaskQueue                   Keyword      \r\n  TemporalChangeVersion       KeywordList  \r\n  TemporalNamespaceDivision   Keyword      \r\n  TemporalSchedulePaused      Bool         \r\n  TemporalScheduledById       Keyword      \r\n  TemporalScheduledStartTime  Datetime     \r\n  WorkflowId                  Keyword      \r\n  WorkflowType                Keyword      \r\n\r\n$ temporal operator search-attribute create -n production --name ParentWorkflowId --type Keyword\r\nError: unable to add search attributes: Search attribute ParentWorkflowId already exists.\r\nStack trace:\r\ngoroutine 1 [running]:\r\nruntime/debug.Stack()\r\n\t/usr/local/go/src/runtime/debug/stack.go:24 +0x65\r\nruntime/debug.PrintStack()\r\n\t/usr/local/go/src/runtime/debug/stack.go:16 +0x19\r\ngithub.com/temporalio/cli/app.HandleError(0xc000b3f400?, {0x31fa880, 0xc00031c500})\r\n\t/home/builder/cli/app/app.go:77 +0x15b\r\ngithub.com/urfave/cli/v2.(*App).handleExitCoder(0xc000a04dc0?, 0xc00032b700?, {0x31fa880?, 0xc00031c500?})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/app.go:445 +0x38\r\ngithub.com/urfave/cli/v2.(*Command).Run(0xc000a04dc0, 0xc00059c640, {0xc0009b4150, 0x7, 0x7})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/command.go:275 +0xa18\r\ngithub.com/urfave/cli/v2.(*Command).Run(0x45a4780, 0xc00059c580, {0xc00031ed80, 0x8, 0x8})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/command.go:266 +0xc4d\r\ngithub.com/urfave/cli/v2.(*Command).Run(0x45a44c0, 0xc00059c4c0, {0xc0004662d0, 0x9, 0x9})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/command.go:266 +0xc4d\r\ngithub.com/urfave/cli/v2.(*Command).Run(0xc000a06580, 0xc00059c380, {0xc0000500a0, 0xa, 0xa})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/command.go:266 +0xc4d\r\ngithub.com/urfave/cli/v2.(*App).RunContext(0xc0008281e0, {0x3217820?, 0xc00005c030}, {0xc0000500a0, 0xa, 0xa})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/app.go:332 +0x616\r\ngithub.com/urfave/cli/v2.(*App).Run(0x60?, {0xc0000500a0?, 0x0?, 0x0?})\r\n\t/go/pkg/mod/github.com/urfave/cli/v2@v2.25.0/app.go:309 +0x38\r\nmain.main()\r\n\t/home/builder/cli/cmd/temporal/main.go:14 +0x33\r\ncommand terminated with exit code 1\r\n\r\n$ temporal operator search-attribute list -n production\r\n             Name                Type      \r\n  BatcherNamespace            Keyword      \r\n  BatcherUser                 Keyword      \r\n  BinaryChecksums             KeywordList  \r\n  CloseTime                   Datetime     \r\n  ExecutionDuration           Int          \r\n  ExecutionStatus             Keyword      \r\n  ExecutionTime               Datetime     \r\n  HistoryLength               Int          \r\n  HistorySizeBytes            Int          \r\n  ParentWorkflowId            Keyword      \r\n  RunId                       Keyword      \r\n  StartTime                   Datetime     \r\n  StartedByUser               Keyword      \r\n  StateTransitionCount        Int          \r\n  TaskQueue                   Keyword      \r\n  TemporalChangeVersion       KeywordList  \r\n  TemporalNamespaceDivision   Keyword      \r\n  TemporalSchedulePaused      Bool         \r\n  TemporalScheduledById       Keyword      \r\n  TemporalScheduledStartTime  Datetime     \r\n  WorkflowId                  Keyword      \r\n  WorkflowType                Keyword      \r\n```\r\n\r\nAs you can see, a new custom search attribute is still created while producing an error\r\n\r\n### Minimal Reproduction\r\n\r\n`temporal operator search-attribute create -n production --name ParentWorkflowId --type Keyword`\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor: Linux\r\n- Temporal Version: 1.20.1\r\n- Calling CLI from an official `admin-tools` container, running in a Kubernetes Pod. Temporal cluster is also running in Kubernetes\r\n- I am using the new SQL based advanced visibility using postgres12\r\n\r\n### Additional context\r\n\r\n\r\n","closedAt":"2023-05-15T17:57:38Z","comments":[{"id":"IC_kwDODNqesM5ZS7o0","author":{"login":"feedmeapples"},"authorAssociation":"CONTRIBUTOR","body":"This seems to be a Temporal server issue. It always responds with an error, even though the search attribute doesn't exist. It still creates the search attribute though, so mostly a response issue. cc @rodrigozhou","createdAt":"2023-04-05T20:49:52Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4145#issuecomment-1498135092","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5ZS7xh","author":{"login":"feedmeapples"},"authorAssociation":"CONTRIBUTOR","body":"repro:\r\n\r\n```\r\nbrew upgrade temporal\r\n\r\ntemporal server start-dev\r\n\r\ntemporal operator search-attribute create --name MyAttr1 --type Keyword\r\nError: unable to add search attributes: Search attribute MyAttr1 already exists.\r\n('export TEMPORAL_CLI_SHOW_STACKS=1' to see stack traces)\r\n\r\ntemporal -v                                                            \r\ntemporal version 0.8.0 (server 1.20.1) (ui 2.13.3)\r\n```\r\n","createdAt":"2023-04-05T20:50:58Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4145#issuecomment-1498135649","viewerDidAuthor":false}],"createdAt":"2023-04-04T11:14:01Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":4145,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Search Attribute Creation Produces an Error","updatedAt":"2023-05-15T17:57:38Z","url":"https://github.com/temporalio/temporal/issues/4145"}
