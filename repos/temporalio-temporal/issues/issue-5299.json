{"assignees":[],"author":{"id":"MDQ6VXNlcjgwNjc0MA==","is_bot":false,"login":"F1bonacc1","name":"Eugene Berger"},"body":"**Is your feature request related to a problem? Please describe.**\r\nIn K8s environment there are situations when DB passwords and certificates are renewed.\r\nWhen that happens the current `worker`, `frontend`, `matching` and `history` behavior is to fail silently and log the error.\r\nThe passwords are stored in K8s secrets and loaded as environment variables, in other words, a pod restart would resolve the issue.\r\n\r\n**Describe the solution you'd like**\r\nCheck DB connectivity in liveness probe.\r\nIf the DB password is changed the temporal pods would restart and load the new secret.\r\n\r\n**Describe alternatives you've considered**\r\nUsing `tctl namespace list` as liveness probe exec command, but it can't connect to the localhost even if the correct port is specified.\r\nPlus, replacing the existing liveness probe feels hacky.\r\n\r\n**Additional context**\r\nAn example of the `tctl n l` failure when run inside the history pod.\r\n```\r\ntemporal-history-67f566466-qz8n8:/etc/temporal$ tctl --address localhost:7234 n l\r\nError: Error when list namespaces info\r\nError Details: rpc error: code = Unavailable desc = connection error: desc = \"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\"\r\n('export TEMPORAL_CLI_SHOW_STACKS=1' to see stack traces)\r\n```\r\n","closedAt":null,"comments":[],"createdAt":"2024-01-15T11:18:06Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":5299,"reactionGroups":[],"state":"OPEN","title":"Check DB Connectivity in Liveness probe","updatedAt":"2024-01-15T11:19:05Z","url":"https://github.com/temporalio/temporal/issues/5299"}
