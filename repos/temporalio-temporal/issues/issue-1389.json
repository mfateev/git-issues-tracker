{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyMTc3","is_bot":false,"login":"loopingrage","name":"Jose de Castro"},"body":"## Expected Behavior\r\nWe expected that setting `temporal-sql-tool --database defaultdb` would allow us to set the admin database to use when it differs from the default of `postgres`.\r\n\r\n## Actual Behavior\r\n\r\nWhen attempting to use an Aiven Postgres instance for Temporal we quickly ran into an issue where `temporal-sql-tool` seems is hard-coded to `postgres` as the admin database name. As a result, the `create-database` operation fails with:\r\n```\r\ndatabase \"postgres\" does not exist\r\n```\r\nAiven clusters have an admin db named `defaultdb`. We tried setting the database name but it seems to be ignored:\r\n\r\n```\r\n./temporal-sql-tool --plugin postgres --endpoint XXXXXXX.aivencloud.com --port 15355 --user avnadmin --password XXXXXXX --tls --tls-enable-host-verification --tls-ca-file ca.pem --database defaultdb create-database -database temporal\r\n\r\nerror creating database:pq: database \"postgres\" does not exist\r\n```\r\n\r\n","closedAt":"2021-03-26T23:59:52Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgwMzcyNzI0NA==","author":{"login":"loopingrage"},"authorAssociation":"NONE","body":"I changed [this line](https://github.com/temporalio/temporal/blob/master/common/persistence/sql/sqlplugin/postgresql/plugin.go#L125) and build the tool from source and it works. Unless I'm missing something, there doesn't seems to be way to set `cfg.DatabaseName` via the command line.","createdAt":"2021-03-22T02:56:15Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1389#issuecomment-803727244","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwNTA5MjUyMA==","author":{"login":"loopingrage"},"authorAssociation":"NONE","body":"Hey @wxing1292. Any suggestions here?","createdAt":"2021-03-23T17:32:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1389#issuecomment-805092520","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwNjEzNjgwMQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":">We expected that setting temporal-sql-tool --database defaultdb would allow us to set the admin database to use when it differs from the default of postgres.\r\n\r\naccording to my memory, the target database must be specified when a connection is establish to PostgreSQL\r\nthis is why `postgres` is used, e.g. \r\n* first establish a connection to the default / prebuilt DB (`postgres`)\r\n* create a new DB for either prod use case, or for testing purpose\r\n\r\n(not familiar with Aiven)\r\nto unblock you, can you create a DB `postgres`?\r\n\r\nBTW, we currently only support MySQL 5.7, PostgreSQL 9.6 and Cassandra 3.11 ","createdAt":"2021-03-24T19:53:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1389#issuecomment-806136801","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwNzc0Njg1Mw==","author":{"login":"loopingrage"},"authorAssociation":"NONE","body":"Aiven Cloud doesn't have a default `postgres` database. Their admin database is named `defaultdb`. Seems it would be useful to support setting the name of the default DB in temporal-sql-tool no? I'm happy to craft a PR if you can point me in the right direction.","createdAt":"2021-03-25T23:44:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1389#issuecomment-807746853","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwODU4ODI5NQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"> Seems it would be useful to support setting the name of the default DB in temporal-sql-tool no?\r\n\r\ndoing so will create a special behavior for `temporal-sql-tool`, e.g. a new config which will only be useful for postgresql\r\n\r\nseems #1413 which adds the ability to try a set of default DB names","createdAt":"2021-03-26T23:33:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1389#issuecomment-808588295","viewerDidAuthor":false}],"createdAt":"2021-03-21T03:43:53Z","labels":[{"id":"MDU6TGFiZWwyMDE5OTA0OTIw","name":"discussion","description":"","color":"3ffcb0"}],"milestone":null,"number":1389,"reactionGroups":[],"state":"CLOSED","title":"temporal-sql-tool default postgres database","updatedAt":"2021-03-26T23:59:52Z","url":"https://github.com/temporalio/temporal/issues/1389"}
