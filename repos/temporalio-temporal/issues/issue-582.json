{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjE3NjY1MTU=","is_bot":false,"login":"samarabbas","name":"Samar Abbas"},"body":"If user queries on an invalid index, elastic search returns back `bad query: 400` error back to the caller.  Temporal wraps all elastic search errors as internal service errors resulting in retry logic to kick in by clients.  Certain errors like error code 400 should not be wrapped as internal service errors.","closedAt":"2021-09-24T04:47:16Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY2MTk5MDc4Ng==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"Here is one example:\r\n\r\n```\r\nctx := context.Background()\r\n\tsearchResult, err := v.esClient.SearchWithDSL(ctx, v.index, queryDSL)\r\n\tif err != nil {\r\n\t\treturn nil, serviceerror.NewInternal(fmt.Sprintf(\"ListWorkflowExecutions failed. Error: %v\", err))\r\n\t}\r\n```","createdAt":"2020-07-21T17:13:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/582#issuecomment-661990786","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3ODY4NjQ2Nw==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"After discussions and investigations we found that the way how we communicate errors needs to be changed to support this. `Internal` needs to be replaced with `Unavailable` everywhere where it should be retried. Which is a breaking change and will require us to block newer SDKs on old servers.","createdAt":"2021-07-13T00:29:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/582#issuecomment-878686467","viewerDidAuthor":false}],"createdAt":"2020-07-21T17:12:57Z","labels":[{"id":"MDU6TGFiZWwxNzkwMTM1NzM5","name":"refactoring","description":"","color":"e8b181"},{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":582,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"All Elasticsearch errors are returned back as internal service errors","updatedAt":"2021-09-24T04:47:16Z","url":"https://github.com/temporalio/temporal/issues/582"}
