{"assignees":[],"author":{"id":"MDQ6VXNlcjQ5MDU3MTY0","is_bot":false,"login":"andropler","name":""},"body":"## Expected Behavior\nThe Temporal Server should be fully compatible with Elasticsearch 8.x without generating excessive error logs for deprecated fields. Deprecation warnings from Elasticsearch should ideally be handled internally or logged at a warn or info level, rather than error, to avoid log noise in production environments.\n\n## Actual Behavior\nThe frontend service repeatedly logs an error level message when interacting with Elasticsearch 8.19.2. The error message indicates that a deprecated field include_upper is being used in a CountWorkflowExecutions request.\n\nLog Snippet:\n\n\"msg\": \"Deprecation warning: 299 Elasticsearch-8.19.2-c1c00e18ef14acd650768ff01f037eaede0c1f7b \\\"Deprecated field [include_upper] used, this field is unused and will be removed entirely\\\"\"\n\"level\": \"error\"\n\"logging-call-at\": \"temporal/common/persistence/visibility/store/elasticsearch/client/logger.go:24\"\nEven though the server version is 1.29.1, it seems the internal olivere/elastic/v7 client is still sending legacy parameters that trigger this warning from the ES 8.x server.\n\n## Steps to Reproduce the Problem\n\n  1. Deploy Temporal Server v1.29.1.\n  2. Connect it to an Elasticsearch cluster version 8.19.2 or similar 8.x version.\n  3. Trigger a workflow execution count (e.g., by opening the Temporal Web UI or calling CountWorkflowExecutions via CLI/SDK).\n  4. Check the frontend service logs in the temporal namespace.\n\n## Specifications\n\n  - Version: Temporal Server v1.29.1\n  - Platform: Kubernetes\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM7ccBA4","author":{"login":"andropler"},"authorAssociation":"NONE","body":"Note that I'm running ES 8.19 and used the most recent APIs for index creation. Please refer to the stack trace attached below.\n\ngo.temporal.io/server/common/log.(*zapLogger).Error\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/log/zap_logger.go:151\ngo.temporal.io/server/common/persistence/visibility/store/elasticsearch/client.(*errorLogger).Printf\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/persistence/visibility/store/elasticsearch/client/logger.go:24\ngithub.com/olivere/elastic/v7.(*Client).errorf\n\t/home/runner/go/pkg/mod/github.com/olivere/elastic/v7@v7.0.32/client.go:840\ngithub.com/olivere/elastic/v7.(*Client).PerformRequest\n\t/home/runner/go/pkg/mod/github.com/olivere/elastic/v7@v7.0.32/client.go:1479\ngithub.com/olivere/elastic/v7.(*CountService).Do\n\t/home/runner/go/pkg/mod/github.com/olivere/elastic/v7@v7.0.32/count.go:364\ngo.temporal.io/server/common/persistence/visibility/store/elasticsearch/client.(*clientImpl).Count\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/persistence/visibility/store/elasticsearch/client/client_v7.go:140\ngo.temporal.io/server/common/persistence/visibility/store/elasticsearch.(*VisibilityStore).CountWorkflowExecutions\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/persistence/visibility/store/elasticsearch/visibility_store.go:375\ngo.temporal.io/server/common/persistence/visibility.(*visibilityManagerImpl).CountWorkflowExecutions\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/persistence/visibility/visibility_manager_impl.go:147\ngo.temporal.io/server/common/persistence/visibility.(*visibilityManagerRateLimited).CountWorkflowExecutions\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/persistence/visibility/visibility_manager_rate_limited.go:126\ngo.temporal.io/server/common/persistence/visibility.(*visibilityManagerMetrics).CountWorkflowExecutions\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/persistence/visibility/visiblity_manager_metrics.go:137\ngo.temporal.io/server/service/frontend.(*WorkflowHandler).CountWorkflowExecutions\n\t/home/runner/work/docker-builds/docker-builds/temporal/service/frontend/workflow_handler.go:2582\ngo.temporal.io/api/workflowservice/v1._WorkflowService_CountWorkflowExecutions_Handler.func1\n\t/home/runner/go/pkg/mod/go.temporal.io/api@v1.53.0/workflowservice/v1/service_grpc.pb.go:3113\ngo.temporal.io/server/common/rpc/interceptor.(*RetryableInterceptor).Intercept.func1\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/retry.go:38\ngo.temporal.io/server/common/backoff.ThrottleRetryContext\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/backoff/retry.go:65\ngo.temporal.io/server/common/rpc/interceptor.(*RetryableInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/retry.go:42\ngoogle.golang.org/grpc.getChainUnaryHandler.func1.getChainUnaryHandler.1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*SlowRequestLoggerInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/slow_request_logger.go:51\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*CallerInfoInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/caller_info.go:40\ngoogle.golang.org/grpc.getChainUnaryHandler.func1.getChainUnaryHandler.1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*SDKVersionInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/sdk_version.go:44\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*RateLimitInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/rate_limit.go:64\ngoogle.golang.org/grpc.getChainUnaryHandler.func1.getChainUnaryHandler.1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceRateLimitInterceptorImpl).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/namespace_rate_limit.go:75\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*ConcurrentRequestLimitInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/concurrent_request_limit.go:83\ngoogle.golang.org/grpc.getChainUnaryHandler.func1.getChainUnaryHandler.1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceValidatorInterceptor).StateValidationIntercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/namespace_validator.go:210\ngoogle.golang.org/grpc.getChainUnaryHandler.func1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*HealthInterceptor).Intercept\n\t/home/runner/work/docker-builds/docker-builds/temporal/common/rpc/interceptor/health.go:42\ngoogle.golang.org/grpc.getChainUnaryHandler.func1.getChainUnaryHandler.1\n\t/home/runner/go/pkg/mod/google.golang.org/grpc@v1.72.2/server.go:1217\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryInterceptor).UnaryIntercept","createdAt":"2025-12-30T05:12:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8909#issuecomment-3698331704","viewerDidAuthor":false}],"createdAt":"2025-12-29T08:19:57Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":8909,"reactionGroups":[],"state":"OPEN","title":"Deprecation error log in v1.29.1 with Elasticsearch 8.19.2","updatedAt":"2025-12-30T05:12:01Z","url":"https://github.com/temporalio/temporal/issues/8909"}
