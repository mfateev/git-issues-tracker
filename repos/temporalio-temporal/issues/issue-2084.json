{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjY3OTIxMzA=","is_bot":false,"login":"benmoriceau","name":"Benoit Moriceau"},"body":"## Expected Behavior\r\n\r\nThe auto-setup image should perform the DB migration properly even if the postgres user name and the DB Name do not match. Currently it is not the case because it will try to recreate the db, which fails because the database already exists.\r\n\r\n## Actual Behavior\r\n\r\nThe auto setup fails because it tries to create an existing DB. [This](https://github.com/temporalio/temporal/blob/master/docker/auto-setup.sh#L179) condition seems to be the problem. We (airbyte) don't have any control on the infra structure on which the temporal DB is going to run and which DB user name our user are going to choose. \r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Create a temporal DB using the auto-setup container with an old version which will need to perform a DB upgrade to be migrated to the latest version (1.7.0 in our case).\r\n  2. Shut down the container\r\n  3. Restart it with the lastest container version\r\n\r\n## Specifications\r\n\r\n  - Version: 1.7.0\r\n  - Platform:\r\n","closedAt":"2021-10-22T23:46:30Z","comments":[{"id":"IC_kwDODNqesM44oBtW","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"First of all, we support only sequential updates between minor versions (2nd component in semver). You can't jump from 1.7.0 to 1.12.3. Secondly, `auto-setup` image is for local development only and was never tested for any migrations. Users are supposed to use it with our [docker-compose](https://github.com/temporalio/docker-compose/blob/main/docker-compose.yml#L42) and not for production depoloyments.\r\n\r\nThe reason why this check is there is because supported version of PostgreSQL (9.6) creates DB automatically when user is created. So if there is a user `temporal` in the system than it means that `temporal` DB is also there and script shouldn't create it.","createdAt":"2021-10-22T23:46:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2084#issuecomment-950016854","viewerDidAuthor":false},{"id":"IC_kwDODNqesM44oB04","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"You can read more at #1613.","createdAt":"2021-10-22T23:48:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2084#issuecomment-950017336","viewerDidAuthor":false},{"id":"IC_kwDODNqesM44oCCW","author":{"login":"benmoriceau"},"authorAssociation":"NONE","body":"Thanks for your answer Alex, I will look at the issue you linked.","createdAt":"2021-10-22T23:52:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2084#issuecomment-950018198","viewerDidAuthor":false}],"createdAt":"2021-10-22T16:56:05Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2084,"reactionGroups":[],"state":"CLOSED","title":"Unable to perform migration to the lastest version of the auto-setup image because the of a missmatch of the DB-user-name and the DB-name","updatedAt":"2021-10-22T23:52:49Z","url":"https://github.com/temporalio/temporal/issues/2084"}
