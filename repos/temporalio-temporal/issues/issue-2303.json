{"assignees":[{"id":"MDQ6VXNlcjYzNTAzMDE=","login":"jbreiding","name":"Jeremy","databaseId":0},{"id":"MDQ6VXNlcjg0NDExMDE0","login":"yiminc","name":"Yimin Chen","databaseId":0}],"author":{"id":"MDQ6VXNlcjk3MzU0Mw==","is_bot":false,"login":"gajus","name":"Gajus Kuizinas"},"body":"## Expected Behavior\r\n\r\nSetup database schema.\r\n\r\n## Actual Behavior\r\n\r\nError:\r\n\r\n```\r\n+ SCHEMA_DIR=/etc/temporal/schema/postgresql/v96/temporal/versioned\r\n+ temporal-sql-tool --plugin postgres --ep airbyte-contra.aivencloud.com -u avnadmin -p 23893 create --db temporal\r\n2021/12/15 03:46:52 error creating database:pq: no pg_hba.conf entry for host \"34.85.152.8\", user \"avnadmin\", database \"postgres\", no encryption\r\n+ temporal-sql-tool --plugin postgres --ep airbyte-contra.aivencloud.com -u avnadmin -p 23893 --db temporal setup-schema -v 0.0\r\n2021/12/15 03:46:52 pq: no pg_hba.conf entry for host \"34.85.152.8\", user \"avnadmin\", database \"temporal\", no encryption\r\n+ temporal-sql-tool --plugin postgres --ep airbyte-contra.aivencloud.com -u avnadmin -p 23893 --db temporal update-schema -d /etc/temporal/schema/postgresql/v96/temporal/versioned\r\n2021/12/15 03:46:52 pq: no pg_hba.conf entry for host \"34.85.152.8\", user \"avnadmin\", database \"temporal\", no encryption\r\n+ VISIBILITY_SCHEMA_DIR=/etc/temporal/schema/postgresql/v96/visibility/versioned\r\n+ temporal-sql-tool --plugin postgres --ep airbyte-contra.aivencloud.com -u avnadmin -p 23893 create --db temporal_visibility\r\n2021/12/15 03:46:52 error creating database:pq: no pg_hba.conf entry for host \"34.85.152.8\", user \"avnadmin\", database \"postgres\", no encryption\r\n+ temporal-sql-tool --plugin postgres --ep airbyte-contra.aivencloud.com -u avnadmin -p 23893 --db temporal_visibility setup-schema -v 0.0\r\n2021/12/15 03:46:52 pq: no pg_hba.conf entry for host \"34.85.152.8\", user \"avnadmin\", database \"temporal_visibility\", no encryption\r\n+ temporal-sql-tool --plugin postgres --ep airbyte-contra.aivencloud.com -u avnadmin -p 23893 --db temporal_visibility update-schema -d /etc/temporal/schema/postgresql/v96/visibility/versioned\r\n2021/12/15 03:46:52 pq: no pg_hba.conf entry for host \"34.85.152.8\", user \"avnadmin\", database \"temporal_visibility\", no encryption\r\n+ '[' '' '!=' true ']'\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Using database hosting that mandates `sslmode=require`\r\n\r\n## Specifications\r\n\r\n  - Version: latest\r\n","closedAt":"2022-04-11T15:48:38Z","comments":[{"id":"IC_kwDODNqesM47Q13c","author":{"login":"gajus"},"authorAssociation":"NONE","body":"As far as I can see, Docker images do not allow to provide tls flags to `temporal-sql-tool`.","createdAt":"2021-12-15T04:02:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-994270684","viewerDidAuthor":false},{"id":"IC_kwDODNqesM47biKj","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@gajus could you take a look at this post https://stackoverflow.com/questions/1406025/no-pg-hba-conf-entry-for-host and see if this is some misconfig issue. ","createdAt":"2021-12-17T22:43:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-997073571","viewerDidAuthor":false},{"id":"IC_kwDODNqesM47bi-y","author":{"login":"gajus"},"authorAssociation":"NONE","body":"We are using a managed database (Aiven). We don't have access to hba.","createdAt":"2021-12-17T22:53:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-997076914","viewerDidAuthor":false},{"id":"IC_kwDODNqesM48EY1R","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@gajus , temporal-sql-tool does allow you to connect with --tls enabled. Is this the problem with auto-setup docker image?","createdAt":"2022-01-07T22:19:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-1007783249","viewerDidAuthor":false},{"id":"IC_kwDODNqesM49Jvtr","author":{"login":"gajus"},"authorAssociation":"NONE","body":"@yiminc Indeed, we are using `temporalio/auto-setup`.\r\n\r\nRather, that's what Airbyte Helm chart uses.\r\n\r\nhttps://github.com/airbytehq/airbyte/blob/fd6c3127175a766ebe555ac01411c219ca47c919/charts/airbyte/templates/temporal/deployment.yaml#L26\r\n\r\nIs there a way to override this?","createdAt":"2022-01-31T16:27:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-1025964907","viewerDidAuthor":false},{"id":"IC_kwDODNqesM49JxCi","author":{"login":"gajus"},"authorAssociation":"NONE","body":"Tried adding:\r\n\r\n```yaml\r\nSQL_TLS:                            true\r\nSQL_TLS_DISABLE_HOST_VERIFICATION:  true\r\n```\r\n\r\nas suggested here:\r\n\r\nhttps://github.com/temporalio/temporal/issues/2293#issuecomment-991956803\r\n\r\nThough still getting the same error.","createdAt":"2022-01-31T16:32:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-1025970338","viewerDidAuthor":false},{"id":"IC_kwDODNqesM4-fDse","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"@gajus\r\nI just went through verifying using our latest docker-compose and the auto-setup environment variables, everything was successful.\r\n\r\nLooking at your comment in #2293, one difference I see is that the auto-setup tag you are using is `1.7.0`, can you give `1.13.1` a shot that was mentioned in that issue?","createdAt":"2022-02-23T00:07:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-1048328990","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5BR-JJ","author":{"login":"jbreiding"},"authorAssociation":"CONTRIBUTOR","body":"Once this PR lands, https://github.com/temporalio/docker-compose/pull/82, this is an example of how to perform this process until we refactor these configuration items.","createdAt":"2022-04-11T15:48:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2303#issuecomment-1095230025","viewerDidAuthor":false}],"createdAt":"2021-12-15T03:50:39Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg2","name":"duplicate","description":"This issue or pull request already exists","color":"cfd3d7"},{"id":"MDU6TGFiZWwyNzcwMzY2NzYw","name":"close-after-30-days","description":"","color":"1d76db"}],"milestone":null,"number":2303,"reactionGroups":[],"state":"CLOSED","title":"\"no encryption\"","updatedAt":"2022-04-11T15:48:38Z","url":"https://github.com/temporalio/temporal/issues/2303"}
