{"assignees":[],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"**Is your feature request related to a problem? Please describe.**\r\nIf a worker is down the query returns:  \"context deadline exceeded\"\r\n\r\n**Describe the solution you'd like**\r\nAn error message that would give more information about the query failure. For example \"no worker polling for tasks\" or \"worker didn't reply within timeout\", etc.\r\n","closedAt":"2025-05-20T19:28:56Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDg3NDg4NjY5Ng==","author":{"login":"leowmjw"},"authorAssociation":"NONE","body":"@samarabbas I'll take a stab at this; hope too get some guidance.  To clarify, this is for the logs shown in the temporal server logs; correct?\r\n\r\nI was able to reproduce the \"context deadline exceeded\" in logs by running a query while worker node is not started.\r\n\r\nBased on the stack trace, I modified so the output of logs is as below, it will now display \"no worker polling for tasks\":\r\n\r\nhistory service\r\n```\r\n{\"level\":\"error\",\"ts\":\"2021-07-06T10:08:48.202+0800\",\"msg\":\"no worker polling for tasks\",\"service\":\"history\",\"shard-id\":4,\"address\":\"127.0.0.1:7234\",\"shard-item\":\"0xc00077af00\",\"component\":\"history-engine\",\"error\":\"context deadline exceeded\",\"logging-call-at\":\"historyEngine.go:939\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/Users/leow/GOMOD/temporal/common/log/zap_logger.go:143\\ngo.temporal.io/server/service/history.(*historyEngineImpl).queryDirectlyThroughMatching\\n\\t/Users/leow/GOMOD/temporal/service/history/historyEngine.go:939\\ngo.temporal.io/server/service/history.(*h..\r\n```\r\nfrontend service\r\n```\r\n{\"level\":\"error\",\"ts\":\"2021-07-06T10:08:48.202+0800\",\"msg\":\"uncategorized error\",\"service\":\"frontend\",\"operation\":\"QueryWorkflow\",\"wf-namespace\":\"default\",\"error\":\"DEADLINE: context deadline exceeded\",\"logging-call-at\":\"telemetry.go:188\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/Users/leow/GOMOD/temporal/common/log/zap_logger.go:143\\ngo.temporal.io/server/common/rpc/interceptor...\r\n```\r\n\r\nAm I on the right path? \r\n\r\nWas looking to add a test case for this but looks pretty complex so far; any closest test case for history service I can start/base it upon?","createdAt":"2021-07-06T16:01:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-874886696","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6bzqun","author":{"login":"gaurav1999"},"authorAssociation":"NONE","body":"Can this issue be closed ?, I guess the PR by @ShahabT is merged into main.","createdAt":"2025-01-25T16:02:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-2614012839","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6pmtkY","author":{"login":"SuryaCS719"},"authorAssociation":"NONE","body":"I gave this a try on the latest main by starting a workflow without a worker polling the task queue, then triggering a query.\n\nThe query returned a `context deadline exceeded` error, which seems expected. I didn’t notice a clearly surfaced message like “no worker polling for tasks” in the logs or client output.\n\nHappy to retry or share logs if useful. This was a helpful way to get more familiar with how queries are handled internally.\n","createdAt":"2025-05-01T18:55:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-2845497624","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6qs-WQ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"We should validate the fix. I remember doing this a while back and seeing the expected outcome.\nThe query should return a `FailedPrecondition` error with the message: \"no poller seen for task queue recently, worker may be down\".\n\nSteps to reproduce:\n- Start a workflow using the client\n- Query the workflow\n\nIt would be great to clarify under which conditions this happens as opposed to getting a context deadline error, which is expected to happen under certain situations (e.g. the client sets a short deadline).\n\nSee the PR that was supposed to address this for more context: https://github.com/temporalio/temporal/pull/5252.\n","createdAt":"2025-05-08T18:28:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-2863916432","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6rfEPe","author":{"login":"vaibhavyadav-dev"},"authorAssociation":"CONTRIBUTOR","body":"@bergundy review my PR, and let me know if any changes or modifications required.\nThanks.","createdAt":"2025-05-13T15:50:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-2877047774","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6slYOF","author":{"login":"vaibhavyadav-dev"},"authorAssociation":"CONTRIBUTOR","body":"I started the temporal on the latest main branch, using ```make start-dependencies``` and ```make start```.\nStarted simple payment workflow, that check if payment is completed or not, without starting the worker (go-sdk).\nQueried the workflow and got following output \n\n![Image](https://github.com/user-attachments/assets/6545d0b7-3aa5-4cb2-9979-86bdd1fdd594)\n\nOkay @bergundy @mfateev  Look like this issue is already resolved, you can close this one.\nThanks","createdAt":"2025-05-20T18:49:29Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-2895479685","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6sl6q1","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Thanks for verifying @vaibhavyadav-dev, I will close the issue.\n\nFixed by #5252.","createdAt":"2025-05-20T19:28:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1546#issuecomment-2895620789","viewerDidAuthor":false}],"createdAt":"2021-05-13T01:09:15Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxNjIxMDMwNzg5","name":"good first issue","description":"Good for newcomers","color":"7057ff"},{"id":"MDU6TGFiZWwyMDE5OTIzNjU1","name":"devexp","description":"","color":"9350b7"},{"id":"MDU6TGFiZWwyNTc2NTM1ODQ2","name":"difficulty: easy","description":"","color":"68d662"},{"id":"MDU6TGFiZWwzMTM4ODI4MTE3","name":"up-for-grabs","description":"Issues to consider for external contribution","color":"69CD90"}],"milestone":null,"number":1546,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Improve query timeout message if worker is down","updatedAt":"2025-05-20T19:28:57Z","url":"https://github.com/temporalio/temporal/issues/1546"}
