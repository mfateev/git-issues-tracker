{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjEwNzk1NDc=","is_bot":false,"login":"nshazly","name":""},"body":"## Expected Behavior\r\nRunning `tctl workflow list` should respond with a list of running works flows or an empty list. Not an error.\r\n\r\n## Actual Behavior\r\n\r\n```\r\n$ tctl workflow list                                                       \r\nError: Failed to list closed workflow.\r\nError Details: context deadline exceeded\r\n('export TEMPORAL_CLI_SHOW_STACKS=1' to see stack traces)\r\n```\r\nAnd the web interface shows the following error:\r\n\r\n![image](https://user-images.githubusercontent.com/1079547/160196915-1dd3f65e-a214-4e30-8f06-a551f23c216b.png)\r\n\r\nAdditionally, \r\n```\r\n$ tctl wf start --tq fake.queue --wt fake.workflow\r\nStarted Workflow Id: bf730e6e-5f21-476f-a0ae-7b2e39707326, run Id: 00356ebe-2a10-4034-844e-735cfa2f2b16\r\n\r\n$   tctl wf term -w bf730e6e-5f21-476f-a0ae-7b2e39707326     \r\nError: Terminate workflow failed.\r\nError Details: sql: no rows in result set\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Fresh install of temporal IO using elasticsearch/postgresql, version 1.15.2\r\n  2. Run the command `tctl n re default` to create a namespace\r\n  3. Start a workflow `tctl wf start --tq fake.queue --wt fake.workflow --et 10`\r\n  4. Run `tctl workflow list`\r\nOR\r\n   Log into the WEB Interface\r\n\r\n## Specifications\r\n\r\n  - Version: 1.15.2\r\n  - Platform: K8s\r\n","closedAt":"2022-03-25T21:48:31Z","comments":[{"id":"IC_kwDODNqesM5AV0Xg","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"You didn't create schema in Elasticsearch. How did you deploy your cluster? If you don't use `auto-setup` image or helm charts, you need to run similar steps manually: https://github.com/temporalio/docker-builds/blob/main/docker/auto-setup.sh#L268-L276.","createdAt":"2022-03-25T21:48:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2649#issuecomment-1079461344","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AV_Fo","author":{"login":"nshazly"},"authorAssociation":"NONE","body":"@alexshtin The helm chart was used to deploy and the cron that creates the schema ran. Querying the ES cluster shows 2 indexes. So the schema looks to be properly created. \r\n\r\n> On Mar 25, 2022, at 2:48 PM, Alex Shtin ***@***.***> wrote:\r\n> \r\n> ﻿\r\n> You didn't create schema in Elasticsearch. How did you deploy your cluster? If you don't use auto-setup image or helm charts, you need to run similar steps manually: https://github.com/temporalio/docker-builds/blob/main/docker/auto-setup.sh#L268-L276.\r\n> \r\n> —\r\n> Reply to this email directly, view it on GitHub, or unsubscribe.\r\n> You are receiving this because you authored the thread.\r\n","createdAt":"2022-03-25T23:06:55Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2649#issuecomment-1079505256","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AgDpU","author":{"login":"nshazly"},"authorAssociation":"NONE","body":"@alexshtin Running the auto-setup scripts shows the indexes are alr4eady created and the error persists. Can this ticket be re-opened ?\r\n```\r\n$ curl -X PUT \"${INDEX_URL}\" --write-out \"\\n\"\r\n{\"error\":{\"root_cause\":[{\"type\":\"resource_already_exists_exception\",\"reason\":\"index [temporal_visibility/KbYZaZBjTuucfbR0z8si4g] \r\nalready exists\",\"index_uuid\":\"KbYZaZBjTuucfbR0z8si4g\",\"index\":\"temporal_visibility\"}],\"type\":\"resource_already_exists_exception\",\"reason\":\"index [temporal_visibility/KbYZaZBjTuucfbR0z8si4g] already exists\",\"index_uuid\":\"KbYZaZBjTuucfbR0z8si4g\",\"index\":\"temporal_visibility\"},\"status\":400}\r\n```","createdAt":"2022-03-29T17:10:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2649#issuecomment-1082145364","viewerDidAuthor":false}],"createdAt":"2022-03-25T20:36:19Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2649,"reactionGroups":[],"state":"CLOSED","title":"Fresh install and workflow results in ListClosedWorkflowExecutions, Elasticsearch error","updatedAt":"2022-03-29T17:10:58Z","url":"https://github.com/temporalio/temporal/issues/2649"}
