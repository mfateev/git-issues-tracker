{"assignees":[{"id":"MDQ6VXNlcjQ5NTI1MzU=","login":"prathyushpv","name":"Prathyush PV","databaseId":0}],"author":{"id":"MDQ6VXNlcjQyNzM0OTA=","is_bot":false,"login":"koolay","name":"koolay"},"body":"## Expected Behavior\r\nRequire less memory usage.\r\n\r\n## Actual Behavior\r\n\r\ncontainer resources:\r\n\r\n![image](https://user-images.githubusercontent.com/4273490/234535219-0a0f3858-bb33-4202-8726-46fa96059027.png)\r\n\r\nserver metrics:\r\n\r\n![image](https://user-images.githubusercontent.com/4273490/234550779-036d1636-bfd4-4308-b29d-98000fccfefa.png)\r\n\r\n\r\ngo tool pprof \"http://localhost:7936/debug/pprof/heap\"\r\n\r\n![image](https://user-images.githubusercontent.com/4273490/234534796-fa97c39c-64ed-49d8-94bd-f1150712fa30.png)\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.  create one thousand workflows\r\n\r\n  `temporal-dynamic-config`\r\n\r\n ```yaml\r\napiVersion: v1\r\ndata:\r\n  dynamic_config.yaml: |-\r\n    history.cacheInitialSize:\r\n    - value: \"10\"\r\n    history.cacheMaxSize:\r\n    - value: \"50\"\r\n    history.cacheTTL:\r\n    - value: \"0.5\"\r\n    history.eventsCacheInitialSize:\r\n    - value: \"10\"\r\n    history.eventsCacheMaxSize:\r\n    - value: \"50\"\r\n    matching.useOldRouting:\r\n    - value: \"false\"\r\nkind: ConfigMap\r\nmetadata:\r\n  annotations:\r\n    meta.helm.sh/release-name: temporal\r\n    meta.helm.sh/release-namespace: temporal\r\n  creationTimestamp: \"2022-11-09T04:02:55Z\"\r\n  labels:\r\n    app.kubernetes.io/instance: temporal\r\n    app.kubernetes.io/managed-by: Helm\r\n    app.kubernetes.io/name: temporal\r\n    app.kubernetes.io/part-of: temporal\r\n    app.kubernetes.io/version: 1.20.2\r\n    helm.sh/chart: temporal-0.20.2\r\n  name: temporal-dynamic-config\r\n  namespace: temporal\r\n  resourceVersion: \"64727569\"\r\n  uid: 01925a28-4772-42e9-891e-bdb467bf496f\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: temporalio/server:1.20.2\r\n  - Platform: k8s\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5jr2m5","author":{"login":"leididi"},"authorAssociation":"NONE","body":"encountered the same problemï¼›\r\n\r\n```\r\nName:         temporal-dynamic-config\r\nNamespace:    temporal\r\nLabels:       app.kubernetes.io/instance=temporal\r\n              app.kubernetes.io/managed-by=Helm\r\n              app.kubernetes.io/name=temporal\r\n              app.kubernetes.io/part-of=temporal\r\n              app.kubernetes.io/version=1.20.2\r\n              helm.sh/chart=temporal-0.20.2\r\nAnnotations:  meta.helm.sh/release-name: temporal\r\n              meta.helm.sh/release-namespace: temporal\r\n\r\nData\r\n====\r\ndynamic_config.yaml:\r\n----\r\nhistory.cacheInitialSize:\r\n- value: \"10\"\r\nhistory.cacheMaxSize:\r\n- value: \"50\"\r\nhistory.cacheTTL:\r\n- value: \"0.1\"\r\nhistory.eventsCacheInitialSize:\r\n- value: \"10\"\r\nhistory.eventsCacheMaxSize:\r\n- value: \"50\"\r\nmatching.useOldRouting:\r\n- value: \"false\"\r\n```\r\n\r\n\r\n![image](https://github.com/temporalio/temporal/assets/34613810/52cf6d6b-8810-44cf-b892-549ab9719bd4)\r\n","createdAt":"2023-08-10T02:19:53Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-1672440249","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5vXe5N","author":{"login":"trangtran-ct"},"authorAssociation":"NONE","body":"Hi, we experienced the same problem. Any update on this? Thanks a lot.","createdAt":"2023-12-24T04:01:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-1868426829","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5_GzxP","author":{"login":"DhirajBhakta"},"authorAssociation":"NONE","body":"Noticing the same issue. Could you help us understand if the history service detects available memory(available to the pod) and automatically set max cache size to available value?","createdAt":"2024-05-27T01:30:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-2132491343","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6YYl_K","author":{"login":"vikrant-shetty-s1"},"authorAssociation":"NONE","body":"Is there any progress on this issue?","createdAt":"2024-12-20T09:13:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-2556583882","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6Zf9jZ","author":{"login":"danielserrao"},"authorAssociation":"NONE","body":"I'm experiencing the same issue.","createdAt":"2025-01-07T13:25:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-2575292633","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7JX8H9","author":{"login":"szbauer"},"authorAssociation":"NONE","body":"I see there was an MR for this, but now it's been marked as stale, is there any intention of getting this resolved? ","createdAt":"2025-10-07T19:53:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-3378495997","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7Mjav3","author":{"login":"unleftie"},"authorAssociation":"NONE","body":"@prathyushpv hi, could you please take a look at the mentioned PR? I've noticed a similar behavior with high RAM usage","createdAt":"2025-10-22T11:07:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4233#issuecomment-3431836663","viewerDidAuthor":false}],"createdAt":"2023-04-26T10:25:46Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4233,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":6}}],"state":"OPEN","title":"Too high memory usage on history service ","updatedAt":"2025-10-22T11:07:10Z","url":"https://github.com/temporalio/temporal/issues/4233"}
