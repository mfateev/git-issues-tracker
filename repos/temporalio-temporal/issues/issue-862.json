{"assignees":[{"id":"MDQ6VXNlcjg3NjI4OTM=","login":"wxing1292","name":"Wenquan Xing","databaseId":0}],"author":{"id":"MDQ6VXNlcjY0NTE0OA==","is_bot":false,"login":"kop","name":"Ivan Koptiev"},"body":"## Expected Behavior\r\n\r\nMigration script runs correctly.\r\n\r\n## Actual Behavior\r\n\r\n```\r\ntemporal_1              | + temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 --db temporal_visibility update-schema -d /etc/temporal/schema/postgres/visibility/versioned\r\ntemporal_1              | 2020/10/15 18:13:54 UpdateSchemeTask started, config=&{DBName: TargetVersion: SchemaDir:/etc/temporal/schema/postgres/visibility/versioned IsDryRun:false}\r\ntemporal_1              | 2020/10/15 18:13:54 error listing schema dir:open /etc/temporal/schema/postgres/visibility/versioned: no such file or directory\r\ntemporal_1              | Unable to start server: sql schema version compatibility check failed: version mismatch for keyspace/database: \"temporal\". Expected version: 1.1 cannot be greater than Actual version: 1.0.\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Start temporalio/auto-setup:1.0.0.\r\n  2. Stop it.\r\n  3. temporalio/auto-setup:1.1.0.\r\n\r\n```\r\n  temporal:\r\n    image: temporalio/auto-setup:1.1.0\r\n    ports:\r\n      - \"7233:7233\"\r\n    environment:\r\n      DB: postgres\r\n      DB_PORT: 26257\r\n      POSTGRES_USER: root\r\n      POSTGRES_SEEDS: postgres\r\n      DYNAMIC_CONFIG_FILE_PATH: config/dynamicconfig/development.yaml\r\n    depends_on:\r\n      - cockroachdb\r\n    links:\r\n      - cockroachdb:postgres\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: 1.0.0, 1.1.0.\r\n","closedAt":"2020-10-27T21:41:15Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDcwOTUxMTQ4NQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"postgresql is not production ready yet (will be in ~ 1 week or so).\r\n\r\n> error listing schema dir:open /etc/temporal/schema/postgres/visibility/versioned: no such file or directory\r\n\r\nthe issue is probably due to the move of schema files from `schema/postgresql/` to `schema/postgresql/v96`, for better (potentially) support\r\n","createdAt":"2020-10-15T18:28:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/862#issuecomment-709511485","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcwOTUyNzM2Nw==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"#864","createdAt":"2020-10-15T18:56:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/862#issuecomment-709527367","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcwOTUyODgyNg==","author":{"login":"kop"},"authorAssociation":"NONE","body":"Thanks for the info!","createdAt":"2020-10-15T18:58:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/862#issuecomment-709528826","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxNzU1Njk5Nw==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"solved in 1.2.1 release\r\nhttps://github.com/temporalio/temporal/releases/tag/v1.2.1","createdAt":"2020-10-27T21:41:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/862#issuecomment-717556997","viewerDidAuthor":false}],"createdAt":"2020-10-15T18:22:36Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":862,"reactionGroups":[],"state":"CLOSED","title":"Failed DB migration (PostgreSQL): auto-setup:1.0.0 -> auto-setup:1.1.0","updatedAt":"2020-10-27T21:41:15Z","url":"https://github.com/temporalio/temporal/issues/862"}
