{"assignees":[],"author":{"id":"MDQ6VXNlcjkzNjQ5MzE=","is_bot":false,"login":"mlcdf","name":"Maxime Le Conte des Floris"},"body":"Hello, I'm running Temporal 1.22.3 and some metrics are bizarre.\r\n\r\n## Expected Behavior\r\n\r\n_bucket metrics with more than two `le` labels (`1` and `Inf+`).\r\n\r\n## Actual Behavior\r\n\r\n```\r\ntemporal_request_latency_bucket{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_history_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_history_scanner_workflow\",le=\"1\"} 1\r\ntemporal_request_latency_bucket{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_history_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_history_scanner_workflow\",le=\"+Inf\"} 1\r\ntemporal_request_latency_sum{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_history_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_history_scanner_workflow\"} 0.038107612\r\ntemporal_request_latency_count{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_history_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_history_scanner_workflow\"} 1\r\ntemporal_request_latency_bucket{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_tq_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_tq_scanner_workflow\",le=\"1\"} 1\r\ntemporal_request_latency_bucket{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_tq_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_tq_scanner_workflow\",le=\"+Inf\"} 1\r\ntemporal_request_latency_sum{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_tq_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_tq_scanner_workflow\"} 0.021006401\r\ntemporal_request_latency_count{activity_type=\"none\",client_name=\"temporal_go\",namespace=\"temporal_system\",operation=\"StartWorkflowExecution\",service_name=\"worker\",task_queue=\"temporal_sys_tq_scanner_taskqueue_0\",worker_type=\"none\",workflow_type=\"temporal_sys_tq_scanner_workflow\"} 1\r\n```\r\n\r\nIt's not specific to this metrics, other histograms are impacted (not all though).\r\n\r\nThose affected metrics all produces the same result in Grafana: \r\n\r\n![image](https://github.com/temporalio/temporal/assets/9364931/4266a6cd-7ab0-4c42-8a69-ff3721005757)\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Start Temporal with the default metrics configuration\r\n  2. curl http://temporal-server:9100/metrics\r\n\r\n## Specifications\r\n\r\n  - Version: 1.22.3\r\n  - Platform: Official Docker container running inside k8s\r\n","closedAt":"2023-12-29T12:49:33Z","comments":[{"id":"IC_kwDODNqesM5vlVX5","author":{"login":"mlcdf"},"authorAssociation":"NONE","body":"Look what I found while viewing the config for something else:\r\n```\r\n    metrics:\r\n        prometheus:\r\n            framework: \"tally\"\r\n            defaultHistogramBoundaries:\r\n                - 1\r\n```\r\n\r\n:facepalm: \r\n\r\nSorry for the noise!","createdAt":"2023-12-29T12:49:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5247#issuecomment-1872057849","viewerDidAuthor":false}],"createdAt":"2023-12-27T10:05:30Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5247,"reactionGroups":[],"state":"CLOSED","title":"Broken metrics ","updatedAt":"2023-12-29T12:49:34Z","url":"https://github.com/temporalio/temporal/issues/5247"}
