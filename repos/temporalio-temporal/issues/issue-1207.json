{"assignees":[],"author":{"id":"MDQ6VXNlcjE3MzkxMjEw","is_bot":false,"login":"ingyamilmolinar","name":"ymolinar"},"body":"## Expected Behavior\r\nI expect binaries to be built successfully with GOOS=linux GOARCH=386\r\n\r\n## Actual Behavior\r\n```\r\n$ GOOS=linux GOARCH=386 make bins\r\nDelete old binaries...\r\nBuild temporal-server with OS: linux, ARCH: 386...\r\ngo build -ldflags '-X go.temporal.io/server/common/metrics.GitRevision=b468ed56 -X go.temporal.io/server/common/metrics.GitBranch=HEAD -X go.temporal.io/server/common/metrics.GitVersion=v1.5.1 -X go.temporal.io/server/common/metrics.BuildDate=2021-01-20-15:38:12 -X go.temporal.io/server/common/metrics.BuildTimeUnix=1611185892' -o temporal-server cmd/server/main.go\r\n# go.temporal.io/server/common/persistence/elasticsearch\r\ncommon/persistence/elasticsearch/esVisibilityStore.go:829:13: constant -9223372036854775808 overflows int\r\ncommon/persistence/elasticsearch/esVisibilityStore.go:831:13: constant 9223372036854775807 overflows int\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. `GOOS=linux GOARCH=386 make bins`\r\n\r\n## Specifications\r\n\r\n  - Version: 1.5.1\r\n  - Platform: Linux\r\n","closedAt":"2021-03-24T19:56:01Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc2NTU4NDg2Ng==","author":{"login":"tristan-hyams"},"authorAssociation":"NONE","body":"Well 386 is not a 64-bit system, I anticipate the compiler for these systems do the double stacking int32 when coming across int64 primitives as available - I am not sure how much I even remember from the x86_x64 days to be honest.\r\n\r\nThis particular value (non-variable declaration) having a problem with though is an untyped constant simply holding the value of the max INT64. This should always fail to compile on a 32-bit OS and x86 bit compiler with over/underflow issues. Read more details on untyped constants in a paragraph [here](https://golang.org/ref/spec#Constants).\r\n\r\nThis is filed for a revision for Golang v2 and is accepted as is for now [here](https://github.com/golang/go/issues/23086). A work around would be to create your own constant for Temporal that is hard typed to a primitive e.g. `MAX_INT64 = int64(math.MaxInt64)`. I don't know if a 386 image would compile even that correctly so I don't propose it as a solution without testing it. You could also probably use `string conversion` from `string` to `const int64` with another `string` as a constant representing the actual max/min value of `int64`.\r\n\r\nIf you are feeling particularly hackerish/dirty one could convert to using the long as string but that's a much more involved change.\r\n\r\nThe line that triggers the compilation problem is this:\r\nhttps://github.com/temporalio/temporal/blob/eee26ca754b6ef37bb7cb07dbf732853075e27b2/common/persistence/elasticsearch/esVisibilityStore.go#L829\r\n\r\nFor more Code Context\r\n```golang\r\nfunc (v *esVisibilityStore) getValueOfSearchAfterInJSON(token *esVisibilityPageToken, sortField string) (string, error) {\r\n\tvar sortVal interface{}\r\n\tvar err error\r\n\tswitch v.getFieldType(sortField) {\r\n\tcase enumspb.INDEXED_VALUE_TYPE_INT, enumspb.INDEXED_VALUE_TYPE_DATETIME, enumspb.INDEXED_VALUE_TYPE_BOOL:\r\n\t\tsortVal, err = token.SortValue.(json.Number).Int64()\r\n\t\tif err != nil {\r\n\t\t\terr, ok := err.(*strconv.NumError) // field not present, ES will return big int +-9223372036854776000\r\n\t\t\tif !ok {\r\n\t\t\t\treturn \"\", err\r\n\t\t\t}\r\n\t\t\tif err.Num[0] == '-' { // desc\r\n\t\t\t\tsortVal = math.MinInt64\r\n\t\t\t} else { // asc\r\n\t\t\t\tsortVal = math.MaxInt64\r\n\t\t\t}\r\n\t\t}\r\n```\r\n\r\n@sergeybykov I am not sure the etiquette on tagging developers - sort of new here.","createdAt":"2021-01-22T17:55:09Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1207#issuecomment-765584866","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc4NTQ3MDQ4NQ==","author":{"login":"wxing1292"},"authorAssociation":"CONTRIBUTOR","body":"service logic will use int64 type, so not sure how 32bit mode will work.\r\n\r\nfor now, i don't think support 32bit will be an option.","createdAt":"2021-02-24T23:51:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1207#issuecomment-785470485","viewerDidAuthor":false}],"createdAt":"2021-01-21T00:05:42Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"},{"id":"MDU6TGFiZWwyNzcwMzY2NzYw","name":"close-after-30-days","description":"","color":"1d76db"}],"milestone":null,"number":1207,"reactionGroups":[],"state":"CLOSED","title":"Binaries do not build for 386","updatedAt":"2021-03-24T19:56:01Z","url":"https://github.com/temporalio/temporal/issues/1207"}
