{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjIyMzI1MjQ=","is_bot":false,"login":"alexshtin","name":"Alex Shtin"},"body":"**Is your feature request related to a problem? Please describe.**\r\nAfter custom search attributes are added to the system, it takes 1 minute for cache to be invalidated. It is ok for production scenarios but doesn't work for automated integration tests and might be confusing for first time users. To make things even worse frontend cache invalidates immediately and `tctl cluster get-search-attributes` command in single cluster setup returns updated information but any actual request to start workflow with search attributes will fail because history cache is not invalidated.\r\n\r\n**Describe the solution you'd like**\r\nI see 3 possible ways:\r\n1. Send message using gossip protocol to all nodes and services in the cluster to invalidate internal caches right after search attributes are updated.\r\n2. Move search attributes cache to the server level and solve the problem for single node deployments (local testing fits it).\r\n3. Make cache invalidate interval configurable (currently 1 min) and set to some lower number (i.e. 1s) using environment variable for test environments (i.e. docker-compose).\r\n","closedAt":"2022-02-12T05:06:16Z","comments":[{"id":"IC_kwDODNqesM449UkN","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Option 4), make the cache read through (when a search attribute is not in the cache, reload from db), and only enable that read through if a dynamic config is enabled. Default that dynamic config to false, and enable it in test  environment. ","createdAt":"2021-10-30T21:59:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/2094#issuecomment-955599117","viewerDidAuthor":false},{"id":"IC_kwDODNqesM46lsuQ","author":{"login":"paulnpdev"},"authorAssociation":"MEMBER","body":"I'm with Yimin","createdAt":"2021-11-30T19:43:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2094#issuecomment-982961040","viewerDidAuthor":false},{"id":"IC_kwDODNqesM489d-8","author":{"login":"meiliang86"},"authorAssociation":"MEMBER","body":"Take a look at this with Yimin. There are places in code that we read from the list other than validation. To make sure we always read the up to date information, we will add a dynamic config to bypass cache for the read. This config should only be turned on for testing.","createdAt":"2022-01-27T01:01:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2094#issuecomment-1022746556","viewerDidAuthor":false}],"createdAt":"2021-10-26T21:08:44Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":2094,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":3}}],"state":"CLOSED","title":"Invalidate custom search attributes cache","updatedAt":"2022-02-12T05:06:16Z","url":"https://github.com/temporalio/temporal/issues/2094"}
