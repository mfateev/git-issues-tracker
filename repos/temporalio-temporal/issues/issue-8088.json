{"assignees":[],"author":{"id":"U_kgDOCrUtKg","is_bot":false,"login":"aas47","name":""},"body":"## Expected Behavior\nThe no_poller_tasks metric should continue to be exposed in Prometheus after upgrading Temporal Server. This metric is used to monitor situations where no pollers are available to handle task queues.\n\n## Actual Behavior\nAfter upgrading from Temporal Server v1.27.1.0 to a higher version, the no_poller_tasks metric is no longer present in Prometheus. This breaks monitoring dashboards and alerts that rely on this metric.\n\n## Steps to Reproduce the Problem\n\n1. Run Temporal Server v1.27.1.0 with Prometheus metrics enabled.\n2. Confirm the presence of the no_poller_tasks metric in Prometheus.\n3. Upgrade to a higher version (e.g., v1.27.2.0 or later).\n4. Observe that no_poller_tasks metric is no longer available in Prometheus.\n\n## Specifications\n\nVersion:\n- Observed in: 1.27.1.0 (working)\n- Missing in: 1.27.2.0, 1.28.0.0\n\nPlatform:\n- Docker on linux\n- Prometheus scraping enabled via metrics.prometheus\n\n<img width=\"1507\" height=\"741\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/6dc52d36-f499-4e05-b852-603aeaa19c64\" />","closedAt":"2025-11-14T05:25:00Z","comments":[{"id":"IC_kwDODNqesM7FSXHT","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Let me ping our team internally and follow up here.","createdAt":"2025-09-18T22:42:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8088#issuecomment-3309924819","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7GAmji","author":{"login":"ShahabT"},"authorAssociation":"MEMBER","body":"Hi @aas47, the metric is not removed but it could be that some tags are modified in the new version. Could you please ensure that the metric without any filters on the tags show up?\n\nIf still have a problem please let us know.","createdAt":"2025-09-23T01:15:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8088#issuecomment-3322046690","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7Jnc18","author":{"login":"jtamagnan"},"authorAssociation":"CONTRIBUTOR","body":"FWIW I can see `no_poller_tasks` in most cases but have noticed situations where after a non-upgrade rolling restart of my Temporal cluster some metrics are missing. For example after a recent restart my Temporal cluster is missing the `approximate_backlog_count{taskqueue=\"HIBERNATE_TIMER_aws_ap_southeast_1_1\"}` metric despite seeing it in the UI.\n\n<details>\n<summary> Missing metrics </summary>\n\n<img width=\"2994\" height=\"1004\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/1d8b45c9-ccd4-4d38-b3f3-503fce69e4f0\" />\n</details>\n<details>\n<summary> Task queue still existing in the UI </summary>\n\n<img width=\"3352\" height=\"482\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/071e8347-0271-468a-b6f9-32431b63c900\" />\n</details>\n\nIn fact it seems like all metrics for certain task queues are entirely missing","createdAt":"2025-10-08T17:32:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8088#issuecomment-3382562172","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7Q7Fka","author":{"login":"ShahabT"},"authorAssociation":"MEMBER","body":"@jtamagnan I'd expect the metrics to be present in this case. is it possible that the metric system is not reading the new nodes metrics? do you see all the matching service pods/hosts present in the metrics when this happen?","createdAt":"2025-11-07T22:00:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8088#issuecomment-3505150234","viewerDidAuthor":false}],"createdAt":"2025-07-23T14:30:13Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":8088,"reactionGroups":[],"state":"CLOSED","title":"Metric no_poller_tasks missing after upgrade from Temporal Server 1.27.1.0","updatedAt":"2025-11-14T05:25:00Z","url":"https://github.com/temporalio/temporal/issues/8088"}
