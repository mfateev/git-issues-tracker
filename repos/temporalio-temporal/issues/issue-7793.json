{"assignees":[],"author":{"id":"MDQ6VXNlcjExMjAzMjg=","is_bot":false,"login":"smcgivern","name":"Sean McGivern"},"body":"## Expected Behavior\n\nBad schedules can't cause high CPU usage on Temporal.\n\n## Actual Behavior\n\nWhen we set a bad schedule, the temporal-frontend process gets stuck in GetNextTime. https://github.com/temporalio/temporal/pull/7389 was supposed to fix this, but we're seeing the problem after upgrading to 1.27.2.\n\n<img width=\"1285\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/c1446eae-c412-41e8-b5b4-11c7e5c77068\" />\n\n[pprof.temporal-server.samples.cpu.001.pb.gz](https://github.com/user-attachments/files/20297253/pprof.temporal-server.samples.cpu.001.pb.gz)\n\n## Steps to Reproduce the Problem\n\nWe're not sure exactly what schedule spec we're sending to cause this, unfortunately. We think it's something that looks like this:\n\n```js\n{\n  intervals: [ { every: 1814400000, offset: 896400170 } ],\n  skip: [\n    {\n      hour: '*',\n      minute: '*',\n      second: '*',\n      month: '*',\n      year: '*',\n      dayOfWeek: 'SATURDAY'\n    }\n  ],\n  jitter: 3600000\n}\n```\n\nBut I cannot reproduce this locally with `temporal-cli`.\n\n## Specifications\n\n  - Version: 1.27.2\n  - Platform: self-hosted, k8s + Postgres\n","closedAt":"2025-05-27T23:16:21Z","comments":[{"id":"IC_kwDODNqesM6sUzDm","author":{"login":"smcgivern"},"authorAssociation":"NONE","body":"Actually, my local temporal-cli is now using all CPU. So possibly it is that schedule!","createdAt":"2025-05-19T13:55:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7793#issuecomment-2891133158","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6sWEsH","author":{"login":"smcgivern"},"authorAssociation":"NONE","body":"Apologies, this is the 'bad' spec that causes Temporal to fail to create the schedule and just go into an infinite loop:\n\n```js\n{\n  intervals: [ { every: 1814400000, offset: 903600910 } ],\n  skip: [\n    {\n      hour: '*',\n      minute: '*',\n      second: '*',\n      month: '*',\n      year: '*',\n      dayOfWeek: 'SATURDAY'\n    },\n    {\n      hour: '*',\n      minute: '*',\n      second: '*',\n      month: '*',\n      year: '*',\n      dayOfWeek: 'SUNDAY'\n    }\n  ],\n  jitter: 3600000\n}\n```","createdAt":"2025-05-19T15:34:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7793#issuecomment-2891467527","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6sWFXt","author":{"login":"smcgivern"},"authorAssociation":"NONE","body":"This is a nonsensical spec, as it's trying to run on Sundays and also skip Sundays, but I think Temporal should handle that in some way ðŸ™‚ ","createdAt":"2025-05-19T15:35:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/7793#issuecomment-2891470317","viewerDidAuthor":false}],"createdAt":"2025-05-19T13:37:00Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7793,"reactionGroups":[],"state":"CLOSED","title":"Still seeing GetNextTime looping infinitely","updatedAt":"2025-05-27T23:16:21Z","url":"https://github.com/temporalio/temporal/issues/7793"}
