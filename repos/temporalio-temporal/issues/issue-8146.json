{"assignees":[],"author":{"id":"MDQ6VXNlcjE2Nzg0Nw==","is_bot":false,"login":"Hades32","name":"Martin Rauscher"},"body":"I'm investigating why our Temporal DB grows seemingly unbounded although the number of workflows has been reduce a lot already. More details at https://temporalio.slack.com/archives/CTTJCPZQE/p1752664893131099\n\nAs part of that investigation I noticed that the `signals_requested_sets` table would grow all the time. I then randomly selected several WorkflowIDs from that table, entered them in the WebUI and *they could not be found*.\n\n## Expected Behavior\n\nSignal table to not contain rows for workflow runs that don't exist anymore\n\n## Actual Behavior\n\ntable contains rows referencing workflow runs that do not exist anymore\n\n\n## Steps to Reproduce the Problem\n\nidk\n\n## Specifications\n\n  - Version: temporalio/server:1.22.4\n  - Platform: linux, k8s, helm\n","closedAt":"2025-11-14T05:23:34Z","comments":[{"id":"IC_kwDODNqesM6_eCJ7","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"We will investigate this, thanks for reporting. This is with Postgres persistence based on the slack thread.","createdAt":"2025-08-21T23:06:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3212321403","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7KcN0q","author":{"login":"Hades32"},"authorAssociation":"NONE","body":"Thanks @bergundy , did you find something? It's still slowly growing for us","createdAt":"2025-10-13T08:26:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3396394282","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7Kz9Oh","author":{"login":"toni-rib-skydio"},"authorAssociation":"NONE","body":"We have a similar issue except it seems to be the history_node table that is growing unbounded. Ours is 91GB in production currently. A developer from my team was looking at our staging environment yesterday and discovered only about 10% of our history_node table reflects workflow executions that are currently retained. Is that expected behavior, or should the table only reflect currently retained executions? Our namespace has a 3 day retention limit but it is difficult to tell from the database if this is being respected. I'm not sure if Continue As New jobs are affecting this, per this blog post: https://temporal.io/blog/very-long-running-workflows\n\nBut it would be great to hear from someone at Temporal what the expected behavior is for retaining workflow information past the retention limit is in the database.","createdAt":"2025-10-14T16:04:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3402617761","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7K0GpQ","author":{"login":"Hades32"},"authorAssociation":"NONE","body":"Why do think this would be the same issue if another table is affected? From your description it sounds like you should create a separate issue","createdAt":"2025-10-14T16:13:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3402656336","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7LWHKn","author":{"login":"toni-rib-skydio"},"authorAssociation":"NONE","body":"I was told from someone at Temporal to update this issue. If it helps you though, we did just set worker.historyScannerDataMinAge in our staging environment to 4 days (1 day past our 3 day retention limit which I believe is the default) and a few hours later saw a dramatic cleanup of data. Worker logs showed \"deleted history garbage\" and table sizes dropped dramatically as bad data got cleaned up. It might be worth a shot for you!\n\nhttps://github.com/temporalio/temporal/blob/f3aee543a1af41540beafb97e5b532e9998372d5/service/worker/scanner/scanner.go#L52-L54","createdAt":"2025-10-16T15:57:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3411571367","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7LZdUz","author":{"login":"Hades32"},"authorAssociation":"NONE","body":"Thanks for the hint, will definitely check it out. \nEdit: Didn't have an effect for us","createdAt":"2025-10-16T19:00:08Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3412448563","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7SQoQo","author":{"login":"Hades32"},"authorAssociation":"NONE","body":"@bergundy using this query I validated that we have orphaned data. Do you see any issue with it?\n```sql\nSELECT srs_x.shard_id,\n       count(1) filter ( where ce_workflow_id is null and ex_workflow_id is null )        as cnt_orphaned,\n       count(1) filter ( where ce_workflow_id is not null or ex_workflow_id is not null ) as cnt_alive\nfrom (select srs.shard_id, ce.workflow_id as ce_workflow_id, ex.workflow_id as ex_workflow_id\n      FROM signals_requested_sets srs\n               LEFT JOIN\n           current_executions ce\n           on srs.shard_id = ce.shard_id and srs.namespace_id = ce.namespace_id and srs.workflow_id = ce.workflow_id and\n              srs.run_id = ce.run_id\n               LEFT JOIN\n           executions ex\n           on srs.shard_id = ex.shard_id and srs.namespace_id = ex.namespace_id and srs.workflow_id = ex.workflow_id and\n              srs.run_id = ex.run_id\n      limit 1000000) as srs_x\ngroup by srs_x.shard_id\n```\nThat showed that for each shard we have about 300k orphans and only 3k alive entries...","createdAt":"2025-11-13T12:25:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3527574568","viewerDidAuthor":false},{"id":"IC_kwDODNqesM7SeKrg","author":{"login":"Hades32"},"authorAssociation":"NONE","body":"Why closed? Is there a fix?","createdAt":"2025-11-14T06:36:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8146#issuecomment-3531123424","viewerDidAuthor":false}],"createdAt":"2025-08-05T08:55:13Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":8146,"reactionGroups":[],"state":"CLOSED","title":"Potential leak in `signals_requested_sets` table","updatedAt":"2025-11-14T06:36:37Z","url":"https://github.com/temporalio/temporal/issues/8146"}
