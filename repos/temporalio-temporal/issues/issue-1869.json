{"assignees":[],"author":{"id":"MDQ6VXNlcjM5Njc3NDQ0","is_bot":false,"login":"datoslabs","name":""},"body":"Hi,\r\n\r\nI am trying to evaluate Temporal for my project.  I am fairly new to Temporal; I was under the impression that I would be able to query against a workflow in completed status as per [Custom query on a terminated workflow returns error](https://community.temporal.io/t/custom-query-on-a-terminated-workflow-returns-error/1756) discussion.  \r\n\r\nIn my test, if I use the same `workflowStub` instance that started the workflow, I was able to query the workflow after I wait for its completion using `Thread.sleep()`; however, if I exit and restart `worker` as well as reinstantiate a new `workflowStub` with the same `workflowId`, I receive `IllegalStateException`.  Is querying the workflow long after it's completed/terminated not supported?\r\n\r\n## Expected Behavior\r\nAfter a workflow is completed, user should be able to query the workflow with a new workflowStub.\r\n\r\n## Actual Behavior\r\nReceived the following error:\r\n```\r\nException in thread \"main\" java.lang.IllegalStateException: Null workflowId. Was workflow started?\r\n\tat io.temporal.internal.sync.WorkflowStubImpl.checkStarted(WorkflowStubImpl.java:388)\r\n\tat io.temporal.internal.sync.WorkflowStubImpl.query(WorkflowStubImpl.java:337)\r\n\tat io.temporal.internal.sync.WorkflowInvocationHandler$SyncWorkflowInvocationHandler.queryWorkflow(WorkflowInvocationHandler.java:309)\r\n\tat io.temporal.internal.sync.WorkflowInvocationHandler$SyncWorkflowInvocationHandler.invoke(WorkflowInvocationHandler.java:272)\r\n\tat io.temporal.internal.sync.WorkflowInvocationHandler.invoke(WorkflowInvocationHandler.java:178)\r\n\tat com.sun.proxy.$Proxy10.getCurrentState(Unknown Source)\r\n\tat ai.crowdlytics.orchestration.temporal.workflow.Test.main(Test.java:75)\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.  Start a workflow\r\n  2.  Use `Thread.sleep` to wait until workflow is completed, using the same `workflowStub` instance (that started the workflow execution) to query the workflow returns successfully with expected results.\r\n  3.  Terminate worker and client.\r\n  4.  Initiate a new `WorkerFactory` (ie `factory.start()`), new `workflowStub` instance with the same `workflowId ` and execute the workflow query method, this time it fails with the above stack trace.\r\n\r\n## Specifications\r\n\r\n  - Version: 1.2.0\r\n  - Platform: client: Java SDK, server: docker-compose -f docker-compose-postgres.yml up\r\n","closedAt":"2021-08-29T22:11:24Z","comments":[{"id":"IC_kwDODNqesM42HTRX","author":{"login":"datoslabs"},"authorAssociation":"NONE","body":"Please disregard, I figured out what I did wrong.  For an existing workflow, I should instantiate the `workflowStub` with:\r\n\r\n`client.newWorkflowStub(DSLWorkflow.class, workflowId);`\r\n\r\nInstead, I was instantiating the `workflowStub` with:\r\n\r\n```\r\nclient.newWorkflowStub(DSLWorkflow.class,\r\n\tWorkflowOptions.newBuilder().setWorkflowId(workflowId).setTaskQueue(TASK_QUEUE).build());\r\n```\r\nwhich should only be used to start a new workflow.\r\n\r\n","createdAt":"2021-08-29T22:11:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"HOORAY","users":{"totalCount":1}},{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/1869#issuecomment-907883607","viewerDidAuthor":false}],"createdAt":"2021-08-29T21:22:26Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":1869,"reactionGroups":[],"state":"CLOSED","title":"Unable to query completed workflow","updatedAt":"2021-08-29T22:11:24Z","url":"https://github.com/temporalio/temporal/issues/1869"}
