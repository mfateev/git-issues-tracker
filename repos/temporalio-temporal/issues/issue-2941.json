{"assignees":[{"id":"MDQ6VXNlcjQ5NTI1MzU=","login":"prathyushpv","name":"Prathyush PV","databaseId":0}],"author":{"id":"MDQ6VXNlcjg0NDExMDE0","is_bot":false,"login":"yiminc","name":"Yimin Chen"},"body":"History uses mutable state cache and history event cache, and the caches are per shard, this is not efficient and hard to config.\r\n\r\nWe should make cache host level that is shared among all shards hosted on that host.\r\n\r\nThe dynamic config for cache size is entry count, but it is not easy to estimate the average entry size and make it harder to config. We should change the config to be byte size so cache would take up to the configured memory byte size. \r\nHere are the current dynamic configs for cache size:\r\n`history.cacheInitialSize` default 128\r\n`history.cacheMaxSize` default 512\r\n`history.eventsCacheInitialSize` default 128\r\n`history.eventsCacheMaxSize` default 512\r\n\r\nWe should also emit a gauge metric that measures the cache size in use. We already have the cache_hit and cache_miss, which we should keep after upgrade to host level.\r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDODNqesM5koYzi","author":{"login":"danthegoodman1"},"authorAssociation":"NONE","body":"yes please!","createdAt":"2023-08-22T14:33:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2941#issuecomment-1688308962","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6M6EQf","author":{"login":"emmercm"},"authorAssociation":"NONE","body":"I believe this was made the default in v1.25.0: https://github.com/temporalio/temporal/pull/5894\r\n\r\nWhat is the earliest version that I can enable `history.enableHostHistoryCache = true` with? I couldn't find it in the release notes. This commit leads me to believe v1.23.0: https://github.com/temporalio/temporal/commit/7b146c22af13ef6101db6252733ab3ed10eb881d","createdAt":"2024-09-20T15:49:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2941#issuecomment-2364032031","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6M6cQ6","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"cc @prathyushpv ","createdAt":"2024-09-20T16:49:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2941#issuecomment-2364130362","viewerDidAuthor":false}],"createdAt":"2022-06-02T23:38:11Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2941,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":9}}],"state":"OPEN","title":"Host level cache for history","updatedAt":"2024-09-20T16:50:08Z","url":"https://github.com/temporalio/temporal/issues/2941"}
