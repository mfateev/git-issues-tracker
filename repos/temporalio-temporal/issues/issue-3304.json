{"assignees":[{"id":"MDQ6VXNlcjU5NDI5NjM=","login":"MichaelSnowden","name":"Michael Snowden","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"**Is your feature request related to a problem? Please describe.**\r\nWhen an activity keeps failing and then hits the ScheduleToClose timeout, only the ScheduleToClose timeout is included into the ActivityTaskFailed event. Here is an example:\r\n```\r\n    \"activityTaskTimedOutEventAttributes\": {\r\n      \"failure\": {\r\n        \"message\": \"activity ScheduleToClose timeout\",\r\n        \"source\": \"Server\",\r\n        \"stackTrace\": \"\",\r\n        \"cause\": null,\r\n        \"timeoutFailureInfo\": {\r\n          \"timeoutType\": \"ScheduleToClose\",\r\n          \"lastHeartbeatDetails\": null\r\n        }\r\n      },\r\n```\r\nThis makes troubleshooting hard as the original cause for the timeout (activity failures) is lost.\r\n\r\n**Describe the solution you'd like**\r\nInclude the last activity failure into the timeout failure as a cause.\r\n","closedAt":"2022-09-07T00:08:00Z","comments":[{"id":"IC_kwDODNqesM5J1hSz","author":{"login":"MichaelSnowden"},"authorAssociation":"CONTRIBUTOR","body":"I'm unable to reproduce this issue with the latest server. I made an example change to samples-go ([diff](https://github.com/temporalio/samples-go/compare/main...MichaelSnowden:samples-go:timeout_example)) to reproduce this, and the history event I saw contained the failure cause of the latest failed activity attempt:\r\n\r\n```\r\n{\r\n    \"eventId\": \"7\",\r\n    \"eventTime\": \"2022-09-06T20:48:44.219781544Z\",\r\n    \"eventType\": \"ActivityTaskTimedOut\",\r\n    \"version\": \"0\",\r\n    \"taskId\": \"1048645\",\r\n    \"activityTaskTimedOutEventAttributes\": {\r\n      \"failure\": {\r\n        \"message\": \"activity ScheduleToClose timeout\",\r\n        \"source\": \"Server\",\r\n        \"stackTrace\": \"\",\r\n        \"cause\": {\r\n          \"message\": \"oops\",\r\n          \"source\": \"GoSDK\",\r\n          \"stackTrace\": \"\",\r\n          \"cause\": null,\r\n          \"applicationFailureInfo\": {\r\n            \"type\": \"\",\r\n            \"nonRetryable\": false,\r\n            \"details\": null\r\n          }\r\n        },\r\n        \"timeoutFailureInfo\": {\r\n          \"timeoutType\": \"ScheduleToClose\",\r\n          \"lastHeartbeatDetails\": null\r\n        }\r\n      },\r\n      \"scheduledEventId\": \"5\",\r\n      \"startedEventId\": \"6\",\r\n      \"retryState\": \"NonRetryableFailure\"\r\n    }\r\n  }\r\n```\r\n\r\nMaybe this was already fixed by another diff?","createdAt":"2022-09-07T00:08:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/3304#issuecomment-1238766771","viewerDidAuthor":false}],"createdAt":"2022-09-02T18:00:01Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":3304,"reactionGroups":[],"state":"CLOSED","title":"Include last activity failure into timeout failure","updatedAt":"2022-09-07T00:08:00Z","url":"https://github.com/temporalio/temporal/issues/3304"}
