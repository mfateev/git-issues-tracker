{"assignees":[{"id":"MDQ6VXNlcjgyNDg4MDY=","login":"sergeybykov","name":"Sergey Bykov","databaseId":0}],"author":{"id":"MDQ6VXNlcjM3NzA0Nzg=","is_bot":false,"login":"yux0","name":"Yu Xia"},"body":"## Expected Behavior\r\nThe service start should return an error to indicate the invalid tls config.\r\n\r\n## Actual Behavior\r\n`panic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x24f6324]\r\n\r\ngoroutine 1 [running]:\r\ngo.temporal.io/server/common/rpc/encryption.newServerTLSConfig({0x303fa18, 0xc00042e2a0}, {0x300f7a0, 0xc000ccc040}, 0x0, {0x303f7d8, 0xc000489750})\r\n        /Users/yx/release/temporal/common/rpc/encryption/localStoreTlsProvider.go:255 +0x144\r\ngo.temporal.io/server/common/rpc/encryption.(*localStoreTlsProvider).GetFrontendServerConfig.func1()\r\n        /Users/yx/release/temporal/common/rpc/encryption/localStoreTlsProvider.go:162 +0x4c\r\ngo.temporal.io/server/common/rpc/encryption.(*localStoreTlsProvider).getOrCreateConfig(0xc0004f2480, 0xc0004f24f8, 0xc000ebba58, 0x19)\r\n        /Users/yx/release/temporal/common/rpc/encryption/localStoreTlsProvider.go:232 +0x102\r\ngo.temporal.io/server/common/rpc/encryption.(*localStoreTlsProvider).GetFrontendServerConfig(0xc0004d9e30)\r\n        /Users/yx/release/temporal/common/rpc/encryption/localStoreTlsProvider.go:159 +0x77\r\ngo.temporal.io/server/common/rpc.(*RPCFactory).GetFrontendGRPCServerOptions(0x0)\r\n        /Users/yx/release/temporal/common/rpc/rpc.go:74 +0x36\r\n`\r\n\r\n## Steps to Reproduce the Problem\r\n  1. Add invalid tls config:\r\n  ``global:\r\n  tls:\r\n    frontend:\r\n      client:\r\n        forceTLS: true``\r\n  2. start frontend service\r\n\r\n## Specifications\r\n\r\n  - Version: test locally with v.1.14\r\n  - Platform: mac os\r\n","closedAt":"2022-02-15T06:05:52Z","comments":[{"id":"IC_kwDODNqesM49PH67","author":{"login":"yux0"},"authorAssociation":"MEMBER","body":"The Frontend TLS uses config.Frontend: https://github.com/temporalio/temporal/blob/master/common/rpc/encryption/localStoreTlsProvider.go#L90 to determine if TLS is enable\r\n\r\nThe TLS initialization use: https://github.com/temporalio/temporal/blob/master/common/config/config.go#L487 to determine if TLS is enable.\r\n\r\nPanic:\r\nhttps://github.com/temporalio/temporal/blob/master/common/rpc/encryption/localStoreTlsProvider.go#L255","createdAt":"2022-02-01T23:06:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2448#issuecomment-1027374779","viewerDidAuthor":false}],"createdAt":"2022-02-01T23:00:32Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2448,"reactionGroups":[],"state":"CLOSED","title":"Invalid TLS config may crash service during service start","updatedAt":"2022-02-15T06:05:52Z","url":"https://github.com/temporalio/temporal/issues/2448"}
