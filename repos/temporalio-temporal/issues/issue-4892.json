{"assignees":[{"id":"MDQ6VXNlcjQwNzc4NTA=","login":"ShahabT","name":"Shahab Tajik","databaseId":0}],"author":{"id":"MDQ6VXNlcjQwOTIyNg==","is_bot":false,"login":"tdeebswihart","name":"Tim Deeb-Swihart"},"body":"## Expected Behavior\r\n`matchingEngine.getTask` returns **either** a non-nil `internalTask` pointer or non-nil error error.\r\n\r\n## Actual Behavior\r\n\r\n`matchingEngine.getTask` returned both a nil error and a nil `internalTask`\r\n[It fails after dereferencing a nil pointer](https://buildkite.com/temporal/temporal-public/builds/12245#018acd1f-f44c-4807-baa2-313199195999):\r\n```\r\nFAIL: TestMatchingEngineSuite (15.84s)\r\n--\r\n  | --- FAIL: TestMatchingEngineSuite/TestAddTaskAfterStartFailure (0.10s)\r\n  | matching_engine_test.go:1707:\r\n  | Error Trace:\t/temporal/service/matching/matching_engine_test.go:1707\r\n  | Error:      \tReceived unexpected error:\r\n  | no tasks\r\n  | Test:       \tTestMatchingEngineSuite/TestAddTaskAfterStartFailure\r\n  | suite.go:87: test panicked: runtime error: invalid memory address or nil pointer dereference\r\n--\r\n  | goroutine 210 [running]:\r\n  | runtime/debug.Stack()\r\n  | /usr/local/go/src/runtime/debug/stack.go:24 +0x67\r\n  | github.com/stretchr/testify/suite.failOnPanic(0xc000412340, {0x2fe8200, 0x585beb0})\r\n  | /go/pkg/mod/github.com/stretchr/testify@v1.8.4/suite/suite.go:87 +0x3a\r\n  | github.com/stretchr/testify/suite.Run.func1.1()\r\n  | /go/pkg/mod/github.com/stretchr/testify@v1.8.4/suite/suite.go:183 +0x345\r\n  | panic({0x2fe8200?, 0x585beb0?})\r\n  | /usr/local/go/src/runtime/panic.go:920 +0x270\r\n  | go.temporal.io/server/service/matching.(*internalTask).finish(0x0, {0x4599160, 0xc0003640a0})\r\n  | /temporal/service/matching/task.go:164 +0x75\r\n  | go.temporal.io/server/service/matching.(*matchingEngineSuite).TestAddTaskAfterStartFailure(0xc000884120)\r\n  | /temporal/service/matching/matching_engine_test.go:1709 +0x594\r\n  | reflect.Value.call({0xc0009da240?, 0xc00030c1b0?, 0x44593a?}, {0x3346a3d, 0x4}, {0xc00070dda8, 0x1, 0xc00070dbc8?})\r\n  | /usr/local/go/src/reflect/value.go:596 +0x14a5\r\n  | reflect.Value.Call({0xc0009da240?, 0xc00030c1b0?, 0xc000884120?}, {0xc00070dda8, 0x1, 0x1})\r\n  | /usr/local/go/src/reflect/value.go:380 +0xb6\r\n  | github.com/stretchr/testify/suite.Run.func1(0xc000412340)\r\n  | /go/pkg/mod/github.com/stretchr/testify@v1.8.4/suite/suite.go:197 +0x685\r\n  | testing.tRunner(0xc000412340, 0xc0008842d0)\r\n  | /usr/local/go/src/testing/testing.go:1595 +0x239\r\n  | created by testing.(*T).Run in goroutine 199\r\n  | /usr/local/go/src/testing/testing.go:1648 +0x82b\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nThis occurred in buildkite but not when running unit-tests locally\r\n\r\n## Specifications\r\n\r\n  - Version:\r\n  - Platform:\r\n","closedAt":"2023-10-17T17:46:08Z","comments":[{"id":"IC_kwDODNqesM5pUIgA","author":{"login":"dnr"},"authorAssociation":"MEMBER","body":"It is returning a non-nil error there. It's just a flaky test. Fixed by #4989","createdAt":"2023-10-17T17:46:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4892#issuecomment-1766885376","viewerDidAuthor":false}],"createdAt":"2023-09-25T17:43:50Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4892,"reactionGroups":[],"state":"CLOSED","title":"nil internalTask pointer returned by matchingEngine.getTask in CI","updatedAt":"2023-10-17T17:46:09Z","url":"https://github.com/temporalio/temporal/issues/4892"}
