{"assignees":[],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"Currently failures in all customer facing proto structures (not gRPC ones) are represented by two fields `reason` and `details`. This kind of works when all parts of a workflow are implemented in a single language. For example Java SDK serializes complete exception chain including stack trace of each exception into the details field. The problem is this serialization/deserialization code is completely Java specific. Now as Python client is added it uses different format for the stack trace. Go (in case of panic) also might require stack trace serialization/deserialization. Even without stack traces chaining of errors coming from SDKs in different languages is practically impossible without unifying the serialization format.\r\n\r\nThe proposal is that instead of unifying the serialization format, model the chain of errors with attached strack traces through a generic protobuf structure. This way no language specific serialization is necessary and errors coming from different components can be chained even if they are from different languages.\r\n\r\nThe strawman API changes.\r\n```\r\nmessage ApplicationFailureInfo {\r\n    string sdk = 1; // java, go, python, etc\r\n    string message = 2;\r\n    string type = 3; // Exception class,  Go error type, etc.\r\n    bytes details = 4; // Possibly error payload beyond the message.\r\n}\r\n\r\nmessage ActivityTaskFailureInfo {\r\n    int64 scheduledEventId = 1;\r\n    int64 startedEventId = 2;\r\n    string identity = 3;\r\n}\r\n\r\nmessage ChildWorkflowExecutionFailureInfo {\r\n    string domain = 1;\r\n    WorkflowExecution workflowExecution = 2;\r\n    WorkflowType workflowType = 3;\r\n    int64 initiatedEventId = 4;\r\n    int64 startedEventId = 5;\r\n}\r\n\r\nmessage Failure {\r\n    oneof failureInfo {\r\n        ActivityTaskFailureInfo activityTaskFailureInfo = 1;\r\n        ChildWorkflowExecutionFailureInfo childWorkflowExecutionFailureInfo = 2;\r\n        ApplicationFailureInfo applicationFailureInfo = 3;\r\n    }\r\n    repeated string backtrace = 4;\r\n}\r\n\r\nmessage FailureChain {\r\n    repeated Failure failures = 1; // The initial cause is the first in the list\r\n}\r\n```\r\nAn open question if providing a typed backtrace would bring any value. For example it can be modeled as \r\n```\r\nmessage StackTraceElement {\r\n    string file = 1;\r\n    int32 line = 2;\r\n    string component = 3; // declaringClass for Java, module for Go\r\n    string function = 4;\r\n}\r\n```\r\nBut it might require more fields for some languages for example PHP stack trace is much reacher:\r\nhttps://www.php.net/manual/en/function.debug-backtrace.php\r\n\r\n\r\n","closedAt":"2020-05-26T21:58:42Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDU3ODY4MjE5MA==","author":{"login":"firdaus"},"authorAssociation":"NONE","body":"I can't think of a use case for a typed backtrace. \r\n\r\nApplicationFailureInfo, Failure and FailureChain look good to me.  ","createdAt":"2020-01-27T10:22:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/89#issuecomment-578682190","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDU4NjQ4NzA2MA==","author":{"login":"dadgar"},"authorAssociation":"NONE","body":"@mfateev It would be good to add a `retryable bool` to `ApplicationFailureInfo`. ","createdAt":"2020-02-14T21:51:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/temporal/issues/89#issuecomment-586487060","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYzMTA1OTU3OA==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Proto changes: https://github.com/temporalio/temporal-proto/pull/43","createdAt":"2020-05-19T20:19:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/89#issuecomment-631059578","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYzMjM1NTM2NQ==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Go SDK PR: https://github.com/temporalio/temporal-go-sdk/pull/138","createdAt":"2020-05-21T21:27:24Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/89#issuecomment-632355365","viewerDidAuthor":false}],"createdAt":"2020-01-26T23:04:01Z","labels":[],"milestone":{"number":1,"title":"Initial Temporal Release","description":"","dueOn":null},"number":89,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"Refactor Failure representation in the APIs","updatedAt":"2020-05-26T21:58:42Z","url":"https://github.com/temporalio/temporal/issues/89"}
