{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjIyMzI1MjQ=","is_bot":false,"login":"alexshtin","name":"Alex Shtin"},"body":"Currently we use https://github.com/golang/protobuf which is stable release. There is another repo under active development https://github.com/protocolbuffers/protobuf-go which is considered to be \"Next Generation Go Protocol Buffers\". I found number of improvements there but don't want to use it right away because it states:\r\n> WARNING: This repository is in active development. There are no guarantees about API stability. Breaking changes will occur until a stable release is made and announced.\r\n","closedAt":"2024-05-07T21:21:31Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDU5NzIwODI3OA==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"It is released: https://blog.golang.org/a-new-go-api-for-protocol-buffers but gRPC support is not there.","createdAt":"2020-03-10T17:18:27Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-597208278","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYwNzUzMDM0NQ==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Consider switching to https://github.com/golang/protobuf/releases/tag/v1.4.0-rc.4 at least.","createdAt":"2020-04-01T22:58:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-607530345","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYwNzUzMDU5OQ==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Discussion about future gRPC support in v2: https://github.com/golang/protobuf/issues/1070.","createdAt":"2020-04-01T22:59:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-607530599","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3MzQ3ODA5OA==","author":{"login":"samarabbas"},"authorAssociation":"MEMBER","body":"@alexshtin is this still relevant?","createdAt":"2021-07-03T22:19:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-873478098","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3ODY3Njg5MA==","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"It might be relevant one day. We are not using Google protobuf/gRPC plugin but using gogo. When v2 was finally released I made some [tests](https://github.com/alexshtin/proto-bench) and found out that gogo implementation still outperform it significantly. In a meantime gogo team said that adoption of v2 would require a lot of work and [abandoned the project](https://github.com/gogo/protobuf/issues/691).\r\n\r\nRecently vitess team created their own [compiler](https://vitess.io/blog/2021-06-03-a-new-protobuf-generator-for-go/) which has some limitations but looks very promising. I would give it some time to mature and then investigate how hard it would be for us to migrate to it.","createdAt":"2021-07-13T00:04:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-878676890","viewerDidAuthor":false},{"id":"IC_kwDODNqesM43U3cj","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Other options to consider:\r\n> We have implemented fast marshaling and fast proto reflection for the golang proto v2 API. There are a few additional features in the works for our use case similar to customtype that may or may not be desirable for other protobuf users: https://github.com/cosmos/cosmos-proto\r\n\r\n> Weâ€™ve added a few more features to protopatch in the last few weeks, like support for embedded structs and optional: https://github.com/alta/protopatch","createdAt":"2021-09-27T19:49:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-928216867","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5BKxnW","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"One more option: https://github.com/CrowdStrike/csproto","createdAt":"2022-04-08T20:41:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-1093343702","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5M2oUI","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"Vitess Protocol Buffers compiler: https://github.com/planetscale/vtprotobuf.","createdAt":"2022-10-24T17:56:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-1289389320","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5cg2Dd","author":{"login":"GiantRobots"},"authorAssociation":"MEMBER","body":"Can we also look into using buf's Connect as well? \r\n\r\nhttps://connect.build/docs/go/getting-started\r\n\r\nTheir connect protocol would be incredibly nice for the frontend (human readable network format so we can use built in browser tools) and it would entirely remove the need for ui-server as the clients they generate can talk directly to browsers through the connect protocol or the grpc-web protocol. \r\n\r\nhttps://connect.build/docs/go/grpc-compatibility#migration","createdAt":"2023-05-17T21:32:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-1552113885","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5clLr1","author":{"login":"akshayjshah"},"authorAssociation":"NONE","body":"Hey! I work at Buf, designed Connect, and used to work on one of Cadence's old transports (tchannel) too. It's a small world :)\r\n\r\nWe're very familiar with the pain of migrating off `gogoprotobuf`. The best alternative available today for performance-conscious Go programmers is `vtprotobuf`, which generates some extra code that works with the `google.golang.org/protobuf` standard code gen. It's pretty easy to integrate with `grpc-go`. The end result still isn't as fast as `gogoprotobuf`, but it's the best you can get with packages that are still maintained.\r\n\r\n`csprotobuf` helped CrowdStrike migrate off `gogoprotobuf` - it's basically a shim layer that lets your system continue to function mid-migration. The author, Dylan Bourque, is often in the protobuf and grpc channels in the Gophers Slack. It may help when/if you decide to take on this work.\r\n\r\n@GiantRobots, Connect is largely orthogonal to this discussion - it'll work with any of the protobuf runtimes above. There are a few ways you can migrate your frontend to use `connect-es` and the Connect RPC protocol _without_ migrating your backend off `grpc-go` + `gogo`. One relatively easy option is to replace `temporal-ui` with Envoy and enable [Connect-to-gRPC protocol translation](https://buf.build/blog/introducing-connect-cacheable-rpcs/#better-grpc-interoperability-with-envoy) (or enable that filter in an existing Envoy), and register a gRPC codec that uses [gogo's jsonpb package](https://pkg.go.dev/github.com/gogo/protobuf/jsonpb) in your backend. The change to your backend will be just a few lines of code and won't affect any business logic, and Envoy will work without any code generation or schema access.","createdAt":"2023-05-18T15:42:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-1553251061","viewerDidAuthor":false},{"id":"IC_kwDODNqesM59IUCp","author":{"login":"alexshtin"},"authorAssociation":"CONTRIBUTOR","body":"After many discussions and considering different approaches we decided to migrate to the standard Google library. This migration is already completed, mostly in #5032 and few followed PRs.","createdAt":"2024-05-07T21:21:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/38#issuecomment-2099331241","viewerDidAuthor":false}],"createdAt":"2019-11-28T18:44:50Z","labels":[{"id":"MDU6TGFiZWwxNzkwMTM1NzM5","name":"refactoring","description":"","color":"e8b181"}],"milestone":null,"number":38,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":6}}],"state":"CLOSED","title":"Consider migration from gogo to vtprotobuf","updatedAt":"2024-05-07T21:21:31Z","url":"https://github.com/temporalio/temporal/issues/38"}
