{"assignees":[{"id":"MDQ6VXNlcjIwNjgxMjQ=","login":"rodrigozhou","name":"Rodrigo Zhou","databaseId":0}],"author":{"id":"MDQ6VXNlcjIxMDI2MjQ5","is_bot":false,"login":"DodgeCamaro","name":"Dmytro Orlenko"},"body":"## Expected Behavior\r\nCreated Custom Attribute\r\n\r\n## Actual Behavior\r\n\r\n`Error: unable to add search attributes: System Workflow with WorkflowId temporal-sys-add-search-attributes-workflow and RunId 10fdc88f-8ef7-4936-b06d-f309a836125d returned an error: workflow execution error (type: temporal-sys-add-search-attributes-workflow, workflowID: temporal-sys-add-search-attributes-workflow, runID: 10fdc88f-8ef7-4936-b06d-f309a836125d): unable to execute activity: AddESMappingFieldActivity: activity error (type: AddESMappingFieldActivity, scheduledEventID: 5, startedEventID: 6, identity: 1@temporal-worker-7cfc5bf56d-ll9lj@): unable to update Elasticsearch mapping: elastic: Error 403 (Forbidden): no permissions for [] and User [name=temporal, backend_roles=[], requestedTenant=null] [type=security_exception] (type: wrapError, retryable: true): unable to execute activity`\r\n\r\n## Steps to Reproduce the Problem\r\nSame error with two command below\r\n  1. `temporal operator search-attribute create --name CustomTest --type Keyword`\r\n  2.  `tctl admin cl asa --name CustomTest --type Keyword`\r\n## Specifications\r\n\r\n  - Version: 1.20.4\r\n  - Platform: Temporal Self-Hosted\r\n  Advanced Visibility AWS Opensearch 2.5 + AWS RDS Postgres 13.8\r\n","closedAt":"2023-09-26T14:51:24Z","comments":[{"id":"IC_kwDODNqesM5kZu01","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"@DodgeCamaro Can you check if the Elasticsearch user `temporal` has the right permissions to update the mapping? Please take a look at this [page](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html#put-mapping-api-prereqs:~:text=If%20the%20Elasticsearch%20security%20features%20are%20enabled%2C%20you%20must%20have%20the%20manage%20index%20privilege%20for%20the%20target%20data%20stream%2C%20index%2C%20or%20alias.).","createdAt":"2023-08-18T21:47:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1684466997","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5ke1EG","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"@rodrigozhou Hi.\r\nI've used OpenSearch master user with full access to the cluster\r\n![image](https://github.com/temporalio/temporal/assets/21026249/73bb9636-34b5-4367-a33d-3389e8686b9b)\r\n","createdAt":"2023-08-21T07:33:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1685803270","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5k-VIU","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"Can you share your visibility config?","createdAt":"2023-08-26T00:13:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1694061076","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lDWvd","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"@rodrigozhou Hello, sure!\r\n```\r\nglobal:\r\n    membership:\r\n        maxJoinDuration: 30s\r\n        broadcastAddress: '10.0.3.79'\r\n    pprof:\r\n        port: 0\r\n    tls:\r\n        internode:\r\n            client:\r\n                serverName: \"\"\r\n                disableHostVerification: false\r\n                rootCaFiles: []\r\n                rootCaData: []\r\n                forceTLS: false\r\n            server:\r\n                certFile: \"\"\r\n                keyFile: \"\"\r\n                clientCaFiles: []\r\n                certData: \"\"\r\n                keyData: \"\"\r\n                clientCaData: []\r\n                requireClientAuth: false\r\n            hostOverrides: {}\r\n        frontend:\r\n            client:\r\n                serverName: \"\"\r\n                disableHostVerification: false\r\n                rootCaFiles: []\r\n                rootCaData: []\r\n                forceTLS: false\r\n            server:\r\n                certFile: \"\"\r\n                keyFile: \"\"\r\n                clientCaFiles: []\r\n                certData: \"\"\r\n                keyData: \"\"\r\n                clientCaData: []\r\n                requireClientAuth: false\r\n            hostOverrides: {}\r\n        systemWorker:\r\n            certFile: \"\"\r\n            keyFile: \"\"\r\n            certData: \"\"\r\n            keyData: \"\"\r\n            client:\r\n                serverName: \"\"\r\n                disableHostVerification: false\r\n                rootCaFiles: []\r\n                rootCaData: []\r\n                forceTLS: false\r\n        remoteClusters: {}\r\n        expirationChecks:\r\n            warningWindow: 0s\r\n            errorWindow: 0s\r\n            checkInterval: 0s\r\n        refreshInterval: 0s\r\n    metrics:\r\n        tags:\r\n            type: 'frontend'\r\n        excludeTags: {}\r\n        prefix: \"\"\r\n        perUnitHistogramBoundaries: {}\r\n        m3: null\r\n        statsd: null\r\n        prometheus:\r\n            framework: \"\"\r\n            listenAddress: 0.0.0.0:9090\r\n            handlerPath: \"\"\r\n            listenNetwork: \"\"\r\n            timerType: histogram\r\n            defaultHistogramBoundaries: []\r\n            defaultHistogramBuckets: []\r\n            defaultSummaryObjectives: []\r\n            onError: \"\"\r\n            sanitizeOptions: null\r\n    authorization:\r\n        jwtKeyProvider:\r\n            keySourceURIs: []\r\n            refreshInterval: 0s\r\n        permissionsClaimName: \"\"\r\n        authorizer: \"\"\r\n        claimMapper: \"\"\r\npersistence:\r\n    defaultStore: default\r\n    visibilityStore: visibility\r\n    secondaryVisibilityStore: \"\"\r\n    advancedVisibilityStore: advancedVisibility\r\n    numHistoryShards: 4\r\n    datastores:\r\n        advancedVisibility:\r\n            faultInjection: null\r\n            cassandra: null\r\n            sql: null\r\n            customDatastore: null\r\n            elasticsearch:\r\n                version: v7\r\n                url:\r\n                    scheme: https\r\n                    opaque: \"\"\r\n                    user: null\r\n                    host: opensearch\r\n                    path: \"\"\r\n                    rawpath: \"\"\r\n                    omithost: false\r\n                    forcequery: false\r\n                    rawquery: \"\"\r\n                    fragment: \"\"\r\n                    rawfragment: \"\"\r\n                username: temporal\r\n                password: 'password'\r\n                indices:\r\n                    visibility: temporal_visibility\r\n                logLevel: \"\"\r\n                aws-request-signing:\r\n                    enabled: false\r\n                    region: \"\"\r\n                    credentialProvider: \"\"\r\n                    static:\r\n                        accessKeyID: \"\"\r\n                        secretAccessKey: \"\"\r\n                        token: \"\"\r\n                closeIdleConnectionsInterval: 0s\r\n                enableSniff: false\r\n                enableHealthcheck: false\r\n        default:\r\n            faultInjection: null\r\n            cassandra: null\r\n            sql:\r\n                user: temporal\r\n                password: 'password'\r\n                pluginName: postgres\r\n                databaseName: temporal\r\n                connectAddr: temporal:5432\r\n                connectProtocol: tcp\r\n                connectAttributes: {}\r\n                maxConns: 0\r\n                maxIdleConns: 0\r\n                maxConnLifetime: 0s\r\n                taskScanPartitions: 0\r\n                tls: null\r\n            customDatastore: null\r\n            elasticsearch: null\r\n        visibility:\r\n            faultInjection: null\r\n            cassandra: null\r\n            sql:\r\n                user: temporal\r\n                password: 'password'\r\n                pluginName: postgres\r\n                databaseName: temporal_visibility\r\n                connectAddr: temporal:5432\r\n                connectProtocol: tcp\r\n                connectAttributes: {}\r\n                maxConns: 0\r\n                maxIdleConns: 0\r\n                maxConnLifetime: 0s\r\n                taskScanPartitions: 0\r\n                tls: null\r\n            customDatastore: null\r\n            elasticsearch: null\r\nlog:\r\n    stdout: true\r\n    level: info\r\n    outputFile: \"\"\r\n    format: \"\"\r\n    development: false\r\nclusterMetadata:\r\n    enableGlobalNamespace: false\r\n    failoverVersionIncrement: 10\r\n    masterClusterName: temporal\r\n    currentClusterName: temporal\r\n    clusterInformation:\r\n        temporal:\r\n            enabled: true\r\n            initialFailoverVersion: 1\r\n            rpcAddress: 127.0.0.1:7233\r\ndcRedirectionPolicy:\r\n    policy: \"\"\r\nservices:\r\n    frontend:\r\n        rpc:\r\n            grpcPort: 7233\r\n            membershipPort: 6933\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\n    history:\r\n        rpc:\r\n            grpcPort: 7234\r\n            membershipPort: 6934\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\n    matching:\r\n        rpc:\r\n            grpcPort: 7235\r\n            membershipPort: 6935\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\n    worker:\r\n        rpc:\r\n            grpcPort: 7239\r\n            membershipPort: 6939\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\narchival:\r\n    history:\r\n        state: enabled\r\n        enableRead: true\r\n        provider:\r\n            filestore: null\r\n            gstorage: null\r\n            s3store:\r\n                region: us-east-2\r\n                endpoint: null\r\n                s3ForcePathStyle: false\r\n    visibility:\r\n        state: enabled\r\n        enableRead: true\r\n        provider:\r\n            filestore: null\r\n            s3store:\r\n                region: us-east-2\r\n                endpoint: null\r\n                s3ForcePathStyle: false\r\n            gstorage: null\r\npublicClient:\r\n    hostPort: \"\"\r\n    forceTLSConfig: \"\"\r\ndynamicConfigClient:\r\n    filepath: /etc/temporal/config/dynamic_config.yaml\r\n    pollInterval: 10s\r\nnamespaceDefaults:\r\n    archival:\r\n        history:\r\n            state: enabled\r\n            URI: s3://<bucket_name>\r\n        visibility:\r\n            state: enabled\r\n            URI: s3://<bucket_name>\r\notel: {}\r\n```","createdAt":"2023-08-28T09:43:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1695378397","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lFmAz","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"@DodgeCamaro I can see you're using dual visibility setting, ie., setting up two visibiility storages. One using Postgres and another using Elasticsearch. Is that on purpose?\r\n\r\nAdding search attributes while in dual visibility mode is not supported (WIP).","createdAt":"2023-08-28T16:12:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1695965235","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lJU3q","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"@rodrigozhou \r\nThis doesn't work with AWS RDS + AWS OpenSearch\r\ndocker.yaml below with postgres and opensearch setup at cluster.\r\n\r\n```\r\nglobal:\r\n    membership:\r\n        maxJoinDuration: 30s\r\n        broadcastAddress: '10.0.2.30'\r\n    pprof:\r\n        port: 0\r\n    tls:\r\n        internode:\r\n            client:\r\n                serverName: \"\"\r\n                disableHostVerification: false\r\n                rootCaFiles: []\r\n                rootCaData: []\r\n                forceTLS: false\r\n            server:\r\n                certFile: \"\"\r\n                keyFile: \"\"\r\n                clientCaFiles: []\r\n                certData: \"\"\r\n                keyData: \"\"\r\n                clientCaData: []\r\n                requireClientAuth: false\r\n            hostOverrides: {}\r\n        frontend:\r\n            client:\r\n                serverName: \"\"\r\n                disableHostVerification: false\r\n                rootCaFiles: []\r\n                rootCaData: []\r\n                forceTLS: false\r\n            server:\r\n                certFile: \"\"\r\n                keyFile: \"\"\r\n                clientCaFiles: []\r\n                certData: \"\"\r\n                keyData: \"\"\r\n                clientCaData: []\r\n                requireClientAuth: false\r\n            hostOverrides: {}\r\n        systemWorker:\r\n            certFile: \"\"\r\n            keyFile: \"\"\r\n            certData: \"\"\r\n            keyData: \"\"\r\n            client:\r\n                serverName: \"\"\r\n                disableHostVerification: false\r\n                rootCaFiles: []\r\n                rootCaData: []\r\n                forceTLS: false\r\n        remoteClusters: {}\r\n        expirationChecks:\r\n            warningWindow: 0s\r\n            errorWindow: 0s\r\n            checkInterval: 0s\r\n        refreshInterval: 0s\r\n    metrics: null\r\n    authorization:\r\n        jwtKeyProvider:\r\n            keySourceURIs: []\r\n            refreshInterval: 0s\r\n        permissionsClaimName: \"\"\r\n        authorizer: \"\"\r\n        claimMapper: \"\"\r\npersistence:\r\n    defaultStore: default\r\n    visibilityStore: visibility\r\n    secondaryVisibilityStore: \"\"\r\n    advancedVisibilityStore: advancedVisibility\r\n    numHistoryShards: 3\r\n    datastores:\r\n        advancedVisibility:\r\n            faultInjection: null\r\n            cassandra: null\r\n            sql: null\r\n            customDatastore: null\r\n            elasticsearch:\r\n                version: v7\r\n                url:\r\n                    scheme: http\r\n                    opaque: \"\"\r\n                    user: null\r\n                    host: opensearch:9200\r\n                    path: \"\"\r\n                    rawpath: \"\"\r\n                    omithost: false\r\n                    forcequery: false\r\n                    rawquery: \"\"\r\n                    fragment: \"\"\r\n                    rawfragment: \"\"\r\n                username: temporal\r\n                password: 'pass'\r\n                indices:\r\n                    visibility: temporal_visibility\r\n                logLevel: \"\"\r\n                aws-request-signing:\r\n                    enabled: false\r\n                    region: \"\"\r\n                    credentialProvider: \"\"\r\n                    static:\r\n                        accessKeyID: \"\"\r\n                        secretAccessKey: \"\"\r\n                        token: \"\"\r\n                closeIdleConnectionsInterval: 0s\r\n                enableSniff: false\r\n                enableHealthcheck: false\r\n        default:\r\n            faultInjection: null\r\n            cassandra: null\r\n            sql:\r\n                user: temporal\r\n                password: 'pass'\r\n                pluginName: postgres\r\n                databaseName: temporal\r\n                connectAddr: postgres:5432\r\n                connectProtocol: tcp\r\n                connectAttributes: {}\r\n                maxConns: 0\r\n                maxIdleConns: 0\r\n                maxConnLifetime: 0s\r\n                taskScanPartitions: 0\r\n                tls: null\r\n            customDatastore: null\r\n            elasticsearch: null\r\n        visibility:\r\n            faultInjection: null\r\n            cassandra: null\r\n            sql:\r\n                user: temporal\r\n                password: 'pass'\r\n                pluginName: postgres\r\n                databaseName: temporal_visibility\r\n                connectAddr: postgres:5432\r\n                connectProtocol: tcp\r\n                connectAttributes: {}\r\n                maxConns: 0\r\n                maxIdleConns: 0\r\n                maxConnLifetime: 0s\r\n                taskScanPartitions: 0\r\n                tls: null\r\n            customDatastore: null\r\n            elasticsearch: null\r\nlog:\r\n    stdout: true\r\n    level: info\r\n    outputFile: \"\"\r\n    format: \"\"\r\n    development: false\r\nclusterMetadata:\r\n    enableGlobalNamespace: false\r\n    failoverVersionIncrement: 10\r\n    masterClusterName: temporal\r\n    currentClusterName: temporal\r\n    clusterInformation:\r\n        temporal:\r\n            enabled: true\r\n            initialFailoverVersion: 1\r\n            rpcAddress: 127.0.0.1:7233\r\ndcRedirectionPolicy:\r\n    policy: \"\"\r\nservices:\r\n    frontend:\r\n        rpc:\r\n            grpcPort: 7233\r\n            membershipPort: 6933\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\n    history:\r\n        rpc:\r\n            grpcPort: 7234\r\n            membershipPort: 6934\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\n    matching:\r\n        rpc:\r\n            grpcPort: 7235\r\n            membershipPort: 6935\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\n    worker:\r\n        rpc:\r\n            grpcPort: 7239\r\n            membershipPort: 6939\r\n            bindOnLocalHost: false\r\n            bindOnIP: 0.0.0.0\r\narchival:\r\n    history:\r\n        state: enabled\r\n        enableRead: true\r\n        provider:\r\n            filestore: null\r\n            gstorage: null\r\n            s3store:\r\n                region: us-east-2\r\n                endpoint: null\r\n                s3ForcePathStyle: false\r\n    visibility:\r\n        state: enabled\r\n        enableRead: true\r\n        provider:\r\n            filestore: null\r\n            s3store:\r\n                region: us-east-2\r\n                endpoint: null\r\n                s3ForcePathStyle: false\r\n            gstorage: null\r\npublicClient:\r\n    hostPort: \"\"\r\n    forceTLSConfig: \"\"\r\ndynamicConfigClient:\r\n    filepath: /etc/temporal/config/dynamic_config.yaml\r\n    pollInterval: 10s\r\nnamespaceDefaults:\r\n    archival:\r\n        history:\r\n            state: enabled\r\n            URI: s3://bucket\r\n        visibility:\r\n            state: enabled\r\n            URI: s3://bucket\r\notel: {}\r\n```","createdAt":"2023-08-29T07:49:31Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1696943594","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lMZHQ","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"@DodgeCamaro This is the important part:\r\n```\r\npersistence:\r\n    ...\r\n    visibilityStore: visibility\r\n    secondaryVisibilityStore: \"\"\r\n    advancedVisibilityStore: advancedVisibility\r\n    ...\r\n```\r\n\r\nThe key `visibilityStore` defines the visibility store and it looks like it's pointing to a Postgres DB (AWS RDS instance). And you also set `advancedVisibilityStore` which sets Elasticsearch (AWS OpenSearch instance) also as visibility store.\r\n\r\nSince you set two visibility stores, you are in dual visibility mode which does not support adding search attributes well. This feature was initially designed to support migration of visibility stores (eg: Postgres to Elasticsearch).","createdAt":"2023-08-29T16:07:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1697747408","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lQDPN","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"But how it works?\r\nWhen I deploy temporal with Postgres and OpenSearch at AWS EKS cluster, I can add search attributes.\r\nWhen using AWS OpenSearch and AWS RDS Postgres, I can't add search attributes.\r\n\r\n\r\nVisibility Store and Secondary Visibility Store returned same error","createdAt":"2023-08-30T08:16:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1698706381","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lhE0R","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"Are you using the exactly the same config?\r\nFor the `visibilityStore: visibility`, the plugin name is `postgres` which does not support search attributes, so you should not be able to add in either cases.\r\n\r\nIf you don't need two visibility stores, I'd suggest to remove the Postgres. Basically, remove the keys `visibilityStore` and `secondaryVisibilityStore`. Also, remove the `datastores.visibility` section.\r\n\r\n```\r\npersistence:\r\n    ...\r\n    advancedVisibilityStore: advancedVisibility\r\n    ...\r\n    datastores:\r\n        advancedVisibility:\r\n            ...\r\n        default:\r\n            ...\r\n```","createdAt":"2023-09-01T18:29:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1703169297","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5lnVST","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"Could I migrate advancedVisibilityStore (OpenSearch) to visibilityStore (Postgres)?\r\nI have a lot of workflows at production, using visibilityStore and advancedVisibilityStore","createdAt":"2023-09-04T08:10:20Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1704809619","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5l8Moq","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"You cannot. Based on your settings, your Postgres setup is not supporting custom search attributes, so if you are already using custom search attributes, they are not being written to Postgres. Also, based on those settings, I think you're writing to both Postgres and Elasticsearch, so if you just remove the `visibilityStore` config key as I suggested in the comment before, you won't be losing any data.","createdAt":"2023-09-07T14:42:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1710279210","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5mIi9v","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"After disabling advancedVisibilityStore I've lost all active workflow and schedules. \r\nIt's storing at OpenSearch","createdAt":"2023-09-11T09:30:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1713516399","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5mTCzs","author":{"login":"jingyi2318"},"authorAssociation":"NONE","body":"Hey! I was reading this issue since we ran into a similar error message that's very misleading. What worked for us was change the config template to only set one visibility depending on what values were set rather than completely disabling `advancedVisibilityStore` (example [here](https://github.com/temporalio/temporal/pull/3889/files), more detailed thread [here](https://community.temporal.io/t/custom-search-attributes-lost-after-1-19-1-20/7597/8)). Not sure if y'all have tried this already, but after we made this change the error is fixed!","createdAt":"2023-09-12T19:04:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1716268268","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5mXxXY","author":{"login":"DodgeCamaro"},"authorAssociation":"NONE","body":"@rodrigozhou \r\nThis [doc](https://docs.temporal.io/visibility#custom-search-attributes) references to use AdvancedVisibility for creating and use Custom Search Attributes.\r\n\r\nAt this configuration adding Custom Search Attributes, works well.\r\nhttps://github.com/temporalio/docker-compose/blob/main/docker-compose-postgres-opensearch.yml","createdAt":"2023-09-13T12:11:51Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1717507544","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5nXI_C","author":{"login":"rodrigozhou"},"authorAssociation":"MEMBER","body":"Sorry for late reply.\r\n\r\n@DodgeCamaro I didn't mean to say to remove or disable `advancedVisibilityStore`. As I shared above, I meant exactly to only keep `advancedVisibilityStore`, and remove `visibilityStore` and `secondaryVisibilityStore`. I'd also suggest taking a look at the [v1.21.0 release notes](https://github.com/temporalio/temporal/releases/tag/v1.21.0#:~:text=system%2Dlevel%20access.-,Visibility,-Deprecation%20heads%20up) that announced changes to visibility config keys.\r\n","createdAt":"2023-09-25T16:46:47Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/4773#issuecomment-1734119362","viewerDidAuthor":false}],"createdAt":"2023-08-14T09:35:33Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":4773,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":13}}],"state":"CLOSED","title":"Unable to update Elasticsearch mapping: elastic: Error 403 on Create Custom Attributes","updatedAt":"2023-09-26T14:51:24Z","url":"https://github.com/temporalio/temporal/issues/4773"}
