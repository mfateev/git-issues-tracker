{"assignees":[],"author":{"id":"U_kgDODQhmQw","is_bot":false,"login":"jbrody-nexxa","name":""},"body":"## Expected Behavior\nIn Temporal 1.27.1, calling a Workflow with Worker Versioning using versionOverrides in the WorkflowStartOptions started the Workflow.\n\n## Actual Behavior\nIn Temporal 1.28.0 and 1.29.0, the same steps cause the Temporal Service to respond with an error:\n`ServiceError: Failed to start Workflow\n    at WorkflowClient.rethrowGrpcError (/Users/johnbrody/github/workflow-utils/node_modules/@temporalio/client/src/workflow-client.ts:911:13)\n    at WorkflowClient._startWorkflowHandler (/Users/johnbrody/github/workflow-utils/node_modules/@temporalio/client/src/workflow-client.ts:1264:12)\n    at async WorkflowClient.start (/Users/johnbrody/github/workflow-utils/node_modules/@temporalio/client/src/workflow-client.ts:566:19)\n    at async runWorkflow (/Users/johnbrody/github/workflow-utils/src/client-utils.ts:26:18) {\n  cause: [ServiceError: must specify pinned override behavior if override is pinned.] {\n    code: 3,\n    details: '',\n    metadata: Metadata { internalRepr: [Map], options: {} }\n  }\n}\n`\n\n## Steps to Reproduce the Problem\n\n  1. Start a Workflow Worker with the following `workerDeploymentOptions`:\n`{\n  useWorkerVersioning: true,\n  defaultVersioningBehavior: 'AUTO_UPGRADE',\n  version: {\n  deploymentName: deploymentName,\n  buildId: buildId,\n}`\n2. Call `WorkflowClient.start()` from the TypeScript SDK with the following `versioningOverride`:\n`{\n  pinnedTo: {\n    deploymentName: deploymentName,\n    buildId: buildId,\n  },\n}`\n3. Workflow does not start, and client produces the above error.\n\n## Specifications\n\n  - Version: Temporal Server version 1.28.0 and 1.29.0, Temporal TypeScript SDK 1.12.1\n  - Platform: tested on MacOS as well as Linux/Kubernetes/Helm\n","closedAt":"2025-07-31T01:16:27Z","comments":[{"id":"IC_kwDODNqesM67Cuqw","author":{"login":"carlydf"},"authorAssociation":"MEMBER","body":"Hi thanks for reporting this issue. v1.28 of the server does handle the deprecated \"versioning v0.31\" Versioning Override, as tested [here](https://github.com/temporalio/temporal/blob/v1.28.0/tests/worker_deployment_version_test.go#L1497) in the versioning functional tests. If a versioning override is formed correctly with either the deprecated v0.31 fields, or the new v0.32 fields, the server will handle it correctly.\n\nObviously you're hitting this error though, so my best guess is that the typescript SDK is doing something weird like partially filling out both sets of fields? I'm not super familiar with the typescript SDK, but found [this test](https://github.com/temporalio/sdk-typescript/blob/v1.12.1/packages/test/src/test-worker-deployment-versioning.ts#L392-L399) in it that's setting a versioning override. I notified the SDK team about this issue, so they'll be able to take a look, but IMO the server is doing the right thing, so the correct place to file this issue would be in the typescript SDK repo.","createdAt":"2025-07-30T22:57:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/8114#issuecomment-3138054832","viewerDidAuthor":false},{"id":"IC_kwDODNqesM67C7Fs","author":{"login":"jbrody-nexxa"},"authorAssociation":"NONE","body":"Got it. So it looks like the TS SDK is fully setting the v0.31 attributes, but only partially setting the v0.32 ones. While my change to validate v0.31 attributes first would have worked around the issue, if your approach is to prefer v0.32 validation over v0.31, then the TS SDK will need to change. Based on the TS code, it looks like it's sending:\n\n```\n{\n  pinned: {\n      version: 'pinned-version', // v0.32\n  },\n  behavior: temporal.api.enums.v1.VersioningBehavior.VERSIONING_BEHAVIOR_PINNED, // v0.31\n  pinnedVersion: 'pinned-version', // v0.31\n}\n```\n\nWhen the server expects either:\n\n```\n{\n  pinned: {\n    version: 'pinned-version', // v0.32\n    behavior: temporal.api.workflow.v1.VersioningOverride.PinnedOverrideBehavior.PINNED_OVERRIDE_BEHAVIOR_PINNED, // v0.32  \n  },\n}\n```\n\nor:\n\n```\n{\n  behavior: temporal.api.enums.v1.VersioningBehavior.VERSIONING_BEHAVIOR_PINNED, // v0.31\n  pinnedVersion: 'pinned-version', // v0.31\n}\n```\n\nI'll open a ticket and PR over there.","createdAt":"2025-07-30T23:31:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/8114#issuecomment-3138105708","viewerDidAuthor":false},{"id":"IC_kwDODNqesM67Djk6","author":{"login":"jbrody-nexxa"},"authorAssociation":"NONE","body":"I've implemented the fix in the TS SDK. Here's the PR: https://github.com/temporalio/sdk-typescript/pull/1754\n\nIf you could bump this with the SDK team, that would be super! Closing this issue.","createdAt":"2025-07-31T01:16:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/8114#issuecomment-3138271546","viewerDidAuthor":false}],"createdAt":"2025-07-29T19:21:05Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":8114,"reactionGroups":[],"state":"CLOSED","title":"Calling a Workflow with Worker Versioning and PINNED behavior in versionOverrides is broken in Temporal Server >=1.28.0","updatedAt":"2025-07-31T01:16:27Z","url":"https://github.com/temporalio/temporal/issues/8114"}
