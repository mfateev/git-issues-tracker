{"assignees":[],"author":{"id":"MDQ6VXNlcjE4MjgyNTMx","is_bot":false,"login":"r00ta","name":"Jacopo Rota"},"body":"## Expected Behavior\r\nWe followed the example in https://github.com/temporalio/samples-server/tree/main/tls/tls-simple and the temporal docs but we could not find a way to enable tls for the traffic on the membership port and the worker grpc port. Only the other services seems to be working with mTLS.\r\n\r\nHere's the env variable for that container \r\n```\r\n      - \"CASSANDRA_SEEDS=cassandra\"\r\n      - \"DYNAMIC_CONFIG_FILE_PATH=config/dynamicconfig/development.yaml\"\r\n      - \"SKIP_DEFAULT_NAMESPACE_CREATION=true\"\r\n      - \"TEMPORAL_TLS_SERVER_CA_CERT=${TEMPORAL_TLS_CERTS_DIR}/ca.cert\"\r\n      - \"TEMPORAL_TLS_SERVER_CERT=${TEMPORAL_TLS_CERTS_DIR}/cluster.pem\"\r\n      - \"TEMPORAL_TLS_SERVER_KEY=${TEMPORAL_TLS_CERTS_DIR}/cluster.key\"\r\n      - \"TEMPORAL_TLS_REQUIRE_CLIENT_AUTH=true\"\r\n      - \"TEMPORAL_TLS_FRONTEND_CERT=${TEMPORAL_TLS_CERTS_DIR}/cluster.pem\"\r\n      - \"TEMPORAL_TLS_FRONTEND_KEY=${TEMPORAL_TLS_CERTS_DIR}/cluster.key\"\r\n      - \"TEMPORAL_TLS_CLIENT1_CA_CERT=${TEMPORAL_TLS_CERTS_DIR}/ca.cert\"\r\n      - \"TEMPORAL_TLS_CLIENT2_CA_CERT=${TEMPORAL_TLS_CERTS_DIR}/ca.cert\"\r\n      - \"TEMPORAL_TLS_INTERNODE_SERVER_NAME=tls-sample\"\r\n      - \"TEMPORAL_TLS_FRONTEND_SERVER_NAME=tls-sample\"\r\n      - \"TEMPORAL_TLS_FRONTEND_DISABLE_HOST_VERIFICATION=false\"\r\n      - \"TEMPORAL_TLS_INTERNODE_DISABLE_HOST_VERIFICATION=false\"\r\n      - \"TEMPORAL_CLI_ADDRESS=temporal:7233\" # used by tctl. Will be deprecated\r\n      - \"TEMPORAL_CLI_TLS_CA=${TEMPORAL_TLS_CERTS_DIR}/ca.cert\"\r\n      - \"TEMPORAL_CLI_TLS_CERT=${TEMPORAL_TLS_CERTS_DIR}/cluster.pem\"\r\n      - \"TEMPORAL_CLI_TLS_KEY=${TEMPORAL_TLS_CERTS_DIR}/cluster.key\"\r\n      - \"TEMPORAL_CLI_TLS_ENABLE_HOST_VERIFICATION=true\"\r\n      - \"TEMPORAL_CLI_TLS_SERVER_NAME=tls-sample\"\r\n      - \"TEMPORAL_ADDRESS=temporal:7233\" # used by Temporal CLI\r\n      - \"TEMPORAL_TLS_CA=${TEMPORAL_TLS_CERTS_DIR}/ca.cert\"\r\n      - \"TEMPORAL_TLS_CERT=${TEMPORAL_TLS_CERTS_DIR}/cluster.pem\"\r\n      - \"TEMPORAL_TLS_KEY=${TEMPORAL_TLS_CERTS_DIR}/cluster.key\"\r\n      - \"TEMPORAL_TLS_ENABLE_HOST_VERIFICATION=true\"\r\n      - \"TEMPORAL_TLS_SERVER_NAME=tls-sample\"\r\n```\r\n\r\n## Actual Behavior\r\nOn my example\r\n```\r\n    worker:\r\n        rpc:\r\n            grpcPort: 7239\r\n            membershipPort: 6939\r\n```\r\n\r\nthere is no TLS on such ports\r\n```\r\nopenssl s_client -showcerts -connect localhost:7239\r\nCONNECTED(00000003)\r\nwrite:errno=104\r\n---\r\nno peer certificate available\r\n---\r\nNo client certificate CA names sent\r\n---\r\nSSL handshake has read 0 bytes and written 293 bytes\r\nVerification: OK\r\n---\r\nNew, (NONE), Cipher is (NONE)\r\nSecure Renegotiation IS NOT supported\r\nCompression: NONE\r\nExpansion: NONE\r\nNo ALPN negotiated\r\nEarly data was not sent\r\nVerify return code: 0 (ok)\r\n---\r\n```\r\n\r\n```\r\nopenssl s_client -showcerts -connect localhost:6939\r\nCONNECTED(00000003)\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. modify the docker compose provided here https://github.com/temporalio/samples-server/tree/main/tls/tls-simple and expose all the ports (for example 6939 and 7239)\r\n  1. simply check that the traffic on these ports are not TLS encrypted\r\n\r\n## Specifications\r\n\r\n  - Version: 2.24.0\r\n  - Platform: Linux Ubuntu 22.04 (but the example is running on docker using the `latest` images)\r\n","closedAt":"2024-03-27T17:22:57Z","comments":[{"id":"IC_kwDODNqesM54mgwZ","author":{"login":"r00ta"},"authorAssociation":"NONE","body":"Move the discussion to the forum as it might not be a bug but rather a feature request https://community.temporal.io/t/enable-tls-for-membership-port-traffic-and-worker-grpc-traffic/11529","createdAt":"2024-03-27T17:22:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/5614#issuecomment-2023361561","viewerDidAuthor":false}],"createdAt":"2024-03-27T17:10:02Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":5614,"reactionGroups":[],"state":"CLOSED","title":"Traffic on membership ports and grpc port for the temporal worker are not using TLS","updatedAt":"2024-03-27T17:22:58Z","url":"https://github.com/temporalio/temporal/issues/5614"}
