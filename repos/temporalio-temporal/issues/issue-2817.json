{"assignees":[{"id":"MDQ6VXNlcjM3NzA0Nzg=","login":"yux0","name":"Yu Xia","databaseId":0}],"author":{"id":"MDQ6VXNlcjg0NDExMDE0","is_bot":false,"login":"yiminc","name":"Yimin Chen"},"body":"run from master branch, got this error:\r\n`{\"level\":\"warn\",\"ts\":\"2022-05-06T22:46:42.185-0700\",\"msg\":\"error in prometheus reporter\",\"error\":\"a previously registered descriptor with the same fully-qualified name as Desc{fqName: \\\"history_size_total\\\", help: \\\"history_size_total histogram\\\", constLabels: {}, variableLabels: [operation namespace service_name]} has different label names or a different help string\",\"logging-call-at\":\"config.go:408\"}`\r\n\r\nThe culprit is this line: https://github.com/temporalio/temporal/blob/4767cd4e506ece32af7f17bb94bd86f7cff795f5/service/frontend/workflowHandler.go#L3116\r\n\r\nThe reason is the tags are [operation namespace service_name], but same metrics was registered already with tags of [operation namespace service_name stats_type]. The line above does include that tag.\r\n\r\nThe root cause is tally scope is using rootScope instead of that tagged child scope to report the histogram.\r\nhttps://github.com/temporalio/temporal/blob/4767cd4e506ece32af7f17bb94bd86f7cff795f5/common/metrics/tally_scope.go#L125\r\n","closedAt":"2022-06-03T22:32:45Z","comments":[{"id":"IC_kwDODNqesM5EVO8u","author":{"login":"yux0"},"authorAssociation":"MEMBER","body":"This error from  SizeStatsTypeTagValue has been fixed.","createdAt":"2022-06-03T22:32:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2817#issuecomment-1146416942","viewerDidAuthor":false}],"createdAt":"2022-05-07T18:22:14Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2817,"reactionGroups":[],"state":"CLOSED","title":"histogram metrics conflict","updatedAt":"2022-06-03T22:32:45Z","url":"https://github.com/temporalio/temporal/issues/2817"}
