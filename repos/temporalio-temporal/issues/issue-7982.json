{"assignees":[],"author":{"id":"MDQ6VXNlcjE1Njc0MTQ5","is_bot":false,"login":"raymondsze","name":"Sze Ka Wai Raymond"},"body":"## Expected Behavior\nThe time taken to complete the workflow should be around 500-600ms.\n\n## Actual Behavior\nSome time it grows to 2s. I'm not sure if its bug or something I missed.\n\n## Steps to Reproduce the Problem\nI modified the helloworld example from samples-go repository.\n\nBasically, I limited the worker's `MaxConcurrentActivityExecutionSize to 1` to simulate there is only one cpu intensive task can be run concurrently.\n\nAnd I run 10 times of greeting activity in the workflow in parallel, since `MaxConcurrentActivityExecutionSize` is one, it is expected all the activities scheduled at the same time but being started one by one.\n\nThe followings are my modifications:\n```helloworld.go\npackage helloworld\n\nimport (\n\t\"context\"\n\t\"time\"\n\n\t\"go.temporal.io/sdk/activity\"\n\t\"go.temporal.io/sdk/workflow\"\n)\n\n// Workflow is a Hello World workflow definition.\nfunc Workflow(ctx workflow.Context, name string) (string, error) {\n\tao := workflow.ActivityOptions{StartToCloseTimeout: 10 * time.Second}\n\tctx = workflow.WithActivityOptions(ctx, ao)\n\n\tlogger := workflow.GetLogger(ctx)\n\tlogger.Info(\"HelloWorld workflow started\", \"name\", name)\n\n\tvar result string\n\n\twg := workflow.NewWaitGroup(ctx)\n\tfor range 10 {\n\t\twg.Add(1)\n\t\tworkflow.Go(ctx, func(ctx workflow.Context) {\n\t\t\tdefer wg.Done()\n\t\t\terr := workflow.ExecuteActivity(ctx, Activity, name).Get(ctx, &result)\n\t\t\tif err != nil {\n\t\t\t\tlogger.Error(\"Activity failed.\", \"Error\", err)\n\t\t\t}\n\t\t})\n\t}\n\twg.Wait(ctx)\n\n\tlogger.Info(\"HelloWorld workflow completed.\", \"result\", result)\n\n\treturn result, nil\n}\n\nfunc Activity(ctx context.Context, name string) (string, error) {\n\ttime.Sleep(time.Millisecond * 50)\n\tlogger := activity.GetLogger(ctx)\n\tlogger.Info(\"Activity\", \"name\", name)\n\treturn \"Hello \" + name + \"!\", nil\n}\n```\n\n```worker/main.go\npackage main\n\nimport (\n\t\"log\"\n\n\t\"go.temporal.io/sdk/client\"\n\t\"go.temporal.io/sdk/worker\"\n\n\t\"github.com/temporalio/samples-go/helloworld\"\n)\n\nfunc main() {\n\t// The client and worker are heavyweight objects that should be created once per process.\n\tc, err := client.Dial(client.Options{})\n\tif err != nil {\n\t\tlog.Fatalln(\"Unable to create client\", err)\n\t}\n\tdefer c.Close()\n\n\tw := worker.New(c, \"hello-world\", worker.Options{MaxConcurrentActivityExecutionSize: 1})\n\n\tw.RegisterWorkflow(helloworld.Workflow)\n\tw.RegisterActivity(helloworld.Activity)\n\n\terr = w.Run(worker.InterruptCh())\n\tif err != nil {\n\t\tlog.Fatalln(\"Unable to start worker\", err)\n\t}\n}\n```\n\n```starter/main.go\npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"log\"\n\t\"time\"\n\n\t\"go.temporal.io/sdk/client\"\n\n\t\"github.com/temporalio/samples-go/helloworld\"\n)\n\nfunc main() {\n\t// The client is a heavyweight object that should be created once per process.\n\tc, err := client.Dial(client.Options{})\n\tif err != nil {\n\t\tlog.Fatalln(\"Unable to create client\", err)\n\t}\n\tdefer c.Close()\n\n\tstartTime := time.Now()\n\tworkflowOptions := client.StartWorkflowOptions{\n\t\tTaskQueue: \"hello-world\",\n\t}\n\n\twe, err := c.ExecuteWorkflow(context.Background(), workflowOptions, helloworld.Workflow, \"Temporal\")\n\tif err != nil {\n\t\tlog.Fatalln(\"Unable to execute workflow\", err)\n\t}\n\n\tlog.Println(\"Started workflow\", \"WorkflowID\", we.GetID(), \"RunID\", we.GetRunID())\n\n\t// Synchronously wait for the workflow completion.\n\tvar result string\n\terr = we.Get(context.Background(), &result)\n\tif err != nil {\n\t\tlog.Fatalln(\"Unable get workflow result\", err)\n\t}\n\tlog.Println(\"Workflow result:\", result)\n\tfmt.Println(\"Time taken:\", time.Since(startTime))\n}\n```\n\nI run several times, each time only one workflow is executed and wait until response, it takes around 550ms to 600ms to complete the workflow but sometimes it takes more than 2 seconds to complete.\n\nI dig into the dashboard and see the followings:\n\nThis is pretty match to what I expected, the activities scheduled at the same time and being started in sequence.\n<img width=\"1559\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/542cbfb3-f419-4110-9c33-bbf1ed38ee2e\" />\n\nThis is abnormal one, I don't understand why there are such long idle time between activity scheduled and activity started.\n<img width=\"1559\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/67d92004-c8da-4a31-b119-fff4daad195a\" />\n\nI'm using just `temporal server start-dev` to test. Actually I tried to switch to postgresql, but got similar behaviour.\n\n## Specifications\n\n  - Version: temporal version 1.3.0 (Server 1.27.1, UI 2.36.0)\n  - Platform: macOS Sequoia Version 15.3.1 (16gb memory and Apple M1 Chip)\n","closedAt":"2025-07-01T13:36:08Z","comments":[{"id":"IC_kwDODNqesM60Pe8J","author":{"login":"GSmithApps"},"authorAssociation":"MEMBER","body":"Discussion in slack [here](https://temporalio.slack.com/archives/CTRCR8RBP/p1751296885407969)","createdAt":"2025-07-01T13:09:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7982#issuecomment-3023957769","viewerDidAuthor":false},{"id":"IC_kwDODNqesM60P3z4","author":{"login":"tsurdilo"},"authorAssociation":"MEMBER","body":"closing for now as discussion is ongoing in slack. ","createdAt":"2025-07-01T13:36:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7982#issuecomment-3024059640","viewerDidAuthor":false}],"createdAt":"2025-06-29T09:21:33Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7982,"reactionGroups":[],"state":"CLOSED","title":"Unexpected latency between activity scheduled and activity start.","updatedAt":"2025-07-01T13:36:08Z","url":"https://github.com/temporalio/temporal/issues/7982"}
