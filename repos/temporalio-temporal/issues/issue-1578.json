{"assignees":[],"author":{"id":"MDQ6VXNlcjE3NTA2NDQx","is_bot":false,"login":"rfwagner","name":"Richard Wagner"},"body":"Currently, the tctl batch command does a ScanWorkflowExecutions with the given query and always performs the designated operation on a workflow_id/run_id pair.\r\n\r\nThere should be an option to operate on the workflow_id level, leaving out the run_id. This, for example, would provide a more systematic way to do a guaranteed cancellation of a cron workflow (assuming the cron workflow could be identified by workflow_type)","closedAt":"2024-03-16T01:22:16Z","comments":[{"id":"IC_kwDODNqesM4-XyXr","author":{"login":"sunny-b"},"authorAssociation":"NONE","body":"I've been looking at this issue and I'd be up for working on it, though I have a couple of clarifying questions:\r\n\r\nIt looks like you can already use the `WorkflowId` as a [search attribute](https://docs.temporal.io/docs/concepts/what-is-a-search-attribute/) in the `query` flag. In that case, is this really needed? Or would it be just a convenience flag that would take the place of query, similar to the `workflow_id` and `workflow_type` flags for [`workflow list` command](https://github.com/temporalio/temporal/blob/master/tools/cli/workflowCommands.go#L1283-L1290)?\r\n\r\nAdditionally, it looks like adding this `workflow_id` flag would also require making sure that info gets passed through the various API calls, including `CountWorkflow` and `ExecuteWorkflow`. `ExecuteWorkflow` has a `SearchAttributes` field where you could add the `WorkflowId`, but this would need to be added to `CountWorkflow` since it only has a `query` field.\r\n\r\nOne hack that wouldn't require changes to the backend APIs is if the `workflow_id` flag is present, to generate a query from it.\r\n\r\nEx. `batch start --workflow_id test_workflow_id` would translate to a query like `WorkflowId='default.test_workflow_id'`\r\n\r\nDoes that seem reasonable?","createdAt":"2022-02-21T02:59:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1578#issuecomment-1046423019","viewerDidAuthor":false},{"id":"IC_kwDODNqesM53REUk","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"There is currently no plan to work on this. \r\nThe BatchOperation APIs are implemented in a simple way that it queries visibility to fetch list of workflow executions and then apply operation on each of them. The challenge is the workflow state could change while that batch operation is running, and a cron workflow may have completed and started a new run. So if you try to batch terminate running cron workflows, your visibility query may return list of them, but by the time the batch operation get to it, it may have already completed and scheduled next run which is not in the visibility query result obtained earlier. \r\nA simple work around would be to run the visibility query after the batch operation and run the batch again if there are more running cron workflows. ","createdAt":"2024-03-16T01:22:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/1578#issuecomment-2000962852","viewerDidAuthor":false}],"createdAt":"2021-05-27T22:16:15Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwyNTc2NTM1ODQ2","name":"difficulty: easy","description":"","color":"68d662"},{"id":"MDU6TGFiZWwzMTM4ODI4MTE3","name":"up-for-grabs","description":"Issues to consider for external contribution","color":"69CD90"}],"milestone":null,"number":1578,"reactionGroups":[],"state":"CLOSED","title":"add an option to \"tctl batch start\" to operate at the workflow_id level","updatedAt":"2024-03-16T01:22:16Z","url":"https://github.com/temporalio/temporal/issues/1578"}
