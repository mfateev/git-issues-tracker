{"assignees":[{"id":"MDQ6VXNlcjIyMzI1MjQ=","login":"alexshtin","name":"Alex Shtin","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0NjM2MjI=","is_bot":false,"login":"mfateev","name":"Maxim Fateev"},"body":"## Expected Behavior\r\n`respondWorkflowTaskCompleted` call is expected to throw `INVALID_ARGUMENT` gRPC failure if commands are not formatted properly.\r\n\r\n## Actual Behavior\r\n`respondWorkflowTaskCompleted` returns OK empty response.\r\n\r\nThe service logs in my case:\r\n\r\n`temporal_1              | {\"level\":\"info\",\"ts\":\"2020-08-03T00:13:37.102Z\",\"msg\":\"Failing the workflow task.\",\"service\":\"history\",\"shard-id\":1,\"address\":\"172.21.0.3:7234\",\"shard-item\":\"0xc00048c700\",\"component\":\"history-engine\",\"workflow-task-fail-cause\":\"BadRecordMarkerAttributes\",\"error\":\"RecordMarkerCommandAttributes is not set on command.\",\"wf-id\":\"c511cd7d-d53b-4e7a-ac71-3e40c645d913\",\"wf-run-id\":\"d1072956-9718-48b3-9882-cb892965450b\",\"wf-namespace-id\":\"5d0413eb-9cfc-48f5-b6ff-6df341eed0ce\",\"logging-call-at\":\"workflowTaskHandlerCallbacks.go:456\"}`\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nThe following Java class reproduces the problem:\r\n\r\n```java\r\npublic class BadDecisionRepro {\r\n\r\n  public static final String TASK_QUEUE = \"queue1\";\r\n\r\n  public static void main(String[] args) {\r\n    WorkflowServiceStubs service = WorkflowServiceStubs.newInstance();\r\n    WorkflowServiceGrpc.WorkflowServiceBlockingStub stub = service.blockingStub();\r\n\r\n    stub.startWorkflowExecution(\r\n        StartWorkflowExecutionRequest.newBuilder()\r\n            .setNamespace(\"default\")\r\n            .setRequestId(UUID.randomUUID().toString())\r\n            .setWorkflowId(UUID.randomUUID().toString())\r\n            .setWorkflowType(WorkflowType.newBuilder().setName(\"type1\").build())\r\n            .setTaskQueue(TaskQueue.newBuilder().setName(\"queue1\").build())\r\n            .build());\r\n\r\n    PollWorkflowTaskQueueRequest pollRequest =\r\n        PollWorkflowTaskQueueRequest.newBuilder()\r\n            .setNamespace(\"default\")\r\n            .setTaskQueue(TaskQueue.newBuilder().setName(TASK_QUEUE))\r\n            .build();\r\n    PollWorkflowTaskQueueResponse task = stub.pollWorkflowTaskQueue(pollRequest);\r\n\r\n    RespondWorkflowTaskCompletedRequest.Builder respondRequest =\r\n        RespondWorkflowTaskCompletedRequest.newBuilder()\r\n            .setTaskToken(task.getTaskToken())\r\n            .addCommands(\r\n                0,\r\n                Command.newBuilder()\r\n                    .setCommandType(CommandType.COMMAND_TYPE_RECORD_MARKER)\r\n                    .build());\r\n\r\n    RespondWorkflowTaskCompletedResponse response =\r\n        stub.respondWorkflowTaskCompleted(respondRequest.build());\r\n    \r\n    System.out.println(\"Response='\" + response + \"'\");\r\n  }\r\n}\r\n\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version: 0.28.0 of the service\r\n  - Platform: Mac\r\n","closedAt":"2020-08-17T21:31:37Z","comments":[],"createdAt":"2020-08-03T00:21:34Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":652,"reactionGroups":[],"state":"CLOSED","title":"respondWorkflowTaskCompleted doesn't fail on bad commands","updatedAt":"2020-08-17T21:31:37Z","url":"https://github.com/temporalio/temporal/issues/652"}
