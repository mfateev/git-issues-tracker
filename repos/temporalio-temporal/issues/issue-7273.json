{"assignees":[],"author":{"id":"MDQ6VXNlcjEzOTY0ODA4","is_bot":false,"login":"lado936","name":"Lado Golijashvili"},"body":"## Expected Behavior\nWhen using S3 provider for archiver it should directly push files to it.\n## Actual Behavior\nWe are using S3 provider for archiver in Kubernetes setup. Our monitoring events are filled with headObject requests to S3 bucket, after digging in and enabling access logs to s3 bucket, we found out that history pod is first checking if file is present and only then pushing file, it results in millions of error requests.\n\n\n## Steps to Reproduce the Problem\n\n  1. Set up temporal with archiver S3 provider\n  1. Turn on access logs on s3 bucket\n  1. There will be one headObject request before every PuT request\n\n## Specifications\n\n  - Version:  v1.25.2\n  - Platform: On Premise Kubernetes\n","closedAt":"2025-02-20T23:45:22Z","comments":[{"id":"IC_kwDODNqesM6fUiAW","author":{"login":"yycptt"},"authorAssociation":"MEMBER","body":"Unfortunately this is how the aws/gcp archiver logic works today to prevent two clusters from double uploading the same workflow, and it's achieved by doing an existence check before the upload. So those 404 responses are expected.","createdAt":"2025-02-20T23:43:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7273#issuecomment-2672959510","viewerDidAuthor":false},{"id":"IC_kwDODNqesM6fYdoP","author":{"login":"lado936"},"authorAssociation":"NONE","body":"But in our case we are running only one cluster, so there should be opt out mechanism for this, to be able to disable checks, as our monitoring is spammed by millions of 404 error logs from temporal workload","createdAt":"2025-02-21T09:08:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/7273#issuecomment-2673990159","viewerDidAuthor":false}],"createdAt":"2025-02-06T14:53:03Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":7273,"reactionGroups":[],"state":"CLOSED","title":"History pod uses headObject request on non-existing S3 objects, before actually pushing object, resulting in millions of 404 errors","updatedAt":"2025-02-21T09:08:55Z","url":"https://github.com/temporalio/temporal/issues/7273"}
