{"assignees":[{"id":"MDQ6VXNlcjU1NTIzODE=","login":"mastermanu","name":"","databaseId":0}],"author":{"id":"MDQ6VXNlcjIxODY5Ng==","is_bot":false,"login":"markmark206","name":"Mark Markaryan"},"body":"(Discovered by Nicolas, thank you!)\r\n\r\n## Expected Behavior\r\n\r\nI should be able to specify cassandra configuration parameters (user name/ password, tls configuration options, replication factor) via parameters in my docker-compose file, similarly to how i can specify mysql user name and password here: https://github.com/temporalio/temporal/blob/16f23cb090955d405afdf6676881bdb6f434b043/docker/docker-compose-mysql.yml#L22-L23\r\n\r\n\r\n\r\n## Actual Behavior\r\n\r\nUnfortunately, there is no way to specify this for cassandra. The only thing that can be passed to the container is cassandra host(s) and keyspaces:\r\n\r\nhttps://github.com/temporalio/temporal/blob/16f23cb090955d405afdf6676881bdb6f434b043/docker/docker-compose.yml#L13\r\n\r\nIt appears that our configuration template that we use when launching via docker-compose only expands CASSANDRA_SEEDS and *NAMESPACE values.\r\n\r\nhttps://github.com/temporalio/temporal/blob/16f23cb090955d405afdf6676881bdb6f434b043/docker/config_template.yaml#L17-L23 \r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. attempt to use docker compose to start temporal server running against a cassandra with credentials. fail miserably. ; ) \r\n\r\n## Specifications\r\n\r\n  - Version: temporal 0.26.0\r\n  - Platform: mac os\r\n","closedAt":"2021-04-30T01:52:50Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY4Nzc2OTg2Mw==","author":{"login":"mikhailshilkov"},"authorAssociation":"NONE","body":"That's a bummer! So is there a workaround to connect to a Cassandra cluster protected by credentials?","createdAt":"2020-09-06T11:58:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-687769863","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcwOTY0MTc5MA==","author":{"login":"gazmania"},"authorAssociation":"NONE","body":"Is there any movement on this? I've been trying to connect to Azure CosmosDB via the Cassandra API and can't get Temporal to recognise any options.  Then found this defect.","createdAt":"2020-10-15T23:27:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-709641790","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxMDUyMjIzMw==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"Hey folks,\r\n\r\nWe've updated the config_template file to take in a bunch of extra variables to pass in extra configuration information. The PR has been landed: https://github.com/temporalio/temporal/pull/869/files\r\n\r\nPlease take a look and let us know if this solves the issue, or if you have more questions!\r\n\r\n","createdAt":"2020-10-16T19:57:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-710522233","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxMDc2MDExMA==","author":{"login":"gazmania"},"authorAssociation":"NONE","body":"Hi.  I just pulled master to get this change.  Still not working for me.  I think the `start.sh` script needs updating to pass the additional info into the cqlsh for the `wait_for_cassandra()` and `setup_cassandra_schema()` function.  That's the first problem with trying to run from docker-compose for me with the new env vars, might be something else later on.  I think it would be really useful to also add an example of this usage to the README.md in the docker folder too.","createdAt":"2020-10-17T06:24:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-710760110","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxMjk4Nzg5NA==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"Will take another look at this today.","createdAt":"2020-10-20T16:31:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-712987894","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxMzMxOTY0NQ==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"Ah, did not realize that you were using auto-setup image to run this (was assuming you were setting up Cassandra out of band and then trying to set environment variables on the server image).\r\n\r\nThis [PR](https://github.com/temporalio/temporal/pull/882) should partially address this as it will forward the relevant environment variables to the setup_cassandra_schema() function.\r\n\r\nWill look at fixing the wait_for_cassandra() in a similar fashion tomorrow.\r\n\r\n","createdAt":"2020-10-21T05:48:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-713319645","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxMzg0NTg2MQ==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"This [PR](https://github.com/temporalio/temporal/pull/885) should address the wait_for_cassandra() issue and has been merged. Are you able to verify that this unblocks you?","createdAt":"2020-10-21T20:11:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-713845861","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxNDM2Nzg5Nw==","author":{"login":"mikhailshilkov"},"authorAssociation":"NONE","body":"@gazmania I tried connecting to my Cosmos DB with the latest Docker image but getting\r\n\r\n```\r\ngocql: unable to dial control conn 104.44.12.124: gocql: no response received from cassandra within timeout period\r\nUnable to start server: cassandra schema version compatibility check failed: unable to create CQL Client: \r\ngocql: unable to create session: control: unable to connect to initial hosts: gocql: no response received from cassandra\r\nwithin timeout period.\r\n```\r\n\r\nCurious if you succeed with this. \r\n\r\n```\r\nEnvironment:\r\n      AUTO_SETUP:          true\r\n      CASSANDRA_SEEDS:     mycassandra.cassandra.cosmos.azure.com\r\n      CASSANDRA_USER:      mycassandra\r\n      CASSANDRA_PORT:      10350\r\n      CASSANDRA_PASSWORD:  blablamybse64pwd==\r\n```","createdAt":"2020-10-22T09:38:36Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-714367897","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxNDY4OTQ5Mw==","author":{"login":"gazmania"},"authorAssociation":"NONE","body":"@mikhailshilkov I haven't tried the latest version on master yet after the recent PRs.  When i was hacking about myself attempting to PoC connectivity to CosmosDB I managed to get the autosetup to work, sort of, after a couple of hit and miss runs.\r\n* i saw issues with keyspace creation in that temporal-cassandra-tool returned without error but the ketspace didn't actually get created.  This happened inconsistently, sometimes it would work.  I assumed there was some sort of eventual consistency issue bu even after waiting a while the keyspace still didn't turn up.  I created manually if it didn't work.\r\n* A few issues caused by CosmosDB implementation of Cassandra API where i had to tweak the schema\r\n  * there is a hanging comma on the `serialised_event_batch` type which CosmosDB didn't like, Cassandra is evidently ok here\r\n  * gc_grace_period has to be 0 for CosmosDB\r\n  * named indexes are not supported in CosmosDB, have to remove the names all indexes\r\n\r\nI was similar to the env vars you had above, but also was passing the below as I couldn't connect without some sort of TLS flags:\r\n  \"CASSANDRA_TLS_ENABLED=true\"\r\n  \"SSL_VERSION=TLSv1_2\"\r\n  \"SSL_VALIDATE=false\"\r\n\r\nOn CosmosDB I can't find where to get the public cert so had the set SSL_VALIDATE to false.  This is what the helper instructions on the CosmosDB console also also do.\r\n\r\nI haven't yet been able to actually get Temporal itself to work even after the schema was finally set up.  I'll let you know how that goes.","createdAt":"2020-10-22T18:47:20Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-714689493","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcxNTA4NTc2OQ==","author":{"login":"mikhailshilkov"},"authorAssociation":"NONE","body":"@gazmania Thank you for digging into that! I think it would make sense to open a new issue, summarize your findings, and eventually for the team to fix the auto-setup (in case Cosmos works as a backend at all).","createdAt":"2020-10-23T07:39:54Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-715085769","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcyNTM5NjA4Ng==","author":{"login":"nhernandez2"},"authorAssociation":"NONE","body":"If it still works, what I had to do, in the case of cadence, was to use a custom config_template and modify the start.sh.\r\n\r\nstart.sh\r\n\r\n`cqlsh -u $CASSANDRA_USER -p $CASSANDRA_PASSWORD --cqlversion=3.4.4 $server`\r\n\r\nconfig_template\r\n\r\n`default: \r\ncassandra:\r\nhosts: {{ default .Env.CASSANDRA_SEEDS \"\" }}\r\nkeyspace: {{ default .Env.KEYSPACE \"cadence\" }}\r\nuser: {{ default .Env.CASSANDRA_USER \"\" }}\r\npassword: {{ default .Env.CASSANDRA_PASSWORD \"\" }}`\r\n\r\nDockerfile\r\n\r\n`COPY config/config_template.yaml  /etc/cadence/config`\r\n\r\nI hope this helps someone.","createdAt":"2020-11-11T12:28:40Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/513#issuecomment-725396086","viewerDidAuthor":false}],"createdAt":"2020-07-08T20:45:23Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":513,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"No way to set cassandra configs (creds, tls option, etc) via docker-compose","updatedAt":"2021-04-30T01:52:50Z","url":"https://github.com/temporalio/temporal/issues/513"}
