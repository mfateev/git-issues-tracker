{"assignees":[{"id":"MDQ6VXNlcjI3NTk0Nw==","login":"mmcshane","name":"Matt McShane","databaseId":0},{"id":"MDQ6VXNlcjg0NDExMDE0","login":"yiminc","name":"Yimin Chen","databaseId":0}],"author":{"id":"MDQ6VXNlcjg3NjI4OTM=","is_bot":false,"login":"wxing1292","name":"Wenquan Xing"},"body":"Current master branch will allow loading new namespace directly: \r\nhttps://github.com/temporalio/temporal/blob/master/common/namespace/registry.go#L478-L486\r\nthe behavior change may affect how history engine works, e.g. only trigger failover for non seen namespace failover:\r\nhttps://github.com/temporalio/temporal/blob/master/common/namespace/registry.go#L267\r\nhttps://github.com/temporalio/temporal/blob/master/service/history/historyEngine.go#L359\r\n\r\nmeaning\r\nT = 0s namespace A's failover with notification 100 is in DB, to be seen by namespace cache in 5s.\r\nT = 1s namespace B (newly created namespace, with notification 101) is directly loaded by namespace cache by [link](https://github.com/temporalio/temporal/blob/master/common/namespace/registry.go#L478-L486), then history shard will record \"all notifications <= 101) are seen, and skip the failover notification of namespace A later.\r\n\r\n\r\nLast release: 1.12.x will check if namespace exists, and force reload all namespace: https://github.com/temporalio/temporal/blob/release/v1.12.x/common/cache/namespaceCache.go#L529","closedAt":"2021-10-18T19:34:04Z","comments":[{"id":"IC_kwDODNqesM44YIEz","author":{"login":"mmcshane"},"authorAssociation":"CONTRIBUTOR","body":"> failover with notification 100 is in DB\r\n\r\n~How can this happen ... does namespace failover _not_ go through the namespace package but rather update the database underneath?~\r\n\r\nIt does, I found it eventually https://github.com/temporalio/temporal/blob/1d7b63b10d0ae272504ed585dfc753d2797e5a91/common/namespace/replicationTaskExecutor.go#L259","createdAt":"2021-10-18T14:42:30Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2060#issuecomment-945848627","viewerDidAuthor":false}],"createdAt":"2021-10-16T00:11:33Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg3","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":2060,"reactionGroups":[],"state":"CLOSED","title":"Possible race condition when loading new namespace","updatedAt":"2021-10-18T19:34:04Z","url":"https://github.com/temporalio/temporal/issues/2060"}
