{"assignees":[{"id":"MDQ6VXNlcjU1NTIzODE=","login":"mastermanu","name":"","databaseId":0}],"author":{"id":"MDQ6VXNlcjE3NjY1MTU=","is_bot":false,"login":"samarabbas","name":"Samar Abbas"},"body":"## Expected Behavior\r\ndescribe output should show workflow details.\r\n\r\n## Actual Behavior\r\n```\r\ntctl --ns benchtest wf desc -w 1\r\nError: Unable to decode heartbeat details.\r\nError Details: payload item 0: unable to decode JSON: json: cannot unmarshal number into Go value of type string\r\n('export TEMPORAL_CLI_SHOW_STACKS=1' to see stack traces)\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1.  Run a workflow which runs long running activity\r\n  1.  Activity heartbeats with some details\r\n  1.  Run tctl to dump workflow details\r\n```\r\ntctl --ns benchtest wf desc -w 1\r\n```\r\n\r\n## Specifications\r\n\r\n  - Version:  0.26.0\r\n  - Platform: \r\n","closedAt":"2020-07-11T00:39:19Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDY1NTkyODQ3MA==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"Looks like the CLI is completely broken when it comes to interpreting the server response of a heartbeat if it is a non-string value\r\n\r\nThe server response returns *commonpb.Payloads which basically contains an array of *Payload structs. Each payload struct indicates whether it is a raw byte array of a json marshalled object.\r\n\r\nIn this case, we are returning from the server:\r\n\r\n```\r\nPayloads{\r\n   Payloads: []Payload{\r\n       Metadata: {{\"encoding\":\"json:}},\r\n       Data: <byte array of an int32 that has been marshalled to JSON>\r\n   }\r\n}\r\n```\r\n\r\nWe are then unmarshalling the JSON number and then trying to assign it to a string pointer. You can't assign a number to an string, which is the error you are getting.\r\n\r\nSo there are two bugs here:\r\n1) For the purposes of the CLI, rather than trying to unmarshall the JSON value, we should maybe consider just returning the raw JSON byte array converted to a string. Or we can temporarily force RecordHeartbeat to be a string for now and convert it to an arbitrary interface array at a later point in time. Or we can see if we can just make HeartbeatDetails in the CLO and interface{} object for now and see if that fixes it. Or, if we can't decode heartbeat details, we can at least substitute a value as \"unable to decode as it was not a string\" as a short-term fix. Will play around with this.\r\n\r\n2) The code as it is doesn't handle the case where MULTIPLE arguments are passed to activity.RecordHeartbeat(). It will only ever surface the first one.\r\n\r\nIt also looks like temporal-web is broken as well:\r\nIt returns the metadata.encoding as json, the metadata.encoding_base64 as anNvbg== (which is just the base64 version of \"json\", which is rather pointless) and then the actual data field (which is the most useful portion) is blank. Will open a separate issue on this one tomorrow.\r\n\r\n","createdAt":"2020-07-09T06:27:50Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/516#issuecomment-655928470","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDY1Njk1MTM2NA==","author":{"login":"mastermanu"},"authorAssociation":"MEMBER","body":"This has been fixed here: https://github.com/temporalio/temporal/pull/525","createdAt":"2020-07-11T00:39:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/516#issuecomment-656951364","viewerDidAuthor":false}],"createdAt":"2020-07-09T01:09:58Z","labels":[{"id":"MDU6TGFiZWwxNjIxMDMwNzg0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":516,"reactionGroups":[],"state":"CLOSED","title":"CLI unable to show describe workflow output when it has heartbeat data","updatedAt":"2020-07-11T00:39:19Z","url":"https://github.com/temporalio/temporal/issues/516"}
