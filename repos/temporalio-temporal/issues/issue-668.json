{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMjI1MTI=","is_bot":false,"login":"hazcod","name":"Niels Hofmans"},"body":"YAML:\r\n```yaml\r\n  temporal:\r\n    image: temporalio/server:0.28.0\r\n    restart: \"on-failure:5\"\r\n    environment:\r\n    - \"LOG_LEVEL=info\"\r\n    - \"AUTO_SETUP=true\"\r\n    - \"DB=postgres\"\r\n    - \"DB_PORT=26257\"\r\n    - \"POSTGRES_USER=root\"\r\n    - \"POSTGRES_PWD=postgres\"\r\n    - \"POSTGRES_SEEDS=postgres\"\r\n    - \"SKIP_DEFAULT_NAMESPACE_CREATION=true\"\r\n    links:\r\n    - temporaldb:postgres\r\n    ports:\r\n    - 7233\r\n    depends_on:\r\n    - temporaldb\r\n```\r\n\r\n```+ DB=postgres\r\n+ ENABLE_ES=false\r\n+ ES_PORT=9200\r\n+ ES_SCHEME=http\r\n+ RF=1\r\n+ DEFAULT_NAMESPACE=default\r\n+ DEFAULT_NAMESPACE_RETENTION=1\r\n+ export TEMPORAL_CLI_ADDRESS=172.24.0.5:7233\r\n+ TEMPORAL_CLI_ADDRESS=172.24.0.5:7233\r\n+ export KEYSPACE=temporal\r\n+ KEYSPACE=temporal\r\n+ export VISIBILITY_KEYSPACE=temporal_visibility\r\n+ VISIBILITY_KEYSPACE=temporal_visibility\r\n+ export DBNAME=temporal\r\n+ DBNAME=temporal\r\n+ export VISIBILITY_DBNAME=temporal_visibility\r\n+ VISIBILITY_DBNAME=temporal_visibility\r\n+ export DB_PORT=26257\r\n+ DB_PORT=26257\r\n+ '[' true = true ']'\r\n+ auto_setup\r\n+ wait_for_db\r\n+ '[' postgres == mysql ']'\r\n+ '[' postgres == postgres ']'\r\n+ wait_for_postgres\r\n++ echo postgres\r\n++ awk -F , '{print $1}'\r\n+ server=postgres\r\n+ nc -z postgres 26257\r\n+ '[' 0 -eq 0 ']'\r\n+ echo 'postgres started'\r\npostgres started\r\n+ '[' '' '!=' true ']'\r\n+ setup_schema\r\n+ '[' postgres == mysql ']'\r\n+ '[' postgres == postgres ']'\r\n+ echo 'setup postgres schema'\r\nsetup postgres schema\r\n+ setup_postgres_schema\r\n+ SCHEMA_DIR=/etc/temporal/schema/postgres/temporal/versioned\r\n+ temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 create --db temporal\r\n2020/08/11 09:08:56 error creating database:pq: database \"temporal\" already exists\r\n+ temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 --db temporal setup-schema -v 0.0\r\n2020/08/11 09:08:56 Starting schema setup, config=&{SchemaFilePath: InitialVersion:0.0 Overwrite:false DisableVersioning:false}\r\n2020/08/11 09:08:56 Setting up version tables\r\n2020/08/11 09:08:56 pq: relation \"schema_version\" already exists\r\n+ temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 --db temporal update-schema -d /etc/temporal/schema/postgres/temporal/versioned\r\n2020/08/11 09:08:56 UpdateSchemeTask started, config=&{DBName: TargetVersion: SchemaDir:/etc/temporal/schema/postgres/temporal/versioned IsDryRun:false}\r\n2020/08/11 09:08:56 error reading current schema version:pq: column \"version_partition\" does not exist\r\n+ VISIBILITY_SCHEMA_DIR=/etc/temporal/schema/postgres/visibility/versioned\r\n+ temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 create --db temporal_visibility\r\n2020/08/11 09:08:56 error creating database:pq: database \"temporal_visibility\" already exists\r\n+ temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 --db temporal_visibility setup-schema -v 0.0\r\n2020/08/11 09:08:56 Starting schema setup, config=&{SchemaFilePath: InitialVersion:0.0 Overwrite:false DisableVersioning:false}\r\n2020/08/11 09:08:56 Setting up version tables\r\n2020/08/11 09:08:56 pq: relation \"schema_version\" already exists\r\n+ temporal-sql-tool --plugin postgres --ep postgres -u root -p 26257 --db temporal_visibility update-schema -d /etc/temporal/schema/postgres/visibility/versioned\r\n2020/08/11 09:08:56 UpdateSchemeTask started, config=&{DBName: TargetVersion: SchemaDir:/etc/temporal/schema/postgres/visibility/versioned IsDryRun:false}\r\n2020/08/11 09:08:56 error reading current schema version:pq: column \"version_partition\" does not exist\r\n+ '[' true '!=' true ']'\r\n+ '[' false == true ']'\r\n+ exec bash /start-temporal.sh\r\n+ dockerize -template /etc/temporal/config/config_template.yaml:/etc/temporal/config/docker.yaml\r\n+ exec temporal-server --root /etc/temporal --env docker start --services=history,matching,frontend,worker\r\n2020/08/11 09:08:56 Loading config; env=docker,zone=,configDir=/etc/temporal/config\r\n2020/08/11 09:08:56 Loading configFiles=[/etc/temporal/config/docker.yaml]\r\n2020/08/11 09:08:56 sql schema version compatibility check failed: unable to read cassandra schema version keyspace/database: temporal error: pq: column \"version_partition\" does not exist\r\n```\r\n## Specifications\r\n\r\n  - Version:server docker  0.28.0, client 0.28.1\r\n  - Platform: Docker on Mac\r\n","closedAt":"2020-08-11T09:12:47Z","comments":[],"createdAt":"2020-08-11T09:11:08Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":668,"reactionGroups":[],"state":"CLOSED","title":"Cockroach 0.28.0 fails with: column \"version_partition\" does not exist","updatedAt":"2020-08-11T09:12:47Z","url":"https://github.com/temporalio/temporal/issues/668"}
