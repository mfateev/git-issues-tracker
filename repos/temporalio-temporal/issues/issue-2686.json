{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MjE3MDE=","is_bot":false,"login":"nordiste","name":"marc druelle"},"body":"## Expected Behavior\r\nno error while tctl command\r\n\r\n## Actual Behavior\r\nerror\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. execute tctl --ns default n up --history_uri \"s3://temporal-history-labeu\" --visibility_uri \"s3://temporal-vis-history-labeu\" --vas enabled\r\n  or try to create a new one, same result.\r\nconfig.yml :\r\n\r\narchival:\r\n  history:\r\n    state: \"enabled\"\r\n    enableRead: true\r\n    provider:\r\n      s3store:\r\n        region: \"{{ .Env.S3_REGION }}\"\r\n        endpoint: \"{{ .Env.S3_ENDPOINT }}\"\r\n  visibility:\r\n    state: \"enabled\"\r\n    enableRead: true\r\n    provider:\r\n      s3store:\r\n        region: \"{{ .Env.S3_REGION }}\"\r\n        endpoint: \"{{ .Env.S3_ENDPOINT }}\"\r\n\r\nnamespaceDefaults:\r\n  archival:\r\n    history:\r\n      state: \"enabled\"\r\n      URI: \"{{ .Env.S3_HISTORY_URI }}\"\r\n    visibility:\r\n      state: \"enabled\"\r\n      URI: \"{{ .Env.S3_VISIBILITY_URI }}\"\r\n  \r\n\r\nenv var are well configured.\r\nwe use aws_access_key_id & aws_secret_access_key en var too.\r\n\r\n\r\nwe got this error + stack trace : \r\nlevel=\"error\" logging-call-at=\"telemetry.go:190\" logtag=\"F\" msg=\"uncategorized error\" operation=\"UpdateNamespace\" stacktrace=\"go.temporal.io/server/common/log.(*zapLogger).Error\r\n\t/temporal/common/log/zap_logger.go:142\r\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryInterceptor).handleError\r\n\t/temporal/common/rpc/interceptor/telemetry.go:190\r\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryInterceptor).Intercept\r\n\t/temporal/common/rpc/interceptor/telemetry.go:117\r\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1119\r\ngo.temporal.io/server/common/metrics.NewServerMetricsContextInjectorInterceptor.func1\r\n\t/temporal/common/metrics/grpc.go:66\r\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1119\r\ngo.temporal.io/server/common/rpc.ServiceErrorInterceptor\r\n\t/temporal/common/rpc/grpc.go:131\r\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1119\r\ngo.temporal.io/server/common/rpc/interceptor.(*NamespaceLogInterceptor).Intercept\r\n\t/temporal/common/rpc/interceptor/namespace_logger.go:84\r\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1119\r\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1121\r\ngo.temporal.io/api/workflowservice/v1._WorkflowService_UpdateNamespace_Handler\r\n\t/go/pkg/mod/go.temporal.io/api@v1.7.1-0.20220131203817-08fe71b1361d/workflowservice/v1/service.pb.go:1087\r\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1282\r\ngoogle.golang.org/grpc.(*Server).handleStream\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:1616\r\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\r\n\t/go/pkg/mod/google.golang.org/grpc@v1.44.0/server.go:921\" stream=\"stdout\" ts=\"2022-03-30T19:32:29.237Z\" wf-namespace=\"default\"\r\n\r\n\r\n## Specifications\r\n\r\n  - Version: 1.15.2\r\n  - Platform: kubernetes\r\n  \r\n  \r\n  Thanks for help.\r\n  Marc.","closedAt":"2022-03-30T20:37:03Z","comments":[{"id":"IC_kwDODNqesM5AlcWM","author":{"login":"nordiste"},"authorAssociation":"NONE","body":"here is the tctl result : \r\n\r\ntemporal-tools-554c4df545-fg9st:~$ tctl --ns default n up --history_uri \"s3://temporal-history-labeu\" --visibility_uri \"s3://temporal-vis-history-labeu\" --vas enabled\r\nError: Operation UpdateNamespace failed.\r\nError Details: rpc error: code = DeadlineExceeded desc = context deadline exceeded\r\n","createdAt":"2022-03-30T19:48:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2686#issuecomment-1083557260","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AlfRv","author":{"login":"nordiste"},"authorAssociation":"NONE","body":"i get this error in another run : \r\ntemporal-tools-554c4df545-fg9st:~$ tctl --ns default n up --history_uri \"s3://temporal-history-labeu\" --visibility_uri \"s3://temporal-vis-history-labeu\" --vas enabled\r\nError: Operation UpdateNamespace failed.\r\nError Details: rpc error: code = Unknown desc = BadRequest: Bad Request\r\n\tstatus code: 400, request id: tx156605724d234c34b0187-006244b6e0, host id: tx156605724d234c34b0187-006244b6e0\r\n('export TEMPORAL_CLI_SHOW_STACKS=1' to see stack traces)\r\n","createdAt":"2022-03-30T20:01:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2686#issuecomment-1083569263","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5AlnGg","author":{"login":"nordiste"},"authorAssociation":"NONE","body":"bad s3 config + some timeouts.","createdAt":"2022-03-30T20:37:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2686#issuecomment-1083601312","viewerDidAuthor":false}],"createdAt":"2022-03-30T19:41:01Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2686,"reactionGroups":[],"state":"CLOSED","title":"unable to active archivage using S3","updatedAt":"2022-03-30T20:37:19Z","url":"https://github.com/temporalio/temporal/issues/2686"}
