{"assignees":[],"author":{"id":"MDQ6VXNlcjMwMDg0MDQz","is_bot":false,"login":"VikasNS","name":"Vikas NS"},"body":"## Expected Behavior\r\n1. When I call `listArchivedWorkflowExecutions`, I must only see workflows which have been archived(ie: passed the retention period)\r\n\r\n## Actual Behavior\r\n2. When I call `listArchivedWorkflowExecutions`, I am able to see both archived and unarchived workflows in the result.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Invoke listArchivedWorkflowExecutions on the service library for a given wfid.\r\n  2. You will see worklfows which aren't archived yet.\r\n  \r\n## Specifications\r\n\r\n  - Version: 1.1.12\r\n  - Platform: Java\r\n","closedAt":"2023-11-11T06:13:55Z","comments":[{"id":"IC_kwDODNqesM49Wngh","author":{"login":"tsurdilo"},"authorAssociation":"MEMBER","body":"Associated forum thread: https://community.temporal.io/t/listarchivedworkflowexecutions-lists-unarchived-workflows-aswell/3899\r\n\r\nI think it would be great to fix the current issue with archival to archive both wf history and visibility data when the retention period kicks in. Currently visibility info is archived as soon as workflow execution completes which I believe causes this issue.","createdAt":"2022-02-03T19:44:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2457#issuecomment-1029339169","viewerDidAuthor":false},{"id":"IC_kwDODNqesM49bI6G","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@VikasNS , I would like to understand more about the use case. What are you trying to do with that requirement? If you want to limit the result to certain time window, you can do so by filter on closed time.","createdAt":"2022-02-05T04:41:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2457#issuecomment-1030524550","viewerDidAuthor":false},{"id":"IC_kwDODNqesM49bK1Y","author":{"login":"VikasNS"},"authorAssociation":"NONE","body":"Hi @yiminc,\r\nHere's our usecaes.\r\n\r\nWe are using search attr to store our application datapoints.\r\nWe archvie our workflows every 7 days.\r\n\r\nGiven a workflow id, I must be able return the search attrs associated with that workflow.\r\nFor this,\r\n1. I first search for unarchived workflows with that wfid id using describeWorkflowExecution. If I'm able to find it, I'll pull search attr from that workflow and return.\r\n2. If I don't find it then I'll use listArchivedWorkflowExecutions to see if there are any archived worklfows with that wfid, if I find one, I pull out the search attrs from that workflow and return.\r\n\r\nIn this usecase, it doesn't hurt if listArchivedWorkflowExecutions  returns both archived and unarchived workflows but I just found that its a little misguiding to return both.\r\n\r\n\r\nHowever, You will see a big problem with this faulty behaviour in Archival Tab of Temporal UI.\r\nWhen I open the archival tab, I belive internally it calls listArchivedWorkflowExecutions to pull out the workflows. However, given the faulty behaviour, archival tab will show both archived and unarchived workflow creating a lot of confusions. It took me 20 mins to explain my QA that just because a workflow appears in archival tab, it doesn't mean that it is archived because of the faulty behaviour of listArchivedWorkflowExecutions function :)\r\n\r\n\r\n\r\n\r\n\r\n","createdAt":"2022-02-05T05:40:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2457#issuecomment-1030532440","viewerDidAuthor":false},{"id":"IC_kwDODNqesM49zYpw","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"@VikasNS thanks for the explanation. The archival feature is still experimental. We will revisit it holistically when we are ready to productionize it.","createdAt":"2022-02-12T00:59:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2457#issuecomment-1036880496","viewerDidAuthor":false},{"id":"IC_kwDODNqesM5rsDbJ","author":{"login":"yiminc"},"authorAssociation":"MEMBER","body":"Archival would upload workflow history data to cloud storage (like S3). When archival is enabled, workflow history data will be uploaded to cloud storage soon after workflow is closed. It is not tie to workflow's retention time. So data available in archival storage does not mean workflow is already out of retention. \r\n","createdAt":"2023-11-11T06:13:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/temporal/issues/2457#issuecomment-1806710473","viewerDidAuthor":false}],"createdAt":"2022-02-03T18:43:36Z","labels":[{"id":"MDU6TGFiZWwyMDE5ODE3MzQ2","name":"potential-bug","description":"","color":"66b9cc"}],"milestone":null,"number":2457,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"listArchivedWorkflowExecutions method lists unarchived workflows","updatedAt":"2023-11-11T06:13:55Z","url":"https://github.com/temporalio/temporal/issues/2457"}
