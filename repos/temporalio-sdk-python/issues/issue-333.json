{"assignees":[],"author":{"id":"MDQ6VXNlcjU2NTY0Njc2","is_bot":false,"login":"joshua-auchincloss","name":"Joshua Auchincloss"},"body":"### What are you really trying to do?\n- raise an exception subclassed from BaseException in an activity\n\n\n### Describe the bug\n\nThe bug occurs when raising custom exceptions during an activity. the system raises ```TypeError -> exception causes must derive from BaseException```, which overshadows the actual error\n\n\n### Minimal Reproduction\n\n```py\n....\n\n# also with normal Exception\nclass MyException(BaseException):\n    def __init__(self, *args):\n        super().__init__(*args)\n\n@activity.defn\nasync def my_act():\n    raise MyException(\"abc\") from None\n\n\n@workflow.defn\nclass Workflow:\n    @workflow.run\n    async def run(self):\n          workflow.start_activity(\n            my_act,\n            ....\n          )\n\n```\n\n### Environment/Versions\n- OS and processor: m1 mac\n- Temporal Version: temporal @ 1.20.2, python sdk @ 1.2.0\n- Are you using Docker or Kubernetes or building Temporal from source? docker + build from wheel","closedAt":"2023-07-18T11:07:18Z","comments":[{"id":"IC_kwDOGusT1c5fod-I","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I think you've written invalid Python code. I haven't tested yet, but I think `super().__init__(self, *args)` should be `super().__init__(*args)`.","createdAt":"2023-06-23T15:26:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/333#issuecomment-1604444040","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5foet4","author":{"login":"joshua-auchincloss"},"authorAssociation":"NONE","body":"> I think you've written invalid Python code. I haven't tested yet, but I think `super().__init__(self, *args)` should be `super().__init__(*args)`.\n\nAhh this one's a typo - on mobile for the next few days ðŸ˜…. Apologies, amending - the source is the later `super().__init__(*args)`, which is the condition for the issue presenting ","createdAt":"2023-06-23T15:28:47Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/333#issuecomment-1604447096","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5fqEuw","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Ok, I see the issue. We intentionally only catch `Exception` and its derivatives, not `BaseException`. From https://docs.python.org/3/library/exceptions.html:\r\n\r\n> programmers are encouraged to derive new exceptions from the [Exception](https://docs.python.org/3/library/exceptions.html#Exception) class or one of its subclasses, and not from [BaseException](https://docs.python.org/3/library/exceptions.html#BaseException).\r\n\r\nAnd from https://docs.python.org/3/tutorial/errors.html#handling-exceptions:\r\n\r\n> [Exception](https://docs.python.org/3/library/exceptions.html#Exception)s which are not subclasses of Exception are not typically handled, because they are used to indicate that the program should terminate.\r\n\r\nI'm not sure we want to trap `BaseException`, but maybe we do. Having said that, we don't want to silently swallow it either (which in effect is what is happening today), so should we crash the entire worker for a base exception?\r\n\r\nIn the meantime, please derive from `Exception` and not `BaseException` in Python. And if another library unfortunately is using `BaseException` as their base, you will have to catch and rethrow as a normal exception in your activity. But I'll leave this issue open because we should not silently swallow `BaseException`.","createdAt":"2023-06-23T20:01:00Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/333#issuecomment-1604864944","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5fqwpG","author":{"login":"joshua-auchincloss"},"authorAssociation":"NONE","body":"> Ok, I see the issue. We intentionally only catch `Exception` and its derivatives, not `BaseException`. From https://docs.python.org/3/library/exceptions.html:\n> \n> \n> \n> > programmers are encouraged to derive new exceptions from the [Exception](https://docs.python.org/3/library/exceptions.html#Exception) class or one of its subclasses, and not from [BaseException](https://docs.python.org/3/library/exceptions.html#BaseException).\n> \n> \n> \n> And from https://docs.python.org/3/tutorial/errors.html#handling-exceptions:\n> \n> \n> \n> > [Exception](https://docs.python.org/3/library/exceptions.html#Exception)s which are not subclasses of Exception are not typically handled, because they are used to indicate that the program should terminate.\n> \n> \n> \n> I'm not sure we want to trap `BaseException`, but maybe we do. Having said that, we don't want to silently swallow it either (which in effect is what is happening today), so should we crash the entire worker for a base exception?\n> \n> \n> \n> In the meantime, please derive from `Exception` and not `BaseException` in Python. And if another library unfortunately is using `BaseException` as their base, you will have to catch and rethrow as a normal exception in your activity. But I'll leave this issue open because we should not silently swallow `BaseException`.\n\nGotcha - yep it's an upstream `BaseException`, no issues using try-except so thanks for the quick workaround :)\n\nIMO, crashing the worker seems overkill - maybe a `logging.warn`? Either way, you guys do awesome work so thanks for the help","createdAt":"2023-06-23T22:10:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/333#issuecomment-1605044806","viewerDidAuthor":false}],"createdAt":"2023-06-23T13:43:42Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":333,"reactionGroups":[],"state":"CLOSED","title":"[Bug] BaseException exceptions are not caught when raised in an activity","updatedAt":"2023-07-18T11:07:18Z","url":"https://github.com/temporalio/sdk-python/issues/333"}
