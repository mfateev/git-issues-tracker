{"assignees":[],"author":{"id":"U_kgDODQitAA","is_bot":false,"login":"sashaneb","name":"Sasha Lopashev"},"body":"### What are you really trying to do?\n\nRun Temporal workers that reliably poll for workflow and activity tasks. Workers should maintain active pollers as long as task slots are available.\n\n### Describe the bug\n\nWorker pollers (both activity and workflow) randomly drop to 0 despite available task slots and explicit poller configuration. This causes workflow/activity task timeouts as no worker is polling for tasks.\n\n**Tested configurations - all fail:**\n\n1. `PollerBehaviorAutoscaling(minimum=5, maximum=20, initial=10)` - pollers drop to 0 despite `minimum=5`\n2. Default behavior (no poller config) - pollers drop to 0\n3. `PollerBehaviorSimpleMaximum(maximum=5)` - pollers still drop to 0\n\n**Evidence from Prometheus metrics:**\n\nWorker with 14 available activity slots but 0 pollers:\n```\ntemporal_num_pollers{poller_type=\"activity_task\"} 0\ntemporal_num_pollers{poller_type=\"sticky_workflow_task\"} 3\ntemporal_num_pollers{poller_type=\"workflow_task\"} 1\ntemporal_worker_task_slots_available{worker_type=\"ActivityWorker\"} 14\ntemporal_worker_task_slots_used{worker_type=\"ActivityWorker\"} 1\n```\n\nThe docs for `PollerBehaviorSimpleMaximum` state:\n> \"A poller behavior that will attempt to poll as long as a slot is available, up to the provided maximum.\"\n\nThis is, however, not what we're observing. With 14 available slots, there should be active pollers.\n\n**Timeline:**\n- Workers start healthy with expected poller counts\n- After 10-20 minutes, pollers drop to 0 on some/all workers\n- No errors in logs - worker appears healthy but doesn't poll\n- Happens randomly, affects different workers at different times\n\n**Impact:**\n- Workflow Task Timeouts: New workflows can't start\n- Activity Task Timeouts: Activities can't execute\n- Silent Failures: No errors logged, worker appears healthy\n\n### Minimal Reproduction\n\n```python\nimport asyncio\nfrom temporalio.client import Client\nfrom temporalio.worker import Worker, PollerBehaviorSimpleMaximum\nfrom temporalio import workflow, activity\n\n@activity.defn\nasync def my_activity() -> str:\n    return \"done\"\n\n@workflow.defn\nclass MyWorkflow:\n    @workflow.run\n    async def run(self) -> str:\n        return await workflow.execute_activity(\n            my_activity,\n            start_to_close_timeout=timedelta(seconds=60),\n        )\n\nasync def main():\n    client = await Client.connect(\"your-temporal-address\")\n\n    worker = Worker(\n        client,\n        task_queue=\"test-queue\",\n        workflows=[MyWorkflow],\n        activities=[my_activity],\n        max_concurrent_activities=15,\n        max_concurrent_workflow_tasks=10,\n        # Any of these configurations fail:\n        workflow_task_poller_behavior=PollerBehaviorSimpleMaximum(maximum=5),\n        activity_task_poller_behavior=PollerBehaviorSimpleMaximum(maximum=5),\n    )\n\n    # Run worker and monitor temporal_num_pollers metric\n    # After 10-20 minutes, activity_task pollers drop to 0\n    await worker.run()\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n```\n\nTo observe:\n1. Start worker with Prometheus metrics enabled\n2. Run some workflows\n3. Monitor `temporal_num_pollers` metric over 15-20 minutes\n4. Observe `poller_type=\"activity_task\"` drop to 0 despite available slots\n\n### Environment/Versions\n\n- OS and processor: Linux x86_64 (Kubernetes/EKS), also tested on M1 Mac\n- SDK version: `temporalio==1.21.1` (latest), as well as previously used `1.13.0`\n- Temporal: Temporal Cloud (us-east-1)\n- Python: 3.12\n- Using Kubernetes (EKS on AWS) with multiple worker pods autoscaled with KEDA\n\n### Additional context\n\n**Release notes reviewed:**\n- SDK 1.11.0 introduced `PollerBehaviorAutoscaling`\n- SDK 1.12.0 had fix for \"low wft slots/pollers issue\" (#877) but only for workflow tasks\n- SDK 1.19.0 removed \"experimental\" tag from worker tuners\n\n**Questions:**\n1. What causes pollers to drop to 0 despite available slots?\n2. Why does `minimum=5` in autoscaling not enforce the minimum?\n3. Is there a known issue with the Rust core's poller management?\n\n**Current workaround:**\n- Use `PollerBehaviorSimpleMaximum` (slightly more stable than autoscaling)\n- Run multiple workers and hope not all drop to 0 simultaneously\n- Consider periodic worker restarts to reset pollers (not ideal)\n","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c7fQDx3","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"Drops to 0 for how long? Permanently? I suspect there's something unusual going on with your setup, because otherwise we'd have huge amounts of people running into this problem.\n\nThere's no known issue here currently. Minimum 5 does not mean \"there will always be 5 pollers\", it means \"there will be 5 pollers if 5 slots are available\". Of course, in your report here it certainly looks wrong insofar as slots are apparently available. \n\nWe will certainly double check some of our long-running test setups and verify we're not seeing anything unusual. \n\nAt the risk of asking the obvious. When you see pollers drop to zero... you also see work stop being processed?","createdAt":"2026-01-13T17:24:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/1268#issuecomment-3745528951","viewerDidAuthor":false}],"createdAt":"2026-01-09T00:42:34Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1268,"reactionGroups":[],"state":"OPEN","title":"[Bug] Activity/workflow pollers drop to 0 ignoring minimum/maximum settings","updatedAt":"2026-01-13T17:24:11Z","url":"https://github.com/temporalio/sdk-python/issues/1268"}
