{"assignees":[],"author":{"id":"MDQ6VXNlcjU0MzU5NTkx","is_bot":false,"login":"Chaitanya-Varun","name":"Sahukari Chaitanya Varun"},"body":"### Summary\n  Worker intermittently stops polling after completing long-running synchronous activities. The gRPC connection appears to drop after activity completion, but the worker process remains\n   alive. Auto-reconnection eventually works (5-15 minutes later), but causes delays in activity processing.\n\n  ### Environment\n  - **temporalio version**: 1.18.1\n  - **grpcio version**: 1.75.1\n  - **Python version**: 3.11\n  - **Temporal Server**: Running in Docker (localhost:7233)\n  - **OS**: Ubuntu Linux\n\n  ### Worker Configuration\n  ```python\n  with concurrent.futures.ThreadPoolExecutor(max_workers=60) as executor:\n      worker = Worker(\n          client,\n          task_queue=\"core-py\",\n          max_concurrent_activities=60,\n          activities=[...],\n          workflows=[],\n          activity_executor=executor,\n          graceful_shutdown_timeout=timedelta(seconds=300),\n      )\n      await worker.run()\n\n  Activity Characteristics\n\n  - Type: Synchronous (runs on ThreadPoolExecutor)\n  - Duration: 30 minutes to 3 hours\n  - Timeout: 36,000 seconds (10 hours)\n  - Heartbeat: Disabled (0s)\n\n  Observed Behavior\n  ┌──────┬───────────────────────────────────────────────────┐\n  │ Step │                   What Happens                    │\n  ├──────┼───────────────────────────────────────────────────┤\n  │ 1    │ Worker polls, receives activity                   │\n  ├──────┼───────────────────────────────────────────────────┤\n  │ 2    │ Activity executes (30 min - 3 hrs)                │\n  ├──────┼───────────────────────────────────────────────────┤\n  │ 3    │ Activity completes, CompleteActivity RPC succeeds │\n  ├──────┼───────────────────────────────────────────────────┤\n  │ 4    │ Worker stops polling - no new poll requests       │\n  ├──────┼───────────────────────────────────────────────────┤\n  │ 5    │ Server logs \"task queue closed\" after 5 min       │\n  ├──────┼───────────────────────────────────────────────────┤\n  │ 6    │ Worker auto-reconnects after 5-15 min             │\n  └──────┴───────────────────────────────────────────────────┘\n  Evidence\n\n  Queue closes exactly 5 min after activity completion:\n  ┌────────────────────┬──────────────┐\n  │ Activity Completed │ Queue Closed │\n  ├────────────────────┼──────────────┤\n  │ 08:02:39           │ 08:07:39     │\n  ├────────────────────┼──────────────┤\n  │ 08:57:38           │ 09:02:38     │\n  ├────────────────────┼──────────────┤\n  │ 09:46:46           │ 09:51:46     │\n  └────────────────────┴──────────────┘\n  During stuck period:\n  - Process alive, 45 threads active\n  - DB connections work\n  - No TCP connection to port 7233\n\n  Key Observations\n\n  1. Intermittent - not every completion triggers it\n  2. No duration correlation - 27 min to 168 min activities affected\n  3. Auto-recovery works - just slow (5-15 min)\n  4. Completion succeeds - only polling stops afterward\n\n  Suspected Cause\n\n  Race condition in SDK's handling of synchronous activity completion. After ThreadPoolExecutor returns result and CompleteActivity RPC succeeds, polling doesn't resume properly.","closedAt":null,"comments":[],"createdAt":"2026-01-22T11:36:08Z","labels":[],"milestone":null,"number":1295,"reactionGroups":[],"state":"OPEN","title":"[Bug] Worker intermittently stops polling after synchronous activity completion","updatedAt":"2026-01-22T11:36:08Z","url":"https://github.com/temporalio/sdk-python/issues/1295"}
