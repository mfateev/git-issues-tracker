{"assignees":[{"id":"MDQ6VXNlcjIwNjM5Ng==","login":"cretz","name":"Chad Retz","databaseId":0}],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nOur use of https://github.com/konradhalas/dacite is too primitive. It only supports to/from the object itself, not collections, optional, etc.\r\n\r\n### Describe the solution you'd like\r\n\r\nAll of the following should be supported via type hints:\r\n\r\n* `MyDataClass`\r\n* `List[MyDataClass]`, `Set[MyDataClass]`, other collections, etc\r\n* `Mapping[str, MyDataClass]`, `Dict[str, MyDataClass]`, other dicts, etc\r\n* `Union[MyDataClass1, MyDataClass2]`, `Union[List[int], Dict[str, MyDataClass]]`, etc\r\n* `Optional[MyDataClass1]`, `Optional[List[Dict[str, MyDataClass]]]`, etc\r\n\r\nHere are the libraries found so far:\r\n\r\n* https://github.com/konradhalas/dacite\r\n  * What we currently use\r\n  * No top-level collection, mapping, etc support\r\n  * Could be good base to build off of\r\n* https://github.com/lidatong/dataclasses-json\r\n  * No support for non-decorator/non-mixin use (see issue on their repo numbered 243)\r\n  * Requires marshmallow\r\n* https://github.com/rnag/dataclass-wizard\r\n  * Not the most popular (yet?)\r\n  * Does not require inheritance/mixin use\r\n  * Still requires us to figure out whether it's a dict or list or what not\r\n* https://github.com/lovasoa/marshmallow_dataclass\r\n  * Requires marshmallow (which is a popular library and therefore may clash with other users' marshmallow needs)\r\n  * Seems to be the layer backing dataclasses-json\r\n  * Will still have to determine data types expected\r\n\r\nWe should probably support customization via `instance.to_json()`/`instance.to_dict()` and `Class.to_json()`/`Class.to_dict()`. This means those using some of those other libraries will work automatically.\r\n\r\nNeeds investigation...","closedAt":"2022-08-12T12:18:05Z","comments":[{"id":"IC_kwDOGusT1c5G431u","author":{"login":"nathanielobrown"},"authorAssociation":"CONTRIBUTOR","body":"> Our use of https://github.com/konradhalas/dacite is too primitive. It only supports to/from the object itself, not collections, optional, etc.\r\n\r\n@cretz, just in case you haven't heard of them, I'd like to point out [pydantic](https://github.com/samuelcolvin/pydantic) and [fastapi](https://github.com/tiangolo/fastapi) as potentially useful references for this issue.\r\n\r\nPydantic is basically a better dataclasses that's defining feature is really good runtime data validation using types. I use it for serialization/de-serialization with Temporal via a data converter. I find having this runtime checking very useful for catching issues in task processing.\r\n\r\nFastAPI is a web framework that uses Pydantic to for serialization/de-serialization. They handle the cases you are referencing here, like taking a list or other generic as an argument. It might be worth a look.","createdAt":"2022-07-19T16:36:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1189313902","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5G5eB6","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":":+1: One of my fears w/ pydantic or any of the other high profile modelling dependencies is that I would be carrying that dependency with the SDK. But I will look into using it if adding it isn't too much of a burden on SDK users. It seems the major version is stable enough.","createdAt":"2022-07-19T19:28:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1189470330","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5G-VUk","author":{"login":"nathanielobrown"},"authorAssociation":"CONTRIBUTOR","body":"Yeah, I feel like Pydantic should definitely be optional dependency if included at all. I mostly wanted to point out FastAPI as an example of something that's done exactly what this issue describing.\r\n\r\nI could imagine libraries building on top of Temporal (or any task library, really) to provide a FastAPI-like developer experience that's more opinionated and makes more choices for you. But having an extensions/contrib/whatever optional module would be nice too.","createdAt":"2022-07-20T20:51:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1190745380","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5G-kqG","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Yeah, I feel like Pydantic should definitely be optional dependency if included at all. \r\n\r\nI think I have to support dataclass type-hint-based payload conversion out of the box though. But maybe not. Will think on it.","createdAt":"2022-07-20T22:05:02Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1190808198","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5HbOJb","author":{"login":"NullOsama"},"authorAssociation":"NONE","body":"> Yeah, I feel like Pydantic should definitely be optional dependency if included at all. I mostly wanted to point out FastAPI as an example of something that's done exactly what this issue describing.\r\n> \r\n> I could imagine libraries building on top of Temporal (or any task library, really) to provide a FastAPI-like developer experience that's more opinionated and makes more choices for you. But having an extensions/contrib/whatever optional module would be nice too.\r\n\r\n+1 on that.","createdAt":"2022-07-28T15:35:05Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1198318171","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5HsvJd","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Unfortunately general-purpose dataclass use with Pydantic appears limited. I have opened discussion at https://github.com/samuelcolvin/pydantic/discussions/4318. I will try other options, but I cannot yet find a single Python library that I can give a JSON list of `[{\"foo\": \"bar\"}]` and a type hint of `List[MyDataClass]` and expect it to do the right thing. ","createdAt":"2022-08-02T16:03:59Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1202909789","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5Hs5Hp","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Alternatively, if I don't want to write a full JSON parser using type hints, we could only support [TypedDict](https://docs.python.org/3/library/typing.html#typing.TypedDict) for now and leave dataclasses alone.","createdAt":"2022-08-02T16:23:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1202950633","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5Htbog","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Ok, after internal discussion, we are going to write our own JSON deserializer. I am probably going to borrow from https://github.com/yukinarit/pyserde but remove the requirement to decorate the classes.","createdAt":"2022-08-02T18:50:17Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/78#issuecomment-1203092000","viewerDidAuthor":false}],"createdAt":"2022-07-19T13:58:17Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":{"number":2,"title":"beta-2","description":"","dueOn":null},"number":78,"reactionGroups":[],"state":"CLOSED","title":"Improve dataclass type hinting","updatedAt":"2022-08-12T12:18:06Z","url":"https://github.com/temporalio/sdk-python/issues/78"}
