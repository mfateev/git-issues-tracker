{"assignees":[],"author":{"id":"MDQ6VXNlcjM2NjMyMDM=","is_bot":false,"login":"troyanov","name":"Anton Troyanov"},"body":"### What are you really trying to do?\r\n\r\nI am trying to cross compile `core-sdk` in order to use [python-sdk ](https://github.com/temporalio/sdk-python)on `s390x` and `ppc64el` architectures\r\n\r\n### Describe the bug\r\n\r\n```\r\nerror: failed to run custom build command for `ring v0.16.20`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/Users/troyanov/Documents/work/canonical/temporalio/sdk-core/target/debug/build/ring-f698636ef115f979/build-script-build` (exit status: 101)\r\n  --- stderr\r\n  thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', /Users/troyanov/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ring-0.16.20/build.rs:358:10\r\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nwarning: build failed, waiting for other jobs to finish...\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\n`cargo build --target=s390x-unknown-linux-gnu` \r\n`cargo build --target=powerpc64le-unknown-linux-gnu` \r\n\r\n(make sure required targets are installed, if not add them with `rustup target add`)\r\n\r\n### Environment/Versions\r\n\r\n```\r\n❯ git rev-parse @\r\n617612aa419d687aebabcf0258ac86f5c36df189\r\n\r\n❯ rustc --version\r\nrustc 1.71.0 (8ede3aae2 2023-07-12)\r\n\r\n❯ rustup --version\r\nrustup 1.26.0 (5af9b9484 2023-04-05)\r\ninfo: This is the version for the rustup toolchain manager, not the rustc compiler.\r\ninfo: The currently active `rustc` version is `rustc 1.71.0 (8ede3aae2 2023-07-12)`\r\n\r\n❯ sysctl -n machdep.cpu.brand_string\r\nApple M1 Pro\r\n```\r\n\r\n### Additional context\r\n\r\nCompilation issue should be fixed in the recent `ring` [v0.17.0](https://crates.io/crates/ring/0.17.0) version.\r\nJudging based on the following issues were marked as fixed:\r\n\r\n- briansmith/ring#986\r\n- briansmith/ring#1182\r\n- briansmith/ring#1630\r\n\r\n```\r\nring v0.16.20\r\n├── rustls v0.21.7\r\n│   ├── hyper-rustls v0.24.1\r\n│   │   └── reqwest v0.11.21\r\n│   │       └── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core)\r\n│   │           ├── temporal-sdk v0.1.0-alpha.1 (/cyberfarm/temporalio/sdk-core/sdk)\r\n│   │           │   └── temporal-sdk-core-test-utils v0.1.0 (/cyberfarm/temporalio/sdk-core/test-utils)\r\n│   │           │       [dev-dependencies]\r\n│   │           │       └── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│   │           │   [dev-dependencies]\r\n│   │           │   └── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│   │           └── temporal-sdk-core-test-utils v0.1.0 (/cyberfarm/temporalio/sdk-core/test-utils) (*)\r\n│   ├── reqwest v0.11.21 (*)\r\n│   └── tokio-rustls v0.24.1\r\n│       ├── hyper-rustls v0.24.1 (*)\r\n│       ├── reqwest v0.11.21 (*)\r\n│       └── tonic v0.9.2\r\n│           ├── opentelemetry-otlp v0.13.0\r\n│           │   └── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│           ├── opentelemetry-proto v0.3.0\r\n│           │   └── opentelemetry-otlp v0.13.0 (*)\r\n│           ├── temporal-client v0.1.0 (/cyberfarm/temporalio/sdk-core/client)\r\n│           │   ├── temporal-sdk v0.1.0-alpha.1 (/cyberfarm/temporalio/sdk-core/sdk) (*)\r\n│           │   ├── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│           │   └── temporal-sdk-core-test-utils v0.1.0 (/cyberfarm/temporalio/sdk-core/test-utils) (*)\r\n│           ├── temporal-sdk v0.1.0-alpha.1 (/cyberfarm/temporalio/sdk-core/sdk) (*)\r\n│           ├── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│           ├── temporal-sdk-core-api v0.1.0 (/cyberfarm/temporalio/sdk-core/core-api)\r\n│           │   ├── temporal-client v0.1.0 (/cyberfarm/temporalio/sdk-core/client) (*)\r\n│           │   ├── temporal-sdk v0.1.0-alpha.1 (/cyberfarm/temporalio/sdk-core/sdk) (*)\r\n│           │   ├── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│           │   └── temporal-sdk-core-test-utils v0.1.0 (/cyberfarm/temporalio/sdk-core/test-utils) (*)\r\n│           └── temporal-sdk-core-protos v0.1.0 (/cyberfarm/temporalio/sdk-core/sdk-core-protos)\r\n│               ├── temporal-client v0.1.0 (/cyberfarm/temporalio/sdk-core/client) (*)\r\n│               ├── temporal-sdk v0.1.0-alpha.1 (/cyberfarm/temporalio/sdk-core/sdk) (*)\r\n│               ├── temporal-sdk-core v0.1.0 (/cyberfarm/temporalio/sdk-core/core) (*)\r\n│               ├── temporal-sdk-core-api v0.1.0 (/cyberfarm/temporalio/sdk-core/core-api) (*)\r\n│               └── temporal-sdk-core-test-utils v0.1.0 (/cyberfarm/temporalio/sdk-core/test-utils) (*)\r\n├── rustls-webpki v0.101.6\r\n│   └── rustls v0.21.7 (*)\r\n└── sct v0.7.0\r\n    └── rustls v0.21.7 (*)\r\n```\r\n\r\nSince `core-sdk` doesn't depend directly on the `ring` crate, dependant dependencies should be tracked.\r\nMost of them depend on `ring` through `rustls`\r\n- corresponding PR to bump `ring` version in `rustls` rustls/rustls#1508\r\n\r\n","closedAt":"2023-10-29T20:50:43Z","comments":[{"id":"IC_kwDOGusT1c5oWqNq","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks for the report! Since this is actually a dependency of a dependency of a dependency and core is a library, there is nothing to do in this repo since there is no `Cargo.lock`. I am moving this issue to the Python repo.\r\n\r\nI don't see why, once rustls merges and tags a release w/ ring updated, we can't then `cargo update` in `temporalio/bridge` dir to get updates. I will watch the PR (let us know if the tag happens and we didn't notice though). Reading the comments on that ring PR, it's looking hopeful they will backport this to a `0.21` patch release. If they don't, we'd need https://github.com/rustls/tokio-rustls to accept the update first.","createdAt":"2023-10-06T14:24:39Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/394#issuecomment-1750770538","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5oXpm1","author":{"login":"troyanov"},"authorAssociation":"NONE","body":"Thanks for a quick reply. Indeed `sdk-python` might be a better place for this bug.\r\n\r\nJust for the reference, here is a corresponding `0.21` backport PR to track\r\n- https://github.com/rustls/rustls/pull/1525","createdAt":"2023-10-06T16:16:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/394#issuecomment-1751030197","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5qWQ8N","author":{"login":"troyanov"},"authorAssociation":"NONE","body":"@cretz it seems the issue is solved now as `rustls` was bumped to `0.21.8` in https://github.com/temporalio/sdk-python/pull/400\r\n\r\nI was able to cross-compile temporalio/bridge without any problems.","createdAt":"2023-10-29T20:50:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/394#issuecomment-1784221453","viewerDidAuthor":false}],"createdAt":"2023-10-06T09:55:37Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":394,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Compilation fails for ARCH `s390x` and `ppc64el`","updatedAt":"2023-10-29T20:50:43Z","url":"https://github.com/temporalio/sdk-python/issues/394"}
