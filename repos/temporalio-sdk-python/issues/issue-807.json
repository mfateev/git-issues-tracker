{"assignees":[],"author":{"id":"MDQ6VXNlcjczODM1MQ==","is_bot":false,"login":"mrknmc","name":"Mark Nemec"},"body":"### Is your feature request related to a problem? Please describe.\n\n* I would like to include full stack trace information in Sentry - see screenshot below where only `ChildWorkflowError` has a stack trace and both `ActivityError` and `ApplicationError` are missing it.\n* I understand the exceptions are passed through the distributed system using the `Failure` Protobuf message which has a `stack_trace` field which could be used to populate the Sentry stack trace. This works for getting the stack trace of the `ApplicationError` in the activity. However, it's impossible to get the stack trace for the `ActivityError` in the `TestChildWorkflow` because the failure is just copied from the original failure here: https://github.com/temporalio/sdk-python/blob/bf747f1170e603b1e1adbd77c673fa83f0c99e7d/temporalio/converter.py#L826-L829\n\n<img width=\"1131\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/fb08e736-8f58-4aa0-bf45-c17523ce0292\" />\n\nThis is the workflow and activity code I'm using to test this:\n\n```\n@activity.defn(...)\nasync def test_activity() -> None:\n    raise TestException(\"Test error\")\n\n\n@workflow.defn\nclass TestChildWorkflow:\n    @workflow.run\n    async def run(self) -> None:\n        # execute_default_activity is our wrapper around workflow.execute_activity\n        await execute_default_activity(\n            test_activity,\n            retry_policy=RetryPolicy(maximum_attempts=1),\n        ),\n\n\n@workflow.defn\nclass TestParentWorkflow:\n    @workflow.run\n    async def run(self) -> None:\n        # child workflow fails parent workflow\n        await workflow.execute_child_workflow(\n            TestChildWorkflow.run,\n            id=f\"test-child-workflow-{int(workflow.time())}\",\n            task_queue=get_temporal_tasks_queue_name(),\n        )\n```\n\n### Describe the solution you'd like\n\n* Ability to get the stack trace for every error in the chain. I am happy to contribute this code but I am not sure if there is a strong reason for why it is done this way and whether it can be changed.\n","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c6k44eB","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Python exceptions don't support easily deserializing tracebacks that come from remote/arbitrary strings (such as the ones we store which can come from any programming language or Python version). Therefore, we make the raw failure available to access this if needed. So for instance, this would get a collection of messages and tracebacks (untested, just typed here in code):\n\n```python\n@dataclass\nclass ExcDetails:\n    message: str\n    stack_trace: Optional[str]\n\ndef populate_chain(exc: Exception, chain: list[ExcDetails]) -> None:\n    stack_trace = None\n    if isinstance(exc, FailureError) and exc.failure:\n        stack_trace = exc.failure.stack_trace\n    elif exc.__traceback__:\n        stack_trace = \"\\n\".join(traceback.format_tb(exc.__traceback__))\n    chain.append(ExcDetails(message=exc.message, stack_trace=stack_trace))\n    if exc.__cause__:\n        populate_chain(exc.__cause__, chain)\n```\n\nSomething like that should work. Or do you have alternative suggestions on how to make arbitrary string stack trace available via error?","createdAt":"2025-03-31T14:12:33Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/807#issuecomment-2766374785","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6llA7l","author":{"login":"tpetkov-red"},"authorAssociation":"NONE","body":"> Something like that should work. Or do you have alternative suggestions on how to make arbitrary string stack trace available via error?\n\nFound this issue while trying to solve a similar problem.  \nHonestly, I'd be happy with the above (or similar) solution plopped into the sdk.\n@cretz  do you think this can be included into the project?","createdAt":"2025-04-04T08:34:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/807#issuecomment-2777943781","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6lo7Ld","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"The SDK already includes stack trace on the errors, it's just via `failure.stack_trace` instead of `__traceback__` because Python has limitations on what can be on `__traceback__`. This little sample code was just showing how you can call `failure.stack_trace` in your code, but I don't think we'll include this sample in the SDK proper. You can use a whole new object to collect stack traces if you want like this sample does, though many may just prefer to use the existing Python exceptions and provide a formatter of sorts to whatever is displaying/recording the exception.","createdAt":"2025-04-04T14:54:15Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/807#issuecomment-2778968797","viewerDidAuthor":false}],"createdAt":"2025-03-29T13:08:51Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":807,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"OPEN","title":"[Feature Request] Loss of stack trace information","updatedAt":"2025-04-04T14:55:02Z","url":"https://github.com/temporalio/sdk-python/issues/807"}
