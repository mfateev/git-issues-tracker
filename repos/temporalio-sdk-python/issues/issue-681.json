{"assignees":[],"author":{"id":"MDQ6VXNlcjE0NjQ1MTk=","is_bot":false,"login":"wilsoniya","name":"Michael Wilson"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nI'm trying to run temporal workflow tests in an environment without access to the public internet. This means that `WorkflowEnvironment.start_time_skipping(...)` et. al. can't fetch the time skipping test server from temporal.download. \r\n\r\nThere's a possible workaround I found while stepping through temporal-core-sdk in which I could e.g. make a [test server tarball](https://temporal.download/temporal-test-server/default?platform=linux&arch=amd64&sdk-version=default&sdk-name=temporal-test-server)  available on the air-gapped infrastructure, unpack it, then thread the path to the binary into my test harness and pass it as the `test_server_existing_path` to `WorkflowEnvironment.start_time_skipping`. But I wish a more ergonomic option existed, especially for a use case that might not be uncommon.\r\n\r\n### Describe the solution you'd like\r\n\r\nIn order of descending convenience for my use case:\r\n\r\n* be able to provide a URL of the tarball itself via environment variable (without the json info indirection); I'm able to cache the tarball at a different location\r\n* be able to provide a URL of the test server binary via environment variable\r\n* be able to provide an absolute path to the test server binary on disk via environment variable\r\n\r\nBasically, configuration via environment variable saves having to thread information through to every WorkflowEnvironment instantiation.\r\n\r\nIt would also be helpful to document the location where test server binaries can be acquired. \r\n\r\nAn alternative solution could be packaging and publishing platform/arch-specific pypi packages containing the test server. This could either be in the sdk-python package itself, or a separate package which is conditionally depended on by sdk-python via dependency group.\r\n\r\nI'm def open to other approaches. Thanks!\r\n\r\n### Additional context\r\n* PR introducing on-demand test server fetching: https://github.com/temporalio/sdk-core/pull/389\r\n* Call site where test server is downloaded: https://github.com/cretz/temporal-sdk-core/blob/3105ef349fe60265157ae7fa96674c964ae5c979/core/src/ephemeral_server/mod.rs#L298\r\n","closedAt":"2024-10-31T20:14:09Z","comments":[{"id":"IC_kwDOGusT1c6SEh5_","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> In order of descending convenience for my use case:\r\n\r\nAs mentioned there, we provide the option for you to give the executable path. This gives you full freedom without us being too specific. I would suggest if you want a URL-based download, you can use your preferred downloading tool/library to download it and extract the tarball. Same if it were on S3 or provided via some other method. Similarly if you want to have this option set via environment variable, just `test_server_existing_path=os.getenv('MY_ENV_VAR')`.\r\n\r\nI am not sure we want to bake in so many ways to get a file beyond the default/no-option and the advanced option.","createdAt":"2024-10-31T19:26:55Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/681#issuecomment-2450660991","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6SEz7V","author":{"login":"wilsoniya"},"authorAssociation":"NONE","body":"> I am not sure we want to bake in so many ways to get a file beyond the default/no-option and the advanced option.\r\n\r\nThanks for the response, and I can understand this :+1: \r\n\r\nI appreciate the forethought to provide this escape hatch. Is there documentation describing where to find the test server binary tarballs? I ended up reading the sdk-core implementation to figure out where they are. \r\n\r\nThanks again and I consider this closed.","createdAt":"2024-10-31T20:14:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/681#issuecomment-2450734805","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6SFAU9","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Is there documentation describing where to find the test server binary tarballs?\r\n\r\nNo, we can add this. Yeah they are part of https://github.com/temporalio/sdk-java releases","createdAt":"2024-10-31T20:45:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/681#issuecomment-2450785597","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6U6ZKa","author":{"login":"Kilo59"},"authorAssociation":"NONE","body":"@cretz @wilsoniya \r\n\r\nWhere can I find this documentation?\r\n\r\nAlso can the error message here could be improved. At least logging or including the HTTP status code returned.\r\n```\r\nRuntimeError: Failed starting Temporal dev server: error sending request for url (https://temporal.download/cli/default?arch=arm64&platform=darwin&format=tar.gz&sdk-name=sdk-python&sdk-version=1.8.0)\r\n```","createdAt":"2024-11-25T15:29:22Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/681#issuecomment-2498335386","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6U7EaU","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This documentation is in the API docs at https://python.temporal.io/temporalio.testing.WorkflowEnvironment.html#start_time_skipping:\r\n\r\n> test_server_existing_path [...] Existing path to the test server binary. If present, no download will be attempted to fetch the binary.\r\n\r\nThough your error looks like it's referring to `start_local`, so those are at https://python.temporal.io/temporalio.testing.WorkflowEnvironment.html#start_local. But I am afraid it, and many of the other advanced options there, are not (yet) documented outside of the API docs.\r\n\r\n> Also can the error message here could be improved. At least logging or including the HTTP status code returned.\r\n\r\nYes, this is because the Rust HTTP request library does not include more detail from the inner message (https://github.com/seanmonstar/reqwest/blob/e2d4b14c695acaebe531af7ce4712e182278f38a/src/error.rs#L185). We can look into improving it.","createdAt":"2024-11-25T16:39:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/681#issuecomment-2498512532","viewerDidAuthor":false}],"createdAt":"2024-10-31T18:22:38Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":681,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] Support for test server without internet access","updatedAt":"2024-11-25T16:39:43Z","url":"https://github.com/temporalio/sdk-python/issues/681"}
