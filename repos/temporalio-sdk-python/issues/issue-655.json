{"assignees":[],"author":{"id":"MDQ6VXNlcjMwMjE1NTY0","is_bot":false,"login":"leonard-henriquez","name":"Léonard Henriquez"},"body":"## What are you really trying to do?\r\n\r\nUse Sentry with Temporal to track and manage warnings within workflows.\r\n\r\n## Describe the bug\r\n\r\nSentry’s catch_warnings context manager, which relies on the standard Python warnings module, raises a KeyError in Temporal workflows because the warnings module is not available. This happens in environments managed by Temporal, which restricts access to certain standard Python modules like warnings.\r\n\r\nThis restriction leads to a failure when using libraries like Sentry that depend on this module for capturing and managing Python warnings.\r\n\r\nError Example:\r\n```\r\nKeyError: 'warnings'\r\n```\r\n\r\nCause: The warnings module is not present or accessible within the Temporal workflow environment, causing the code to fail when it tries to reference sys.modules['warnings'].\r\n\r\n## Minimal Reproduction\r\n\r\nTo reproduce this issue:\r\n\r\n\t1.\tSet up a Temporal workflow in Python.\r\n\t2.\tIntegrate Sentry’s catch_warnings context manager or any other library that uses the warnings module.\r\n\t3.\tTrigger a Python warning within the workflow (e.g., by using warnings.warn()).\r\n\t4.\tThe workflow fails with a KeyError: 'warnings' due to the restricted access.\r\n\r\nHere’s a minimal code snippet:\r\n\r\n```\r\ndef workflow_function():\r\n    with warnings.catch_warnings(record=True) as w:\r\n        warnings.warn(\"This is a test warning\")\r\n```\r\n\r\n## Environment/Versions\r\n\t•\tOS and processor: MacBook Pro M1\r\n\t•\tTemporal Version: 1.7.1\r\n\t•\tAre you using Docker or Kubernetes?: Using Docker to run Temporal","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c6OC-B5","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> 2.\tIntegrate Sentry’s catch_warnings context manager or any other library that uses the warnings module.\r\n\r\nYou're going to have to pass through the imports and disable the sandbox I believe. `warnings` is not a determinism-safe module (and Sentry likely isn't either). Using non-deterministic modules like Sentry require pass through and sandbox avoidance. https://github.com/temporalio/sdk-python?tab=readme-ov-file#workflow-sandbox explains how the sandbox works and how to disable for parts of code. Similar pass through and avoidance techniques are applied in our Sentry interceptor in the sample at https://github.com/temporalio/samples-python/tree/main/sentry.","createdAt":"2024-09-30T13:07:24Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/655#issuecomment-2383143033","viewerDidAuthor":false}],"createdAt":"2024-09-29T08:46:03Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":655,"reactionGroups":[],"state":"OPEN","title":"[Bug] KeyError: 'warnings' due to sandbox","updatedAt":"2024-09-30T13:07:39Z","url":"https://github.com/temporalio/sdk-python/issues/655"}
