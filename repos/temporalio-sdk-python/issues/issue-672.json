{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the solution you'd like\r\n\r\nSee #398 (PR #422) where we did this for 3.7/3.12. Can see the several things that were done there and similar should be done here.","closedAt":"2025-01-10T16:18:01Z","comments":[{"id":"IC_kwDOGusT1c6UjB_q","author":{"login":"josh-berry"},"authorAssociation":"CONTRIBUTOR","body":"I happened to discover by accident that grpcio does not yet support Python 3.13 because it apparently depends on some C APIs that have been removed. So it seems unlikely we'd be able to support it without updating grpcio (if a fix is available; it may already be)","createdAt":"2024-11-21T20:27:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/672#issuecomment-2492211178","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6UkEtU","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"`grpcio` is an optional dependency. We only added it because we do generate the gRPC stubs in the `temporalio.api.workflowservice.v1.service_pb2_grpc` and _technically_ allow users to use that module if they want pure Python gRPC clients or servers even though we don't use it in the SDK. We do use it in tests to implement a custom gRPC server and figured \"why not let users use the generated gRPC stuff too\" in addition to protos. We may be able to remove this stuff if we have to (otherwise we may be able to upgrade it, it all depends on how old of a protobuf library we need to support).","createdAt":"2024-11-21T22:31:24Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/672#issuecomment-2492484436","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6WGwc4","author":{"login":"sciyoshi"},"authorAssociation":"NONE","body":"Tracebacks are currently broken in Python 3.13. The original traceback for an exception happening in a workflow is clobbered and instead the following error is shown:\r\n\r\n```\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/_workflow.py\", line 260, in _handle_activation\r\n    completion = await asyncio.wait_for(\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^\r\n        activate_task, self._deadlock_timeout_seconds\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    )\r\n    ^\r\n\r\n  File \"/usr/local/lib/python3.13/asyncio/tasks.py\", line 507, in wait_for\r\n    return await fut\r\n           ^^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/concurrent/futures/thread.py\", line 58, in run\r\n    result = self.fn(*self.args, **self.kwargs)\r\n\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/workflow_sandbox/_runner.py\", line 160, in activate\r\n    self._run_code(\r\n    ~~~~~~~~~~~~~~^\r\n        \"with __temporal_importer.applied():\\n\"\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    ...<2 lines>...\r\n        __temporal_activation=act,\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    )\r\n    ^\r\n\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/workflow_sandbox/_runner.py\", line 176, in _run_code\r\n    exec(code, self.globals_and_locals, self.globals_and_locals)\r\n    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\n  File \"<string>\", line 2, in <module>\r\n\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/workflow_sandbox/_in_sandbox.py\", line 81, in activate\r\n    return self.instance.activate(act)\r\n           ~~~~~~~~~~~~~~~~~~~~~~^^^^^\r\n\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/_workflow_instance.py\", line 411, in activate\r\n    logger.warning(\r\n    ~~~~~~~~~~~~~~^\r\n        f\"Failed activation on workflow {self._info.workflow_type} with ID {self._info.workflow_id} and run ID {self._info.run_id}\",\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        exc_info=activation_err,\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^\r\n        extra={\"temporal_workflow\": self._info._logger_details()},\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    )\r\n    ^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1531, in warning\r\n    self._log(WARNING, msg, args, **kwargs)\r\n    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1664, in _log\r\n    self.handle(record)\r\n    ~~~~~~~~~~~^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1680, in handle\r\n    self.callHandlers(record)\r\n    ~~~~~~~~~~~~~~~~~^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1744, in callHandlers\r\n    lastResort.handle(record)\r\n    ~~~~~~~~~~~~~~~~~^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1026, in handle\r\n    self.emit(record)\r\n    ~~~~~~~~~^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1158, in emit\r\n    self.handleError(record)\r\n    ~~~~~~~~~~~~~~~~^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/logging/__init__.py\", line 1075, in handleError\r\n    traceback.print_exception(exc, limit=None, file=sys.stderr)\r\n    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/traceback.py\", line 129, in print_exception\r\n    te = TracebackException(type(value), value, tb, limit=limit, compact=True)\r\n\r\n  File \"/usr/local/lib/python3.13/traceback.py\", line 1044, in __init__\r\n    self.stack = StackSummary._extract_from_extended_frame_gen(\r\n                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\r\n        _walk_tb_with_full_positions(exc_traceback),\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        limit=limit, lookup_lines=lookup_lines,\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        capture_locals=capture_locals)\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/traceback.py\", line 492, in _extract_from_extended_frame_gen\r\n    f.line\r\n\r\n  File \"/usr/local/lib/python3.13/traceback.py\", line 369, in line\r\n    self._set_lines()\r\n    ~~~~~~~~~~~~~~~^^\r\n\r\n  File \"/usr/local/lib/python3.13/traceback.py\", line 350, in _set_lines\r\n    lines.append(linecache.getline(self.filename, lineno).rstrip())\r\n                 ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\n  File \"/usr/local/lib/python3.13/linecache.py\", line 25, in getline\r\n    lines = getlines(filename, module_globals)\r\n\r\n  File \"/usr/local/lib/python3.13/linecache.py\", line 41, in getlines\r\n    return updatecache(filename, module_globals)\r\n\r\n  File \"/usr/local/lib/python3.13/linecache.py\", line 100, in updatecache\r\n    stat = os.stat(fullname)\r\n\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/workflow_sandbox/_restrictions.py\", line 964, in __call__\r\n    state.assert_child_not_restricted(\"__call__\")\r\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\r\n\r\n  File \"/code/.venv/lib/python3.13/site-packages/temporalio/worker/workflow_sandbox/_restrictions.py\", line 792, in assert_child_not_restricted\r\n    raise RestrictedWorkflowAccessError(\r\n        f\"{self.name}.{name}\", override_message=matcher.leaf_message\r\n    )\r\n```\r\n\r\nThe error message occurs from an attempt to access linecache inside the original exception, leading to this:\r\n\r\n```\r\nCannot access os.stat.__call__ from inside a workflow. If this is code from a module not used in a workflow or known to only be used deterministically from a workflow, mark the import as pass through.\r\n```","createdAt":"2024-12-04T19:16:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}},{"content":"EYES","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-python/issues/672#issuecomment-2518353720","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6cLl7M","author":{"login":"cprafullchandra"},"authorAssociation":"NONE","body":"Hi, I am still seeing this issue.\n\n```\ntemporalio.worker.workflow_sandbox._restrictions.RestrictedWorkflowAccessError: Cannot access os.stat.__call__ from inside a workflow. If this is code from a module not used in a workflow or known to only be used deterministically from a workflow, mark the import as pass through.\n```\n\nPython = 3.13.0\ntemporalio = 1.9.0\ntemporal (server) = 1.2.0\n\nReverting to Python 3.12 fixed the tracebacks so I could see the actual error.","createdAt":"2025-01-28T23:47:53Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/672#issuecomment-2620284620","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6c1D1O","author":{"login":"FatihKartal"},"authorAssociation":"NONE","body":"Also facing what @cprafullchandra mentioned when hosting our workers for Temporal cloud. I hope this can be resolved soon as we are locked into Python 3.13. currently.","createdAt":"2025-02-03T14:26:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/672#issuecomment-2631155022","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6c1dE2","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"3.13 support is in the next release (should not be too long now, though no exact timelines)","createdAt":"2025-02-03T15:05:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":3}}],"url":"https://github.com/temporalio/sdk-python/issues/672#issuecomment-2631258422","viewerDidAuthor":false}],"createdAt":"2024-10-15T20:23:28Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":672,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"HOORAY","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] Drop 3.8 support, confirm 3.13 support","updatedAt":"2025-02-03T15:05:14Z","url":"https://github.com/temporalio/sdk-python/issues/672"}
