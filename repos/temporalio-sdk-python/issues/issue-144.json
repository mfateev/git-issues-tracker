{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the bug\r\n\r\n`2022-09-27T22:28:42Z` cannot be parsed by `datetime.fromisoformat` which we are using for search attributes. Make sure the full [RFC3339Nano](https://pkg.go.dev/time#pkg-constants) is supported.","closedAt":"2022-11-07T13:37:24Z","comments":[{"id":"IC_kwDOGusT1c5LHGtW","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"From https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat:\r\n> Caution\r\n>This does not support parsing arbitrary ISO 8601 strings - it is only intended as the inverse operation of datetime.isoformat(). A more full-featured ISO 8601 parser, dateutil.parser.isoparse is available in the third-party package dateutil.","createdAt":"2022-09-27T22:51:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/144#issuecomment-1260153686","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5NQbxs","author":{"login":"Oracen"},"authorAssociation":"CONTRIBUTOR","body":"I've been experimenting with the new Scheduler system released in Temporal `1.18.0`. Workers using the Python API break on the same problem described here. This can be replicated with the following code snippet, then setting up a schedule either in the web UI or `tctl`.\r\n\r\n```\r\nimport asyncio\r\nfrom datetime import datetime\r\n\r\nfrom dateutil import parser\r\nfrom temporalio import workflow\r\nfrom temporalio.client import Client\r\nfrom temporalio.worker import Worker\r\n\r\n\r\n@workflow.defn\r\nclass Replication:\r\n    @workflow.run\r\n    async def run(self):\r\n        pass\r\n\r\n\r\nasync def main():\r\n    client = await Client.connect(\"localhost:7233\")\r\n    worker = Worker(client, workflows=[Replication], task_queue=\"replication\")\r\n\r\n    print(\"Starting worker\")\r\n    await worker.run()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    print(\"Before:\", datetime.fromisoformat(\"2022-10-30T05:13:00\"))\r\n    try:\r\n        print(\"Won't run:\", datetime.fromisoformat(\"2022-10-30T05:13:00Z\"))\r\n    except ValueError:\r\n        print(\"Exception thrown\")\r\n    print(\"After:\", parser.isoparse(\"2022-10-30T05:13:00Z\"))\r\n\r\n    asyncio.run(main())\r\n```\r\n\r\nThis produces the following stack trace:\r\n```\r\nFailed handling activation on workflow with run ID 435abaf1-36bc-49ff-b003-4d6a8d833315\r\nTraceback (most recent call last):\r\n  File \"./.venv/lib/site-packages/temporalio/worker/workflow.py\", line 174, in _handle_activation\r\n    workflow = await self._create_workflow_instance(act)\r\n  File \"./.venv/lib/site-packages/temporalio/worker/workflow.py\", line 321, in _create_workflow_instance\r\n    search_attributes=temporalio.converter.decode_search_attributes(\r\n  File \"./.venv/lib/site-packages/temporalio/converter.py\", line 704, in decode_search_attributes\r\n    val = [datetime.fromisoformat(v) for v in val]\r\n  File \"./.venv/lib/site-packages/temporalio/converter.py\", line 704, in <listcomp>\r\n    val = [datetime.fromisoformat(v) for v in val]\r\nValueError: Invalid isoformat string: '2022-10-30T06:28:30Z'\r\n```\r\n\r\nI did some work on a fork that resolved down to a one-line fix + some unit tests for regression testing around the `converter.decode_search_attributes` function, linked here: https://github.com/Oracen/sdk-python\r\n\r\nI'll open a PR with the fix now, hopefully the problem is as simple as it appears","createdAt":"2022-10-30T07:47:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/144#issuecomment-1296153708","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5NTxHo","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":":+1: Saw the PR but wondering if we can avoid the additional dependency. Are there any snippets/approaches where we could do this using just the standard library?\r\n\r\n(EDIT: Starting to look unreasonable to vendor this or avoid the dependency. I'll update the PR)","createdAt":"2022-10-31T12:40:50Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/144#issuecomment-1297027560","viewerDidAuthor":false}],"createdAt":"2022-09-27T22:47:14Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":144,"reactionGroups":[],"state":"CLOSED","title":"Search attribute Datetime need to support full ISO 8601 (and maybe more)","updatedAt":"2022-11-07T13:37:24Z","url":"https://github.com/temporalio/sdk-python/issues/144"}
