{"assignees":[],"author":{"id":"MDQ6VXNlcjkxMDg0MzQ1","is_bot":false,"login":"alonwengierko","name":"Alon"},"body":"### What are you really trying to do?\r\n\r\nI modified poetry file to use temporalio version 1.4.0 and then ran worker.py of your_visibility folder of the DOCUMENTATION_SAMPLES_PYTHON repository (https://github.com/temporalio/documentation-samples-python) \r\n\r\nThen I use cli command to trigger workflow  \r\n\r\ntemporal workflow start   --task-queue search-attributes-task-queue   --type GreetingWorkflow\r\n\r\nAfter doing that I get an error:\r\n\"coroutine raised StopIteration\"\r\n\r\nThis error doesn't happen for version Python SDK 1.3.0 when I trigger workflow from cli\r\n\r\n### Describe the bug\r\nI found that when you trigger a workflow who has calls to workflow.upsert_search_attributes  using cli for for Temporalio Python SDK version 1.4.0, you get error Coroutine Raised StopIteration\r\n\r\nFile \"/Users/awengierko/Documents/Projects/documentation-samples-python/.venv/lib/python3.11/site-packages/temporalio/worker/_workflow_instance.py\", line 1888, in execute_workflow\r\n    return await input.run_fn(*args)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\r\nRuntimeError: coroutine raised StopIteration\r\nFailed activation on workflow GreetingWorkflow with ID 9e14f703-b1de-4031-9213-fb43b405a660 and run ID cf74cb1b-0bb2-4d08-a711-312c3f050cfb\r\n\r\n<img width=\"1618\" alt=\"Screenshot 2023-12-08 at 21 11 10\" src=\"https://github.com/temporalio/sdk-python/assets/91084345/34b354c8-451e-450f-a006-41b5254c6c91\">\r\n<img width=\"1538\" alt=\"Screenshot 2023-12-08 at 21 11 18\" src=\"https://github.com/temporalio/sdk-python/assets/91084345/1b44a973-20a6-4762-a131-71294c423bff\">\r\n\r\n### Minimal Reproduction\r\n1. Clone repo https://github.com/temporalio/documentation-samples-python\r\n2. Update pyproject.toml to use temporalio = \"^1.4.0\" instead of temporalio = \"^1.3.0\"\r\n3. Terminal 1 -> Run worker: python worker.py\r\n4. Terminal 2 -> Trigger Workflow exeuction:  temporal workflow start   --task-queue search-attributes-task-queue   --type GreetingWorkflow\r\n5. See in Terminal 2: Error message \"coroutine raised StopIteration\"\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor: M2 Mac\r\n- Temporal Version: 1.4.0\r\n- Are you using Docker or Kubernetes or building Temporal from source? No\r\n\r\n","closedAt":"2023-12-11T13:51:47Z","comments":[{"id":"IC_kwDOGusT1c5uRpoT","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks! I believe this was just fixed in https://github.com/temporalio/sdk-python/pull/440 but not yet released. In the meantime, I recommend using typed search attributes for `upsert_search_attributes` (you should be getting a warning if you use this deprecated form). I will see if I can have the docs updated to match.\r\n\r\n(closing since the primary issue was fixed, but feel free to continue to discuss here, on the forums, or on Slack)","createdAt":"2023-12-11T13:51:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/443#issuecomment-1850120723","viewerDidAuthor":false}],"createdAt":"2023-12-09T00:25:28Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":443,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Coroutine Raised StopIteration when triggering  workflow execution from CLI for workflows which call workflow.upsert_search_attributes","updatedAt":"2023-12-11T13:51:47Z","url":"https://github.com/temporalio/sdk-python/issues/443"}
