{"assignees":[],"author":{"id":"MDQ6VXNlcjMyNzI1NjM=","is_bot":false,"login":"giuliohome","name":"Giulio"},"body":"### What are you really trying to do?\r\n\r\nThis is a follow up to [this message](https://github.com/temporalio/sdk-go/issues/1651#issuecomment-2377474385), in particular I'm simply running this official sample https://github.com/temporalio/samples-python/blob/main/hello/hello_activity_multiprocess.py\r\n\r\n\r\n### Describe the bug\r\n\r\nI see this output\r\n\r\n```\r\n(.venv) C:\\Users\\giulio365cloud\\dev-test>python multiprocessor_giulio.py\r\nHeartbeating activity on PID 5104\r\nHeartbeating activity on PID 5104\r\nHeartbeating activity on PID 5104\r\nHeartbeating activity on PID 5104\r\nHeartbeating activity on PID 5104\r\nHeartbeating activity on PID 5104\r\nResult on PID 7072: Hello, World from activity on PID 5104! and then Hello, World from activity on PID 5104!\r\n```\r\n\r\n**I would have expected to see a different PID when the activity runs the second time!**\r\n\r\n### Minimal Reproduction\r\n\r\nI have taken the official sample and simply repeated the activity execution two times inside the workflow\r\n\r\n```py\r\n@workflow.defn\r\nclass GreetingWorkflow:\r\n    @workflow.run\r\n    async def run(self, name: str) -> str:\r\n        ret1 = await workflow.execute_activity(\r\n            compose_greeting,\r\n            ComposeGreetingInput(\"Hello\", name),\r\n            start_to_close_timeout=timedelta(seconds=10),\r\n            # Always set a heartbeat timeout for long-running activities\r\n            heartbeat_timeout=timedelta(seconds=2),\r\n        )\r\n        ret2 = await workflow.execute_activity(\r\n            compose_greeting,\r\n            ComposeGreetingInput(\"Hello\", name),\r\n            start_to_close_timeout=timedelta(seconds=10),\r\n            # Always set a heartbeat timeout for long-running activities\r\n            heartbeat_timeout=timedelta(seconds=2),\r\n        )\r\n        return ret1 + \" and then \" + ret2\r\n```\r\nand I have also modified the activity to print its PID in the hello message\r\n\r\n```py\r\n@activity.defn\r\ndef compose_greeting(input: ComposeGreetingInput) -> str:\r\n    # We'll wait for 3 seconds, heartbeating in between (like all long-running\r\n    # activities should do), then return the greeting\r\n    for _ in range(0, 3):\r\n        print(f\"Heartbeating activity on PID {os.getpid()}\")\r\n        activity.heartbeat()\r\n        time.sleep(1)\r\n    return f\"{input.greeting}, {input.name} from activity on PID {os.getpid()}!\"\r\n```\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor:  Windows 11 Enterprise 16 vCPU 32 GB RAM\r\nDevice name\tWindows11Pro\r\nProcessor\tIntel(R) Xeon(R) Platinum 8370C CPU @ 2.80GHz   2.79 GHz\r\nInstalled RAM\t32.0 GB\r\nSystem type\t64-bit operating system, x64-based processor\r\n\r\n![image](https://github.com/user-attachments/assets/140d720d-a801-436b-9e77-6025f4ab1736)\r\n\r\n- Temporal Version: Latest temporal version, latest SDK version\r\ntemporal server start-dev\r\nCLI 1.1.0 (Server 1.25.0, UI 2.30.3)\r\n\r\n- Are you using Docker or Kubernetes or building Temporal from source? Nope\r\n","closedAt":"2024-09-28T11:21:52Z","comments":[{"id":"IC_kwDOGusT1c6N5TBt","author":{"login":"giuliohome"},"authorAssociation":"NONE","body":"Uhm ... I see... they need to run in parallel\r\n\r\n```\r\n@workflow.defn\r\nclass GreetingWorkflow:\r\n    @workflow.run\r\n    async def run(self, name: str) -> str:\r\n        task1 = asyncio.create_task( workflow.execute_activity(\r\n            compose_greeting,\r\n            ComposeGreetingInput(\"Hello\", name),\r\n            start_to_close_timeout=timedelta(seconds=10),\r\n            # Always set a heartbeat timeout for long-running activities\r\n            heartbeat_timeout=timedelta(seconds=2),\r\n        ))\r\n        task2 = asyncio.create_task( workflow.execute_activity(\r\n            compose_greeting,\r\n            ComposeGreetingInput(\"Hello\", name),\r\n            start_to_close_timeout=timedelta(seconds=10),\r\n            # Always set a heartbeat timeout for long-running activities\r\n            heartbeat_timeout=timedelta(seconds=2),\r\n        ) )\r\n        ret1 = await task1\r\n        ret2 = await task2\r\n        return ret1 + \" and then \" + ret2\r\n```\r\nin that case\r\n\r\n```\r\npython multiprocessor_giulio.py\r\nHeartbeating activity on PID 4952\r\nHeartbeating activity on PID 5904\r\nHeartbeating activity on PID 4952\r\nHeartbeating activity on PID 5904\r\nHeartbeating activity on PID 4952\r\nHeartbeating activity on PID 5904\r\nResult on PID 11484: Hello, World from activity on PID 4952! and then Hello, World from activity on PID 5904!\r\n```","createdAt":"2024-09-28T11:21:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/654#issuecomment-2380607597","viewerDidAuthor":false}],"createdAt":"2024-09-28T11:07:33Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":654,"reactionGroups":[],"state":"CLOSED","title":"MultiProcess executor not working as expected","updatedAt":"2024-09-30T13:08:10Z","url":"https://github.com/temporalio/sdk-python/issues/654"}
