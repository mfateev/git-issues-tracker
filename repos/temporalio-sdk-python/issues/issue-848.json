{"assignees":[],"author":{"id":"MDQ6VXNlcjIyNzg5ODUx","is_bot":false,"login":"ndtretyak","name":"Nikolay Tretyak"},"body":"### What are you really trying to do?\n\nI'm using updates to allow the workflow to proceed to the next step.\n\n### Describe the bug\n\n<!-- A clear and concise description of what the bug is. -->\n\nIf an update occurs when the workflow execution is not cached on the worker, the update is effectively \"lost\", and I need to issue another update for it to be applied.\n\n### Minimal Reproduction\n\n1. Start the worker\n2. Start  the workflow\n\n    ```\n    temporal workflow start --task-queue my-task-queue --type Workflow --workflow-id test --id-reuse-policy TerminateIfRunning\n    ```\n3. Restart the worker\n4. Execute the update\n    ```\n    temporal workflow update execute --workflow-id test --name go\n    ```\n5. Observe that the activity has not been scheduled during the update handling. Additionally, there are some debug prints in the workflow code that may help.\n\n```python\nimport asyncio\nimport concurrent.futures\nimport datetime\n\nfrom temporalio import activity\nfrom temporalio import workflow\nfrom temporalio.client import Client\nfrom temporalio.worker import Worker\n\n\n@activity.defn\nasync def job() -> None:\n    activity.logger.info(\"Activity started\")\n\n\n@workflow.defn(sandboxed=False)\nclass Workflow:\n    def _set_can_run(self, value: bool, comment: str) -> None:\n        print(\"Setting can_run to:\", value, \"comment:\", comment)\n        self.can_run = value\n\n    @workflow.update\n    def go(self) -> None:\n        self._set_can_run(True, \"update\")\n\n    @workflow.run\n    async def run(self) -> None:\n        self._set_can_run(True, \"workflow start\")\n\n        def wait_condition() -> bool:\n            print(\"Checking condition. result:\", self.can_run)\n            return self.can_run\n\n        while True:\n            await workflow.wait_condition(wait_condition)\n            await workflow.execute_activity(job, start_to_close_timeout=datetime.timedelta(seconds=5))\n            self._set_can_run(False, \"activity completed\")\n\n\nasync def main():\n    client = await Client.connect(\"localhost:7233\")\n\n    with concurrent.futures.ThreadPoolExecutor(max_workers=100) as activity_executor:\n        worker = Worker(\n            client,\n            task_queue=\"my-task-queue\",\n            workflows=[Workflow],\n          activities=[job],\n          activity_executor=activity_executor,\n        )\n    await worker.run()\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n```\n\n### Environment/Versions\n\n<!-- Please complete the following information where relevant. -->\n\n- Temporal Version: 1.27.1\n- SDK Version: 1.11.0\n\n","closedAt":"2025-06-02T20:56:00Z","comments":[{"id":"IC_kwDOGusT1c6oiad6","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"Thanks for this @ndtretyak. It does look like a bug; we're looking into it.","createdAt":"2025-04-24T13:14:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/848#issuecomment-2827593594","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6qRYYb","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"Fixed in Core in https://github.com/temporalio/sdk-core/pull/910 - Python will need Core update & release","createdAt":"2025-05-07T00:37:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/848#issuecomment-2856683035","viewerDidAuthor":false}],"createdAt":"2025-04-24T08:32:11Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":848,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Updates conflict with replay","updatedAt":"2025-06-02T20:56:00Z","url":"https://github.com/temporalio/sdk-python/issues/848"}
