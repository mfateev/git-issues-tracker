{"assignees":[],"author":{"id":"MDQ6VXNlcjE3NTY4NTQ5","is_bot":false,"login":"funkindy","name":"Alexey Trofimov"},"body":"It would be nice to have some kind of lifespan for worker instances.\r\n\r\nIn my case i need shared http client (httpx.AsyncClient) for my activities, and i now don't see a proper place to call `await client.aclose()`. ","closedAt":"2025-04-29T17:50:26Z","comments":[{"id":"IC_kwDOGusT1c6PZSw9","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Can you clarify the request a bit? A worker is running and using what it has until `run` returns (or if you're using `async with`, until that block is done). A worker's `run` does not return until it is shutdown and all activities are done (see https://github.com/temporalio/sdk-python?tab=readme-ov-file#worker-shutdown). You should add your client close after the worker `run` is complete.","createdAt":"2024-10-10T18:24:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/666#issuecomment-2405772349","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Pq8cJ","author":{"login":"funkindy"},"authorAssociation":"NONE","body":"`async with` has its own complex cleanup logic, which i have to reproduce in my scenario without context manager.\r\n\r\nWhy not to include the implementation of `__aexit__`  to some kind of `asynd def cleanup(...)`? Or maybe `worker.shutdown` is sufficient?","createdAt":"2024-10-14T08:18:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/666#issuecomment-2410399497","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6P4uW7","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Why not to include the implementation of __aexit__ to some kind of asynd def cleanup(...)? Or maybe worker.shutdown is sufficient?\r\n\r\nWorker shutdown should be sufficient. If you add your cleanup code after worker is shutdown (or after context manager is complete), that is enough to guarantee the worker isn't using things anymore. A worker lifetime is the life of its run or context manager, both will not complete while any activities are still running (neither will the shutdown call), add any cleanup after that as needed.","createdAt":"2024-10-15T14:02:31Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/666#issuecomment-2414011835","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6pQsVO","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"Closing, but feel free to keep discussing or reopen @funkindy.","createdAt":"2025-04-29T17:50:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/666#issuecomment-2839725390","viewerDidAuthor":false}],"createdAt":"2024-10-10T17:51:16Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":666,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Worker instance lifespan","updatedAt":"2025-04-29T17:50:28Z","url":"https://github.com/temporalio/sdk-python/issues/666"}
