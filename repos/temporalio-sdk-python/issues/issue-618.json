{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMjA1","is_bot":false,"login":"dandavison","name":"Dan Davison"},"body":"Ideally, the following would not happen:\r\n\r\n```python\r\n@workflow.defn\r\nclass WaitForSharedMutableStateWorkflow:\r\n    def __init__(self) -> None:\r\n        self.cond = False\r\n\r\n    @workflow.run\r\n    async def run(self):\r\n        self.cond = True\r\n        await asyncio.gather(self.coro(\"1\"), self.coro(\"2\"))\r\n\r\n    async def coro(self, id: str):\r\n        await workflow.wait_condition(lambda: self.cond)\r\n        print(f\"after wait coro {id} sees {self.cond}\")  # ❗❗ <== coro2 sees False❗\r\n        self.cond = False\r\n        await asyncio.sleep(1)\r\n        self.cond = True\r\n```\r\n\r\nCompletely eliminating the possibility would be ideal, but best-effort improvements would also be welcome.","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c6mXFRZ","author":{"login":"GSmithApps"},"authorAssociation":"MEMBER","body":"Hey @dandavison,\n\nI definitely agree on this.\n\nAs an interim code-around, it worked on my end if I replace\n\n```python\n        await asyncio.gather(self.coro(\"1\"), self.coro(\"2\"))\n```\n\nwith\n\n```python\n        for task in [self.coro(\"1\"), self.coro(\"2\")]:\n            asyncio.create_task(task)\n            await asyncio.sleep(0.0000000001)\n```\n\nOn the downside, it creates actions because it creates a temporal timer for each coro\n\nI'm curious to hear what you think!","createdAt":"2025-04-09T21:50:15Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/618#issuecomment-2791068761","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6meuBe","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"No, because the wait condition is resolved after a second which can be on another task. And even if it did work, it's not a general solution to the problem because the concern is that wait conditions _all_ wake up if the predicate is satisfied (as opposed to other SDKs that only wake up one). Whether that happens before or after a sleep is immaterial. The snippet is a trivial example showing the issue, but that's not real world code. In real world code, you just have to make sure you code for the fact that the line of code after a wait condition that may be waited on multiple times concurrently may not match the condition.","createdAt":"2025-04-10T13:34:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/618#issuecomment-2793070686","viewerDidAuthor":false}],"createdAt":"2024-08-21T12:09:17Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":618,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Improve wait_condition semantics","updatedAt":"2025-04-10T13:34:04Z","url":"https://github.com/temporalio/sdk-python/issues/618"}
