{"assignees":[],"author":{"id":"MDQ6VXNlcjUyNjY1NzY=","is_bot":false,"login":"nathanielobrown","name":"Nathaniel Brown"},"body":"### What are you really trying to do?\r\n\r\nUse `workflow.continue_as_new()` in a workflow without specifying `task_queue` or `workflow` and have those be taken from the current workflow. The docstring implies I can do this.\r\n\r\n### Describe the bug\r\n\r\nWhen these arguments are not passed, I get a log error like:\r\n```\r\ntest_continue_as_new.py::test_time_skipping_past_activity_timeout 2023-05-22T16:59:17.621391Z  WARN temporal_sdk_core::worker::workflow: Network error while completing workflow activation error=status: InvalidArgument, message: \"Missing TaskQueue.\", details: [], metadata: MetadataMap { headers: {\"content-type\": \"application/grpc\"} }\r\n```\r\nand my workflow hangs\r\n\r\n### Minimal Reproduction\r\n```python\r\nimport asyncio\r\n\r\nfrom temporalio import workflow\r\nfrom temporalio.testing import WorkflowEnvironment\r\nfrom temporalio.worker import Worker\r\n\r\nstarted_event = asyncio.Event()\r\n\r\n\r\n@workflow.defn\r\nclass Workflow:\r\n    @workflow.run\r\n    async def run(self, continue_as_new: bool):\r\n        if continue_as_new:\r\n            workflow.continue_as_new(\r\n                False,\r\n                # If these are set, test will pass:\r\n                # task_queue=workflow.info().task_queue,\r\n                # workflow=Workflow.run,\r\n            )\r\n\r\n\r\nasync def test_continue_as_new_without_workflow_or_task_queue():\r\n    task_queue = \"test\"\r\n    async with await WorkflowEnvironment.start_time_skipping() as env, Worker(\r\n        client=env.client,\r\n        task_queue=task_queue,\r\n        activities=[],\r\n        workflows=[Workflow],\r\n    ):\r\n        await env.client.execute_workflow(\r\n            Workflow.run,\r\n            True,\r\n            task_queue=task_queue,\r\n            id=\"test\",\r\n        )\r\n```\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor:M1 Mac\r\n- Temporal Version: 1.2.0\r\n","closedAt":"2023-05-22T19:10:41Z","comments":[{"id":"IC_kwDOGusT1c5c19pU","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks! Hrmm, we have a test at https://github.com/temporalio/sdk-python/blob/a4224a20189c8c8078edbc66482c31860193c1b3/tests/worker/test_workflow.py#L1284-L1328 which is passing. I will have to investigate.","createdAt":"2023-05-22T17:53:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/319#issuecomment-1557650004","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5c2d4o","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is a known issue with the time-skipping test server. See https://github.com/temporalio/sdk-java/issues/1424.\r\n\r\n(closing as duplicate)","createdAt":"2023-05-22T19:10:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/319#issuecomment-1557782056","viewerDidAuthor":false}],"createdAt":"2023-05-22T17:01:10Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":319,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Continue as new doesn't work without specifying `task_queue` and `workflow`","updatedAt":"2023-05-22T19:10:42Z","url":"https://github.com/temporalio/sdk-python/issues/319"}
