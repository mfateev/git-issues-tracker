{"assignees":[],"author":{"id":"MDQ6VXNlcjQyNjcyMDI=","is_bot":false,"login":"ClemDoum","name":"ClÃ©ment Doumouro"},"body":"### Is your feature request related to a problem? Please describe.\n\nI'm trying to implement a workflow with activities which publish their own progress:\n\n```python\n@activity.defn\nasync def process_batch(batch: list[int]) -> int:\n    info = activity.info()\n    run_id = info.workflow_run_id\n    workflow_id = info.workflow_id\n    client = activity.client()\n    activity_id = info.activity_id\n    workflow_handle = client.get_workflow_handle(workflow_id, run_id=run_id)\n    progress = partial(\n        progress_handler,\n        handle=workflow_handle,\n        run_id=run_id,\n        activity_id=activity_id,\n    )\n    total = 0\n    for n, batch_item in enumerate(batch):\n        total += batch_item\n        activity.logger.info(\"going to sleep...\")\n        await asyncio.sleep(1)\n        await progress(n / len(batch))\n    activity.logger.info(\"done sleeping !\")\n    return total\n\nasync def progress_handler(\n    progress: float,\n    handle: WorkflowHandle,\n    *,\n    activity_id: str,\n    run_id: str,\n    weight: float = 1.0,\n) -> None:\n    signal = ProgressSignal(\n        activity_id=activity_id, run_id=run_id, progress=progress, weight=weight\n    )\n    await handle.signal(\"update_progress\", signal)\n```\nthis works great for async activities but for sync / CPU-bound activities I can't access the activity client.\n\nI'm getting: `RuntimeError: No client available. The client is only available in async def activities; not in def activities. In tests you can pass a client when creating ActivityEnvironment.`\n\n### Describe the solution you'd like\n\nThis error make sense for sync activities run using a process pool executor as this will generate picking errors, however there's no reason why this should occur when we use a thread pool executor.\n","closedAt":"2025-12-16T08:51:06Z","comments":[{"id":"IC_kwDOGusT1c7aA-Jt","author":{"login":"tconley1428"},"authorAssociation":"MEMBER","body":"There is a good reason not to allow reuse of the client from within a sync activity. Because the client was created on a different event loop than the one you would be producing inside your sync activity. This potentially leads to concurrency errors since asyncio synchronization is not guaranteed across multiple threads. In this case you would either need to ensure you provide the _same_ event loop to the activity and execute the client operation on that loop, or create a new client on the new event loop. Simply providing the same client could fail in unexpected ways.","createdAt":"2025-12-15T21:29:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/1252#issuecomment-3657687661","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c7aHssC","author":{"login":"ClemDoum"},"authorAssociation":"NONE","body":"Very clear thank you for your feedback, I made the change to see if that was breaking any unit test, as I assume the only problem was with the pickling error. Understood, thanks a lot !","createdAt":"2025-12-16T08:51:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/1252#issuecomment-3659451138","viewerDidAuthor":false}],"createdAt":"2025-12-15T17:20:43Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1252,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] add client support for sync activities run by `ThreadPoolExecutor`","updatedAt":"2025-12-16T08:51:06Z","url":"https://github.com/temporalio/sdk-python/issues/1252"}
