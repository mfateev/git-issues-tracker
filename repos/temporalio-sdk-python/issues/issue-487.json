{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the solution you'd like\r\n\r\nSome users have advanced logger handlers that cannot work in sandbox mode. I think we can add a `temporalio.workflow.logger.unsafe_disable_sandbox()` call on the logger and if set, the `process` call can be wrapped in `with temporalio.workflow.unsafe.sandbox_unrestricted()` and `workflow.unsafe.imports_passed_through()`.","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c7LIQIo","author":{"login":"millerick"},"authorAssociation":"NONE","body":"Until this is implemented, would it be reasonable for users that run into issues with their logger to add the underlying logging libraries a `with_passthrough_modules()` call to suppress these types of messages?  E.g. to ignore sandbox restrictions for `structlog`?","createdAt":"2025-10-15T19:21:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/487#issuecomment-3407938088","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c7LIa6D","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Depends on how the underlying logging library is loaded and used on whether that would be enough. I would probably recommend something like:\n\n```python\nclass SandboxDisabledLoggerAdapter(workflow.LoggerAdapter):\n    def process(\n        self, msg: Any, kwargs: MutableMapping[str, Any]\n    ) -> Tuple[Any, MutableMapping[str, Any]]:\n        with temporalio.workflow.unsafe.sandbox_unrestricted():\n            with temporalio.workflow.unsafe.imports_passed_through():\n                return super().process(msg, kwargs)\n\ntemporalio.workflow.logger = SandboxDisabledLoggerAdapter(logging.getLogger(\"temporalio.workflow\"), None)\n```\n\nWhich is basically what this issue is suggesting we offer a helper for. But I just typed this here in GH issue, this would have to be tested and confirmed to work as expected.\n","createdAt":"2025-10-15T19:37:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/487#issuecomment-3407982211","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c7LLG4v","author":{"login":"millerick"},"authorAssociation":"NONE","body":"Our issues stem from formatting the record and not from processing the record.  I'll try to find a similar way to wrap the format calls in `structlog`, but adding this as a datapoint for if/when the helpers this issue represents in the SDK are implemented.\n```\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.11/logging/__init__.py\", line 1110, in emit\n    msg = self.format(record)\n          ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/logging/__init__.py\", line 953, in format\n    return fmt.format(record)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/structlog/stdlib.py\", line 1098, in format\n    ed = p(logger, meth_name, cast(EventDict, ed))\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/structlog/processors.py\", line 346, in __call__\n    return self._dumps(event_dict, **self._dumps_kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/json/__init__.py\", line 238, in dumps\n    **kw).encode(obj)\n          ^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/json/encoder.py\", line 200, in encode\n    chunks = self.iterencode(o, _one_shot=True)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/json/encoder.py\", line 258, in iterencode\n    return _iterencode(o, 0)\n           ^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/structlog/processors.py\", line 354, in _json_fallback_handler\n    from structlog.threadlocal import _ThreadLocalDictWrapper\n  File \"/usr/local/lib/python3.11/site-packages/temporalio/worker/workflow_sandbox/_importer.py\", line 442, in __call__\n    return self.current(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/temporalio/worker/workflow_sandbox/_importer.py\", line 234, in _import\n    mod = importlib.__import__(name, globals, locals, fromlist, level)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n```","createdAt":"2025-10-16T00:06:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/487#issuecomment-3408686639","viewerDidAuthor":false}],"createdAt":"2024-03-12T17:58:04Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":487,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":6}},{"content":"EYES","users":{"totalCount":2}}],"state":"OPEN","title":"[Feature Request] Allow workflow logger to opt-out of sandboxing","updatedAt":"2025-10-16T00:06:49Z","url":"https://github.com/temporalio/sdk-python/issues/487"}
