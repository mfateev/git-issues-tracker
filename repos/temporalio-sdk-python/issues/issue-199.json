{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the bug\r\n\r\nIf the first use of OpenTelemetry is inside a workflow, you can get (stack trace elided):\r\n\r\n```\r\n    return _RUNTIME_CONTEXT.attach(context)  # type:ignore\r\nAttributeError: 'NoneType' object has no attribute 'attach'\r\n```\r\n\r\nOpenTelemetry uses https://setuptools.pypa.io/en/latest/pkg_resources.html to lazily load its global runtime context. See https://github.com/open-telemetry/opentelemetry-python/blob/787e499aaadb5db6e0eb308a9fa7dca58139e44c/opentelemetry-api/src/opentelemetry/context/__init__.py#L34-L69.\r\n\r\nThe first time this is run, `pkg_resources` issues an `open()` at https://github.com/pypa/setuptools/blob/a0e8e53cecc238e3bce2247308fe7dd94114ef35/pkg_resources/__init__.py#L1635. We don't allow `open()` in a sandbox. This wasn't being triggered in unit tests because the OpenTelemetry context was being used outside of the sandbox first for client calls. But when separating worker and client (like our examples do), this shows up.\r\n\r\nEasiest fix for now is just add this to the top of the `opentelemetry` contrib Python file:\r\n\r\n```\r\nopentelemetry.context.get_current()\r\n```\r\n\r\nThis means when first imported _outside_ the sandbox, it'll lazily load instead of trying _inside_ of the sandbox.","closedAt":"2022-11-15T22:00:14Z","comments":[],"createdAt":"2022-11-14T23:09:13Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":199,"reactionGroups":[],"state":"CLOSED","title":"[Bug] OpenTelemetry sandbox issue on first load inside sandbox","updatedAt":"2022-11-15T22:00:14Z","url":"https://github.com/temporalio/sdk-python/issues/199"}
