{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the solution you'd like\r\n\r\nMay be similar to #238 but maybe not (that's more about the sandbox).\r\n\r\nIt seems when trying to debug via replayer in PyCharm, some things break that work just fine when not using PyCharm's debugger. Investigate what breaks and why. This may be due to some patching/expectations PyCharm has around asyncio that don't hold true for custom asyncio implementations. There's another issue at https://youtrack.jetbrains.com/issue/PY-64542/Asyncio-support-for-the-debugger-doesnt-work-with-pytest-asyncio.\r\n\r\nWe need to document how exactly to use breakpoints in workflows from this IDE.","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c6a67fX","author":{"login":"mnichols"},"authorAssociation":"MEMBER","body":"@cretz here is my first crack at such a doc:\n\nPython developers must take into consideration both the [sandbox](https://docs.temporal.io/develop/python/python-sdk-sandbox) and the Workflow Task Timeout for any Debugger interactions. Here are some tips to help you \"step through\" Workflow Code with a Debugger.\n\n### Debugging Workflow Code\n\nFinding problems within complex Workflow code might be aided by stepping through\nthe code as you normally would to inspect variable state, step through execution paths, etc.\n\nWorkflow code executed by a Worker does so within the bounds of a Workflow Task which is\nitself governed by a Timeout. \n* The maximum amount of time a Workflow Task can be configured to take before `Failed` is *120 seconds*. \n* The default Timeout is _10 seconds_.\n* That means you have a maximum of _two minutes_ to diagnose your code before the current Task will be failed and rescheduled.\nYou'll see a flood of error messages in your console related to these Task issues. This may not be enough time to perform your diagnosis.\n\n#### _So how can I step through my Workflow Code??_\n\nYou can get around this Task boundary by executing your code within a `Replayer`.\nThis is done by passing Workflow Execution history into the Replayer while the debugger is attached to step through the code.\nExecuted this way, there is no Task to interfere with your diagnosis.\n\n> **PyCharm** users might experience issues with `asyncio` debugging.\n> If you are having difficulty debugging with **PyCharm**, you might consider the [steps in this ticket](https://youtrack.jetbrains.com/issue/PY-57667/Asyncio-support-for-the-debugger-EXPERIMENTAL-FEATURE)\n> to solve it. The `python.debug.asyncio.repl` can be toggled within PyCharm by:\n> 1. Use Shift + Shift (Search Everywhere)\n> 2. In the popup type: Registry and press Enter\n> 3. Find \"Registry\" in the list of results and click on it.\n> 4. In the new popup find `python.debug.asyncio.repl` line and check (enable) or uncheck (disable) the respective checkbox\n> 5. Press Close.\n> 6. Restart the IDE.\n\nHere are a couple of approaches to debug Temporal Workflows with a Debugger:\n\n### The Debug Two-Step\n\nThis approach involves running first _without_ the Debugger attached to generate Workflow Execution histories.\nSubsequently, these histories can be used in the second run _with_ the Debugger attached.\nThis approach can be handy if you already have Execution histories you want to verify that failed, for example, in production.\n\n\n_First run_ (without Debugger attached)\n1. Execute the Workflow(s) and keep the Temporal Server running (if testing locally)\n\n_Second run_ (with Debugger attached)\n1. Set appropriate breakpoints in Workflow code.\n2. Fetch the related Workflow Execution History(ies) and store in a variable\n3. Pass the history into a `Replayer` with the following properties set:\n```python\nreplayer = Replayer(\n    workflows=[MyWorkflow], \n    debug_mode=True,\n    namespace='debug',\n    workflow_runner=temporalio.worker.UnsandboxedWorkflowRunner())\n```\n4. Profit.\n\n### The Debug One-Shot\n\n1. Set appropriate breakpoints in Workflow code, but this time add a `Condition` of `workflow.info().namespace == 'debug'.\n2. Run the test *with Debugger attached* that:\n   1. Executes the Workflow(s) \n   2. Fetches the related Workflow Execution History(ies) and store in a variable\n   3. Passes the history into a `Replayer` with the following properties set:\n```python\nreplayer = Replayer(\n    workflows=[MyWorkflow], \n    debug_mode=True,\n    namespace='debug',\n    workflow_runner=temporalio.worker.UnsandboxedWorkflowRunner())\n```\n3. Profit.","createdAt":"2025-01-17T20:28:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":3}}],"url":"https://github.com/temporalio/sdk-python/issues/603#issuecomment-2599139287","viewerDidAuthor":false}],"createdAt":"2024-08-06T17:50:17Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":603,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":3}},{"content":"EYES","users":{"totalCount":3}}],"state":"OPEN","title":"[Feature Request] Investigate/document how to use PyCharm debugger with workflows","updatedAt":"2025-01-17T20:28:59Z","url":"https://github.com/temporalio/sdk-python/issues/603"}
