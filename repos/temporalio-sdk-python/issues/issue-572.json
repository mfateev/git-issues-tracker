{"assignees":[],"author":{"id":"U_kgDOCZoBEQ","is_bot":false,"login":"irdbl","name":"Kevin Pham"},"body":"### What are you really trying to do?\r\n\r\nI'm trying to update a workflow with a search attribute `checkout_time` of type datetime using the python SDK. The `checkout_time` datetime search attribute exists on that particular namespace. \r\n\r\n### Describe the bug\r\n\r\n```py\r\nfrom datetime import datetime\r\nfrom temporalio import workflow\r\nfrom temporalio.common import SearchAttributeKey, SearchAttributeValue\r\n\r\nt = datetime.fromisoformat(\"2024-07-05T15:43:07.875302\" ) # <- yes, workflow is deterministic\r\nk = SearchAttributeKey.for_datetime(\"checkout_time\")\r\nu = k.value_set(t)\r\nworkflow.upsert_search_attributes([u])\r\n\r\n\r\n```\r\n\r\nResults in this worker error:\r\n\r\n2024-07-05T20:46:30.554682Z  WARN temporal_sdk_core::worker::workflow: Error while completing workflow activation error=status: InvalidArgument, message: \"BadSearchAttributes: invalid value for search attribute checkout of type Datetime: 2024-07-05T15:43:07.875302\", details: [], metadata: MetadataMap { headers: {\"content-type\": \"application/grpc\", \"server\": \"temporal\", \"date\": \"Fri, 05 Jul 2024 15:43:07 GMT\"} }\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: [Intel Mac]\r\n\r\n","closedAt":"2024-08-16T03:18:41Z","comments":[{"id":"IC_kwDOGusT1c6D-FTK","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":":+1: Unfortunately not all ISO-8601 timestamps are accepted. The Temporal server uses the Go `RFC3339Nano` format which has some incompatibilities. In this case, the time is invalid, see https://go.dev/play/p/3SzyCA_UlUK. May be able to add a `Z` at the end of the string for it to parse, we will test. https://docs.temporal.io/visibility kinda touches on the format expected for date time for the built-in attributes (we will update the docs to more clearly state the date time format in general).\r\n\r\nThanks for the report. We will look into fixing the bug for this timestamp and format string.\r\n","createdAt":"2024-07-08T13:32:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2214089930","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6D-bg0","author":{"login":"irdbl"},"authorAssociation":"CONTRIBUTOR","body":"Thank you for taking a look at it.\r\n\r\nI also noticed the python examples in the docs for SearchAttribute upserting are using the old style without types. Might be a good idea to update those to use the new style too once changes are stable.\r\n\r\nhttps://docs.temporal.io/develop/python/observability#search-attributes\r\n\r\n- https://github.com/temporalio/documentation/blob/main/sample-apps/python/your_visibility/starter_dacx.py#L16-L37\r\n- https://github.com/temporalio/documentation/blob/main/sample-apps/python/your_visibility/workflow_dacx.py#L22","createdAt":"2024-07-08T14:08:42Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2214180916","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6D-419","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Yes, we have issues opened on the documentation side to update to typed search attributes","createdAt":"2024-07-08T14:47:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2214301053","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6HTlQB","author":{"login":"irdbl"},"authorAssociation":"CONTRIBUTOR","body":"Any updates on this?","createdAt":"2024-08-05T22:57:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2270057473","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6HYGt_","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is considered a high priority and we are actively working on it, but no updates as of yet. It very likely may just be adding a `Z` to the end of the string internally, we are investigating.","createdAt":"2024-08-06T13:03:42Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2271243135","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Ip0cM","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"Hi @accupham, the issue here is that the SDK requires you to specify a timezone -- our server needs to store user timestamps with a timezone and the SDK can't assume that your timestamp refers to time in the location of the machine running the worker process.","createdAt":"2024-08-16T03:29:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2292664076","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Ip1rB","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"I've opened https://github.com/temporalio/sdk-python/issues/611 to have the SDK raise an exception with a more helpful error message -- thanks for the report!","createdAt":"2024-08-16T03:36:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/572#issuecomment-2292669121","viewerDidAuthor":false}],"createdAt":"2024-07-05T20:58:11Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":572,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Upserting datetime search attribute fails","updatedAt":"2024-08-16T03:36:19Z","url":"https://github.com/temporalio/sdk-python/issues/572"}
