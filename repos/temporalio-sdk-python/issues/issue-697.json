{"assignees":[],"author":{"id":"MDQ6VXNlcjM4ODI4NQ==","is_bot":false,"login":"yunmanger1","name":"German Ilin"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nIt is kind of an easy mistake to do in python:\r\n\r\n```\r\ntry:\r\n    raise ValueError(\"test\")\r\nexcept Exception as e:\r\n    raise e from e\r\n```\r\n\r\nThe re-raised exception will have `e.__cause__` referencing itself resulting in failure to serialize error and python sdk won't report anything resulting in retries and startToClose timeouts.\r\n\r\n### Describe the solution you'd like\r\n\r\nHandle a case  when `e.__cause__ == e` in DefaultFailureConverter. Created a dummy pull request #696\r\n\r\n### Additional context\r\n\r\nhttps://temporalio.slack.com/archives/CTT84RS0P/p1719632201314119","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c6V8ZpA","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> python sdk won't report anything\r\n\r\nI think this is the primary bug. There are situations where recursion and stack overflow can occur in serialization, and the linked PR naively only helps the case of the cause being the same as itself (but if it was two causes deep that recursed, the issue would still appear). We just need to make it clear when it happens (or any other failure serialization happens).\r\n\r\nIf we are indeed not reporting anything, we need to fix that. #685 is related when failing to build a failure.","createdAt":"2024-12-03T22:01:04Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/697#issuecomment-2515638848","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6WGFRG","author":{"login":"yunmanger1"},"authorAssociation":"NONE","body":"You are right that it doesn't solve all cycles. Not sure if your case happens in practice. What needs to happen to have an exception cycled after 2 or 3 steps?\r\n\r\nMaybe the solution could be just have a max depth of 10 let's say. During serialization you truncate too  deep stacks anyway. ","createdAt":"2024-12-04T18:07:54Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/697#issuecomment-2518176838","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6WG2iM","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I think we just need to log the failure of serializing this (assume there's a stack depth/overflow exception but is not visible due to #685)","createdAt":"2024-12-04T19:25:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/697#issuecomment-2518378636","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Yra1g","author":{"login":"Ye123459"},"authorAssociation":"NONE","body":"When handling exceptions in DefaultFailureConverter, to avoid e.__cause__ == e problems caused by reraising exceptions, you can take the following solutions:\r\n\r\nAvoid using the from statement when catching and rethrowing exceptions:\r\n\r\nReraising the exception directly without specifying from avoids the problem of __cause__ pointing to itself.\r\nCheck and reset the __cause__ attribute:\r\n\r\nAfter catching the exception, check the __cause__ attribute and reset it to None if it points to itself.\r\nCustom exception handling logic:\r\n\r\nAdd logic to DefaultFailureConverter to ensure that __cause__ does not point to itself when handling exceptions.\r\nHere is a specific code example:\r\n\r\nclass DefaultFailureConverter:\r\n    def convert(self, exception):\r\n        try:\r\n            raise exception\r\n        except Exception as e:\r\n            if e.__cause__ is e:\r\n                e.__cause__ = None\r\n            raise e","createdAt":"2024-12-25T01:00:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/697#issuecomment-2561518944","viewerDidAuthor":false}],"createdAt":"2024-12-03T21:56:44Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":697,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Handle edge case of recursive exceptions in failure converter","updatedAt":"2024-12-25T01:01:06Z","url":"https://github.com/temporalio/sdk-python/issues/697"}
