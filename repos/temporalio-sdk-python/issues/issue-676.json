{"assignees":[],"author":{"id":"MDQ6VXNlcjM4MTk3MTQ=","is_bot":false,"login":"sayevsky","name":"Slava"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\nI'm trying to use enum class to pass it to activity as an input.\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\nActivity deserializes bytes to list of chars instead of given Enum\r\n\r\n### Minimal Reproduction\r\n```\r\nfrom enum import Enum\r\n\r\nfrom temporalio.api.common.v1.message_pb2 import Payload\r\nfrom temporalio.converter import JSONPlainPayloadConverter\r\n\r\nclass SomeEnum(str, Enum):\r\n    ONE = \"one\"\r\n    TWO = \"two\"\r\n\r\n\r\n\r\nconverter = JSONPlainPayloadConverter()\r\nresult = converter.from_payload(Payload(metadata={\r\n    \"key\": b\"encoding\",\r\n    \"value\": b\"json/plain\"},\r\n    data=b\"\\\"one\\\"\"),\r\n    SomeEnum)\r\nprint(result)\r\n```\r\nOutput:\r\n```\r\n['o', 'n', 'e']\r\n```\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]\r\n- M1 Mac, though any architecture impacted\r\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version\r\nSDK version is 1.6.0\r\n- Are you using Docker or Kubernetes or building Temporal from source?\r\nNo\r\n\r\n### Additional context\r\n\r\nJSONPlainPayloadConverter deserializes IntEnum, StrEnum correctly, but it is more reliable to convert payload to any Enum\r\n\r\n<!-- Add any other context about the problem here. -->\r\n","closedAt":null,"comments":[{"id":"IC_kwDOGusT1c6RKpA2","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Per https://github.com/temporalio/sdk-python?tab=readme-ov-file#data-conversion and https://docs.temporal.io/develop/python/converters-and-encryption#payload-conversion, only `StrEnum` and `IntEnum` are supported directly. Can you extend from one of those?","createdAt":"2024-10-24T14:38:51Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2435485750","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6RRN1W","author":{"login":"sayevsky"},"authorAssociation":"NONE","body":"Hello, @cretz, thank you for the quick follow up.\r\nIs the decision by not supporting basic Enum intentional? Are there any known corner-cases that stop adding additional functionality?\r\n\r\nI can extend, but it is seems, that I need to copy-paste the whole `value_to_type` into my project. That is because types could be generic and `value_to_type` traverse the type recursively. ","createdAt":"2024-10-25T08:33:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2437209430","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6RRgRV","author":{"login":"sayevsky"},"authorAssociation":"NONE","body":"As proposal:\r\n\r\n```\r\n...\r\n# StrEnum, available in 3.11+\r\n    if sys.version_info >= (3, 11):\r\n        if inspect.isclass(hint) and issubclass(hint, StrEnum):\r\n            if not isinstance(value, str):\r\n                raise TypeError(\r\n                    f\"Cannot convert to enum {hint}, value not a string, value is {type(value)}\"\r\n                )\r\n            return hint(value)\r\n# proposal to add the code:\r\n    if inspect.isclass(hint) and issubclass(hint, Enum):\r\n        if not isinstance(value, str):\r\n            raise TypeError(\r\n                f\"Cannot convert to enum {hint}, value not a string, value is {type(value)}\"\r\n            )\r\n        return hint(value)\r\n```","createdAt":"2024-10-25T09:10:28Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2437284949","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6RTJ45","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Is the decision by not supporting basic Enum intentional?\r\n\r\nIt is because there is no clear serialization of plain `Enum`. But there is for `(str, Enum)` together so we can probably support that combo (though we, and Python, suggest using `StrEnum` now if you can). Your proposal is close, but we probably also need to also check that it's a subclass of _both_ `str` _and_ `Enum` and not just `Enum`. We'll look into adding this, thanks!","createdAt":"2024-10-25T13:00:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2437717561","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6RToUC","author":{"login":"sayevsky"},"authorAssociation":"NONE","body":"Similar enhancement for `(int, Enum)` would be nice. And if both checks do not match, then throw Exception. Because current behaviour is not obvious.\r\n\r\nThanks.","createdAt":"2024-10-25T13:52:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2437842178","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6gdW2G","author":{"login":"spacether"},"authorAssociation":"NONE","body":"Why not pickle enums into bytes for serialization? Or leverage what pydantic does? ","createdAt":"2025-03-01T07:55:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2692050310","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6gesGX","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"@spacether tangential to this ticket, but we recently added an official Pydantic data converter to the SDK: https://github.com/temporalio/sdk-python?tab=readme-ov-file#pydantic-support If you use that data converter you'll get Pydantic's enum support (which does support `(str, Enum)`).","createdAt":"2025-03-01T20:21:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/676#issuecomment-2692399511","viewerDidAuthor":false}],"createdAt":"2024-10-24T14:36:28Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":676,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Support `(str, Enum)` like `StrEnum`","updatedAt":"2025-03-01T20:21:51Z","url":"https://github.com/temporalio/sdk-python/issues/676"}
