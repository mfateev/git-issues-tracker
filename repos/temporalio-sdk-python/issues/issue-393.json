{"assignees":[],"author":{"id":"MDQ6VXNlcjE4MTEyMDA=","is_bot":false,"login":"jashandeep-sohi","name":"Jashandeep Sohi"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nI'm using a `asyncio.TaskGroup` in a workflow to launch and wait for a few activities in parallel. Happy path (seems) to work great, but when there's an exception in the `TaskGroup` async context manager, that's raised as a `ExceptionGroup` ([PEP 654](https://peps.python.org/pep-0654/)). Unfortunately, the sub-exception tracebacks are not included in the stack_trace, so it makes debugging a little harder.\r\n\r\n### Describe the solution you'd like\r\n\r\nI think this might stem from the fact you're `traceback.format_tb` ing the `__traceback__` https://github.com/temporalio/sdk-python/blob/d03f356fb65d1044e1182fdc1a4c60a432d420d8/temporalio/converter.py#L832C59-L832C59\r\n\r\nI'm wondering if it's possible to use `traceback.format_exception` to get a output similar to what the Python spits out. That seems to include the sub-exceptions as-well. What's the advantage of using one over the other?\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context or screenshots about the feature request here. -->\r\n","closedAt":"2023-10-20T12:40:06Z","comments":[{"id":"IC_kwDOGusT1c5oWypD","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> I'm wondering if it's possible to use traceback.format_exception to get a output similar to what the Python spits out. That seems to include the sub-exceptions as-well. What's the advantage of using one over the other?\r\n\r\nI believe I used `format_tb` over `format_exception` because I want just the traceback in our failure `stack_trace` field, not other exception information or multiple tracebacks.\r\n\r\nWe don't really have a concept of multiple exceptions in [our failure message](https://github.com/temporalio/api/blob/135691242e9b4ed6214a7b5e1231c1c9930ff6c8/temporal/api/failure/v1/message.proto#L81). I will discuss with the team on how best to support multiple exception stack traces, though it won't help immediately. You'll want to catch/log. But maybe we can just for `ExceptionGroup` we can use `format_exception`.\r\n\r\nThere's another problem with `ExceptionGroup` - we only fail the workflow on `FailureError` based exceptions, all others fail the task (which means suspend the workflow until a code fix is deployed to fix the unexpected error). `ActivityError` is a `FailureError` so if raised out of the workflow that will fail the workflow, but `ExceptionGroup` is not that type so it will be treated differently. So really, you'll probably need to catch the exception and re-raise as `ApplicationError` anyways, and it's at this time you can log if needed.\r\n\r\n(feel free to also come discuss details on our `#python-sdk` channel on our public Slack at https://t.mp/slack if that's easier)","createdAt":"2023-10-06T14:45:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/393#issuecomment-1750805059","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5oZDIu","author":{"login":"jashandeep-sohi"},"authorAssociation":"NONE","body":"> I believe I used `format_tb` over `format_exception` because I want just the traceback in our failure `stack_trace` field, not other exception information or multiple tracebacks.\r\n\r\nOh, I see. The Failure proto has a cause Failure, so you're keeping track of every level individually, that `format_exception` would also render if used.\r\n\r\nMy interaction with this field is mostly via the UI where it renders the traceback. As a Python developer I was expecting it to look similar to when an exception is printed by the Python interpreter to the console. And I think for the most part it does.\r\n\r\n> We don't really have a concept of multiple exceptions in [our failure message](https://github.com/temporalio/api/blob/135691242e9b4ed6214a7b5e1231c1c9930ff6c8/temporal/api/failure/v1/message.proto#L81). I will discuss with the team on how best to support multiple exception stack traces, though it won't help immediately. You'll want to catch/log. But maybe we can just for `ExceptionGroup` we can use `format_exception`.\r\n\r\nThanks!\r\n\r\n> There's another problem with `ExceptionGroup` - we only fail the workflow on `FailureError` based exceptions, all others fail the task (which means suspend the workflow until a code fix is deployed to fix the unexpected error). `ActivityError` is a `FailureError` so if raised out of the workflow that will fail the workflow, but `ExceptionGroup` is not that type so it will be treated differently. So really, you'll probably need to catch the exception and re-raise as `ApplicationError` anyways, and it's at this time you can log if needed.\r\n\r\nYup, that's what I was expecting. I don't want the `ExceptionGroup` to fail the workflow, I'd just like to be able to see the sub-exceptions' traceback in the UI  and  try to possibly fix the workflow.\r\n","createdAt":"2023-10-06T20:59:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/393#issuecomment-1751396910","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5oZSG9","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Yup, that's what I was expecting. I don't want the ExceptionGroup to fail the workflow, I'd just like to be able to see the sub-exceptions' traceback in the UI and try to possibly fix the workflow.\r\n\r\nWe should be logging it on the worker as a task failure (with log line starting with \"Failed handling activation on workflow with run ID\"). I cannot currently think of a good way to display multiple aggregate exceptions in our model today that would work well. Also the serialized failure has some size limits that could be more easily reached on aggregate exceptions with stack traces. I think for this case, the UI is not going to be better than logs for retrieving this level of detail.","createdAt":"2023-10-06T22:17:22Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/393#issuecomment-1751458237","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5pqMim","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Closing as there is nothing actionable to do here. Exception group is not serializable to a Temporal failure which is a single message w/ a single stack trace and a single cause.","createdAt":"2023-10-20T12:40:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/393#issuecomment-1772669094","viewerDidAuthor":false}],"createdAt":"2023-10-06T00:32:31Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":393,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] Support ExceptionGroup traceback","updatedAt":"2023-10-20T12:40:06Z","url":"https://github.com/temporalio/sdk-python/issues/393"}
