{"assignees":[],"author":{"id":"U_kgDOCMFNJQ","is_bot":false,"login":"slingshotsys","name":"Geoff"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nRight now the Python SDK (and possibly other Core SDKs?) only support OLTP over gRPC, but some services (like Pydantic [Logfire](https://logfire.pydantic.dev/)) require [OLTP over HTTPS](https://opentelemetry.io/docs/specs/otlp/#otlphttp)\r\n\r\nWhen trying to export metrics to these services today, I receive the following error:\r\n\r\n`OpenTelemetry metrics error occurred. Metrics exporter otlp failed with the grpc server returns error (Internal error): , detailed error message: protocol error: received message with invalid compression flag: 60 (valid flags are 0 and 1) while receiving response with status: 403 Forbidden`\r\n\r\n### Describe the solution you'd like\r\n\r\nSupport for exporting OTel Metrics to services via OLTP/HTTP.\r\n\r\n### Additional context\r\n\r\nThis would bring the Python SDK up to parity with the Go SDK and possibly others which do support HTTP.\r\n","closedAt":"2025-01-23T22:48:18Z","comments":[{"id":"IC_kwDOGusT1c6NNLMu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"That is unfortunate that such a platform doesn't support such a common OTLP approach. This is implemented in our Rust Core layer, so I have opened an issue over there to support HTTP: https://github.com/temporalio/sdk-core/issues/820. Once updated there we will apply here (may just be an `http=True` type of option on the OTel config).","createdAt":"2024-09-23T18:21:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-python/issues/647#issuecomment-2369041198","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6NOWYo","author":{"login":"samuelcolvin"},"authorAssociation":"NONE","body":"Sorry temporal, we'll try to get grpc added as soon as possible.","createdAt":"2024-09-23T20:46:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-python/issues/647#issuecomment-2369349160","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Pgshv","author":{"login":"gregbrowndev"},"authorAssociation":"NONE","body":"@slingshotvfx as a workaround, I would recommend deploying an OTEL collector which can receive grpc/http telemetry and export to Logfire via HTTP. This would be a better solution in the long run, as you ideally don't want to send telemetry directly to the backend via OTLP from your app. A collector allows you to add batching, retry/fault tolerance, and transformations to customise the metric labels. \r\n\r\nHere's a quick example in Docker Compose (not fully tested) using Grafana Alloy (I prefer it over the standard OTel collector for its UI and live debugging):\r\n\r\n<details><summary>Details</summary>\r\n<p>\r\n\r\n_docker-compose.yaml_:\r\n\r\n```yaml\r\nservices:\r\n  alloy:\r\n    image: grafana/alloy:v1.3.1\r\n    environment:\r\n      - OTLP_EXPORTER_ENDPOINT=\"https://log-fire.com/whatever\"\r\n    ports:\r\n      - \"4317:4317\" # OTLP grpc receiver\r\n      - \"4318:4318\" # OTLP http receiver\r\n      - \"12345:12345\" # Debug UI\r\n    volumes:\r\n      - alloy_gateway:/var/lib/alloy/data\r\n      - type: bind\r\n        source: ./config.alloy\r\n        target: /etc/alloy/config.alloy\r\n    command:\r\n      - \"run\"\r\n      - \"--server.http.listen-addr=0.0.0.0:12345\"\r\n      - \"--storage.path=/var/lib/alloy/data\"\r\n      - \"--stability.level=experimental\"  # enables live debug mode\r\n      - \"/etc/alloy/config.alloy\"\r\n ```\r\n\r\n_config.alloy_:\r\n\r\n```alloy\r\nlivedebugging {\r\n\t// Enable live debugging for the collector\r\n\t// See http://localhost:12345\r\n\tenabled = true\r\n}\r\n\r\notelcol.receiver.otlp \"default\" {\r\n\t// Setup OTLP receiver to accept metrics, traces, and logs from instrumented services\r\n\t// https://grafana.com/docs/alloy/latest/reference/components/otelcol/otelcol.receiver.otlp/\r\n\tgrpc {\r\n\t\tendpoint = \"0.0.0.0:4317\"\r\n\t}\r\n\r\n\thttp {\r\n\t\tendpoint = \"0.0.0.0:4318\"\r\n\t}\r\n\r\n\toutput {\r\n\t\tmetrics = [otelcol.processor.batch.input]\r\n\t\t# traces  = []\r\n\t\t# logs    = []\r\n\t}\r\n}\r\n\r\notelcol.processor.batch \"metrics\" {\r\n\t// Adds batching to metrics\r\n\t// https://grafana.com/docs/alloy/latest/reference/components/otelcol/otelcol.processor.batch/\r\n\ttimeout = \"200ms\"\r\n\r\n\toutput {\r\n\t\tmetrics = [otelcol.exporter.otlphttp.logfire.input]\r\n\t}\r\n}\r\n\r\n// Can add additional components as needed\r\n\r\notelcol.exporter.otlphttp \"logfire\" {\r\n\t// Exports telemetry to another OTLP receiver via http\r\n\t// https://grafana.com/docs/alloy/latest/reference/components/otelcol/otelcol.exporter.otlphttp/\r\n\tclient {\r\n\t\tendpoint = env(\"OTLP_EXPORTER_ENDPOINT\")\r\n\t\t// You'll likely need to configure auth / tls to push to your backend\r\n\t}\r\n}\r\n```\r\n\r\nThen you just need to configure your Python app to send telemetry to `http://alloy:4317` over grpc\r\n</p>\r\n</details> \r\n\r\n","createdAt":"2024-10-11T16:04:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/647#issuecomment-2407712879","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6ajEWy","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Would recommend this be just a simple default-false `http` boolean on `OpenTelemetryConfig`","createdAt":"2025-01-15T13:39:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/647#issuecomment-2592884146","viewerDidAuthor":false}],"createdAt":"2024-09-23T17:24:47Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":647,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] OpenTelemetry Metrics OLTP/HTTP support","updatedAt":"2025-01-23T22:48:18Z","url":"https://github.com/temporalio/sdk-python/issues/647"}
