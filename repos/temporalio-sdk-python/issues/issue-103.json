{"assignees":[{"id":"MDQ6VXNlcjIwNjM5Ng==","login":"cretz","name":"Chad Retz","databaseId":0}],"author":{"id":"MDQ6VXNlcjM1MDA2MjE=","is_bot":false,"login":"patte","name":"Patrick Recher"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nFrom https://github.com/temporalio/sdk-java/issues/1200 and https://github.com/temporalio/sdk-java/issues/1201:\r\n> Right now continueAsNew is implemented in a way that assumes that most parameters are carried over by the server if not specified on the continueAsNew request. While in fact, it's the opposite. Server doesn't carry over most parameters.\r\n\r\nIf in the following code:\r\n- raise on `iteration == 0`: The workflow is run (retried) 3 time before ending with `FAILD` (retryState: `MaximumAttemptsReached`)\r\n- raise on `iteration == 1`: The workflow runs one time successfully `Continued as New`. The next run it ends with `Failed` (retryState: `RetryPolicyNotSet`).\r\n\r\nI'd expect the workflow to retry 3 time before giving up.\r\n\r\n```python\r\nimport asyncio\r\nimport logging\r\nfrom dataclasses import dataclass\r\nfrom typing import NoReturn\r\nfrom datetime import timedelta\r\n\r\nfrom temporalio import workflow, activity\r\nfrom temporalio.client import Client\r\nfrom temporalio.worker import Worker\r\nfrom temporalio.common import RetryPolicy\r\n\r\n@dataclass\r\nclass ComposeGreetingInput:\r\n    greeting: str\r\n    name: str\r\n\r\n@activity.defn\r\nasync def compose_greeting(input: ComposeGreetingInput) -> NoReturn:\r\n    # Always raise exception\r\n    raise RuntimeError(f\"Greeting exception: {input.greeting}, {input.name}!\")\r\n\r\n\r\n@workflow.defn(name=\"LoopingWorkflow\")\r\nclass LoopingWorkflow:\r\n    @workflow.run\r\n    async def run(self, iteration: int) -> None:\r\n        if iteration == 40:\r\n            return\r\n        workflow.logger.info(\"Running workflow iteration %s\", iteration)\r\n        await asyncio.sleep(1)\r\n        \r\n        # on which iteration to raise\r\n        if (iteration == 0):\r\n            await workflow.execute_activity(\r\n                compose_greeting,\r\n                ComposeGreetingInput(\"Hello\", f\"{iteration}\"),\r\n                start_to_close_timeout=timedelta(seconds=10),\r\n                retry_policy=RetryPolicy(maximum_attempts=1),\r\n            )\r\n\r\n        workflow.continue_as_new(\r\n            iteration + 1,\r\n            #TypeError: continue_as_new() got an unexpected keyword argument 'retry_policy'\r\n            #retry_policy=RetryPolicy(maximum_attempts=3),\r\n        )\r\n\r\n\r\n\r\nasync def main():\r\n    # Enable logging for this sample\r\n    logging.basicConfig(level=logging.INFO)\r\n\r\n    # Start client\r\n    client = await Client.connect(\"localhost:7233\")\r\n\r\n    # Run a worker for the workflow\r\n    async with Worker(\r\n        client,\r\n        task_queue=\"hello-continue-as-new-task-queue\",\r\n        workflows=[LoopingWorkflow],\r\n        activities=[compose_greeting],\r\n    ):\r\n\r\n        await client.start_workflow(\r\n            \"LoopingWorkflow\",\r\n            0,\r\n            id=\"hello-continue-as-new-workflow-id\",\r\n            task_queue=\"hello-continue-as-new-task-queue\",\r\n            retry_policy=RetryPolicy(maximum_attempts=3),\r\n        )\r\n\r\n        await asyncio.Future()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(main())\r\n\r\n```\r\n\r\n### Describe the solution you'd like\r\n\r\nThe real solution might be for temporal server to carry over workflow options on continue_as_new. For the time being, we could work around it by adding `retry_policy` to `continue_as_new` (similar to `search_attributes`).  \r\n","closedAt":"2022-09-07T22:29:17Z","comments":[{"id":"IC_kwDOGusT1c5IHOYr","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks for the report! I have opened an issue to first implement this in our shared core code at https://github.com/temporalio/sdk-core/issues/372 and then we can implement in Python. I will update when complete.","createdAt":"2022-08-09T20:37:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/103#issuecomment-1209853483","viewerDidAuthor":false}],"createdAt":"2022-08-09T20:28:10Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":103,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] `retry_policy` on `continue_as_new`","updatedAt":"2022-09-07T22:29:17Z","url":"https://github.com/temporalio/sdk-python/issues/103"}
