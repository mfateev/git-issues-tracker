{"assignees":[],"author":{"id":"MDQ6VXNlcjQ4NzY4MzY1","is_bot":false,"login":"rcomesan","name":""},"body":"### What are you really trying to do?\r\n\r\nI'm trying to import a workflow defined in a module placed in a nested package.\r\n\r\n### Describe the bug\r\n\r\nIf I import my workflow using `from myapp.subpackage.workflows import MyWorkflow`, and `myapp` or `myapp.subpackage` imports non-deterministic libraries or modules that import non-deterministic libraries (e.g. httpx, torch), I get a `RuntimeError: Failed validating workflow {defn.name}`.\r\n\r\nI'm expecting only the module `myapp.subpackage.workflows.__init__.py` that contains my deterministic code/classes to be imported via the sandbox. However, it seems that modules  `myapp.__init__.py`  and  `myapp.subpackage.__init__.py` also get imported somehow, and they break the sandbox as they contain non-deterministic code unrelated to workflows. \r\n\r\n### Minimal Reproduction\r\n\r\nMy repository contains 2 main files (main_failing.py and main_working.py) that illustrate this behavior.:\r\nhttps://github.com/rcomesan/sandbox-intermediate-packages-repro/tree/main\r\n\r\n### Environment/Versions\r\n\r\n- Debian amd64\r\n- Python 3.11.2\r\n- Temporal SDK: 1.4.0\r\n - Docker image: temporalio/auto-setup:1.22.3\r\n\r\n### Additional context\r\nIf I disable the sandbox either passing sandboxed=False to the decorator or at worker construction time using an UnsandboxedWorkflowRunner this behavior no longer occurs, and I'm able to start my workers without issues.","closedAt":"2024-01-03T16:10:50Z","comments":[{"id":"IC_kwDOGusT1c5vy582","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is the proper behavior according to Python specification. From https://docs.python.org/3/reference/import.html#regular-packages:\r\n\r\n> Importing `parent.one` will implicitly execute `parent/__init__.py` and `parent/one/__init__.py`.\r\n\r\nWe use normal `importlib` behavior by intention. Closing the issue as by intention, but feel free to continue discussion here or on `#python-sdk` on Slack.","createdAt":"2024-01-03T16:10:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/453#issuecomment-1875615542","viewerDidAuthor":false}],"createdAt":"2024-01-01T23:50:48Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":453,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Parent packages of a package are automatically imported via the Sandbox","updatedAt":"2024-01-03T16:10:51Z","url":"https://github.com/temporalio/sdk-python/issues/453"}
