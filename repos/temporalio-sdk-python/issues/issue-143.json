{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### What are you really trying to do?\r\n\r\nUse this as a param:\r\n\r\n```python\r\nclass MyClass(BaseModel):\r\n   field_a: list[UUID]\r\n```\r\n\r\n### Describe the bug\r\n\r\nToday we basically just call `dict()` on this which then tries to `json.dumps` that which it can't because that is _not_ a JSON-friendly dict. Unfortunately Pydantic does not provide a way to turn a model to a JSON-friendly dict. We cannot directly return the string result of `json()` in our encoder because we need it for nested purposes (i.e. `JSONEncoder.default`, _not_ `JSONEncoder.encode` which is only called at the top level, not nested).\r\n\r\nThe best solution right now I think is to accept anything that has a callable `json` attribute and invoke it, then turn it _back_ to Python object form via `json.loads`. This is the only easy way I am aware but has an obvious performance penalty. Was also mentioned at https://stackoverflow.com/questions/65622045/pydantic-convert-to-jsonable-dict-not-full-json-string.","closedAt":"2023-02-07T22:03:44Z","comments":[{"id":"IC_kwDOGusT1c5LFpOC","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Also see https://github.com/pydantic/pydantic/discussions/4456","createdAt":"2022-09-27T16:39:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/143#issuecomment-1259770754","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5LHbve","author":{"login":"KMilhan"},"authorAssociation":"CONTRIBUTOR","body":"Maybe we can add rather optimized json implementation such as`orjson` as an additional dependency and let the users utilize it if the performance penalty is the concern?\r\nAt least in my situation, json performance penalty has way lower priority than the developer's productivity. Ofc this can vastly vary case by case.","createdAt":"2022-09-28T00:33:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/143#issuecomment-1260239838","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5LJrbR","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"We are working hard to make the SDK flexible enough to use your own dependencies but not force too many dependencies on people. If you want to use `orjson`, you can create your own payload converter. https://github.com/temporalio/samples-python/tree/main/custom_converter is an example of adding a new converter, but you can do similar except replace the default converter set when creating a composite converter to change the last converter (which is `JSONPlainPayloadConverter`) with your own.","createdAt":"2022-09-28T12:26:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/143#issuecomment-1260828369","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5NoGi_","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I am still gathering feedback on whether we accept the perf penalty of using `json()` instead of `dict()` (only to parse it back again). If Pydantic had `json_dict()` this would be no problem.\r\n\r\nUntil we either choose to support stringified JSON in models or Pydantic adds support for JSON-able dicts, a custom converter can be used.","createdAt":"2022-11-03T16:23:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/143#issuecomment-1302358207","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5N2VMp","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"After team discussion what we'll do is:\r\n\r\n* Add support for `UUID` and maybe a couple of other types at https://pydantic-docs.helpmanual.io/usage/types/, but not ambiguous ones like `datetime` (yet, even though it can be argued ISO 8601 is _close_ to universal)\r\n* Do not support `json()` from Pydantic models so we don't have to parse right back out to dict for nested use. Rather we will wait until Pydantic supports JSON-able dicts.\r\n* Add a sample with easy to take code to allow _all_ Pydantic models to work via the slower JSON string approach","createdAt":"2022-11-07T19:30:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/143#issuecomment-1306088233","viewerDidAuthor":false}],"createdAt":"2022-09-27T16:37:23Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":143,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"HEART","users":{"totalCount":1}}],"state":"CLOSED","title":"Pydantic models with nested non-JSON-friendly field types cannot be serialized","updatedAt":"2023-02-07T22:03:44Z","url":"https://github.com/temporalio/sdk-python/issues/143"}
