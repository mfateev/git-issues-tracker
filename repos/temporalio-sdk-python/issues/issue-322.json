{"assignees":[],"author":{"id":"U_kgDOB-3nvA","is_bot":false,"login":"cloud-sauce","name":""},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nI would like to have a generic container that is used as the type hint for workload and activity functions, for example,\r\n\r\n```python\r\nfrom dataclasses import dataclass\r\nfrom typing import Generic, TypeVar\r\n\r\nVariableType = TypeVar(\"VariableType\")\r\n\r\n\r\n@dataclass\r\nclass MyContainer(Generic[VariableType]):\r\n    common: int\r\n    variable: VariableType\r\n```\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\nWhen a generic container is used the following issue occurs,\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/.../.cache/pypoetry/virtualenvs/temporalio-samples-XXX-py3.10/lib/python3.10/site-packages/temporalio/worker/_activity.py\", line 350, in _run_activity\r\n    else await self._data_converter.decode(\r\n  File \"/home/.../.cache/pypoetry/virtualenvs/temporalio-samples-XXX-py3.10/lib/python3.10/site-packages/temporalio/converter.py\", line 1000, in decode\r\n    return self.payload_converter.from_payloads(payloads, type_hints)\r\n  File \"/home/.../.cache/pypoetry/virtualenvs/temporalio-samples-XXX-py3.10/lib/python3.10/site-packages/temporalio/converter.py\", line 246, in from_payloads\r\n    values.append(converter.from_payload(payload, type_hint))\r\n  File \"/home/.../.cache/pypoetry/virtualenvs/temporalio-samples-XXX-py3.10/lib/python3.10/site-packages/temporalio/converter.py\", line 508, in from_payload\r\n    obj = value_to_type(type_hint, obj, self._custom_type_converters)\r\n  File \"/home/.../.cache/pypoetry/virtualenvs/temporalio-samples-XXX-py3.10/lib/python3.10/site-packages/temporalio/converter.py\", line 1394, in value_to_type\r\n    raise TypeError(f\"Unserializable type during conversion: {hint}\")\r\nTypeError: Unserializable type during conversion: __main__.ComposeGreetingInput[int]\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\nThe error can be reproduced using the [`hello_activity`](https://github.com/temporalio/samples-python/blob/main/hello/hello_activity.py) example with the modifications,\r\n\r\n```python\r\nfrom typing import Generic, TypeVar\r\n\r\nBonusType = TypeVar(\"BonusType\")\r\n\r\n\r\n@dataclass\r\nclass ComposeGreetingInput(Generic[BonusType]):\r\n    greeting: str\r\n    name: str\r\n    bonus: BonusType\r\n\r\n\r\n# Basic activity that logs and does string concatenation\r\n@activity.defn\r\nasync def compose_greeting(input: ComposeGreetingInput[int]) -> str:\r\n    activity.logger.info(\"Running activity with parameter %s\" % input)\r\n    return f\"{input.greeting}, {input.name}! Bonus info: {input.bonus}\"\r\n\r\n\r\n# Basic workflow that logs and invokes an activity\r\n@workflow.defn\r\nclass GreetingWorkflow:\r\n    @workflow.run\r\n    async def run(self, name: str) -> str:\r\n        workflow.logger.info(\"Running workflow with parameter %s\" % name)\r\n        return await workflow.execute_activity(\r\n            compose_greeting,\r\n            ComposeGreetingInput(\"Hello\", name, 123),\r\n            start_to_close_timeout=timedelta(seconds=10),\r\n        )\r\n```\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: WSL (Ubuntu 20.04 LTS)\r\n- Temporal Version: Python SDK version `1.2.0` and services [from template](https://github.com/temporalio/docker-compose/blob/main/docker-compose-cass-es.yml) (`1.20.2`)\r\n- Are you using **Docker** or Kubernetes or building Temporal from source? (Docker compose)\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n\r\nI realize the problem could be solved by child class definitions with static type hints, ex.\r\n\r\n```python\r\n@dataclass\r\nclass IntegerGreeting(ComposeGreetingInput):\r\n    bonus: int\r\n\r\n\r\n# Basic activity that logs and does string concatenation\r\n@activity.defn\r\nasync def compose_greeting(input: IntegerGreeting) -> str:\r\n```\r\n\r\nbut it would be very nice to be able to use generic typing\r\n\r\n\r\n","closedAt":"2023-06-15T19:05:45Z","comments":[{"id":"IC_kwDOGusT1c5dGiOt","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"From the README:\r\n\r\n> Classes with generics may not have the generics properly resolved. The current implementation, similar to Pydantic, does not have generic type resolution. Users should use concrete types.\r\n\r\nIt is much too complicated to solve this with any kind of consistency.  We could resolve simple generic types, but having a bunch of rules for the user on what is and isn't allowed with generics is more difficult than disallowing. We would request you make specific non-generic concrete dataclasses for specific use cases instead of reusing/creating generic ones.","createdAt":"2023-05-24T22:12:19Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/322#issuecomment-1561994157","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5dK1tM","author":{"login":"cloud-sauce"},"authorAssociation":"NONE","body":"What about adding a flag that would *allow* generics, but only support JSON-serializable types for them? For example, `BonusType` (from above) would be restricted to `float`, `int`, `string`, or `bool`. \r\n\r\nOr is there a comment or documentation around what the underlying issue with allowing them is? Is it a problem with accessing the type hinted class in the consumer? I'm interested in better understanding the limitation, if you don't mind","createdAt":"2023-05-25T15:39:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/322#issuecomment-1563122508","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5dK4ol","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"It's not that we _couldn't_ do it, it's that there is limited benefit.\r\n\r\nThe main limitation is that such limited support adds limited value and more confusion (the next issue will be opened asking why we don't support other generic ways and so on ad infinitum). You can just as easily create specialized data classes for the few primitives needed rather than altering the SDK to support such a limited subset of generics. We also encourage people to build dataclasses specifically for Temporal use instead of trying to reuse other ones that may not have the same constraints (e.g. JSON serializable, prefer smaller in size, etc). We don't support generic activity functions or workflow classes either.\r\n\r\nIf it were hard to create non-generic forms of these models, it'd be worth implementing. Similarly if Python had a built in way to serialize dataclasses to/from JSON with generic support we'd be happy to reuse it as we do in SDK languages where that exists.","createdAt":"2023-05-25T15:48:26Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/322#issuecomment-1563134501","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5e_Cme","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Closing as intentionally unsupported (and documented as such)","createdAt":"2023-06-15T19:05:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/322#issuecomment-1593584030","viewerDidAuthor":false}],"createdAt":"2023-05-24T20:43:26Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":322,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Python generics for function type hints","updatedAt":"2023-06-15T19:05:45Z","url":"https://github.com/temporalio/sdk-python/issues/322"}
