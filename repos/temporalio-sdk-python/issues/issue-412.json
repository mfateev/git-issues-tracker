{"assignees":[],"author":{"id":"MDQ6VXNlcjQzODUzMDQz","is_bot":false,"login":"bryanlalexander","name":"Bryan Alexander"},"body":"### What are you really trying to do?\r\n\r\nI'm attempting to install `pip install temporalio` in Alpine v3.18 (Python 3.11.6). This doesn't seem to be possible given [protoc-wheel-0](https://pypi.org/project/protoc-wheel-0/) does not yet support newer versions (locked at 3.9). However, it does seem a minimal dependency that could be easily be isolated and eliminated.\r\n\r\nIs this on the roadmap for removal/deprecation?\r\n\r\n\r\n### Describe the bug\r\n\r\n```console\r\nERROR: Could not find a version that satisfies the requirement protoc-wheel-0 (from versions: none)\r\nERROR: No matching distribution found for protoc-wheel-0\r\n```\r\n\r\n\r\n```console\r\nCollecting temporalio (from -r requirements.txt (line 1))\r\n  Downloading temporalio-1.3.0.tar.gz (944 kB)\r\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 944.6/944.6 kB 19.6 MB/s eta 0:00:00\r\n  Installing build dependencies: started\r\n  Installing build dependencies: finished with status 'error'\r\n  error: subprocess-exited-with-error\r\n  \r\n  × pip subprocess to install build dependencies did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [17 lines of output]\r\n      Collecting poetry-core>=1.0.0\r\n        Obtaining dependency information for poetry-core>=1.0.0 from https://files.pythonhosted.org/packages/99/bc/058b8ff87871fce6615ad032d62c773272f243266b110f7b86d146cf78d8/poetry_core-1.8.1-py3-none-any.whl.metadata\r\n        Downloading poetry_core-1.8.1-py3-none-any.whl.metadata (3.5 kB)\r\n      Collecting setuptools\r\n        Obtaining dependency information for setuptools from https://files.pythonhosted.org/packages/bb/26/7945080113158354380a12ce26873dd6c1ebd88d47f5bc24e2c5bb38c16a/setuptools-68.2.2-py3-none-any.whl.metadata\r\n        Downloading setuptools-68.2.2-py3-none-any.whl.metadata (6.3 kB)\r\n      Collecting wheel\r\n        Obtaining dependency information for wheel from https://files.pythonhosted.org/packages/fa/7f/4c07234086edbce4a0a446209dc0cb08a19bb206a3ea53b2f56a403f983b/wheel-0.41.3-py3-none-any.whl.metadata\r\n        Downloading wheel-0.41.3-py3-none-any.whl.metadata (2.2 kB)\r\n      Collecting setuptools-rust\r\n        Obtaining dependency information for setuptools-rust from https://files.pythonhosted.org/packages/e0/34/d88a7ceb193fbcee6c8992d1b1e33ed20361027e07fea1676efc45ec7a43/setuptools_rust-1.8.1-py3-none-any.whl.metadata\r\n        Downloading setuptools_rust-1.8.1-py3-none-any.whl.metadata (9.4 kB)\r\n      ERROR: Could not find a version that satisfies the requirement protoc-wheel-0 (from versions: none)\r\n      ERROR: No matching distribution found for protoc-wheel-0\r\n      \r\nNotice:       [notice] A new release of pip is available: 23.2.1 -> 23.3.1\r\nNotice:       [notice] To update, run: pip install --upgrade pip\r\n      [end of output]\r\n  \r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\r\n\r\n× pip subprocess to install build dependencies did not run successfully.\r\n│ exit code: 1\r\n╰─> See above for output.\r\n\r\nnote: This error originates from a subprocess, and is likely not a problem with pip.\r\n\r\nNotice:  A new release of pip is available: 23.2.1 -> 23.3.1\r\nNotice:  To update, run: pip install --upgrade pip\r\n```\r\n\r\n\r\n### Minimal Reproduction\r\n\r\n`repro.dockerfile`\r\n```Dockerfile\r\nFROM public.ecr.aws/docker/library/alpine:latest\r\n\r\nRUN apk update && apk add --no-cache python3 py3-pip\r\n\r\nRUN pip3 install temporalio\r\n```\r\n`docker build -f repro.dockerfile .`\r\n\r\n\r\n### Environment/Versions\r\n\r\n|program|version|\r\n|-------|-------|\r\n|Alpine|3.18|\r\n|Python|3.11.6|\r\n|pip|23.1.2|\r\n","closedAt":"2024-06-10T18:13:16Z","comments":[{"id":"IC_kwDOGusT1c5q2XMk","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"What happens on musl-based platforms is that your system attempts to rebuild the wheel from scratch. We don't expect runtime users to have this, it is a dev dependency. You're also going to have to have Rust and protoc on the path and everything else that comes with building this project since we don't pre-build a musl wheel.\r\n\r\nWe do require this dependency for proto generation to put `protoc` on the `PATH`, but I'm ok requiring it on the `PATH` already since we do for building the Rust part anyways. So we can probably remove this dev dependency (or make it optional), but you're still going to have to have certain things installed when building on an environment we don't prebuild a wheel for.","createdAt":"2023-11-03T15:20:49Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-1792635684","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5q3QmZ","author":{"login":"bryanlalexander"},"authorAssociation":"NONE","body":"This seems to be perfectly reasonable to me, this will give those without a choice a path forward. I will move this job onto a debian-based distro for now. Will musl be supported in the future with this sdk?","createdAt":"2023-11-03T17:40:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-1792870809","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5q3bBu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I am unsure whether it will be supported in the future, but for now (as with windows arm, 32-bit, etc) it requires a custom build","createdAt":"2023-11-03T18:12:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-1792913518","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5q3eDn","author":{"login":"bryanlalexander"},"authorAssociation":"NONE","body":"Sounds good, thanks for the help!","createdAt":"2023-11-03T18:19:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-1792925927","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c59MCA1","author":{"login":"Carnewal"},"authorAssociation":"NONE","body":"> So we can probably remove this dev dependency (or make it optional), but you're still going to have to have certain things installed when building on an environment we don't prebuild a wheel for.\r\n\r\nI'm running into a similar issue, do you have any news with regards to this, any way to circumvent this?\r\n\r\n```\r\n > [service 7/8] RUN poetry install --without dev:                                                                                                                                                        \r\n1.643 Skipping virtualenv creation, as specified in config file.                                                                                                                                                               \r\n2.530 Installing dependencies from lock file                                                                                                                                                                                   \r\n3.263                                                                                                                                                                                                                          \r\n3.264 Package operations: 38 installs, 0 updates, 0 removals                                                                                                                                                                   \r\n3.264 \r\n...\r\n...\r\n25.12   - Installing temporalio (1.6.0)\r\n25.19   - Installing uvloop (0.19.0)\r\n32.92 \r\n32.92   ChefInstallError\r\n32.92 \r\n32.92   Failed to install poetry-core>=1.0.0, setuptools, wheel, setuptools-rust, protoc-wheel-0.\r\n32.92   \r\n32.92   Output:\r\n32.92   Updating dependencies\r\n32.92   Resolving dependencies...\r\n32.92   \r\n32.92   Package operations: 6 installs, 0 updates, 0 removals\r\n32.92   \r\n32.92     - Installing semantic-version (2.10.0)\r\n32.92     - Installing setuptools (69.5.1)\r\n32.92     - Installing poetry-core (1.9.0)\r\n32.92     - Installing protoc-wheel-0 (25.3)\r\n32.92     - Installing setuptools-rust (1.9.0)\r\n32.92     - Installing wheel (0.43.0)\r\n32.92   \r\n32.92     RuntimeError\r\n32.92   \r\n32.92     Unable to find installation candidates for protoc-wheel-0 (25.3)\r\n32.92   \r\n32.92     at /usr/local/lib/python3.12/site-packages/poetry/installation/chooser.py:74 in choose_for\r\n32.92          70│ \r\n32.92          71│             links.append(link)\r\n32.92          72│ \r\n32.92          73│         if not links:\r\n32.92       →  74│             raise RuntimeError(f\"Unable to find installation candidates for {package}\")\r\n32.92          75│ \r\n32.92          76│         # Get the best link\r\n32.92          77│         chosen = max(links, key=lambda link: self._sort_key(package, link))\r\n32.92          78│ \r\n32.92   \r\n32.92   Cannot install protoc-wheel-0.\r\n32.92   \r\n32.92   \r\n32.92   \r\n32.92   Error:\r\n32.92   \r\n32.93 \r\n32.93   at /usr/local/lib/python3.12/site-packages/poetry/installation/chef.py:102 in install\r\n32.95        98│             InstalledRepository.load(self._env),\r\n32.95        99│         )\r\n32.95       100│         installer.update(True)\r\n32.95       101│         if installer.run() != 0:\r\n32.95     → 102│             raise ChefInstallError(requirements, io.fetch_output(), io.fetch_error())\r\n32.95       103│ \r\n32.95       104│ \r\n32.95       105│ class Chef:\r\n32.95       106│     def __init__(\r\n32.95 \r\n32.95 Cannot install build-system.requires for temporalio.\r\n32.95 \r\n------\r\n```\r\n\r\nMoving to python-slim images removes the error but alpine would be preferred","createdAt":"2024-05-08T10:53:10Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2100305973","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c59M8Dn","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I think this happens because we don't have a prebuilt musl wheel and `protoc-wheel-0` doesn't either. I am not aware of a way to circumvent this at this time short of removing the dev dependency before building. I am reopening this issue to see if it's reasonable for us to remove this dependency (e.g. maybe put it behind a \"extra\" or use `protoc` on the `PATH` more directly).","createdAt":"2024-05-08T13:10:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2100543719","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5_W6dj","author":{"login":"ymandge"},"authorAssociation":"NONE","body":"I have same issue when I try to install Temporal SDK on FreeBSD\r\n\r\n`# python -m pip install temporalio\r\nCollecting temporalio\r\n  Using cached temporalio-1.6.0.tar.gz (1.0 MB)\r\n  Installing build dependencies ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  × pip subprocess to install build dependencies did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [10 lines of output]\r\n      Collecting poetry-core>=1.0.0\r\n        Using cached poetry_core-1.9.0-py3-none-any.whl.metadata (3.5 kB)\r\n      Collecting setuptools\r\n        Using cached setuptools-70.0.0-py3-none-any.whl.metadata (5.9 kB)\r\n      Collecting wheel\r\n        Using cached wheel-0.43.0-py3-none-any.whl.metadata (2.2 kB)\r\n      Collecting setuptools-rust\r\n        Using cached setuptools_rust-1.9.0-py3-none-any.whl.metadata (9.3 kB)\r\n      ERROR: Could not find a version that satisfies the requirement protoc-wheel-0 (from versions: none)\r\n      ERROR: No matching distribution found for protoc-wheel-0\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\r\n\r\n× pip subprocess to install build dependencies did not run successfully.\r\n│ exit code: 1\r\n╰─> See above for output.\r\n\r\nnote: This error originates from a subprocess, and is likely not a problem with pip.`","createdAt":"2024-05-29T07:22:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2136713059","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5_ZpTw","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"You can probably remove the https://github.com/temporalio/sdk-python/blob/afadc15ba74d6101109316fd24a6747e8a558187/pyproject.toml#L50 dependency and rebuild. We need to remove this dependency ourselves or make it optional (we will look into doing this). It's only for letting us do proto generation which is not needed at build time.","createdAt":"2024-05-29T13:33:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2137429232","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5_gVD0","author":{"login":"ymandge"},"authorAssociation":"NONE","body":"Hi @cretz,\r\n\r\nAfter removing the above line, I was successfully able to build the dependencies using \"poetry install --no-root --all-extras\" command  But when I try to build the release build using \"poetry build\" command , I'm getting the following errors, \r\n\r\n`\r\n# poetry build\r\nPreparing build environment with build-system requirements poetry-core>=1.0.0, setuptools, wheel, setuptools-rust, protoc-wheel-0\r\n\r\nCommand ['/tmp/tmpfe6rso36/.venv/bin/python', '/usr/local/lib/python3.8/site-packages/virtualenv/seed/wheels/embed/pip-24.0-py3-none-any.whl/pip', 'install', '--disable-pip-version-check', '--ignore-installed', '--no-input', 'poetry-core>=1.0.0', 'setuptools', 'wheel', 'setuptools-rust', 'protoc-wheel-0'] errored with the following return code 1\r\n\r\nOutput:\r\nCollecting poetry-core>=1.0.0\r\n  Using cached poetry_core-1.9.0-py3-none-any.whl.metadata (3.5 kB)\r\nCollecting setuptools\r\n  Using cached setuptools-70.0.0-py3-none-any.whl.metadata (5.9 kB)\r\nCollecting wheel\r\n  Using cached wheel-0.43.0-py3-none-any.whl.metadata (2.2 kB)\r\nCollecting setuptools-rust\r\n  Using cached setuptools_rust-1.9.0-py3-none-any.whl.metadata (9.3 kB)\r\nERROR: Could not find a version that satisfies the requirement protoc-wheel-0 (from versions: none)\r\nERROR: No matching distribution found for protoc-wheel-0\r\n`\r\n\r\nFyi - I'm referring below doc \r\n\r\nhttps://github.com/temporalio/sdk-python?tab=readme-ov-file#development:~:text=written%20in%20Rust.-,Building,-Prepare\r\n\r\nfor building the Temporal Python SDK on FreeBSD.\r\n\r\n\r\n","createdAt":"2024-05-30T09:47:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2139181300","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5_iDef","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"To remove a dependency with Poetry, you it needs to be removed from toml and lock file. `poetry remove` command can probably do this.","createdAt":"2024-05-30T14:05:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2139633567","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6APWH4","author":{"login":"ymandge"},"authorAssociation":"NONE","body":"Hey everyone, fyi, I was able to build and install the Temporal Python SDK on FreeBSD by removing the protoc-wheel-0 and adding the protobuf package. Thank you Temporal Team for your prompt help :)\r\n\r\n#protoc-wheel-0 = \"^21.1\" ---> remove this line\r\nprotobuf = \"^4.25.3\" ---> add this one","createdAt":"2024-06-06T06:30:20Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2151506424","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6JsEvu","author":{"login":"hansraj1999"},"authorAssociation":"NONE","body":" Using cached temporalio-1.7.0.tar.gz (1.3 MB)\r\nInstalling build dependencies ... error\r\n error: subprocess-exited-with-error\r\n  × pip subprocess to install build dependencies did not run successfully.\r\n │ exit code: 1\r\n ╰─> [10 lines of output]\r\nCollecting poetry-core>=1.0.0\r\nUsing cached poetry_core-1.9.0-py3-none-any.whl.metadata (3.5 kB)\r\nCollecting setuptools\r\nUsing cached setuptools-73.0.1-py3-none-any.whl.metadata (6.6 kB)\r\n Collecting wheel\r\nUsing cached wheel-0.44.0-py3-none-any.whl.metadata (2.3 kB)\r\nCollecting setuptools-rust\r\nUsing cached setuptools_rust-1.10.1-py3-none-any.whl.metadata (9.2 kB)\r\nERROR: Could not find a version that satisfies the requirement protoc-wheel-0 (from versions: none)\r\n ERROR: No matching distribution found for protoc-wheel-0\r\nend of output]\r\n\r\n note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\r\n\r\nbase image python 3.11-alpine3.16\r\ngetting this error while running python -m pip install temporalio command","createdAt":"2024-08-26T11:58:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2310032366","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6JsR6-","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I see an issue was opened at https://github.com/temporalio/sdk-python/issues/622 and a new Slack thread was started. No need to double/triple post.","createdAt":"2024-08-26T12:25:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/412#issuecomment-2310086334","viewerDidAuthor":false}],"createdAt":"2023-11-02T21:14:19Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":412,"reactionGroups":[],"state":"CLOSED","title":"[Bug] protoc-wheel-0 dev dependency causing issues when building on musl-based distros like Alpine","updatedAt":"2024-08-26T12:25:57Z","url":"https://github.com/temporalio/sdk-python/issues/412"}
