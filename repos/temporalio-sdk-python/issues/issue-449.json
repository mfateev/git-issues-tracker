{"assignees":[],"author":{"id":"MDQ6VXNlcjY4Mzg5ODI=","is_bot":false,"login":"Holi0317","name":"Hollis Wu"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nImplement otel tracing for our workflows, where most are triggered by temporal schedule.\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\nTrace information is not generated and propagated for scheduled workflow executions.\r\n\r\n### Minimal Reproduction\r\n\r\nhttps://github.com/Holi0317/temporal-bugreport/tree/py-schedule-tracing\r\n\r\n1. Run `poetry install`\r\n2. Start jaeger with following snippet:\r\n```bash\r\ndocker run -d --name jaeger \\\r\n  -e COLLECTOR_OTLP_ENABLED=true \\\r\n  -p 16686:16686 \\\r\n  -p 4317:4317 \\\r\n  -p 4318:4318 \\\r\n  jaegertracing/all-in-one:latest\r\n```\r\n3. Run `poetry run python temporal_tracing/worker.py` to start the worker\r\n4. Run `poetry run python temporal_tracing/starter.py` to run the workflow once by manual invoke\r\n5. Run `poetry run python temporal_tracing/scheduler.py` to schedule workflow execution. Wait til a minute passed and there should be execution result of scheduled execution\r\n\r\nIf the workflow is scheduled, jaeger shows 2 distinct traces with different trace ID shown in the console, each only with `RunActivity:compose_greeting` in it\r\n\r\n```\r\nWorker started, ctrl+c to exit\r\nHello in activity. Let's check the traces b69e29b63117d84f98d1095948520fd3 55c467efaf77c85d\r\nHello in activity. Let's check the traces daea5868fe257f559621af68d9bd869d 66f6fc4a8d938155\r\n```\r\n\r\n![SCR-20231214-tpaa](https://github.com/temporalio/sdk-python/assets/6838982/d5d77ce5-4eb2-4791-9576-22d4c7fef514)\r\n\r\nIf the workflow is invoked manually, jaeger shows a single trace that looks not broken. And the trace ID are the same across activities:\r\n\r\n```\r\nWorker started, ctrl+c to exit\r\nHello in activity. Let's check the traces 3fd71755262b64b3bc6097d93f419822 cb8aca4ed13cfc11\r\nHello in activity. Let's check the traces 3fd71755262b64b3bc6097d93f419822 598ecfcfb4157a7e\r\n```\r\n\r\n![SCR-20231214-tqpo](https://github.com/temporalio/sdk-python/assets/6838982/4376c7e0-514f-4973-825b-9316b94998e0)\r\n![SCR-20231214-tqqa](https://github.com/temporalio/sdk-python/assets/6838982/94aefb43-2a1b-4706-ae47-0e29a742df2a)\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: M1 Mac\r\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version: Temporal version 0.10.7 (server 1.22.2) (ui 2.21.3). SDK 1.4.0\r\n- Are you using Docker or Kubernetes or building Temporal from source? Temporal dev server from CLI\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n\r\nKinda relates to https://github.com/temporalio/sdk-python/issues/362.\r\n\r\nRelated slack thread: https://temporalio.slack.com/archives/CTT84RS0P/p1702589499220879 (Issue is described above and the message did not provide more context. Not going to copy-paste the message here)","closedAt":"2024-01-03T21:17:38Z","comments":[{"id":"IC_kwDOGusT1c5uvy8S","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Seems like we did in Go. Missing in all other SDKs.","createdAt":"2023-12-15T15:02:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/449#issuecomment-1858023186","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5uv2Ys","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Mentioned in Slack, but basically only user-controlled clients can create the initial spans for workflows when starting workflows. We can't know what tracer or tracing framework a user is using to create the span for them when we start the workflow server side. We don't create parentless spans on the worker side if there is no parent span coming from the client side because it would be a bunch of orphans, but maybe we can support orphaned worker-side spans or maybe we can support some new mechanism to attach start-workflow headers on first task. The SDK team will discuss options here.","createdAt":"2023-12-15T15:12:06Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/449#issuecomment-1858037292","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5v0T0g","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Separate issue opened. This will be fixed in #454.","createdAt":"2024-01-03T21:16:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/449#issuecomment-1875983648","viewerDidAuthor":false}],"createdAt":"2023-12-15T03:47:22Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":449,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Scheduled workflow did not receive OpenTelemetry tracing","updatedAt":"2024-01-03T21:17:38Z","url":"https://github.com/temporalio/sdk-python/issues/449"}
