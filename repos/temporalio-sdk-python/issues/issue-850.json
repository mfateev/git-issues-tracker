{"assignees":[],"author":{"id":"MDQ6VXNlcjY4Mjc5MjI=","is_bot":false,"login":"brandonchinn178","name":"Brandon Chinn"},"body":"### What are you really trying to do?\n\n*Note: this issue came about because we implemented our own `from_payload` from scratch. I just rewrote the code to reuse JSONPlainPayloadConverter and just define our own `custom_type_converters` instead of reimplementing the whole thing. So this doesn't affect us anymore, but it's still a confusing error to get*\n\nWe're defining our own custom `from_payload` function that deserializes according to the `type_hint`. If the `type_hint` isn't supported, we throw an error like\n```py\nraise ValueError(f\"{val} does not match {type_hint}\")\n```\n\nWhen using a dataclass with a `datetime` field, this errors with\n```\nTypeError: descriptor '__format__' for 'datetime.date' objects doesn't apply to a 'str' object\n```\n\nRelated: #301\n\n### Describe the bug\n\nNormally, running\n```py\nfrom datetime import datetime\nformat(datetime, \"\")\n```\nwill desugar as `type(datetime).__format__(datetime, \"\")`, where `type(datetime)` is `type` and `type.__format__` just calls `str()`.\n\nBut when `datetime` is a `_RestrictedProxy`, `format(proxy_datetime, \"\")` will run `_RestrictedProxy.__format__(proxy_datetime, \"\")`, which will run `real_datetime.__format__(\"\")`, which throws the above error.\n\nCurrent workaround is to explicitly convert to str like `f\"{type_hint!s}\"`, but the error is very confusing\n\n### Minimal Reproduction\n\n<!-- \nModify our hello world templates to demonstrate:\n\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\n- Go: https://github.com/temporalio/money-transfer-project-template-go\n- Java: https://github.com/temporalio/money-transfer-project-template-java\n- PHP: https://github.com/temporalio/samples-php#samples\n-->\n\n### Environment/Versions\n\n<!-- Please complete the following information where relevant. -->\n\n- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version\n- Are you using Docker or Kubernetes or building Temporal from source?\n\n### Additional context\n\n<!-- Add any other context about the problem here. -->\n","closedAt":"2025-04-27T03:28:13Z","comments":[{"id":"IC_kwDOGusT1c6o2y19","author":{"login":"brandonchinn178"},"authorAssociation":"NONE","body":"Whoops I guess this was fixed in 1.10\nhttps://github.com/temporalio/sdk-python/pull/757#discussion_r1949629666\n\nSorry, we're on an old version because we're still on Python 3.8. Didn't think to check newer versions.","createdAt":"2025-04-27T03:28:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/850#issuecomment-2832936317","viewerDidAuthor":false}],"createdAt":"2025-04-26T18:53:23Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":850,"reactionGroups":[],"state":"CLOSED","title":"[Bug] _RestrictedProxy does not invoke __format__ correctly when called on class","updatedAt":"2025-04-27T03:28:14Z","url":"https://github.com/temporalio/sdk-python/issues/850"}
