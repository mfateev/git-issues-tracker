{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMjA1","is_bot":false,"login":"dandavison","name":"Dan Davison"},"body":"Currently, workflow cancellation does not result in cancellation of in-progress signal/update handler executions.\r\n\r\nFor example, consider the case of update and see the sample below: the client waiting on the update gets an exception, but the exception is `workflow execution already completed`. This ticket calls for that exception to inform the client that the update was canceled due to cancellation of the workflow.\r\n\r\nDoing this for signal handlers would be backwards-incompatible and hence will need to use an SDK workflow logic flag.\r\n\r\n```python\r\n@workflow.defn\r\nclass UpdateCancellationWorkflow:\r\n    def __init__(self) -> None:\r\n        self.non_terminating_operation_has_started = False\r\n\r\n    @workflow.run\r\n    async def run(self) -> str:\r\n        await workflow.wait_condition(lambda: False)\r\n        return \"unreachable\"\r\n\r\n    @workflow.update\r\n    async def wait_until_non_terminating_operation_has_started(self) -> None:\r\n        await workflow.wait_condition(\r\n            lambda: self.non_terminating_operation_has_started\r\n        )\r\n\r\n    @workflow.update\r\n    async def non_terminating_operation(self) -> str:\r\n        self.non_terminating_operation_has_started = True\r\n        await workflow.wait_condition(lambda: False)\r\n        return \"unreachable\"\r\n\r\n\r\nasync def test_update_cancellation(client: Client):\r\n    async with new_worker(client, UpdateCancellationWorkflow) as worker:\r\n        wf_handle = await client.start_workflow(\r\n            UpdateCancellationWorkflow.run,\r\n            id=str(uuid.uuid4()),\r\n            task_queue=worker.task_queue,\r\n        )\r\n        # Asynchronously run an update that will never complete\r\n        non_terminating_update_task = asyncio.create_task(\r\n            wf_handle.execute_update(\r\n                UpdateCancellationWorkflow.non_terminating_operation\r\n            )\r\n        )\r\n        print(\"wait until handler started...\")\r\n        # Wait until we know the update handler has started executing\r\n        await wf_handle.execute_update(\r\n            UpdateCancellationWorkflow.wait_until_non_terminating_operation_has_started\r\n        )\r\n        print(\"cancel the workflow\")\r\n        await wf_handle.cancel()\r\n        print(\"await non_terminating_update_task...\")\r\n        await non_terminating_update_task\r\n```","closedAt":"2025-01-07T20:38:24Z","comments":[],"createdAt":"2024-07-09T18:21:34Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":575,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Workflow cancellation should cancel handler executions","updatedAt":"2025-01-07T20:38:24Z","url":"https://github.com/temporalio/sdk-python/issues/575"}
