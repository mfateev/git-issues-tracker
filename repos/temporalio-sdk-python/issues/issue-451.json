{"assignees":[],"author":{"id":"MDQ6VXNlcjIyNzg5ODUx","is_bot":false,"login":"ndtretyak","name":"Nikolay Tretyak"},"body":"### Describe the bug\r\n\r\nAdding new SearchAttribute using `workflow.upsert_search_attribute` fails with the `StopIteration` error [here](https://github.com/temporalio/sdk-python/blob/6f966c7ca59d01c02243561d186867e199f252a6/temporalio/worker/_workflow_instance.py#L1245) since this list contains only previously set attributes.\r\n\r\nAdding new SearchAttribute via new typed API raises the same error [here](https://github.com/temporalio/sdk-python/blob/6f966c7ca59d01c02243561d186867e199f252a6/temporalio/worker/_workflow_instance.py#L1287).\r\n\r\n### Minimal Reproduction\r\n\r\nStart this workflow without `SomeKey` in the initial SearchAttributes set.\r\n\r\n```\r\n@workflow.defn\r\nclass TestWorkflow:\r\n    @workflow.run\r\n    async def run(self):\r\n        workflow.upsert_search_attributes({\r\n            \"SomeKey\": [True],\r\n        })\r\n```\r\n\r\n### Environment/Versions\r\n\r\nWorks fine in SDK 1.3.0 but fails in 1.4.0\r\n","closedAt":"2023-12-21T11:11:29Z","comments":[{"id":"IC_kwDOGusT1c5vOfyi","author":{"login":"ndtretyak"},"authorAssociation":"CONTRIBUTOR","body":"Fixed in https://github.com/temporalio/sdk-python/pull/440","createdAt":"2023-12-21T11:11:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/451#issuecomment-1866071202","viewerDidAuthor":false}],"createdAt":"2023-12-21T10:45:47Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":451,"reactionGroups":[],"state":"CLOSED","title":"upsert_search_attribute does not insert new attributes","updatedAt":"2023-12-21T11:11:30Z","url":"https://github.com/temporalio/sdk-python/issues/451"}
