{"assignees":[],"author":{"id":"U_kgDOB4KbQQ","is_bot":false,"login":"TheCodeWrangler","name":"Nathan Price"},"body":"Currently the default binning for activity metrics are top out at 60 seconds.  This limits my observability into activities which might take a long time or even take more than 60 seconds on P99 metrics.\n\nI would like to have a method of specifying a desired binning strategy on activity metrics.\n","closedAt":"2025-04-21T15:43:43Z","comments":[{"id":"IC_kwDOGusT1c6gGX4n","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Yes, now that https://github.com/temporalio/sdk-core/pull/844 is available, we can do this here too. I have changed the title.","createdAt":"2025-02-26T19:42:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/777#issuecomment-2686025255","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6gN8JV","author":{"login":"TheCodeWrangler"},"authorAssociation":"CONTRIBUTOR","body":"Any estimate on a timeline?  Is this something I could help speed along with a PR?\n\nAs best I can tell (though I am not very familiar with rust) the sdk-core binding accepts `histogram_bucket_overrides`\n\nSo possibly just python updates in `runtime.py` \n\n```python\n@dataclass(frozen=True)\nclass PrometheusConfig:\n    \"\"\"Configuration for Prometheus metrics endpoint.\"\"\"\n\n    bind_address: str\n    counters_total_suffix: bool = False\n    unit_suffix: bool = False\n    durations_as_seconds: bool = False\n    histogram_bucket_overrides: dict[str, list[float]] | None = None # New property\n\n    def _to_bridge_config(self) -> temporalio.bridge.runtime.PrometheusConfig:\n        return temporalio.bridge.runtime.PrometheusConfig(\n            bind_address=self.bind_address,\n            counters_total_suffix=self.counters_total_suffix,\n            unit_suffix=self.unit_suffix,\n            durations_as_seconds=self.durations_as_seconds,\n            histogram_bucket_overrides=self.histogram_bucket_overrides or {}, # New arg\n        )\n```\n\nI am pretty naive on what might be involved here though.","createdAt":"2025-02-27T13:44:24Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/777#issuecomment-2688008789","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6gOhDR","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"There is no estimate on timeline, but it is on the near-term backlog since it was recently implemented on our Core side. Yes what you have there is mostly correct and we definitely welcome PRs if you want to tackle it (will want a test to confirm it works for built-in and user-defined histograms too, which is usually just as simple as making an HTTP call to the Prometheus endpoint and checking contents).","createdAt":"2025-02-27T14:40:29Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/777#issuecomment-2688159953","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6gorSN","author":{"login":"TheCodeWrangler"},"authorAssociation":"CONTRIBUTOR","body":"I took a stab in a PR.\nhttps://github.com/temporalio/sdk-python/pull/781\n\nThis was branched off of 1.10.0 tag because I was not able to get `uv build` to succeed on the main branch, but was able to get the poetry build working on the tag.  This limited me from being able to compile and test cahnges on the main.\n\nWas able to get a test to work and confirm that custom histogram binning worked for a custom metric BUT was not seeing it have an effect on the workflow end-to-end latency.  This has me a bit nervoous that the update to workflow or activity binning (which is all i actually care about at the moment) will require a change to the core-sdk.","createdAt":"2025-03-03T16:59:22Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/777#issuecomment-2695017613","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6oA_wl","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Done in #781, thanks @TheCodeWrangler!","createdAt":"2025-04-21T15:43:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/777#issuecomment-2818833445","viewerDidAuthor":false}],"createdAt":"2025-02-26T18:02:04Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":777,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Allow custom metric buckets","updatedAt":"2025-04-21T15:43:44Z","url":"https://github.com/temporalio/sdk-python/issues/777"}
