{"assignees":[],"author":{"id":"U_kgDOCRJCMQ","is_bot":false,"login":"dpr-synth","name":"David Pribil"},"body":"### What are you really trying to do?\n\nI have a long running workflow that uses `workflow.uuid4` to set an ID for a child workflow, then sleeps. I modified the retry policy of an activity and set `initial_interval` with `workflow.random().randint`. The modified activity is called before the child workflow is started. I deployed the new workflow.\n\n### Describe the bug\n\nAll the running workflows failed with `[TMPRL1100] Nondeterminism` error after they woke up from the sleep. All the errors were complaining about the ID of the child workflow. Example error message:\n```\n[TMPRL1100] Nondeterminism error: Child workflow id of scheduled event 'child_workflow_6bfd6073-2403-413f-acc3-7090cf837d0a' does not match child workflow id of command 'child_workflow_96a033ac-6730-4f6d-abfd-60732403113f\n```\n\nIf I make any other change in the retry policy, e.g., changing `initial_interval` from one number to another, I don't get the above error. It only happens, if a `workflow.random()` function call is added.\n\n### Minimal Reproduction\n\nI managed to reproduce the issue with the simple workflow code below.\n\n1. Deploy the worker\n2. Start the workflow\n3. Uncomment `workflow.random().randint`\n4. Re-deploy the worker\n5. After workflow wakes up it dies with non-determinism error\n\nI also got the same error with other random functions, e.g., `workflow.random().uniform`. However, just adding  `workflow.random()` doesn't cause workflow fail with non-determinism.If `workflow.uuid4` is called BEFORE `workflow.random().randint`, then the workflow doesn't fail with non-determinism after `workflow.random().randint` was added.\n\n```python\nfrom datetime import timedelta\n\nfrom temporalio import workflow\n\n\n@workflow.defn\nclass ChildWorkflowUuid:\n    @workflow.run\n    async def run(self) -> str:\n        return workflow.info().workflow_id\n\n\n@workflow.defn\nclass WorkflowUuid:\n    @workflow.run\n    async def run(self) -> str:\n        # IF CHILD ID IS SET HERE, THE WORKFLOW COMPLETES WITHOUT ANY ERRORS AFTER ADDING `workflow.random().randint(1, 5)`\n        # child_workflow_id = str(workflow.uuid4())\n        # UNCOMMENT `workflow.random().randint(1, 5)` WHILE WORKFLOW IS SLEEPING (just `workflow.random()` does not cause non-determinism error)\n        # workflow.random().randint(1, 5)\n        # IF CHILD ID IS SET HERE, WORKFLOW FAILS WITH\n        # [TMPRL1100] Nondeterminism error: Child workflow id of scheduled event '0d4bdc56-4950-4478-94ad-076b61f06fb1' does not match child workflow id of command 'ab05243a-0d4b-4c56-8950-547854ad076b\n        child_workflow_id = str(workflow.uuid4())\n        child_workflow_uuid = await workflow.execute_child_workflow(\n            ChildWorkflowUuid.run,\n            id=child_workflow_id,\n        )\n        await workflow.sleep(timedelta(seconds=30))\n        return child_workflow_uuid\n```\n\n### Environment/Versions\n\n- OS and processor: M1 Mac Pro and x86 Linux\n- Temporal Version: 1.17.0\n- Are you using Docker or Kubernetes or building Temporal from source: no\n\n### Additional context\n\nI am not sure if this is a bug or expected behaviour. I assumed that `workflow.uuid4` seed only depends on the run ID, which should be unchanged after the workflow was modified.\n","closedAt":"2025-09-22T13:36:26Z","comments":[{"id":"IC_kwDOGusT1c7F1Ug-","author":{"login":"tconley1428"},"authorAssociation":"MEMBER","body":"This is expected. All the randomly generated objects on the workflow are based on `workflow.random()`. Hence, when you add a new call to it, it will change the result of the second call.","createdAt":"2025-09-22T13:36:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/1109#issuecomment-3319089214","viewerDidAuthor":false}],"createdAt":"2025-09-19T09:19:38Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1109,"reactionGroups":[],"state":"CLOSED","title":"[Bug] calling workflow.random().randint before workflow.uuid4 breaks replay with [TMPRL1100] Nondeterminism error","updatedAt":"2025-09-22T13:36:27Z","url":"https://github.com/temporalio/sdk-python/issues/1109"}
