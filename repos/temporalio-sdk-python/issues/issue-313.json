{"assignees":[],"author":{"id":"MDQ6VXNlcjE2OTQ0OA==","is_bot":false,"login":"mbernier","name":"Matt Bernier"},"body":"### What are you really trying to do?\r\n\r\nI initially was trying to restrict a retry policy to have a maximum interval of 5 seconds with a coefficient of 1x.\r\n\r\n### Describe the bug\r\n\r\nWhen retry policy is passed on start_workflow, the behavior of the retry is that it keeps doubling and the max_interval is not respected.\r\n\r\n### Minimal Reproduction\r\n\r\n```\r\nretryPolicy = RetryPolicy(\r\n            initial_interval=timedelta(minutes=2),\r\n            backoff_coefficient=float(1.0),\r\n            maximum_interval=timedelta(minutes=50),\r\n            maximum_attempts=4\r\n        )\r\n\r\nworkflow_handle = await temporal_client.start_workflow(\r\n    MyWorkflow.run,\r\n    id=\"my-workflow-2\",\r\n    task_queue=\"default\",\r\n    retry_policy=retryPolicy\r\n)\r\nawait workflow_handle.result()\r\n```\r\n\r\n### Environment/Versions\r\n\r\nName: temporalio\r\nVersion: 1.1.0\r\n\r\nPython: 3.10\r\n\r\nOS: Mac OSX Ventura 13.2.1","closedAt":"2023-05-22T19:13:39Z","comments":[{"id":"IC_kwDOGusT1c5audHZ","author":{"login":"Quinn-With-Two-Ns"},"authorAssociation":"MEMBER","body":"ah misread the expected vs buggy behavior","createdAt":"2023-04-25T17:01:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/313#issuecomment-1522127321","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5avQCH","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I am not able to replicate this. For example, here's a standalone runnable Python script:\r\n\r\n```python\r\nimport asyncio\r\nimport logging\r\nfrom datetime import timedelta\r\nfrom uuid import uuid4\r\n\r\nfrom temporalio import workflow\r\nfrom temporalio.client import Client\r\nfrom temporalio.worker import Worker\r\nfrom temporalio.exceptions import ApplicationError\r\nfrom temporalio.common import RetryPolicy\r\n\r\n@workflow.defn\r\nclass AlwaysErrorWorkflow:\r\n    @workflow.run\r\n    async def run(self) -> None:\r\n        workflow.logger.info(\"Workflow started at: %s\" % workflow.now())\r\n        raise ApplicationError(\"Intentional failure!\")\r\n\r\n\r\nasync def main():\r\n    logging.basicConfig(level=logging.INFO)\r\n\r\n    client = await Client.connect(\"localhost:7233\")\r\n\r\n    logging.info(\"Starting worker\")\r\n    task_queue = f\"tq-{uuid4()}\"\r\n    async with Worker(\r\n        client,\r\n        task_queue=task_queue,\r\n        workflows=[AlwaysErrorWorkflow],\r\n    ):\r\n        logging.info(\"Running workflow\")\r\n        await client.execute_workflow(\r\n            AlwaysErrorWorkflow.run,\r\n            id=f\"wf-{uuid4()}\",\r\n            task_queue=task_queue,\r\n            retry_policy=RetryPolicy(\r\n                initial_interval=timedelta(seconds=1),\r\n                backoff_coefficient=1.0,\r\n                maximum_interval=timedelta(seconds=30),\r\n            ),\r\n        )\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(main())\r\n```\r\n\r\nThis retries every second as expected, it does not double it. And it never reaches max interval because initial interval is just mulitplied by 1 every time. Make sure you are not observing an older workflow still running (i.e. change your task queue and workflow ID each time if needed). Otherwise, can you alter the above sample to demonstrate what you are seeing (preferably w/ seconds instead of minutes just so we don't have to wait)?","createdAt":"2023-04-25T19:54:02Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/313#issuecomment-1522335879","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5c2e-g","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Closing as unable to replicate and weeks without original opener response","createdAt":"2023-05-22T19:13:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/313#issuecomment-1557786528","viewerDidAuthor":false}],"createdAt":"2023-04-25T16:56:37Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":313,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Retry Policy on start_workflow","updatedAt":"2023-05-22T19:13:40Z","url":"https://github.com/temporalio/sdk-python/issues/313"}
