{"assignees":[],"author":{"id":"MDQ6VXNlcjI2Nzg3NzEw","is_bot":false,"login":"teije01","name":""},"body":"### Is your feature request related to a problem? Please describe.\n\nWhen using the `pydantic_data_converter` from `temporalio.contrib.pydantic` (great feature by the way), it may happen that the payload cannot be decoded due to an incorrect payload. This results in a `pydantic.ValidationError` being raised upon decoding the payload.\n\nThe current behavior is for these failures to be [re-raised as a RuntimeError](https://github.com/temporalio/sdk-python/blob/92b77589204a0733f49b5d081942fc9303e436c4/temporalio/worker/_workflow_instance.py#L1703). Then the default behavior for these errors is to result in a `Workflow Task Failed (Failed decoding arguments)` while keeping the workflow running. However, there is no way that such a workflow will ever complete with an incorrect payload.\n\nIn this issue https://community.temporal.io/t/force-workflow-failure-when-workflow-cannot-decode-arguments/10680/4 I found that you can specify which exceptions are treated as workflow failure, meaning there is a way to make the workflow fail directly upon workflow failures by using the experimental `workflow_failure_exception_types`.\n\nSpecifying the pydantic.ValidationError does not work as it is re-raised by temporalio as a RuntimeError\n```python\n    workflow_failure_exception_types = [\n        pydantic.ValidationError,  # does not work, is re-raised as RuntimeError upon decoding\n    ]\n    async with Worker(\n        client,\n        task_queue=\"task-queue\",\n        workflow_failure_exception_types=workflow_failure_exception_types,\n    ):\n```\n\nI'm unsure about the side-effects of treating a RuntimeError as a workflow_failure_exception_types, because it is such a general exception.\n\n### Describe the solution you'd like\n\nI would like to see a workflow failing directly upon 'Failed decoding arguments' while not having to specify a `RuntimeError` as an error in `workflow_failure_exception_types`.\n\nI believe if the pydantic payload converter would raise a [temporalio.exceptions.FailureError](https://github.com/temporalio/sdk-python/blob/92b77589204a0733f49b5d081942fc9303e436c4/temporalio/worker/_workflow_instance.py#L1699), would this then also fail the workflow? because that would seem most preferable.\n\nOr otherwise, if the ValidationError would be re-raised instead of a RuntimeError, this would allow us to fail a workflow more specifically:\n```python\n    workflow_failure_exception_types = [\n        pydantic.ValidationError,\n    ]\n```\n","closedAt":"2025-06-20T22:22:15Z","comments":[{"id":"IC_kwDOGusT1c6lcLZL","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"Thanks for this excellent write-up @teije01.","createdAt":"2025-04-03T12:26:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/815#issuecomment-2775627339","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6lcg3b","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"ðŸ‘ I think the best solution may be to stop wrapping the exception that comes back from argument conversion, or maybe at least only wrap if `self._is_workflow_failure_exception` is false for it. We already made #329 (as part #321), but that was for `ApplicationError` only because it predates \"workflow failure exception types\" concept.","createdAt":"2025-04-03T13:00:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/815#issuecomment-2775715291","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6lc2YW","author":{"login":"teije01"},"authorAssociation":"NONE","body":"Thanks! #321 does indeed seem like it would solve this more specific converter feature as well. This approach would make most sense to me for decoding failures that are not transient.\n\n> maybe at least only wrap if self._is_workflow_failure_exception is false for it.\n\nThat would make sense to me","createdAt":"2025-04-03T13:31:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/815#issuecomment-2775803414","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6n6lYO","author":{"login":"CtrlAltGiri"},"authorAssociation":"NONE","body":"@cretz I want to start contributing to this project. \n\nWould love to pick this up since it's a simple change. ","createdAt":"2025-04-20T12:39:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/815#issuecomment-2817152526","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6n-_sk","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Yes, the change is fairly easy, feel free to submit a PR. Simply do not wrap the exception (i.e. re-raise the original) if the exception \"is workflow failure exception\".","createdAt":"2025-04-21T12:22:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/815#issuecomment-2818308900","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6rbLZM","author":{"login":"teije01"},"authorAssociation":"NONE","body":"> [@cretz](https://github.com/cretz) I want to start contributing to this project.\n> \n> Would love to pick this up since it's a simple change.\n\nLet me know if you have time for it, I don't mind picking it up otherwise","createdAt":"2025-05-13T10:59:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/815#issuecomment-2876028492","viewerDidAuthor":false}],"createdAt":"2025-04-03T08:40:47Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":815,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"HEART","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] Fail workflow upon pydantic.ValidationError when using the pydantic_data_converter","updatedAt":"2025-06-20T22:22:15Z","url":"https://github.com/temporalio/sdk-python/issues/815"}
