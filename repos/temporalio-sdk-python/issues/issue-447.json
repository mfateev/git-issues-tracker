{"assignees":[],"author":{"id":"MDQ6VXNlcjIyNzg5ODUx","is_bot":false,"login":"ndtretyak","name":"Nikolay Tretyak"},"body":"### Describe the bug\r\n\r\nAll the log records emitted by `workflow.logger` has the same `file`, `path` and `lineno` pointing to `workflow.LoggingAdapter.log`.\r\n\r\n### Minimal Reproduction\r\n\r\n```python\r\nimport logging\r\nimport sys\r\n\r\nfrom temporalio import workflow\r\n\r\n\r\nclass Formatter(logging.Formatter):\r\n    def format(self, record) -> str:\r\n        return f\"path: {record.pathname}\"\r\n\r\n\r\nformatter = Formatter()\r\nhandler = logging.StreamHandler(sys.stdout)\r\nhandler.setFormatter(formatter)\r\nlog = logging.getLogger(\"\")\r\nlog.setLevel(logging.INFO)\r\nlog.addHandler(handler)\r\n\r\n\r\n@workflow.defn\r\nclass Workflow:\r\n    @workflow.run\r\n    async def run(self) -> None:\r\n        workflow.logger.info(\"message\")\r\n```\r\n\r\nThis prints `<...>/temporalio/workflow.py` instead of the file where workflow is defined.\r\n\r\n","closedAt":"2024-01-10T16:36:06Z","comments":[{"id":"IC_kwDOGusT1c5ugbUd","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks for the report!\r\n\r\nI have confirmed this is due to us overriding `LogAdapter.log` to prevent logging during replay. The best fix is probably for us to remove the `log` overload and replace it with:\r\n\r\n```python\r\n    def isEnabledFor(self, level: int) -> bool:\r\n        return super().isEnabledFor(level) and (self.log_during_replay or not unsafe.is_replaying())\r\n```","createdAt":"2023-12-13T14:13:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/447#issuecomment-1853994269","viewerDidAuthor":false}],"createdAt":"2023-12-13T12:42:50Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":447,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Wrong line number in workflow.logger","updatedAt":"2024-01-10T16:36:06Z","url":"https://github.com/temporalio/sdk-python/issues/447"}
