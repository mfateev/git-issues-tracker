{"assignees":[],"author":{"id":"MDQ6VXNlcjkwNTg3NzE1","is_bot":false,"login":"jasvirsinghdhillon","name":""},"body":"This is the code that I have written, which I want to put a debug point and test. \n\nfrom temporalio.client import Client\nfrom temporalio.worker import Worker, UnsandboxedWorkflowRunner\nfrom temporalio import activity, workflow\nfrom datetime import timedelta\nimport asyncio\nfrom dataclasses import dataclass\n\n@dataclass\nclass Message:\n    content: str\n\n@activity.defn(name=\"chat_activity\")\nasync def chat_activity(message: Message) -> Message:\n    print(f\"Message Received: {message.content}\")\n    return Message(content=\"Hello World!\")\n\n\n@workflow.defn(name=\"chat_workflow\", sandboxed=False)\nclass ChatWorkflow:\n\n    @workflow.run\n    async def chat_workflow(self, query: str) -> Message:\n        return await workflow.execute_activity(chat_activity, Message(query), start_to_close_timeout=timedelta(seconds=10))\n\n\nasync def main():\n    client = await Client.connect(\"localhost:7233\")\n\n    print(\"Starting worker!\")\n\n    worker = Worker(\n        client,\n        task_queue=\"chat-queue\",\n        workflows=[ChatWorkflow],\n        activities=[chat_activity],\n        debug_mode=True,\n        workflow_runner=UnsandboxedWorkflowRunner()\n    )\n\n    print(\"Worker started!\")\n\n    await worker.run()\n\nif __name__ == '__main__':\n    asyncio.run(main())\n\nI work all great until I don't try to attach the debugger.  The moment I run in debug mode I start getting this exception: \n\nimport sys; print('Python %s on %s' % (sys.version, sys.platform))\nC:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Scripts\\python.exe -X pycache_prefix=C:\\Users\\jasvi\\AppData\\Local\\JetBrains\\PyCharm2024.2\\cpython-cache \"C:/Program Files/JetBrains/PyCharm 2024.2.4/plugins/python-ce/helpers/pydev/pydevd.py\" --multiprocess --qt-support=auto --client 127.0.0.1 --port 49915 --file C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\temporal.py \nConnected to pydev debugger (build 242.23726.102)\nStarting worker!\nWorker started!\nException in callback <Task pending name='run (workflow: chat_workflow, id: b14c8089-9d71-4acf-a41f-d7bd623578ee, run: 01955078-5420-74c5-acb3-56539efc74f3)' coro=<_WorkflowInstanceImpl._run_top_level_workflow_function() running at C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Lib\\site-packages\\temporalio\\worker\\_workflow_instance.py:1873> cb=[set.remove()]>()\nhandle: <Handle <Task pending name='run (workflow: chat_workflow, id: b14c8089-9d71-4acf-a41f-d7bd623578ee, run: 01955078-5420-74c5-acb3-56539efc74f3)' coro=<_WorkflowInstanceImpl._run_top_level_workflow_function() running at C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Lib\\site-packages\\temporalio\\worker\\_workflow_instance.py:1873> cb=[set.remove()]>()>\nTraceback (most recent call last):\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\nTypeError: 'Task' object is not callable\nException in callback <Task pending name='query: __temporal_workflow_metadata (workflow: chat_workflow, id: b14c8089-9d71-4acf-a41f-d7bd623578ee, run: 01955078-5420-74c5-acb3-56539efc74f3)' coro=<_WorkflowInstanceImpl._apply_query_workflow.<locals>.run_query() running at C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Lib\\site-packages\\temporalio\\worker\\_workflow_instance.py:642> cb=[set.remove()]>()\nhandle: <Handle <Task pending name='query: __temporal_workflow_metadata (workflow: chat_workflow, id: b14c8089-9d71-4acf-a41f-d7bd623578ee, run: 01955078-5420-74c5-acb3-56539efc74f3)' coro=<_WorkflowInstanceImpl._apply_query_workflow.<locals>.run_query() running at C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Lib\\site-packages\\temporalio\\worker\\_workflow_instance.py:642> cb=[set.remove()]>()>\nTraceback (most recent call last):\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\events.py\", line 80, in _run\n    self._context.run(self._callback, *self._args)\nTypeError: 'Task' object is not callable\nFailed running eviction job, not evicting. Since eviction could not be processed, this worker cannot complete and the slot will remain forever used.\nTraceback (most recent call last):\n  File \"C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Lib\\site-packages\\temporalio\\worker\\_workflow.py\", line 262, in _handle_activation\n    completion = await asyncio.wait_for(\n                 ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\tasks.py\", line 442, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\futures.py\", line 287, in __await__\n    yield self  # This tells Task to wait for completion.\n    ^^^^^^^^^^\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\tasks.py\", line 339, in __wakeup\n    future.result()\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\futures.py\", line 203, in result\n    raise self._exception.with_traceback(self._exception_tb)\n  File \"C:\\Users\\jasvi\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\concurrent\\futures\\thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\jasvi\\PycharmProjects\\practice_python_project\\.venv\\Lib\\site-packages\\temporalio\\worker\\_workflow_instance.py\", line 419, in activate\n    raise RuntimeError(\n\nIt would be of great help if you could help me fix this issue. Thanks\n","closedAt":"2025-03-01T20:14:50Z","comments":[{"id":"IC_kwDOGusT1c6gerSO","author":{"login":"dandavison"},"authorAssociation":"MEMBER","body":"Hi @jasvirsinghdhillon, thanks for the report. You're absolutely right that this experience needs to be improved. We'll try to get to it soon. For now, could you take a look at the tips posted by @mnichols in https://github.com/temporalio/sdk-python/issues/603? In fact, if you don't mind, let's close this ticket and discuss in #603.","createdAt":"2025-03-01T20:14:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/780#issuecomment-2692396174","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6ge82F","author":{"login":"jasvirsinghdhillon"},"authorAssociation":"NONE","body":"Hi @dandavison ,\n\nThanks for your quick response! I really appreciate you looking into this issue. I'll go through the tips shared in #603 and continue the discussion there if needed.\n\nYes, I'm okay with closing this ticket. Thanks again for your support!\n\n","createdAt":"2025-03-01T23:29:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/780#issuecomment-2692468101","viewerDidAuthor":false}],"createdAt":"2025-03-01T07:02:46Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":780,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Not able to debug code [python]","updatedAt":"2025-03-01T23:29:42Z","url":"https://github.com/temporalio/sdk-python/issues/780"}
