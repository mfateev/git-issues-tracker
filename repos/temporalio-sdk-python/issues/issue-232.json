{"assignees":[],"author":{"id":"MDQ6VXNlcjM1MjI3","is_bot":false,"login":"AndrewIngram","name":"Andy Ingram"},"body":"The following lines of code run without issue in Python 3.10, but throw in 3.11:\r\n\r\n```python\r\nawait asyncio.wait(\r\n    [asyncio.sleep((snooze_until - now).total_seconds()), self._is_reopened.wait()],\r\n    return_when=asyncio.FIRST_COMPLETED,\r\n)\r\n```\r\n\r\n(this is similar to an example in the readme, so it seems idiomatic)\r\n\r\nThe error I get in 3.11 is `TypeError: Passing coroutines is forbidden, use tasks explicitly.`\r\n\r\nEncountered on the `python:3.11-slim` Docker image, initially using `temporalio=0.1b3`, reproduced on `0.1b4` \r\n\r\nI think the relevant Python docs are https://docs.python.org/3/library/asyncio-task.html#waiting-primitives\r\n\r\n> Passing coroutine objects to wait() directly is forbidden\r\n\r\nNot sure if I'd class it as a bug, as the change in Python appears to be deliberate, but it means the canonical way to solve this in Temporal might now be different?","closedAt":"2023-01-04T17:47:06Z","comments":[{"id":"IC_kwDOGusT1c5RTeiu","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is a known Python change and unrelated to Temporal. Why use wait with a sleep instead of just sleep? Also, when using wait, you need a task. So use create_task or similar.\r\n\r\nI will update the README to use tasks.","createdAt":"2022-12-23T15:53:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364060334","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RTfmn","author":{"login":"AndrewIngram"},"authorAssociation":"NONE","body":"I'm not sure I understand your question, I want to wait for a specific time, or an event, whichever happens first.\r\n\r\nBut I hit the same issue even without the sleep and just using wait on the event (as per the readme example), so i'm keen to see what the canonical way of doing this is -- i'd been assuming it was what's in the readme.","createdAt":"2022-12-23T15:59:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364064679","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RTgvM","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Sorry, my mobile phone cut off the right part, I see the event wait now.\r\n\r\nThe proper way since Python 3.11 is to use tasks (so wrap your pieces in create_task). We just haven't updated the README yet. This is not Temporal specific, you'd do the same thing using normal asyncio in Python 3.11.","createdAt":"2022-12-23T16:02:12Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364069324","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RThId","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Though to wait for something until timeout, wait_for is the better approach","createdAt":"2022-12-23T16:03:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364070941","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RTlui","author":{"login":"AndrewIngram"},"authorAssociation":"NONE","body":"Do you mean like this (which seems to work in 3.11)?\r\n\r\n```python\r\ntry:\r\n    await asyncio.wait_for(\r\n        self._is_reopened.wait(), timeout=(snooze_until - now).total_seconds()\r\n    )\r\nexcept TimeoutError:\r\n    pass\r\n```\r\n\r\n","createdAt":"2022-12-23T16:17:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364089762","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RTl_H","author":{"login":"AndrewIngram"},"authorAssociation":"NONE","body":"Do you want me to leave this open so you can track the readme change, or close it?","createdAt":"2022-12-23T16:18:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364090823","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RTmsF","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"That wait_for example looks fine. Yes you can leave this open for me to update the README.\r\n\r\nThe best practice is to use asyncio in Temporal like you would outside of Temporal.","createdAt":"2022-12-23T16:23:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364093701","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5RTnrV","author":{"login":"AndrewIngram"},"authorAssociation":"NONE","body":"Easier said then done when this is our first time using async Python in anger after a 15+ years of non-async Python :)","createdAt":"2022-12-23T16:26:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/232#issuecomment-1364097749","viewerDidAuthor":false}],"createdAt":"2022-12-23T15:46:10Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":232,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Python 3.11 TypeError: Passing coroutines is forbidden, use tasks explicitly.","updatedAt":"2023-01-04T17:47:06Z","url":"https://github.com/temporalio/sdk-python/issues/232"}
