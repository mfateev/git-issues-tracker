{"assignees":[],"author":{"id":"MDQ6VXNlcjUxNzg0ODA5","is_bot":false,"login":"cosminpm","name":"Cosmin"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nI’m trying to set a timeout for a Workflow, but I’m unsure if I’m missing documentation or if this might be a feature request.\r\n\r\nI know it’s possible to set a timeout when executing a workflow directly, like this:\r\n```python\r\nresult = await client.execute_workflow(\r\n    YourWorkflow.run,\r\n    \"your timeout argument\",\r\n    id=\"your-workflow-id\",\r\n    task_queue=\"your-task-queue\",\r\n    # Set Workflow Timeout duration\r\n    execution_timeout=timedelta(seconds=2),\r\n    # run_timeout=timedelta(seconds=2),\r\n    # task_timeout=timedelta(seconds=2),\r\n)\r\n```\r\n\r\nHowever, I’m running into an issue: I can’t set `execution_timeout` when the workflow is triggered by a Schedule, as my workflows are executed by a worker:\r\n\r\n```python\r\nworker = Worker(\r\n    self.client,\r\n    task_queue=TASK_QUEUE,\r\n    workflows=[\r\n        Workflow1,\r\n        Workflow2,\r\n        Workflow3,\r\n    ],\r\n    activities=[\r\n        activity_1,\r\n        activity_2,\r\n        activity_3,\r\n    ],\r\n)\r\n```\r\n\r\nI’ve reviewed the documentation and examples, but haven’t found a way to configure a workflow timeout outside of the direct execution method.\r\n### Describe the solution you'd like\r\n\r\nOr the workflow has a timeout parameter in the definition or the worker, both of them would solve my issue.\r\n\r\n### Additional context\r\n\r\nN/A","closedAt":"2024-11-21T07:28:51Z","comments":[{"id":"IC_kwDOGusT1c6TRV2M","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is a server side timeout set when the workflow is started, and that start is done by the internal scheduler on schedules. How are you creating the schedule? The workflow schedule action allows `execution_timeout`, so that's where you'd set this. Also, unless you're sure you need it, you should consider using timers _inside_ your workflow that you can react to for timing things out instead of the server-side timeout that terminates a workflow with no recourse.","createdAt":"2024-11-12T15:11:27Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2470796684","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6TY7Cv","author":{"login":"cosminpm"},"authorAssociation":"NONE","body":"Hello @cretz!\r\n\r\nThanks for answering.\r\n\r\nWe are creating the schedule via de UI by passing the Workflow definition which does not provide an execution timeout as far as I can see from the available parameters.  \r\n\r\n![image](https://github.com/user-attachments/assets/170ed29e-a0d7-4094-94de-1d5842b2c99d)\r\n\r\nI'm implementing workflow timeouts due to an issue where, occasionally, our workflow remains in a _\"Running\"_ status indefinitely, with zero pending activities. This occurs despite having timeouts set at the activity level, and I haven’t yet identified the root cause.\r\n\r\nThis is how I'm defining the workflows:\r\n\r\n```python\r\nwith workflow.unsafe.imports_passed_through():\r\n    from app.module import activity_1\r\n\r\n\r\n@workflow.defn\r\nclass Workflow1:\r\n    @workflow.run\r\n    async def run(self) -> Any:\r\n        return await workflow.execute_activity(\r\n            activity_1_activity,\r\n            start_to_close_timeout=timedelta(minutes=5),\r\n        )\r\n\r\n\r\n@activity.defn\r\nasync def activity_1_activity() -> Any:\r\n    return activity_1()\r\n```\r\n\r\nAm I missing something?","createdAt":"2024-11-13T08:15:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2472784047","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Tcu_K","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> We are creating the schedule via de UI\r\n\r\nThis seems to be an issue with the UI not providing every workflow option and not related to Python SDK. I will confer with the UI team to see if we have plans here. In the meantime, you could consider creating the schedule via the CLI or programmatically in the Python SDK to get the extra options you need.\r\n\r\n> I'm implementing workflow timeouts due to an issue where, occasionally, our workflow remains in a \"Running\" status indefinitely, with zero pending activities. This occurs despite having timeouts set at the activity level, and I haven’t yet identified the root cause.\r\n\r\nThis is worth identifying instead of just setting workflow execution timeouts. Your activity timeout is only set for each attempt (as opposed to schedule to close timeout), so a failing activity will retry indefinitely there any look like it's hanging (see the UI to see if the pending activity is performing many attempts).\r\n\r\nAlso, for general assistance with activity timeouts and such, feel free to visit our [forums](https://community.temporal.io/) or `#python-sdk` on [Slack](https://t.mp/slack).","createdAt":"2024-11-13T14:29:35Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2473783242","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Tj1jN","author":{"login":"cosminpm"},"authorAssociation":"NONE","body":"Hello @cretz.\r\n\r\nThanks for answering! Regarding the UI team, do I have to open a request there _(if so can you provide a link)_ or do we keep this issue open?\r\n\r\n> you could consider creating the schedule via the CLI or programmatically in the Python SDK to get the extra options you need.\r\n\r\nMaybe I'm wrong but as far as I know creating a Workflow does not provide the option to set a timeout or at least in the [documentation](https://docs.temporal.io/develop/python/core-application#workflow-type) that's not specified, the only references are at Activity level.\r\n\r\nThe other option for Workflow timeouts are in the [Failure detection section](https://docs.temporal.io/develop/python/failure-detection), but I think this _(got from the official docs)_ would not work:\r\n``` python\r\n# ...\r\n    result = await client.execute_workflow(\r\n        YourWorkflow.run,\r\n        \"your timeout argument\",\r\n        id=\"your-workflow-id\",\r\n        task_queue=\"your-task-queue\",\r\n        # Set Workflow Timeout duration\r\n        execution_timeout=timedelta(seconds=2),\r\n        # run_timeout=timedelta(seconds=2),\r\n        # task_timeout=timedelta(seconds=2),\r\n    )\r\n```\r\n\r\nAs it forces to execute the workflow in your code and my workflows are executed via a schedule. And in the schedule [documentation](https://docs.temporal.io/develop/python/schedules) there are no references about workflow timeouts.\r\n\r\n> This is worth identifying instead of just setting workflow execution timeouts. Your activity timeout is only set for each attempt (as opposed to schedule to close timeout), so a failing activity will retry indefinitely there any look like it's hanging (see the UI to see if the pending activity is performing many attempts).\r\n\r\nIndeed, but it's a very strange issue, as sometimes the workflow executes correctly but from now and then it just loops in Running without any pending activity, if we terminate the workflow and we wait for the next workflow execution it succeeds. So it's a non-deterministic behavior. For this reason as a fast solution would be nice to have a Workflow timeout with Schedules. \r\n\r\n\r\nFor sure I may missed something and it's a mistake from my side, but it would be nice if you could help me! \r\n\r\nThanks!","createdAt":"2024-11-14T07:51:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2475645133","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6TmxXC","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> And in the schedule [documentation](https://docs.temporal.io/develop/python/schedules) there are no references about workflow timeouts.\r\n\r\nThe schedule documentation doesn't mention every workflow option since many are the same as regular workflow start. The documentation at https://docs.temporal.io/develop/python/schedules#create shows an example of creating a schedule, you can add workflow options to `ScheduleActionStartWorkflow` as needed, including `execution_timeout` (see API documentation at https://python.temporal.io/temporalio.client.ScheduleActionStartWorkflow.html).","createdAt":"2024-11-14T13:53:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2476414402","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6UVeAV","author":{"login":"cosminpm"},"authorAssociation":"NONE","body":"Thanks @cretz.\r\n\r\nSome final questions:\r\n1. Do you have an ETA for when the timeout schedule parameter will be implemented in the UI? If not, can you provide a ticket to follow up on this?\r\n2. I understand that timeouts can be specified via the CLI at the schedule level, but is there a way to define them at the Workflow level without using this option:\r\n```python\r\n    result = await client.execute_workflow(\r\n        YourWorkflow.run,\r\n        \"your timeout argument\",\r\n        id=\"your-workflow-id\",\r\n        task_queue=\"your-task-queue\",\r\n        # Set Workflow Timeout duration\r\n        execution_timeout=timedelta(seconds=2),\r\n        # run_timeout=timedelta(seconds=2),\r\n        # task_timeout=timedelta(seconds=2),\r\n    )\r\n```\r\n\r\nThanks!\r\n","createdAt":"2024-11-20T13:57:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2488655893","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6UWyyp","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Do you have an ETA for when the timeout schedule parameter will be implemented in the UI? If not, can you provide a ticket to follow up on this?\r\n\r\nI do not have an ETA and there may be discussions on use cases the UI team would want to have with you and confirm whether it's something they want to expose. Instead of in the Python GitHub issue, I would recommend starting a UI discussion in a more general setting, e.g. at https://community.temporal.io/ or in Slack (https://t.mp/slack) or, if you're a cloud customer, open a ticket.\r\n\r\n> I understand that timeouts can be specified via the CLI at the schedule level, but is there a way to define them at the Workflow level without using this option:\r\n\r\nCan you clarify the question a bit? The `execution_timeout` option is available both for create schedule in Python (when you use the workflow action I mentioned above) and for just starting a workflow directly in Python. What is the issue with using the `execution_timeout` option?","createdAt":"2024-11-20T16:11:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2489003177","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6UXX8M","author":{"login":"cosminpm"},"authorAssociation":"NONE","body":"Yes for sure, I have requested it in the [#web-ui channel](https://temporalio.slack.com/archives/C011AAP3GFP/p1732122532648729). Thanks!\r\n\r\n2. Well, my point if we could have something like this:\r\n```python\r\nfrom datetime import timedelta\r\nfrom typing import Any\r\nfrom temporalio import workflow, activity\r\n\r\nwith workflow.unsafe.imports_passed_through():\r\n    from app.module import activity_1\r\n\r\n\r\n@workflow.defn\r\nclass Workflow1:\r\n    def __init__(self, timeout: timedelta = timedelta(minutes=5)): # <- HERE\r\n        self.timeout = timeout\r\n\r\n    @workflow.run\r\n    async def run(self) -> Any:\r\n        return await workflow.execute_activity(\r\n            activity_1_activity,\r\n            start_to_close_timeout=timedelta(minutes=5),\r\n        )\r\n\r\n\r\n@activity.defn\r\nasync def activity_1_activity() -> Any:\r\n    return activity_1()\r\n```\r\n\r\nWhen the scheduler executes the workflow, it knows what is the timeout for each one, and this timeout it's defined at Workflow level, this would also simplify this code as you won't need to specify it in the client.\r\n\r\n``` python\r\n    result = await client.execute_workflow(\r\n        YourWorkflow.run,\r\n        \"your timeout argument\",\r\n        id=\"your-workflow-id\",\r\n        task_queue=\"your-task-queue\",\r\n        # Set Workflow Timeout duration\r\n        execution_timeout=timedelta(seconds=2), # <- HERE\r\n        # run_timeout=timedelta(seconds=2),\r\n        # task_timeout=timedelta(seconds=2),\r\n    )\r\n```","createdAt":"2024-11-20T17:17:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2489155340","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6UXzzN","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Still not following exactly. If you want timeout inside workflow code, you can have (untested):\r\n\r\n```python\r\n@dataclass\r\nclass Workflow1Args:\r\n    timeout: int\r\n\r\n@workflow.defn\r\nclass Workflow1:\r\n    async def run(self, args: Workflow1Args) -> None:\r\n        try:\r\n            async with asyncio.timeout(args.timeout):\r\n                # This will get canceled on timeout\r\n                my_other_code\r\n        except TimeoutError: # Note, may be something else depending on how cancel handled, make sure to test\r\n            raise ApplicationError('timeout')\r\n```\r\n\r\nWe recommend this approach over `execution_timeout` because `execution_timeout` is server side and you can't react to it. But if you must have server side timeout (e.g. you may not have a worker running), then no amount of in-workflow timeout will help because the workflow code may never be reached.\r\n\r\nIf you just want to create a schedule with an execution timeout, just:\r\n\r\n```python\r\n    await client.create_schedule(\r\n        \"workflow-schedule-id\",\r\n        Schedule(\r\n            action=ScheduleActionStartWorkflow(\r\n                YourSchedulesWorkflow.run,\r\n                \"my schedule arg\",\r\n                id=\"schedules-workflow-id\",\r\n                task_queue=\"schedules-task-queue\",\r\n                execution_timeout=timedelta(seconds=2)\r\n            ),\r\n            spec=ScheduleSpec(\r\n                intervals=[ScheduleIntervalSpec(every=timedelta(minutes=2))]\r\n            ),\r\n            state=ScheduleState(note=\"Here's a note on my Schedule.\"),\r\n        ),\r\n    )\r\n```\r\n\r\n(though a 2-second timeout may be a bit aggressive)","createdAt":"2024-11-20T18:20:39Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2489269453","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6UbmgI","author":{"login":"cosminpm"},"authorAssociation":"NONE","body":"Thanks! I think this solves my question, now I will be following on the UI problem.","createdAt":"2024-11-21T07:28:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2490263560","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c6Y50Nx","author":{"login":"cosminpm"},"authorAssociation":"NONE","body":"Follow up issue: https://github.com/temporalio/ui/issues/2460","createdAt":"2024-12-30T10:27:33Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/686#issuecomment-2565292913","viewerDidAuthor":false}],"createdAt":"2024-11-07T10:52:26Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":686,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Timeout in Workflow definition not in execution","updatedAt":"2024-12-30T10:27:56Z","url":"https://github.com/temporalio/sdk-python/issues/686"}
