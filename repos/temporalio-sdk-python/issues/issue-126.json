{"assignees":[],"author":{"id":"MDQ6VXNlcjE4OTg0NDc=","is_bot":false,"login":"averri","name":"Alexandre Verri"},"body":"### What are you really trying to do?\r\nI'm trying to run a workflow passing an object of a class that is derived from Pydantic's `BaseModel`.\r\n\r\n### Describe the bug\r\nWhen running the workflow, the following exception happens:\r\n\r\n```\r\nObject of type SignupCreate is not JSON serializable\r\n```\r\n\r\nMore details:\r\n```\r\n\"  File \\\"C:\\\\Users\\\\alexa\\\\AppData\\\\Local\\\\pypoetry\\\\Cache\\\\virtualenvs\\\\master-control-fastapi-xNDFbqbb-py3.10\\\\lib\\\\site-packages\\\\temporalio\\\\converter.py\\\", line 177, in to_payloads\\n    payload = converter.to_payload(value)\\n\", \"  File \\\"C:\\\\Users\\\\alexa\\\\AppData\\\\Local\\\\pypoetry\\\\Cache\\\\virtualenvs\\\\master-control-fastapi-xNDFbqbb-py3.10\\\\lib\\\\site-packages\\\\temporalio\\\\converter.py\\\", line 425, in to_payload\\n    data=json.dumps(\\n\", \"  File \\\"C:\\\\Users\\\\alexa\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python310\\\\lib\\\\json\\\\__init__.py\\\", line 238, in dumps\\n    **kw).encode(obj)\\n\", \"  File \\\"C:\\\\Users\\\\alexa\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python310\\\\lib\\\\json\\\\encoder.py\\\", line 199, in encode\\n    chunks = self.iterencode(o, _one_shot=True)\\n\", \"  File \\\"C:\\\\Users\\\\alexa\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python310\\\\lib\\\\json\\\\encoder.py\\\", line 257, in iterencode\\n    return _iterencode(o, 0)\\n\", \"  File \\\"C:\\\\Users\\\\alexa\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python310\\\\lib\\\\json\\\\encoder.py\\\", line 179, in default\\n    raise TypeError(f'Object of type {o.__class__.__name__} '\\n\"\r\n```\r\n\r\n### Minimal Reproduction\r\n```python\r\nimport asyncio\r\nfrom datetime import timedelta\r\n\r\nfrom pydantic import constr, BaseModel, EmailStr, Extra\r\nfrom temporalio import activity, workflow\r\nfrom temporalio.client import Client\r\nfrom temporalio.worker import Worker\r\n\r\nUsernameField = constr(min_length=3, max_length=20, strip_whitespace=True)\r\n\r\n\r\n# While we could use multiple parameters in the activity, Temporal strongly\r\n# encourages using a single dataclass instead which can have fields added to it\r\n# in a backwards-compatible way.\r\n\r\nclass SignupCreate(BaseModel, extra=Extra.forbid):\r\n    username: UsernameField\r\n    email: EmailStr\r\n\r\n\r\n# Basic activity that logs and does string concatenation\r\n@activity.defn\r\nasync def create_signup(input: SignupCreate) -> str:\r\n    activity.logger.info(\"Running activity with parameter %s\" % input)\r\n    return f\"signup: {input}\"\r\n\r\n\r\n# Basic workflow that logs and invokes an activity\r\n@workflow.defn\r\nclass SignupWorkflow:\r\n    @workflow.run\r\n    async def run(self, signup: SignupCreate) -> str:\r\n        workflow.logger.info(\"Running workflow with parameter %s\" % signup)\r\n        return await workflow.execute_activity(\r\n            create_signup,\r\n            signup,\r\n            start_to_close_timeout=timedelta(seconds=10),\r\n        )\r\n\r\n\r\nasync def main():\r\n    # Uncomment the line below to see logging\r\n    # logging.basicConfig(level=logging.INFO)\r\n\r\n    # Start client\r\n    client = await Client.connect(\"localhost:7233\")\r\n\r\n    # Run a worker for the workflow\r\n    async with Worker(\r\n            client,\r\n            task_queue=\"hello-activity-task-queue\",\r\n            workflows=[SignupWorkflow],\r\n            activities=[create_signup],\r\n    ):\r\n        # While the worker is running, use the client to run the workflow and\r\n        # print out its result. Note, in many production setups, the client\r\n        # would be in a completely separate process from the worker.\r\n        result = await client.execute_workflow(\r\n            SignupWorkflow.run,\r\n            SignupCreate(username=\"alex\", email=\"me@gmail.com\"),\r\n            id=\"hello-activity-workflow-id\",\r\n            task_queue=\"hello-activity-task-queue\",\r\n        )\r\n        print(f\"Result: {result}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(main())\r\n\r\n```\r\n\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: Windows 11, Intel I9\r\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version\r\n  - Python SDK version 0.1b1\r\n- Are you using Docker or Kubernetes or building Temporal from source? Answer: I'm using Docker compose, images:\r\n  - `temporalio/ui:2.5.1`\r\n  - `temporalio/auto-setup:1.17.5`\r\n  \r\n","closedAt":"2022-09-20T15:37:07Z","comments":[{"id":"IC_kwDOGusT1c5J3nGI","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This was implemented in #102 which is not yet released.","createdAt":"2022-09-07T12:18:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/126#issuecomment-1239314824","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5J3nxB","author":{"login":"averri"},"authorAssociation":"NONE","body":"Thank you, @cretz. This Python SDK is very well done, the API is super clean. ","createdAt":"2022-09-07T12:21:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/126#issuecomment-1239317569","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5KqDw5","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This has now been released. Let me know if you run into issues.","createdAt":"2022-09-20T15:37:07Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/126#issuecomment-1252539449","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5KsPra","author":{"login":"averri"},"authorAssociation":"NONE","body":"Very nice! Thanks, @cretz ","createdAt":"2022-09-21T01:58:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/126#issuecomment-1253112538","viewerDidAuthor":false}],"createdAt":"2022-09-07T12:07:25Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":126,"reactionGroups":[],"state":"CLOSED","title":"The SDK is failing to serialize objects from Pydantic classes","updatedAt":"2022-09-21T01:58:52Z","url":"https://github.com/temporalio/sdk-python/issues/126"}
