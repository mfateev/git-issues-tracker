{"assignees":[],"author":{"id":"MDQ6VXNlcjE4OTg0NDc=","is_bot":false,"login":"averri","name":"Alexandre Verri"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nI would like to suggest adding support for serializing/deserializing Pydantic's secret types, like `SecretStr` and `SecretField`.\r\nMore information at: https://pydantic-docs.helpmanual.io/usage/types/#secret-types\r\n\r\n### Describe the solution you'd like\r\n\r\nConsidering that Temporal logs all input and output arguments of activities and workflows, this is considered a security issue when sensitive information is present. Sensitive information must be protected from viewing in the Temporal UI and in the log files. The Pydantic's secret types already work fine with standard logging, but they fail to work with Temporal Python SDK because some SDK components do not know how to serialize/deserialize the secret types.","closedAt":"2022-09-07T20:31:47Z","comments":[{"id":"IC_kwDOGusT1c5J5Fe2","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Temporal is a general purpose system and it does not currently have a way to exclude certain pieces of a payload from visualizing in the UI. This is not Python specific.\r\n\r\nIf you want data to be hidden from Temporal, we suggest end-to-end encryption. I am actively working on https://github.com/temporalio/samples-python/issues/5 to show how to do this in Python. But there is no way to say you only want some nested part of some payload to be hidden in some cases across languages but still exist as visible in the DB.","createdAt":"2022-09-07T17:52:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/128#issuecomment-1239701430","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5J5O_l","author":{"login":"averri"},"authorAssociation":"NONE","body":"That is the purpose of the `SecretStr` from Pydantic. If we use a class derived from `BaseModel` using fields of type `SecretStr`, those fields will appear in the Temporal UI with asterisks. See example:\r\n\r\n```python\r\nfrom pydantic import SecretStr, BaseModel\r\nfrom hashlib import sha256\r\n\r\nif __name__ == '__main__':\r\n\r\n    class Signup(BaseModel):\r\n        username: str\r\n        clear_password: SecretStr\r\n\r\n        @property\r\n        def encrypted_password(self):\r\n            return sha256(self.clear_password.get_secret_value().encode(\"utf-8\")).hexdigest()\r\n\r\n\r\n    class User(BaseModel):\r\n        username: str\r\n        encrypted_password: str\r\n\r\n    # This data comes from a REST call, for example.\r\n    signup = Signup(username=\"Alex\", clear_password=\"12345678\")\r\n    \r\n    # Printing sensitive data\r\n    print(f\"signup: {signup}\")\r\n\r\n    # Using sensitive data, creating a user to store in the database.\r\n    user = User(**signup.dict(), encrypted_password=signup.encrypted_password)\r\n\r\n    print(f\"user: {user}\")\r\n```\r\n\r\nRunning the above code produces:\r\n\r\n```\r\nsignup: username='Alex' clear_password=SecretStr('**********')\r\nuser: username='Alex' encrypted_password='ef797c8118f02dfb649607dd5d3f8c7623048c9c063d532cc95c5ed7a898a64f'\r\n```\r\n\r\nWe can see that no sensitive information appears in the logs, nor in the entities used to store information in the database (the `User` class can be used as a DB entity). This is just an example, in real apps, I also use the encrypted password as a `SecretStr`.\r\n\r\nI have tested your other PR that fixes the support for Pydantic classes, it's working fine, it's just missing the Pydantic's secret types. \r\n\r\nAs a workaround, I believe I can use a custom data converter. In the method `connect` of the `Client` class, there is a named argument called `data_converter`. Do you have an example of how to add the support for custom converters using this `data_converter`?\r\n\r\nThat example (https://github.com/temporalio/samples-python/issues/5) involving encryption is a great thing, thank you for that.","createdAt":"2022-09-07T18:36:34Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/128#issuecomment-1239740389","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5J5mFS","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"It only produces that in Python using Python constructs. The Temporal server is not written in Python and does not know anything about Pydantic or other Python-specific constructs. The way Temporal works is we serialize all input/output as JSON (usually). It is not specific to a language and many times users build things across languages. We do not have Temporal support for excluding specific parts of a payload currently.\r\n\r\nYou can't take the Pydantic/Python-specific things and apply them generically to the Temporal server or other languages. The input/output will be JSON that can be deserialized by all languages, so if you want a piece encrypted/hidden, you'll have to manually do so.\r\n\r\n> Do you have an example of how to add the support for custom converters using this data_converter?\r\n\r\nI do not have an example yet, I have created https://github.com/temporalio/samples-python/issues/15. Basically you'd create a custom payload converter that you'd either create a data converter with or add it to a composite payload converter on top of the existing ones.","createdAt":"2022-09-07T20:24:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/128#issuecomment-1239834962","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c5J5nfZ","author":{"login":"averri"},"authorAssociation":"NONE","body":"I am going to close this issue, as the solution for handling sensitive information in Temporal is to use the converters. Thanks for the https://github.com/temporalio/samples-python/issues/15.","createdAt":"2022-09-07T20:31:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/128#issuecomment-1239840729","viewerDidAuthor":false}],"createdAt":"2022-09-07T17:33:03Z","labels":[{"id":"LA_kwDOGusT1c7gQgHN","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":128,"reactionGroups":[],"state":"CLOSED","title":"Add support for Pydantic's secret types","updatedAt":"2022-09-07T20:31:47Z","url":"https://github.com/temporalio/sdk-python/issues/128"}
