{"assignees":[],"author":{"id":"MDQ6VXNlcjM0MjE4ODcz","is_bot":false,"login":"DmitryZap","name":"Dmitry Zaporozhchenko"},"body":"### What are you really trying to do?\n\nI'm trying to use the batch operation feature in the Temporal Python SDK to reset multiple workflows at scale. This is particularly useful for maintenance and debugging operations on large numbers of workflows.\n\n### Describe the bug\n\nWhen attempting to start a batch operation (specifically a workflow reset operation), the Temporal Python SDK throws an error: `Unknown RPC call start_batch_operation`. This indicates that the SDK is making an RPC call that is not recognized by the Temporal server, suggesting missing or unimplemented functionality for batch operations in the Python SDK.\n\nError log:\n```\n2025-06-17 20:10:50,930 - INFO - Processing 1 workflows\n2025-06-17 20:10:50,930 - INFO - Resetting workflow 'demo-workflow-1750180163' with reset_type 'first_task'\n2025-06-17 20:10:50,930 - ERROR - Failed to reset workflow 'demo-workflow-1750180163': Unknown RPC call start_batch_operation\n2025-06-17 20:10:50,930 - ERROR - Error resetting workflow demo-workflow-1750180163: Unknown RPC call start_batch_operation\n2025-06-17 20:10:50,930 - INFO - Reset 0 workflows successfully, 1 errors\n2025-06-17 20:10:50,930 - INFO - Reset operation completed successfully\n```\n\n### Minimal Reproduction\n\n```python\nimport grpc\nfrom temporalio.api.workflowservice.v1 import workflow_service_pb2 as workflow_service\nfrom temporalio.api.workflowservice.v1 import workflow_service_pb2_grpc as workflow_service_grpc\nfrom temporalio.api.common.v1 import payload_pb2\nfrom temporalio.api.batch.v1 import message_pb2 as batch_message\n\ndef run_batch_operation():\n    # Create gRPC channel to Temporal server\n    channel = grpc.insecure_channel('localhost:7233')\n    stub = workflow_service_grpc.WorkflowServiceStub(channel)\n    \n    # Create batch operation request\n    request = workflow_service.StartBatchOperationRequest(\n        namespace=\"default\",\n        job_id=\"batch-reset-job-1\",\n        reason=\"Resetting workflows via gRPC\",\n        reset_operation=batch_message.BatchOperationReset(\n            reset_type=workflow_service.RESET_TYPE_FIRST_WORKFLOW_TASK,\n            reset_reapply_type=workflow_service.RESET_REAPPLY_TYPE_SIGNAL\n        ),\n    )\n    \n    try:\n        # Execute batch operation via gRPC\n        response = stub.StartBatchOperation(request)\n        print(f\"Batch operation started successfully. Job ID: {response.job_id}\")\n        print(f\"Progress: {response.total_operation_count} workflows to process\")\n    except grpc.RpcError as e:\n        print(f\"gRPC call failed: {e.details()}\")\n        print(f\"Error code: {e.code()}\")\n\nif __name__ == \"__main__\":\n    run_batch_operation()\n```\n\n### Environment/Versions\n\n- OS and processor: macOS Sonoma (Apple M1 Pro)\n- Temporal Version: Python SDK 1.3.0, Temporal Server 1.25.0\n- Are you using Docker or Kubernetes or building Temporal from source? Without docker and builds\n\n### Additional context\n\nThe error \"Unknown RPC call start_batch_operation\" suggests that the batch operation functionality might not be implemented in the Rust Core SDK used by the Temporal Python SDK.\n","closedAt":"2025-10-06T19:45:16Z","comments":[{"id":"IC_kwDOGusT1c6zmiDy","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> The error \"Unknown RPC call start_batch_operation\" suggests that the batch operation functionality might not be implemented in the Rust Core SDK used by the Temporal Python SDK.\n\nYour code is bypassing the Rust Core and using gRPC directly. Haven't tested direct use, but can you try to use traditional `Client.connect` and then using `my_client.workflow_service.start_batch_operation(workflow_service_pb2.StartBatchOperationRequest(...` instead?\n\nAlso, where are the logs you have above showing from? For example, is \"2025-06-17 20:10:50,930 - INFO - Processing 1 workflows\" a server log or your log? Are you using the dev server? There may be something wrong server side. Can you confirm this exists with latest dev server version?","createdAt":"2025-06-27T14:12:50Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/927#issuecomment-3013222642","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c60bAc4","author":{"login":"DmitryZap"},"authorAssociation":"NONE","body":"I tried to do the same thing through the client. Got the same problem.\n\nAnother example (with default client):\n\n```python3\nimport argparse\nimport asyncio\nimport logging\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom temporalio.client import Client\nfrom temporalio.service import RPCError\nfrom temporalio.api.workflowservice.v1 import workflow_service_pb2\nfrom temporalio.api.batch.v1 import message_pb2\nfrom temporalio.api.enums.v1 import reset_pb2\n\nlogger = logging.getLogger(__name__)\nlogging.basicConfig(level=logging.INFO)\n\nasync def get_client(address: str = \"localhost:7233\") -> Client:\n    \"\"\"Create and return a Temporal client.\"\"\"\n    return await Client.connect(\n        address,\n        namespace=\"default\",\n        tls=False,\n    )\n\ndef parse_args() -> argparse.Namespace:\n    parser = argparse.ArgumentParser(description=\"Batch reset workflows using Temporal Python SDK\")\n    parser.add_argument(\n        \"--query\",\n        required=True,\n        help=\"Query to select workflows for reset (e.g. WorkflowType='MyWorkflow')\"\n    )\n    parser.add_argument(\n        \"--reason\",\n        required=True,\n        help=\"Reason for reset\"\n    )\n    parser.add_argument(\n        \"--namespace\",\n        default=\"default\",\n        help=\"Temporal namespace\"\n    )\n    parser.add_argument(\n        \"--address\",\n        default=\"localhost:7233\",\n        help=\"Temporal server address\"\n    )\n    parser.add_argument(\n        \"--reset-type\",\n        choices=[\"LastWorkflowTask\", \"FirstWorkflowTask\"],\n        default=\"LastWorkflowTask\",\n        help=\"Reset point type\"\n    )\n    return parser.parse_args()\n\nasync def run_batch_reset(\n    client: Client,\n    namespace: str,\n    query: str,\n    reason: str,\n    reset_type: str,\n) -> Optional[str]:\n    \"\"\"\n    Run a batch reset operation using Temporal Python SDK.\n    \n    Args:\n        client: Client instance\n        namespace: Temporal namespace\n        query: Query to select workflows for reset\n        reason: Reason for reset operation\n        reset_type: Reset point type\n        \n    Returns:\n        Job ID if successful, None otherwise\n    \"\"\"\n    try:\n        # Create unique job ID\n        job_id = f\"batch-reset-{int(datetime.now().timestamp())}\"\n        \n        # Map reset type to enum\n        reset_type_enum = {\n            \"LastWorkflowTask\": reset_pb2.RESET_TYPE_LAST_WORKFLOW_TASK,\n            \"FirstWorkflowTask\": reset_pb2.RESET_TYPE_FIRST_WORKFLOW_TASK,\n        }[reset_type]\n        \n        # Create batch operation request\n        request = workflow_service_pb2.StartBatchOperationRequest(\n            namespace=namespace,\n            visibility_query=query,\n            job_id=job_id,\n            reason=reason,\n            reset_operation=message_pb2.BatchOperationReset(\n                reset_type=reset_type_enum\n            )\n        )\n        \n        # Start batch operation using workflow service\n        response = await client.workflow_service.start_batch_operation(request)\n        logger.info(f\"Started batch reset operation with job ID: {job_id}\")\n        return job_id\n        \n    except Exception as e:\n        logger.error(f\"Failed to start batch reset: {e}\")\n        return None\n\nasync def main() -> None:\n    \"\"\"Parse arguments and run batch reset operation.\"\"\"\n    args = parse_args()\n    \n    # Create Temporal client\n    client = await get_client(args.address)\n    \n    # Run batch reset\n    logger.info(f\"Starting batch reset with query: {args.query}\")\n    job_id = await run_batch_reset(\n        client=client,\n        namespace=args.namespace,\n        query=args.query,\n        reason=args.reason,\n        reset_type=args.reset_type,\n    )\n    \n    if job_id:\n        logger.info(f\"Batch reset operation started successfully!\")\n        logger.info(f\"Job ID: {job_id}\")\n        logger.info(f\"Query: {args.query}\")\n        logger.info(f\"Reset type: {args.reset_type}\")\n    else:\n        logger.error(\"Failed to start batch reset operation\")\n\nif __name__ == \"__main__\":\n    asyncio.run(main()) \n```\n\n","createdAt":"2025-07-02T08:39:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/927#issuecomment-3026978616","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c60eXtQ","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks, we have replicated here. The issue is our Rust core does not have that API call. We will add it and make sure that our test that is supposed to check that all are present is in fact doing so.","createdAt":"2025-07-02T13:18:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-python/issues/927#issuecomment-3027860304","viewerDidAuthor":false},{"id":"IC_kwDOGusT1c63r0pr","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"Core has it, rather, the Python bridge client does not. Tests for that will need the fix.","createdAt":"2025-07-16T23:17:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-python/issues/927#issuecomment-3081718379","viewerDidAuthor":false}],"createdAt":"2025-06-27T10:07:53Z","labels":[{"id":"LA_kwDOGusT1c7gQgHK","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":927,"reactionGroups":[],"state":"CLOSED","title":"[Bug]  Batch operation feature in the Temporal Python SDK doesn't work","updatedAt":"2025-10-06T19:45:16Z","url":"https://github.com/temporalio/sdk-python/issues/927"}
