{"assignees":[],"author":{"id":"MDQ6VXNlcjUxNDkzMg==","is_bot":false,"login":"antmendoza","name":"Antonio Mendoza Pérez"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\n### Describe the bug\r\n\r\nSome metrics emited by the sdk are not prefixed with \"temporal_\", concretely `request` and `long_request`  \r\n\r\n\r\n\r\n> url=http://localhost:9090/\r\n> curl -s $url/api/v1/label/name/values | jq -r \".data[]\" | sort\r\n \r\nlong_request\r\nlong_request_latency_bucket\r\nlong_request_latency_count\r\nlong_request_latency_sum\r\nrequest\r\nrequest_latency_bucket\r\nrequest_latency_count\r\nrequest_latency_sum\r\ntemporal_activity_execution_latency_bucket\r\ntemporal_activity_execution_latency_count\r\ntemporal_activity_execution_latency_sum\r\ntemporal_activity_poll_no_task\r\ntemporal_activity_schedule_to_start_latency_bucket\r\ntemporal_activity_schedule_to_start_latency_count\r\ntemporal_activity_schedule_to_start_latency_sum\r\ntemporal_activity_task_received\r\ntemporal_num_pollers\r\ntemporal_sticky_cache_hit\r\ntemporal_sticky_cache_size\r\ntemporal_worker_start\r\ntemporal_worker_task_slots_available\r\ntemporal_workflow_completed\r\ntemporal_workflow_endtoend_latency_bucket\r\ntemporal_workflow_endtoend_latency_count\r\ntemporal_workflow_endtoend_latency_sum\r\ntemporal_workflow_task_execution_latency_bucket\r\ntemporal_workflow_task_execution_latency_count\r\ntemporal_workflow_task_execution_latency_sum\r\ntemporal_workflow_task_queue_poll_empty\r\ntemporal_workflow_task_queue_poll_succeed\r\ntemporal_workflow_task_replay_latency_bucket\r\ntemporal_workflow_task_replay_latency_count\r\ntemporal_workflow_task_replay_latency_sum\r\ntemporal_workflow_task_schedule_to_start_latency_bucket\r\ntemporal_workflow_task_schedule_to_start_latency_count\r\ntemporal_workflow_task_schedule_to_start_latency_sum\r\n\r\n\r\nThis happen with v.1.9.0 and v.1.9.1, v1.8.6 seems ok \r\n\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]\r\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version\r\n- Are you using Docker or Kubernetes or building Temporal from source?\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n","closedAt":"2024-07-16T22:51:40Z","comments":[{"id":"IC_kwDOEujx185zLoq9","author":{"login":"paymog"},"authorAssociation":"NONE","body":"I'm also seeing a metric called `target_info` which doesn't have that prefix\r\n\r\n```\r\n# HELP long_request Count of long-poll request successes by rpc name\r\n# HELP long_request_failure Count of long-poll request failures by rpc name\r\n# HELP long_request_latency Histogram of client long-poll request latencies\r\n# HELP request Count of client request successes by rpc name\r\n# HELP request_latency Histogram of client request latencies\r\n# HELP target_info Target metadata\r\n# HELP temporal_activity_execution_latency Histogram of activity execution latencies\r\n# HELP temporal_activity_poll_no_task Count of activity task queue poll timeouts (no new task)\r\n# HELP temporal_activity_schedule_to_start_latency Histogram of activity schedule-to-start latencies\r\n# HELP temporal_activity_task_received Count of activity task queue poll successes\r\n# HELP temporal_num_pollers Current number of active pollers per queue type\r\n# HELP temporal_sticky_cache_hit Count of times the workflow cache was used for a new workflow task\r\n# HELP temporal_sticky_cache_size Current number of cached workflows\r\n# HELP temporal_worker_start Count of the number of initialized workers\r\n# HELP temporal_worker_task_slots_available Current number of available slots per task type\r\n# HELP temporal_workflow_completed Count of successfully completed workflows\r\n# HELP temporal_workflow_continue_as_new Count of continued-as-new workflows\r\n# HELP temporal_workflow_endtoend_latency Histogram of total workflow execution latencies\r\n# HELP temporal_workflow_failed Count of failed workflows\r\n# HELP temporal_workflow_task_execution_latency Histogram of workflow task execution (not replay) latencies\r\n# HELP temporal_workflow_task_queue_poll_empty Count of workflow task queue poll timeouts (no new task)\r\n# HELP temporal_workflow_task_queue_poll_succeed Count of workflow task queue poll successes\r\n# HELP temporal_workflow_task_replay_latency Histogram of workflow task replay latencies\r\n# HELP temporal_workflow_task_schedule_to_start_latency Histogram of workflow task schedule-to-start latencies\r\n```","createdAt":"2024-02-07T16:33:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1353#issuecomment-1932430013","viewerDidAuthor":false},{"id":"IC_kwDOEujx1850Y-Ip","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@Sushisource I haven't yet dug into this one, but from a very quick look, it seems like the metrics that don't have the `temporal_` prefix come from the Rust client.\r\n\r\nThis is a regression introduced in TS SDK 1.9.0, so very likely related to the major metrics refactor done ~6 months ago. Does that ring a bell? Can you think of anything that we may have missed on the TS SDK/bridge side that would explain this?","createdAt":"2024-02-19T15:31:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1353#issuecomment-1952703017","viewerDidAuthor":false},{"id":"IC_kwDOEujx1850Y_Xp","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@antmendoza Would you mind checking if Python has the same issue?","createdAt":"2024-02-19T15:33:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1353#issuecomment-1952708073","viewerDidAuthor":false},{"id":"IC_kwDOEujx1850Z7Vv","author":{"login":"antmendoza"},"authorAssociation":"MEMBER","body":"@mjameswh the current prometheus example https://github.com/temporalio/samples-python/tree/main/prometheus shows all metrics with temporal_ prefix \r\n\r\nit uses [python-sdk 1.5.0](https://github.com/temporalio/sdk-python/releases/tag/1.5.0) \r\n\r\nhttps://github.com/temporalio/samples-python/blob/6bcab28f85461c13e594ebc15ec3a111533a3ae7/pyproject.toml#L20 \r\n\r\n\r\n","createdAt":"2024-02-19T17:53:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1353#issuecomment-1952953711","viewerDidAuthor":false},{"id":"IC_kwDOEujx186FCNAv","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Fixed by #1441.","createdAt":"2024-07-16T22:51:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1353#issuecomment-2231947311","viewerDidAuthor":false}],"createdAt":"2024-02-07T14:19:03Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1353,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] some metrics are not prefixed with \"temporal_\"","updatedAt":"2024-07-16T22:51:41Z","url":"https://github.com/temporalio/sdk-typescript/issues/1353"}
