{"assignees":[{"id":"MDQ6VXNlcjUyMzA0","login":"bergundy","name":"Roey Berman","databaseId":0}],"author":{"id":"MDQ6VXNlcjE1Njc0OTg=","is_bot":false,"login":"schickling","name":"Johannes Schickling"},"body":"Currently the worker entrypoint file(s) (e.g. `src/worker.ts`) are doing both bundling and execution.\r\n\r\n![CleanShot 2021-10-19 at 16 12 20](https://user-images.githubusercontent.com/1567498/137928470-a112c37a-2f15-4ea8-a3d6-5e4e6e629c40.png)\r\n\r\nFor my application, I'd like to take the responsibility of the bundling (and e.g. use something like `esbuild` instead of Webpack) and have my worker entrypoint (e.g. invoked by `nodemon`) only trigger the actual code execution and not any kind of building/bundling when starting.","closedAt":"2021-10-26T04:11:19Z","comments":[{"id":"IC_kwDOEujx1844b9NG","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@schickling it'd take some work to support bundling with anything other than webpack from my experience.\r\nThe bundling process isn't that straight forward, user code needs to be lazily loaded so the runtime can be properly prepared for workflow execution.\r\nIt should be straight forward to save the bundle to disk and load it on worker startup for cases like production deployment.","createdAt":"2021-10-19T15:41:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/310#issuecomment-946852678","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844ghB0","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@lorensr @schickling @sw-yx I'd like some feedback on the public API for this.\r\n\r\nIn order to support this we'd need to export the `WorkflowCodeBundler` class added in #317 for users to be able to create the bundle.\r\nIn addition we need to understand how to pass this into the WorkerOptions, a few options come to mind.\r\n\r\n1. Remove the `workflowsPath` and `nodeModulesPaths` options in favor of a new `workflowCodeBundle` option\r\n  * Pro: much more explicit about what's going on\r\n  * Con: More verbose samples\r\n2. Add the `workflowCodeBundle` option to the existing options.\r\n\r\n`workflowCodeBundle` could either be a path (string), the bundle itself (string / buffer / stream), I'm not sure what would be most convenient.\r\nI'm leaning towards the string because it's the most flexible option.\r\n\r\nExample:\r\n```ts\r\nconst workflowCodeBundle = await WorkflowCodeBundler({ workflowsPath });\r\nconst worker = await Worker.create({ workflowCodeBundle, ... });\r\n```","createdAt":"2021-10-20T21:24:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/310#issuecomment-948047988","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844gjwx","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"> I'm leaning towards the string because it's the most flexible option.\r\n\r\nBy string do you mean path?\r\n\r\nAwaiting a SentenceCase function feels weird to me. SentenceCase makes me want to do `new WorkflowCodeBundler()` or `WorkflowCodeBundler.bundle()`. What about:\r\n\r\n```ts\r\n// built-in bundling\r\nconst workflowCodeBundle = await bundleWorkflowCode({ workflowsPath });\r\nconst worker = await Worker.create({ workflowCodeBundle, ... });\r\n\r\n// dev doing their own bundling:\r\nconst worker = await Worker.create({ workflowCodeBundle: './bundle.js', ... });\r\n```\r\n\r\nThat thing is happening where the word \"bundle\" is starting to sound really strange to me ðŸ˜†","createdAt":"2021-10-20T21:44:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/310#issuecomment-948059185","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844hL_7","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"So the return value of `bundleWorkflowCode` is a string which means that we can't use pass a path using the same parameter name.\r\nI usually like to call path params what they are for clarity, e.g. `workflowCodeBundlePath`.\r\nAnother option is to have `workflowCodeBundle` param type: `{ path: string } | { code: string }` and have `bundleWorkflowCode` return `{ code: string }`.","createdAt":"2021-10-21T03:20:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/310#issuecomment-948223995","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844spGX","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"We could have both `bundleWorkflowCode` and `workflowCodeBundlePath`:\r\n\r\n```ts\r\n// built-in bundling\r\nconst workflowCodeBundle = await bundleWorkflowCode({ workflowsPath });\r\nconst worker = await Worker.create({ workflowCodeBundle, ... });\r\n\r\n// dev doing their own bundling:\r\nconst worker = await Worker.create({ workflowCodeBundle: 'js code', ... });\r\nconst worker = await Worker.create({ workflowCodeBundlePath: './bundle.js', ... });\r\n```","createdAt":"2021-10-25T19:12:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/310#issuecomment-951226775","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844srlp","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"IDK, I kind of like the `{ path: string } | { code: string }` solution.\r\nRemoves some of the clutter from the already overwhelming WorkerOptions interface.","createdAt":"2021-10-25T19:24:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/310#issuecomment-951236969","viewerDidAuthor":false}],"createdAt":"2021-10-19T14:16:23Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":{"number":2,"title":"beta","description":"","dueOn":null},"number":310,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":7}}],"state":"CLOSED","title":"[Feature Request] Support separating bundling and executing of workers","updatedAt":"2021-10-26T04:11:19Z","url":"https://github.com/temporalio/sdk-typescript/issues/310"}
