{"assignees":[],"author":{"id":"MDQ6VXNlcjI4Njc5","is_bot":false,"login":"joebowbeer","name":"Joe Bowbeer"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nTestability is a major selling point of Temporal but the Node SDK and its docs are [currently lacking](https://docs.temporal.io/docs/node/hello-world#testing):\r\n\r\n> There's no official support for testing Workflows and Activities.\r\n> * Since Activities are async functions, they should be testable as long as you avoid using Context or are able to mock it.\r\n> * You can test Workflows by running them with a WorkflowClient.\r\n\r\nI added a basic ts-jest configuration in [one example](https://github.com/temporalio/temporal-pendulum/blob/main/position-node/jest.config.js), but I couldn't figure out how to write a workflow test.\r\n\r\n### Describe the solution you'd like\r\n\r\nI think I need something like the TestWorkflowEnvironment that Java and Go provide before I can easily test workflows.\r\n\r\nIt would be helpful if the create-project example included a basic jest (and eslint) configuration.\r\n\r\n### Additional context\r\n\r\nIt would also be helpful if the create-project example included a basic eslint configuration. Something that was useful, but not too bloated, and easily swapped out if needed.","closedAt":"2022-10-11T23:28:04Z","comments":[{"id":"IC_kwDOEujx1842l1Ap","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"This is a known issue, thanks for opening this so it can be tracked.","createdAt":"2021-09-09T08:43:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-915886121","viewerDidAuthor":false},{"id":"IC_kwDOEujx1843BEjJ","author":{"login":"vkarpov15"},"authorAssociation":"CONTRIBUTOR","body":"@joebowbeer you can take a look at https://github.com/temporalio/samples-node/pull/11, I added a basic test case there.\r\n\r\nThe trick is that you can stub out activity dependencies using sinon. The big thing that's missing is being able to advance time programatically, which is something that the Go SDK has a neat API for.","createdAt":"2021-09-20T15:21:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-923027657","viewerDidAuthor":false},{"id":"IC_kwDOEujx1843CYF9","author":{"login":"joebowbeer"},"authorAssociation":"CONTRIBUTOR","body":"@vkarpov15 Thanks! I'm motivated to have another look at the pendulum test now.\r\n\r\nI like sinon and occasionally will even use proxyquire for the most test-resistant cases.\r\n\r\nAt first glance, though, I like the readability of the golang tests better, but the http test reads OK once I dive in.\r\n\r\nI'll try ts-jest in the pendulum sample and see how it goes. Jest is simpler and more opinionated than mocha, and provides its own mocking support.","createdAt":"2021-09-20T22:09:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-923369853","viewerDidAuthor":false},{"id":"IC_kwDOEujx1843GNQX","author":{"login":"joebowbeer"},"authorAssociation":"CONTRIBUTOR","body":"@vkarpov15 Following up, after looking at the http sample _integration_ test in more detail:\r\n\r\n### Should TypeScript workflows be unit-testable?\r\n\r\nThe Go and Java SDKs have an in-memory runner to enable this. The http _integration_ test is doing something similar to what the Go and Java docs present as _unit_ tests. I tried to run the samples-node http test, saw a transport error, and only then realized I needed to run a real local temporal server.\r\n\r\n### ts-tester vs transpiled src\r\n\r\nIt surprised me that the test was importing from `../lib` which, e.g., the starter code does not do explicitly.\r\n\r\nI'm bothered by the inconsistency of having ts-node load the test code, while the code under test is loaded from the transpiler's outDir: `../lib`.\r\n\r\nUnless ts-node can run everything, I'd prefer to see the src and test code handled the same way: transpiled first and loaded from the outDir. This way, perhaps with some aliasing, the explicit `../lib` can be hidden from the test code.\r\n\r\n### mocha vs jest\r\n\r\nI think jest would make a better impression.\r\n\r\nJest is newer, simpler, more-opinionated mocha, and jest mocking should be able to replace sinon as well. I think most react programmers are using jest now.\r\n\r\n### src vs test\r\n\r\nI would prefer to have the test files beside their src counterpart.\r\n\r\nFor example:  https://github.com/temporalio/temporal-pendulum/blob/main/position-node/src/workflows/pendulum.test.ts\r\n\r\nThis simplifies adding a new test file, and as another benefit, it easily hides at least one of the explicit references to `../lib`.\r\n\r\nNot a big difference, but simpler is better when it comes to samples.","createdAt":"2021-09-21T20:51:40Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-924374039","viewerDidAuthor":false},{"id":"IC_kwDOEujx1843HOqM","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@joebowbeer we have plans to support proper testing for Core based SDKs, it's quite an undertaking because we have to implement a mocked version of the server for time skipping support.\r\n\r\nSome test runners ([jest included](https://www.npmjs.com/package/ts-jest)) support running TS directly ([alternative](https://github.com/facebook/jest#using-typescript)).\r\nI've usually avoided that because I always have a terminal running the typescript compiler in watch mode which is significantly faster than recompiling from scratch (not sure if there's a test runner that can do that).\r\n\r\nI don't have a test framework preference, both jest and mocha are okay IMO.\r\n\r\nAs for src vs. test, a lot of devs like to separate their test code.\r\nWe might want to use [project references](https://www.typescriptlang.org/docs/handbook/project-references.html) to preserve the output directory structure (`src` -> `lib` instead of `src` -> `lib/src`).","createdAt":"2021-09-22T06:58:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-924641932","viewerDidAuthor":false},{"id":"IC_kwDOEujx1843HYzq","author":{"login":"joebowbeer"},"authorAssociation":"CONTRIBUTOR","body":"@bergundy Thanks for clarifying. To be clear, I'm pushing for a simple approach to make the samples easy to read and test, and to encourage testing from day -1. (What I would actually use in a commercial project might be different.)\r\n\r\nWhat you are describing sounds good to me: Have both src and test code transpiled via watch and run from the outDir.\r\n\r\nI wrote:\r\n\r\n> I'd prefer to see the src and test code handled the same way: transpiled first and loaded from the outDir\r\n\r\nBy doing this, the explicit outDir path should not need to appear in the src or test code.\r\n\r\nHowever, this is not how the http integration test is currently configured. Only its src is transpiled to outDir while its test code is transpiled by ts-mocha, and there are two references to outDir in the test code.\r\n\r\nWhen transpiling both src and tests, I think it works best if the path relationships are maintained in the outDir. Then the relative paths and aliases will be preserved in the outDir.\r\n\r\nExample: `src` -> `lib/src`, `test` -> `lib/test`\r\n\r\nAnother way to preserve this relationship is to have `.ts` and `.test.ts` as siblings in the same folder, as I prefer for unit tests, but neither way should be precluded.\r\n\r\nSimilarly, neither jest nor mocha+sinon should be precluded, but I think jest will make for better examples because it has fewer moving parts and is designed for ease of use.","createdAt":"2021-09-22T08:02:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-924683498","viewerDidAuthor":false},{"id":"IC_kwDOEujx1849f9Dx","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"For Google, the error you get when you call an activity function directly (eg when unit testing) that uses `Context.current()`: `Activity context not initialized`. \r\n\r\nCurrent solution is to mock Context or use integration tests (have a Worker call activities, which will work because the Worker sets up Context)","createdAt":"2022-02-07T18:32:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-1031786737","viewerDidAuthor":false},{"id":"IC_kwDOEujx1849iAKL","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Test framework is coming, and it will support mocking the activity context.","createdAt":"2022-02-08T08:10:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"EYES","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-1032323723","viewerDidAuthor":false},{"id":"IC_kwDOEujx185MBQr1","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Closing this as part of issue cleanup.","createdAt":"2022-10-11T23:28:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/226#issuecomment-1275398901","viewerDidAuthor":false}],"createdAt":"2021-09-07T19:48:48Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":226,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"[Feature Request] Test support","updatedAt":"2022-10-11T23:28:04Z","url":"https://github.com/temporalio/sdk-typescript/issues/226"}
