{"assignees":[],"author":{"id":"MDQ6VXNlcjM3MDgyMDA5","is_bot":false,"login":"josiah-roberts","name":"Josiah \"Rebase\" Roberts"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nEverything here also applies to `QueryDefinition`, but I'll use `SignalDefinition` in these examples.\r\n\r\nBecause `SignalDefinition<Args>` does not retain the type of its `name`, it can be difficult to create broader systems that keep track of the legal signals and queries that can be sent to a workflow. \r\n\r\nFor example:\r\n```typescript\r\nconst signalA = defineSignal<[string]>('a');\r\nconst signalB = defineSignal<[string]>('b');\r\n\r\nexport function myWorkflow() {\r\n  ... use these signals\r\n}\r\n\r\n// This doesn't work: these are just SignalDefinition<[string]>\r\n// it matches *any* SignalDefinition<[string]>, not just 'a' and 'b'\r\nexport type SupportedSignals = typeof signalA | typeof signalB;\r\n\r\n// This also doesn't work: SignalDefinition<_Args>['name'] is typed as string\r\nexport type SupportedSignalNames = typeof signalA.name | typeof signalB.name;\r\n```\r\n\r\nAs a result, there is no straightforward way to define within the type system what the legal queries/signals to send to a workflow are. We can use proximity (\"this signal was exported by the same module as the workflow, it probably makes sense to send it\"), but we can't create structures that have `tsc` enforce this for us.\r\n\r\n### Describe the solution you'd like\r\n\r\nThis issue can be fixed by varying the type of `name` with the type of the passed in string.\r\n\r\n`SignalDefinition` becomes:\r\n```typescript\r\nexport interface SignalDefinition<Args extends any[] = [], Name extends string = string> {\r\n  type: 'signal';\r\n  name: Name;\r\n}\r\n```\r\n\r\nThis presents some challenges for the definition of `defineSignal` though. You can't have partially-inferred generics in typescript, so we are forced to specify the name on both a type and a value level\r\n```typescript\r\nexport function defineSignal<Name extends string, Args extends any[] = []>(name: Name): SignalDefinition<Args, Name> {\r\n  return {\r\n    type: 'signal',\r\n    name,\r\n  };\r\n}\r\n\r\n// Annoying to have to specify 'some name' twice\r\nconst stringSignal = defineSignal<'some-name', [string]>('some-name');\r\n```\r\n\r\nA curried alternative removes the duplication, though with a slightly unfamiliar style. This would be my preference.\r\n```typescript\r\nfunction defineNamedSignal<Name extends string>(name: Name): <Args extends any[]>() => SignalDefinition<Args, Name> {\r\n  return () => ({\r\n    type: 'signal',\r\n    name,\r\n  })\r\n}\r\n\r\ndefineNamedSignal('some-name')<[string]>();\r\n```\r\n\r\nFinally, we could also make this level of specificity opt-in, so that only consumers who care to reason about names on a type-level pay the cost for it:\r\n\r\n```typescript\r\nexport function defineSignal<Args extends any[] = [], Name extends string = string>(name: Name): SignalDefinition<Args, Name> {\r\n  return {\r\n    type: 'signal',\r\n    name,\r\n  };\r\n}\r\n\r\n// Retains old behavior where the resulting name is of type string\r\nconst stringSignal = defineSignal<[string]>('some-name');\r\n\r\n// Allows being more specific\r\nconst stringSignal = defineSignal<[string], 'some-name'>('some-name');\r\n```\r\n\r\nEither way, after this change it becomes possible to reason about the names of signals on a type level, tell them apart, and apply logic to them.","closedAt":"2023-03-22T21:30:03Z","comments":[{"id":"IC_kwDOEujx185YO2LA","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Fixed in #1056.","createdAt":"2023-03-22T21:30:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1052#issuecomment-1480286912","viewerDidAuthor":false}],"createdAt":"2023-02-10T23:46:26Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1052,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Retain type information regarding signal/query `name`","updatedAt":"2023-03-22T21:30:03Z","url":"https://github.com/temporalio/sdk-typescript/issues/1052"}
