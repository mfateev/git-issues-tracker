{"assignees":[{"id":"MDQ6VXNlcjI1MTI4OA==","login":"lorensr","name":"Loren ☺️","databaseId":0}],"author":{"id":"MDQ6VXNlcjE1ODk1MA==","is_bot":false,"login":"airhorns","name":"Harry Brundage"},"body":"### What are you really trying to do?\r\n\r\nI'm trying to override the runtime logger to use existing logging infrastructure for formatting and structuring, and it works great for logs generated by the worker and sinks and whatnot, but the logs generated by webpack when building the workflow bundle do not flow through my logger. \r\n\r\n### Describe the bug\r\n\r\nLogs are emitted using `console.error`, instead of the custom entry function passed to the `DefaultLogger` passed to `Runtime.install`\r\n\r\n### Minimal Reproduction\r\n\r\n```typescript\r\n// install the runtime with a custom logger\r\nRuntime.install({\r\n  logger: new DefaultLogger(\"INFO\", (entry) => {\r\n    console.log(\"here's a prefix:\", entry)\r\n  })\r\n});\r\n\r\n// then boot a worker with workflowsPath so webpack builds the bundle\r\nawait Worker.create({\r\n  workflowsPath: require.resolve(...)\r\n});\r\n\r\n// note how webpack logs are not prefixed\r\n```\r\n\r\n### Environment/Versions\r\n\r\n\r\n- OS and processor: macOS 12.1.3\r\n- Temporal Version: temporalite + `@temporalio/worker@0.20.2`\r\n- No docker, no k8s\r\n\r\n### Additional context\r\n\r\nThanks!\r\n","closedAt":"2022-06-04T00:41:03Z","comments":[{"id":"IC_kwDOEujx185CF9hG","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Thanks for reporting, we'll look into it","createdAt":"2022-04-25T17:44:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/604#issuecomment-1108858950","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EVdqJ","author":{"login":"vkarpov15"},"authorAssociation":"CONTRIBUTOR","body":"I took a look and I'm unable to repro this issue. Running the below code:\r\n\r\n```ts\r\nimport { Runtime, DefaultLogger, Worker } from '@temporalio/worker';\r\nimport * as activities from './activities';\r\n\r\nasync function run() {\r\n  // Step 1: Register Workflows and Activities with the Worker and connect to\r\n  // the Temporal server.\r\n  Runtime.install({\r\n    logger: new DefaultLogger(\"INFO\", (entry) => {\r\n      console.log(\"here's a prefix:\", entry)\r\n    })\r\n  });\r\n\r\n  const worker = await Worker.create({\r\n    workflowsPath: require.resolve('./workflows'),\r\n    activities,\r\n    taskQueue: 'hello-world',\r\n  });\r\n  // Worker connects to localhost by default and uses console.error for logging.\r\n  // Customize the Worker by passing more options to create():\r\n  // https://typescript.temporal.io/api/classes/worker.Worker\r\n  // If you need to configure server connection parameters, see docs:\r\n  // https://docs.temporal.io/docs/typescript/security#encryption-in-transit-with-mtls\r\n\r\n  // Step 2: Start accepting tasks on the `tutorial` queue\r\n  await worker.run();\r\n}\r\n\r\nrun().catch((err) => {\r\n  console.error(err);\r\n  process.exit(1);\r\n});\r\n```\r\n\r\ngives me the below output:\r\n\r\n```\r\n$ npm start\r\n\r\n> temporal-hello-world@0.1.0 start\r\n> ts-node src/worker.ts\r\n\r\n  2022-06-04T00:22:18.462740Z  INFO temporal_sdk_core::worker: Initializing worker, task_queue: hello-world\r\n\r\nhere's a prefix: {\r\n  level: 'INFO',\r\n  message: 'asset \\x1B[1m\\x1B[32mmain.js\\x1B[39m\\x1B[22m 518 KiB \\x1B[1m\\x1B[32m[emitted]\\x1B[39m\\x1B[22m (name: main)',\r\n  meta: undefined,\r\n  timestampNanos: 1654302138979125441n\r\n}\r\nhere's a prefix: {\r\n  level: 'INFO',\r\n  message: 'runtime modules 937 bytes 4 modules',\r\n  meta: undefined,\r\n  timestampNanos: 1654302138980769534n\r\n}\r\nhere's a prefix: {\r\n  level: 'INFO',\r\n  message: 'modules by path \\x1B[1m./node_modules/@temporalio/\\x1B[39m\\x1B[22m 140 KiB',\r\n  meta: undefined,\r\n  timestampNanos: 1654302138980860746n\r\n}\r\n```\r\n\r\nIt looks like Webpack output is running through the logger. Am I missing something?","createdAt":"2022-06-04T00:30:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/604#issuecomment-1146477193","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EVeTZ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Going over the code, it looks like we do pass the logger in (and confirmed by @vkarpov15 - thanks).\r\nThe only case where the runtime logger isn't used is if you manually call `bundleWorkflowCode` which I think is acceptable since it doesn't require instantiating the Rust Core runtime.","createdAt":"2022-06-04T00:41:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/604#issuecomment-1146479833","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EWDx6","author":{"login":"airhorns"},"authorAssociation":"NONE","body":"Thanks folks! I think I did notice that this got fixed somewhere along the way as well -- forgot to come over here and close this, my bad!","createdAt":"2022-06-04T15:21:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/604#issuecomment-1146633338","viewerDidAuthor":false}],"createdAt":"2022-04-21T13:27:04Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":6,"title":"1.0","description":"","dueOn":null},"number":604,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] Runtime logger isn't used by webpack bundler","updatedAt":"2022-06-04T15:21:46Z","url":"https://github.com/temporalio/sdk-typescript/issues/604"}
