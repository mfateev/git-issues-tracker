{"assignees":[],"author":{"id":"MDQ6VXNlcjg4ODcxNw==","is_bot":false,"login":"doodledood","name":""},"body":"### What are you really trying to do?\r\n\r\nTrying to execute a workflow from a client (worked in the past).\r\n\r\n### Describe the bug\r\n\r\nThe worker is set up this way:\r\n`\r\n    const worker = await Worker.create({\r\n        connection,\r\n        workflowsPath: require.resolve('./workflows'),\r\n        activities: createActivities(someDep),\r\n        taskQueue: 'test-queue',\r\n        bundlerOptions: {\r\n            ignoreModules: ['./logger'],\r\n        },\r\n        // Inject sinks\r\n        sinks: defaultSinks(workflowLogger)\r\n    });\r\n`\r\n\r\nThe client launches the workflow. The worker picks it up, but then immediately fails with this error: \r\n\r\n`\r\n[ERROR] Failed to activate workflow {\r\n[worker]   runId: 'e0a7da3f-dde2-4d20-9b79-0d5eefbfc137',\r\n[worker]   error: /usr/src/app/workflow-bundle-e081d7d12c0bb7760cad.js:27106\r\n[worker]   /******/             if (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\r\n[worker]                                        ^\r\n[worker]\r\n[worker]   Error: Automatic publicPath is not supported in this browser\r\n[worker]       at webpack/runtime/publicPath:17:0\r\n[worker]       at null:null:null\r\n[worker]       at null:null:null\r\n[worker]       at Script.runInContext (node:vm:141:12)\r\n[worker]       at VMWorkflowCreator.getContext (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/vm.js:63:21)\r\n[worker]       at VMWorkflowCreator.createWorkflow (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/vm.js:32:36)\r\n[worker]       at handleRequest (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:35)\r\n[worker]       at MessagePort.<anonymous> (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:83:38)\r\n[worker]       at [nodejs.internal.kHybridDispatch] (node:internal/event_target:737:20)\r\n[worker]       at exports.emitMessage (node:internal/per_context/messageport:23:28),\r\n[worker]   workflowExists: false\r\n[worker] }\r\n`\r\n\r\nI noticed this happens when I try to run the `worker.js` using `node dist/worker.js` after building the typescript files. However, it does work correctly when using `ts-node` like `ts-node src/worker.ts`\r\n\r\n\r\n### Minimal Reproduction\r\n\r\nLaunch a Kubernetes cluster with Temporal set up and a worker.\r\nStart a workflow with `await client.workflow.start(` from a client.\r\nWatch the worker; it raises the previous error.\r\n\r\n### Environment/Versions\r\n\r\n- Windows 10 x86\r\n- Docker Desktop + Minikube (Kubernetes setup)\r\n- Temporal version 1.21.1 (auto-setup) docker image\r\n","closedAt":"2023-08-04T20:30:27Z","comments":[{"id":"IC_kwDOEujx185hyPab","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Your Workflow code is somehow importing an NPM package that uses Webpack's automatic `publicPath` feature. That feature only makes sense in a web app (ie. that package should be imported from web UI code, not from backend code). The error message is produced by the imported library itself, not by the Temporal SDK.\r\n\r\nReview your Workflow's imports for anything that should not be there. You may also try to inspect your generated workflow bundle (`/usr/src/app/workflow-bundle-e081d7d12c0bb7760cad.js`, at line 27106) to find out exactly which package is causing that error, then try to figure out why is that library getting imported from your workflow code.","createdAt":"2023-07-18T16:34:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1175#issuecomment-1640560283","viewerDidAuthor":false},{"id":"IC_kwDOEujx185jT12Z","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@doodledood I'm closing this ticket, as there is nothing to do on our side.\r\n\r\nFeel free to continue the discussion if you still need help. You may also get help through our [Slack community](https://t.mp/slack) or our [community forum](https://community.temporal.io/).","createdAt":"2023-08-04T20:30:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1175#issuecomment-1666145689","viewerDidAuthor":false},{"id":"IC_kwDOEujx186D3Q1U","author":{"login":"0xBigBoss"},"authorAssociation":"NONE","body":"Just came to say for others encountering this. I am running my workers using `ts-node` for now, this was due to `@supabase/supabase-js` importing `@supabase/node-fetch/browser`. The fix for me at least was to pass a custom bundle option to ignore the troublesome package. YMMV\r\n\r\n```ts\r\n  const worker = await Worker.create({\r\n    workflowsPath: fileURLToPath(workflowsPathUrl),\r\n    activities,\r\n    taskQueue: 'dev',\r\n    bundlerOptions: {\r\n      ignoreModules: ['@supabase/supabase-js'],\r\n    },\r\n  })\r\n```","createdAt":"2024-07-07T03:06:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1175#issuecomment-2212302164","viewerDidAuthor":false}],"createdAt":"2023-07-17T09:53:52Z","labels":[],"milestone":null,"number":1175,"reactionGroups":[],"state":"CLOSED","title":"[Support] Activating a workflow causes \"Automatic publicPath is not supported in this browser\" (error when using node but not node-ts)","updatedAt":"2024-07-07T03:06:36Z","url":"https://github.com/temporalio/sdk-typescript/issues/1175"}
