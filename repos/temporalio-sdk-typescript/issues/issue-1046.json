{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ☺️"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nStart and cancel a workflow that just calls an activity that sleeps.\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\nWorkflowTaskFailed with message `UnhandledCommand`\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\nhttps://github.com/lorensr/workflow-statuses/blob/3b1d476fca708a8e1e98a711c9caa94e3da064cc/src/client.ts#L29-L35\r\n\r\n![image](https://user-images.githubusercontent.com/251288/216097924-7fc2cb89-5d3b-4c39-a173-bd3f0637ec12.png)\r\n","closedAt":"2023-06-07T21:31:57Z","comments":[{"id":"IC_kwDOEujx185ULsnO","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Issue was `ms('1 month')` returns `undefined`. Maybe we guard at runtime against undefined any place we support `ms` strings?","createdAt":"2023-02-01T16:30:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1046#issuecomment-1412352462","viewerDidAuthor":false},{"id":"IC_kwDOEujx185UMAbO","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Can you provide more info?\r\nHow do we reproduce this step by step?","createdAt":"2023-02-01T17:22:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1046#issuecomment-1412433614","viewerDidAuthor":false},{"id":"IC_kwDOEujx185UMz3A","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"```\r\ngit clone https://github.com/lorensr/workflow-statuses.git\r\ngit checkout 3b1d476fca708a8e1e98a711c9caa94e3da064cc\r\nnpm i\r\nnpm start\r\nnpm run workflow\r\n```","createdAt":"2023-02-01T19:59:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1046#issuecomment-1412644288","viewerDidAuthor":false},{"id":"IC_kwDOEujx185UM-gF","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"> Maybe we guard at runtime against undefined any place we support ms strings?\r\n\r\nI'm very surprised that `ms` doesn't throw exception on strings that don't match expected pattern.\r\n\r\nWe can certainly ensure on our side that if someone actually passes a value, and we then pass that value to `ms`, and `ms` return `undefined`, then we explicitly throw an error on this. We can also be more defensive in places where a value is mandatory, such as `sleep(x)`.\r\n\r\nHowever, in most places where we expect `ms`-like values, that value is optional, so it is impossible for us to catch cases where a user did something like `condition(fn, ms('2 months'))`.","createdAt":"2023-02-01T20:34:54Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1046#issuecomment-1412687877","viewerDidAuthor":false}],"createdAt":"2023-02-01T16:10:07Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1046,"reactionGroups":[],"state":"CLOSED","title":"[Bug] `sleep('1 month')` results in UnhandledCommand WFT failure","updatedAt":"2023-06-07T21:31:57Z","url":"https://github.com/temporalio/sdk-typescript/issues/1046"}
