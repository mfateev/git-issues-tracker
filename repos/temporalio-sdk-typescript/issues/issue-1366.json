{"assignees":[],"author":{"id":"MDQ6VXNlcjE3NDg2NA==","is_bot":false,"login":"knpwrs","name":"Ken Powers"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nTemporal does not have any mechanism to implement priority queues.\r\n\r\n### Describe the solution you'd like\r\n\r\nhttps://github.com/contribsys/faktory implements priority-like functionality on the worker side by implementing the ability to poll multiple queues for tasks, either in strict order, or by weighted random (to prevent starvation).\r\n\r\nConsider the official https://github.com/contribsys/faktory_worker_go library:\r\n\r\n```go\r\n// pull jobs from these queues, in this order of precedence\r\nmgr.ProcessStrictPriorityQueues(\"critical\", \"default\", \"bulk\")\r\n\r\n// alternatively you can use weights to avoid starvation\r\nmgr.ProcessWeightedPriorityQueues(map[string]int{\"critical\":3, \"default\":2, \"bulk\":1})\r\n```\r\n\r\nThe unofficial https://github.com/jbielick/faktory_worker_node likewise implements this:\r\n\r\n```ts\r\nfaktory.work({ queues: [\"immediately\", \"afterwards\"] });\r\nfaktory.work({ queues: { critical: 10, default: 1 } });\r\n```\r\n\r\n### Additional context\r\n\r\nI would imagine the API would look like this in the Temporal TypeScript SDK:\r\n\r\n```ts\r\nconst worker = await Worker.create({\r\n  // ...\r\n  taskQueue: 'hello-world',\r\n  // or...\r\n  taskQueue: ['immediately', 'afterwards'],\r\n  // or...\r\n  taskQueue: { critical: 10, default: 1 },\r\n});\r\n```\r\n\r\nThe `taskQueue` property could also be named `taskQueues` and then something like https://github.com/sindresorhus/type-fest/blob/3ef12b0bdc7c29321daa304abf7a70ed49b9aa7d/source/require-one-or-none.d.ts can ensure that only one of either `taskQueue` or `taskQueues` can be passed to `Worker.create`.","closedAt":"2024-03-01T21:31:54Z","comments":[{"id":"IC_kwDOEujx1851KiRp","author":{"login":"knpwrs"},"authorAssociation":"NONE","body":"I just thought of something, but I haven't tried it yet. Would the following work, or does `Worker` cache the value of `taskQueue` being passed in?\r\n\r\n```ts\r\nawait Worker.create({\r\n  // ...\r\n  get taskQueue() {\r\n    // return weighted random queue name\r\n  },\r\n});\r\n```\r\n\r\nAn alternative API to what I proposed above could also be to pass a function as the value of `taskQueue`, or to accept a function called `getNextTaskQueue` or similar.","createdAt":"2024-02-27T02:54:39Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1366#issuecomment-1965696105","viewerDidAuthor":false},{"id":"IC_kwDOEujx1851qBvw","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Priority queues is a platform level feature that is not currently supported.\r\n\r\nOnce Temporal server adds support for this, we can add it to the SDK.\r\n\r\nMaking a task queue a getter won't work, it's only evaluated once on creation, not on every poll request.\r\n\r\nYou can create multiple workers in the meantime with different options such as https://typescript.temporal.io/api/interfaces/worker.WorkerOptions#maxconcurrentactivitytaskpolls\r\n\r\nFollow this issue for platform level support:\r\nhttps://github.com/temporalio/temporal/issues/1507","createdAt":"2024-03-01T21:31:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1366#issuecomment-1973951472","viewerDidAuthor":false}],"createdAt":"2024-02-27T02:43:44Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1366,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Support weighted random polling multiple task queues","updatedAt":"2024-03-01T21:31:54Z","url":"https://github.com/temporalio/sdk-typescript/issues/1366"}
