{"assignees":[],"author":{"id":"U_kgDOBjNPNA","is_bot":false,"login":"jwaaang","name":"Jack Wang"},"body":"### What are you really trying to do?\r\n\r\nI am trying to get a list of active workflowIds using temporal client.\r\n\r\n### Describe the bug\r\n\r\nI am trying to query all executions that are running and have some workflow name, when i run it i get:\r\n\r\n```\r\n/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call.ts:81\r\n  const error = new Error(message);\r\n                ^\r\nError: 2 UNKNOWN: too many filter conditions specified\r\n    at Object.callErrorFromStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call.ts:81:17)\r\n    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client.ts:358:36)\r\n    at /Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call-stream.ts:210:27\r\n    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@temporalio-client-npm-1.6.0-8d36687867-ed8c23c572.zip/node_modules/@temporalio/client/src/grpc-retry.ts:176:17)\r\n    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client-interceptors.ts:462:34)\r\n    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client-interceptors.ts:424:48)\r\n    at /Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call-stream.ts:334:24\r\n    at processTicksAndRejections (node:internal/process/task_queues:78:11)\r\nfor call at\r\n    at ServiceClientImpl.makeUnaryRequest (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client.ts:328:30)\r\n    at callMethod (/Users/jackwang/scaleapi/.yarn/unplugged/dd-trace-patch-1a35c08d8a/node_modules/dd-trace/packages/datadog-instrumentations/src/grpc/client.js:144:51)\r\n    at ServiceClientImpl.makeUnaryRequest (/Users/jackwang/scaleapi/.yarn/unplugged/dd-trace-patch-1a35c08d8a/node_modules/dd-trace/packages/datadog-instrumentations/src/grpc/client.js:19:14)\r\n    at Service.rpcImpl (/Users/jackwang/scaleapi/.yarn/cache/@temporalio-client-npm-1.6.0-8d36687867-ed8c23c572.zip/node_modules/@temporalio/client/src/connection.ts:341:21)\r\n    at Service.rpcCall (/Users/jackwang/scaleapi/.yarn/unplugged/protobufjs-npm-7.0.0-caea7a2a3b/node_modules/protobufjs/src/rpc/service.js:94:21)\r\n    at executor (/Users/jackwang/scaleapi/.yarn/cache/@protobufjs-aspromise-npm-1.1.2-71d00b938f-011fe7ef08.zip/node_modules/@protobufjs/aspromise/index.js:44:16)\r\n    at new Promise (<anonymous>)\r\n    at Object.asPromise (/Users/jackwang/scaleapi/.yarn/cache/@protobufjs-aspromise-npm-1.1.2-71d00b938f-011fe7ef08.zip/node_modules/@protobufjs/aspromise/index.js:28:12)\r\n    at Service.rpcCall (/Users/jackwang/scaleapi/.yarn/unplugged/protobufjs-npm-7.0.0-caea7a2a3b/node_modules/protobufjs/src/rpc/service.js:86:21)\r\n    at Service.listWorkflowExecutions (eval at Codegen (/Users/jackwang/scaleapi/.yarn/cache/@protobufjs-codegen-npm-2.0.4-36e188bbe6-59240c850b.zip/node_modules/@protobufjs/codegen/index.js:50:33), <anonymous>:4:15)\r\n    at WorkflowClient._list (/Users/jackwang/scaleapi/.yarn/cache/@temporalio-client-npm-1.6.0-8d36687867-ed8c23c572.zip/node_modules/@temporalio/client/src/workflow-client.ts:926:51)\r\n    at _list.next (<anonymous>)\r\n    at /Users/jackwang/scaleapi/packages/task-pipeline/src/scripts/query-open-workflows.ts:23:5\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at async bootstrap (/Users/jackwang/scaleapi/packages/task-pipeline/src/scripts/main.ts:10:5) {\r\n  code: 2,\r\n  details: 'too many filter conditions specified',\r\n  metadata: Metadata {\r\n    internalRepr: Map(1) { 'content-type' => [Array] },\r\n    options: {}\r\n  }\r\n}\r\n```\r\n\r\n### Minimal Reproduction\r\n```\r\n  const connection = await Connection.connect({address: TEMPORAL_ADDRESS});\r\n  const count = await connection.workflowService.countWorkflowExecutions({namespace: 'default', query: `WorkflowType=\"orchestratePipeline\" and ExecutionStatus=\"Running\"`});\r\n  console.log(JSON.stringify(count.count));\r\n  let execs;\r\n  const activeExecIds: string[] = [];\r\n\r\n  const counter = 0;\r\n  const client = app.get<WorkflowClient>(TEMPORAL_QUEUE_TOKEN);\r\n  for await (const workflow of client.list({\r\n    query: `WorkflowType=\"orchestratePipeline\" and ExecutionStatus=\"Running\"`,\r\n    pageSize: 5,\r\n  })) {\r\n    console.log(workflow);\r\n  }\r\n```\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: M1 Mac\r\n- Temporal Version: 1.6.0\r\n- Are you using Docker or Kubernetes or building Temporal from source? Temporal is on kubernetes\r\n\r\n### Additional context\r\n\r\nWeirdly enough this script (with the same query string) works for me:\r\n```\r\n  const connection = await Connection.connect({address: TEMPORAL_ADDRESS});\r\n  const count = await connection.workflowService.countWorkflowExecutions({namespace: 'default', query: `WorkflowType=\"orchestratePipeline\" and ExecutionStatus=\"Running\"`});\r\n  console.log(JSON.stringify(count.count));\r\n  let execs;\r\n  const activeExecIds: string[] = [];\r\n\r\n  const counter = 0;\r\n  do {\r\n    if (counter % 50 === 0) {\r\n      console.log(activeExecIds[activeExecIds.length - 1]);\r\n      console.log(activeExecIds.length);\r\n    }\r\n    execs = await connection.workflowService.listWorkflowExecutions({\r\n      namespace: 'default',\r\n      pageSize: 5,\r\n      query: `WorkflowType=\"orchestratePipeline\" and ExecutionStatus=\"Running\"`,\r\n      nextPageToken: execs ? execs.nextPageToken : null,\r\n    });\r\n    execs.executions.map(exec => {\r\n      if (exec.execution?.workflowId) {\r\n        activeExecIds.push(exec.execution?.workflowId);\r\n      }\r\n    });\r\n  } while(execs && execs.nextPageToken)\r\n  const csvStr = activeExecIds.join(\"\\n\");\r\n  fs.writeFileSync(FILE_TO_WRITE_TO, csvStr);\r\n```\r\nbut i think i am not using `nextPageToken` correctly since this infinite loops and i get back duplicate workflows. Am also curious to what i am doing wrong here.","closedAt":"2023-03-30T22:38:06Z","comments":[{"id":"IC_kwDOEujx185Y3XUi","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Which temporal server version are you using with which persistence option?\r\nIt's not an SDK bug, it's a server limitation.","createdAt":"2023-03-30T20:27:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1087#issuecomment-1490908450","viewerDidAuthor":false},{"id":"IC_kwDOEujx185Y35Xz","author":{"login":"jwaaang"},"authorAssociation":"NONE","body":"Temporal server version is: 1.17.0\r\nWe are using scyllaDB as persistence but it should be functionally the same as cassandra","createdAt":"2023-03-30T22:27:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1087#issuecomment-1491047923","viewerDidAuthor":false},{"id":"IC_kwDOEujx185Y37Eb","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Are you using ElasticSearch for the visibility database?\r\nCassandra doesn't support enhanced visibility.\r\n\r\nClosing because this isn't an SDK issue.","createdAt":"2023-03-30T22:38:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1087#issuecomment-1491054875","viewerDidAuthor":false},{"id":"IC_kwDOEujx185Y4uCH","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Jack—these docs pages might help:\n\nhttps://docs.temporal.io/visibility\n\nhttps://docs.temporal.io/cluster-deployment-guide\n\nAnd feel free to post questions to https://community.temporal.io/c/support/5\n\nOn Thu, Mar 30, 2023 at 6:38 PM Roey Berman ***@***.***>\nwrote:\n\n> Closed #1087 <https://github.com/temporalio/sdk-typescript/issues/1087>\n> as not planned.\n>\n> —\n> Reply to this email directly, view it on GitHub\n> <https://github.com/temporalio/sdk-typescript/issues/1087#event-8892437222>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAB5LGADLGXGEQSSUXAMSODW6YDNVANCNFSM6AAAAAAWNYWKJE>\n> .\n> You are receiving this because you are subscribed to this thread.Message\n> ID: ***@***.***\n> com>\n>\n","createdAt":"2023-03-31T04:16:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1087#issuecomment-1491263623","viewerDidAuthor":false}],"createdAt":"2023-03-30T20:15:31Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1087,"reactionGroups":[],"state":"CLOSED","title":"[Bug] 'too many filter conditions specified' on reasonable query","updatedAt":"2023-03-31T04:16:20Z","url":"https://github.com/temporalio/sdk-typescript/issues/1087"}
