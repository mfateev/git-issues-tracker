{"assignees":[],"author":{"id":"MDQ6VXNlcjE4MDE4ODY0","is_bot":false,"login":"danielrearden","name":"Daniel Rearden"},"body":"### What are you really trying to do?\r\n\r\nWe're dealing with some DNS errors in our K8s cluster and wanted to understand how the client would behave if it couldn't resolve the provided address. From what we were seeing in our traces, it looked like errors encountered when calling `start` weren't actually causing the Promise to reject. So I went to test the behavior locally and encountered this issue.\r\n\r\n### Describe the bug\r\n\r\nSetting the `Connection` address to an address that won't resolve (for example `does-not-exist` or `does-not-exist:7233`) causes subsequent `start` and `execute` calls from the client to exit the process. The exit processes with a 0 status code.\r\n\r\nIn the reproduction below, you can see that no errors are thrown and no additional logs are generated after the initial \"Starting workflow...\" one. The process literally just exits.\r\n\r\n### Minimal Reproduction\r\n\r\nhttps://github.com/danielrearden/samples-typescript/blob/client-bug/hello-world/src/client.ts\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor: macOS 12.3\r\n- Temporal Version: @temporalio/client@0.20.0\r\n- Are you using Docker or Kubernetes or building Temporal from source? Docker\r\n\r\n### Additional context\r\n\r\nIf the host _can_ be resolved but a connection can't be established, eventually the call rejects with a `ServiceError`, which is the same behavior I would expect.\r\n","closedAt":"2022-06-03T22:30:38Z","comments":[{"id":"IC_kwDOEujx185BJ0_V","author":{"login":"danielrearden"},"authorAssociation":"NONE","body":"Update: settings `interceptors` to an empty array causes the call to immediately fail with a `ServiceError` as expected, so the issue appears to be specific to something inside `makeGrpcRetryInterceptor`.\r\n\r\nUpdate 2: [This line](https://github.com/temporalio/sdk-typescript/blob/5214cbe829ee901eddb5dfcefc41b677036d0643/packages/client/src/grpc-retry.ts#L103) appears to be the culprit.","createdAt":"2022-04-08T17:06:31Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/580#issuecomment-1093095381","viewerDidAuthor":false},{"id":"IC_kwDOEujx185BLftQ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I see the problem and the fix is pretty trivial.\r\nWeâ€™re changing the connection constructor to an async factory soon so this will be a non issue when that change lands.","createdAt":"2022-04-09T00:46:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/580#issuecomment-1093532496","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EVOaB","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Looks like this doesn't happen anymore, probably solved by upgrading grpc-js","createdAt":"2022-06-03T22:30:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/580#issuecomment-1146414721","viewerDidAuthor":false}],"createdAt":"2022-04-08T16:10:31Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":580,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Process exits when calling client.start or client.execute","updatedAt":"2022-06-03T22:30:38Z","url":"https://github.com/temporalio/sdk-typescript/issues/580"}
