{"assignees":[],"author":{"id":"MDQ6VXNlcjMwOTgwOA==","is_bot":false,"login":"bennidhamma","name":"Ben Joldersma"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nJest is not exiting correctly due to an open handle in temporal. In and of itself not necessarily the worst thing in the world. but... I'm trying to collect code coverage with nyc, and it [seems](https://github.com/istanbuljs/nyc/issues/762) like nyc prefers to have processes exit cleanly before it attempts to collect coverage information.\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\nI don't really understand what's going on. here's a stack trace though:\r\n\r\n```\r\nJest has detected the following 1 open handle potentially keeping Jest from exiting:\r\n\r\n  â—  neon threadsafe function\r\n\r\n      93 | export { DataConverter, defaultPayloadConverter, errors };\r\n      94 |\r\n    > 95 | native.registerErrors(errors);\r\n         |        ^\r\n      96 | /**\r\n      97 |  * The worker's possible states\r\n      98 |  * * `INITIALIZED` - The initial state of the Worker after calling {@link Worker.create} and successful connection to the server\r\n\r\n      at Object.<anonymous> (../../sdk-typescript/packages/worker/src/worker.ts:95:8)\r\n      at Object.<anonymous> (../../sdk-typescript/packages/worker/src/index.ts:29:1)\r\n      at Object.<anonymous> (../../sdk-typescript/packages/testing/src/index.ts:20:1)\r\n      at Object.<anonymous> (test/unit/scheduling/v2/core/operations/restrict_appt_operating_hours_v2.test.ts:2:1)\r\n      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:317:13)\r\n      at runJest (node_modules/@jest/core/build/runJest.js:407:19)\r\n      at _run10000 (node_modules/@jest/core/build/cli/index.js:339:7)\r\n      at runCLI (node_modules/@jest/core/build/cli/index.js:190:3)\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\nIf you add `--detectOpenHandles` to the jest script in the activies-examples sample you can see the same error there.\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: Linux\r\n- Temporal Version: 1.1.0\r\n- using temporal test server\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n","closedAt":"2022-08-29T02:26:42Z","comments":[{"id":"IC_kwDOEujx185JSzL_","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"We're not sure yet either, tracking here: https://github.com/temporalio/samples-typescript/issues/189","createdAt":"2022-08-29T02:12:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/851#issuecomment-1229665023","viewerDidAuthor":false},{"id":"IC_kwDOEujx185JS1yt","author":{"login":"bennidhamma"},"authorAssociation":"NONE","body":"oops. i'm sorry I didn't search first.","createdAt":"2022-08-29T02:26:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/851#issuecomment-1229675693","viewerDidAuthor":false}],"createdAt":"2022-08-29T02:01:16Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":851,"reactionGroups":[],"state":"CLOSED","title":"Jest does not exit due to open handle in temporal","updatedAt":"2022-08-29T02:26:42Z","url":"https://github.com/temporalio/sdk-typescript/issues/851"}
