{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ‚ò∫Ô∏è"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nUse `env: node` on Render:\r\n\r\nhttps://github.com/anthonywong555/temporal-render-simple/blob/0dd74e4628c87e7663002cb93f8f64c0c328d4be/render.yaml#L107-L120\r\n\r\nor `env: docker` with our recommended Dockerfile:\r\n\r\nhttps://github.com/anthonywong555/temporalio-hello-world-js-app-worker-docker/blob/master/Dockerfile\r\n\r\nWith this simple sample:\r\n\r\nhttps://github.com/anthonywong555/temporalio-hello-world-js\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n```\r\nSep 20 11:40:44 AM  ==> Detected Node version 16.17.0\r\nSep 20 11:40:44 AM  ==> Starting service with 'npm run start.watch'\r\nSep 20 11:40:45 AM  \r\nSep 20 11:40:45 AM  > hello-world-js@0.1.0 start.watch\r\nSep 20 11:40:45 AM  > nodemon src/worker.js\r\nSep 20 11:40:45 AM  \r\nSep 20 11:40:45 AM  [nodemon] 2.0.20\r\nSep 20 11:40:45 AM  [nodemon] to restart at any time, enter `rs`\r\nSep 20 11:40:45 AM  [nodemon] watching path(s): src/**/*\r\nSep 20 11:40:45 AM  [nodemon] watching extensions: js,mjs,json\r\nSep 20 11:40:45 AM  [nodemon] starting `node src/worker.js`\r\nSep 20 11:40:47 AM  2022-09-20T15:40:47.201Z [INFO] Creating worker {\r\nSep 20 11:40:47 AM    options: {\r\nSep 20 11:40:47 AM      namespace: 'default',\r\nSep 20 11:40:47 AM      shutdownGraceTime: '10s',\r\nSep 20 11:40:47 AM      maxConcurrentActivityTaskExecutions: 100,\r\nSep 20 11:40:47 AM      maxConcurrentLocalActivityExecutions: 100,\r\nSep 20 11:40:47 AM      enableNonLocalActivities: true,\r\nSep 20 11:40:47 AM      maxConcurrentWorkflowTaskExecutions: 100,\r\nSep 20 11:40:47 AM      stickyQueueScheduleToStartTimeout: '10s',\r\nSep 20 11:40:47 AM      maxHeartbeatThrottleInterval: '60s',\r\nSep 20 11:40:47 AM      defaultHeartbeatThrottleInterval: '30s',\r\nSep 20 11:40:47 AM      isolateExecutionTimeout: '5s',\r\nSep 20 11:40:47 AM      workflowThreadPoolSize: 8,\r\nSep 20 11:40:47 AM      maxCachedWorkflows: 250,\r\nSep 20 11:40:47 AM      enableSDKTracing: false,\r\nSep 20 11:40:47 AM      showStackTraceSources: false,\r\nSep 20 11:40:47 AM      debugMode: false,\r\nSep 20 11:40:47 AM      interceptors: { activityInbound: [Array], workflowModules: [Array] },\r\nSep 20 11:40:47 AM      sinks: { defaultWorkerLogger: [Object] },\r\nSep 20 11:40:47 AM      workflowsPath: '/opt/render/project/src/src/workflows.js',\r\nSep 20 11:40:47 AM      activities: [Module: null prototype] { greet: [AsyncFunction: greet] },\r\nSep 20 11:40:47 AM      taskQueue: 'hello-javascript',\r\nSep 20 11:40:47 AM      shutdownGraceTimeMs: 10000,\r\nSep 20 11:40:47 AM      stickyQueueScheduleToStartTimeoutMs: 10000,\r\nSep 20 11:40:47 AM      isolateExecutionTimeoutMs: 5000,\r\nSep 20 11:40:47 AM      maxHeartbeatThrottleIntervalMs: 60000,\r\nSep 20 11:40:47 AM      defaultHeartbeatThrottleIntervalMs: 30000,\r\nSep 20 11:40:47 AM      loadedDataConverter: { payloadConverter: [DefaultPayloadConverter], payloadCodecs: [] }\r\nSep 20 11:40:47 AM    }\r\nSep 20 11:40:47 AM  }\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.685Z [INFO] asset workflow-bundle-291cb9f0d373c32fd94c.js 683 KiB [emitted] [immutable] (name: main)\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.689Z [INFO] runtime modules 1.77 KiB 4 modules\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO] modules by path ./node_modules/@temporalio/ 162 KiB\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]   modules by path ./node_modules/@temporalio/workflow/ 96.5 KiB 13 modules\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]   modules by path ./node_modules/@temporalio/common/lib/ 48.7 KiB 10 modules\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]   modules by path ./node_modules/@temporalio/internal-workflow-common/lib/*.js 14.4 KiB\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]     ./node_modules/@temporalio/internal-workflow-common/lib/index.js 1.3 KiB [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]     + 9 modules\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.691Z [INFO]   ./node_modules/@temporalio/worker/lib/workflow-log-interceptor.js 2.25 KiB [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.691Z [INFO] modules by path ./src/*.js 773 bytes\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO]   ./src/workflows-autogenerated-entrypoint.js 524 bytes [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO]   ./src/workflows.js 249 bytes [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO] __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO] ./node_modules/long/umd/index.js 43.1 KiB [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO] ./node_modules/ms/index.js 2.95 KiB [built] [code generated]\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.693Z [INFO] webpack 5.74.0 compiled successfully in 4264 ms\r\nSep 20 11:40:52 AM  2022-09-20T15:40:52.699Z [INFO] Workflow bundle created { size: '0.67MB' }\r\nSep 20 11:41:00 AM  TypeError: failed to downcast any to neon::types::boxed::JsBox<core::cell::RefCell<core::option::Option<temporal_sdk_typescript_bridge::Client>>>\r\nSep 20 11:41:00 AM      at node:internal/util:361:7\r\nSep 20 11:41:00 AM      at new Promise (<anonymous>)\r\nSep 20 11:41:00 AM      at temporal_sdk_typescript_bridge::worker_new (node:internal/util:347:12)\r\nSep 20 11:41:00 AM      at Runtime.registerWorker (/opt/render/project/src/node_modules/@temporalio/worker/lib/runtime.js:274:73)\r\nSep 20 11:41:00 AM      at Function.create (/opt/render/project/src/node_modules/@temporalio/worker/lib/worker.js:88:44)\r\nSep 20 11:41:00 AM      at Function.create (/opt/render/project/src/node_modules/@temporalio/worker/lib/worker.js:178:51)\r\nSep 20 11:41:00 AM      at async run (file:///opt/render/project/src/src/worker.js:9:18)\r\nSep 20 11:41:01 AM  [nodemon] app crashed - waiting for file changes before starting...\r\n```\r\n\r\n### Environment/Versions\r\n\r\nhttps://render.com/docs/native-environments\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n\r\n> It‚Äôs an error in the bridge, but the output isn‚Äôt great. We should upgrade the places these downcasts happen to include more context.\r\n‚ÄîSpencer","closedAt":"2022-10-03T12:55:47Z","comments":[{"id":"IC_kwDOEujx185Kx1-u","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Issue was lack of `NativeConnection` passed to Worker.create:\r\n\r\nhttps://github.com/anthonywong555/temporalio-hello-world-js-app-worker-docker/blob/b3ae3a7c8b6498915896f4b049049a7feb6633cf/src/worker.js#L13\r\n\r\nAction items:\r\n\r\n- We should upgrade the places these downcasts happen to include more context.\r\n- Add input validation to `Worker.create` (and everywhere else üòÑ)","createdAt":"2022-09-22T06:22:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/877#issuecomment-1254580142","viewerDidAuthor":false},{"id":"IC_kwDOEujx185LbHQS","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Failed to downcast is input validation, it‚Äôs a type error.\r\nWe can add more input validation at worker creation time but I think that‚Äôs overkill, an IDE should catch this.","createdAt":"2022-10-03T12:55:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/877#issuecomment-1265398802","viewerDidAuthor":false}],"createdAt":"2022-09-20T21:59:08Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":877,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Error on Render: `TypeError: failed to downcast any`","updatedAt":"2022-10-03T12:55:47Z","url":"https://github.com/temporalio/sdk-typescript/issues/877"}
