{"assignees":[{"id":"MDQ6VXNlcjUyMzA0","login":"bergundy","name":"Roey Berman","databaseId":0}],"author":{"id":"MDQ6VXNlcjUyMzA0","is_bot":false,"login":"bergundy","name":"Roey Berman"},"body":"From the Temporal community slack channel:\r\n\r\nNow that we bundle Workflow code with Webpack we can have Typescript output a commonjs module instead of ES module.\r\nThis opens the door to simplifying the project structure, instead of 4 tsconfig files we can now have a single config file.\r\nDoing this means sacrificing some type safety, for example, node types, WeakMap and WeakRef are not defined in the Workflow tsconfig file which should help newcomers avoid some easy to make mistakes.\r\n\r\nSpecifically these customizations have been made to the workflows `tsconfig.json`\r\n```\r\n      \"lib\": [\r\n        \"es5\",\r\n        \"es2015.core\",\r\n        \"es2015.generator\",\r\n        \"es2015.iterable\",\r\n        \"es2015.promise\",\r\n        \"es2015.proxy\",\r\n        \"es2015.reflect\",\r\n        \"es2015.symbol\",\r\n        \"es2015.symbol.wellknown\",\r\n        \"es2016.array.include\",\r\n        \"es2017.object\",\r\n        \"es2017.intl\",\r\n        \"es2017.sharedmemory\",\r\n        \"es2017.string\",\r\n        \"es2017.typedarrays\"\r\n      ],\r\n      \"typeRoots\": [\r\n        \".\"\r\n      ],\r\n```\r\n(`Weak*` types and node types omitted)\r\n\r\nWhen modifying the project to use a single TS config file, some noticeable differences are:\r\n1.\r\n```\r\nimport fs from 'fs';\r\n```\r\nIn the composite project you get an error:\r\nCannot find module 'fs' or its corresponding type declarations\r\nNot a compile time error in the modified project.\r\n\r\n2.\r\n```\r\nnew WeakMap();\r\n```\r\nIn the composite project you get this error:\r\n```\r\n'WeakMap' only refers to a type, but is being used as a value here. Do you need to change your target library? Try changing the `lib` compiler option to es2015 or later.\r\n```\r\nNo compile time error in the modified project.\r\n\r\nWhen trying to use fs in the modified example the worker fails to start with:\r\n```\r\n2021-05-20T07:09:18.493Z [INFO]           using description file: /private/tmp/example/package.json (relative path: ./node_modules/fs)\r\n2021-05-20T07:09:18.493Z [INFO]             no extension\r\n2021-05-20T07:09:18.493Z [INFO]               Field 'browser' doesn't contain a valid alias configuration\r\n2021-05-20T07:09:18.493Z [INFO]               /private/tmp/example/node_modules/fs doesn't exist\r\nWhen instantiating a new WeakMap the user will get an error on Worker startup:\r\nError [DeterminismViolationError]: WeakMap cannot be used in workflows because v8 GC is non-deterministic\r\n```","closedAt":"2021-08-31T10:30:19Z","comments":[{"id":"IC_kwDOEujx18401syZ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"https://temporalio.slack.com/archives/C01DKSMU94L/p1621337921005400","createdAt":"2021-07-26T08:28:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/169#issuecomment-886492313","viewerDidAuthor":false},{"id":"IC_kwDOEujx18407j3O","author":{"login":"swyxio"},"authorAssociation":"CONTRIBUTOR","body":"better developer experience for slightly weaker type safety sounds fine to me. lets make an effort to have nice errors when people do stuff they are not supposed to do","createdAt":"2021-07-28T05:47:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/169#issuecomment-888028622","viewerDidAuthor":false},{"id":"IC_kwDOEujx18416_2w","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"As discussed, let's drop the complex project structure.\r\nWe should update our samples and documentation accordingly.\r\n","createdAt":"2021-08-24T13:47:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/169#issuecomment-904658352","viewerDidAuthor":false}],"createdAt":"2021-07-26T08:28:02Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":{"number":2,"title":"beta","description":"","dueOn":null},"number":169,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Discuss project structure","updatedAt":"2021-08-31T10:30:19Z","url":"https://github.com/temporalio/sdk-typescript/issues/169"}
