{"assignees":[],"author":{"id":"MDQ6VXNlcjQ3MzIwMA==","is_bot":false,"login":"hmvien","name":"Hien Vien"},"body":"### What are you really trying to do?\n\nOur Temporal TypeScript worker bundles class-based workflows that use [Inversifyâ€™s](https://github.com/inversify/InversifyJS) decorators (and therefore reflect-metadata). These workflows are instantiated within the workflow entry point using `container.get(WorkflowIdentifier)`. \n\nWe implement workflows as classes to enhance workflow and activity modularity and to make it easier to write unit tests.\n\n### Describe the bug\n\nWhen `reuseV8Context` remains enabled (the default), the workflow is unable to start up with error\n```\nTypeError: Cannot define property decorate, object is not extensible\n    at Function.defineProperty (<anonymous>)\n    at reflect-metadata/Reflect.js:35:0\n    at reflect-metadata/Reflect.js:146:0\n    at reflect-metadata/Reflect.js:29:0\n    at reflect-metadata/Reflect.js:55:5\n```\n\nThis used to work in temporal-sdk 1.11.8, but breaks as soon as we upgrade to a later sdk version.\n\nTemporal freezes the global Reflect object inside the reusable workflow isolate, so reflect-metadata cannot add its helpers.\n\nSetting `reuseV8Context` to false fixes the issue, but does increase our memory and cpu footprint.\n\n### Minimal Reproduction\n\n`workflows.ts`\n```\nimport \"reflect-metadata\";\n\nimport { Container, injectable } from \"inversify\";\n\n@injectable()\nclass Workflows {\n  async execute(): Promise<void> {\n    // This workflow doesn't need to do anything; the error occurs as soon as\n    // reflect-metadata tries to patch the frozen Reflect object.\n  }\n}\n\nconst container = new Container();\ncontainer.bind(Workflows).toSelf();\n\nexport default async function () {\n  const workflow = container.get(Workflows);\n  return await workflow.execute();\n}\n```\n\n`worker.ts`\n```\nimport path from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\n\nimport { NativeConnection, Worker } from \"@temporalio/worker\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nasync function main(): Promise<void> {\n  const reuseV8Context = process.env.REUSE_V8_CONTEXT !== \"false\";\n\n  console.info(\n    `[repro] Starting worker with reuseV8Context=${reuseV8Context.toString()}`,\n  );\n\n  const connection = await NativeConnection.connect({\n    address: \"localhost:7233\",\n  });\n  const worker = await Worker.create({\n    connection,\n    namespace: \"dev\",\n    taskQueue: \"dev\",\n    reuseV8Context,\n    workflowsPath: path.join(__dirname, \"workflows.ts\"),\n  });\n\n  await worker.run();\n}\n\nmain().catch((error) => {\n  console.error(\"[repro] Worker creation failed with error:\");\n  console.error(error);\n  process.exitCode = 1;\n});\n```\n\nExecute with\n```\n1. tsx worker.ts\n2. temporal workflow start --task-queue dev --type TestWorkflow\n```\n\n### Environment/Versions\n\n- OS and processor: macOS\n- Temporal Version: 1.13\n- Are you using Docker or Kubernetes or building Temporal from source? No\n\n### Additional context\n\n","closedAt":null,"comments":[],"createdAt":"2025-12-05T23:25:41Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1858,"reactionGroups":[],"state":"OPEN","title":"[Bug] unable to import reflect-metadata within workflow bundle","updatedAt":"2025-12-08T18:01:36Z","url":"https://github.com/temporalio/sdk-typescript/issues/1858"}
