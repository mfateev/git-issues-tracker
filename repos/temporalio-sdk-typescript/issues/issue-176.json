{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ☺️"},"body":"### Describe the bug\r\n\r\nWhen I run `npm run build` or `npx lerna run build --scope @temporalio/test`, I get `tsc` errors like `Cannot find module '@temporalio/activity'`, from lines like:\r\n\r\n```\r\nimport { Context as ActivityContext } from '@temporalio/activity';\r\n```\r\n\r\n### To Reproduce\r\n\r\n```\r\nnpx lerna run build --scope @temporalio/test\r\n```\r\n\r\n### Screenshots/Terminal output\r\n\r\nOutput:\r\n\r\n<details>\r\n\r\n```\r\n$ npx lerna run build --scope @temporalio/test\r\nlerna notice cli v4.0.0\r\nlerna info versioning independent\r\nlerna notice filter including \"@temporalio/test\"\r\nlerna info filter [ '@temporalio/test' ]\r\nlerna info Executing command in 1 package: \"npm run build\"\r\nlerna ERR! npm run build exited 1 in '@temporalio/test'\r\nlerna ERR! npm run build stdout:\r\n\r\n> @temporalio/test@0.6.0 build /Users/me/gh/sdk-node/packages/test\r\n> tsc --build\r\n\r\n../worker/src/interceptors.ts(10,44): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n../worker/src/activity.ts(4,35): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n../worker/src/activity.ts(5,47): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n../worker/src/server-options.ts(4,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n../worker/src/core.ts(11,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n../worker/src/core.ts(12,39): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n../worker/src/worker.ts(34,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n../worker/src/worker.ts(37,38): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n../worker/src/worker.ts(401,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n../worker/src/worker.ts(402,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n../worker/src/worker.ts(403,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n../worker/src/worker.ts(404,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n../worker/src/worker.ts(406,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n../worker/src/worker.ts(563,23): error TS2349: This expression is not callable.\r\n  Type 'never' has no call signatures.\r\n../worker/src/worker.ts(706,24): error TS7006: Parameter 'details' implicitly has an 'any' type.\r\n../worker/src/worker.ts(971,51): error TS2345: Argument of type 'ArrayBuffer' is not assignable to parameter of type 'never'.\r\n../worker/src/worker.ts(984,50): error TS2349: This expression is not callable.\r\n  Type 'never' has no call signatures.\r\n../worker/src/worker.ts(1031,35): error TS2349: This expression is not callable.\r\n  Type 'never' has no call signatures.\r\n../worker/src/worker.ts(1062,50): error TS2349: This expression is not callable.\r\n  Type 'never' has no call signatures.\r\n../worker/src/worker.ts(1087,31): error TS2349: This expression is not callable.\r\n  Type 'never' has no call signatures.\r\nlerna ERR! npm run build stderr:\r\nnpm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! @temporalio/test@0.6.0 build: `tsc --build`\r\nnpm ERR! Exit status 1\r\nnpm ERR! \r\nnpm ERR! Failed at the @temporalio/test@0.6.0 build script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /Users/me/.npm/_logs/2021-08-07T20_42_09_389Z-debug.log\r\nlerna ERR! npm run build exited 1 in '@temporalio/test'\r\n```\r\n\r\n</details>\r\n\r\n\r\n### Versions\r\n\r\n - OS: Mac 11.4 Intel\r\n- Node: 14.16.0\r\n- typescript: 4.3.5\r\n\r\n### Additional context\r\n\r\nI've gone through these steps: \r\n- https://github.com/temporalio/sdk-node/blob/main/CONTRIBUTING.md#environment-set-up\r\n- https://github.com/temporalio/sdk-node/blob/main/docs/building.md","closedAt":"2021-08-09T18:22:13Z","comments":[{"id":"IC_kwDOEujx1841VU-m","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Can you try and run `npx lerna clean -f && npm ci && npm run build` from the project root directory?\r\nDoes it yield the same results?","createdAt":"2021-08-08T11:30:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/176#issuecomment-894783398","viewerDidAuthor":false},{"id":"IC_kwDOEujx1841Vb8j","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"There was no `-f` option, but yes, similar build output after `npx lerna clean && npm ci`\r\n\r\n<details>\r\n\r\n```\r\n$ npm run build\r\n\r\n> typescript-sdk@ build /Users/me/gh/sdk-node\r\n> lerna run --stream build\r\n\r\nlerna notice cli v4.0.0\r\nlerna info versioning independent\r\nlerna info Executing command in 6 packages: \"npm run build\"\r\n@temporalio/core-bridge: > @temporalio/core-bridge@0.2.0 build /Users/me/gh/sdk-node/packages/core-bridge\r\n@temporalio/core-bridge: > npm run build-rust\r\n@temporalio/create: > @temporalio/create@0.3.3 build /Users/me/gh/sdk-node/packages/create-project\r\n@temporalio/create: > tsc --build\r\n@temporalio/core-bridge: > @temporalio/core-bridge@0.2.0 build-rust /Users/me/gh/sdk-node/packages/core-bridge\r\n@temporalio/core-bridge: > TEMPORAL_WORKER_FORCE_BUILD=true node ./scripts/build.js\r\n@temporalio/core-bridge: Force build via TEMPORAL_WORKER_FORCE_BUILD env var\r\n@temporalio/core-bridge: Compiling bridge { target: undefined }\r\n@temporalio/core-bridge:     Finished release [optimized] target(s) in 0.84s\r\n@temporalio/proto: > @temporalio/proto@0.2.4 build /Users/me/gh/sdk-node/packages/proto\r\n@temporalio/proto: > node ./scripts/compile-proto.js\r\n@temporalio/proto: installing jsdoc@^3.6.3\r\n@temporalio/proto: Asuming protos are up to date\r\n@temporalio/worker: > @temporalio/worker@0.6.0 build /Users/me/gh/sdk-node/packages/worker\r\n@temporalio/worker: > node-gyp rebuild --release\r\n@temporalio/worker:   CXX(target) Release/obj.target/temporalio-workflow-isolate-extension/workflow-isolate-extension.o\r\n@temporalio/worker:   SOLINK_MODULE(target) Release/temporalio-workflow-isolate-extension.node\r\n@temporalio/worker: ld: warning: directory not found for option '-L/Developer/SDKs/MacOSX10.7.sdk/usr/lib'\r\n@temporalio/test: > @temporalio/test@0.6.0 build /Users/me/gh/sdk-node/packages/test\r\n@temporalio/test: > tsc --build\r\n@temporalio/interceptors-opentelemetry: > @temporalio/interceptors-opentelemetry@0.1.0 build /Users/me/gh/sdk-node/packages/interceptors-opentelemetry\r\n@temporalio/interceptors-opentelemetry: > tsc --build\r\n@temporalio/test: ../worker/src/interceptors.ts(10,44): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/activity.ts(4,35): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/activity.ts(5,47): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/server-options.ts(4,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/core.ts(11,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/core.ts(12,39): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/worker.ts(34,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/worker.ts(37,38): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/test: ../worker/src/worker.ts(401,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/test: ../worker/src/worker.ts(402,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/test: ../worker/src/worker.ts(403,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/test: ../worker/src/worker.ts(404,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/test: ../worker/src/worker.ts(406,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/test: ../worker/src/worker.ts(563,23): error TS2349: This expression is not callable.\r\n@temporalio/test:   Type 'never' has no call signatures.\r\n@temporalio/test: ../worker/src/worker.ts(706,24): error TS7006: Parameter 'details' implicitly has an 'any' type.\r\n@temporalio/test: ../worker/src/worker.ts(971,51): error TS2345: Argument of type 'ArrayBuffer' is not assignable to parameter of type 'never'.\r\n@temporalio/test: ../worker/src/worker.ts(984,50): error TS2349: This expression is not callable.\r\n@temporalio/test:   Type 'never' has no call signatures.\r\n@temporalio/test: ../worker/src/worker.ts(1031,35): error TS2349: This expression is not callable.\r\n@temporalio/test:   Type 'never' has no call signatures.\r\n@temporalio/test: ../worker/src/worker.ts(1062,50): error TS2349: This expression is not callable.\r\n@temporalio/test:   Type 'never' has no call signatures.\r\n@temporalio/test: ../worker/src/worker.ts(1087,31): error TS2349: This expression is not callable.\r\n@temporalio/test:   Type 'never' has no call signatures.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/interceptors.ts(10,44): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/activity.ts(4,35): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/activity.ts(5,47): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/server-options.ts(4,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/core.ts(11,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/core.ts(12,39): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(34,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(37,38): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(401,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(402,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(403,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(404,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(406,5): error TS2322: Type 'any' is not assignable to type 'never'.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(563,23): error TS2349: This expression is not callable.\r\n@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(706,24): error TS7006: Parameter 'details' implicitly has an 'any' type.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(971,51): error TS2345: Argument of type 'ArrayBuffer' is not assignable to parameter of type 'never'.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(984,50): error TS2349: This expression is not callable.\r\n@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(1031,35): error TS2349: This expression is not callable.\r\n@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(1062,50): error TS2349: This expression is not callable.\r\n@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.\r\n@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(1087,31): error TS2349: This expression is not callable.\r\n@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.\r\n@temporalio/test: npm ERR! code ELIFECYCLE\r\n@temporalio/test: npm ERR! errno 1\r\n@temporalio/test: npm ERR! @temporalio/test@0.6.0 build: `tsc --build`\r\n@temporalio/test: npm ERR! Exit status 1\r\n@temporalio/test: npm ERR! \r\n@temporalio/test: npm ERR! Failed at the @temporalio/test@0.6.0 build script.\r\n@temporalio/test: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n@temporalio/interceptors-opentelemetry: npm ERR! code ELIFECYCLE\r\n@temporalio/interceptors-opentelemetry: npm ERR! errno 1\r\n@temporalio/interceptors-opentelemetry: npm ERR! @temporalio/interceptors-opentelemetry@0.1.0 build: `tsc --build`\r\n@temporalio/interceptors-opentelemetry: npm ERR! Exit status 1\r\n@temporalio/interceptors-opentelemetry: npm ERR! \r\n@temporalio/interceptors-opentelemetry: npm ERR! Failed at the @temporalio/interceptors-opentelemetry@0.1.0 build script.\r\n@temporalio/interceptors-opentelemetry: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n@temporalio/test: npm ERR! A complete log of this run can be found in:\r\n@temporalio/test: npm ERR!     /Users/me/.npm/_logs/2021-08-08T15_08_57_675Z-debug.log\r\nlerna ERR! npm run build exited 1 in '@temporalio/test'\r\nlerna WARN complete Waiting for 1 child process to exit. CTRL-C to exit immediately.\r\nnpm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! typescript-sdk@ build: `lerna run --stream build`\r\nnpm ERR! Exit status 1\r\nnpm ERR! \r\nnpm ERR! Failed at the typescript-sdk@ build script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /Users/me/.npm/_logs/2021-08-08T15_08_57_720Z-debug.log\r\n```\r\n\r\n</details>","createdAt":"2021-08-08T15:12:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/176#issuecomment-894811939","viewerDidAuthor":false},{"id":"IC_kwDOEujx1841W6qy","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"For `-f` you have to use `-- -f` so `npm` doesn't try to parse the flag.\r\n\r\nI'm not sure what the problem is, those are the steps we run on each build in CI for node 14 and 16 on mac and linux.\r\nLet me try to help you on our call later today.","createdAt":"2021-08-09T12:57:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/176#issuecomment-895199922","viewerDidAuthor":false},{"id":"IC_kwDOEujx1841X0-F","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Thank you, that worked! \r\n\r\n```\r\nnpx lerna clean -- -f && npm ci && npm run build\r\n```","createdAt":"2021-08-09T18:22:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/176#issuecomment-895438725","viewerDidAuthor":false}],"createdAt":"2021-08-07T20:58:47Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":176,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Cannot find temporal modules during build","updatedAt":"2021-08-09T18:22:13Z","url":"https://github.com/temporalio/sdk-typescript/issues/176"}
