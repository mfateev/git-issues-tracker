{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ☺️"},"body":"This happens some of the time:\r\n\r\n`RUN_INTEGRATION_TESTS=1 npx ava packages/test/lib/test-worker-no-workflows.js`\r\n\r\n```\r\n2022-03-12T00:00:24.360Z [INFO] [temporal_sdk_core::worker::dispatcher] Shutting down worker on queue only-activities\r\n2022-03-12T00:00:24.360Z [INFO] [temporal_sdk_core::worker::dispatcher] Shutting down worker on queue also-workflows\r\n2022-03-12T00:00:24.362Z [INFO] Worker state changed { state: 'DRAINED' }\r\n2022-03-12T00:00:24.362Z [INFO] Worker state changed { state: 'STOPPED' }\r\n2022-03-12T00:00:29.360Z [ERROR] Worker failed {\r\n  error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully\r\n      at /Users/me/gh/sdk-typescript/packages/worker/src/worker.ts:399:17\r\n      at /Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/map.ts:58:33\r\n      at OperatorSubscriber._this._next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)\r\n      at OperatorSubscriber.Subscriber.next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/Subscriber.ts:75:12)\r\n      at /Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/mergeInternals.ts:85:24\r\n      at OperatorSubscriber._this._next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)\r\n      at OperatorSubscriber.Subscriber.next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/Subscriber.ts:75:12)\r\n      at /Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/map.ts:58:20\r\n      at OperatorSubscriber._this._next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)\r\n      at OperatorSubscriber.Subscriber.next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/Subscriber.ts:75:12)\r\n}\r\n2022-03-12T00:00:29.360Z [INFO] Worker state changed { state: 'FAILED' }\r\n  Worker functions when asked not to run Workflows\r\n\r\n  Rejected promise returned by test. Reason:\r\n\r\n  GracefulShutdownPeriodExpiredError {\r\n    message: 'Timed out while waiting for worker to shutdown gracefully',\r\n  }\r\n\r\n  › packages/worker/src/worker.ts:399:17\r\n  › node_modules/rxjs/src/internal/operators/map.ts:58:33\r\n  › OperatorSubscriber._this._next (node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)\r\n  › OperatorSubscriber.Subscriber.next (node_modules/rxjs/src/internal/Subscriber.ts:75:12)\r\n  › node_modules/rxjs/src/internal/operators/mergeInternals.ts:85:24\r\n  › OperatorSubscriber._this._next (node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)\r\n  › OperatorSubscriber.Subscriber.next (node_modules/rxjs/src/internal/Subscriber.ts:75:12)\r\n  › node_modules/rxjs/src/internal/operators/map.ts:58:20\r\n  › OperatorSubscriber._this._next (node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)\r\n  › OperatorSubscriber.Subscriber.next (node_modules/rxjs/src/internal/Subscriber.ts:75:12)\r\n\r\n  ─\r\n\r\n  1 test failed\r\n  ```\r\n  \r\n  on latest `main` and `0.18.0`","closedAt":"2024-01-09T21:27:35Z","comments":[{"id":"IC_kwDOEujx185PWZR1","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Two recent occurrences:\r\n- https://github.com/temporalio/sdk-typescript/actions/runs/3576905911/jobs/6016717992#step:13:9918\r\n- One around 2022-11-07\r\n\r\n<img width=\"1203\" alt=\"Capture d’écran, le 2022-11-07 à 15 42 42\" src=\"https://user-images.githubusercontent.com/6412169/204641761-5e8d422d-7c0e-4608-a954-d4464abaef90.png\">\r\n","createdAt":"2022-11-29T20:39:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/529#issuecomment-1331270773","viewerDidAuthor":false},{"id":"IC_kwDOEujx185wSNkh","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Haven't seen this error recently. Also, the Worker shutdown process has changed a lot since this was initially reported, so it seems very reasonable to think that this has already been fixed.","createdAt":"2024-01-09T21:27:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/529#issuecomment-1883822369","viewerDidAuthor":false}],"createdAt":"2022-03-12T00:02:59Z","labels":[],"milestone":null,"number":529,"reactionGroups":[],"state":"CLOSED","title":"[Bug] test-worker-no-workflows intermittent failure","updatedAt":"2024-01-09T21:27:36Z","url":"https://github.com/temporalio/sdk-typescript/issues/529"}
