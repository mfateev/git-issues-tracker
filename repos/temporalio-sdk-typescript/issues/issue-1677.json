{"assignees":[],"author":{"id":"MDQ6VXNlcjY0MTIxNjk=","is_bot":false,"login":"mjameswh","name":"James Watkins-Harvey"},"body":"### Describe the bug\n\nAssuming a workflow is launched with `signalWithStart`, the following workflow code in TS SDK 1.11.3 or earlier would result in sequence A-B-C. Same in later releases if not using the OTel workflow interceptor. However, in 1.11.5+ with OTel, weâ€™d get A-C-B (i.e. equivalent of signal coming in a later WFT).\n\n```\nexport async function myWorkflow(name: string): Promise<void> {\n  log('A');\n  setHandler(defineSignal('mySignal'), async () => {\n    log('B');\n  });\n  log('C');\n}\n```\n\nThis change is due to addition of tracing propagation on inbound signals in 1.11.5 (#1449). Order of promise completion on outbound `scheduleLocalActivity` has similarly been modified in 1.11.6 (#1577). Both of these changes may result in Non-Determinism errors when older workflows are replayed on newer release of the SDK with the OTel interceptor installed. \n\nFor context, the changes mentioned previously added a certain number of `await` statements to the corresponding code paths, so the actual code is now executed as a microtask rather than synchronously, hence the change in execution order. As a general rule, interceptors provided by the SDK itself should as much as possible avoid adding yield points. We should also document this risk on the Workflow Interceptor types, as user-implemented interceptors may face similar issues.","closedAt":"2025-11-10T18:45:15Z","comments":[],"createdAt":"2025-04-15T15:37:28Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1677,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"ROCKET","users":{"totalCount":3}}],"state":"CLOSED","title":"[Bug] Upgrading OTel Interceptor to 1.11.5+ breaks signal-with-start and may cause NDE","updatedAt":"2025-11-10T18:45:15Z","url":"https://github.com/temporalio/sdk-typescript/issues/1677"}
