{"assignees":[],"author":{"id":"MDQ6VXNlcjEyMDM4OTM=","is_bot":false,"login":"josh-berry","name":"Josh Berry"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nTrying to create a new project based on the `child-workflow` sample, following the directions at: https://docs.temporal.io/dev-guide/typescript/foundations#install-a-temporal-sdk\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\nTypeScript compilation fails in an unmodified new project, based on the `child-workflow` sample, because the `es2023` library definitions are not included with the version of TypeScript used in the sample project:\r\n\r\n```\r\n‚ùØ npm run start.watch\r\n...\r\nTSError: ‚®Ø Unable to compile TypeScript:\r\nnode_modules/@tsconfig/node20/tsconfig.json:6:13 - error TS6046: Argument for '--lib' option must be: 'es5', 'es6', 'es2015', 'es7', [...]\r\n\r\n6     \"lib\": [\"es2023\"],\r\n              ~~~~~~~~\r\n...\r\n[nodemon] app crashed - waiting for file changes before starting...\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\n1. `npx @temporalio/create@latest sample-tsc-fail-repro`\r\n2. Choose the `child-workflows` sample and accept the defaults for the rest of the prompts\r\n3. In a new terminal, `temporal server start-dev`\r\n4. `cd sample-tsc-fail-repro`\r\n5. `npm run start.watch`\r\n6. Observe the crash above\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: M1 Mac, macOS 13.4\r\n- Temporal Version: `temporal version 0.9.0 (server 1.20.2) (ui 2.15.0)`\r\n- Are you using Docker or Kubernetes or building Temporal from source? No\r\n- Node Version: `v20.2.0`\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n\r\nI doubt this is specific to the `child-workflows` sample; I suspect the others suffer from the same issue (though I haven't tried).\r\n\r\nI notice the `es2023` lib reference comes from the `tsconfig.json` included in `@tsconfig/node20`. If I look at the sample itself, I see that its `package.json` uses `@tsconfig/node16` (which presumably does not have the `es2023` lib reference). So it seems `@temporalio/create` is tweaking the `package.json` to use `node20` (which is the version I have installed). And indeed I can see this in the code: https://github.com/temporalio/sdk-typescript/blob/1709d45c5e649fd6b233243b7a80c49be5e706bd/packages/create-project/src/helpers/install.ts#L33\r\n\r\nAlso, the sample's `package.json` pins TypeScript to a 4.x release, and I don't think `es2023` is defined until 5.0.\r\n\r\nI think there might be two ways of fixing this:\r\n1. Bump the TypeScript version (and related dependencies) to TypeScript 5.x in all the samples\r\n2. Stop messing with the `@tsconfig/nodeXX` version when creating the new package\r\n\r\nIt might be a good idea to do both, in any case. Staying up to date (i.e. (1)) is always good, and my thinking re. (2) is that people may be developing on the latest version of Node (currently, v20), but may want to use an LTS release (currently, v18) when deploying. So it may not necessarily make sense to depend on the current Node version in a new project.","closedAt":"2023-05-30T18:53:25Z","comments":[{"id":"IC_kwDOEujx185dQ6G-","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Thanks @josh-berry for the report.\r\nThis was already reported but your issue contains more info so I'll close the original.","createdAt":"2023-05-26T17:37:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1125#issuecomment-1564713406","viewerDidAuthor":false},{"id":"IC_kwDOEujx185dREgU","author":{"login":"josh-berry"},"authorAssociation":"NONE","body":"Ack, my bad, I filed this without checking for duplicates, because I was initially gonna open it in the samples repo, but realized it was actually an SDK bug at the last minute and moved it over. Will pay more attention next time!","createdAt":"2023-05-26T18:16:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1125#issuecomment-1564755988","viewerDidAuthor":false},{"id":"IC_kwDOEujx185dRiwA","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Lol! I already have a fix for this on my local branch, together with a few other minor fixes üòÑ Pushing in a few minutes.","createdAt":"2023-05-26T20:04:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1125#issuecomment-1564879872","viewerDidAuthor":false}],"createdAt":"2023-05-26T17:25:37Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1125,"reactionGroups":[],"state":"CLOSED","title":"[Bug] tsc in a project created with `npx @temporalio/create` fails on Node 20","updatedAt":"2023-05-30T18:53:25Z","url":"https://github.com/temporalio/sdk-typescript/issues/1125"}
