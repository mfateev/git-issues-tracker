{"assignees":[],"author":{"id":"MDQ6VXNlcjkwNDUxNjU=","is_bot":false,"login":"alex-dixon","name":"Alex Dixon"},"body":"### What are you really trying to do?\r\nSend data through a sink and call JSON stringify on it on the receiving (sink) end.\r\n\r\n\r\n### Describe the bug\r\nWhen I call a sink with data and stringify the result on the receiving end I sometimes receive a `TypeError: Converting circular structure` type error. I do not appear to receive this error if I stringify the the data on the sending end, before it is sent through the sink (so it doesn't seem the data actually has a circular structure before entering the sink, but it does after?). \r\n\r\n### Minimal Reproduction\r\nI've avoided creating this issue because haven't had time to set one set up.... :) I wanted to at least post the issue. I will try to recreate it in isolation. I'd expect it would be reproducible by calling any sink with a fair amount of data. I don't know for sure the size of the payload matters. The app I've seen this in has pretty rapid sink writes also.\r\n\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor: Linux\r\n- Temporal Version: 0.20.1\r\n- Are you using Docker or Kubernetes or building Temporal from source?\r\nDocker + Kubernetes + Temporal Cloud\r\n`node:16-bullseye`\r\n\r\n### Additional context\r\n\r\n","closedAt":"2022-04-22T20:07:14Z","comments":[{"id":"IC_kwDOEujx185B-MJu","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"This is a limitation of the [`postMessage`](https://nodejs.org/api/worker_threads.html#portpostmessagevalue-transferlist) API.\r\nWe use this API because the workflow runs in a worker thread and the sink function runs on the main Node.js thread.\r\n\r\nSee also these architecture diagrams:\r\n- https://github.com/temporalio/sdk-typescript/blob/main/docs/arch.svg\r\n- https://github.com/temporalio/sdk-typescript/blob/main/docs/activation.mermaid","createdAt":"2022-04-22T20:07:14Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/610#issuecomment-1106821742","viewerDidAuthor":false}],"createdAt":"2022-04-22T18:53:06Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":610,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Sink API appears to create circular JSON","updatedAt":"2022-04-22T20:07:32Z","url":"https://github.com/temporalio/sdk-typescript/issues/610"}
