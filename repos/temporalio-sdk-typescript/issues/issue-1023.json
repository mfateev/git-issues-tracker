{"assignees":[{"id":"MDQ6VXNlcjY0MTIxNjk=","login":"mjameswh","name":"James Watkins-Harvey","databaseId":0}],"author":{"id":"MDQ6VXNlcjY0MTIxNjk=","is_bot":false,"login":"mjameswh","name":"James Watkins-Harvey"},"body":"### Describe the bug\r\n\r\nRunning a very simple program using `Client` or `Connection`. At the end, `node` wait 10 seconds before exiting, unless we add an explicit `process.exit(0)` in the code.\r\n\r\nThis was reproduced using @grpc/grpc-js 1.8.0 and 1.8.3, but does not happens on 1.7.3.\r\n\r\n**Example:**\r\n\r\n<img width=\"769\" alt=\"image (1)\" src=\"https://user-images.githubusercontent.com/6412169/211933605-2dc29c08-9ab7-43b7-8168-b49f4a2c3a10.png\">\r\n\r\n\r\n### Minimal Reproduction\r\n\r\n```\r\nimport { Connection } from '@temporalio/client';\r\n\r\nConnection.connect()\r\n  .then(() => console.log('Connected'))\r\n  .catch((e) => console.log(e));\r\n```","closedAt":"2023-01-12T20:39:22Z","comments":[{"id":"IC_kwDOEujx185SOsLT","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Seems to be related to the recent addition of _retries_ directly in the library. For some reason, the [deadline timer](https://github.com/grpc/grpc-node/blob/master/packages/grpc-js/src/resolving-call.ts#L95) does not cleared on some successful calls.","createdAt":"2023-01-11T22:49:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1023#issuecomment-1379582675","viewerDidAuthor":false},{"id":"IC_kwDOEujx185SOuYD","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Good catch, do you think this could be related to the jest hang we're seeing?\r\nDoes it help if the grpc client is closed?","createdAt":"2023-01-11T23:02:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1023#issuecomment-1379591683","viewerDidAuthor":false},{"id":"IC_kwDOEujx185SOwbC","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"No change when I add this line:\r\n\r\n<img width=\"522\" alt=\"image\" src=\"https://user-images.githubusercontent.com/251288/211937928-e0560a6f-ff61-432c-b405-1de46fc7a1bf.png\">\r\n\r\n\r\n<img width=\"208\" alt=\"image\" src=\"https://user-images.githubusercontent.com/251288/211937943-0074efd5-a4af-4b2f-91a4-c75e242ea6c3.png\">\r\n","createdAt":"2023-01-11T23:11:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1023#issuecomment-1379600066","viewerDidAuthor":false},{"id":"IC_kwDOEujx185SOyhx","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":">Good catch, do you think this could be related to the jest hang we're seeing?\r\n\r\nNo, 1.8.0 was released December 7th, the Jest issue existed well before that. It could however possibly explain some issues observed in `features` tests, but it is too early to make statement here.\r\n\r\nAnyway, I personally think that 1.8.0 should have been a major. They introduced a new retry mechanism, which make it breaking for any software that already implemented retries at another level. We'll have to put a quite a lot of thinking and testing before we move to 1.8+.\r\n\r\nSo for now, I think the only reasonable solution is to change dependency to ~1.7.3.\r\n\r\n","createdAt":"2023-01-11T23:23:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1023#issuecomment-1379608689","viewerDidAuthor":false},{"id":"IC_kwDOEujx185SO870","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I'd be fine with pinning the minor version and keeping an open issue to upgrade to >=1.8 when were ready to invest more into this.","createdAt":"2023-01-12T00:22:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1023#issuecomment-1379651316","viewerDidAuthor":false}],"createdAt":"2023-01-11T22:45:05Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1023,"reactionGroups":[],"state":"CLOSED","title":"[Bug] node takes 10 seconds to exit since @grpc/grpc-js 1.8.0","updatedAt":"2023-01-12T20:39:22Z","url":"https://github.com/temporalio/sdk-typescript/issues/1023"}
