{"assignees":[{"id":"MDQ6VXNlcjI1MTI4OA==","login":"lorensr","name":"Loren ☺️","databaseId":0}],"author":{"id":"MDQ6VXNlcjkwNDIzOQ==","is_bot":false,"login":"dutabado","name":"benjamin bradley"},"body":"### What are you really trying to do?\r\n\r\nEnsure workflows properly exit and don't stay in the Running state indefinitely.\r\n\r\n### Describe the bug\r\n\r\nIf a workflow, `ParentWorkflow` attempts to execute a `ChildWorkflow`, but uses the same workflow ID as an already executing instance of `ChildWorkflow`, the 2nd instance will fail as expected with `WorkflowExecutionAlreadyStartedError`. However, the `ParentWorkflow` instance that attempted to spawn the 2nd child workflow remains in the `Running` state indefinitely and never exits. Even if the first instance of `ChildWorkflow` completes, and the workflow is restarted, it remains stuck in Running.\r\n\r\n### Minimal Reproduction\r\n\r\n```typescript\r\nimport { sleep, executeChild } from '@temporalio/workflow';\r\n\r\nexport async function parentWorkflow(): Promise<string> {\r\n  return await executeChild('childWorkflow', { \r\n    workflowId: 'childWorkflowId', // <-- intentionally static\r\n  }\r\n}\r\n\r\nexport async function childWorkflow(): Promise<void> {\r\n  sleep(60000);\r\n}\r\n```\r\n\r\nLaunch two workflows concurrently\r\n```bash\r\ntctl workflow start --workflow_type parentWorkflow\r\ntctl workflow start --workflow_type parentWorkflow\r\n```\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: M1 Mac running Monterray 12.2.1\r\n- Temporal Version: Typescript SDK 0.19.2\r\n- Are you using Docker or Kubernetes or building Temporal from source? Docker\r\n\r\n","closedAt":"2023-03-02T16:23:19Z","comments":[{"id":"IC_kwDOEujx185BeFyP","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Thanks @dutabado we'll fix this soon","createdAt":"2022-04-13T19:31:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/586#issuecomment-1098407055","viewerDidAuthor":false},{"id":"IC_kwDOEujx185BePrk","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"## Failing Task vs Execution\r\n\r\nNormally when errors are thrown from Workflows, they fail the Task, so that the dev can either:\r\n\r\n1. notice a logic bug and update the code, and existing Workflows will advance\r\n2. figure out that they want the Execution to fail, and update the code to instead throw a `TemporalFailure`\r\n\r\nWe could make `WorkflowExecutionAlreadyStartedError` fail the Execution by extending `TemporalFailure` instead of `Error`, but I'm inclined to leave it as `Error`, so that they can go through the normal flow, as it might be a fixable logic bug.\r\n\r\n## When should Worker give up on starting tasks\r\n\r\nNormally core stops starting tasks after the first task failure, like:\r\n\r\n```ts\r\nexport async function parentWorkflow(): Promise<string> {\r\n  throw new Error('This is an error');\r\n}\r\n```\r\n\r\n<img width=\"1228\" alt=\"image\" src=\"https://user-images.githubusercontent.com/251288/163261433-97caa7fc-998c-46df-a9d1-4608aec8552d.png\">\r\n\r\nBut in this case (error thrown from `executeChild`), it stops after two:\r\n\r\n<img width=\"1687\" alt=\"image\" src=\"https://user-images.githubusercontent.com/251288/163260893-23f1c5fa-880f-4f29-a79c-d9ca4964d0a8.png\">\r\n\r\nWhy is that?","createdAt":"2022-04-13T20:18:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/586#issuecomment-1098447588","viewerDidAuthor":false},{"id":"IC_kwDOEujx185Beh3a","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@lorensr according to @mfateev `WorkflowExecutionAlreadyStartedError` should extend `TemporalFailure` and fail the workflow.\r\nThat's why this issue was created in the first place.","createdAt":"2022-04-13T21:52:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/586#issuecomment-1098522074","viewerDidAuthor":false},{"id":"IC_kwDOEujx185Wcs1g","author":{"login":"tsurdilo"},"authorAssociation":"MEMBER","body":"Agreed, it should fail the workflow and not the workflow task.","createdAt":"2023-03-01T15:41:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/586#issuecomment-1450364256","viewerDidAuthor":false}],"createdAt":"2022-04-13T19:09:15Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":586,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Parent workflow doesn't fail when child workflow encounters WorkflowExecutionAlreadyStartedError","updatedAt":"2023-03-02T16:23:19Z","url":"https://github.com/temporalio/sdk-typescript/issues/586"}
