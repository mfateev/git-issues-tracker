{"assignees":[],"author":{"id":"MDQ6VXNlcjE5MDA4NzY=","is_bot":false,"login":"jhecking","name":"Jan Hecking"},"body":"### What are you really trying to do?\r\n\r\nI'm creating a new schedule and I want to trigger it immediately. I don't want any overlapping schedule runs.\r\n\r\n### Describe the bug\r\n\r\nI'm creating a new schedule using a combination of `ScheduleOverlapPolicy.BUFFER_ONE` and `triggerImmediately: true`, i.e.\r\n\r\n```typescript\r\nexport async function schedulePeriodicWorkflowExecution(\r\n  action: ScheduleOptionsStartWorkflowAction<Workflow>,\r\n  scheduleId: string,\r\n  cronExpression: string,\r\n) {\r\n  const client = await getScheduleClient()\r\n  const spec = { cronExpressions: [cronExpression] }\r\n  return client.create({\r\n    action,\r\n    spec,\r\n    scheduleId,\r\n    policies: {\r\n      overlap: ScheduleOverlapPolicy.BUFFER_ONE,\r\n    },\r\n    state: {\r\n      triggerImmediately: true,\r\n    },\r\n  })\r\n}\r\n```\r\n\r\nIf the initial schedule run, started via `triggerImmediately: true` takes long enough that the next run gets triggered as per the provided cron schedule, that second schedule run does not get buffered but gets executed immediately.\r\n\r\nI believe this is because the initial schedule run always gets executed with a default \"AllowAll\" overlap policy: https://github.com/temporalio/sdk-typescript/blob/4cf092d6e503603bc559d67c7ec8b3c0235a8cff/packages/client/src/schedule-client.ts#L246-L249\r\n\r\nA possible work-around is to create the schedule and then immediately trigger it ourselves using the correct overlap policy, i.e.\r\n\r\n```typescript\r\nexport async function schedulePeriodicWorkflowExecution(\r\n  action: ScheduleOptionsStartWorkflowAction<Workflow>,\r\n  scheduleId: string,\r\n  cronExpression: string,\r\n) {\r\n  const client = await getScheduleClient()\r\n  const spec = { cronExpressions: [cronExpression] }\r\n  const handle = client.create({\r\n    action,\r\n    spec,\r\n    scheduleId,\r\n    policies: {\r\n      overlap: ScheduleOverlapPolicy.BUFFER_ONE,\r\n    },\r\n  })\r\n  await handle.trigger(ScheduleOverlapPolicy.BUFFER_ONE)\r\n  return handle\r\n}\r\n```\r\n\r\nBut I think `triggerImmediately: true` should honor the schedule's overlap policy instead of defaulting to the \"AllowAll\" policy.\r\n\r\n### Minimal Reproduction\r\n\r\nhttps://github.com/jhecking/samples-typescript/tree/schedules-trigger-immediately-overlapping/schedules-trigger-immediately-overlapping\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- Temporal Version: 1.11.2\r\n\r\n### Additional context\r\n\r\nn/a","closedAt":null,"comments":[],"createdAt":"2025-01-08T03:19:11Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1594,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"[Bug] First schedule action started using triggerImmediately flag does not honor the schedule's overlap policy","updatedAt":"2025-01-08T03:38:46Z","url":"https://github.com/temporalio/sdk-typescript/issues/1594"}
