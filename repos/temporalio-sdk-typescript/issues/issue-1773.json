{"assignees":[],"author":{"id":"MDQ6VXNlcjcwNTU5NDE1","is_bot":false,"login":"anh-rivergon","name":""},"body":"### What are you really trying to do?\n\n<!-- \nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \n-->\n\nTrying to start a worker. Used to work fine.\n\n### Describe the bug\n\n<!-- A clear and concise description of what the bug is. -->\n\n    error: TypeError: (0 , ms_1.default) is not a function\n          at msWithValidation (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/common/lib/time.js:80:37)\n          at msToNumber (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/common/lib/time.js:77:12)\n          at compileWorkerOptions (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/worker/lib/worker-options.js:236:68)\n          at Worker.create (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/worker/lib/worker.js:186:75)\n\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\n\n### Minimal Reproduction\n According to ChatGPT, the use of \"ms\": \"^3.0.0-canary.1\" is the root cause.\n\nSolution is to use \"ms\": \"2.1.3\"\n\n<!-- \nModify our hello world templates to demonstrate:\n\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\n- Go: https://github.com/temporalio/money-transfer-project-template-go\n- Java: https://github.com/temporalio/money-transfer-project-template-java\n- PHP: https://github.com/temporalio/samples-php#samples\n-->\n\n### Environment/Versions\n\n<!-- Please complete the following information where relevant. -->\n\n- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version\n- Are you using Docker or Kubernetes or building Temporal from source?\n\n### Additional context\n\n<!-- Add any other context about the problem here. -->\n","closedAt":"2025-08-26T19:10:35Z","comments":[{"id":"IC_kwDOEujx187AEt77","author":{"login":"anh-rivergon"},"authorAssociation":"NONE","body":"Added the below to package.json as temporary fix.\n{\n  \"overrides\": {\n    \"ms\": \"2.1.3\",\n    \"@temporalio/common\": { \"ms\": \"2.1.3\" },\n    \"@temporalio/worker\": { \"ms\": \"2.1.3\" }\n  }\n}","createdAt":"2025-08-26T03:35:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3222462203","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AFGkL","author":{"login":"cam-at-tactiq"},"authorAssociation":"NONE","body":"This affected us too, seems wrong to rely on a `canary` version from this package, and I think it should depend on `2.1.3` so long as it works","createdAt":"2025-08-26T04:21:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":3}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3222563083","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AIxzJ","author":{"login":"maurovanetti"},"authorAssociation":"NONE","body":"Same issue, ~~fixed with the suggested override.~~ Thank you.\n\nCanary versions should not be used as dependencies in production.","createdAt":"2025-08-26T10:10:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3223526601","viewerDidAuthor":false},{"id":"IC_kwDOEujx187ANZo9","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"[Related upstream discussion](https://github.com/vercel/ms/issues/254).","createdAt":"2025-08-26T15:44:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3224738365","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AN9Zs","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"For users affected by this, the recommended mitigation is to add a local version pin override on `ms@3.0.0-canary.1`.\n\nThere are different ways to do this. The easiest solution will vary based on which package manager you are using and your specific project structure (notably, whether you are using a monorepo).\n\n- In most cases, the easiest solution is to add an explicit dependency on `ms@3.0.0-canary.1` from one of your own packages (preferably the ones importing `@temporalio/*` packages).\n- Alternatively, you may add a dependency override directive in your own `package.json` file. For NPM, this will look something like this:\n\n  ```\n  {\n    \"dependencies\": {\n      // ...\n    },\n    \"overrides\": {\n      \"ms\": \"3.0.0-canary.1\",\n      \"@temporalio/common\": { \"ms\": \"3.0.0-canary.1\" },\n      \"@temporalio/worker\": { \"ms\": \"3.0.0-canary.1\" }\n    }\n  }\n  ```\n\nA dependency on `2.1.3` will work fine at runtime in most environments, but may cause compile-time errors of user code if it transitively depends on the TS type definitions exposed by the official `ms@3.x` package. This may notably affect deployments where workflow code is bundled at runtime, rather than being prebundled.","createdAt":"2025-08-26T16:21:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":3}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3224884844","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AORH3","author":{"login":"maurovanetti"},"authorAssociation":"NONE","body":"Thank you @mjameswh, I've been struggling with this issue for some time today, and I realised later than downgrading to `ms@2.1.3` does not actually fix everything. It worked in a project but not in another one, depending on which parts of `@temporalio/common` I'm actually using in either project.\n\nAs I understood it from the discussion in the ms repo you linked, the problem here is that `ms` has been using canary versions as official releases (ðŸ˜²), and you could only follow suit with the dependency. Not your fault, definitely. Then a little mess happened at `ms`, semantic versioning was broken and now the caret dependency from `^3.0.0-canary.1` resolves to later, incompatible canary releases. You rightly suggested to bump these new versions to v4 but I'm not sure this is happening anytime soon.\n\nBut more weirdness is coming. Your snippet is slightly wrong, it should be written like this to be accepted by npm (my version at least):\n\n```\n  \"overrides\": {\n    \"ms\": \"3.0.0-canary.1\",\n    \"@temporalio/common\": { \"ms\": \"3.0.0-canary.1\" },\n    \"@temporalio/worker\": { \"ms\": \"3.0.0-canary.1\" }\n  }\n```\n(Also, I'm not sure we need to mention `@temporalio/worker` among the overrides but this is a finer point.)\nUnfortunately, though, if I do this, and I really can't explain why, I get this in my package-lock.json:\n\n```\n    \"node_modules/@temporalio/common/node_modules/ms\": {\n      \"version\": \"3.0.0-canary.0\",\n      \"resolved\": \"https://registry.npmjs.org/ms/-/ms-3.0.0-canary.0.tgz\",\n      \"integrity\": \"sha512-FrdRKJ9G+nm9Bw6atUMrbIhGTJ2emtf0KRgtzgSrAW1nnV9RuQAXc7sbFWdr1RfOH3fcNk0MyK+ma4iihdLmyA==\",\n      \"engines\": {\n        \"node\": \">=12.13\"\n      }\n    },\n```\n\nTherefore, the override does not install `canary.1` but `canary.0`, and that version is broken in another way. ðŸ¤• \nI'm puzzled. ","createdAt":"2025-08-26T16:45:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3224965623","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AOxAl","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"> Your snippet is slightly wrong, it should be written like this to be accepted by npm (my version at least)\n\nThat's right, copy-paste error from my part. Fixed. Thanks for pointing it out.\n\n> Therefore, the override does not install canary.1 but canary.0\n\n- Any hint if you look at `npm why ms`?\n\n- Have you tried adding an explicit dependency to `ms@3.0.0-canary.1` from your own package, instead of adding an override? NPM will generally try to avoid bringing in different versions of a package if it can find a way to do so without breaking requirements.","createdAt":"2025-08-26T17:31:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3225096229","viewerDidAuthor":false},{"id":"IC_kwDOEujx187APekt","author":{"login":"dimitropoulos"},"authorAssociation":"NONE","body":"hi!  apologies for any disruption.  we're shaking the dust off after many years without a release.  if you still want to depend on the canary you can use the release linked here: https://github.com/vercel/ms/issues/254#issuecomment-3225280621","createdAt":"2025-08-26T18:33:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3225282861","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AP8q9","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Awesome @dimitropoulos! Thank you so much for your collaboration.\n\nI just confirmed that running `npm i --prefer-online` on a sample project makes it run perfectly, without any change to declared dependencies. It downloaded 3.0.0-canary.202508261828.\n\nThat resolves the case.","createdAt":"2025-08-26T19:10:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3225406141","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AQLwy","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"**Still observing this issue?**\n\nYou might need to force your package manager to query the NPM registry. Otherwise, it may end up reusing a problematic version of the package from its cache.\n\nRun one of the following command, depending on your package manager:\n\n- NPM: `npm i --prefer-online`\n- PNPM: `pnpm install --prefer-online`\n- Yarn Classic (v1): `yarn install --update-checksums`\n- Yarn Berry/3+: `yarn install --check-cache`\n\n\n**Preventing this in production**\n\nTo avoid surprises from fresh upstream releases in CI or production, we strongly recommend committing your project's lockfile (package-lock.json, pnpm-lock.yaml, or yarn.lock) to source control.\n\nThen, make sure your package manager honor that lock file when installing dependencies in your CI or production environment:\n- NPM: `npm ci`\n- PNPM: `pnpm install --frozen-lockfile`\n- Yarn Classic (v1): `yarn install --frozen-lockfile`\n- Yarn Berry/3+: `yarn install --immutable`\n\nThis ensures that your deployment replicates the latest \"known good\" dependency tree.","createdAt":"2025-08-26T19:30:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":3}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3225467954","viewerDidAuthor":false},{"id":"IC_kwDOEujx187AX6y1","author":{"login":"maurovanetti"},"authorAssociation":"NONE","body":"Thank you @mjameswh, it was definitely a cache issue with npm. However, everything was fixed with the latest changes.\nWell played.","createdAt":"2025-08-27T09:38:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1773#issuecomment-3227495605","viewerDidAuthor":false}],"createdAt":"2025-08-26T03:31:18Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1773,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":11}}],"state":"CLOSED","title":"[Bug] error: TypeError: (0 , ms_1.default) is not a function","updatedAt":"2025-08-27T09:38:41Z","url":"https://github.com/temporalio/sdk-typescript/issues/1773"}
