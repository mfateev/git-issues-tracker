{"assignees":[],"author":{"id":"MDQ6VXNlcjc5NTYwNQ==","is_bot":false,"login":"cawalch","name":"Caleb Walch"},"body":"### What are you really trying to do?\r\n\r\nUse mTLS within `NativeConnectionOptions` to connect to a cluster\r\n\r\n### Describe the bug\r\n\r\nMoving from 1.11.3 to 1.11.5 broke the `NativeConnectionOptions` / connect call with a TransportError\r\n\r\n```\r\n/app/node_modules/@temporalio/worker/lib/connection.js:58\r\n                throw new core_bridge_1.TransportError(err.message);\r\n                      ^\r\nTransportError: tonic::transport::Error(Transport, NativeCertsNotFound)\r\n    at NativeConnection.connect (/app/node_modules/@temporalio/worker/lib/connection.js:58:23)\r\n```\r\n\r\nAble to confirm it's an issue with 1.11.5 after reverting back to 1.11.3\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n### Minimal Reproduction\r\n\r\n**tlsConfig option**\r\n\r\n```\r\nconnectionOptions.tls = {\r\n      serverNameOverride: config.TEMPORAL_TLS_SERVER_NAME,\r\n      serverRootCACertificate: fs.readFileSync(config.TEMPORAL_TLS_CA),\r\n      clientCertPair: {\r\n        crt: fs.readFileSync(config.TEMPORAL_TLS_CERT),\r\n        key: fs.readFileSync(config.TEMPORAL_TLS_KEY),\r\n      },\r\n    }\r\n```\r\n\r\n### Environment/Versions\r\n\r\nThe application is built and deployed as a docker image\r\n\r\n- Docker / `node:22.11.0-bookworm-slim`\r\n- Hosting environment / Ubuntu 22","closedAt":"2024-12-17T18:45:43Z","comments":[{"id":"IC_kwDOEujx186X84Uk","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"The docker image you use, `node:*-slim`, doesn't include root TLS CA certificates. You need to include them, as demonstrated [here](https://docs.temporal.io/develop/typescript/core-application#using-nodeslim-images).\r\n\r\nThe reason that was working until TS SDK 1.11.3 is that we were previously relying on `rustls`'s built-in CAs rather than the system-native ones, but that was incorrect. This was [fixed in v1.11.5](https://github.com/temporalio/sdk-core/pull/824), which means that the OS is now responsible for managing root CAs, as it should be.","createdAt":"2024-12-17T18:45:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1584#issuecomment-2549318948","viewerDidAuthor":false},{"id":"IC_kwDOEujx187Qbe8h","author":{"login":"dafanasiev"},"authorAssociation":"NONE","body":"@mjameswh client must use CA from `serverRootCACertificate` as root-of-trust (when parameter set explicitly), not a system CA list.\nI think that the current behavior of the client is a bug.\n\nworkaround for this issue:\n\n```sh\n# remove system CA list\nrm -f /etc/ssl/certs/ca-certificates.crt\n\n# use own CA\ncp my-root-ca.pem /etc/ssl/certs/ca-certificates.crt\n```","createdAt":"2025-11-06T11:57:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1584#issuecomment-3496865569","viewerDidAuthor":false}],"createdAt":"2024-12-11T16:34:06Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1584,"reactionGroups":[],"state":"CLOSED","title":"[Bug] mTLS NativeConnectionOptions tonic::transport::Error(Transport, NativeCertsNotFound)","updatedAt":"2025-11-06T11:57:40Z","url":"https://github.com/temporalio/sdk-typescript/issues/1584"}
