{"assignees":[],"author":{"id":"U_kgDOBi1-Ag","is_bot":false,"login":"viavdeyenk-mts","name":""},"body":"## Description\r\n\r\nSome times ago we began using the temporal SDK in our microservice product, but after some times we detected that temporal-worker containers are killed by \"out of memory\" reason. Then we started our investigation and found the potential leak problem: a lot of 'OperatorSubscriber' objects create on temporal-worker side,  but it never clean, and it make memory leak problem. Right now it's  just a theory, but we hope that you can help us with checking it.\r\n\r\n\r\n## Expected Behavior\r\n\r\nWe are not detecting memory leak\r\n\r\n## Actual Behavior\r\n\r\nWe are detecting memory leak\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Run and inspect the temporal worker (e.g. `node --inspect src/worker.js`)\r\n2. Start expect the worker process via chrome devtools\r\n3. Execute the temporal client in infinity loop (for generate persistent loading for worker)\r\n4. A little while later intervals via chrome devtools take memory snapshots from the worker process\r\n5. Compare last memory snapshot with preview: there are a lot of `OperatorSubscriber` objects between the snapshots, so we can make the conclusion, that temporal typescript SDK has a memory leak\r\n  ![memory-leak-detection.png](https://raw.githubusercontent.com/viavdeyenk-mts/temporal-tssdk-demo-memory-leak/main/img/08-memory-leak-detection.png)\r\n\r\n## Specifications\r\n\r\n  - Version: 0.22.0\r\n  - Platform: x86_64 GNU/Linux (distr: Ubuntu:20.04, core: 5.14)\r\n\r\n-------------------------------------\r\n\r\n## Help with reproduce\r\n\r\nFor comfort reproduce, we created [the separate repository](https://github.com/viavdeyenk-mts/temporal-tssdk-demo-memory-leak) for help and  describe the steps for representation the leak problem. \r\n\r\n ","closedAt":"2022-05-16T23:28:41Z","comments":[{"id":"IC_kwDOEujx186BE1R7","author":{"login":"HalfdanJ"},"authorAssociation":"NONE","body":"Stumbled into this issue since i've been hunting a memory leak in our temporal worker, and ran into an identical situation as the screenshot above (with the latest version of temporal sdk installed). \r\n\r\n<img width=\"1251\" alt=\"image\" src=\"https://github.com/temporalio/sdk-typescript/assets/227529/9a0a1527-80b0-4133-932a-6af5fbcddf17\">\r\n","createdAt":"2024-06-13T12:33:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/649#issuecomment-2165527675","viewerDidAuthor":false},{"id":"IC_kwDOEujx186O0DgJ","author":{"login":"jainshivsagar"},"authorAssociation":"NONE","body":"I am also facing the same memory leak issue. \r\n@bergundy Please help here & assist your help.\r\n\r\n![image](https://github.com/user-attachments/assets/a460cac9-816b-4eff-a62a-ddba6309c7b5)\r\n","createdAt":"2024-10-07T06:27:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/649#issuecomment-2396010505","viewerDidAuthor":false},{"id":"IC_kwDOEujx186O686h","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I'll defer to @mjameswh, the current SDK maintainer.","createdAt":"2024-10-07T20:21:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/649#issuecomment-2397818529","viewerDidAuthor":false},{"id":"IC_kwDOEujx186O7Bpo","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@jainshivsagar Please open a new ticket.\r\n\r\nEven though the symptoms might be the same, this is very unlikely to be the same case:\r\n- The issue from May 2022 was an actual bug in the SDK, which was resolved back then.\r\n- The message from June 2024 was due to incorrect cleanup of an `AsyncLocalStorage` in user code; that resulted in [this ticket](https://github.com/temporalio/sdk-typescript/issues/1432).","createdAt":"2024-10-07T20:32:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/649#issuecomment-2397837928","viewerDidAuthor":false}],"createdAt":"2022-05-11T09:15:57Z","labels":[],"milestone":null,"number":649,"reactionGroups":[],"state":"CLOSED","title":"Memory leak on the temporal worker side","updatedAt":"2024-10-07T20:35:19Z","url":"https://github.com/temporalio/sdk-typescript/issues/649"}
