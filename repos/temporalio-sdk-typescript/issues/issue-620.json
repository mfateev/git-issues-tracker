{"assignees":[{"id":"MDQ6VXNlcjUyMzA0","login":"bergundy","name":"Roey Berman","databaseId":0}],"author":{"id":"MDQ6VXNlcjE1ODk1MA==","is_bot":false,"login":"airhorns","name":"Harry Brundage"},"body":"### What are you really trying to do?\r\n\r\nRun an existing, large node.js project that starts Temporal workers, where some of the existing node code depends on `typeof window == \"undefined\"`.\r\n\r\n### Describe the bug\r\n\r\nThe OpenTelemetry interceptors package modifies the global object to have a `window` property here: https://github.com/temporalio/sdk-typescript/blob/main/packages/interceptors-opentelemetry/src/workflow/runtime.ts \r\n\r\nThis modification may be necessary within the workflow isolate, but, this code is also required outside the workflow isolate when just booting the worker and passing the interceptors because of this import: https://github.com/temporalio/sdk-typescript/blob/main/packages/interceptors-opentelemetry/src/worker/index.ts#L8\r\n\r\nThis violates a lot of existing code's assumptions and in the case of my project breaks a lot of things. `typeof window == \"undefined\"` is a generally pretty common way of checking if a piece of code is running within node or within the browser, and this global modification confuses all that code, because now in the whole node process `typeof window == \"object\"`. \r\n\r\nIs there a way that the interceptors could only modify the code inside the workflow isolate, or better yet, not modify the globals at all?\r\n\r\n### Minimal Reproduction\r\n\r\nGonna skip this for now but if the issue is unclear let me know and I can put something together\r\n\r\n### Environment/Versions\r\n\r\n- OS and processor: macOS 12.1.3\r\n- Temporal Version: temporalite + `@temporalio/worker@0.20.2`\r\n- No docker, no k8s","closedAt":"2022-05-02T21:24:57Z","comments":[{"id":"IC_kwDOEujx185CXOzc","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Should be easy to fix","createdAt":"2022-04-29T14:26:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/620#issuecomment-1113386204","viewerDidAuthor":false}],"createdAt":"2022-04-29T01:32:22Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":6,"title":"1.0","description":"","dueOn":null},"number":620,"reactionGroups":[],"state":"CLOSED","title":"[Bug] OpenTelemetry interceptors patch global runtime outside workflow isolate too","updatedAt":"2022-05-02T21:24:57Z","url":"https://github.com/temporalio/sdk-typescript/issues/620"}
