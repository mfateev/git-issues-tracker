{"assignees":[],"author":{"id":"MDQ6VXNlcjkwNDUxNjU=","is_bot":false,"login":"alex-dixon","name":"Alex Dixon"},"body":"### Describe the bug\r\n\r\nWebpack compilation fails when code imports built-in node libraries like `fs`, `os` etc.\r\n\r\n### To Reproduce\r\n\r\n\r\n1. `import * as fs from 'fs'`\r\n2. console.log('fs',fs)\r\n3. Should throw an error similar to the below\r\n\r\n### Expected behavior\r\n\r\nCompile without polyfills for built-in node libraries.\r\n\r\n### Screenshots/Terminal output\r\n```\r\n2021-09-01T15:21:12.290Z [INFO] ERROR in ./node_modules/@airbrake/node/esm/filter/node.js 2:9-22\r\n2021-09-01T15:21:12.291Z [INFO] Module not found: Error: Can't resolve 'os' in '/node_modules/@airbrake/node/esm/filter'\r\n2021-09-01T15:21:12.291Z [INFO] \r\n2021-09-01T15:21:12.292Z [INFO] BREAKING CHANGE: webpack < 5 used to include polyfills for node.js core modules by default.\r\n2021-09-01T15:21:12.292Z [INFO] This is no longer the case. Verify if you need this module and configure a polyfill for it.\r\n2021-09-01T15:21:12.293Z [INFO] \r\n2021-09-01T15:21:12.293Z [INFO] If you want to include a polyfill, you need to:\r\n2021-09-01T15:21:12.293Z [INFO]     - add a fallback 'resolve.fallback: { \"os\": require.resolve(\"os-browserify/browser\") }'\r\n2021-09-01T15:21:12.293Z [INFO]     - install 'os-browserify'\r\n2021-09-01T15:21:12.293Z [INFO] If you don't want to include a polyfill, you can use an empty module like this:\r\n2021-09-01T15:21:12.294Z [INFO]     resolve.fallback: { \"os\": false }\r\n2021-09-01T15:21:12.294Z [INFO] resolve 'os' in '/node_modules/@airbrake/node/esm/filter'\r\n```\r\n\r\n### Versions\r\n- OS: Linux\r\n- Temporal Version 0.3.0\r\n- Are you using Docker or Kubernetes or building Temporal from source?\r\nDocker + Kubernetes\r\n\r\n### Additional context\r\n\r\nAdding `target: \"node\"` to the webpack configuration may be all that is needed to fix this. It defaults to \"web\".","closedAt":"2021-09-09T08:38:48Z","comments":[{"id":"IC_kwDOEujx1842guez","author":{"login":"joebowbeer"},"authorAssociation":"CONTRIBUTOR","body":"Is `fs` a native node API, in which case it can't be used in the WF isolate?","createdAt":"2021-09-07T19:00:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/220#issuecomment-914548659","viewerDidAuthor":false},{"id":"IC_kwDOEujx1842l0O0","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"`fs` is a native node API and cannot be imported in the Workflow isolate, you should use an activity to access the filesystem.\r\nhttps://docs.temporal.io/docs/node/determinism/#imports-in-workflow-code","createdAt":"2021-09-09T08:38:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/220#issuecomment-915882932","viewerDidAuthor":false},{"id":"IC_kwDOEujx1842l1Pg","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"In the future, we'll add local activities and side-effects support so you can read from a *local* FS from workflow code.","createdAt":"2021-09-09T08:44:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/220#issuecomment-915887072","viewerDidAuthor":false},{"id":"IC_kwDOEujx1842l-mE","author":{"login":"joebowbeer"},"authorAssociation":"CONTRIBUTOR","body":"By the way, I like the Node SDK name, but I can see that this behavior would seem more intuitive if the SDK were renamed TypeScript SDK, as some have suggested.","createdAt":"2021-09-09T09:36:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/220#issuecomment-915925380","viewerDidAuthor":false},{"id":"IC_kwDOEujx1842m0c6","author":{"login":"alex-dixon"},"authorAssociation":"CONTRIBUTOR","body":"Couple thoughts: \r\n\r\n1. Maybe we could polyfill/wrap things like fs with a default activity implementation? Then we wouldn’t all need to write activities for things like writing files. Existing code (eg fs.writeFileSync) would just work (and have all the benefits of an activity). \r\n\r\n2. Adding something like “rules of workflows” to the docs may help others in the future. Determinism seems like a separate concern from native node modules. ‘querystring’ is a pure function. Is it allowed?\r\n\r\n\r\n","createdAt":"2021-09-09T14:23:10Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/220#issuecomment-916145978","viewerDidAuthor":false},{"id":"IC_kwDOEujx1842sbtn","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"1. The thing with activities is that they run on different workers, writing to the filesystem isn't encouraged in this sort of setup.\r\n\r\nTake the following workflow for example:\r\n```ts\r\nawait writeFile('a.txt', 'hello')\r\nawait sleep(100000000)\r\nawait readFile('a.txt')\r\n```\r\n\r\n`writeFile` and `readFile` will possibly run on different workers. Even with local activities, there's no guarantee that the same worker will pick up the workflow after it's resumed.\r\n\r\n2. `querystring`(deprecated) is a pure function and should technically be importable if it is implemented in pure JS (no native code) and webpack can find it. I'll try to clarify the docs to make this easier to find.\r\n\r\n","createdAt":"2021-09-12T11:29:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/220#issuecomment-917617511","viewerDidAuthor":false}],"createdAt":"2021-09-01T15:43:56Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":220,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Can't resolve built-in node libraries","updatedAt":"2021-09-12T11:29:44Z","url":"https://github.com/temporalio/sdk-typescript/issues/220"}
