{"assignees":[{"id":"MDQ6VXNlcjY0MTIxNjk=","login":"mjameswh","name":"James Watkins-Harvey","databaseId":0}],"author":{"id":"MDQ6VXNlcjIyNzUyOQ==","is_bot":false,"login":"HalfdanJ","name":"Jonas Jongejan"},"body":"### What are you really trying to do?\r\n\r\nI'm using the @temporalio/interceptors-opentelemetry package in combination with the `bundleWorkflowCode` feature from `@temporalio/worker`.\r\n\r\n### Describe the bug\r\nThe interceptors work as expected, but I also get a lot of errors in the logs that so far seem harmless but very noisy. \r\n\r\n```\r\n   severity: \"ERROR\"\r\n   message: \"Workflow referenced an unregistered external sink\"\r\n   metadata: {\r\n      \"ifaceName\": \"exporter\",\r\n      \"fnName\": \"export\"\r\n   }\r\n```\r\n\r\nIf I take out the interceptor from the `workflowInterceptorModules` configuration, the errors disappear. I can further narrow it down to the inclusion of `OpenTelemetryOutboundInterceptor` in outbound interceptors like this: \r\n\r\n```\r\nexport const interceptors: WorkflowInterceptorsFactory = () => ({\r\n  outbound: [new OpenTelemetryOutboundInterceptor()],\r\n});\r\n```\r\n\r\n### Minimal Reproduction\r\nI can create one if needed, but havent done so yet. \r\n\r\n### Environment/Versions\r\n\r\n\r\n- OS and processor:  Mac\r\n- Temporal Version: 1.9.3\r\n","closedAt":"2024-04-25T15:25:46Z","comments":[{"id":"IC_kwDOEujx1857urp0","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"I think you are missing the `sinks` configuration on your `Worker`:\r\n\r\n```\r\n  const worker = await Worker.create({\r\n    workflowsBundle: ...,\r\n    interceptors: {\r\n      activityInbound: [(ctx) => new OpenTelemetryActivityInboundInterceptor(ctx)],\r\n    },\r\n\r\n    // Make sure to include this block; `exporter` and `resource` \r\n    sinks: {\r\n      exporter: makeWorkflowExporter(exporter, resource),\r\n    },\r\n  });\r\n```\r\n\r\nPlease our Open Telemetry tracing interceptors sample [here](https://github.com/temporalio/samples-typescript/blob/022d78f4b303ca7c48f577f6f2a497d3688d1b0e/interceptors-opentelemetry/src/worker.ts#L25-L38).","createdAt":"2024-04-24T21:01:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1400#issuecomment-2075834996","viewerDidAuthor":false},{"id":"IC_kwDOEujx18571Tx3","author":{"login":"HalfdanJ"},"authorAssociation":"NONE","body":"Ah you are right. I actually already had the sinks, but i was conditionally disabling them not realizing that was were the error stemmed from. \r\n\r\nOne piece of feedback, it would be useful to make note of them in the [readme](https://github.com/temporalio/samples-typescript/tree/022d78f4b303ca7c48f577f6f2a497d3688d1b0e/interceptors-opentelemetry), or make more explicit note of them in the sample since its easy to miss the need for it. ","createdAt":"2024-04-25T15:25:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1400#issuecomment-2077572215","viewerDidAuthor":false}],"createdAt":"2024-04-23T17:51:19Z","labels":[],"milestone":null,"number":1400,"reactionGroups":[],"state":"CLOSED","title":"[Bug] `Workflow referenced an unregistered external sink` when using `@temporalio/interceptors-opentelemetry`","updatedAt":"2024-04-25T15:25:46Z","url":"https://github.com/temporalio/sdk-typescript/issues/1400"}
