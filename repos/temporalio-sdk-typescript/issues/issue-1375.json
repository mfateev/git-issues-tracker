{"assignees":[],"author":{"id":"MDQ6VXNlcjIyMTU2NjYy","is_bot":false,"login":"baileywickham","name":"Bailey Wickham"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nA pain point we have in using Temporal is in queuing workflows. We would like the ability to queue/buffer a workflow directly from that workflow, similar to the `executeChild` functionality, and without creating a schedule . Currently we are using schedules for this behavior. The schedules do not trigger independently, they are only used with the `BUFFER_ONE` schedule overlap policy. This has three main disadvantages: the first is we need to generate schedules for workflows which don't really need a schedule, they only need the buffering functionality, the second is we need to create a new client inside each workflow when we queueing the next schedule. Third, you can't pass arguments to the schedule, so you can't have a workflow like `RefetchUser(userId)`.\r\n\r\n### Describe the solution you'd like\r\n\r\n1. The ability to queue a workflow after the completion of a currently running workflow, similar to the `BUFFER_ONE` schedule overlap policy.\r\n2. The ability to do this from inside a workflow without creating a client, similar to `executeChild`. It would also be nice to be able to interact with the schedules directly from a workflow without creating a client.\r\n\r\n### Additional context\r\n\r\nLet me know if this is something Temporal would consider implementing and if there is anything I can do to help. \r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDOEujx1853ejeX","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"You could use this pattern to use the workflow itself as a buffer:\r\n\r\n```ts\r\n// Make sure Request is serializable to JSON (ie. no function, no promises, etc)\r\ntype Request = { ... }\r\n\r\n// Entity workflow pattern with serialization of request\r\n// (ie. only one request is processed at a time)\r\nexport async function myWorkflow(requests: Request[] = []): Promise<void> {\r\n  setHandler(mySignal, (input: Request) => {\r\n    requests.push(input);\r\n    // Don't await here. Otherwise, the Workflow may complete before the promise completes.\r\n  });\r\n\r\n  while (!workflowInfo().continueAsNewSuggested) {\r\n\t\tconst timeSinceStart = Date.now() - workflowInfo().runStartTime.getTime();\r\n    const shouldProcessMore = await condition(() => requests.length > 0, ms('24h') - timeSinceStart);\r\n    if (!shouldProcessMore) return;\r\n\r\n    const request = requests.shift();\r\n\r\n    // Process request as appropriate\r\n    await handleSingleRequest(request);\r\n  }\r\n\r\n  // Huge histories are bad for performance, so we switch to a new workflow execution whenever\r\n  // history grows over 2000 events. When that happens, we forward any outstanding requests to the\r\n  // next execution.\r\n  await continueAsNew(requests);\r\n}\r\n\r\nfunction handleSingleRequest(request: Request): Promise<void> {\r\n  // It's ok to await here\r\n}\r\n```\r\n\r\nYou would then `signalWithStart` the workflow to add an item to its queue.","createdAt":"2024-03-18T17:15:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1375#issuecomment-2004498327","viewerDidAuthor":false},{"id":"IC_kwDOEujx1858r15V","author":{"login":"baileywickham"},"authorAssociation":"NONE","body":"Thanks for the quick response. This removes the need to create a dedicated schedule and allows us to trigger the next request without an additional client. It does add a fair amount of boilerplate to each of our buffered workflows though, native support would still be ideal. Feel free to close this issue if native support isn't going to be implemented. \r\n\r\nThanks again for the response. ","createdAt":"2024-05-02T22:43:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1375#issuecomment-2091867733","viewerDidAuthor":false}],"createdAt":"2024-03-15T21:49:32Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":1375,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Queueing a workflow","updatedAt":"2024-09-18T21:30:05Z","url":"https://github.com/temporalio/sdk-typescript/issues/1375"}
