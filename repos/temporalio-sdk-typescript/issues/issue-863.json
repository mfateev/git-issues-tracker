{"assignees":[],"author":{"id":"U_kgDOBjHlTw","is_bot":false,"login":"omar-amal","name":""},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\nTrying to use `if (err instanceof WorkflowNotFoundError)` to detect whether a workflow doesn't exist.\r\n\r\nI'm running the following function to detect whether a workflow is scheduled to run:\r\n\r\n```typescript\r\nimport { WorkflowNotFoundError } from '@temporalio/workflow'\r\n\r\nexport const getRecurringInvestment = async (wfId: string): Promise<GetRecurringInvestmentDTO | undefined> => {\r\n  const getTemporalClient = initTemporalClient()\r\n  const temporalClient = await getTemporalClient()\r\n\r\n  const wfHandle = await temporalClient.getHandle(wfId)\r\n\r\n  try {\r\n    const [state, { status }] = await Promise.all([wfHandle.query(wfQuery), wfHandle.describe()])\r\n    return status.name === 'CANCELLED' ? undefined : GetRecurringInvestmentDTO.parse(state)\r\n  } catch (err: any) {\r\n    // TODO most likely a bug in temporalio SDK.\r\n    if (err instanceof WorkflowNotFoundError) {\r\n      return undefined\r\n    }\r\n    throw err\r\n  }\r\n}\r\n```\r\n\r\nThe ways a workflow wouldn't be scheduled to run, in our case, is if it's cancelled, or just wasn't created. If the workflow doesn't exist I would expect, per the documentation, for `wfHandle.describe()` or `wfHandle.query()` to throw with `WorkflowNotFoundError`\r\n\r\n### Describe the bug\r\n\r\nI would expect the following above block in the `catch` block to be reached:\r\n\r\n```typescript\r\n    // when the workflow doesn't exist, this `if` block should be entered, and the function should return `undefined`\r\n    // however, the block is being skipped, and we're reaching the `throw err` instead.\r\n    if (err instanceof WorkflowNotFoundError) {\r\n      return undefined\r\n    }\r\n```\r\n\r\nbut it wasn't.  When I replaced the `if` block with the following, the block was successfully reached\r\n```typescript\r\n  } catch (err: any) {\r\n    // Works: enters the `if` block\r\n    if (err.name === 'WorkflowNotFoundError') {\r\n      return undefined\r\n    }\r\n    throw err\r\n  }\r\n}\r\n```\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n### Package versions\r\nUsing version 1.1.0 of `@temporalio/workflow` and the other packages.","closedAt":"2023-01-16T23:41:14Z","comments":[{"id":"IC_kwDOEujx185J-ikJ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"This is likely due to multiple versions of `@temporalio/common` installed.\r\nTry changing the import to: `import { WorkflowNotFoundError } from '@temporalio/client'`\r\n","createdAt":"2022-09-08T19:22:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/863#issuecomment-1241131273","viewerDidAuthor":false}],"createdAt":"2022-09-08T13:49:55Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":863,"reactionGroups":[],"state":"CLOSED","title":"[Bug] `instanceof WorkflowNotFoundError` not working","updatedAt":"2023-01-16T23:41:14Z","url":"https://github.com/temporalio/sdk-typescript/issues/863"}
