{"assignees":[],"author":{"id":"MDQ6VXNlcjczOTE1Mw==","is_bot":false,"login":"kutovoy","name":"kutovoy"},"body":"### What are you really trying to do?\r\n\r\nbuilding a docker container based on node:16-bullseye with temporal  worker code in it\r\n\r\n\r\n### Describe the bug\r\n\r\nI was able to make docker container until literally an hour ago when \"RUN npm install\" step started to fail for no obvious reasons (I didn't change anything but unrelated small JS code fixes), here is how it fails:\r\n\r\n => ERROR [16/18] RUN npm install                                                                                                                                                                     27.9s\r\n\r\n------                                                                                                                                                                                                      \r\n\r\n > [16/18] RUN npm install:                                                                                                                                                                                 \r\n\r\n#26 27.60 npm ERR! code 1                                                                                                                                                                                   \r\n\r\n#26 27.61 npm ERR! path /app/node_modules/@temporalio/core-bridge                                                                                                                                           \r\n\r\n#26 27.61 npm ERR! command failed                                                                                                                                                                           \r\n\r\n#26 27.61 npm ERR! command sh -c -- node ./scripts/build.js                                                                                                                                                 \r\n\r\n#26 27.61 npm ERR! Compiling bridge { target: 'x86_64-unknown-linux-gnu', buildRelease: false }\r\n\r\n#26 27.61 npm ERR! Running /app/node_modules/.bin/cargo-cp-artifact [\r\n\r\n#26 27.61 npm ERR!   '--artifact',\r\n\r\n#26 27.61 npm ERR!   'cdylib',\r\n\r\n#26 27.61 npm ERR!   'temporal_sdk_typescript_bridge',\r\n\r\n#26 27.61 npm ERR!   'releases/x86_64-unknown-linux-gnu/index.node',\r\n\r\n#26 27.61 npm ERR!   '--',\r\n\r\n#26 27.61 npm ERR!   'cargo',\r\n\r\n#26 27.61 npm ERR!   'build',\r\n\r\n#26 27.61 npm ERR!   '--message-format=json-render-diagnostics',\r\n\r\n#26 27.61 npm ERR!   '--target',\r\n\r\n#26 27.61 npm ERR!   'x86_64-unknown-linux-gnu'\r\n\r\n#26 27.61 npm ERR! ]\r\n\r\n#26 27.61 npm ERR! No prebuilt module found at /app/node_modules/@temporalio/core-bridge/releases/x86_64-unknown-linux-gnu/index.node\r\n\r\n#26 27.61 npm ERR! Error: could not find the `cargo` executable.\r\n\r\n#26 27.61 npm ERR! \r\n\r\n#26 27.61 npm ERR! You can find instructions for installing Rust and Cargo at:\r\n\r\n#26 27.61 npm ERR! \r\n\r\n#26 27.61 npm ERR!     https://www.rust-lang.org/tools/install\r\n\r\n#26 27.61 npm ERR! \r\n\r\n#26 27.61 npm ERR! \r\n\r\n#26 27.62 npm ERR! Did not copy \"cdylib:temporal_sdk_typescript_bridge\"\r\n\r\n#26 27.62 npm ERR! /app/node_modules/@temporalio/core-bridge/scripts/build.js:89\r\n\r\n#26 27.62 npm ERR!     throw new Error(`Failed to build${target ? ' for ' + target : ''}`);\r\n\r\n#26 27.62 npm ERR!     ^\r\n\r\n#26 27.62 npm ERR! \r\n\r\n#26 27.62 npm ERR! Error: Failed to build for x86_64-unknown-linux-gnu\r\n\r\n#26 27.62 npm ERR!     at compile (/app/node_modules/@temporalio/core-bridge/scripts/build.js:89:11)\r\n\r\n#26 27.62 npm ERR!     at Object.<anonymous> (/app/node_modules/@temporalio/core-bridge/scripts/build.js:106:9)\r\n\r\n#26 27.62 npm ERR!     at Module._compile (node:internal/modules/cjs/loader:1196:14)\r\n\r\n#26 27.62 npm ERR!     at Object.Module._extensions..js (node:internal/modules/cjs/loader:1250:10)\r\n\r\n#26 27.62 npm ERR!     at Module.load (node:internal/modules/cjs/loader:1074:32)\r\n\r\n#26 27.62 npm ERR!     at Function.Module._load (node:internal/modules/cjs/loader:909:12)\r\n\r\n#26 27.62 npm ERR!     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)\r\n\r\n#26 27.62 npm ERR!     at node:internal/main/run_main_module:22:47\r\n\r\n#26 27.62 \r\n\r\n#26 27.62 npm ERR! A complete log of this run can be found in:\r\n\r\n#26 27.62 npm ERR!     /root/.npm/_logs/2023-04-28T03_15_33_215Z-debug-0.log\r\n\r\n------\r\n\r\nexecutor failed running [/bin/sh -c npm install]: exit code: 1\r\n\r\nI noticed there was a recent push 2hrs ago to the temporal npm sdk with 1.7.3 version of SDK\r\n\r\n### Minimal Reproduction\r\n\r\ninclude npm dependencies:\r\n\r\n@temporalio/activity ^1.0.0\r\n@temporalio/client ^1.0.0\r\n@temporalio/worker ^1.0.0\r\n@temporalio/workflow ^1.0.0\r\n\r\n### Environment/Versions\r\n\r\n- Temporal Version: ^1.0.0 (I guess it pulls 1.7.3?)\r\n- Just building docker image with temporal worker code only in it\r\n\r\n### Additional context\r\n\r\n","closedAt":"2023-04-28T04:41:17Z","comments":[{"id":"IC_kwDOEujx185bAy-0","author":{"login":"kutovoy"},"authorAssociation":"NONE","body":"Locking to 1.7.2 using package.json fixed the problem for me. Docker container can be built... its something with 1.7.3 ","createdAt":"2023-04-28T03:32:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1111#issuecomment-1526935476","viewerDidAuthor":false},{"id":"IC_kwDOEujx185bA-eB","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I just published 1.7.4 that includes the prebuilt binaries.\r\n\r\nSorry for the inconvenience.","createdAt":"2023-04-28T04:41:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1111#issuecomment-1526982529","viewerDidAuthor":false}],"createdAt":"2023-04-28T03:28:50Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1111,"reactionGroups":[],"state":"CLOSED","title":"[Bug] unable to do npm install in a docker to build a container with a worker app since 1.7.3 temporal TS SDK was published","updatedAt":"2023-04-28T04:41:18Z","url":"https://github.com/temporalio/sdk-typescript/issues/1111"}
