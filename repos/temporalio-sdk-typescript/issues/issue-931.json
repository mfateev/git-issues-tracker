{"assignees":[],"author":{"id":"MDQ6VXNlcjUxNzY4Mw==","is_bot":false,"login":"Sushisource","name":"Spencer Judge"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\n### Describe the bug\r\n\r\nIf you query a workflow with a nonexistent query type, and the query is issued as part of a WFT (not a legacy query), then that causes the SDK to reject the workflow task, where it should instead complete the activation successfully and include a failed query result command.\r\n\r\n### Minimal Reproduction\r\n\r\nYou have to get lucky and have server send the query the nonlegacy way, so inconsistently repros. Would be easy to write a UT for.\r\nIn sdk-features:\r\n\r\n```typescript\r\nexport const finishSignal = wf.defineSignal('finish');\r\nexport const query = wf.defineQuery<string>('nonexistent');\r\n\r\nexport async function workflow(): Promise<void> {\r\n  await new Promise((resolve) => wf.setHandler(finishSignal, () => resolve(null)));\r\n}\r\n\r\nexport const feature = new Feature({\r\n  workflow,\r\n  checkResult: async (runner, handle) => {\r\n\r\n    await assert.rejects(async () => {\r\n      await handle.query(query);\r\n    }, QueryNotRegisteredError);\r\n\r\n    await handle.signal(finishSignal);\r\n    await runner.waitForRunResult(handle);\r\n  },\r\n});\r\n```\r\n\r\nThis miiiiight only happen if the query is part of the first start workflow activation, too. (Something to do with bufferedQueries)","closedAt":"2022-10-20T04:24:19Z","comments":[],"createdAt":"2022-10-19T21:57:56Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":931,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Queries targeting a nonexistent handler fail WFTs on non-legacy path","updatedAt":"2022-10-20T04:24:19Z","url":"https://github.com/temporalio/sdk-typescript/issues/931"}
