{"assignees":[],"author":{"id":"MDQ6VXNlcjkzNDEx","is_bot":false,"login":"philwhln","name":"Phil Whelan"},"body":"### What are you really trying to do?\n\nCalling list workflows\n\n```\nclient.workflow.list();\n```\n\n### Describe the bug\n\nTypeScript throws this error\n\n```\nnode_modules/@temporalio/client/src/iterators-utils.ts:59:9 - error TS2322: Type 'AsyncIterableIterator<any[]>' is not assignable to type 'AsyncIterable<[B]>'.\n  The types returned by '[Symbol.asyncIterator]().next(...)' are incompatible between these types.\n    Type 'Promise<IteratorResult<any[], any>>' is not assignable to type 'Promise<IteratorResult<[B], any>>'.\n      Type 'IteratorResult<any[], any>' is not assignable to type 'IteratorResult<[B], any>'.\n        Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorResult<[B], any>'.\n          Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorYieldResult<[B]>'.\n            Type 'any[]' is not assignable to type '[B]'.\n              Target requires 1 element(s) but source may have fewer.\n\n59   const emitterEventsIterable: AsyncIterable<[B]> = on(emitter, 'result', { signal: controller.signal });\n           ~~~~~~~~~~~~~~~~~~~~~\n\nnode_modules/@temporalio/client/src/iterators-utils.ts:65:17 - error TS2322: Type 'AsyncIterator<any[], any, undefined>' is not assignable to type 'AsyncIterator<void, any, undefined>'.\n  The types returned by 'next(...)' are incompatible between these types.\n    Type 'Promise<IteratorResult<any[], any>>' is not assignable to type 'Promise<IteratorResult<void, any>>'.\n      Type 'IteratorResult<any[], any>' is not assignable to type 'IteratorResult<void, any>'.\n        Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorResult<void, any>'.\n          Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorYieldResult<void>'.\n            Type 'any[]' is not assignable to type 'void'.\n\n65           const releaseEvents: AsyncIterator<void> = toAsyncIterator(\n                   ~~~~~~~~~~~~~\n\n\nFound 2 errors in the same file, starting at: node_modules/@temporalio/client/src/iterators-utils.ts:59\n```\n\n### Minimal Reproduction\n\n```\nclient.workflow.list();\n```\n\n### Environment/Versions\n\nTypeScript SDK version 1.11.6\n\nApple M1 Pro\n15.2 (24C101)\n\nTemporal Cloud\n\n### Additional context\n\n<!-- Add any other context about the problem here. -->\n","closedAt":"2025-01-23T05:12:20Z","comments":[{"id":"IC_kwDOEujx186bSupS","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Add this to your `tsconfig.json` file:\n\n```\n{\n  // ...\n  \"compilerOptions\": {\n    // ...\n    \"skipLibCheck\": true  // <<--- This line\n  },\n  // ...\n}\n```\n\nOr make your config extends `@tsconfig/node22/tsconfig.json`, which sets `skipLibCheck` to true.\n\nHaving TypeScript performs type checking on the `node_modules` directory not only slow down compilation, but also exposes you to various compilation errors if your project is not using exactly the same version of the TypeScript compiler as the one the library has been compiled with.","createdAt":"2025-01-21T17:46:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1607#issuecomment-2605378130","viewerDidAuthor":false},{"id":"IC_kwDOEujx186bWl0M","author":{"login":"philwhln"},"authorAssociation":"NONE","body":"@mjameswh Thanks for the response. We do have that set\n\n```\nâ¯ cat tsconfig.json | jq .compilerOptions.skipLibCheck\ntrue\n```\n\nIs this compiled under Node 22? We're on Node 20. Not sure if that affects things at all.","createdAt":"2025-01-22T06:19:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1607#issuecomment-2606390540","viewerDidAuthor":false},{"id":"IC_kwDOEujx186bcb4A","author":{"login":"philwhln"},"authorAssociation":"NONE","body":"Also on the latest update `typescript` npm package version","createdAt":"2025-01-22T18:06:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1607#issuecomment-2607922688","viewerDidAuthor":false},{"id":"IC_kwDOEujx186bd_BG","author":{"login":"philwhln"},"authorAssociation":"NONE","body":"Managed to create a patch that fixes these two TypeScript errors\n\n```\nâ¯ cat patches/@temporalio+client+1.11.5.patch\ndiff --git a/node_modules/@temporalio/client/src/iterators-utils.ts b/node_modules/@temporalio/client/src/iterators-utils.ts\nindex df86d14..9e66d70 100644\n--- a/node_modules/@temporalio/client/src/iterators-utils.ts\n+++ b/node_modules/@temporalio/client/src/iterators-utils.ts\n@@ -56,13 +56,13 @@ export async function* mapAsyncIterable<A, B>(\n\n   const emitter = new EventEmitter();\n   const controller = new AbortController();\n-  const emitterEventsIterable: AsyncIterable<[B]> = on(emitter, 'result', { signal: controller.signal });\n+  const emitterEventsIterable: AsyncIterable<B[]> = on(emitter, 'result', { signal: controller.signal });\n   const emitterError: Promise<unknown[]> = once(emitter, 'error');\n\n   const bufferLimitSemaphore =\n     typeof bufferLimit === 'number'\n       ? (() => {\n-          const releaseEvents: AsyncIterator<void> = toAsyncIterator(\n+          const releaseEvents: AsyncIterator<any[]> = toAsyncIterator(\n             on(emitter, 'released', { signal: controller.signal })\n           );\n           let value = bufferLimit + concurrency;\n```\n\nBut found this is not necessary if TypeScript errors are ignored, which they would have been with `skipLibCheck` if there wasn't some bogus imports ðŸ¤¦ \n\n```\n-import { WorkflowExecutionDescription } from \"@temporalio/client/src/types\";\n-import { AsyncWorkflowListIterable } from \"@temporalio/client/src/workflow-client\";\n+import { WorkflowExecutionDescription } from \"@temporalio/client\";\n+import { AsyncWorkflowListIterable } from \"@temporalio/client\";\n```","createdAt":"2025-01-22T21:41:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"LAUGH","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1607#issuecomment-2608328774","viewerDidAuthor":false}],"createdAt":"2025-01-20T18:32:41Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1607,"reactionGroups":[],"state":"CLOSED","title":"[Bug] TypeScript error TS2322: Type 'AsyncIterableIterator<any[]>' is not assignable to type 'AsyncIterable<[B]>'.","updatedAt":"2025-01-23T05:12:20Z","url":"https://github.com/temporalio/sdk-typescript/issues/1607"}
