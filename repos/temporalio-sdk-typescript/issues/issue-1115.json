{"assignees":[],"author":{"id":"MDQ6VXNlcjI2MzYyMjA2","is_bot":false,"login":"Uria1","name":"Uria Ashkenazy Adler"},"body":"## Expected Behavior\r\nA workflow with failed activities should:\r\n\r\n1. Change the status to \"Failed\"\r\n2. Execute code in a `catch` block if the failed activity is awaited from within a `try` block\r\n\r\n## Actual Behavior\r\n1. Workflow remains in status \"Running\" and later times out assuming a timeout was set.\r\n2. Workflow code in a `catch` block isn't always executed.\r\n3. We see a \"WorkflowTaskFailed\" in the history with cause=unspecified. The failure details contain the same information as the failed activity.\r\n\r\n## Steps to Reproduce the Problem\r\n- Could not create a minimal reproducible example\r\n\r\n## Specifications\r\n  - Version:\r\n  - Platform: \r\n  - SDK: TypeScript\r\n\r\n![Screen Shot 2023-05-02 at 14 29 54](https://user-images.githubusercontent.com/26362206/235654331-7d7f615d-9996-499b-a929-7e502f43f0ba.png)\r\n","closedAt":"2023-05-30T15:28:22Z","comments":[{"id":"IC_kwDOEujx185dRcXR","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"The expected behavior that you're describing is something that we test extensively so I don't think it's an SDK bug.\r\n\r\nMy first goto would be to check if you have multiple versions of any `@temporalio/*` packages as we use `instanceof` checks to determine whether a workflow run or task should fail.","createdAt":"2023-05-26T19:48:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1115#issuecomment-1564853713","viewerDidAuthor":false},{"id":"IC_kwDOEujx185dc_2A","author":{"login":"Uria1"},"authorAssociation":"NONE","body":"I managed to solve the problem.\r\nThe issue was that activities that were started in parallel (without `await`) resulted in promises without proper error handling. I had to add a `catch` block to each activity promise, save any errors that are thrown, and then within the main workflow function, check if any errors occurred and fail the workflow by throwing an `ApplicationFailure`.","createdAt":"2023-05-30T07:07:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1115#issuecomment-1567882624","viewerDidAuthor":false},{"id":"IC_kwDOEujx185df5ZT","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@mjameswh we need to make unhandled rejection clearer. Will save a lot of headaches for users.","createdAt":"2023-05-30T15:28:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1115#issuecomment-1568642643","viewerDidAuthor":false},{"id":"IC_kwDOEujx185dgNay","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Duplicate of #1039","createdAt":"2023-05-30T16:22:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1115#issuecomment-1568724658","viewerDidAuthor":false},{"id":"IC_kwDOEujx185djsP0","author":{"login":"Uria1"},"authorAssociation":"NONE","body":"> @mjameswh we need to make unhandled rejection clearer. Will save a lot of headaches for users.\r\n\r\nCertainly. It wasn't clear and I waisted way too much time trying to fix it.","createdAt":"2023-05-31T07:23:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1115#issuecomment-1569637364","viewerDidAuthor":false}],"createdAt":"2023-05-02T11:32:29Z","labels":[],"milestone":null,"number":1115,"reactionGroups":[],"state":"CLOSED","title":"Workflow Task Failed with Unspecified Cause","updatedAt":"2023-05-31T07:23:10Z","url":"https://github.com/temporalio/sdk-typescript/issues/1115"}
