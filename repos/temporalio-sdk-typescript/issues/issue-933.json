{"assignees":[],"author":{"id":"MDQ6VXNlcjI4MDUyOTE=","is_bot":false,"login":"psigen","name":"Pras Velagapudi"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nDependencies are structured in `@temporalio/worker`'s package.json such that there is no way to not include `webpack` + `@swc/core` in a runtime build, because `@temporalio/worker` includes them in `dependencies` regardless of whether runtime bundling is required or not.\r\n\r\n`@swc/core` is around ~150MB, so it adds a lot of bloat to distroless images and goes completely unused if workflow bundling has already happened in a separate build step, which is common in containerized build processes.\r\n\r\n### Describe the solution you'd like\r\n\r\nIt would be great if we had a runtime package (e.g. `@temporalio/worker-core`) which just contained minimal deps for running a worker and excluded bundler components.  It could itself be a dependency of the full `@temporalio/worker` for compatibility.\r\n\r\n### Additional context\r\n\r\nI added an example build with a step to manually strip out bundler dependencies here:\r\nhttps://github.com/psigen/temporal-ts-example/blob/main/Dockerfile#L77\r\n\r\nThis reduced runtime images by almost 200MB, to a pretty manageable <300MB overall size for a distroless image.\r\n\r\nOriginal idea from [this slack thread](https://temporalio.slack.com/archives/C01DKSMU94L/p1666364463170599?thread_ts=1666045881.718069&cid=C01DKSMU94L)","closedAt":null,"comments":[{"id":"IC_kwDOEujx186cKM76","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"This is a summary of [my comment here](https://github.com/temporalio/sdk-typescript/issues/1613#issuecomment-2619435978):\n\nTo avoid breaking existing code, we should really split the current `worker` package in two: `bundler` and `worker-core`, then have `worker` reexport everything from the two others. The `worker` package would be deprecated, but would need to be kept around until the next major release.\n\nNow, that's totally feasible, but has some painful consequences in regard to other ongoing development efforts â€” pretty much all outstanding PRs and WIP on feature branches would get broken by this change, requiring non-trivial manual work to conciliate changes. That's obviously not a complete blocker, but simply means that we should try to complete and merge as much ongoing work as we can before investing effort in splitting `worker`.\n\nIn the mean time, one may work around this by using any of the following mechanisms:\n- [NPM's `overrides` property](https://docs.npmjs.com/cli/v11/configuring-npm/package-json#overrides);\n- [`yarn`'s resolutions property](https://classic.yarnpkg.com/en/docs/package-json#toc-resolutions);\n- [PNPM's `overrides` property](https://pnpm.io/package_json#pnpmoverrides);\n- [PNPM's `readPackage` hook](https://pnpm.io/pnpmfile).","createdAt":"2025-01-28T19:48:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":3}}],"url":"https://github.com/temporalio/sdk-typescript/issues/933#issuecomment-2619920122","viewerDidAuthor":false},{"id":"IC_kwDOEujx186dWYiP","author":{"login":"shamrin"},"authorAssociation":"NONE","body":"NPM `overrides` feature lacks an ability to skip dependency. I had to manually edit `package-lock.json` to accomplish it:\n\n```shell\n# step 1: install worker\nnpm install @temporalio/worker\n\n# step 2: manually remove all references to `@swc/core` and `swc-loader` from package-lock.json\n\n# step 3: reinstall everything based on modified package-lock.json\nrm -rf node_modules/\nnpm install\n```","createdAt":"2025-02-06T13:52:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/933#issuecomment-2639890575","viewerDidAuthor":false}],"createdAt":"2022-10-22T16:24:02Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":933,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":6}}],"state":"OPEN","title":"[Feature Request] Create a separate \"core\" library for workflows that does not include bundler deps.","updatedAt":"2025-02-06T13:52:26Z","url":"https://github.com/temporalio/sdk-typescript/issues/933"}
