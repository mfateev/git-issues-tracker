{"assignees":[],"author":{"id":"MDQ6VXNlcjEwOTg0MDI5","is_bot":false,"login":"mengyazhu96","name":"jessica"},"body":"### Is your feature request related to a problem? Please describe.\r\nPer the [production deployment docs](https://docs.temporal.io/docs/server/production-deployment#scaling-and-metrics) we've set up metrics using statsd since it's easy to pipe to Datadog for our Temporal server deployment. However, as specified the most important metric to track is ScheduleToStart which is an SDK metric.\r\n\r\n### Describe the solution you'd like\r\nIt would be great to be able to specify [statsd configuration similar to the server config](https://docs.temporal.io/docs/server/configuration/#metrics) in the Typescript SDK on Worker creation to be able to send ScheduleToStart metrics.\r\n\r\n### Additional context\r\nhttps://temporalio.slack.com/archives/C01DKSMU94L/p1634848505016400\r\n","closedAt":"2021-11-02T02:23:40Z","comments":[{"id":"IC_kwDOEujx1844lIym","author":{"login":"mengyazhu96"},"authorAssociation":"NONE","body":"On a related note, I think the production deployment docs should explicitly call out that `ScheduleToStart` is an SDK-issued metric, where that metrics piping is set up independently of the server -- maybe this already exist in the docs for the other SDKs. I'm happy to file an issue in the server repo if helpful, or open a PR with suggested documentation updates.","createdAt":"2021-10-22T03:36:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-949259430","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844tvHh","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@Sushisource can you please look into this?\r\nHow easy would it be to support statsd metrics exporter by default in core?","createdAt":"2021-10-26T03:01:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-951513569","viewerDidAuthor":false},{"id":"IC_kwDOEujx18447iYF","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"So the way to do this is to just to use the OTel collector exporter and configure the collector to route to statsd. Or, in this case since the real end goal is datadog, the datadog exporter. https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/datadogexporter\r\n\r\nI'm really hesitant to add more kinds of exporters into the code directly since this is exactly the territory the collector solves. @mengyazhu96 Let me know if you have any trouble with this approach or it's unclear how to get it going.","createdAt":"2021-10-30T02:30:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-955131397","viewerDidAuthor":false},{"id":"IC_kwDOEujx1845C0OZ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Closing this issue @mengyazhu96.\r\nWe'll add documentation to explain how to set this up.","createdAt":"2021-11-02T02:23:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-957039513","viewerDidAuthor":false},{"id":"IC_kwDOEujx1848qx8r","author":{"login":"rupalivohra"},"authorAssociation":"NONE","body":"There's overhead to setting up an OTel collector. It'd be great if the SDK supported routing to DataDog more directly.","createdAt":"2022-01-20T19:26:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-1017847595","viewerDidAuthor":false},{"id":"IC_kwDOEujx1848r6yc","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I see that there's a Rust DataDog exporter [crate](https://crates.io/crates/opentelemetry-datadog) but I'm not convinced we should embed it in Core.\r\n@Sushisource can you think of a way to optionally include it?","createdAt":"2022-01-21T03:56:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-1018145948","viewerDidAuthor":false},{"id":"IC_kwDOEujx1848uGGG","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"@bergundy These are the options:\r\n\r\n1. Embed it, always linked in. Optionally enabled. Needs more config options, will increase bin size, and sets precedent that we might include every otel exporter directly in core. Also doesn't work with combining data from Lang SDKs, as now they also need to direct-export to datadog.\r\n2. Same as above except force users to recompile core so it isn't always linked in. This obviously is no fun.\r\n3. Same as above except dynamically link in somehow. Better than forcing recompile but complex.\r\n\r\nI can definitely sympathize with the overhead of deploying an OTel Collector, but it adds a lot of flexibility for users once they do. They can centralize their config, easily export to multiple destinations and collect from multiple sources, etc.\r\n\r\nThe big problem here is that we emit metrics from both Core and Lang. Every direct export we support it needs to exist in Core and all langs on top of core and that pretty quickly adds up to supporting a _lot_ of different exporters. That, or we figure out piping metrics into one side so it can always emit them for both halves, but as you probably remember that was a sisyphean undertaking when I first went down that path.","createdAt":"2022-01-21T17:29:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-1018716550","viewerDidAuthor":false},{"id":"IC_kwDOEujx1848uIjm","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"It should be noted we don't support statsd natively in Go/Java SDK. Rather they use the abstract \"Tally\" libs from Uber (and in Go, it's not even compiled in by default). There just so happen to be connectors for that lib to statsd.\r\n\r\nIs it possible to provide metrics from core to lang upon request? I think the pull model works w/ prom, otel, etc but I'd have to confirm. Then lang can choose what to do with them, including statsd export. There's an added benefit of having all metrics in one place. The structures for our metrics (counter, gauge, time-based all w/ optional labels) shouldn't be that difficult to abstract if you didn't want the otel-specific structures going over the bridge.","createdAt":"2022-01-21T17:43:44Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-1018726630","viewerDidAuthor":false},{"id":"IC_kwDOEujx1848uMag","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@cretz that's what we initially tried to do for both metrics and traces but from what @Sushisource reports it ended up being a lot of work and didn't have good support from otel.\r\n\r\nI still think exporting to lang is more flexible because it allows users to use their library of choice to export telemetry.","createdAt":"2022-01-21T18:06:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-1018742432","viewerDidAuthor":false},{"id":"IC_kwDOEujx1848uTiX","author":{"login":"Sushisource"},"authorAssociation":"MEMBER","body":"It was an absolute nightmare to do that kind of exporting. We could make our own metrics abstractions, but that's a business I don't particularly want to be in. There's quite a bit of complexity in getting that right. I think it's definitely a direction we could eventually end up going, but priorities wise I don't think it's the best use of time at the moment.","createdAt":"2022-01-21T18:48:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/327#issuecomment-1018771607","viewerDidAuthor":false}],"createdAt":"2021-10-22T03:34:14Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":327,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] Add statsd support to Typescript SDK","updatedAt":"2022-01-21T18:48:59Z","url":"https://github.com/temporalio/sdk-typescript/issues/327"}
