{"assignees":[],"author":{"id":"MDQ6VXNlcjE2NzAwNjMx","is_bot":false,"login":"Andrei199991","name":""},"body":"### What are you really trying to do?\r\n\r\nUpgrading 4 Temporal packages from 1.4.0 to 1.5.2, ie:\r\n\r\n```\r\n    \"@temporalio/activity\": \"1.4.0\",\r\n    \"@temporalio/client\": \"1.4.0\",\r\n    \"@temporalio/worker\": \"1.4.0\",\r\n    \"@temporalio/workflow\": \"1.4.0\",\r\n```\r\n\r\nto\r\n\r\n```\r\n    \"@temporalio/activity\": \"1.5.2\",\r\n    \"@temporalio/client\": \"1.5.2\",\r\n    \"@temporalio/worker\": \"1.5.2\",\r\n    \"@temporalio/workflow\": \"1.5.2\"\r\n```\r\n\r\nbut I forgot to remove `@temporalio/testing:1.4.0` from my project, crashing it entirely. _(perhaps upgrading would've worked, too?)_\r\n\r\n### Describe the bug\r\n\r\nKeeping `@temporalio/testing:1.4.0` w/ `\"@temporalio/activity\": \"1.5.2\"` & `\"@temporalio/client\": \"1.5.2\"` & `\"@temporalio/worker\": \"1.5.2\"` & `\"@temporalio/workflow\": \"1.5.2\"` in package.json will prevent a Temporal Worker from running - it results in a `protobuf` error.\r\n\r\n![image](https://user-images.githubusercontent.com/16700631/208650275-87d3db88-fe44-4b2f-b5ff-ed343c8ed333.png)\r\n\r\n### Minimal Reproduction\r\n\r\n`npm i @temporalio/testing@1.4.0 @temporalio/activity@1.5.2 @temporalio/client@1.5.2 @temporalio/worker@1.5.2 @temporalio/workflow@1.5.2`\r\n\r\nthen start your Temporal Worker.\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: x86 Windows\r\n- Temporal Version: SDK 1.5.2, except for `@temporalio/testing@1.4.0`\r\n- Are you using Docker or Kubernetes or building Temporal from source? - Docker\r\n\r\n### Additional context\r\n\r\n- **@temporalio/testing@1.4.0** forces **package-lock.json** to install `@temporalio/proto:1.4.3` in its root (`dependencies`). I believe this is the error. Uninstalling **@temporalio/testing@1.4.0** fixed it.\r\n- I know, installing both **1.4.0** and **1.5.2** packages is dumb. But it shouldn't crash Temporal, should it? \r\n\r\nI'm not very good at manipulating `package-lock.json`, but I venture to guess this is fixable by ensuring `@temporalio/proto` is listed as a `\"child\" dependency` rather than `\"root\" dependency`, eg:\r\n\r\n**correct result?**\r\n```\r\npackage-lock.json\r\n{\r\n    \"dependencies\": {\r\n        \"@temporalio/activity\": {\r\n            \"dependencies\": {\r\n                \"@temporalio/proto@1.4.3\": { ... }\r\n                // ...\r\n            }\r\n        }\r\n        // ...\r\n    }\r\n    // ...\r\n}\r\n```\r\n\r\ninstead of\r\n\r\n```\r\npackage-lock.json\r\n{\r\n    \"dependencies\": {\r\n        \"@temporalio/proto@1.4.3\": { ... }\r\n        \"@temporalio/activity\": {\r\n            \"dependencies\": {\r\n                // ...\r\n            }\r\n        }\r\n        // ...\r\n    }\r\n    // ...\r\n}\r\n```","closedAt":"2022-12-20T11:16:38Z","comments":[{"id":"IC_kwDOEujx185RA8r8","author":{"login":"Andrei199991"},"authorAssociation":"NONE","body":"hold on, this info isn't entirely accurate. i might reopen / fix this bug report","createdAt":"2022-12-20T11:16:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1004#issuecomment-1359203068","viewerDidAuthor":false},{"id":"IC_kwDOEujx185RBJnB","author":{"login":"Andrei199991"},"authorAssociation":"NONE","body":"just in case you're curious - my `package-json.lock` file was broken on multiple levels. the \"**correct result**\" listed above is what fixed it (first I manually fixed/unnested the subdependency array, then I deleted the lockfile and ran `npm i`).\r\n\r\nI don't know if this is **my** or **Temporal SDK**'s fault (although all i did was `npm i`... I think I'm clean), so I won't bother you with this... ðŸ˜…","createdAt":"2022-12-20T11:59:12Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1004#issuecomment-1359256001","viewerDidAuthor":false}],"createdAt":"2022-12-20T11:11:36Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1004,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Installing \"@temporalio/testing:1.4.0\" along with 1.5.2 libs (activity/client/worker/workflow) breaks Temporal","updatedAt":"2022-12-20T12:00:26Z","url":"https://github.com/temporalio/sdk-typescript/issues/1004"}
