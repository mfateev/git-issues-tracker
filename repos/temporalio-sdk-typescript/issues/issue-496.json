{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ‚ò∫Ô∏è"},"body":"There are a number of transient CI failures that we'd like to fix with code instead of the \"rebuild\" button üòÑ Let's collect them.\r\n\r\nHere's one:\r\n\r\nhttps://github.com/temporalio/sdk-typescript/runs/5296245052?check_suite_focus=true\r\n\r\n```\r\nRun node scripts/init-from-verdaccio.js --registry-dir /tmp/registry --sample https://github.com/temporalio/samples-typescript/tree/next/hello-world-mtls\r\nStarting local registry\r\nError: Path D:\\tmp\\registry\\verdaccio.log does not exist\r\n```\r\n\r\n[compile-binaries (macos-latest, x86_64-apple-darwin)](https://github.com/temporalio/sdk-typescript/runs/5631928072?check_suite_focus=true#logs)\r\n\r\n```\r\nWarning, failed destroying registry ChildProcessError: Process failed\r\n    at ChildProcess.<anonymous> (/Users/runner/work/sdk-typescript/sdk-typescript/scripts/utils.js:18:[16](https://github.com/temporalio/sdk-typescript/runs/5631928072?check_suite_focus=true#step:10:16))\r\n    at ChildProcess.emit (node:events:5[20](https://github.com/temporalio/sdk-typescript/runs/5631928072?check_suite_focus=true#step:10:20):28)\r\n    at Process.ChildProcess._handle.onexit (node:internal/child_process:291:12) {\r\n  code: 1,\r\n  signal: null\r\n}\r\nError: Path /tmp/registry/verdaccio.log does not exist\r\n```","closedAt":"2022-11-24T04:11:35Z","comments":[{"id":"IC_kwDOEujx184-fioz","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"## timeouts publishing to or initing from verdaccio\r\n\r\n[test-npm-init (windows-latest, x86_64-pc-windows-msvc, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#logs)\r\n\r\n```\r\nRun node scripts/init-from-verdaccio.js --registry-dir /tmp/registry --sample https://github.com/temporalio/samples-typescript/tree/next/hello-world-mtls\r\nStarting local registry\r\nError: Timed out waiting for verdaccio - {\"level\":40,\"time\":1646420388935,\"pid\":1944,\"hostname\":\"fv-az140-90[7](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#step:6:7)\",\"content\":\"htpasswd\",\"prefix\":\"verdaccio\",\"msg\":\"Plugin successfully loaded: @{prefix}-@{content}\"}\r\n{\"level\":40,\"time\":16464203[8](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#step:6:8)8[9](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#step:6:9)57,\"pid\":1944,\"hostname\":\"fv-az140-907\",\"addr\":\"http://localhost:4873/\",\"version\":\"verdaccio/5.7.0\",\"msg\":\"http address - @{addr} - @{version}\"}\r\n\r\n    at Timeout._onTimeout (D:\\a\\sdk-typescript\\sdk-typescript\\scripts\\registry.js:59:18)\r\nError: Process completed with exit code 1.\r\n```\r\n\r\nhttps://github.com/temporalio/sdk-typescript/runs/5298726692?check_suite_focus=true\r\n\r\n```\r\nRun node scripts/publish-to-verdaccio.js --registry-dir /tmp/registry\r\nStarting local registry\r\nError: Timed out waiting for verdaccio - {\"level\":40,\"time\":1645592119724,\"pid\":3384,\"hostname\":\"fv-az140-199\",\"content\":\"htpasswd\",\"prefix\":\"verdaccio\",\"msg\":\"Plugin successfully loaded: @{prefix}-@{content}\"}\r\n{\"level\":40,\"time\":1645592119745,\"pid\":3384,\"hostname\":\"fv-az140-199\",\"addr\":\"http://localhost:4873/\",\"version\":\"verdaccio/5.6.0\",\"msg\":\"http address - @{addr} - @{version}\"}\r\n\r\n    at Timeout._onTimeout (D:\\a\\sdk-typescript\\sdk-typescript\\scripts\\registry.js:59:18)\r\nError: Process completed with exit code 1.\r\n```","createdAt":"2022-02-23T05:14:50Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1048455731","viewerDidAuthor":false},{"id":"IC_kwDOEujx184-heFB","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[sdk-features-tests / build-ts](https://github.com/temporalio/sdk-typescript/runs/5298947280?check_suite_focus=true#logs) > Checkout typescript SDK repo\r\n\r\n```\r\n34s\r\nRun actions/checkout@v2\r\nSyncing repository: temporalio/sdk-typescript\r\nGetting Git version info\r\nInitializing the repository\r\nDisabling automatic garbage collection\r\nSetting up auth\r\nFetching the repository\r\n  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=[1](https://github.com/temporalio/sdk-typescript/runs/5298947280?check_suite_focus=true#step:4:1) origin +refs/heads/remove-comments*:refs/remotes/origin/remove-comments* +refs/tags/remove-comments*:refs/tags/remove-comments*\r\n  The process '/usr/bin/git' failed with exit code 1\r\n  Waiting [18](https://github.com/temporalio/sdk-typescript/runs/5298947280?check_suite_focus=true#step:4:18) seconds before trying again\r\n  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +refs/heads/remove-comments*:refs/remotes/origin/remove-comments* +refs/tags/remove-comments*:refs/tags/remove-comments*\r\n  The process '/usr/bin/git' failed with exit code 1\r\n  Waiting 15 seconds before trying again\r\n  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +refs/heads/remove-comments*:refs/remotes/origin/remove-comments* +refs/tags/remove-comments*:refs/tags/remove-comments*\r\n  Error: The process '/usr/bin/git' failed with exit code 1\r\n```","createdAt":"2022-02-23T16:22:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1048961345","viewerDidAuthor":false},{"id":"IC_kwDOEujx184-hu3f","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[build-and-test (16, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5304505605?check_suite_focus=true#logs) > npm test\r\n\r\n```\r\nError: alio/test: 2022-02-23T14:19:05.438Z [ERROR] Worker failed {\r\n@temporalio/test:   error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\packages\\worker\\src\\worker.ts:[393](https://github.com/temporalio/sdk-typescript/runs/5304505605?check_suite_focus=true#step:11:393):17\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\map.ts:58:33\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run throws if not shut down gracefully\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\mergeInternals.ts:85:24\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\map.ts:58:20\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test: }\r\n@temporalio/test: 2022-02-23T14:19:05.460Z [INFO] Worker state changed { state: 'FAILED' }\r\n```\r\n\r\n[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5307583046?check_suite_focus=true#logs)\r\n\r\n```\r\n@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run shuts down gracefully\r\n@temporalio/test: 2022-02-23T17:45:23.226Z [INFO] Worker state changed { state: 'STOPPING' }\r\nError: alio/test: 2022-02-23T17:45:23.239Z [ERROR] Worker failed {\r\n@temporalio/test:   error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\packages\\worker\\src\\worker.ts:393:17\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\map.ts:58:33\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\mergeInternals.ts:85:24\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\map.ts:58:20\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test: }\r\n```\r\n\r\n[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5339291839?check_suite_focus=true#logs) > npm test\r\n\r\n```\r\n@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run shuts down gracefully\r\n@temporalio/test: 2022-02-25T21:13:56.045Z [INFO] Worker state changed { state: 'STOPPING' }\r\nError: alio/test: 2022-02-25T21:13:56.052Z [ERROR] Worker failed {\r\n@temporalio/test:   error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\packages\\worker\\src\\worker.ts:391:17\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\map.ts:58:33\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run throws if not shut down gracefully\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\mergeInternals.ts:85:24\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test:       at D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\map.ts:58:20\r\n@temporalio/test:       at OperatorSubscriber._this._next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\operators\\OperatorSubscriber.ts:43:13)\r\n@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\\a\\sdk-typescript\\sdk-typescript\\node_modules\\rxjs\\src\\internal\\Subscriber.ts:75:12)\r\n@temporalio/test: }\r\n```","createdAt":"2022-02-23T17:30:06Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1049030111","viewerDidAuthor":false},{"id":"IC_kwDOEujx184_CGmw","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[test-npm-init (windows-latest, x86_64-pc-windows-msvc, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/runs/5399993983?check_suite_focus=true#logs)\r\n\r\n```\r\nRun node scripts/test-example.js --work-dir /tmp/registry/example\r\nStarting worker\r\nWorkflowExecutionAlreadyStartedError: Workflow execution already started\r\n    at WorkflowClient._startWorkflowHandler (D:\\tmp\\registry\\example\\node_modules\\@temporalio\\client\\src\\workflow-client.ts:659:[15](https://github.com/temporalio/sdk-typescript/runs/5399993983?check_suite_focus=true#step:12:15))\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at async WorkflowClient.execute (D:\\tmp\\registry\\example\\node_modules\\@temporalio\\client\\src\\workflow-client.ts:378:5)\r\n    at async run (D:\\tmp\\registry\\example\\src\\execute-workflow.ts:38:[18](https://github.com/temporalio/sdk-typescript/runs/5399993983?check_suite_focus=true#step:12:18)) {\r\n  workflowId: 'my-business-id',\r\n  workflowType: 'example'\r\n}\r\n```\r\n\r\n[test-npm-init (windows-latest, x86_64-pc-windows-msvc, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/runs/5514867672?check_suite_focus=true#logs)","createdAt":"2022-03-02T23:50:04Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1057515952","viewerDidAuthor":false},{"id":"IC_kwDOEujx184_QeTD","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Buildkite https://buildkite.com/temporal/typescript-sdk/builds/785#a8a253f2-23f1-407b-b9b6-35daac9a835e\r\n\r\n![image](https://user-images.githubusercontent.com/251288/157141914-8b8eb1d5-79e0-4b61-8768-75f945749b10.png)\r\n","createdAt":"2022-03-08T00:33:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1061283011","viewerDidAuthor":false},{"id":"IC_kwDOEujx184_dcIz","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[test-npm-init (ubuntu-latest, x86_64-unknown-linux-gnu, 16, local, hello-world)](https://github.com/temporalio/sdk-typescript/runs/5504329163?check_suite_focus=true#logs) \r\n\r\nhanging, perhaps due to a failed attempt at GH canceling it because another test failed? \r\n\r\n<img width=\"894\" alt=\"image\" src=\"https://user-images.githubusercontent.com/251288/157784306-606f7093-931e-4021-a764-abe2984293a8.png\">\r\n\r\nThanks to @julianocomg for reporting","createdAt":"2022-03-11T01:30:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1064682035","viewerDidAuthor":false},{"id":"IC_kwDOEujx185AB7O_","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[build-and-test (14, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/5631927497?check_suite_focus=true#logs)\r\n\r\n```\r\n@temporalio/test: npm ERR! code ELIFECYCLE\r\n@temporalio/test:   ‚úî workflows ‚Ä∫ nestedCancellation (607ms)\r\n@temporalio/test: npm ERR! errno 1\r\n@temporalio/test:   ‚úî workflows ‚Ä∫ partialShield (600ms)\r\n@temporalio/test: npm ERR! @temporalio/test@0.19.1 test: `ava ./lib/test-*.js`\r\n@temporalio/test:   ‚îÄ\r\n@temporalio/test: npm ERR! Exit status 1\r\n@temporalio/test:   testenvironment ‚Ä∫ before hook\r\n@temporalio/test: npm ERR! \r\n@temporalio/test:   Rejected promise returned by test. Reason:\r\n@temporalio/test: npm ERR! Failed at the @temporalio/test@0.19.1 test script.\r\n@temporalio/test:   Error {\r\n@temporalio/test: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n@temporalio/test:     message: 'Failed to connect before the deadline',\r\n@temporalio/test:   }\r\n@temporalio/test:   ‚Ä∫ checkState (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/src/client.ts:172:18)\r\n@temporalio/test:   ‚Ä∫ Timeout._onTimeout (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/src/channel.ts:712:9)\r\n@temporalio/test:   ‚îÄ\r\n@temporalio/test:   1 hook failed\r\n@temporalio/test: npm WARN Local package.json exists, but node_modules missing, did you mean to install?\r\n@temporalio/test: npm ERR! A complete log of this run can be found in:\r\n@temporalio/test: npm ERR!     /Users/runner/.npm/_logs/2022-03-21T18_00_02_510Z-debug.log\r\nlerna ERR! npm run test exited 1 in '@temporalio/test'\r\nnpm ERR! Test failed.  See above for more details.\r\nError: Process completed with exit code 1.\r\n```","createdAt":"2022-03-21T18:11:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1074246591","viewerDidAuthor":false},{"id":"IC_kwDOEujx185ADFoS","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[build-and-test (16, ubuntu-latest)](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#logs)\r\n\r\n```\r\nRun npm run wait-namespace\r\n\r\n> wait-namespace\r\n> node ./scripts/wait-on-temporal.mjs\r\n\r\nFailed to connect Error: 1[4](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:4) UNAVAILABLE: No connection established\r\n    at Object.callErrorFromStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/call.js:31:26)\r\n    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/client.js:180:[5](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:5)2)\r\n    at /home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/call-stream.js:111:35\r\n    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/lib/grpc-retry.js:89:37)\r\n    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:3[6](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:6)5:141)\r\n    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:328:181)\r\n    at /home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/call-stream.js:182:[7](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:7)[8](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:8)\r\n    at processTicksAndRejections (node:internal/process/task_queues:78:[11](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:11)) {\r\n  code: [14](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:14),\r\n  details: 'No connection established',\r\n  metadata: Metadata { internalRepr: Map(0) {}, options: {} }\r\n}\r\nError: Process completed with exit code 1.\r\n```","createdAt":"2022-03-22T00:22:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1074551314","viewerDidAuthor":false},{"id":"IC_kwDOEujx185D5kkO","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"This one was local:\r\n\r\n```\r\n@temporalio/test:   local-activities ‚Ä∫ Local activity backs off with timer\r\n@temporalio/test:   Difference:\r\n@temporalio/test:   - 0\r\n@temporalio/test:   + 1\r\n@temporalio/test:   ‚Ä∫ src/test-local-activities.ts:236:9\r\n@temporalio/test:   ‚Ä∫ runWorker (src/test-local-activities.ts:21:3)\r\n@temporalio/test:   ‚Ä∫ src/test-local-activities.ts:222:5\r\n```\r\n\r\n<img width=\"1123\" alt=\"image\" src=\"https://user-images.githubusercontent.com/251288/170603741-b801dbab-82fa-49bf-a8c6-fafe7074bacc.png\">\r\n","createdAt":"2022-05-27T00:13:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1139165454","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EsmO9","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/6820063801?check_suite_focus=true#logs)\r\n\r\n```\r\n@temporalio/test:   testenvironment ¬ª TestEnvironment can toggle between normal and skipped time\r\n@temporalio/test:   Rejected promise returned by test. Reason:\r\n@temporalio/test:   UnexpectedError {\r\n@temporalio/test:     message: 'Found more than one reference to the native Worker',\r\n@temporalio/test:   }\r\n@temporalio/test:   ¬ª Runtime.deregisterWorker (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/runtime.ts:310:51)\r\n@temporalio/test:   ¬ª NativeWorker.finalizeShutdown (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/worker.ts:178:24)\r\n@temporalio/test:   ¬ª Worker.run (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/worker.ts:1485:31)\r\n@temporalio/test:   ¬ª withWorker (src/test-testenvironment.ts:26:20)\r\n@temporalio/test:   ¬ª src/test-testenvironment.ts:90:3\r\n@temporalio/test:   testenvironment ¬ª after.always hook\r\n@temporalio/test:   Rejected promise returned by test. Reason:\r\n@temporalio/test:   IllegalStateError {\r\n@temporalio/test:     message: 'Cannot close connection while Workers hold a reference to it',\r\n@temporalio/test:   }\r\n@temporalio/test:   ¬ª NativeConnection.close (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/connection.ts:51:13)\r\n@temporalio/test:   ¬ª TestWorkflowEnvironment.teardown (D:/a/sdk-typescript/sdk-typescript/packages/testing/src/index.ts:240:33)\r\n@temporalio/test:   ¬ª src/test-testenvironment.ts:43:3\r\n@temporalio/test:   ‚îÄ\r\n@temporalio/test:   1 hook failed\r\n@temporalio/test:   1 test failed\r\n```","createdAt":"2022-06-10T16:35:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1152541629","viewerDidAuthor":false},{"id":"IC_kwDOEujx185E9FgQ","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Just fixed the latest one in #701 ","createdAt":"2022-06-15T19:53:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1156864016","viewerDidAuthor":false},{"id":"IC_kwDOEujx185FgUQU","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[build-and-test (14, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#logs)\r\n\r\n[build-and-test (14, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/7224994035?check_suite_focus=true#logs)\r\n\r\n[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/7240533126?check_suite_focus=true#logs)\r\n\r\n```\r\nRun npm ci --ignore-scripts\r\n  npm ci --ignore-scripts\r\n  shell: /bin/bash -e {0}\r\n  env:\r\n    GITHUB_TOKEN: ***\r\nnpm ERR! cb() never called!\r\nnpm ERR! This is an error with npm itself. Please report this error at:\r\nnpm ERR!     <https://npm.community>\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /Users/runner/.npm/_logs/[2](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:2)022-06-2[4](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:4)T21_42_[5](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:5)0_24[8](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:9)Z-debug.log\r\nError: Process completed with exit code 1.\r\n```\r\n\r\nMake `/Users/runner/.npm/_logs` a build artifact?","createdAt":"2022-06-24T23:51:13Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1166099476","viewerDidAuthor":false},{"id":"IC_kwDOEujx185GSpPY","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"[build-and-test (16, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/7201322718?check_suite_focus=true#logs)\r\n\r\n[build-and-test (16, ubuntu-latest)](https://github.com/temporalio/sdk-typescript/runs/7352016624?check_suite_focus=true#logs)\r\n\r\n```\r\n@temporalio/test:   replay ‚Ä∫ cancel-fake-progress-replay\r\n@temporalio/test:   Rejected promise returned by test. Reason:\r\n@temporalio/test:   UnexpectedError {\r\n@temporalio/test:     message: 'channel closed',\r\n@temporalio/test:   }\r\n@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/worker.js:887:54\r\n@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/tracing.js:65:26\r\n@temporalio/test:   ‚Ä∫ NoopContextManager.with (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@opentelemetry/api/build/src/context/NoopContextManager.js:36:24)\r\n@temporalio/test:   ‚Ä∫ ContextAPI.with (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@opentelemetry/api/build/src/api/context.js:71:54)\r\n@temporalio/test:   ‚Ä∫ instrument (/Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/tracing.js:61:29)\r\n@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/worker.js:883:51\r\n@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/worker.js:352:33\r\n@temporalio/test:   ‚îÄ\r\n@temporalio/test:   1 test failed\r\n```","createdAt":"2022-07-08T19:18:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1179292632","viewerDidAuthor":false},{"id":"IC_kwDOEujx185GTO3-","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Awesome work tracking all of this @lorensr I think some of these issues have already been solved.\r\nMight be worth tracking each individual flake.\r\n\r\nThe new channel closed one worries me and could happen to users in production but it might just be during shutdown so it might not be too critical.","createdAt":"2022-07-09T00:49:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1179446782","viewerDidAuthor":false},{"id":"IC_kwDOEujx185GTO9L","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Hmm.. nm looks like it happens in the replay worker, still troubling but not as much","createdAt":"2022-07-09T00:51:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1179447115","viewerDidAuthor":false},{"id":"IC_kwDOEujx185GpGZK","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Got above channel closed failure a few times locally, and also this new version of it:\r\n\r\n```\r\n@temporalio/test:   replay ‚Ä∫ cancel-fake-progress-replay-nondeterministic\r\n@temporalio/test:   lib/test-replay.js:68\r\n@temporalio/test:    67:     hist.events[0].workflowExecutionStartedEventAttributes.workflowType.‚Ä¶\r\n@temporalio/test:    68:     await t.throwsAsync(worker_1.Worker.runReplayHistory({\r\n@temporalio/test:    69:         workflowsPath: require.resolve('./workflows'),\r\n@temporalio/test:   Promise rejected with unexpected exception:\r\n@temporalio/test:   UnexpectedError {\r\n@temporalio/test:     message: 'channel closed',\r\n@temporalio/test:   }\r\n@temporalio/test:   Expected instance of:\r\n@temporalio/test:   Function DeterminismViolationError {}\r\n@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/worker.js:910:54\r\n@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/tracing.js:65:26\r\n@temporalio/test:   ‚Ä∫ NoopContextManager.with (/Users/me/gh/sdk2/node_modules/@opentelemetry/api/build/src/context/NoopContextManager.js:36:24)\r\n@temporalio/test:   ‚Ä∫ ContextAPI.with (/Users/me/gh/sdk2/node_modules/@opentelemetry/api/build/src/api/context.js:71:54)\r\n@temporalio/test:   ‚Ä∫ instrument (/Users/me/gh/sdk2/packages/worker/lib/tracing.js:61:29)\r\n@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/worker.js:906:51\r\n@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/worker.js:379:33\r\n@temporalio/test:   ‚îÄ\r\n```\r\n\r\nhttps://app.warp.dev/block/cnnzcwtjYDvLxKkYu7YEFK","createdAt":"2022-07-15T05:09:13Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1185179210","viewerDidAuthor":false},{"id":"IC_kwDOEujx185PBKsi","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@bergundy @lorensr Do you guys remember seeing any of these flakes recently? If not, I suggest that we close this issue now, and just track any further flake pattern in distinct, specific issues.","createdAt":"2022-11-23T21:57:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1325706018","viewerDidAuthor":false},{"id":"IC_kwDOEujx185PCDfN","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I think we addressed all of the known flakes.\r\nFrom time to time I see npm ci failing with an internal npm error and I‚Äôm considering moving from npm but we can track this separately.","createdAt":"2022-11-24T04:21:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/496#issuecomment-1325938637","viewerDidAuthor":false}],"createdAt":"2022-02-23T05:13:03Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":496,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Fix flakey tests","updatedAt":"2022-11-24T04:21:04Z","url":"https://github.com/temporalio/sdk-typescript/issues/496"}
