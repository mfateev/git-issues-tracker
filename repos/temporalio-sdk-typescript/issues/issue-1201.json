{"assignees":[],"author":{"id":"MDQ6VXNlcjQyMjQyMDU1","is_bot":false,"login":"Naik1994","name":"Harish Naik B S"},"body":"@mjameswh Request you to check and suggest on below issue.\r\n\r\nWe have written a cron job using temporal workflow which executes half an hour once. We have not written a separate worker for this job workflow instead using the one namespace and one task queue to perform API calls and this JOB. Also, our application is running on AWS ECS with 4 default tasks (not sure if this will have any impact on scheduled job).\r\n\r\nAs in when we deploy our code on ECS container, cron is getting scheduled properly however getting terminated automatically after some time before execution. We tried to enable `workflowRunTimeout` and `workflowTaskTimeout` settings however sometime cron executed and terminated inbetween and sometimes it terminated immediatly after scheduling.\r\n\r\nschedular settings used =>\r\n`await client.start(\"cronJob\", {\r\n      taskQueue: 'test',\r\n      workflowId: uuid(),\r\n      cronSchedule: '*/30 * * * *',\r\n      workflowRunTimeout: '86400000',\r\n      workflowTaskTimeout: '300000',\r\n      args: [uuid4()]\r\n})`\r\n\r\nFailure events captured in UI =>\r\n1] terminated within 1 minute of scheduling job with below event object:\r\n{\r\n  \"eventId\": \"2\",\r\n  \"eventTime\": \"2023-08-11T08:47:13.012448068Z\",\r\n  \"eventType\": \"WorkflowExecutionTerminated\",\r\n  \"version\": \"0\",\r\n  \"taskId\": \"10560924366\",\r\n  \"workerMayIgnore\": false,\r\n  \"workflowExecutionTerminatedEventAttributes\": {\r\n    \"reason\": \"\",\r\n    \"details\": {\r\n      \"payloads\": []\r\n    },\r\n    \"identity\": \"1@7c97cc146289\"\r\n  },\r\n  \"name\": \"WorkflowExecutionTerminated\",\r\n  \"id\": \"2\",\r\n  \"timestamp\": \"2023-08-11 UTC 08:47:13.01\",\r\n  \"classification\": \"Terminated\",\r\n  \"category\": \"workflow\",\r\n  \"attributes\": {\r\n    \"type\": \"workflowExecutionTerminatedEventAttributes\",\r\n    \"reason\": \"\",\r\n    \"details\": {\r\n      \"payloads\": []\r\n    },\r\n    \"identity\": \"1@7c97cc146289\"\r\n  }\r\n}\r\n\r\n2] terminated in between while executing the job:\r\n{\r\n  \"eventId\": \"2278\",\r\n  \"eventTime\": \"2023-08-11T07:02:56.007332938Z\",\r\n  \"eventType\": \"WorkflowTaskFailed\",\r\n  \"version\": \"0\",\r\n  \"taskId\": \"10560921210\",\r\n  \"workerMayIgnore\": false,\r\n  \"workflowTaskFailedEventAttributes\": {\r\n    \"scheduledEventId\": \"2276\",\r\n    \"startedEventId\": \"2277\",\r\n    \"cause\": \"ForceCloseCommand\",\r\n    \"failure\": null,\r\n    \"identity\": \"history-service\",\r\n    \"baseRunId\": \"\",\r\n    \"newRunId\": \"\",\r\n    \"forkEventVersion\": \"0\",\r\n    \"binaryChecksum\": \"\",\r\n    \"workerVersion\": null\r\n  },\r\n  \"name\": \"WorkflowTaskFailed\",\r\n  \"id\": \"2278\",\r\n  \"timestamp\": \"2023-08-11 UTC 07:02:56.00\",\r\n  \"classification\": \"Failed\",\r\n  \"category\": \"workflow\",\r\n  \"attributes\": {\r\n    \"type\": \"workflowTaskFailedEventAttributes\",\r\n    \"scheduledEventId\": \"2276\",\r\n    \"startedEventId\": \"2277\",\r\n    \"cause\": \"ForceCloseCommand\",\r\n    \"failure\": null,\r\n    \"identity\": \"history-service\",\r\n    \"baseRunId\": \"\",\r\n    \"newRunId\": \"\",\r\n    \"forkEventVersion\": \"0\",\r\n    \"binaryChecksum\": \"\",\r\n    \"workerVersion\": null\r\n  }\r\n}\r\n\r\nPlease let us know if we need to enable any other settings or should we have a separate task queue created for this crons ?","closedAt":"2023-08-25T20:18:12Z","comments":[{"id":"IC_kwDOEujx185j727C","author":{"login":"Naik1994"},"authorAssociation":"NONE","body":"@mjameswh any update on this ?","createdAt":"2023-08-14T03:58:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1201#issuecomment-1676635842","viewerDidAuthor":false},{"id":"IC_kwDOEujx185kZJKv","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Hey! Sorry for the delay, I was at a company event for the week. By the way, for support questions, you should consider asking on either [our community forum](https://community.temporal.io/) or [our community Slack workspace](https://t.mp/slack).\r\n\r\nI'm afraid I can't entirely explain what's wrong in the two cases you describe, given the information you provide. Still, let's see what we can extract from there.\r\n\r\nIn the first sample, the `identity: \"1@7c97cc146289\"` field suggests that the workflow execution was terminated by a client, before a workflow task ever got scheduled (ie. since the termination `eventId` is 2). I would try to compare that `identity` with the one from `WorkflowExecutionStarted` event, as this might help figuring out what happened.\r\n\r\nIn the second sample, this `WorkflowTaskFailed` event is artificially introduced by the Temporal History server node, with the `ForceCloseCommand` code. This happens when a workflow somehow exceeds some operational limit, for example if there are too many buffered events for that workflow, or if buffered events exceeds the maximum gRPC message size. To help figure what's happening, examine that workflow's history events between the previous `WorkflowTaskStarted` event (ie. the last one before event id 2276) and up to the `WorkflowTaskScheduled` event at id 2276. Do you have thousands of events in-between? Or do you have a few events in large payloads?\r\n\r\nOne last thing... I suggest you get a look at [Schedules](https://docs.temporal.io/workflows#schedule), which are much more powerful and easier to work with compared to legacy cron workflows.","createdAt":"2023-08-18T18:50:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1201#issuecomment-1684312751","viewerDidAuthor":false},{"id":"IC_kwDOEujx185k9qFT","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@Naik1994 I'm closing this ticket, as there is nothing to do on our side.\r\n\r\nFeel free to continue the discussion if you still need help. You may also get help through our [Slack community](https://t.mp/slack) or our [community forum](https://community.temporal.io/).","createdAt":"2023-08-25T20:18:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1201#issuecomment-1693884755","viewerDidAuthor":false}],"createdAt":"2023-08-11T10:55:51Z","labels":[],"milestone":null,"number":1201,"reactionGroups":[],"state":"CLOSED","title":"Cron job getting scheduled after deployment and Terminated automatically after 1 minute or so  ","updatedAt":"2023-08-25T20:18:12Z","url":"https://github.com/temporalio/sdk-typescript/issues/1201"}
