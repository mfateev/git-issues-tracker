{"assignees":[{"id":"MDQ6VXNlcjI1MTI4OA==","login":"lorensr","name":"Loren ☺️","databaseId":0}],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ☺️"},"body":"### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\nCurrently, `throw {a : 'test'}` results in a failure with message `\"[object Object]\"`. It should be `{a: \"test\"} [A non-Error value was thrown from your code. We recommend throwing Error objects so that we can provide a stack trace.]`","closedAt":"2022-06-09T19:37:25Z","comments":[{"id":"IC_kwDOEujx185CsUHr","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Are you suggesting we call `util.inspect` on the value? I wouldn't want to use `JSON.stringify` for this.\r\nEven `util.inspect` might be overkill.","createdAt":"2022-05-05T18:25:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/635#issuecomment-1118913003","viewerDidAuthor":false},{"id":"IC_kwDOEujx185CsVoR","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Currently it's supposed to use `JSON.stringify`. Happy to switch to `util.inspect`\r\n\r\nhttps://github.com/temporalio/sdk-typescript/blob/main/packages/common/src/failure.ts#L346","createdAt":"2022-05-05T18:32:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/635#issuecomment-1118919185","viewerDidAuthor":false},{"id":"IC_kwDOEujx185CsmXm","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"It would work with the current workflow runtime but if we ever want to make a safer sandbox which allows running untrusted code we won't be able to use that.","createdAt":"2022-05-05T19:52:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/635#issuecomment-1118987750","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EFon6","author":{"login":"vkarpov15"},"authorAssociation":"CONTRIBUTOR","body":"I took a look - wasn't this fixed with #467 ? Given the below workflow:\r\n\r\n```ts\r\nexport async function example(name: string): Promise<string> {\r\n  throw { answer: 42 };\r\n  return await greet(name);\r\n}\r\n```\r\n\r\nI get the below in worker logs.\r\n\r\n```\r\n2022-05-31T16:00:50.567114Z  WARN temporal_sdk_core::worker: Failing workflow activation, run_id: \"9bc347c2-8ac1-40f7-ac4e-778822c4cef8\", failure: Failure { failure: Some(Failure { message: \"{\\\"answer\\\":42} [A non-Error value was thrown from your code. We recommend throwing Error objects so that we can provide a stack trace.]\", source: \"TypeScriptSDK\", stack_trace: \"\", cause: None, failure_info: None }) }\r\n```","createdAt":"2022-05-31T16:05:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/635#issuecomment-1142327802","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EFpbY","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Yes, thanks! ","createdAt":"2022-05-31T16:08:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/635#issuecomment-1142331096","viewerDidAuthor":false},{"id":"IC_kwDOEujx185EFsMy","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"TBH, we probably shouldn't be using JSON.stringify here (or util.inspect which isn't available in the workflow context).\r\nWe can maybe wrap the `JSON.stringify` call or it'll throw in some cases:\r\n\r\n```\r\n> JSON.stringify(1n)\r\nUncaught TypeError: Do not know how to serialize a BigInt\r\n    at JSON.stringify (<anonymous>)\r\n```","createdAt":"2022-05-31T16:18:59Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/635#issuecomment-1142342450","viewerDidAuthor":false}],"createdAt":"2022-05-05T18:20:57Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":6,"title":"1.0","description":"","dueOn":null},"number":635,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Fix message when objects are thrown","updatedAt":"2022-06-09T19:37:25Z","url":"https://github.com/temporalio/sdk-typescript/issues/635"}
