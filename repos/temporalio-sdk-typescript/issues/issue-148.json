{"assignees":[],"author":{"id":"MDQ6VXNlcjUyMzA0","is_bot":false,"login":"bergundy","name":"Roey Berman"},"body":"ATM the workflow query handler type is allowed to return a Promise which is problematic because query methods should not create commands (e.g timers / activities) or mutate state because they are not recorded in the workflow history and thus will break determinism.\r\nThe only reason a function would be async in the workflow isolate is to create a command.\r\n\r\n**Expected behavior**\r\nThe SDK should throw an `DeterminismViolationError` if a query handler returns a Promise.\r\nIdeally we could perform static type checking but this form of exclusion is not supported by typescript and the following does not work:\r\n\r\n```ts\r\nexport type WorkflowQueryType = (...args: any[]) => Exclude<any, Promise<any>>;\r\n```\r\n\r\nSee also:\r\nhttps://github.com/microsoft/TypeScript/pull/29317\r\n","closedAt":"2021-07-08T23:22:32Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDg3NjgwNTUyMg==","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Closed via #149 ","createdAt":"2021-07-08T23:22:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/148#issuecomment-876805522","viewerDidAuthor":false}],"createdAt":"2021-07-06T14:37:41Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":148,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Query handler should not be async","updatedAt":"2021-07-08T23:22:33Z","url":"https://github.com/temporalio/sdk-typescript/issues/148"}
