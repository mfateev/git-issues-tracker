{"assignees":[],"author":{"id":"MDQ6VXNlcjY0MTIxNjk=","is_bot":false,"login":"mjameswh","name":"James Watkins-Harvey"},"body":"### Describe the bug\r\n\r\nWebpack calls `log()` repeatedly, and include lot of ANSI-color escape sequences.\r\n\r\nThis is fine and nice when logs are going straight to console, but horrible and hard to understand when logs are captured into some external system (eg. GitHub Actions logs, Datadog, Cloud Watch, etc).\r\n\r\nWe should gather Webpack log output into a single, structured log entry.\r\n\r\n![image](https://github.com/temporalio/sdk-typescript/assets/6412169/1b527c44-44f1-4b43-88d2-ebc8dc2afad8)","closedAt":"2025-01-28T21:31:18Z","comments":[{"id":"IC_kwDOEujx185qBzKI","author":{"login":"alexjesp"},"authorAssociation":"NONE","body":"I've just got around this by doing using a custom bundle with a custom Webpack logger (Typescript):\r\n\r\n```js\r\nimport path from 'path';\r\nimport { bundleWorkflowCode } from '@temporalio/worker';\r\nimport c from 'ansi-styles';\r\n\r\n// ...other code\r\n\r\nconst someFunction = async () => {\r\n  const { workflowBundle, logEntries } = await collectLogs((logFn) => bundle('my-workflow', logFn));\r\n  const bundleLogs = logEntries.map(({ message }) => c.unstyle(message)).join('\\n');\r\n\r\n  console.debug(`Worker bundled: ${workflow.name}`, { bundleLogs }); // unstyled webpack logs in one log\r\n}\r\n\r\nconst bundle = async (\r\n  workflowName,\r\n  logFn: Logger,\r\n): Promise<WorkflowBundleWithSourceMap> => {\r\n  const workflowBundle = await bundleWorkflowCode({\r\n    workflowsPath: path.resolve(__dirname, '..', workflowName),\r\n    logger: logFn,\r\n  });\r\n  return workflowBundle;\r\n};\r\n\r\n// collects all logs emitted by fn\r\nconst collectLogs = async <T>(\r\n  fn: (logFn: Logger) => Promise<T>,\r\n): Promise<{ result: T; logEntries: LogEntry[] }> => {\r\n  const logEntries: LogEntry[] = [];\r\n\r\n  const logFn = new DefaultLogger(LOG_LEVEL, entry => logEntries.push(entry)); // custom webpack logger\r\n  const result = await fn(logFn);\r\n\r\n  return {\r\n    result,\r\n    logEntries,\r\n  };\r\n};\r\n```","createdAt":"2023-10-25T09:20:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1265#issuecomment-1778856584","viewerDidAuthor":false},{"id":"IC_kwDOEujx185qyXCH","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Thanks for sharing!","createdAt":"2023-11-02T21:50:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1265#issuecomment-1791586439","viewerDidAuthor":false},{"id":"IC_kwDOEujx186cK4Gq","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Resolved in #1414.","createdAt":"2025-01-28T21:31:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1265#issuecomment-2620096938","viewerDidAuthor":false}],"createdAt":"2023-10-18T21:49:46Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1265,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"[Bug] Webpack's output clog worker logs","updatedAt":"2025-01-28T21:31:20Z","url":"https://github.com/temporalio/sdk-typescript/issues/1265"}
