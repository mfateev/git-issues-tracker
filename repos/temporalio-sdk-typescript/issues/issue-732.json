{"assignees":[],"author":{"id":"MDQ6VXNlcjM5NjEwOTA=","is_bot":false,"login":"meg2208","name":"Matt Garbis"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nWas trying out the interceptors-opentelemetry sample and got it successfully pushing to datadog, which is great. The issue is that it doesn't send the activity input/outputs and I would like that to be send up to datadog for easier searching and analysis.\r\n\r\n### Describe the solution you'd like\r\n\r\nLooking at the opentelemetry sdk, `tracer.startActiveSpan` has an [another available signature](https://github.com/open-telemetry/opentelemetry-js-api/blob/6dd34e234eaa984f00a4c9339b16fddad7d7ea46/src/trace/tracer.ts#L91) where you can pass in a `SpanOptions` object and this has a field called `attributes` which lets you attach an arbitrary mapping of metadata to the span.\r\n\r\nI think the best thing to do is to update `InstrumentOptions` to have an additional optional field called `attributes` whose type can be `SpanAttributes` (matching the type in `SpanOptions.attributes`) and then pass that to `SpanOptions` as `{ attributes }`. When calling `instrument` you can build the attributes object from the input args plus other important identifying fields.\r\n\r\nI'm thinking this can be a global configuration (something like boolean `includeAttributes`) that come as an input to the interceptors.\r\n\r\nLooking forward to hearing your thoughts!\r\n","closedAt":"2022-06-29T23:40:41Z","comments":[{"id":"IC_kwDOEujx185FxeOC","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Instead you can add another interceptor to the chain after the otel interceptor and add the attributes you want to the current span:\r\n```ts\r\nconst span = otel.trace.getSpan(otel.context.active())\r\nspan?.setAttributes(attributes)\r\n```","createdAt":"2022-06-29T23:39:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1170596738","viewerDidAuthor":false},{"id":"IC_kwDOEujx185FxeXv","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I'm closing this issue, you can reopen if you think that there's a better solution ","createdAt":"2022-06-29T23:40:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1170597359","viewerDidAuthor":false},{"id":"IC_kwDOEujx185F1f20","author":{"login":"meg2208"},"authorAssociation":"NONE","body":"Thanks for the reply. I was able to get that to work. Thanks!","createdAt":"2022-06-30T20:36:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1171652020","viewerDidAuthor":false},{"id":"IC_kwDOEujx185F1sjh","author":{"login":"meg2208"},"authorAssociation":"NONE","body":"@bergundy Do you know which interceptor I can use to pull the activity and workflow outputs?","createdAt":"2022-06-30T21:39:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1171704033","viewerDidAuthor":false},{"id":"IC_kwDOEujx185F10bi","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"The output is the return value of `next()`. \r\n\r\nhttps://typescript.temporal.io/api/interfaces/workflow.workflowinboundcallsinterceptor/\r\n\r\nSo maybe something like this:\r\n\r\n```ts\r\nexport class MyInterceptor implements WorkflowInboundCallsInterceptor {\r\n  public async execute(\r\n    input: WorkflowExecuteInput,\r\n    next: Next<WorkflowInboundCallsInterceptor, 'execute'>\r\n  ): Promise<unknown> {\r\n    const span = otel.trace.getSpan(otel.context.active())\r\n    span?.setAttributes({ args: input.args })\r\n    \r\n    const result = await next(input)\r\n    span?.setAttributes({ result })\r\n    \r\n    return result\r\n  }\r\n}\r\n```\r\n\r\nIf you can post what you get working, that would help others! And I can make it into a sample.","createdAt":"2022-06-30T22:26:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1171736290","viewerDidAuthor":false},{"id":"IC_kwDOEujx185F4TdU","author":{"login":"meg2208"},"authorAssociation":"NONE","body":"Sounds good. I can post it. Do you prefer it as a branch, fork, or just post the full diff here? I made changes to 4 or so files.","createdAt":"2022-07-01T14:07:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1172387668","viewerDidAuthor":false},{"id":"IC_kwDOEujx185RcYe1","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"@meg2208 sorry for the delay—if you're still up for it, a PR to the [otel sample](https://github.com/temporalio/samples-typescript/tree/main/interceptors-opentelemetry) would be most helpful ☺️ Otherwise post just the relevant code, or the commit link if it's a public repo.","createdAt":"2022-12-28T06:07:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/732#issuecomment-1366394805","viewerDidAuthor":false}],"createdAt":"2022-06-29T05:25:57Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":732,"reactionGroups":[],"state":"CLOSED","title":"[Feature Request] Allow ability to track workflow/activity input with open telemetry spans","updatedAt":"2022-12-28T06:07:24Z","url":"https://github.com/temporalio/sdk-typescript/issues/732"}
