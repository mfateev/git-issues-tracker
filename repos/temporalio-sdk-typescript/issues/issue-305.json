{"assignees":[],"author":{"id":"MDQ6VXNlcjI1MTI4OA==","is_bot":false,"login":"lorensr","name":"Loren ☺️"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nWhen devs have an old version of their code in a worker (in the background or another shell they forgot about), they can face an issue where they `npm run workflow`, and sometimes the tasks are picked up by the up-to-date worker, and sometimes they're picked up by an old worker, and they don't realize the latter is happening, so they don't know why sometimes things aren't working.\r\n\r\n### Describe the solution you'd like\r\n\r\nWhile we could add this to the [troubleshooting page](https://docs.temporal.io/docs/node/troubleshooting), I think a better solution would be to warn users—when the worker starts in development, can it search for other worker processes on the current machine and log a warning with the PID(s)?\r\n\r\n```\r\n⚠️ Warning: There is another worker process running on this machine. \r\nIf it was started with an older version of your Worker and Activity code, \r\nwe recommend stopping it to ensure that only your current code is being run. \r\nYou can stop it by running this command in your shell:\r\nkill 1234\r\n```\r\n\r\n### Additional context\r\n\r\nWhile I've experienced this before, I didn't think about solving it for others until @schickling had the issue—thanks!\r\n","closedAt":"2023-01-10T17:18:56Z","comments":[{"id":"IC_kwDOEujx1844S54y","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@lorensr can you describe exactly how you think this will work?\r\nBy development do you mean that the worker connects to localhost or to check `NODE_ENV`?\r\n\r\n`tctl` has a feature to describe the task queue and list connected workers which we may be able to use (by calling the server API not invoking `tctl`)\r\n\r\n```shellsession\r\n$ tctl tq desc --tq test\r\n  WORKFLOW POLLER IDENTITY |   LAST ACCESS TIME\r\n  27354@macbearpig.lan     | 2021-10-15T17:37:02Z\r\n```\r\n\r\nMaybe this could be done by `nodemon` when running `start.watch`? It doesn't cover all of the cases though.","createdAt":"2021-10-15T17:40:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/305#issuecomment-944479794","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844TY2N","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"### How to determine if in development\r\n\r\n- `const inDevelopment = ![\"production\", \"staging\"].includes(process.env.NODE_ENV)`? Some users may not set `NODE_ENV` in prod, so this isn't completely accurate, but the inaccurate case—having extra irrelevant console output in prod—isn't that bad.\r\n- Is worker connecting to localhost? Possible to develop non-localhost. Don't know how common that is.\r\n\r\n### How to determine if other worker processes\r\n\r\nI was just imagining checking `ps` for any processes with matching commands to self. The tctl API seems better—if the check is being done inside `worker.run`, we'll know which task queue, and we know our own PID from `process.pid`.\r\n","createdAt":"2021-10-15T19:25:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/305#issuecomment-944606605","viewerDidAuthor":false},{"id":"IC_kwDOEujx185SHHI7","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"Should probably be resolved using worker versioning instead.","createdAt":"2023-01-10T17:18:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/305#issuecomment-1377595963","viewerDidAuthor":false},{"id":"IC_kwDOEujx185SPXOB","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"@Sushisource does versioning solve this development use case, or is it just for deployment?","createdAt":"2023-01-12T03:15:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/305#issuecomment-1379758977","viewerDidAuthor":false}],"createdAt":"2021-10-15T17:13:08Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDEz","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":305,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] Help users avoid old-worker-code bug","updatedAt":"2023-01-12T03:15:32Z","url":"https://github.com/temporalio/sdk-typescript/issues/305"}
