{"assignees":[],"author":{"id":"MDQ6VXNlcjg0Njc5NjU=","is_bot":false,"login":"alonp99","name":"Alon Peretz"},"body":"  The default maxCachedWorkflows formula uses maxHeapMemory (--max-old-space-size) to calculate\n  how many workflows to cache. However, workflow VM isolates allocate native memory outside\n  the V8 heap, not inside it.\n\n  This causes unexpected OOMs in containerized environments where:\n  1. --max-old-space-size is set high (e.g., 4.6GB) relative to container limit (5Gi)\n  2. Temporal calculates maxCachedWorkflows = ~2600\n  3. VM isolates consume ~2.6GB of NATIVE memory (not heap)\n  4. Total memory = heap + VM cache + overhead > container limit â†’ OOMKill\n\n  Suggested improvements:\n  1. Documentation: Warn that VM isolates use native memory, not heap memory\n  2. Default calculation: Consider using a more conservative default, or factor in\n     that VM cache is additive to heap usage\n  3. Logging: Log a warning if calculated maxCachedWorkflows * ~1MB + maxHeapMemory\n     exceeds available system memory\n\n  Environment: TypeScript SDK 1.11.7, Node.js 22, Kubernetes","closedAt":null,"comments":[],"createdAt":"2025-11-27T04:41:54Z","labels":[],"milestone":null,"number":1843,"reactionGroups":[],"state":"OPEN","title":"Default maxCachedWorkflows calculation doesn't account for VM isolate memory being outside V8 heap","updatedAt":"2025-11-27T04:41:54Z","url":"https://github.com/temporalio/sdk-typescript/issues/1843"}
