{"assignees":[],"author":{"id":"MDQ6VXNlcjYzNjM0MTk=","is_bot":false,"login":"leeweisberger","name":"Lee Weisberger"},"body":"There is currently a [bug](https://github.com/streamich/unionfs/issues/765) in the latest release of https://github.com/streamich/unionfs. The `@temporalio/worker` package does not pin this dependency (currently set to `\"unionfs\": \"^4.4.0\"`) so the package is unusable causing a company-wide outage for us. This same thing has happened on multiple occasions over the last few months.\r\n\r\nThis sdk is a core piece of infrastructure and should not suddenly break when indirect dependencies are updated. \r\n\r\nError code from offending package:\r\n```\r\nError: Cannot find module 'node_modules/unionfs/lib/index.js'. Please verify that the package.json has a valid \"main\" entry\r\n```\r\n","closedAt":"2023-06-06T10:53:03Z","comments":[{"id":"IC_kwDOEujx185d5G1K","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Looks like unionfs was fixed here:\r\nhttps://github.com/streamich/unionfs/commit/708def6c02f1a8795d2754ba814cdf1c433b174c\r\n\r\n@mjameswh let’s consider pinning the dependencies.","createdAt":"2023-06-03T23:07:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"CONFUSED","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-typescript/issues/1131#issuecomment-1575251274","viewerDidAuthor":false},{"id":"IC_kwDOEujx185eBvpw","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":">Looks like unionfs was fixed here:\r\n\r\nFor now, I updated the dependency to jump over the broken release of unionfs.\r\n\r\n>This sdk is a core piece of infrastructure and should not suddenly break when indirect dependencies are updated.\r\n\r\n>let’s consider pinning the dependencies.\r\n\r\nI suppose you mean pinning _all_ dependencies. That's an interesting idea, but I'm not sure how much we can really help on this without causing more damage than we're trying to avoid.\r\n\r\nWe would need to pin all dependencies of our packages to exact version, as even a patch release can introduce the kind of issue unionfs had. And we would only be able to fix our own direct dependencies, so even by pinning all of our direct dependencies, this kind of situation could still happen because of some transitive dependency (there is no \"universal way\" to pin _transitive_ dependencies in NPM/package.json world).\r\n\r\nI'll have to think about this more. Could be useful to have a look at what other projects have done to avoid similar issues... if any.","createdAt":"2023-06-05T21:44:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1131#issuecomment-1577515632","viewerDidAuthor":false},{"id":"IC_kwDOEujx185eDTX9","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I wonder what other packages do here.\r\nI too was thinking that transitive dependencies can’t be pinned. The only way around it is vendoring which I don’t think we want.\r\nWe try to minimize our dependencies to avoid situations like this but there’s only so much we can do while we rely on a bundler like webpack.","createdAt":"2023-06-06T05:18:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1131#issuecomment-1577924093","viewerDidAuthor":false},{"id":"IC_kwDOEujx185eFU5l","author":{"login":"leeweisberger"},"authorAssociation":"NONE","body":"Here's a good discussion: https://docs.renovatebot.com/dependency-pinning/#so-whats-best\r\n\r\nTIL the recommendation here is to not pin dependencies to avoid a false sense of security and forcing consumers to confirm multiple versions of the same package.\r\n\r\nThanks for considering, but I'll go ahead and close. ","createdAt":"2023-06-06T10:53:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1131#issuecomment-1578454629","viewerDidAuthor":false},{"id":"IC_kwDOEujx185eG_vI","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"@leeweisberger Thank you for the reference. The article is indeed very useful.\r\n\r\nAfter some more thinking, I indeed believe that there's nothing we can do on our side to completely avoid the issue you described, and trying to pins our dependencies would like cause more harm to our community.\r\n\r\nHowever, it would be possible for users who wants to protect against this kind of risk to themselves vendor out the Temporal SDK (and all of its dependencies, using _our_ package-lock.json file, installing deps in CI mode) to a local directory, and simply point their `@temporalio/*` dependencies to the packages in that local directory instead. This would ensure that the Temporal SDK itself only use dependencies against which tests have been run.\r\n\r\nIf anyone wants to experiment with that idea, I'll be glad to provide some more insights on how to get there.","createdAt":"2023-06-06T14:38:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1131#issuecomment-1578892232","viewerDidAuthor":false}],"createdAt":"2023-06-03T13:29:20Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1131,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Pin dependencies","updatedAt":"2023-06-06T14:38:42Z","url":"https://github.com/temporalio/sdk-typescript/issues/1131"}
