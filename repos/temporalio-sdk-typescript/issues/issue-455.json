{"assignees":[],"author":{"id":"MDQ6VXNlcjYzNTAzMDE=","is_bot":false,"login":"jbreiding","name":"Jeremy"},"body":"### What are you really trying to do?\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\nUse SNI with nodejs sdk that sends the correct grpc authority header.\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\nUnderstanding how the go-sdk allows for SNI to be configured for clients and following the similar documentation:\r\n\r\nnodejs\r\nhttps://nodejs.temporal.io/api/interfaces/common.tlsconfig/#servernameoverride\r\n\r\ngo\r\nhttps://pkg.go.dev/go.temporal.io/sdk@v1.12.0/internal#ConnectionOptions\r\n\r\nthe go sdk correctly sets SNI and for grpc this means the authority header.\r\n\r\nnodejs does not update the authority header when setting the serverNameOverride.\r\nThis is visible from grpc verbose logging.\r\n\r\n### Minimal Reproduction\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n@bergundy has helped with reproducing and also identified a configuration that does work correctly.\r\n\r\n```\r\n  const connection = new Connection({\r\n    address,\r\n    tls: {\r\n      clientCertPair: {\r\n        crt: fs.readFileSync(clientCertPath),\r\n        key: fs.readFileSync(clientKeyPath),\r\n      },\r\n    },\r\n    channelArgs: { 'grpc.default_authority': serverNameOverride },\r\n  });\r\n  await connection.untilReady();\r\n```\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]\r\n- Temporal Version: [e.g. 1.14.0?] and/or SDK version\r\n- Are you using Docker or Kubernetes or building Temporal from source?\r\n\r\nnodejs client connecting to temporal-cloud hosted namespace.\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\nBringing this issue to attention to try and bring configuration consistent across sdk languages if possible.","closedAt":"2022-03-12T17:19:46Z","comments":[{"id":"IC_kwDOEujx1849BEyu","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Apparently Rust Core needs extra parameters to add the authority header.\r\nThis functionality isn't exposed to TS.","createdAt":"2022-01-27T22:17:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/455#issuecomment-1023691950","viewerDidAuthor":false}],"createdAt":"2022-01-27T21:29:16Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":455,"reactionGroups":[],"state":"CLOSED","title":"[Bug] serverNameOverride in tlsConfig does not have expected effect on grpc request","updatedAt":"2022-03-12T17:19:46Z","url":"https://github.com/temporalio/sdk-typescript/issues/455"}
