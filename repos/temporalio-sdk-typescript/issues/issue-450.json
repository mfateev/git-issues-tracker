{"assignees":[],"author":{"id":"MDQ6VXNlcjE3NjA3MDU=","is_bot":false,"login":"yoDon","name":"Don Alvarez"},"body":"### What are you really trying to do?\r\n\r\nRenaming a project folder on Windows causes `npm run dev` to succeed or fail in the temporal worker launcher depending on whether the first letter of the directory name is an `n`. This issue prevents the nextjs-ecommerce-oneclick sample from running on Windows, but if you rename the folder to (for example) ecommerce-nextjs-oneclick the sample runs correctly under Windows.\r\n\r\n### Describe the bug\r\n\r\nWhen a project directory starts with an n, (like nextjs-ecommerce-oneclick in the samples-typescript repo), the code in [start:worker] on Windows incorrectly constructs the absolute path to workflows.js leaving out the slash between the project directory (nextjs-ecommerce-oneclick) and the parent of the project directory (samples-typescript) because it's treating the \\ windows directory separator character and the n at the start of the project directory name as an offending \\n to be stripped out (both the \\ and the n are stripped from the constructed path).\r\n\r\n### Minimal Reproduction\r\n\r\nYou can see this issue for example on a fresh clone of the samples-typescript repo when trying to run the nextjs-ecommerce-oneclick sample on Win11 running under Windows rather than under WSL. Renaming the nextjs-ecommerce-oneclick folder to ecommerce-nextjs-oneclick works around the issue and allows `npm run dev` to run without issue.\r\n\r\nThe error message is of the form:\r\n```\r\n[start:worker] 2022-01-24T00:52:35.620Z [ERROR] ERROR in ../../../../src/main.js\r\n[start:worker] 2022-01-24T00:52:35.620Z [ERROR] Module not found: Error: Can't resolve 'C:\\Path1\\Path2\\samples-typescriptextjs-ecommerce-oneclick\\temporal\\lib\\workflows.js' in '/src'\r\n```\r\n\r\nIf you look at the mangled path in the error message, you'll see something has incorrectly stripped the two characters `\\n` from the desired `samples-typescript\\nextjs-ecommerce-oneclick` leaving the malformed `samplestypescriptextjs-ecommerce-oneclick`.\r\n\r\n### Environment/Versions\r\n\r\nI'm seeing this issue under Windows 11 but I suspect it impacts all versions of Windows. WSL does not exhibit this issue because it does not use `\\` as a path separator.\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n","closedAt":"2022-04-28T21:32:53Z","comments":[{"id":"IC_kwDOEujx18481lfP","author":{"login":"yoDon"},"authorAssociation":"CONTRIBUTOR","body":"As an additional, possibly related path-mangling issue, when I try to run under Windows a WIP sample from @lorensr at https://github.com/lorensr/next.js in the branch update-temporal and folder examples/with-temporal, I see an error message that looks like something is prepending a `/` in front of a path that starts with `C:`, resulting in an invalid `/C:` drive specifier.\r\n\r\nFor that repo, you need to `npm i` and then launch three terminals running\r\n\r\n- `npm run dev`\r\n- `npm run build:worker.watch` (there's a typo in the project readme, this is the correct command)\r\n- `npm run start:worker` (again there's a typo in the project readme, the readme suggests `-`'s where there should be `:`'s)\r\n\r\nThe error message with the problematic path in the first line is:\r\n```\r\nError: ENOENT: no such file or directory, stat '/C:/path1/path2/lorensr-nextjs/next.js/examples/with-temporal/temporal/src/workflows.ts'\r\n    at Object.statSync (node:fs:1536:3)\r\n    at resolveNodeModulesPaths (C:\\path1\\path2\\lorensr-nextjs\\next.js\\examples\\with-temporal\\node_modules\\@temporalio\\worker\\src\\worker-options.ts:269:27)\r\n    at addDefaultWorkerOptions (C:\\path1\\path2\\lorensr-nextjs\\next.js\\examples\\with-temporal\\node_modules\\@temporalio\\worker\\src\\worker-options.ts:295:32)\r\n    at Function.create (C:\\path1\\path2\\lorensr-nextjs\\next.js\\examples\\with-temporal\\node_modules\\@temporalio\\worker\\src\\worker.ts:187:73)\r\n    at file:///C:/path1/path2/lorensr-nextjs/next.js/examples/with-temporal/temporal/src/worker.ts:12:29\r\n```","createdAt":"2022-01-25T00:16:41Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/450#issuecomment-1020680143","viewerDidAuthor":false},{"id":"IC_kwDOEujx185CP9BV","author":{"login":"mjameswh"},"authorAssociation":"MEMBER","body":"This is an issue in [dedent](https://github.com/dmnd/dedent/issues/34). And according to [dedent's code](https://github.com/dmnd/dedent/blob/77673fef42c0374e744df868ba1b2829a5aa4781/dedent.js#L45-L49), the author sees this as a feature, not a bug.\r\n\r\nI think the correct solution would be to replace `dedent` by some alternative (eg. [ts-dedent](https://www.npmjs.com/package/ts-dedent)).","createdAt":"2022-04-27T20:59:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/450#issuecomment-1111478357","viewerDidAuthor":false}],"createdAt":"2022-01-24T20:48:34Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":450,"reactionGroups":[],"state":"CLOSED","title":"[Bug] workflows wont launch on Windows if project folder starts with 'n'","updatedAt":"2022-04-28T21:32:53Z","url":"https://github.com/temporalio/sdk-typescript/issues/450"}
