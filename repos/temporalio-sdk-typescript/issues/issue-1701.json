{"assignees":[],"author":{"id":"MDQ6VXNlcjQ0MTE1NzUy","is_bot":false,"login":"harukitosa","name":"Haruki Tosa"},"body":"### What are you really trying to do?\n\nI am trying to connect a Temporal Worker (using the TypeScript SDK) running in my local environment to a namespace on Temporal Cloud using **only** API key authentication. My understanding, based on the documentation, is that only an API key should be required for authentication credentials on the client-side.\n\n### Describe the bug\n\nWhen attempting to connect to Temporal Cloud (which requires TLS) using `NativeConnection` from `@temporalio/worker`, the connection fails with the following `TransportError: tonic::transport::Error(Transport, NativeCertsNotFound)`:\n\n```\nConnecting to Temporal server... TransportError: tonic::transport::Error(Transport, NativeCertsNotFound)     at NativeConnection.connect (/usr/src/app/systems/journey/node_modules/@temporalio/worker/lib/connection.js:58:23)     at async run (/usr/src/app/systems/journey/packages/jobworker/lib/worker.js:44:24)\n```\n\nThis error occurs during the **TLS handshake phase**, before the API key is likely used for authentication. Specifically, it indicates that the root CA certificates required to validate the Temporal Cloud server's TLS certificate cannot be found by the Worker's execution environment.\n\nIn contrast, using `Connection` from `@temporalio/client` with the same connection details (endpoint, namespace, API key) successfully connects to Temporal Cloud. This suggests that `Connection` is able to properly utilize the system's certificate store.\n\n```typescript\nimport { NativeConnection } from '@temporalio/worker';\n// NativeConnection fails during TLS handshake with NativeCertsNotFound\n\nimport { Connection } from '@temporalio/client';\n// Connection succeeds with both TLS connection and API key authentication\n```\n\nThe connection configuration is based on the Temporal Cloud documentation regarding API keys:\n[https://docs.temporal.io/cloud/api-keys#typescript-sdk-v-1100](https://docs.temporal.io/cloud/api-keys#typescript-sdk-v-1100)\n\n### Minimal Reproduction\n\n(The following code should reproduce the issue)\n\n1.  Create a simple Worker project using the Temporal TypeScript SDK (`@temporalio/worker` v1.11.6).\n2.  Configure the `NativeConnection` options with your Temporal Cloud details (namespace.tmprl.cloud:7233), namespace, and a generated API key. Include `tls: true` or `tls: {}` in the options.\n    ```typescript\n        console.log('Connecting to Temporal server...');\n        const connection = await NativeConnection.connect({\n          address: process.env.TEMPORAL_ADDRESS || 'localhost:7233',\n          tls: true,\n          // TLS and gRPC metadata configuration goes here.\n          apiKey: \"xxx\",\n          metadata: {\n            'temporal-namespace': \"xxx\",\n          },\n        });\n        console.log('Connected to Temporal server');\n    ```\n3.  Run this Worker in an environment where root certificates might not be readily accessible\n\n### Environment/Versions\n\n-   **OS and processor:** [Please fill in, e.g., M1 Mac, x86 Windows, Linux (Distro/Version)]\n-   **Temporal SDK Version:**\n    -   `@temporalio/activity`: `^1.11.6`\n    -   `@temporalio/client`: `^1.11.6`\n    -   `@temporalio/worker`: `^1.11.6`\n    -   `@temporalio/workflow`: `^1.11.6`\n-   **Are you using Docker or Kubernetes or building Temporal from source?** [Please fill in: Docker / Kubernetes / Source / Other, and provide details like Docker image name/version if applicable]\n\n### Additional context\n\n-   Connecting to Temporal Cloud requires TLS. While the API key is used for *authentication*, a secure TLS connection must be established first, which involves validating the server's certificate.\n-   The `NativeCertsNotFound` error indicates a problem during this TLS connection setup phase (failure to find root CA certificates), not an issue with the API key authentication itself.\n-   Since `Connection` from `@temporalio/client` works successfully, it suggests that the API key, network path, and basic TLS configuration (`tls: true`) are likely correct.\n-   The problem is likely specific to how `NativeConnection` interacts with the TLS certificate store in the environment where it's running.\n","closedAt":"2025-04-30T05:57:45Z","comments":[{"id":"IC_kwDOEujx186pVHgA","author":{"login":"harukitosa"},"authorAssociation":"NONE","body":"üôèhttps://github.com/temporalio/sdk-typescript/issues/1584","createdAt":"2025-04-30T05:56:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/1701#issuecomment-2840885248","viewerDidAuthor":false}],"createdAt":"2025-04-30T04:03:03Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1701,"reactionGroups":[],"state":"CLOSED","title":"[Bug] @temporalio/worker: NativeConnection fails with NativeCertsNotFound on Temporal Cloud connection using API Key","updatedAt":"2025-04-30T05:57:45Z","url":"https://github.com/temporalio/sdk-typescript/issues/1701"}
