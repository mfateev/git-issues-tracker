{"assignees":[{"id":"MDQ6VXNlcjI1MTI4OA==","login":"lorensr","name":"Loren ☺️","databaseId":0}],"author":{"id":"MDQ6VXNlcjY3NjQ5NTc=","is_bot":false,"login":"swyxio","name":"swyx.io"},"body":"### Describe the bug\r\n\r\nhttps://temporalio.slack.com/archives/C01DKSMU94L/p1634944174028300\r\n\r\n### To Reproduce\r\n\r\ni could reproduce (on both node 14 and 16) with\r\n\r\n```\r\n npx @temporalio/create@latest moop\r\n✔ Which sample would you like to use? › hello-world\r\nCreating a new Temporal project in /Users/swyx/Temporal/testnodesdk/moop/\r\n\r\n✔ Directory /Users/swyx/Temporal/testnodesdk/moop/ already exists. Would you like to replace it? … yes\r\nDownloading files for sample hello-world. This might take a moment.\r\n\r\nInstalling packages. This might take a couple of minutes.\r\n\r\nnpm ERR! code ENOENT\r\nnpm ERR! syscall open\r\nnpm ERR! path /Users/swyx/package.json\r\nnpm ERR! errno -2\r\nnpm ERR! enoent ENOENT: no such file or directory, open '/Users/swyx/package.json'\r\nnpm ERR! enoent This is related to npm not being able to find a file.\r\nnpm ERR! enoent \r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /Users/swyx/.npm/_logs/2021-10-24T10_08_05_549Z-debug.log\r\n\r\nAborting installation.\r\n  npm has failed.\r\n```\r\n\r\nnotice that my error shows a different root than Ramazan's:\r\n\r\n```\r\nramazanozer@Ramazans-MBP-39 alphademov2 % npx @temporalio/create@latest\r\n✔ What is your project named? … my-temporal\r\n✔ Which sample would you like to use? › hello-world\r\nCreating a new Temporal project in /Users/ramazanozer/IdeaProjects/alphademov2/my-temporal/\r\n\r\nDownloading files for sample hello-world. This might take a moment.\r\n\r\nInstalling packages. This might take a couple of minutes.\r\n\r\n\r\nAborting installation.\r\nUnexpected error. Please report it as a bug:\r\nError: ENOENT: no such file or directory, open '/Users/ramazanozer/IdeaProjects/alphademov2/my-temporal/package.json'\r\n    at Object.openSync (fs.js:497:3)\r\n    at readFileSync (fs.js:393:35)\r\n    at updateNodeVersion (/Users/ramazanozer/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/helpers/install.js:32:52)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at async createApp (/Users/ramazanozer/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/create-project.js:141:5)\r\n    at async start (/Users/ramazanozer/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/index.js:126:5) {\r\n  errno: -2,\r\n  syscall: 'open',\r\n  code: 'ENOENT',\r\n  path: '/Users/ramazanozer/IdeaProjects/alphademov2/my-temporal/package.json'\r\n}\r\n```\r\n\r\n\r\n### Context\r\n\r\ni think https://github.com/temporalio/sdk-typescript/blob/4f4e3f6fc03abe928fae1f3f2459b2b256ed3017/packages/create-project/src/helpers/install.ts#L44 needs better error handling - readFileSync is just too error prone.\r\n\r\nbut the root cause is not the file read, it is the lack of package.json in the cloned folder.","closedAt":"2021-11-02T01:24:50Z","comments":[{"id":"IC_kwDOEujx1844pGVY","author":{"login":"swyxio"},"authorAssociation":"CONTRIBUTOR","body":"cc @lorensr \r\n","createdAt":"2021-10-24T10:20:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-950297944","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844r3uE","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"I think this is due to the lack of a samples-node repo on GitHub. The code has been updated to download from `samples-typescript`, but the `create` package hasn't been published.","createdAt":"2021-10-25T15:08:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-951024516","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844r4WE","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@lorensr `samples-node` redirects to `samples-typescript` at least on web.\r\nI'll publish soon.\r\n\r\nThe error that @sw-yx posted doesn't seem to be related though:\r\n```\r\nnpm ERR! enoent ENOENT: no such file or directory, open '/Users/swyx/package.json'\r\n```\r\nCan you please look into it?","createdAt":"2021-10-25T15:10:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-951027076","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844r6ir","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"I did—I was able to repro by changing back to `samples-node`, although I think it was the extract step, not the download step:\r\n\r\n![image](https://user-images.githubusercontent.com/251288/138723057-f223f4c9-e5b0-401a-bc9a-01e2388a6494.png)\r\n\r\nResults in an empty project dir, and when you run `cli.js` from outside `sdk-typescript`, this is the error you get when the script `npm install`s inside the empty project dir:\r\n\r\n![image](https://user-images.githubusercontent.com/251288/138723292-d926e02d-30de-4ecf-bcd7-b924b7f7828b.png)\r\n","createdAt":"2021-10-25T15:19:26Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-951036075","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844sAQS","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"Does the tar step not throw an error?\r\nLooks like the error should be thrown somewhere else to detect that an invalid sample url was provided, this could happen in cases where user uses a full url instead of just sample name","createdAt":"2021-10-25T15:45:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-951059474","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844skJL","author":{"login":"matang-dave"},"authorAssociation":"NONE","body":"Facing the same issue.","createdAt":"2021-10-25T18:46:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-951206475","viewerDidAuthor":false},{"id":"IC_kwDOEujx1844tC4j","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"I'm preparing to release a new version by the end of the day.","createdAt":"2021-10-25T21:08:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-951332387","viewerDidAuthor":false},{"id":"IC_kwDOEujx18447dXo","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"@lorensr could you please make the script fail more gracefully in the case of sample not found?","createdAt":"2021-10-30T00:18:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-955110888","viewerDidAuthor":false},{"id":"IC_kwDOEujx18447eEO","author":{"login":"lorensr"},"authorAssociation":"CONTRIBUTOR","body":"Here's what we print when the provided repo doesn't have a `package.json`:\r\n\r\n```\r\n$ npx @temporalio/create@latest t2 -s https://github.com/lorensr/food-delivery/tree/main/components\r\nError: Could not locate a package.json at \"https://api.github.com/repos/lorensr/food-delivery/contents/components/package.json?ref=main\".\r\nPlease check that the repository is a Temporal TypeScript SDK template and try again.\r\n```\r\n\r\nI can add a check that covers when the provided repo has changed names/orgs.\r\n\r\nHere's what we print when a chosen sample doesn't have a `package.json`:\r\n\r\n![image](https://user-images.githubusercontent.com/251288/139513619-6fa78b83-a48c-47e1-a7fd-085e5df9a807.png)\r\n\r\nI'll also have it print a list of samples and link to samples-typescript.\r\n","createdAt":"2021-10-30T00:33:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-typescript/issues/333#issuecomment-955113742","viewerDidAuthor":false}],"createdAt":"2021-10-24T10:19:49Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":333,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] Package initializer does not work for some users","updatedAt":"2021-11-02T01:24:50Z","url":"https://github.com/temporalio/sdk-typescript/issues/333"}
