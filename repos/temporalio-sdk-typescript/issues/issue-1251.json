{"assignees":[],"author":{"id":"MDQ6VXNlcjU0NTIyOTg=","is_bot":false,"login":"divmgl","name":"Dexter Miguel"},"body":"### What are you really trying to do?\r\n\r\nI'm trying to run a workflow bundle built by ESBuild with CommonJS format.\r\n\r\n### Describe the bug\r\n\r\nWhen I run the Temporal worker, I get this:\r\n```\r\n2023-09-21T23:40:48.516Z [ERROR] Failed to activate workflow {\r\n  runId: 'cb5e8916-3094-4c75-bccc-cf6c174baf9e',\r\n  error: /Users/dimgl/dev/sandbox/packages/temporal/dist/workflows.js:15482\r\n  module.exports = __toCommonJS(entrypoint_exports);\r\n  ^\r\n\r\n  ReferenceError: module is not defined\r\n      at ../src/entrypoint.ts:1:0\r\n      at Script.runInContext (node:vm:141:12)\r\n      at VMWorkflowCreator.getContext (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/vm.js:64:21)\r\n      at VMWorkflowCreator.createWorkflow (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/vm.js:33:36)\r\n      at handleRequest (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:35)\r\n      at MessagePort.<anonymous> (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:38)\r\n      at [nodejs.internal.kHybridDispatch] (node:internal/event_target:737:20)\r\n      at exports.emitMessage (node:internal/per_context/messageport:23:28),\r\n  workflowExists: false\r\n}\r\n```\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n### Minimal Reproduction\r\n```tsx\r\n// dist/workflows.js\r\nvar workflows_exports = {};\r\n__export(workflows_exports, {\r\n  sendEmailWorkflow: () => sendEmailWorkflow\r\n});\r\nmodule.exports = __toCommonJS(workflows_exports);\r\nvar import_workflow2 = require(\"@temporalio/workflow\");\r\n```\r\n\r\nAnd is generated by:\r\n```tsx\r\n// esbuild.mjs\r\nawait esbuild.build({\r\n  entryPoints: [\"src/entrypoint.ts\"],\r\n  bundle: true,\r\n  outfile: \"dist/workflows.js\",\r\n  platform: \"node\",\r\n  packages: \"external\",\r\n  sourcemap: \"inline\",\r\n})\r\n```\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: macOS M1\r\n- Temporal Version: 1.8\r\n- Are you using Docker or Kubernetes or building Temporal from source? Temporalite.\r\n### Additional context\r\n\r\nWe haven't fully made the switch yet to ESM, but we're using all of the ESM syntax. We're currently building to CommonJS to avoid the ESM pain. Is there a way to get this working inside of the Temporal TypeScript SDK?\r\n\r\nWebpack is a non-starter for us due to the performance, and we can't make the switch to Temporal if it means fiddling with Webpack configuration to make our workflows work with our monorepo.","closedAt":"2023-09-22T02:20:11Z","comments":[],"createdAt":"2023-09-21T23:40:36Z","labels":[{"id":"MDU6TGFiZWwyNTQ1Mzg0MDA2","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":1251,"reactionGroups":[],"state":"CLOSED","title":"[Bug] module is not defined","updatedAt":"2023-09-26T16:46:58Z","url":"https://github.com/temporalio/sdk-typescript/issues/1251"}
