# temporalio/sdk-typescript - Complete Issue Dump

**Generated:** 2026-01-09
**Total Issues:** 797
**Total Upvotes:** 372
**Total Comments:** 1724

## Table of Contents

- [Summary](#summary)
- [Top Labels](#top-labels)
- [Issue Index](#issue-index)
- [All Issues](#all-issues)

## Summary

| Metric | Value |
|--------|-------|
| Open Issues | 797 |
| Issues with Upvotes | 134 (17%) |
| Total Upvotes | 372 |
| Total Comments | 1724 |

## Top Labels

| Label | Count |
|-------|-------|
| enhancement | 357 |
| bug | 285 |
| Mend: dependency security vulnerability | 51 |
| good first issue | 24 |
| documentation | 9 |
| security vulnerability | 4 |
| next-gen | 3 |
| ecosystem-and-integrations | 2 |
| duplicate | 2 |
| visibility | 1 |

## Issue Index

| # | üëç | üí¨ | Title |
|---|-----|-----|-------|
| [#1334](#1334) | 46 | 46 | [Feature Request] Run temporal worker in bun |
| [#1755](#1755) | 20 | 8 | [Feature Request] Temporal integration for `@openai/agents` |
| [#483](#483) | 4 | 37 | [Feature Request] NestJS Transport / Integration? |
| [#928](#928) | 7 | 26 | [Bug] Jest detects open handles |
| [#1658](#1658) | 19 | 1 | [Feature Request] Add support for opentelemetry v2 |
| [#1773](#1773) | 11 | 11 | [Bug] error: TypeError: (0 , ms_1.default) is not a function |
| [#421](#421) | 6 | 18 | [Feature Request] pnpm support |
| [#537](#537) | 10 | 7 | [Feature Request] Allow webpack configuration |
| [#1229](#1229) | 13 | 0 | [Feature Request] Add support for custom metrics |
| [#207](#207) | 9 | 7 | [Feature Request] Enable in-browser usage of gRPC client |
| [#1750](#1750) | 7 | 10 | [Bug] Workflow logs not propagated unless telemetryOptions.logging.filter is DEBUG or TRACE |
| [#279](#279) | 2 | 19 | [Feature Request] Plan for supporting npm modules that require ESM, eg node-fetch |
| [#443](#443) | 4 | 13 | [Feature Request] Improve default data converter |
| [#1615](#1615) | 3 | 14 | [Bug] Cannot use Temporal with NextJS 15 because workflowTypes come from function names |
| [#310](#310) | 7 | 6 | [Feature Request] Support separating bundling and executing of workers |
| [#1271](#1271) | 8 | 3 | [Feature Request] Add minimal support to link core-bridge against musl |
| [#139](#139) | 1 | 17 | [Bug] EvalError: Code generation from strings disallowed for this context |
| [#496](#496) | 0 | 18 | [Bug] Fix flakey tests |
| [#1355](#1355) | 0 | 17 | [Bug] `reuseV8Context` breaks workflow isolation |
| [#770](#770) | 2 | 11 | [Bug] Timeout on last runReplayHistory |
| [#1499](#1499) | 7 | 0 | [Feature Request] Native Request Batching to Prevent "received message larger than max" Errors |
| [#1069](#1069) | 2 | 10 | [Feature Request] Support countWorkflowExecutions |
| [#933](#933) | 6 | 2 | [Feature Request] Create a separate "core" library for workflows that does not include bundler deps. |
| [#852](#852) | 1 | 12 | Unable to get @temporalio/nyc-test-coverage working in jest |
| [#181](#181) | 0 | 14 | [strawman] React-like API proposal |
| [#1731](#1731) | 3 | 7 | [Bug] Unable to run tests |
| [#1443](#1443) | 6 | 1 | [Bug] Failure to start ephemeral server prevents shutdown of the process |
| [#357](#357) | 2 | 9 | [Feature Request] Expose history size to Workflow code |
| [#226](#226) | 2 | 9 | [Feature Request] Test support |
| [#1866](#1866) | 2 | 8 | [Bug] Signal caused `condition` to fail with `CancelledFailure` on `1.14.0` |
| [#1749](#1749) | 4 | 4 | [Bug] Workflow task not found after SDK upgrade |
| [#1233](#1233) | 0 | 12 | [Bug] `nyc-test-coverage` is excessively difficult to use correctly |
| [#1160](#1160) | 6 | 0 | [Typescript] Workflow update support |
| [#755](#755) | 0 | 12 | [Bug] with yarn pnp, there are issues running workflow tests |
| [#327](#327) | 1 | 10 | [Feature Request] Add statsd support to Typescript SDK |
| [#312](#312) | 3 | 6 | Expose health check on WorkflowClient |
| [#258](#258) | 1 | 10 | [Feature Request] Support single-file workflowsPath |
| [#1681](#1681) | 2 | 7 | [Bug] TLS server name override not respected |
| [#1432](#1432) | 5 | 1 | [Feature Request] Simplify proper usage of `AsyncLocalStorage` in Workflow context |
| [#1280](#1280) | 3 | 5 | Bundle using Vite |
| [#1033](#1033) | 2 | 7 | [Bug] Silent crashes when awaiting promises returned from `Client` (using `hello-world` sample) |
| [#868](#868) | 0 | 11 | [Feature Request] Add lint rule that prevents Query handlers from mutating state |
| [#573](#573) | 0 | 11 | temporal-client-0.1.0: 3 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#333](#333) | 1 | 9 | [Bug] Package initializer does not work for some users |
| [#136](#136) | 1 | 9 | [Feature Request] Organize samples in repo |
| [#1036](#1036) | 0 | 10 | How to add module to disallowedModules? |
| [#939](#939) | 1 | 8 | [Bug] Worker crashes with "async hook stack has become corrupted" on Workflow Task timeout |
| [#516](#516) | 0 | 10 | [Bug] bundleWorkflowCode fails on "heavyweight" dependencies |
| [#254](#254) | 3 | 4 | [Feature Request] Better crash message than [TransportError: transport error] when docker-compose not running |
| [#1790](#1790) | 0 | 9 | [Bug] Replay workflow history fails with nondeterminism error, child workflow ids do not match |
| [#1352](#1352) | 2 | 5 | [Feature Request] Support Pino as a logging framework with Runtime.install |
| [#1172](#1172) | 4 | 1 | [Feature Request] Sentry integration |
| [#1149](#1149) | 0 | 9 | [Support] How to cache data between different interceptors |
| [#1013](#1013) | 0 | 9 | [Bug] ScheduleClient.list() fails to return any schedules |
| [#849](#849) | 1 | 7 | [Feature Request] Get workflow info / activity context in PayloadCodec |
| [#754](#754) | 1 | 7 | [Feature Request] Add friendly version of listWorkflowExecutions |
| [#727](#727) | 0 | 9 | [Bug] Deprecate `temporalio` meta package |
| [#481](#481) | 1 | 7 | Tracking: spec-compliant JSON in protobuf.js |
| [#127](#127) | 0 | 9 | [Bug] No message returned when running hello world sample app |
| [#78](#78) | 0 | 9 | [Bug] Path aliases easily confused with package scopes |
| [#1724](#1724) | 0 | 8 | [Bug] TypeError: Failed to initialize workflow of type 'sayHello': no such function is exported by the workflow bundle |
| [#1621](#1621) | 4 | 0 | [Feature Request] Include musl-based shared library in package |
| [#1587](#1587) | 1 | 6 | [Bug] Using async functions degrades performance |
| [#1557](#1557) | 0 | 8 | [Feature Request] allow opt-out of workflow isolation |
| [#1362](#1362) | 2 | 4 | [Feature Request] Worker.runReplayHistory() should accept a serialized History object fetched using fetchHistory() |
| [#1302](#1302) | 4 | 0 | [Bug] Node discards promises created by calling into Core Bridge with callback |
| [#1292](#1292) | 1 | 6 | [Bug] ESM Custom payload converters cannot be loaded |
| [#1021](#1021) | 0 | 8 | [Feature Request] async generator for cancellationScope |
| [#756](#756) | 1 | 6 | [Bug] Support patched API inside condition. |
| [#456](#456) | 2 | 4 | [Feature Request] Add SAGA helpers? |
| [#274](#274) | 0 | 8 | [Feature Request] Signal total ordering |
| [#219](#219) | 0 | 8 | [Feature Request] Opentracing Support |
| [#1582](#1582) | 0 | 7 | [Bug] 1.11.2 workflow histories failing to replay on 1.11.5 |
| [#1423](#1423) | 0 | 7 | [Bug] Unexpected behaviour related to CancellationScope.nonCancellable |
| [#1396](#1396) | 1 | 5 | [Feature Request] Better error details on why ephemeral test server didn't start |
| [#1353](#1353) | 1 | 5 | [Bug] some metrics are not prefixed with "temporal_" |
| [#1325](#1325) | 2 | 3 | [Bug] Throwing an exception from a workflow may result in `Failed to activate workflow` due to `DataCloneError` |
| [#1265](#1265) | 2 | 3 | [Bug] Webpack's output clog worker logs |
| [#1124](#1124) | 3 | 1 | [Feature Request] Add `upsertMemo` command |
| [#1081](#1081) | 1 | 5 | [Proposal] Built-in registered handlers query |
| [#1008](#1008) | 2 | 3 | [Feature Request] Provide more output when webpack fails |
| [#948](#948) | 2 | 3 | [Bug] Error is blank in `Failed to activate workflow` messages |
| [#869](#869) | 0 | 7 | temporal-sdk-core-0.1.0: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#834](#834) | 0 | 7 | [Bug] test-npm-init rate limited in CI  |
| [#732](#732) | 0 | 7 | [Feature Request] Allow ability to track workflow/activity input with open telemetry spans |
| [#665](#665) | 0 | 7 | [Feature Request] Allow for easy mocking  |
| [#614](#614) | 1 | 5 | [Bug] `ShutdownError: Core is shut down` error when running in jest  |
| [#485](#485) | 2 | 3 | [Feature Request] Add workflow.getLastCompletionResult |
| [#234](#234) | 0 | 7 | [Bug] Load tests fail due to timeouts on buildkite |
| [#204](#204) | 0 | 7 | [Bug] Set the correct worker binary ID |
| [#202](#202) | 0 | 7 | [Feature Request] Go over WF activation logic |
| [#1437](#1437) | 1 | 4 | [Bug] NestJS integration, app/worker hot reloading error |
| [#1406](#1406) | 0 | 6 | [Bug]Could not resolve "__temporal_custom_payload_converter" |
| [#1351](#1351) | 2 | 2 | [Feature Request] Support updating schedule by cronExpression |
| [#1348](#1348) | 3 | 0 | [Feature Request] Eager Workflow Start |
| [#1317](#1317) | 2 | 2 | [Feature Request] Expose `updateId` to Update handlers |
| [#1192](#1192) | 0 | 6 | [Bug] @temporalio/worker-1.7.4: Memory occupied by worker not getting released on AWS ECS (OS: Linux) |
| [#1135](#1135) | 0 | 6 | [Support] How to implement a real Authorization workflow inbound interceptor |
| [#1062](#1062) | 0 | 6 | listWorkflowExecutions accept only 1 query params. |
| [#1039](#1039) | 2 | 2 | [Bug] Unhandled promise rejections results in hard to diagnose WFT failure |
| [#1017](#1017) | 0 | 6 | [Feature Request] Allow strings to be passed for `tls.clientCertPair.crt/key` |
| [#921](#921) | 0 | 6 | [Advice needed] Run temporal in meteor 2.7.3 / node 14.19.3 |
| [#915](#915) | 3 | 0 | [Feature Request] Emit metrics from client connection |
| [#900](#900) | 0 | 6 | [Bug] TypeError: (0 , common_1.errorMessage) is not a function |
| [#800](#800) | 2 | 2 | [Bug] Panic on nondeterministic replay |
| [#731](#731) | 0 | 6 | [Bug] Nondeterminism error: Local activity machine can't handle TimerStarted |
| [#635](#635) | 0 | 6 | [Bug] Fix message when objects are thrown |
| [#604](#604) | 1 | 4 | [Bug] Runtime logger isn't used by webpack bundler |
| [#542](#542) | 0 | 6 | [Feature Request] Require a Worker to specify either workflowsPath or workflowBundle |
| [#534](#534) | 0 | 6 | [Bug] regenerator-runtime not found |
| [#506](#506) | 0 | 6 | [Feature Request] Get proto comments in API docs |
| [#489](#489) | 0 | 6 | [Bug] `npm i --production` insufficient |
| [#358](#358) | 0 | 6 | [Docs] Add SDK errors to code and API docs |
| [#305](#305) | 1 | 4 | [Feature Request] Help users avoid old-worker-code bug |
| [#243](#243) | 1 | 4 | [Feature Request] Asynchronous Activity Completion |
| [#220](#220) | 0 | 6 | [Bug] Can't resolve built-in node libraries |
| [#119](#119) | 0 | 6 | [Feature Request] Review timeout / retries and reconnection configuration for the client connection |
| [#1765](#1765) | 1 | 3 | [Bug] Network error while sending worker heartbeat after updating to 1.12.2 |
| [#1668](#1668) | 2 | 1 | [Bug] common package not importing @types/ms |
| [#1663](#1663) | 0 | 5 | [Bug] Can't use structuredClone in workflow code |
| [#1541](#1541) | 0 | 5 | [Bug] Memory leak on the temporal worker side(OperatorSubscriber Class Objects are taking much of the memory) |
| [#1458](#1458) | 2 | 1 | [Feature Request] Support passing preloaded data converters to Client |
| [#1427](#1427) | 0 | 5 | [Bug] Latest update to v1.10.0 makes build fail |
| [#1402](#1402) | 0 | 5 | [Feature Request] search attributes update on schedule |
| [#1308](#1308) | 0 | 5 | [Chore] Add tests to assert proper type rules on all "user defined function with args" APIs |
| [#1291](#1291) | 1 | 3 | [Bug] Custom payload converter not being passed to "Activator" |
| [#1210](#1210) | 1 | 3 | [Feature Request] Add retry configuration to activity info |
| [#1131](#1131) | 0 | 5 | [Bug] Pin dependencies |
| [#1115](#1115) | 0 | 5 | Workflow Task Failed with Unspecified Cause |
| [#1023](#1023) | 0 | 5 | [Bug] node takes 10 seconds to exit since @grpc/grpc-js 1.8.0 |
| [#917](#917) | 0 | 5 | [Bug] Docs Search Result Link 404 |
| [#728](#728) | 0 | 5 | [Bug] jest times-out on first run of TestWorkflowEnvironment |
| [#669](#669) | 0 | 5 | protobufjs-6.11.2.tgz: 1 vulnerabilities (highest severity is: 7.5) |
| [#655](#655) | 0 | 5 | [Bug] ActivityInterface adds a string index to any interface that implements it |
| [#499](#499) | 1 | 3 | [Feature Request] Add WorkflowExecutionAlreadyTerminated |
| [#461](#461) | 0 | 5 | [Feature Request] Log all errors in Worker |
| [#437](#437) | 2 | 1 | [Feature Request] Add headers to signal and query interceptors |
| [#407](#407) | 2 | 1 | [Feature Request] Update users on their Workflow Execution progress in the shell  |
| [#403](#403) | 1 | 3 | [Feature Request] Help users avoid no-worker bug |
| [#283](#283) | 0 | 5 | [Bug] It's too easy to get confused by importing an activity directly |
| [#269](#269) | 0 | 5 | [Feature Request] replace workDir with utility func, and switch to `nodeModulesPaths` array for webpack |
| [#244](#244) | 0 | 5 | [Bug] Auto generated changelogs and versions are not working as intended |
| [#228](#228) | 0 | 5 | [Feature Request] Flexible workflow and main method naming |
| [#110](#110) | 0 | 5 | [Bug] Getting a "ValueError: Unknown Encoding: ^PÔøΩ)^F0ÔøΩ" error when running hello world sample app |
| [#48](#48) | 0 | 5 | Implement worker limits |
| [#1800](#1800) | 2 | 0 | [Feature Request] Provide a way to distinguish error types in logs from TypeScript SDK (errors lose type info across Worker <-> Workflow) |
| [#1738](#1738) | 0 | 4 | [Bug] opentelemetry traceState is handled properly in  makeWorkflowExporter |
| [#1718](#1718) | 0 | 4 | [Feature Request] Lazily load webpack |
| [#1646](#1646) | 1 | 2 | [Feature Request] Initial Nexus implementation |
| [#1613](#1613) | 1 | 2 | [Feature Request] Split worker build tool dependencies into a separate package |
| [#1607](#1607) | 0 | 4 | [Bug] TypeScript error TS2322: Type 'AsyncIterableIterator<any[]>' is not assignable to type 'AsyncIterable<[B]>'. |
| [#1600](#1600) | 1 | 2 | [Feature Request] OTel metrics over HTTP |
| [#1509](#1509) | 0 | 4 | [Bug] Worker doesn't start in arm64 docker container |
| [#1390](#1390) | 0 | 4 | [Bug] crypto.getRandomValues not supported |
| [#1202](#1202) | 0 | 4 | [Bug] Type Definition Improvement for `ActivityFunction` Interface |
| [#1197](#1197) | 0 | 4 | [Feature Request] Workflow rollback |
| [#1177](#1177) | 0 | 4 | [Feature Request] Forward Core's metrics to TypeScript-land |
| [#1087](#1087) | 0 | 4 | [Bug] 'too many filter conditions specified' on reasonable query |
| [#1076](#1076) | 1 | 2 | temporal-client-0.1.0: 1 vulnerabilities (highest severity is: 9.1) |
| [#1061](#1061) | 1 | 2 | [Feature Request] Allow setting default activity options on worker creation  |
| [#1046](#1046) | 0 | 4 | [Bug] `sleep('1 month')` results in UnhandledCommand WFT failure |
| [#876](#876) | 1 | 2 | [Bug] Unable to run tests using Temporal SDK using vitest |
| [#874](#874) | 0 | 4 | [Bug] `test-npm-init` hangs sometimes on Mac |
| [#872](#872) | 0 | 4 | istanbul-instrumenter-loader-3.0.1.tgz: 1 vulnerabilities (highest severity is: 5.6) |
| [#806](#806) | 0 | 4 | [Bug] Stress test exits |
| [#753](#753) | 0 | 4 | [Bug] Flaky test framework segfaults when used with Jest runner |
| [#729](#729) | 1 | 2 | [Bug] Missing code coverage in TestWorkflowEnvironment |
| [#649](#649) | 0 | 4 | Memory leak on the temporal worker side |
| [#637](#637) | 1 | 2 | [Bug] Fix non-TemporalFailure type |
| [#586](#586) | 0 | 4 | [Bug] Parent workflow doesn't fail when child workflow encounters WorkflowExecutionAlreadyStartedError |
| [#582](#582) | 0 | 4 | [Feature Request] Add more detailed error/stack to TransportError errors |
| [#564](#564) | 0 | 4 | [Bug] Heartbeat details should be array? |
| [#561](#561) | 0 | 4 | [Docs] Versionize documentation |
| [#552](#552) | 0 | 4 | [Bug] Windows test exists with code 1 without failures |
| [#482](#482) | 0 | 4 | [Feature Request] Wrap `WorkflowHandle.describe` output in a JS friendly object |
| [#472](#472) | 0 | 4 | [Feature Request] eslint plugin |
| [#469](#469) | 0 | 4 | [Bug] Allow registerErrors to be called multiple times |
| [#462](#462) | 0 | 4 | [Bug] Put more info into workflow activation failures |
| [#445](#445) | 2 | 0 | Add parent workflow information in `WorkflowInfo` |
| [#441](#441) | 0 | 4 | [Bug] Retry policy intervals get rounded down to the second |
| [#438](#438) | 2 | 0 | [Feature Request] Header support for signals and queries |
| [#383](#383) | 0 | 4 | [Bug] package initalizer errors on node 14 |
| [#368](#368) | 1 | 2 | [Feature Request] Provide docker image(s) for compiling/running workers |
| [#330](#330) | 0 | 4 | [Bug] Opentelemetry bugs/findings |
| [#325](#325) | 0 | 4 | Guidance on connection and client instantiation pattern when long-lived connections will frequently drop |
| [#290](#290) | 0 | 4 | [Feature Request] Reconnecting to the server instead of crashing |
| [#284](#284) | 0 | 4 | [Feature Request] Return Promise from Worker.shutdown() |
| [#272](#272) | 0 | 4 | [Feature Request] Assist with use-before-define bugs |
| [#266](#266) | 0 | 4 | [Feature Request] continueAsNew with a taskQueue |
| [#241](#241) | 0 | 4 | [Bug] Worker crashes occasionally during load tests |
| [#214](#214) | 1 | 2 | [Feature Request] Provide a method for getting a client instance on `activity.Context` |
| [#176](#176) | 0 | 4 | [Bug] Cannot find temporal modules during build |
| [#125](#125) | 0 | 4 | [Bug] Getting a "TypeError: otel.setSpan is not a function" error when running hello world sample app |
| [#115](#115) | 1 | 2 | [Feature Request] Searchable SDK docs |
| [#102](#102) | 2 | 0 | [Feature Request] Add ability to debug Workflow code in isolates |
| [#98](#98) | 1 | 2 | [Bug] Intermediate certificates sample does not work on MacOS |
| [#39](#39) | 0 | 4 | Include a roadmap in readme |
| [#19](#19) | 0 | 4 | Drain any remaining activations from `poll_task` until it returns `CoreError::ShuttingDown` |
| [#1864](#1864) | 1 | 1 | [Feature Request] Update AI SDK integration to v6 |
| [#1772](#1772) | 0 | 3 | extractSourceMap takes a huge amount of RAM on boot |
| [#1748](#1748) | 0 | 3 | Cannot suppress worker state logs in test environment |
| [#1740](#1740) | 1 | 1 | [Bug] webpackConfigHook doesn't seem to suppress all webpack output |
| [#1601](#1601) | 0 | 3 | result of env.run is not inferring type, returning `unknown` |
| [#1589](#1589) | 0 | 3 | [Bug] Tests `Retry on "RST_STREAM with code 0/2` failing since Node 22.12.0 on Windows |
| [#1558](#1558) | 1 | 1 | [Bug] Payload Converter doesn't work when running as ESM |
| [#1555](#1555) | 0 | 3 | patched always true inside Signal |
| [#1550](#1550) | 1 | 1 | [Feature Request] Expose classes `TextEncoder` and `TextDecoder` in Workflow sandbox |
| [#1510](#1510) | 0 | 3 | [Bug] RangeError: "length" is outside of buffer bounds |
| [#1489](#1489) | 0 | 3 | [Bug] Critical dependency: the request of a dependency is an expression |
| [#1468](#1468) | 0 | 3 | [Bug] Interceptors Don't Seem to Support Module Alias |
| [#1464](#1464) | 0 | 3 | [Feature Request] Allow dev server version to be explicitly provided and mark some options as unstable |
| [#1457](#1457) | 0 | 3 | [Feature Request] Support "query" when listing schedules |
| [#1425](#1425) | 0 | 3 | [Feature Request] Add OTEL tracing information as attribute on log messages emitted using Workflow Logger |
| [#1392](#1392) | 0 | 3 | Support for WorkflowIdConflictPolicy |
| [#1342](#1342) | 1 | 1 | [Bug] Runtime fails to start with OtelCollectorExporter configured |
| [#1332](#1332) | 1 | 1 | [Feature Request] `TestWorkflowEnvironment` should support non-spawned servers |
| [#1309](#1309) | 0 | 3 | [Bug] Comment unclear on when activities are cancelled after calling `Worker.shutdown` |
| [#1248](#1248) | 1 | 1 | [Bug] Unable to provide Authorization header for a client Connection - CallCredentials does not appear to work |
| [#1224](#1224) | 0 | 3 | [Bug] `RangeError: Maximum call stack size exceeded` on Worker shutdown |
| [#1201](#1201) | 0 | 3 | Cron job getting scheduled after deployment and Terminated automatically after 1 minute or so   |
| [#1200](#1200) | 1 | 1 | [Bug] Metric `workflow_task_execution_failed` doesn't have correct tags |
| [#1175](#1175) | 0 | 3 | [Support] Activating a workflow causes "Automatic publicPath is not supported in this browser" (error when using node but not node-ts) |
| [#1127](#1127) | 0 | 3 | Temporal SDK Changes how javascript is being executed |
| [#1125](#1125) | 0 | 3 | [Bug] tsc in a project created with `npx @temporalio/create` fails on Node 20 |
| [#1122](#1122) | 0 | 3 | [Bug] Temporal worker fails to start if I am using class transformer |
| [#1108](#1108) | 1 | 1 | [Feature Request] Permit imports of Node `buffer` module in workflows  |
| [#1102](#1102) | 1 | 1 | [Bug] Hang on starting workflow worker on NodeJS 18.14.2 |
| [#1066](#1066) | 0 | 3 | [Feature Request] add string types for `ms` package |
| [#1042](#1042) | 0 | 3 | core-2.3.0.tgz: 9 vulnerabilities (highest severity is: 8.8) - autoclosed |
| [#1024](#1024) | 1 | 1 | [Bug] cannot spawn test-server |
| [#1015](#1015) | 1 | 1 | [Feature Request] Support dynamic workflows, activities, signals, queries, and updates |
| [#998](#998) | 0 | 3 | [Feature Request] Add built-in support for context propagators |
| [#981](#981) | 1 | 1 | [Feature Request] Support usage of class `URL` inside workflow sandbox |
| [#913](#913) | 0 | 3 | [Bug] `stress-tests` may time out |
| [#885](#885) | 0 | 3 | [Bug] Duplicate identifier 'Long' |
| [#850](#850) | 0 | 3 | [Bug] Error running Temporal SDK inside linux docker container (might need musl target?) |
| [#822](#822) | 0 | 3 | [Bug] nodeModulesPath is still used in the docs, it seems to have been removed |
| [#797](#797) | 0 | 3 | [Bug] Node.js fatal error on signalWithStart |
| [#740](#740) | 1 | 1 | [Feature Request] Add `ChildWorkflowHandle.cancel()` |
| [#695](#695) | 0 | 3 | [Feature Request] Add `WorkflowInfo.historySizeInBytes` |
| [#691](#691) | 0 | 3 | [Feature Request] Cache Rust deps in CI |
| [#661](#661) | 0 | 3 | [Bug] Cannot create a new workflow with same workflowId of a completed one |
| [#639](#639) | 0 | 3 | [Feature Request] Disable up-to-date PRs requirement |
| [#629](#629) | 1 | 1 | [Feature Request] Support loading history from tctl / web JSON exports in replayer |
| [#612](#612) | 0 | 3 | [Bug] Heap out of memory on `setHandler(signal, undefined)` |
| [#587](#587) | 0 | 3 | [Feature Request] Change nonRetryable constructor param |
| [#580](#580) | 0 | 3 | [Bug] Process exits when calling client.start or client.execute |
| [#465](#465) | 1 | 1 | [Bug] describeTaskQueue returns empty array of pollers |
| [#454](#454) | 0 | 3 | [Feature Request] Add default value to workflowId |
| [#393](#393) | 0 | 3 | Fix broken init-from-verdaccio in node 14 and enable jobs in CI |
| [#376](#376) | 0 | 3 | Improve error message: context deadline exceeded |
| [#367](#367) | 0 | 3 | [Feature Request] Provide better errors when user passes a nameless function to infer workflow name |
| [#365](#365) | 0 | 3 | [Feature Request] Better context for grpc errors in client |
| [#362](#362) | 0 | 3 | [Bug] Patches should be applied to workflow before workflow code is required |
| [#339](#339) | 0 | 3 | Speed up GitHub Action |
| [#293](#293) | 1 | 1 | Automated release to `next` tag on merge to `main` |
| [#291](#291) | 0 | 3 | Consider strict boolean check in `condition` function return value |
| [#280](#280) | 0 | 3 | SDK version might not be properly set |
| [#233](#233) | 0 | 3 | [Feature Request] Match dev and CI linting |
| [#232](#232) | 0 | 3 | [Feature Request] Document external calling convention for activities |
| [#169](#169) | 0 | 3 | [Feature Request] Discuss project structure |
| [#162](#162) | 0 | 3 | [Bug] Worker significantly slows down over time |
| [#62](#62) | 1 | 1 | [Feature Request] Warn about API instability |
| [#59](#59) | 0 | 3 | [Feature Request] Use `@grpc/grpc-js` instead of the deprecated `grpc` package |
| [#22](#22) | 0 | 3 | Run E2E test for `npm init @temporalio` |
| [#16](#16) | 0 | 3 | Distribute pre-built binaries for native code |
| [#1869](#1869) | 0 | 2 | Environment Configuration does not read the correct file path on macOS |
| [#1859](#1859) | 0 | 2 | [Bug] High CPU usage with OTel instrumentation when updating to v1.13.x |
| [#1796](#1796) | 1 | 0 | [Bug] Changes in type inference of activity return type in SDK 1.12.2 |
| [#1787](#1787) | 1 | 0 | [Feature Request] Allow querying the port/address via TestWorkflowEnvironment |
| [#1744](#1744) | 1 | 0 | [Bug] NDE replaying nested promises |
| [#1736](#1736) | 1 | 0 | [Feature Request] Mask/sanitize client sensitive data references |
| [#1733](#1733) | 0 | 2 | [Bug] `RetryPolicy.maximumAttempt === 0` throws, while it is documented as a valid value for "unlimited" |
| [#1700](#1700) | 1 | 0 | [Feature Request] executeChild to use passed headers |
| [#1695](#1695) | 0 | 2 | [Feature Request] Ability to record markers from workflow |
| [#1693](#1693) | 0 | 2 | [typescript] SDK support for activity reset |
| [#1682](#1682) | 0 | 2 | [Feature Request] Allow cancel polling of `client.result()` (via timeout / AbortSignal) to stop leak |
| [#1678](#1678) | 1 | 0 | [Feature Request] Add missing hooks on OTel interceptors |
| [#1677](#1677) | 1 | 0 | [Bug] Upgrading OTel Interceptor to 1.11.5+ breaks signal-with-start and may cause NDE |
| [#1675](#1675) | 1 | 0 | [Feature Request] support AggregateError |
| [#1655](#1655) | 0 | 2 | Dependency Vulnerability: Zip library |
| [#1608](#1608) | 0 | 2 | Vulnerability GHSA-wwq9-3cpr-mm53 - hashbrown |
| [#1594](#1594) | 1 | 0 | [Bug] First schedule action started using triggerImmediately flag does not honor the schedule's overlap policy |
| [#1584](#1584) | 0 | 2 | [Bug] mTLS NativeConnectionOptions tonic::transport::Error(Transport, NativeCertsNotFound) |
| [#1580](#1580) | 0 | 2 | [Bug] Workflows getting stuck after cancellation (spurious WorkflowTaskFailed errors) |
| [#1578](#1578) | 1 | 0 | [Bug] Worker fails to start if Node option --abort-on-uncaught-exception is set |
| [#1540](#1540) | 0 | 2 | Remove workflowsPath in favor or imports (like activities) |
| [#1537](#1537) | 0 | 2 | [Bug] Workflow lifecycle logging is misleading |
| [#1522](#1522) | 1 | 0 | UpdateWithStart SDK API |
| [#1483](#1483) | 0 | 2 | Workflow-init support docs |
| [#1469](#1469) | 0 | 2 | [Feature Request] Allow passing `pageSize` to `WorkflowHandle.fetchHistory` |
| [#1416](#1416) | 1 | 0 | [Feature Request] Cloud Operations API Client |
| [#1400](#1400) | 0 | 2 | [Bug] `Workflow referenced an unregistered external sink` when using `@temporalio/interceptors-opentelemetry` |
| [#1389](#1389) | 0 | 2 | [Bug] Inconsistent Type Definition of Workflow Arguments |
| [#1375](#1375) | 0 | 2 | [Feature Request] Queueing a workflow |
| [#1366](#1366) | 0 | 2 | [Feature Request] Support weighted random polling multiple task queues |
| [#1361](#1361) | 0 | 2 | [Feature Request] Custom Workflow/Activity Resolver |
| [#1350](#1350) | 0 | 2 | [Bug] Dependency issue when installing @temporalio/interceptors-opentelemetry v1.9.0 |
| [#1297](#1297) | 0 | 2 | this can be undefined in async context |
| [#1287](#1287) | 0 | 2 | [Feature Request] Eliminate glue code |
| [#1282](#1282) | 0 | 2 | [Bug] Activity logger does not serialize Error objects |
| [#1275](#1275) | 0 | 2 | [Feature Request] Add NativeClient keep alive support |
| [#1273](#1273) | 0 | 2 | TransportError: tonic::transport::Error(Transport, hyper::Error(Connect, ConnectError("tcp connect error", Os { code: 99, kind: AddrNotAvailable, message: "Cannot assign requested address" }))) |
| [#1208](#1208) | 0 | 2 | [Bug] `workflow.log` fails when using `nyc-test-coverage` |
| [#1195](#1195) | 0 | 2 | Forwarded logs from the core do not include metadata |
| [#1183](#1183) | 0 | 2 | [Bug] worker.Shutdown() results into a Shutdown exception |
| [#1144](#1144) | 0 | 2 | [Feature Request] Add support for capturing Workflow test coverage data using Jest |
| [#1116](#1116) | 0 | 2 | [Bug] @temporalio/create produces unbuildable hello-world project |
| [#1113](#1113) | 1 | 0 | [Feature Request] Create a `npx @temporalio/doctor` command |
| [#1112](#1112) | 0 | 2 | [Bug] Workflow Bundler does not deny usage of the `process` global variable |
| [#1111](#1111) | 0 | 2 | [Bug] unable to do npm install in a docker to build a container with a worker app since 1.7.3 temporal TS SDK was published |
| [#1100](#1100) | 0 | 2 | [Bug] Duplicate name error when @temporalio/worker and @temporalio/testing both installed |
| [#1065](#1065) | 0 | 2 | [Feature Request] Expose enum for ExecutionStatus |
| [#1063](#1063) | 0 | 2 | [Bug] Temporal does not use standard AbortController/AbortSignal typings |
| [#1057](#1057) | 0 | 2 | [Feature Request] Propagate opentelemetry context to local activities |
| [#1006](#1006) | 0 | 2 | [Bug] Some logs not being done with our custom logger |
| [#1004](#1004) | 0 | 2 | [Bug] Installing "@temporalio/testing:1.4.0" along with 1.5.2 libs (activity/client/worker/workflow) breaks Temporal |
| [#997](#997) | 0 | 2 | [Feature Request] Add worker option to delay sending cancellation to activities on shutdown |
| [#996](#996) | 0 | 2 | [Bug] replay workflow with log interceptor not showing logs |
| [#982](#982) | 0 | 2 | Incompatible with allowSyntheticDefaultImports set to false |
| [#978](#978) | 0 | 2 | [Doc] Document how to bundle with esbuild |
| [#972](#972) | 0 | 2 | [Bug] Activity schedule to start metric incorrect during retries  |
| [#959](#959) | 0 | 2 | [Bug] Broken links and hierarchy |
| [#916](#916) | 0 | 2 | [Bug] CI flake: `failed to fill whole buffer` |
| [#905](#905) | 0 | 2 | [Bug] `npx @temporalio/create@latest` fails in node 18. |
| [#886](#886) | 0 | 2 | [Bug] workflowClient  |
| [#877](#877) | 0 | 2 | [Bug] Error on Render: `TypeError: failed to downcast any` |
| [#851](#851) | 0 | 2 | Jest does not exit due to open handle in temporal |
| [#844](#844) | 0 | 2 | [Bug] Remove `@types/long` stub types definition from `@temporalio/client` |
| [#839](#839) | 0 | 2 | [Bug] @temporalio/nyc-test-coverage npm module doesn't contain lib |
| [#824](#824) | 0 | 2 | [Bug] CI flake: ERR_SCRIPT_EXECUTION_TIMEOUT |
| [#813](#813) | 0 | 2 | [Feature Request] Less boiler plate. |
| [#811](#811) | 0 | 2 | Improve test server download resilience |
| [#810](#810) | 0 | 2 | [Bug] Issue with Long dependency being listed as devDependency |
| [#807](#807) | 0 | 2 | [Bug] Stress test: namespace not found |
| [#804](#804) | 0 | 2 | [Bug] Nightly tests are broken |
| [#796](#796) | 0 | 2 | Add WorkflowInfo.unsafe.now() |
| [#783](#783) | 1 | 0 | [Feature Request] Better Nx support |
| [#781](#781) | 0 | 2 | [Bug] Span ended twice in TypeScript SDK |
| [#777](#777) | 0 | 2 | [Feature Request] Include string enums in failure objects |
| [#773](#773) | 0 | 2 | [Bug] payloadToJSON from from @temporalio/common/lib/proto-utils does not generate vaild proto JSON |
| [#758](#758) | 0 | 2 | [Bug] workflowBundle with code/sourceMap breaks with obscure error, while using codePath/sourceMapPath works |
| [#746](#746) | 0 | 2 | core-2.0.0-beta.21.tgz: 8 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#607](#607) | 1 | 0 | [Feature Request] Eager Connection with `getSystemInfo` |
| [#541](#541) | 0 | 2 | [Feature Request] After `create`, give customized setup instructions |
| [#539](#539) | 0 | 2 | [Feature Request] Reduce size of aarch64-unknown-linux-gnu |
| [#538](#538) | 0 | 2 | Test last heartbeat details shows up on Activity retry |
| [#529](#529) | 0 | 2 | [Bug] test-worker-no-workflows intermittent failure |
| [#478](#478) | 0 | 2 | [Feature Request] Add equivalent to setFailWorkflowExceptionTypes |
| [#470](#470) | 0 | 2 | [Feature Request] TerminatedFailure missing "details" |
| [#459](#459) | 0 | 2 | [Bug] Fix & document which errors cause Workflow Execution failure |
| [#450](#450) | 0 | 2 | [Bug] workflows wont launch on Windows if project folder starts with 'n' |
| [#440](#440) | 0 | 2 | [Feature Request] Provide/use default retry policy  |
| [#435](#435) | 0 | 2 | [Feature Request] Make binary the default protobuf data converter |
| [#406](#406) | 0 | 2 | [Bug] Poor error message running sleep() in a Node script |
| [#390](#390) | 1 | 0 | WorkerOptions.interceptors.workflowModules might not be available if workflows are pre-bundled |
| [#379](#379) | 0 | 2 | [Bug] "npm install" fails on windows, msvc 2017, ... |
| [#375](#375) | 0 | 2 | Improve error message: 'foo' is not a function |
| [#374](#374) | 0 | 2 | [Feature Request] Add aarch64-unkown-linux-gnu to list of build targets for Rust Core |
| [#359](#359) | 0 | 2 | [Feature Request] Improve error messages when the wrong worker is polling the queue |
| [#344](#344) | 0 | 2 | [Bug] Retry worker connection when temporal server is down |
| [#318](#318) | 0 | 2 | [Feature Request] Improve workflow id documentation |
| [#314](#314) | 0 | 2 | [Feature Request] Add missing continuedAsNewExecutionRunId to WorkflowInfo interface |
| [#309](#309) | 0 | 2 | [Request] split `createWorkflowHandle` into `getExistingWorkflowHandle`? |
| [#294](#294) | 0 | 2 | [Feature Request] Support connecting to multiple server addresses from Core and optionally the Node gRPC client |
| [#282](#282) | 0 | 2 | [Bug] Unknown failure during querying complete workflow. |
| [#263](#263) | 0 | 2 | [Feature Request] Dynamic Workflow signal and query handler registration |
| [#261](#261) | 0 | 2 | Post-release: Update server version-feature mapping |
| [#255](#255) | 0 | 2 | [Feature Request] Support history replay as exported from tctl and Temporal web |
| [#242](#242) | 0 | 2 | [Feature Request] Change parameter order for injected functions? |
| [#237](#237) | 1 | 0 | [Feature Request] Protobuf payload converter support |
| [#197](#197) | 0 | 2 | [Bug] Cannot find module 'ms' |
| [#184](#184) | 0 | 2 | Clarify Mac contributing set up instructions |
| [#172](#172) | 0 | 2 | [Bug] proto package depends on core-bridge |
| [#170](#170) | 0 | 2 | Automate release process |
| [#168](#168) | 0 | 2 | [Feature Request] Discuss activity registration and imports |
| [#167](#167) | 1 | 0 | [Feature Request] Implement stack trace query |
| [#150](#150) | 0 | 2 | [Bug] CI fails when installing from verdaccio without any logs |
| [#130](#130) | 0 | 2 | [Feature Request] Custom data converters |
| [#101](#101) | 0 | 2 | [Feature Request] Use source maps for better stack traces in WF isolate code |
| [#96](#96) | 0 | 2 | [Feature Request] Automated load testing |
| [#35](#35) | 0 | 2 | Set up logger for worker package |
| [#6](#6) | 1 | 0 | Revisit cancellation and scopes design |
| [#1](#1) | 0 | 2 | Scheduler code style nit |
| [#1811](#1811) | 0 | 1 | [Feature Request] Sticky Sessions Support in TypeScript SDK |
| [#1785](#1785) | 0 | 1 | [Bug] Remove peer dependencies from @temporalio/interceptors-opentelemetry |
| [#1783](#1783) | 0 | 1 | `WorkflowIdReusePolicy.TERMINATE_IF_RUNNING` deprecated or not? |
| [#1756](#1756) | 0 | 1 | [Bug] Hostname is overly restrictive |
| [#1726](#1726) | 0 | 1 | Condition callback function is not support Promise return in type |
| [#1701](#1701) | 0 | 1 | [Bug] @temporalio/worker: NativeConnection fails with NativeCertsNotFound on Temporal Cloud connection using API Key |
| [#1688](#1688) | 0 | 1 | [Feature Request] Warn when the server-provided task start time is fairly different than time SDK begins processing the task |
| [#1676](#1676) | 0 | 1 | Vulnerability GHSA-4p46-pwfr-66x6 - ring, GHSA-2gh3-rmm4-6rq5 - protobuf |
| [#1661](#1661) | 0 | 1 | [Feature Request] Serialization context for codecs and converters |
| [#1660](#1660) | 0 | 1 | [Bug] RESOURCE_EXHAUSTED error while describing workflow schedule |
| [#1656](#1656) | 0 | 1 | [Bug] Workflow type is incorrectly deduced when using `bind` on workflow function |
| [#1652](#1652) | 0 | 1 | [Bug] Throw on usage of Workflow APIs that modify state from non-replayable context |
| [#1628](#1628) | 0 | 1 | Child Workflows not Respecting WorkflowIdConflictPolicy.USE_EXISTING |
| [#1618](#1618) | 0 | 1 | [Bug] on using bun not able to connect temporal |
| [#1617](#1617) | 0 | 1 | [Feature Request] Custom Activity Function Name in UI |
| [#1570](#1570) | 0 | 1 | [Feature Request] Simplify API on interceptors |
| [#1569](#1569) | 0 | 1 | [Feature Request] Complete conversion of old style integration tests |
| [#1568](#1568) | 0 | 1 | [Feature Request] Update supported Node versions to 18.x to 22.x |
| [#1556](#1556) | 0 | 1 | [Bug] All log related to the same trace_id  |
| [#1544](#1544) | 0 | 1 | [Feature Request] Support user metadata |
| [#1506](#1506) | 0 | 1 | [Feature Request] Allow passing live `payloadConverter` object on Client and Activity-Worker |
| [#1502](#1502) | 0 | 1 | [Bug] @temporalio/worker with subdependency @opentelemetry/api version higher than 1.6.0 breaks |
| [#1501](#1501) | 0 | 1 | Expose activity retry options via activity Info interface |
| [#1491](#1491) | 0 | 1 | [Bug] log.error doesn't log the error |
| [#1481](#1481) | 0 | 1 | [Feature Request] Reduce TS parsing/evaluation times |
| [#1460](#1460) | 0 | 1 | [Feature Request] Support default/dynamic update handlers |
| [#1435](#1435) | 0 | 1 | Provide methods to wait for all handlers to finish |
| [#1434](#1434) | 0 | 1 | Warn or error when update handlers dangle across CAN or workflow exit |
| [#1431](#1431) | 0 | 1 | [Feature Request] Make it easier to diagnose failures to connect to Temporal Cloud due to incorrect `serverRootCACertificate` |
| [#1422](#1422) | 0 | 1 | Wrap GRPC::CANCELED and DEADLINE_EXCEEDED in an SDK Timeout exception for Update |
| [#1421](#1421) | 0 | 1 | [Feature Request] Do not set workflow completion until after all coroutines have settled in the task |
| [#1415](#1415) | 0 | 1 | [chore] Update repo to NPM 7 workspaces |
| [#1404](#1404) | 0 | 1 | [Bug] Some TS Worker errors while processing a Task may cause complete Worker failure |
| [#1397](#1397) | 0 | 1 | [Feature Request] Await multiple signals in a workflow |
| [#1387](#1387) | 0 | 1 | [Feature Request] HTTP CONNECT proxy support |
| [#1382](#1382) | 0 | 1 | [Bug] Page size filter in @temporalio/client list method doesn't seem to be working properly |
| [#1381](#1381) | 0 | 1 | [Feature Request] Use macOS M1/ARM runners for all SDK CI |
| [#1371](#1371) | 0 | 1 | [Feature Request]  SDK clients should set a UpdateID on any update request even if the user did not specify one |
| [#1369](#1369) | 0 | 1 | [Bug] FailureConverters should not be reported as PayloadConverters in error messages |
| [#1347](#1347) | 0 | 1 | [Bug] listWorkflowExecutions without namespace throws an exception. |
| [#1331](#1331) | 0 | 1 | [Feature Request] Schedule creation should create tracing span by default |
| [#1329](#1329) | 0 | 1 | nyc-test-coverage-1.9.0-rc.0.tgz: 2 vulnerabilities (highest severity is: 8.8) - autoclosed |
| [#1327](#1327) | 0 | 1 | [Feature Request] Validate input |
| [#1323](#1323) | 0 | 1 | Missing test coverage for Prometheus server |
| [#1316](#1316) | 0 | 1 | @temporalio/nyc-test-coverage-1.9.0-rc.0.tgz: 2 vulnerabilities (highest severity is: 8.8) - autoclosed |
| [#1285](#1285) | 0 | 1 | [Feature Request] Support Deno |
| [#1274](#1274) | 0 | 1 | [Bug] Error not serialized fully when sent to Sinks |
| [#1262](#1262) | 0 | 1 | [Feature Request][TS] Expose `StartWorkflowOptions.workflowStartDelay` |
| [#1260](#1260) | 0 | 1 | nyc-test-coverage-1.8.6.tgz: 2 vulnerabilities (highest severity is: 8.8) - autoclosed |
| [#1259](#1259) | 0 | 1 | [Bug] MockActivityEnvironment holds open handle prevents jest from exiting |
| [#1256](#1256) | 0 | 1 | [Feature Request] Deprecate `appendDefaultInterceptors` |
| [#1246](#1246) | 0 | 1 | @temporalio/nyc-test-coverage-1.8.6.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1241](#1241) | 0 | 1 | @temporalio/nyc-test-coverage-1.8.5.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1231](#1231) | 0 | 1 | Unknown typescript syntax.  |
| [#1230](#1230) | 0 | 1 | [Feature Request] register custom search attribute on `TestWorkflowEnvironment` |
| [#1228](#1228) | 0 | 1 | nyc-test-coverage-1.8.4.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1227](#1227) | 0 | 1 | [Clarification] Behavior of `signalWithStart` |
| [#1222](#1222) | 0 | 1 | [Feature Request] Expose `originalExecutionRunId` in `workflowInfo` |
| [#1220](#1220) | 0 | 1 | @temporalio/nyc-test-coverage-1.8.4.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1214](#1214) | 0 | 1 | nyc-test-coverage-1.8.3.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1213](#1213) | 0 | 1 | client-1.8.3.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#1196](#1196) | 0 | 1 | [Bug] Typo in `defaultWorflowInterceptorModules` API |
| [#1194](#1194) | 0 | 1 | [Bug] Workflow bundle size increased by 1.5MB between 1.8.0 and 1.8.1 |
| [#1191](#1191) | 0 | 1 | @temporalio/client-1.8.2.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#1190](#1190) | 0 | 1 | @temporalio/nyc-test-coverage-1.8.2.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1168](#1168) | 0 | 1 | nyc-test-coverage-1.8.1.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1167](#1167) | 0 | 1 | client-1.8.1.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#1164](#1164) | 0 | 1 | client-1.8.0.tgz: 1 vulnerabilities (highest severity is: 5.5) - autoclosed |
| [#1163](#1163) | 0 | 1 | nyc-test-coverage-1.8.0.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed |
| [#1155](#1155) | 0 | 1 | @temporalio/nyc-test-coverage-1.8.0.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed |
| [#1145](#1145) | 0 | 1 | [Bug] Client.schedule.create is giving "Schedule not found" error if namespace is incorrect |
| [#1141](#1141) | 0 | 1 | nyc-test-coverage-1.7.4.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed |
| [#1114](#1114) | 0 | 1 | [Bug] `.cancel()` does not exists on child workflow handles |
| [#1095](#1095) | 0 | 1 | [Feature Request] Allow Webpack stats to be configured/disabled |
| [#1091](#1091) | 0 | 1 | [Feature Request] Expose URL and URLSearchParams to workflow sandbox |
| [#1083](#1083) | 0 | 1 | instanceof not working |
| [#1075](#1075) | 0 | 1 | core-2.3.0.tgz: 6 vulnerabilities (highest severity is: 8.8) |
| [#1074](#1074) | 0 | 1 | temporal-sdk-core-0.1.0: 1 vulnerabilities (highest severity is: 7.5) |
| [#1073](#1073) | 0 | 1 | opentelemetry-0.18.0.crate: 1 vulnerabilities (highest severity is: 9.8) |
| [#1059](#1059) | 0 | 1 | [docs] Types are missing in the left nav bar of the exported API documentation |
| [#1055](#1055) | 0 | 1 | Power local test environment with Temporal CLI |
| [#1053](#1053) | 0 | 1 | [Bug] First activity heartbeat not sent right away |
| [#1052](#1052) | 0 | 1 | [Feature Request] Retain type information regarding signal/query `name` |
| [#1050](#1050) | 0 | 1 | [CI flake] Schedules deadline exceeded |
| [#1034](#1034) | 0 | 1 | preset-classic-2.2.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#1029](#1029) | 0 | 1 | opentelemetry-0.18.0.crate: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#1027](#1027) | 0 | 1 | tokio-1.21.2.crate: 1 vulnerabilities (highest severity is: 5.4) - autoclosed |
| [#1026](#1026) | 0 | 1 | [Chore] Upgrade @grpc/grpc-js to 1.8+ |
| [#1014](#1014) | 0 | 1 | [Feature Request] Opt-in to having stack trace query use custom data converter |
| [#1007](#1007) | 0 | 1 | [Feature Request] Expose currently configured payload converter to workflow code |
| [#1001](#1001) | 0 | 1 | core-2.2.0.tgz: 4 vulnerabilities (highest severity is: 8.8) - autoclosed |
| [#994](#994) | 0 | 1 | nyc-test-coverage-1.5.2.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#992](#992) | 0 | 1 | @temporalio/nyc-test-coverage-1.5.1.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#976](#976) | 0 | 1 | [Bug] `WorkflowNotFoundError` used when namespace not found |
| [#970](#970) | 0 | 1 | Run `cargo fmt/clippy` from `npm run format/lint` |
| [#966](#966) | 0 | 1 | Go through all deprecated imports |
| [#958](#958) | 0 | 1 | [Feature Request] Improve experience of including workflow modules that have a `browser` field |
| [#938](#938) | 0 | 1 | [Feature Request] Formally validate public API modification between releases |
| [#930](#930) | 0 | 1 | nyc-test-coverage-1.4.3.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#926](#926) | 0 | 1 | @temporalio/nyc-test-coverage-1.4.3.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#919](#919) | 0 | 1 | @temporalio/nyc-test-coverage-1.4.2.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#911](#911) | 0 | 1 | [Bug] nyc-test-coverage uses unmaintained istanbul-instrumenter-loader |
| [#904](#904) | 0 | 1 | @temporalio/nyc-test-coverage-1.4.1.tgz: 1 vulnerabilities (highest severity is: 5.6) - autoclosed |
| [#895](#895) | 0 | 1 | @temporalio/nyc-test-coverage-1.4.0.tgz: 1 vulnerabilities (highest severity is: 5.6) - autoclosed |
| [#894](#894) | 0 | 1 | Look into deprecated deps |
| [#880](#880) | 0 | 1 | [Feature Request] Retry sticky worker unavailable |
| [#863](#863) | 0 | 1 | [Bug] `instanceof WorkflowNotFoundError` not working |
| [#853](#853) | 0 | 1 | [Bug] Stress tests did not complete in CI |
| [#846](#846) | 0 | 1 | [Feature Request] Catch-all signal handler |
| [#841](#841) | 0 | 1 | [Bug] CancellationScopes (AsyncLocalStorage) scope leak with node.js 18 |
| [#840](#840) | 0 | 1 | [Feature Request] Add meta client |
| [#817](#817) | 0 | 1 | [Feature Request] Upsert TemporalChangeVersion on patch |
| [#801](#801) | 0 | 1 | docusaurus-plugin-snipsync-1.0.0.tgz: 1 vulnerabilities (highest severity is: 5.9) - autoclosed |
| [#794](#794) | 0 | 1 | [Feature Request] ScheduleClient |
| [#792](#792) | 0 | 1 | Better Documentation for bundleWorkflowCode in Typescript SDK |
| [#785](#785) | 0 | 1 | [Feature Request] Upgrade to protobufjs@7 |
| [#776](#776) | 0 | 1 | [Feature Request] Expose internal-non-workflow-common functionality |
| [#775](#775) | 0 | 1 | Allow for Batched Replays |
| [#774](#774) | 0 | 1 | Enable import/no-deprecated |
| [#762](#762) | 0 | 1 | [Bug] worker client OOM when running as a container in a k8s cluster. |
| [#752](#752) | 0 | 1 | [Feature Request] Add `ApplicationFailure.create` |
| [#739](#739) | 0 | 1 | [Docs] Rank functions higher in search |
| [#734](#734) | 0 | 1 | client-1.0.0-rc.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#724](#724) | 0 | 1 | [Bug] Update SDK README to match 1.0.0 capabilities |
| [#720](#720) | 0 | 1 | [Feature Request] `WorkflowNotFoundError` export is not consistent with `WorkflowExecutionAlreadyStartedError`  |
| [#717](#717) | 0 | 1 | [Bug] @temporalio/interceptors-opentelemetry package.json refers to non-existent file |
| [#713](#713) | 0 | 1 | got-10.7.0.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed |
| [#712](#712) | 0 | 1 | got-12.0.3.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed |
| [#709](#709) | 0 | 1 | @temporalio/client-1.0.0-rc.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#699](#699) | 0 | 1 | Documentation for config option `maxCachedWorkflows` references unknown option `maxIsolateMemoryMB` |
| [#697](#697) | 0 | 1 | [Bug] Move native connection fields to worker |
| [#687](#687) | 0 | 1 | [Bug] Installing v0.23 I get error "Cannot find module '@temporalio/common/lib/converter/wrapped-payload-converter'" |
| [#671](#671) | 0 | 1 | client-0.23.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#668](#668) | 0 | 1 | [Feature Request] Provide WorkflowInfo.initiator? |
| [#666](#666) | 0 | 1 | neon-0.8.3.crate: 1 vulnerabilities (highest severity is: 7.8) - autoclosed |
| [#659](#659) | 0 | 1 | [Bug] instanceof doesn't work with WorkflowInfo fields |
| [#620](#620) | 0 | 1 | [Bug] OpenTelemetry interceptors patch global runtime outside workflow isolate too |
| [#618](#618) | 0 | 1 | We have a regression in our tests where we can no longer run tests from forks: |
| [#610](#610) | 0 | 1 | [Bug] Sink API appears to create circular JSON |
| [#606](#606) | 0 | 1 | [Bug] Test env tests fail on windows |
| [#601](#601) | 0 | 1 | core-2.0.0-beta.18.tgz: 9 vulnerabilities (highest severity is: 7.8) - autoclosed |
| [#593](#593) | 0 | 1 | swc-loader-0.1.15.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#576](#576) | 0 | 1 | [Feature Request] Return string for Workflow status |
| [#574](#574) | 0 | 1 | core-2.0.0-beta.15.tgz: 8 vulnerabilities (highest severity is: 7.8) - autoclosed |
| [#572](#572) | 0 | 1 | json5-2.2.0.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed |
| [#571](#571) | 0 | 1 | typedoc-0.21.6.tgz: 2 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#570](#570) | 0 | 1 | webpack-5.5.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#569](#569) | 0 | 1 | lerna-4.0.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed |
| [#562](#562) | 0 | 1 | [Feature Request] Use options object for ApplicationFailure |
| [#557](#557) | 0 | 1 | [Bug] WithWorkflowArgs is not exported |
| [#556](#556) | 0 | 1 | [Feature Request] Move BuildKite builds to GH Actions |
| [#553](#553) | 0 | 1 | [Feature Request] Error when Workflow APIs are used outside of vm |
| [#548](#548) | 0 | 1 | [Feature Request] Use protobufjs global for deserializing protobufs |
| [#530](#530) | 0 | 1 | [Bug] test-npm-init hangs |
| [#528](#528) | 0 | 1 | [Bug] CI tests skipped due to an issue with core build? |
| [#505](#505) | 0 | 1 | [Bug] Failed Activity heartbeat data conversion can crash the worker |
| [#491](#491) | 0 | 1 | [Feature Request] Encode baggage part of trace |
| [#490](#490) | 0 | 1 | [Feature Request] Add setDefaultDataConverter |
| [#488](#488) | 0 | 1 | [Feature Request] Add all-method interceptors |
| [#480](#480) | 0 | 1 | [Feature Request] sleepUntil and UpdatableTimer utils |
| [#471](#471) | 0 | 1 | [Feature Request] Log when in activity-only mode |
| [#455](#455) | 0 | 1 | [Bug] serverNameOverride in tlsConfig does not have expected effect on grpc request |
| [#384](#384) | 0 | 1 | [Feature Request] Add actual span time to spans create by workflow otel interceptors |
| [#377](#377) | 0 | 1 | Improve error message: Workflow executionsRow not found |
| [#373](#373) | 0 | 1 | [Feature Request] Deprecate patch for condition timer cancellation |
| [#334](#334) | 0 | 1 | [Feature Request] Add built-in "getHandlers" query |
| [#329](#329) | 0 | 1 | [Feature Request] Accept prebuilt bundles in Workers |
| [#319](#319) | 0 | 1 | [Feature Request] Use the newer `Context.SetPromiseHooks` API for the workflow isolate extension. |
| [#316](#316) | 0 | 1 | [Bug] undelete WeakMap and WeakSet |
| [#299](#299) | 0 | 1 | [Bug] INVALID_ARGUMENT: Workflow did not register a handler for getSecret in IT |
| [#286](#286) | 0 | 1 | [Feature Request] WorkflowClient and WorkflowHandle execute params are inconsistent |
| [#276](#276) | 0 | 1 | [Feature Request] Provide better error message when creating a child workflow which is not registered |
| [#265](#265) | 0 | 1 | [Bug] publish-to-verdaccio fails |
| [#250](#250) | 0 | 1 | [Bug] Failure to gather logs from core on Worker shutdown |
| [#249](#249) | 0 | 1 | [Feature Request] Hide isolateExecutionTimeout Worker option |
| [#245](#245) | 0 | 1 | Flaky integration test |
| [#240](#240) | 0 | 1 | [Feature Request] Add `defaults` for workflow handle creation on `WorkflowClient` constructor |
| [#229](#229) | 0 | 1 | [Feature Request] Improve Context API docs |
| [#210](#210) | 0 | 1 | [Bug] GH actions sometimes fails due to DEADLINE EXCEEDED |
| [#201](#201) | 0 | 1 | [Feature Request] Make deadline for workflow client and stub calls configurable |
| [#196](#196) | 0 | 1 | [Feature Request] Clarify namespace version menu items |
| [#195](#195) | 0 | 1 | [Feature Request] Sort docs menu items |
| [#180](#180) | 0 | 1 | Use incremental sequence number for correlation IDs between core and lang |
| [#148](#148) | 0 | 1 | [Bug] Query handler should not be async |
| [#143](#143) | 0 | 1 | [Feature Request] Implement search attributes |
| [#140](#140) | 0 | 1 | [Bug] Increase Workflow isolate timeout to handle slow Github Actions worker nodes |
| [#117](#117) | 0 | 1 | [Bug] 14 UNAVAILABLE error against Cloud deployment |
| [#116](#116) | 0 | 1 | [Feature Request] Auto compile project on worker run |
| [#103](#103) | 0 | 1 | [Bug] `npm init @temporalio ...` might fail if out-of-date |
| [#88](#88) | 0 | 1 | [Bug] Remove snipsync comments from generated code when creating a new package |
| [#68](#68) | 0 | 1 | [Feature Request] Support workflow versioning |
| [#66](#66) | 0 | 1 | [Feature Request] Publish API docs |
| [#53](#53) | 0 | 1 | Figure out how to propagate logs out of the workflow |
| [#50](#50) | 0 | 1 | Implement workflow cleanup |
| [#34](#34) | 0 | 1 | Add utility to turn exceptions into `temporal.api.failure.v1.IFailureIFailure` |
| [#26](#26) | 0 | 1 | Fix worker crash when workflow file not found |
| [#24](#24) | 0 | 1 | Set up publish from CI |
| [#17](#17) | 0 | 1 | error running through README |
| [#12](#12) | 0 | 1 | Fix CI on windows |
| [#1867](#1867) | 0 | 0 | [Feature Request] Per-Worker Logger |
| [#1862](#1862) | 0 | 0 | [Feature Request] importing workflow into activity dependency causes ‚ÄúgRPC failed to connect before the deadline‚Äù error |
| [#1860](#1860) | 0 | 0 | [Bug] Performance regression from 1.13.1 -> 1.13.2 |
| [#1858](#1858) | 0 | 0 | [Bug] unable to import reflect-metadata within workflow bundle |
| [#1856](#1856) | 0 | 0 | [Bug] Cannot build `@temporalio/core-bridge` rust from source |
| [#1854](#1854) | 0 | 0 | [Feature Request] Correct docs for OtelCollectorExporter |
| [#1851](#1851) | 0 | 0 | [Feature Request] Support non-workflow activities |
| [#1850](#1850) | 0 | 0 | [Feature Request] Implement OTel interceptors v1 as Plugin |
| [#1843](#1843) | 0 | 0 | Default maxCachedWorkflows calculation doesn't account for VM isolate memory being outside V8 heap |
| [#1838](#1838) | 0 | 0 | [Bug] `WorkflowExecutionAlreadyStartedError` should contain `runId` if provided by server |
| [#1832](#1832) | 0 | 0 | [Bug] Worker crashes with "async hook stack has become corrupted" when Prometheus metrics enabled under high concurrency |
| [#1824](#1824) | 0 | 0 | [Feature Request] Allow overriding of the Worker Deployment Version when invoking a Child Workflow |
| [#1810](#1810) | 0 | 0 | [Feature Request] Enable Worker Heartbeating |
| [#1782](#1782) | 0 | 0 | [Feature Request] Ensure tests exist to confirm custom slot supplier slot info has proper fields |
| [#1779](#1779) | 0 | 0 | [Bug] `@temporalio/interceptors-opentelemetry` OTEL bypasses a required SDK component |
| [#1778](#1778) | 0 | 0 | [Feature Request] Ensure gRPC binary metadata headers are supported |
| [#1776](#1776) | 0 | 0 | [Feature Request] Reclassify Benign Application errors in OpenTelemetry |
| [#1775](#1775) | 0 | 0 | [Feature Request] Support for creating v7 UUIDs from within Workflow Tasks |
| [#1764](#1764) | 0 | 0 | [Feature Request] Plugin support |
| [#1753](#1753) | 0 | 0 | [Bug] Calling a Workflow with Worker Versioning and PINNED behavior in versionOverrides fails in Temporal Server >=1.28.0 |
| [#1752](#1752) | 0 | 0 | [Feature Request] Add Activity support for Worker Versioning |
| [#1746](#1746) | 0 | 0 | [Feature Request] Add Summary to LocalActivityOptions |
| [#1739](#1739) | 0 | 0 | [Feature Request] Add `ActivityContext.workerShuttingDown` |
| [#1727](#1727) | 0 | 0 | [Feature Request] Environment Configuration |
| [#1722](#1722) | 0 | 0 | [Feature Request] Include error details on every errors thrown from Client API |
| [#1721](#1721) | 0 | 0 | [Bug] Error thrown from Client's Update-with-Start doesn't show proper message |
| [#1717](#1717) | 0 | 0 | [Bug] Protobuf Payload Converter is broken after upgrading to protobufjs 7.5.2 |
| [#1716](#1716) | 0 | 0 | [TypeScript] Worker Versioning high level client |
| [#1715](#1715) | 0 | 0 | If a serializable value is provided as a SearchAttribute, serialize it instead of throwing the error: "SearchAttribute values must arrays of strings, numbers, booleans, or Dates. The value * at index 0 is of type object" |
| [#1713](#1713) | 0 | 0 | [Feature Request] Pass webpack obj as the second parameter when calling webpackConfigHook |
| [#1710](#1710) | 0 | 0 | [Feature Request] Better type inference for `MockActivityEnvironment.run` |
| [#1706](#1706) | 0 | 0 | [Bug] MockActivityEnvironment's activityInfo().workflowExecution.runId is not a UUID |
| [#1703](#1703) | 0 | 0 | [Feature Request] Complete work on supporting `Client` over `NativeConnection` |
| [#1702](#1702) | 0 | 0 | [Bug] Test suite timeout on first run |
| [#1697](#1697) | 0 | 0 | [Feature Request] Put `temporal-namespace` header on all requests from pure JS client |
| [#1696](#1696) | 0 | 0 | [Feature Request] Otel exporter error handling |
| [#1689](#1689) | 0 | 0 | [Feature Request] Change get static summary/details on workflow in client to be lazy |
| [#1687](#1687) | 0 | 0 | [Bug] Temporal local env cannot be connected in unit tests |
| [#1680](#1680) | 0 | 0 | [Feature Request] Show retry policy on activity info |
| [#1673](#1673) | 0 | 0 | [Feature Request] Add support for batched result retrieval executions |
| [#1672](#1672) | 0 | 0 | [Feature Request] Apply application failure logging and metrics behaviour according to ApplicationErrorCategory |
| [#1665](#1665) | 0 | 0 | Heartbeating activities should be interrupted when the activities are paused. |
| [#1659](#1659) | 0 | 0 | [Feature Request] Support New Worker Versioning API |
| [#1653](#1653) | 0 | 0 | [Bug] Broken Documentation Link |
| [#1647](#1647) | 0 | 0 | [Feature Request] Add summary to Nexus operation |
| [#1635](#1635) | 0 | 0 | [Feature Request] Rehydrate TypedSearchAttributes for sinks or provide WorkflowInfo variant |
| [#1634](#1634) | 0 | 0 | [Feature Request] Custom metric bucket sizes |
| [#1633](#1633) | 0 | 0 | [Feature Request] Expose root workflow execution |
| [#1631](#1631) | 0 | 0 | [Feature Request] Add error message to OpenTelemetry span setStatus |
| [#1630](#1630) | 0 | 0 | [Feature Request] Built-in query responses should use "RawValue" |
| [#1629](#1629) | 0 | 0 | [Feature Request] Support "RawValue" non-converted values |
| [#1626](#1626) | 0 | 0 | Expose Workflow cancel cause/reason |
| [#1620](#1620) | 0 | 0 | [Feature Request] Support Priority Annotations |
| [#1616](#1616) | 0 | 0 | [Feature Request] Add memoization support to the`patched()` API |
| [#1611](#1611) | 0 | 0 | [Feature Request] Allow customization of dev server UI port |
| [#1599](#1599) | 0 | 0 | [Feature Request] Special behavior for Temporal built-in prefixes |
| [#1592](#1592) | 0 | 0 | [Bug] Reusable VM allows context leak due to global symbol properties |
| [#1575](#1575) | 0 | 0 | [Bug] CI build is broken due to GHA dropping support for node16-based actions |
| [#1564](#1564) | 0 | 0 | [Feature Request] Expose `AbortController` in Workflow sandbox |
| [#1549](#1549) | 0 | 0 | [Feature Request] Auto-skip time in time-skipping testing environment when waiting on update result |
| [#1542](#1542) | 0 | 0 | [Feature Request] Allow Update Validators to be async |
| [#1536](#1536) | 0 | 0 | [Bug] Worker keeps accepting WFT after Worker Thread terminates due to ERR_WORKER_OUT_OF_MEMORY |
| [#1533](#1533) | 0 | 0 | [Bug] NDE while replaying Workflows in 1.11.1 with same code |
| [#1532](#1532) | 0 | 0 | Show update handler and ID in logging context |
| [#1512](#1512) | 0 | 0 | [Bug] Payload converter error can crash worker |
| [#1511](#1511) | 0 | 0 | [Feature Request] Update Core SDK: expect `initializeWorkflow` instead of `startWorkflow` jobs |
| [#1495](#1495) | 0 | 0 | [Bug] Reenable OTLP export tests |
| [#1486](#1486) | 0 | 0 | Review use of `untrackPromise` in update implementation |
| [#1479](#1479) | 0 | 0 | [Bug] Nightly Stress CI is failing consistently |
| [#1476](#1476) | 0 | 0 | [Bug] Reusable VM allows context leak due to global variable reassignment |
| [#1475](#1475) | 0 | 0 | [Feature Request] Support schedule search attribute update |
| [#1474](#1474) | 0 | 0 | [Bug] Workflows can be constructed in which update handlers do not, but should, execute |
| [#1472](#1472) | 0 | 0 | [Feature Request] Add website documentation for updates |
| [#1471](#1471) | 0 | 0 | [Feature Request] Update schedule catchup window default value in documentation |
| [#1470](#1470) | 0 | 0 | [Bug] Client should accept responses up to 128MB |
| [#1453](#1453) | 0 | 0 | Refactor stack trace queries to use new protos |
| [#1447](#1447) | 0 | 0 | [Feature Request]  Accept search attributes in dev server startup |
| [#1446](#1446) | 0 | 0 | Workflow-friendly concurrency control |
| [#1445](#1445) | 0 | 0 | Testing |
| [#1444](#1444) | 0 | 0 | Testing |
| [#1440](#1440) | 0 | 0 | [Bug] Emitted client metrics missing temporal_ prefix |
| [#1430](#1430) | 0 | 0 | [Feature Request] Call Core worker.validate |
| [#1420](#1420) | 0 | 0 | [Feature Request] Clean API to intentionally fail an activity in long-polling patterns |
| [#1418](#1418) | 0 | 0 | [Feature Request] Failures thrown from within the update handler should be able to fail the workflow |
| [#1413](#1413) | 0 | 0 | [Feature Request] Warn when runtime can't shutdown due left over `NativeConnection` |
| [#1412](#1412) | 0 | 0 | [Feature Request] Client replacement in worker |
| [#1405](#1405) | 0 | 0 | [Bug] Check worker code for unsafe type assertions |
| [#1403](#1403) | 0 | 0 | [Feature Request] Make startUpdate users aware that it's synchronous w/ worker |
| [#1395](#1395) | 0 | 0 | Expose defaultConnection() method to switch between localhost and cloud based on env |
| [#1380](#1380) | 0 | 0 | [Feature Request] Support metric option for using seconds (and other recent core metric changes) |
| [#1372](#1372) | 0 | 0 | [Feature Request] SDK should not return an update handle if the update has not reached the desired state  |
| [#1367](#1367) | 0 | 0 | [Feature Request] API key client option |
| [#1359](#1359) | 0 | 0 | [Feature request] WorkerStatus does not have numInFlightLocalActivities |
| [#1358](#1358) | 0 | 0 | [Feature Request] Configurable workflow failure exception types |
| [#1349](#1349) | 0 | 0 | Expose next retry delay on Application Failure in all SDKs |
| [#1343](#1343) | 0 | 0 | [Feature Request] Prevent overriding of built-in query handlers |
| [#1339](#1339) | 0 | 0 | [Bug] Malformed Page for `workflow.Trigger` in TypeScript SDK API Reference |
| [#1337](#1337) | 0 | 0 | [Feature Request] Add workflow update tests to nightly suite |
| [#1306](#1306) | 0 | 0 | Add getUpdateHandle |
| [#1301](#1301) | 0 | 0 | [chore] test: Upgrade the CLI to the latest |
| [#1298](#1298) | 0 | 0 | [Feature Request] Support using the pure JS `Connection` to power a `Worker` |
| [#1289](#1289) | 0 | 0 | [Feature Request] Allow manual pagination when listing workflows |
| [#1258](#1258) | 0 | 0 | [Feature Request] Provide nicer error messages on TLS CA cert not found errors |
| [#1251](#1251) | 0 | 0 | [Bug] module is not defined |
| [#1247](#1247) | 0 | 0 | [Bug] Properties of `WorkflowInfo` and `Activity.Context` should not be mutable by user code |
| [#1232](#1232) | 0 | 0 | [Feature Request] Typed Search Attributes |
| [#1219](#1219) | 0 | 0 | @temporalio/client-1.8.4.tgz: 1 vulnerabilities (highest severity is: 9.8) |
| [#1185](#1185) | 0 | 0 | Bundling raw typescript fails |
| [#1182](#1182) | 0 | 0 | [Bug] `Context.current().info.heartbeatTimeoutMs` is undefined |
| [#1174](#1174) | 0 | 0 | [Bug] SDK should drop signals for which it cannot decode payloads |
| [#1169](#1169) | 0 | 0 | [Bug] ProtobufJSONPayloadConverter needs Buffer to encode/decode binary protobuf fields |
| [#1142](#1142) | 0 | 0 | [Bug] Binary and protobuf payload converters break Uint8Array type equality |
| [#1139](#1139) | 0 | 0 | [Feature Request] TemporalFailure from converters and codecs should be able to fail the workflow not task |
| [#1105](#1105) | 0 | 0 | [Bug] `CalendarSpec` components not encoded correctly |
| [#1092](#1092) | 0 | 0 | [Bug] Make `ScheduleUpdateOptions.action.workflowId` optional |
| [#1088](#1088) | 0 | 0 | [Bug] create-project cli doesn't take into account subdirectories when replacing node version |
| [#1071](#1071) | 0 | 0 | [Feature Request] Add missing `repository` field to e.g. `@temporalio/activity` |
| [#1064](#1064) | 0 | 0 | [Feature Request] Return well-formed error OR success if Worker.runReplayHistories receives no histories |
| [#1054](#1054) | 0 | 0 | Add `TelemetryOptions.logging` object format to API ref |
| [#1051](#1051) | 0 | 0 | [Feature Request] Retain type information for signal/query `_Args` |
| [#1022](#1022) | 0 | 0 | [Bug] Schedule client does not infer args based on workflow type |
| [#1020](#1020) | 0 | 0 | [Feature Request] Start workers in debug mode if `TEMPORAL_DEBUG` env var is set |
| [#1010](#1010) | 0 | 0 | Validate single version of packages |
| [#1005](#1005) | 0 | 0 | [Feature Request] Add `workflowInfo().startTime` |
| [#988](#988) | 0 | 0 | ava-3.15.0.tgz: 1 vulnerabilities (highest severity is: 5.3) |
| [#984](#984) | 0 | 0 | [Bug] Module '"@temporalio/workflow"' has no exported member 'proxyActivities'. |
| [#967](#967) | 0 | 0 | Context deadline exceeded on test `schedules > Can update schedule action` |
| [#962](#962) | 0 | 0 | [Feature Request] Allow creating patches before the workflow has started |
| [#953](#953) | 0 | 0 | [Bug] `connectTimeout` ignored when provisioning client connection |
| [#945](#945) | 0 | 0 | [Feature Request] Add client interceptor for `list` and `fetch_history` |
| [#931](#931) | 0 | 0 | [Bug] Queries targeting a nonexistent handler fail WFTs on non-legacy path |
| [#923](#923) | 0 | 0 | [Bug] CI fails from forks |
| [#909](#909) | 0 | 0 | [Bug] Ignored shutdown signal causing stale workers during development |
| [#898](#898) | 0 | 0 | [Feature Request] Give more info in `Webpack finished with errors` message |
| [#890](#890) | 0 | 0 | [Feature Request] Don't warn about no activities during `Worker.runReplayHistory` |
| [#884](#884) | 0 | 0 | [Feature Request] Support Otel temporality config |
| [#838](#838) | 0 | 0 | [Bug] Default `WorkerOptions.maxCachedWorkflows` is too low |
| [#830](#830) | 0 | 0 | [Feature Request] Remove `sourceMap` and `sourceMapPath` |
| [#829](#829) | 0 | 0 | [Feature Request] Remove Long from client |
| [#828](#828) | 0 | 0 | [Feature Request] Throw when `heartbeat()` is called from Local Activities |
| [#825](#825) | 0 | 0 | [Feature Request] Add more `console.*` functions to Workflow vm |
| [#795](#795) | 0 | 0 | [Bug] Breakpoints do not work for workflow code |
| [#782](#782) | 0 | 0 | [Feature Request] Put test server behind CDN to avoid `rate limit exceeded` |
| [#766](#766) | 0 | 0 | Remove terser |
| [#759](#759) | 0 | 0 | worker-1.0.0-rc.1.tgz: 1 vulnerabilities (highest severity is: 5.3) |
| [#730](#730) | 0 | 0 | [Docs] Make method overloads more obvious in docs |
| [#694](#694) | 0 | 0 | [Feature Request] Add `WorkflowInfo.runStartTime` |
| [#685](#685) | 0 | 0 | [Bug] TypeScript: When workflow code imports built-in Node modules, worker logs the problem instead of loudly failing |
| [#677](#677) | 0 | 0 | [Bug] Node client does not send the client-name and client-version HTTP headers |
| [#667](#667) | 0 | 0 | [Bug] Update isReplaying in main thread |
| [#656](#656) | 0 | 0 | [Feature Request] Validate retry policy `maxAttempts` is an integer (e.g. not `Infinity`) |
| [#648](#648) | 0 | 0 | [Feature Request] Make docs breadcrumbs clickable |
| [#642](#642) | 0 | 0 | [Feature Request] Expose grpc static headers in NativeConnection |
| [#608](#608) | 0 | 0 | [Feature Request] Better balancing of workflows between worker threads |
| [#597](#597) | 0 | 0 | [Feature Request] Assert single version of `@temporalio/workflow` is loaded into the workflow runtime |
| [#595](#595) | 0 | 0 | [Feature Request] codec -> codecs |
| [#594](#594) | 0 | 0 | Upsertsearchattributes |
| [#555](#555) | 0 | 0 | [Feature Request] Remote codec converter |
| [#544](#544) | 0 | 0 | [Bug] Fix snipsync |
| [#521](#521) | 0 | 0 | Activity not found and activity arg conversion errors should be retryable. |
| [#514](#514) | 0 | 0 | [Feature Request] Run headers through codec |
| [#493](#493) | 0 | 0 | [Bug] CHANGELOG for 0.18.0 doesn't reflect breaking change for client error handling |
| [#464](#464) | 0 | 0 | [Bug] WorkflowExecutionFailedEventAttributes.retry_state not respected |
| [#457](#457) | 0 | 0 | [Bug] Pre-built Rust bridge does not seem to be used on Windows |
| [#452](#452) | 0 | 0 | [Feature Request] Support easily injecting headers into the grpc connection |
| [#444](#444) | 0 | 0 | [Feature Request] Warn user when sending unregistered signal |
| [#434](#434) | 0 | 0 | [Feature Request] Create new shared package not used by workflow |
| [#420](#420) | 0 | 0 | [Feature Request] DSL example |
| [#418](#418) | 0 | 0 | [Feature Request] Generic workflow defaults: T extends Workflow = Workflow |
| [#417](#417) | 0 | 0 | [Feature Request] Export SDK version |
| [#408](#408) | 0 | 0 | [Bug] `npx @temporalio/create` fails for some users |
| [#397](#397) | 0 | 0 | [Bug] ContinueAsNew shouldn't occur as error in Otel traces |
| [#386](#386) | 0 | 0 | Add an integration test to verify Workflows are retried in case of multiple consecutive timeouts |
| [#364](#364) | 0 | 0 | [Feature Request] Rename external dependencies to sinks |
| [#363](#363) | 0 | 0 | [Bug] Timer is not cancelled when condition resolves |
| [#360](#360) | 0 | 0 | Make tracing tags consistent across SDKs |
| [#348](#348) | 0 | 0 | [Bug] Algolia broken |
| [#345](#345) | 0 | 0 | [Feature Request] Add SIGUSR2 to list of default worker shutdownSignals |
| [#323](#323) | 0 | 0 | [Feature Request] Use single Error type for WorkflowClient errors. |
| [#311](#311) | 0 | 0 | [Bug] Core bridge crashes when given invalid options |
| [#308](#308) | 0 | 0 | [Bug] Unhandled grpc error: BadStartTimerAttributes: A valid StartToFireTimeout is not set on command |
| [#307](#307) | 0 | 0 | [Feature Request] activity.Context.sleep args should pass through ms  |
| [#287](#287) | 0 | 0 | [Bug] workflowIdReusePolicy default should not be set by the SDK |
| [#271](#271) | 0 | 0 | [Bug] activity heartbeat options are double documented |
| [#270](#270) | 0 | 0 | [Feature Request] workflow.sleep args should pass through `ms` |
| [#246](#246) | 0 | 0 | Add timestamps to logger interface |
| [#227](#227) | 0 | 0 | [Bug] Worker.create fails with activities undefined |
| [#222](#222) | 0 | 0 | [Bug] Perform execution-chain following behavior in later server versions  |
| [#203](#203) | 0 | 0 | [Feature Request] Remove broken Worker suspend and resume polling methods |
| [#178](#178) | 0 | 0 | Remove `CancelledError` from WF lib, use `CancelledFailure` for cancelling a cancellation scope |
| [#174](#174) | 0 | 0 | [Bug] Worker fails to start with no workflows |
| [#166](#166) | 0 | 0 | [Bug] perf jaeger export is broken |
| [#153](#153) | 0 | 0 | [Feature Request] Implement WorkflowStub.signalWithStart |
| [#146](#146) | 0 | 0 | [Feature Request] Port Workflow error classes from Java SDK |
| [#142](#142) | 0 | 0 | [Feature Request] Implement child workflows |
| [#141](#141) | 0 | 0 | [Feature Request] Implement ContinueAsNew |
| [#129](#129) | 0 | 0 | [Feature Request] Add missing `ActivityCancellationType` to `ActivityOptions` |
| [#120](#120) | 0 | 0 | Run clippy as part of CI |
| [#109](#109) | 0 | 0 | [Bug] Activity identifier should not include the activity module name |
| [#108](#108) | 0 | 0 | [Feature Request] Limit Workflow activation time |
| [#100](#100) | 0 | 0 | Create a shared dependency for the worker and client packages |
| [#99](#99) | 0 | 0 | Clean up Js->Rust value conversion code in native bridge |
| [#87](#87) | 0 | 0 | [Feature Request] Provide way to specify SSL configuration for Worker->Service connection |
| [#79](#79) | 0 | 0 | [Feature Request] Run a stress test |
| [#63](#63) | 0 | 0 | Use snipsync for all code snippets in docs  |
| [#61](#61) | 0 | 0 | [Bug] Worker times out when trying to shutdown gracefully |
| [#51](#51) | 0 | 0 | Handle errors returned from core correctly |
| [#49](#49) | 0 | 0 | Complete API documentation for all public packages |
| [#47](#47) | 0 | 0 | Get integration tests passing for activities |
| [#38](#38) | 0 | 0 | Add connection options to worker constructor |
| [#33](#33) | 0 | 0 | Don't buffer poll results in core-lang bridge (lib.rs) |
| [#32](#32) | 0 | 0 | Detect and throw on cyclic module dependencies |
| [#21](#21) | 0 | 0 | Review the various README.md files in the project |
| [#14](#14) | 0 | 0 | Run integration tests in CI |

---

## All Issues

Issues are sorted by priority score (upvotes √ó 2 + comments).

---

<a id="1334"></a>

### #1334: [Feature Request] Run temporal worker in bun

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1334 |
| **State** | OPEN |
| **Author** | Code2Life (Joey Yang) |
| **Created** | 2024-01-10 08:59:55.000 UTC (2 years ago) |
| **Updated** | 2025-12-22 04:23:02.000 UTC |
| **Upvotes** | 46 |
| **Comments** | 46 |
| **Priority Score** | 138 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 46 |

#### Description

### Bun worker can not work Issue

I tried to use bun as temporal worker, when running temporal client it looked perfect, the workflow created with HTTP2+gRPC, which just supported in bun.js last month.

But when I ran temporal worker it can not work, even bun.sh had implement v8 compatible vm context sandbox. Firstly I found this issue:
![image](https://github.com/temporalio/sdk-typescript/assets/14833440/9bae6fe2-28bc-4587-beb5-196f5dfdaabb)

Then, i tried to comment out the createHook code block, this error disappeared, but the core-bridge was broken

```
2024-01-10T08:41:16.131Z [INFO] webpack 5.89.0 compiled successfully in 486 ms
2024-01-10T08:41:16.132Z [INFO] Workflow bundle created { size: '0.74MB' }
2024-01-10T08:41:16.284520Z  INFO temporal_sdk_core::worker: Initializing worker task_queue=hello-world namespace=default
thread '<unnamed>' panicked at 'Hash table capacity overflow', /Users/runner/.cargo/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.13.2/src/raw/mod.rs:90:40
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
2024-01-10T08:41:16.286Z [INFO] Worker state changed { state: 'RUNNING' }
2024-01-10T08:41:16.290075Z  INFO next_workflow_activation: temporal_sdk_core::worker: Initiated shutdown task_queue=hello-world namespace=default task_queue=hello-world
2024-01-10T08:41:16.291Z [INFO] Worker state changed { state: 'DRAINED' }
2024-01-10T08:41:16.291Z [INFO] Worker state changed { state: 'STOPPED' }
thread 'core' panicked at 'Workflow processing terminates cleanly: Error joining workflow processing thread: Ok("Hash table capacity overflow")', sdk-core/core/src/worker/mod.rs:409:14
 96 |         }
 97 |         this.shutDownRequested = true;
 98 |         await this.send({ type: 'destroy' });
 99 |         const exitCode = await this.workerThread.terminate();
100 |         if (exitCode !== exports.TERMINATED_EXIT_CODE) {
101 |             throw new core_bridge_1.UnexpectedError(`Failed to terminate Worker thread, exit code: ${exitCode}`);
                                      ^
```

### Additional context

Both Temporal and bun are really amazing. Since bun provide many out-of-box features and better performance than node.js, It would be great if temporal sdk can support bun worker. 


#### Comments (46)

<details>
<summary><strong>izakfilmalter</strong> commented on 2024-01-11 17:40:38.000 UTC</summary>

Would love to use bun instead!!!!

Reactions: üëç 8

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-01-12 19:19:17.000 UTC</summary>

We know what we need to do to get the SDK working on bun but it'll be a significant lift and may not be prioritized just yet.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-01-12 19:19:43.000 UTC</summary>

I too hope we will support more JS runtimes including bun and deno.

Reactions: üëç 3

</details>

<details>
<summary><strong>brettgoulder</strong> commented on 2024-01-26 22:19:51.000 UTC</summary>

nodejs recommends [against using createHook](https://nodejs.org/api/async_hooks.html#async-hooks):

[Stability: 1](https://nodejs.org/api/documentation.html#stability-index) - Experimental. Please migrate away from this API, if you can. We do not recommend using the [createHook](https://nodejs.org/api/async_hooks.html#async_hookscreatehookcallbacks), [AsyncHook](https://nodejs.org/api/async_hooks.html#class-asynchook), and [executionAsyncResource](https://nodejs.org/api/async_hooks.html#async_hooksexecutionasyncresource) APIs as they have usability issues, safety risks, and performance implications. Async context tracking use cases are better served by the stable [AsyncLocalStorage](https://nodejs.org/api/async_context.html#class-asynclocalstorage) API. If you have a use case for createHook, AsyncHook, or executionAsyncResource beyond the context tracking need solved by [AsyncLocalStorage](https://nodejs.org/api/async_context.html#class-asynclocalstorage) or diagnostics data currently provided by [Diagnostics Channel](https://nodejs.org/api/diagnostics_channel.html), please open an issue at https://github.com/nodejs/node/issues describing your use case so we can create a more purpose-focused API.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-01 18:36:48.000 UTC</summary>

The SDK uses v8 promise hooks `createHook`, not async hooks.
We need this functionality for showing workflow stack traces.

</details>

<details>
<summary><strong>loicnestler</strong> commented on 2024-03-30 20:47:24.000 UTC</summary>

Any updates on this? üëÄ 

Reactions: üëÄ 1

</details>

<details>
<summary><strong>maurovanetti</strong> commented on 2024-04-03 08:47:57.000 UTC</summary>

In case someone wondered: No, Bun 1.1.0 (out since Monday) does not support Temporal yet. :disappointed: 

```
error: node:v8 createHook is not yet implemented in Bun.
      at new NotImplementedError (internal:shared:20:28)
      at internal:shared:3:70
      at node:v8:3:46
      at node:v8:77:30
      at setPromiseHook (/home/mauro/Codice/in4matic/bun/temporal/node_modules/@temporalio/worker/lib/workflow/vm-shared.js:208:33)
      at install (/home/mauro/Codice/in4matic/bun/temporal/node_modules/@temporalio/worker/lib/workflow/vm-shared.js:140:13)
      at /home/mauro/Codice/in4matic/bun/temporal/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js:139:8
      at create (/home/mauro/Codice/in4matic/bun/temporal/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js:138:21)
      at /home/mauro/Codice/in4matic/bun/temporal/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:10:36
      at handleRequest (/home/mauro/Codice/in4matic/bun/temporal/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:6:35)
```

</details>

<details>
<summary><strong>hscj87</strong> commented on 2024-06-10 09:13:50.000 UTC</summary>

> nodejs recommends [against using createHook](https://nodejs.org/api/async_hooks.html#async-hooks):
> 
> [Stability: 1](https://nodejs.org/api/documentation.html#stability-index) - Experimental. Please migrate away from this API, if you can. We do not recommend using the [createHook](https://nodejs.org/api/async_hooks.html#async_hookscreatehookcallbacks), [AsyncHook](https://nodejs.org/api/async_hooks.html#class-asynchook), and [executionAsyncResource](https://nodejs.org/api/async_hooks.html#async_hooksexecutionasyncresource) APIs as they have usability issues, safety risks, and performance implications. Async context tracking use cases are better served by the stable [AsyncLocalStorage](https://nodejs.org/api/async_context.html#class-asynclocalstorage) API. If you have a use case for createHook, AsyncHook, or executionAsyncResource beyond the context tracking need solved by [AsyncLocalStorage](https://nodejs.org/api/async_context.html#class-asynclocalstorage) or diagnostics data currently provided by [Diagnostics Channel](https://nodejs.org/api/diagnostics_channel.html), please open an issue at https://github.com/nodejs/node/issues describing your use case so we can create a more purpose-focused API.

How to disable using createHook to avoid this error?

</details>

<details>
<summary><strong>andreyvital</strong> commented on 2024-06-19 13:35:39.000 UTC</summary>

I have the same question as @hscj87 and the same request as the original issue text. Commenting just to bump up this thread.

</details>

<details>
<summary><strong>axe-me</strong> commented on 2024-09-22 05:55:43.000 UTC</summary>

it would be great to be able to run temporal worker with bun!

</details>

<details>
<summary><strong>tenkoverse</strong> commented on 2024-10-02 22:59:51.000 UTC</summary>

@bergundy Deno 2 has removed promiseHooks stubs (https://github.com/denoland/deno/issues/25977) to provide an environment where temporals check for promiseHooks is skipped https://github.com/temporalio/sdk-typescript/blob/faa64225a7f57154931a38c1fe612fc6520943b2/packages/worker/src/workflow/vm-shared.ts#L199-L202

I now have temporal clients and workers successfully working in deno 2. 

I would love to know the implications for having an enviroment where there are no promise hooks. What do I lose using deno to run a temporal worker instead of using node (with version >=16.14)

Reactions: üëÄ 7

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-10-03 18:12:43.000 UTC</summary>

We use promise hooks to capture stack traces that are used in the stack trace query feature that gives visibility into where your workflow is blocked at any given point.

Reactions: üëç 3

</details>

<details>
<summary><strong>zammitjames</strong> commented on 2025-01-18 20:29:01.000 UTC</summary>

+1 - not supporting bun has forced us to look elsewhere.

</details>

<details>
<summary><strong>maurovanetti</strong> commented on 2025-01-23 17:43:10.000 UTC</summary>

**Bun 1.2** is out today. Finally, they declare support for `http2`!

I'm trying to set up Temporal with Bun 1.2 and it seems to go further than before. I have connected a client to my Temporal server, and started a workflow. Unfortunately, the NativeConnection for the worker is hanging forever, though, with no error raised.

Has anyone managed to go beyond this?

Reactions: üëç 2

</details>

<details>
<summary><strong>cortopy</strong> commented on 2025-01-26 17:29:03.000 UTC</summary>

Mine also hangs, although I get to see a very cryptic log entry `error: Error (via napi)`. I assume it's something to do with node api compat, but this just leaves me guessing

Reactions: üòï 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-02-07 16:02:25.000 UTC</summary>

I think the `@temporalio/client` package works fine at this point, though I really have to point out that we do not perform regular testing for that runtime. Using this setup in production would not be advisable.

Regarding Worker support, we certainly hope to get there, but we are not actively working in that direction just now. It is simply too early for that.

For example, the "NativeConnection hanging forever" and "error: Error (via napi)" symptoms mentioned above are due to a difference in [how bun checks the error argument on napi_throw](https://github.com/oven-sh/bun/blob/1fa42d81af0806cf06ca9dc050bf06046c3a4b41/src/bun.js/bindings/napi.cpp#L1644-L1659) vs [what's done in Node](https://github.com/nodejs/node/blob/5fad0b93667ffc6e4def52996b9529ac99b26319/src/js_native_api_v8.cc#L1924-L1934). That breaks the method that [Neon Binding](https://github.com/neon-bindings/neon/blob/7f4feb10631cfd3e654112d42a3b5ed472f851e8/crates/neon/src/sys/no_panic.rs#L135-L137) uses to check either it is safe to call back into the JS environment at that time.

It is not worth fixing that issue in upstream projects just yet. Bun's team is already doing some awesome bug hunting work on their NAPI implementation. See for example https://github.com/oven-sh/bun/pull/14501 and https://github.com/oven-sh/bun/pull/16230. I'd expect a few rounds like these, so let's give them time to complete their efforts first, and then for other key dependencies to stabilize.

Reactions: üëç 9

</details>

<details>
<summary><strong>harrytran998</strong> commented on 2025-03-25 14:41:55.000 UTC</summary>

@mjameswh So do you have any progress here? The client can fire but the worker cannot exec now. Thanks

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-04-08 16:53:12.000 UTC</summary>

bump, would love to jump over to Bun with projects, that's the last blocker though üôà 

Reactions: ‚ù§Ô∏è 5

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-04-26 23:08:05.000 UTC</summary>

^^^ big tnx to @x04. We're getting further with this.

Running bun on canary does enable the worker, however when a workflow is picked up the following error is thrown:
```
2025-04-26T23:03:11.807Z [ERROR] Failed to process Worklow Activation {
  sdkComponent: 'worker',
  taskQueue: 'hello-world',
  runId: '01967457-2a90-7845-a719-e13197b85375',
  namespace: 'default',
  workflowId: 'test',
  workflowType: 'testWorkflow',
  error: TypeError: undefined is not an object (evaluating 'this.activator.getAndResetSinkCalls')
      at getAndResetSinkCalls (/temporaltest/node_modules/@temporalio/worker/lib/workflow/vm-shared.js:262:21)
      at getAndResetSinkCalls (/temporaltest/node_modules/@temporalio/worker/lib/workflow/vm-shared.js:261:34)
      at handleRequest (/temporaltest/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:61:42)
      at handleRequest (/temporaltest/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:23:32)
      at <anonymous> (/temporaltest/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:38)
      at <anonymous> (/temporaltest/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:90:33),
  workflowExists: true
}
```

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-04-27 10:37:22.000 UTC</summary>

Adding on top of the previous comment.

I have set up a new project using the [core application docs](https://docs.temporal.io/develop/typescript/core-application#install-a-temporal-sdk)

I used the following command:
```sh
npx @temporalio/create@1.11.7 testbundle -s hello-world --sdk-version 1.11.7 --no-git-init
```

I ran the worker with Bun:
```sh
bun run src/worker.ts
```

And ran the client to initiate a workflow:
```sh
bun run src/client.ts
```

The workflow isn't being picked up by the worker. (it gets assigned, but no actual work is being done).
No errors are visible in worker's stdout.

Reactions: üëç 2

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-05-04 17:15:29.000 UTC</summary>

Got a little bit further by modifying the `ReusableVMWorkflowCreator.createWorkflow` method (the `setActivatorUntyped` does not always work for some reason - as in: does not set the activator correctly).

Got blocked however at the last final step -> workflow's execution cannot be completed ü§∑ -- the logs are silent.
The only suspicion I have is, that there is something wrong within this handler: 
```ts
await this.nativeWorker.completeWorkflowActivation(completion.buffer.slice(completion.byteOffset))
``` 
but I can not easily debug it.

I have also tried with running the latest code (post January's 1.11.7 release), but ended up with the same issues.

Bun version: 1.2.11


![Image](https://github.com/user-attachments/assets/8a78d917-f7c8-4578-a717-7a0f8507014a)

Reactions: üëç 1

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-05-06 15:30:11.000 UTC</summary>

Update:

Bun version: 1.2.12 didn't change a thing (workflow's execution still cannot be completed)

// EDIT 2025-05-13:

Bun version: 1.2.13, same as above

// EDIT 2025-05-23

Bun version: 1.2.14, same as above

// EDIT 2025-05-28

Bun version: 1.2.15, same as above

Tested both SDK versions: 1.11.7 & 1.11.8

Reactions: üëç 9

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-30 05:13:16.000 UTC</summary>

Thanks a lot @d2201 for all this testing, and thanks @x04 for pushing the NAPI fix to bun!

I unfortunately can't put time investigating this myself just now, but really appreciate the community effort.

@d2201: Regarding your tests above, there are quite a lot of moving parts involved.

To simplify things a bit, I'd suggest trying to add `debugMode: true` to your worker options. That will force the worker into single thread mode, thus avoiding use of the `node:worker_threads` module.

You should also set `reuseV8Context: false`, which will force creation of a distinct vm context for each workflow execution. That execution mode is known to be significantly less efficient and increases memory usage (or at least, that's true in Node; I wouldn't be surprised if performance profile turns out to be very different in Bun and Deno), but follows a much simpler execution model that is less likely to trigger edge cases in a "node-compatibility" implementation.

Also make sure to set Runtime's log level to `TRACE` and turn on Core's log forwarding:

```
    Runtime.install({
      logger: new DefaultLogger('TRACE'),
      telemetryOptions: { logging: { forward: {}, filter: makeTelemetryFilterString({ core: 'TRACE' }) } },
    });
```

You may also want to experiment with the code on the main branch of the TS SDK repo, rather than the 1.11.8. Several key components of the SDK went through some significant work, including a major refactor of the native bridge layer, and multiple significant fixes in the Worker and Workflow Sandbox.

I can't promise that these changes will immediately get us closer to the goal of running a Temporal Worker on Bun, and can't exclude the possibility that they might even add some more challenges due to the use of some additional NAPI features‚Ä¶ But I honestly hope that the more robust design and better error handling will make it easier to progress forward.

While on that branch, you may also try setting environment variables `TEMPORAL_TRACE_NATIVE_CALLS=true` and `RUST_BACKTRACE=full`. Beware that the Trace Native Calls env variable may produce a huge amount of logs; it is really meant only for low level debugging of the bridge layer, but at this point, that's indeed what you are doing.

Reactions: ‚ù§Ô∏è 5

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-05-31 23:16:36.000 UTC</summary>

@mjameswh Thank you for this summary. It helped me a lot.

I think it's not the NAPI issue anymore.

## Environment information

```
SDK (commit: caae0a4eec4ed489c53f102b04f7d4afde318c5b) (1.12.0-rc)
Node v22.4.0
Bun v1.2.15
```

## Investigation results

The debug helped me with understanding what's going on (at least to some degree). It all boils down (in my opinion) to the Bun's compatibility with `node:vm`.

### So what's happening?

There seems to be some sort of race condition happening.

High-level of how Node does the part of completion:
```
- runs `activate` function within the workflow vm context
- workflow gets completed (I've put console.log statements all over the place, and I see the workflow results in there)
- `activate` function ends
- ... bunch of other things in the process run
- the completion is being sent out to the `core` with `successful.commands` containing the `completeWorkflowExecution` command.
```

High-level of how Bun does the part of completion:
```
- runs `activate function withing the workflow vm context
- `activate` function ends
- ... bunch of other things in the process run
- the completion is being sent out to the `core` with `successful.commands` being empty
- I see the console logs from workflow results
```

I am not sure yet how to solve it.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-02 16:51:41.000 UTC</summary>

> ```
> - runs `activate function withing the workflow vm context
> - `activate` function ends
> - ... bunch of other things in the process run
> - the completion is being sent out to the `core` with `successful.commands` being empty
> - I see the console logs from workflow results
> ```

If I understand correctly what you describe, it looks like Bun's `vm` implementation is interleaving microtasks from inside and outside the `vm`.

The JS engine is expected to maintain a distinct event queue for inside the VM, detached from the main event queue. Also, given the `microtaskMode: 'afterEvaluate'` option on `vm.createContext()`, the engine should wait for all microtasks on that inside event task queue to drain before returning from a `vm.runInContext()` call.

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-06-02 19:09:57.000 UTC</summary>

Yup, I'll try to reproduce this issue in a more controllable environment and will report it to Bun's maintainers.

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-06-02 19:27:45.000 UTC</summary>

Got it! Reported: https://github.com/oven-sh/bun/issues/20145

Reactions: üöÄ 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-02 21:21:26.000 UTC</summary>

> The JS engine is expected to maintain a distinct event queue for inside the VM, detached from the main event queue. Also, given the microtaskMode: 'afterEvaluate' option on vm.createContext(), the engine should wait for all microtasks on that inside event task queue to drain before returning from a vm.runInContext() call.

By the way, we [used to have a patch](https://github.com/temporalio/sdk-typescript/blob/49c6b1341daef2b94a0a989d515cbf97b8b02fa7/packages/worker/src/workflow/vm-shared.ts#L359-L365) for that, because the `microtaskMode: 'afterEvaluate'` only got added in Node 14.6. It was removed when we stopped maintaining that older release.

You may try to restore that patch and see if that gets you a bit farther.

Reactions: üëÄ 1

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-06-03 21:47:27.000 UTC</summary>

I think we've got it @mjameswh. Thank you for the guidance! üéâ 

Any chance we can go back to that patch, or should we just wait for bun to fix this incompatibility?

Verified also that I can safely remove the `reuseV8Context` flag, but the `debugMode` needs to be kept `true`.

![Image](https://github.com/user-attachments/assets/356047a8-d4f4-4098-b7be-c5d31521e584)

![Image](https://github.com/user-attachments/assets/c1e4d1c9-2205-4882-9f34-5cd1a91af786)

</details>

<details>
<summary><strong>liho00</strong> commented on 2025-06-22 19:03:23.000 UTC</summary>

@d2201 but its seems only pick up first activity, the rest of activities are not running on bun, tested many many times

</details>

<details>
<summary><strong>liho00</strong> commented on 2025-06-22 19:05:00.000 UTC</summary>

@mjameswh how can we add that patch?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-23 16:37:33.000 UTC</summary>

> Any chance we can go back to that patch, or should we just wait for bun to fix this incompatibility?

I don't have any objection to reintroduce the patch, but we'll have to think of a good way to conditionally enable or disable it. We previously just checked for Node's release number, but I don't want to rely on that kind of things if the goal is to support multiple JS runtimes.

We'll also need to confirm that all aspects of the sandbox still work correctly with that patch. The sandboxing code has gone through some significant changes since that patch was removed. It is possible that this patch might no longer be reliable.

Reactions: üëç 2

</details>

<details>
<summary><strong>d2201</strong> commented on 2025-06-24 19:53:58.000 UTC</summary>

> but its seems only pick up first activity, the rest of activities are not running on bun, tested many many times

@liho00 I didn't test this beyond the `hello world` sample, as it's too unstable to do anything more than that. Once the two runtimes start to behave similarly (without additional flags & custom patches), we can move on to testing other use cases.

> We previously just checked for Node's release number, but I don't want to rely on that kind of things if the goal is to support multiple JS runtimes.

Agreed.

My take is that Bun isn't stable enough for now, and anyone who uses Bun for more than basic CRUD examples knows that. The `node:vm` module is considered stable in Node, so every runtime that tries to be a "drop-in Node replacement" should at least implement all stable APIs from Node.

The patch itself might do more harm than good, and even with it:

>We'll also need to confirm that all aspects of the sandbox still work correctly with that patch. The sandboxing code has gone through some significant changes since that patch was removed. It is possible that this patch might no longer be reliable.

That remains a concern.

After all, I'm just a follower - not sure how important is it to others here - but for me Bun is mostly a convenience rather than a game changer. IMO, there are bigger DX fish to fry in the SDK, and I'd passively wait until Bun catches up. Nevertheless, I'll keep updating here as things progress, so others can have more visibility into the latest state of this issue.

Reactions: ‚ù§Ô∏è 8

</details>

<details>
<summary><strong>kwypchlo</strong> commented on 2025-08-03 12:41:48.000 UTC</summary>

I was super excited about temporal solving my issues and introducing durability in my company workflows but we're running with bun and can't really easily migrate over to node. I'm looking forward to trying temporal once this gets resolved. FWIW thank you everyone for looking into this.

Reactions: üëç 15

</details>

<details>
<summary><strong>zammitjames</strong> commented on 2025-09-26 01:37:14.000 UTC</summary>

It's insane that this hasn't been implemented yet. 

</details>

<details>
<summary><strong>zeonglow</strong> commented on 2025-10-11 22:56:37.000 UTC</summary>

If any was wondering,   Bun 1.3 doesn't do it either.

I'd never heard of Promise createHook before,  but it sounds like it would be *much* easier for Bun to implement this rather than rewrite large sections of Temporal.  Assuming that's the only issue of course üòÇ

```
Welcome to Bun v1.3.0
Type ".help" for more information.
[!] Please note that the REPL implementation is still experimental!
    Don't consider it to be representative of the stability or behavior of Bun overall.
> import { promiseHooks } from 'node:v8';
undefined
> promiseHooks.createHook({init: console.log})
111 | }
112 | function setHeapSnapshotNearHeapLimit() {
113 |   notimpl("setHeapSnapshotNearHeapLimit");
114 | }
115 | var promiseHooks = {
116 |     notimpl("createHook");
                             ^
NotImplementedError: node:v8 createHook is not yet implemented in Bun.
 code: "ERR_NOT_IMPLEMENTED"

      at createHook (node:v8:116:12)
```

Reactions: üëç 7

</details>

<details>
<summary><strong>elonsalfati</strong> commented on 2025-10-19 08:38:17.000 UTC</summary>

Did someone tag @Jarred-Sumner on this? 

Would be super great to make this work on bun!

Reactions: üëç 12

</details>

<details>
<summary><strong>rajasekarshanmugam</strong> commented on 2025-11-27 15:45:28.000 UTC</summary>

Tried on bun 1.3.3 - Hello world sample. 

worker - bun, client - bun = client waits for wf to execute and the worker is not picking the execution. 

worker - nodejs, client - bun = works.

Anybody had any luck with running temporal only with bun - both worker as well as client and/or some trick to get past? 

Reactions: üëç 4

</details>

<details>
<summary><strong>nicu-dev</strong> commented on 2025-12-02 08:01:54.000 UTC</summary>

@rajasekarshanmugam it's fine, bun probably not a priority for the team now, npm wasn't hacked THAT many times yet.

Reactions: üòï 2

</details>

<details>
<summary><strong>BrianEstrada</strong> commented on 2025-12-02 12:31:16.000 UTC</summary>

Ended up switching to using another provider for bun compatibility, would be really happy to look at Temporal again once they get support for this :)

Reactions: üòï 1

</details>

<details>
<summary><strong>hckhanh</strong> commented on 2025-12-02 12:52:08.000 UTC</summary>

> Ended up switching to using another provider for bun compatibility, would be really happy to look at Temporal again once they get support for this :)

Which one do you use? @BrianEstrada 

Reactions: üëç 2

</details>

<details>
<summary><strong>BrianEstrada</strong> commented on 2025-12-03 18:57:51.000 UTC</summary>

@hckhanh don't want to promote another service here on Temporal's repo but it's one of the top 4 google search results for `durable workflows`

</details>

<details>
<summary><strong>rajasekarshanmugam</strong> commented on 2025-12-15 17:31:29.000 UTC</summary>

are there any pointers where to look for the isolate support in temporal..?

</details>

<details>
<summary><strong>slavb18</strong> commented on 2025-12-20 17:02:58.000 UTC</summary>

> [@hckhanh](https://github.com/hckhanh) don't want to promote another service here on Temporal's repo but it's one of the top 4 google search results for `durable workflows`

Is there option to convert temporal processes to another workflow engine ?

</details>

<details>
<summary><strong>hckhanh</strong> commented on 2025-12-20 18:25:26.000 UTC</summary>

I am afraid that there was not

</details>

<details>
<summary><strong>zeonglow</strong> commented on 2025-12-22 04:23:02.000 UTC</summary>

Thinking on this further; Temporal *should not* work on making the app work with other runtimes.

The reason: temporal isn't about doing lots of things super fast, Bun is optimised for speed and latency and Temporal isn't.

Development resources are always limited; having different runtimes multiples complexity. More things to test, more reasons not to fix stuff.

IMHO the fix would be to change the website so it says "NodeJS" rather than "Typescript"


Reactions: üëé 5

</details>


---

<a id="1755"></a>

### #1755: [Feature Request] Temporal integration for `@openai/agents`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1755 |
| **State** | OPEN |
| **Author** | corelix (Dmytro Pylypenko) |
| **Created** | 2025-07-31 18:35:54.000 UTC (5 months ago) |
| **Updated** | 2026-01-03 21:25:45.000 UTC |
| **Upvotes** | 20 |
| **Comments** | 8 |
| **Priority Score** | 48 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 20 ‚ù§Ô∏è 6 üëÄ 6 |

#### Description

##  Request

We would like an official **Temporal integration for the OpenAI Agents SDK in JavaScript/TypeScript**, analogous to the existing `OpenAIAgentsPlugin` for the Python SDK.

###  Background

Temporal + OpenAI Agents SDK (Python) released an integration that enables:

- Durable state persistence  
- Fault recovery and retry logic  
- Observability (tracing / audit trails)  
- Scalable agent execution  
- Cost saving by avoiding redundant LLM calls 

In the Python ecosystem, developers can simply plug in `OpenAIAgentsPlugin` to enable agent orchestration inside Temporal workflows.

### ‚ùì Is this on your roadmap?

Does the Temporal team plan to release official support for **openai-agents-js**? If so‚Äîdo you have an ETA or early preview we could try?

#### Comments (8)

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-31 18:51:37.000 UTC</summary>

Thanks for asking.

This is indeed on our roadmap, but I unfortunately don't have an ETA I can share at the moment.

Reactions: ‚ù§Ô∏è 4 üöÄ 16 üëÄ 6

</details>

<details>
<summary><strong>syuan100</strong> commented on 2025-08-28 23:33:11.000 UTC</summary>

+1 on this!

Reactions: üëç 1

</details>

<details>
<summary><strong>bruno-schema52</strong> commented on 2025-09-13 18:07:00.000 UTC</summary>

+1 on this!

Reactions: üëç 1

</details>

<details>
<summary><strong>Maximgitman</strong> commented on 2025-09-19 23:18:18.000 UTC</summary>

Looking forward for this integration

Reactions: üëç 1

</details>

<details>
<summary><strong>fernando-playplay</strong> commented on 2025-11-18 14:16:35.000 UTC</summary>

Looking forward for this integration here as well

Reactions: üëç 1

</details>

<details>
<summary><strong>marc-wilson</strong> commented on 2025-12-02 19:26:04.000 UTC</summary>

@mjameswh has there been any new updates around an ETA?

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-12-02 20:13:36.000 UTC</summary>

The first AI agents library we're integrating with in TS is [ai](https://www.npmjs.com/package/ai). The [PR](https://github.com/temporalio/sdk-typescript/pull/1792) is in review, so it should hopefully land soon.

I really don't have an ETA or even the relative prioritization for any other specific AI library.

Reactions: üëç 2 üòï 1

</details>

<details>
<summary><strong>bakikucukcakiroglu</strong> commented on 2026-01-03 21:25:45.000 UTC</summary>

This is very much needed in `openai-agents-js`.

Reactions: üëç 2

</details>


---

<a id="483"></a>

### #483: [Feature Request] NestJS Transport / Integration?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/483 |
| **State** | OPEN |
| **Author** | StevenLangbroek (Steven Langbroek) |
| **Created** | 2022-02-17 08:35:40.000 UTC (3y 10m ago) |
| **Updated** | 2025-06-22 17:35:33.000 UTC |
| **Upvotes** | 4 |
| **Comments** | 37 |
| **Priority Score** | 45 |
| **Labels** | enhancement, ecosystem-and-integrations |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 4 |

#### Description

### Is your feature request related to a problem? Please describe.

It's more of a question: Temporal's Typescript SDK seems like it would maybe be a good fit as a NestJS Module, is this something there'd be interest in exploring? I'd need to spend a little bit of time on it but I'd love to validate whether it would work with a PoC, and see what kind of API we'd end up with.

### Describe the solution you'd like

I'd just like to understand whether there's interest at this point, so I can invest some of my own time in exploring this.

### Additional context

I would imagine an API to look something like (based on the [Java Example](https://github.com/temporalio/samples-java/blob/main/src/main/java/io/temporal/samples/bookingsaga/TripBookingWorkflowImpl.java)):

```ts
@Workflow()
export class TripBookingWorkflow implements Workflow {
  @InjectActivities({
    startToCloseTimeout: ms("1hr"),
    retryOptions: {
      maxAttempts: 1,
    },
  })
  activities: TripBookingActivities;

  public async execute(name: string): Promise<void> {
    const saga = new Saga({
      parallelCompensation: true,
    });

    try {
      const carReservationId = this.activities.reserveCar(name);
      saga.addCompensation(this.activities.cancelCar, carReservationId);

      const hotelReservationId = this.activities.bookHotel(name);
      saga.addCompensation(this.activities.cancelHotel, hotelReservationId);

      const flightReservationId = this.activities.bookFlight(name);
      saga.addCompensation(this.activities.cancelFlight, flightReservationId);
    } catch (err) {
      saga.compensate();
      throw err;
    }
  }
}
```

## Supporting arbitrary frameworks

By testing whether the module loaded from `workflowsPath` exports a function as its default export, we can run ~& potentially await that function,~ (should be fine without this, given that it's an async function we can just return the promise) and then return it. This would put a contract on the return value though (`Record<WorkflowName, WorkflowFn>`), we should document that.

```ts
      api.setImportFuncs({
        importWorkflows: async () => {
          let workflows = await import(/* webpackMode: "eager" */ ${JSON.stringify(this.workflowsPath)});
          if (typeof workflows.default === 'function') {
              workflows = workflows.default();
          }
          return workflows;
        },
      });
```

**update**: ‚òùÔ∏è this works ü•≥ 

<img width="1144" alt="image" src="https://user-images.githubusercontent.com/296796/159109882-d8f48b26-1dfe-4057-b37f-694a0eeb9219.png">

exporting an async function works too:

![image](https://user-images.githubusercontent.com/296796/159109966-198b4cbf-e571-4bc2-bb5e-b4bb3d900095.png)

## To do

- [x] Discuss desired API
- [x] If `worfklowsPath` exports a function as its `default`, await & return the result of that function.
- [ ] Develop proof of concept
- [ ] Test out third-party Nest plugins that depends on custom file formats
- [ ] ??? 
- [ ] Profit

## Design

### Principles

1. NestJS supports both monolithical applications, as well as smaller "microservices" (I don't mean the alternative transport layers Nest supports, I just mean smaller more focussed, independently deployable applications), and we should not make assumptions about this
2. Registering _Workflows & Workers_ through Nest's module system will, in the majority of cases, lead to undesirable outcomes; i.e., unintentionally doing things that have side effects or non-determinism and will break in subtle and hard to find ways.
3. The APIs we design should feel familiar to NestJS developers, without incorrectly implying compatibility. We should warn users when they make mistakes, and document tradeoffs front and centre.

### Operations

If you follow NestJS's design recommendations, your codebase should be split, roughly speaking, among domain lines by way of NestJS's module system. However, a single NestJS module might correlate to many Workers. [WIP]

#### Comments (37)

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-02-17 08:46:18.000 UTC</summary>

I think this could be good for Temporal because of what NestJS brings to the table;

- Application lifecycle hooks instead of homegrown solutions
- Ecosystem & Dependency Injection into Activities
- Separation of concerns
- Testability

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-17 17:47:15.000 UTC</summary>

I think such an integration could be valuable.

I don't know if we'll want this as part of the SDK repo. It should probably start out as an external package.

I'd be happy to review what you come up with.


</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-02-18 10:09:33.000 UTC</summary>

@bergundy totally fair! would you be willing to help me iterate on the API a few rounds before starting a proof-of-concept?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-23 00:18:25.000 UTC</summary>

Hi,
Sorry for the late reply, sure, feel free to ping me when you have something.

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-12 20:22:29.000 UTC</summary>

@bergundy so, I've looked at this and I don't think we can achieve this fully in userland; however, this is based on my limited understanding of the `worker` and `core-bridge` packages. I've worked with NestJS enough to understand that side of the equation, but would someone maybe be available to help me understand `core-bridge` and how it interacts with the bundle that you're producing with webpack from `worker`?

(I'm in the community Slack btw)

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-14 06:46:53.000 UTC</summary>

To the best of my understanding we'd have to do something like this [here](https://github.com/temporalio/sdk-typescript/blob/b52999382ea72bc0bac45ed37cfaa9daf4bc6336/packages/worker/src/workflow/bundler.ts#L93-L95):

```ts
class NestWorkflowCodeBundler implements WorkflowCodeBundler {
  protected genEntryPoint(/* ... */) {
    return dedent`
      // ...
      api.setImportFuncs({
        importWorkflows: async () => {
          const { bootstrap } = await import(/* webpackMode: "eager" */ ${JSON.stringify(this.workflowsPath)});
          const app = await bootstrap();
          return app.get(WorkflowRegistry).getWorkflows();
        }
      });
    `
  }
}
```

Does that make sense @bergundy?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-14 16:32:41.000 UTC</summary>

This makes sense.
We need to figure out how to make workflow bundling more extensible.
If you can get this to work, we'll make sure to add support in the SDK.

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-14 19:54:57.000 UTC</summary>

@bergundy what's the ideal api here here from your perspective? Should the workflowPath option be supplemented with an (optional) initializer function, that receives the resolved module from `workflowPath` and needs to return `Record<WorkflowName, WorkflowImplementation>`? It feels more Javascript native than implementing a Strategy pattern or some such... 

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-15 18:03:27.000 UTC</summary>

@bergundy what's the ideal api here here from your perspective? Should the workflowPath option be supplemented with an (optional) initializer function, that receives the resolved value from `importFuncs` and needs to return `Record<WorkflowName, WorkflowImplementation>`? It feels more Javascript native than implementing a Strategy pattern or some such...

Or maybe we need to revisit the entry point template approach? 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-15 18:33:32.000 UTC</summary>

The Worker (and bundler) accepts `workflowsPath` because workflows run in a [vm](https://nodejs.org/api/vm.html) instead of in the same JS environment as the worker and activities.
We've used "exporting" as the way to register workflows because it's something every dev is familiar with and it automatically handles deduping of workflow names, it's also very convenient for when you want to reference a workflow function for type inference with a client.
We could allow customizing this the way you're suggesting, not sure about the details, I'm sure it'll become clearer as this feature is fleshed out.

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-17 19:36:23.000 UTC</summary>

_Disclaimer: I don't know anything about `nestjs`; just sharing some insights_

If you think that this should work:

```
      api.setImportFuncs({
        importWorkflows: async () => {
          const { bootstrap } = await import(/* webpackMode: "eager" */ ${JSON.stringify(this.workflowsPath)});
          const app = await bootstrap();
          return app.get(WorkflowRegistry).getWorkflows();
        }
      });
```

... then wouldn't this work too:

```
      api.setImportFuncs({
        importWorkflows: async () => {
          let workflows = await import(/* webpackMode: "eager" */ ${JSON.stringify(this.workflowsPath)});
          if (typeof workflows.default === 'function') {
              workflows = await workflows.default();
          }
          return workflows;
        },
      });
```

... assuming that `workflowsPath` points to a file containing something similar to this:

```
    export default async function getMyWorkflows() {
        return await bootstrap().get(WorkflowRegistry).getWorkflows();
    }
```

The main point here is that the bundler's template may not need to contain any nestjs-specific logic.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-18 00:20:17.000 UTC</summary>

That's a great suggestion @mjameswh.
I'd definitely accept a default function export.

Reactions: üëç 1

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-18 06:22:20.000 UTC</summary>

Yep that's much cleaner than [my idea](https://github.com/temporalio/sdk-typescript/issues/483#issuecomment-1067225455), good idea @mjameswh! So let me stop wasting time on upfront API design work on the Nest side then, this is a small first step that's good to start with. I'll open a Draft PR this weekend. Thanks!

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-18 14:11:20.000 UTC</summary>

> So let me stop wasting time on upfront API design work on the Nest side then, this is a small first step that's good to start with. I'll open a Draft PR this weekend.

@StevenLangbroek Glad it helps. Once this is in place, it will be much easier for you and others to propose/iterate/test potential designs for nestjs' integration.

One thing of which I'm uncertain though is either nestjs' DI will actually work inside the vm context. As you know, your original workflow code (including all of its dependencies) is bundled using webpack... that bundle is _plain JavaScript_, and is all that is available inside the vm context.

Hopefully, it might be sufficient to enable `emitDecoratorMetadata` in your project's `tsconfig.json`, so that decorators metadata are kept in bundled JavaScript files... But I can image a few things that could pose extra difficulties:

- Does nestjs' DI engine scan files on disk at runtime (ie. to automatically locate providers of a given interface)? That would be impossible inside the vm.

- Will webpack properly detect metadata-based references to other classes, and will it keep everything intact, or will it consider these objects/functions/properties to be unused and prune them from the final bundle?

- Does nestjs' engine depends any nodejs's builtin packages at runtime? nestjs describe itself as a framework for server-side applications. That means that it is expected to be run inside nodejs, with everything that goes with it... But node's vms are actually far enough from regular nodejs execution context.

Again, these may or may not be actual issues, and some of these could be worked out... But you will have to get there before you know.

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-18 14:15:10.000 UTC</summary>

@mjameswh nest also allows bundling through webpack, all you need is reflect-metadata and I think tslib.

Guess we'll find out huh? üòé

Reactions: üëç 1

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-18 14:35:30.000 UTC</summary>

Hmmmm you actually raise an interesting point here @mjameswh. Nest itself isn't the problem, but there's extensions that you can provide globPaths and the like (e.g., for Entities), and nest takes care of moving them into the right path, but not necessarily loading them I believe (deferring that to Node runtime)... Noted in issue, thanks!

</details>

<details>
<summary><strong>eplarson</strong> commented on 2022-03-19 00:47:31.000 UTC</summary>

Wanted to chime in here since I'm actively integrating the Temporal SDK into a multi-module Nest app. For us, multi-module means that we want workflows, workers, and activities that are local to a module (not global for the whole app). Our app is quite large and a central location for these things would get out of hand pretty fast. Hoping my experience with the current version (0.19) adds some insight.

Activities are pretty easy to integrate right now. I just used a factory provider and registered it with the module:

```typescript
export const ActivityFactory = () => ({
  sayHello: async (user: User) => {
    return `Hello, ${user.firstName} ${user.lastName}!`;
  },
});

// Provider to make activities available within Nest's DI context
export const ActivityProvider: FactoryProvider = {
  provide: "ACTIVITIES_PROVIDER",
  inject: [],
  useFactory: ActivityFactory,
};
```

I haven't tried it yet, but I think it wouldn't be too hard to write an `@Activity()` decorator that registered activity functions and passed them via factory provider to the worker and injected into the workflows.

In my workflows I have this:
```typescript
const { sayHello } = proxyActivities<ReturnType<typeof ActivityFactory>>({
  startToCloseTimeout: "30 seconds",
  retry: { initialInterval: "2s", backoffCoefficient: 2 },
});

export async function greetUser(user: User): Promise<void> {
  await sayHello(user);
}
```

The worker is trickier:
```typescript
@Injectable()
export class ChatWorker extends BaseTemporalWorker {
  constructor(
    @Inject("ACTIVITIES_PROVIDER") private readonly activities: ActivityInterface,
    configFactory: WorkerConfigFactory
  ) {
    super();

    this.config = configFactory.createConfig(activities, "../../chat/temporal/workflows", /* task queue name */ "chat");
  }
}
```

That `../../chat/temporal/workflows` is because we have a common module (the `Temporal` module) that houses some helpers to reduce boilerplate. One of these is `BaseTemporalWorker`, and the workflow path has to be relative to _that_ instead of the actual worker. If the path could be relative to `ChatWorker`, it would just be `./workflows` (much nicer). I think the change to allow a function in addition to a string path will really help here and probably enable a similar decorator approach as with activities.

Here's `BaseTemporalWorker` for reference:
```typescript
export class BaseTemporalWorker implements OnModuleInit {
  private readonly logger = new Logger(BaseTemporalWorker.name);

  private worker: Worker;
  private _config: WorkerOptions;

  set config(value: WorkerOptions) {
    this._config = value;
  }

  private async startWorker() {
    this.logger.log("Starting temporal worker on task queue " + this._config.taskQueue);
    this.worker = await Worker.create(this._config);
    await this.worker.run();
  }

  async onModuleInit() {
    this.startWorker().catch(err => {
      console.error(err);
    });
  }
}
```

You might have noticed `WorkerConfigFactory`. This helper object builds the config for a module so that we don't have to repeat a bunch of config for each module that needs a worker. The main reason: all activities need a common interceptor that creates an AsyncLocalStorage context for our ORM. Here's `WorkerConfigFactory`:

```typescript
@Injectable()
export class WorkerConfigFactory {
  constructor(private readonly activityRCInterceptor: ActivityRequestContextInterceptor) {}

  createConfig(activities: ActivityInterface, workflowsPath: string, taskQueue: string, configOverrides?: WorkerOptions): WorkerOptions {
    const baseConfig: WorkerOptions = {
      workflowsPath: require.resolve(workflowsPath),
      activities,
      taskQueue,
      interceptors: {
        activityInbound: [ctx => this.activityRCInterceptor],
      },
    };

    return merge(baseConfig, configOverrides);
  }
}
```

Finally, installing the sdk core is super awkward because it's a singleton. I had to jump through some hoops to make sure that ran before anything else. I saw in the comments that it's going to be deprecated, which is good. Singletons are a bit weird to deal with in a DI framework like Nest. Instead, I'd prefer to create a `Core` in the DI context and inject that into the worker, kind of like a database connection provider. That would mean we could connect to multiple Temporal hosts/clusters (not that we want to right now, but maybe someday?).

Whew! Ok that's a lot of stuff, but IT WORKS. I think the things that would clean everything up the most are:
* Register activities and workflows via decorator
* Inject activities into workflows
* Auto-create or otherwise remove the Worker class boilerplate. `ChatWorker` above is really just a configuration station.
* No more core singleton, use DI context instead

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-19 06:17:15.000 UTC</summary>

@eplarson that's exactly the kind of API I'm aiming for. I think Nest's insistence on slicing by domain instead of responsibility is one of its core strengths, and I would be very concerned if my teams started writing code that goes against the grain of that. Thanks for the _very deep_ technical insights! I think we'll have to go about this iteratively, but I'm here to work with everybody on that üí™ 

Reactions: üëç 1

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-19 06:22:47.000 UTC</summary>

I'm guessing something to this effect:

```ts
@Module({
  imports: [TemporalModule.forFeature({
    taskQueue: 'book-trip',
  })],
  providers: [BookTripWorkflow, BookTripActivities]
})
export class TripBookingModule
```

perhaps combined with a cli command like `nest worker start --module=TripBookingModule`? We'll get there :) 

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-19 10:21:26.000 UTC</summary>

<img width="1119" alt="image" src="https://user-images.githubusercontent.com/296796/159117205-07ff9e57-41db-467e-8fdd-16a68210fe1e.png">

Yep so this was kind of to be expected... Already happens with this code:

```ts
// workflows.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ParentWorkflow } from './parent.workflow';

export default async function bootstrap() {
  const ctx = await (
    await NestFactory.createApplicationContext(AppModule)
  ).init();
  const workflowClass = ctx.get(ParentWorkflow);

  return {
    parentWorkflow: workflowClass.parentWorkflow,
  };
}
```

```ts
// parent.workflow.ts
import { Injectable } from '@nestjs/common';

@Injectable()
export class ParentWorkflow {
  public parentWorkflow({ name }: { name: string }) {
    return `Hello ${name}`;
  }
}
```

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-19 10:33:25.000 UTC</summary>

Hmmm... @eplarson do you have some time next week to help me understand your use-case a bit better perhaps? I'd like to understand how it's structured, how many folks work on it & how it's ran in production / development. 

</details>

<details>
<summary><strong>StevenLangbroek</strong> commented on 2022-03-19 10:36:56.000 UTC</summary>

Hmmmm every "module" its own `Worker` instance? ü§î so we could really lift _everything_ into Nest huh? How do we prevent folks from footgunning with injecting services that have side-effects or non-determinism into their Workflow classes (e.g., ORMs, HttpService)

</details>

<details>
<summary><strong>eplarson</strong> commented on 2022-03-21 20:02:16.000 UTC</summary>

> Hmmm... @eplarson do you have some time next week to help me understand your use-case a bit better perhaps? I'd like to understand how it's structured, how many folks work on it & how it's ran in production / development.

Yeah definitely, Calendly link here if you want to set something up: https://calendly.com/ethan-enerflo/general 



</details>

<details>
<summary><strong>serhattanrikut</strong> commented on 2022-03-27 13:58:38.000 UTC</summary>

Hello @StevenLangbroek , @eplarson 

This is a pretty nice initiative; it would be super beneficial to have an integrated TemporalModule for NestJs. Do you have any repo for the proposal so far that I can also follow up?

@eplarson 

I am in the same situation with you as I also want to structure our large codebase within Temporal. Can you share more insights or maybe a working repo with temporal+nestjs? 

thanks in advance.

</details>

<details>
<summary><strong>eplarson</strong> commented on 2022-03-29 18:22:46.000 UTC</summary>

@serhattanrikut I do have this doc I wrote up, that plus the examples above might help:

[background-workflows.md](https://github.com/temporalio/sdk-typescript/files/8373997/background-workflows.md)

The worker core I referenced is just this:

```typescript
export const WorkerCoreProvider: FactoryProvider<Promise<Core>> = {
  provide: "TEMPORAL_WORKER_CORE",
  useFactory: async () => {
    const options: CoreOptions = {
      serverOptions: {
        address: "localhost", // defaults port to 7233 if not specified
        namespace: "default", // as explained in Namespaces section
      },
    };

    return await Core.install(options);
  },
};
```

The client and its config are set up this way: 
```typescript
export type TemporalClientConfig = { connectionOptions: ConnectionOptions; clientOptions: WorkflowClientOptions };

export const ClientConfigProvider: FactoryProvider<TemporalClientConfig> = {
  provide: "TEMPORAL_CLIENT_CONFIG",
  useFactory: () => {
    return {
      connectionOptions: {
      },
      clientOptions: {
      },
    };
  },
};

export const ClientProvider: FactoryProvider<void> = {
  provide: "TEMPORAL_CLIENT",
  inject: ["TEMPORAL_CLIENT_CONFIG"],
  useFactory: (config: TemporalClientConfig) => {
    const connection = new Connection(config.connectionOptions);
    return new WorkflowClient(connection.service, config.clientOptions);
  },
};
```

You just have to reference the above providers in a Nest module. I expect the setup to change as a result of this ticket.

Reactions: üëç 1

</details>

<details>
<summary><strong>serhattanrikut</strong> commented on 2022-03-30 16:28:06.000 UTC</summary>

thank you @eplarson . I implemented something similar. 

let's keep in touch to get this forward.

</details>

<details>
<summary><strong>aminebeh</strong> commented on 2022-05-24 13:26:26.000 UTC</summary>

Hey everyone :wave: 

Just found out this issue and wanted to add a mention to https://github.com/KurtzL/nestjs-temporal

Great potential and works great for our company (for now) :wink: 

Reactions: üëÄ 1

</details>

<details>
<summary><strong>fjur</strong> commented on 2022-06-28 19:47:45.000 UTC</summary>

@eplarson How do you handle dependency injection of services, were you able to use a similar pattern to nestjs DI, or do you solely rely on interceptors to DI other services activities rely on?

I tried creating an injectable service and passing that as the return type from ActivityFactory, and it contains the DI services, but it seems that ProxyActivity potentially wipes away those references.

Any tips?

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-07-26 14:41:42.000 UTC</summary>

@fjur @aminebeh @serhattanrikut can you all please take a look at temporalio/samples-typescript#169? We're putting together a NestJS sample app, and we would love some feedback from experienced NestJS devs.

</details>

<details>
<summary><strong>serhattanrikut</strong> commented on 2022-07-28 08:35:17.000 UTC</summary>

> @fjur @aminebeh @serhattanrikut can you all please take a look at [temporalio/samples-typescript#169](https://github.com/temporalio/samples-typescript/pull/169)? We're putting together a NestJS sample app, and we would love some feedback from experienced NestJS devs.

Sure..I will review asap.

thank you.

</details>

<details>
<summary><strong>aminebeh</strong> commented on 2022-07-28 17:39:22.000 UTC</summary>

Sure, I'll be happy to take a look üòâ 

</details>

<details>
<summary><strong>eplarson</strong> commented on 2022-08-02 22:07:38.000 UTC</summary>

> @eplarson How do you handle dependency injection of services, were you able to use a similar pattern to nestjs DI, or do you solely rely on interceptors to DI other services activities rely on?

For activities, we follow the Nest pattern of using a decorator to mark classes as activity classes, and their functions as activity functions (like you would for a REST controller or GraphQL resolver). Activity classes are registered as a provider and can have whatever injected they need, there's nothing special about them other than the decorators used.

On bootstrap, we use Nest's DiscoveryService and Reflector to find the activity classes and register their activity functions with the worker on startup. Basically we create a new object with all the discovered activity functions, and use that new object when starting the worker.

This makes heavy use of Nest's decorate-then-discover pattern.

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-08-05 19:01:37.000 UTC</summary>

@eplarson what is the benefit of explicitly marking a class as an activity class using decorators? In https://github.com/temporalio/samples-typescript/pull/169, it doesn't look necessary.

</details>

<details>
<summary><strong>eplarson</strong> commented on 2022-08-05 20:40:56.000 UTC</summary>

> @eplarson what is the benefit of explicitly marking a class as an activity class using decorators? In [temporalio/samples-typescript#169](https://github.com/temporalio/samples-typescript/pull/169), it doesn't look necessary.

It may not be needed anymore. We set this up earlier this year on an older version of the SDK.

</details>

<details>
<summary><strong>tareksalem</strong> commented on 2023-05-30 10:42:14.000 UTC</summary>

I think temporal typescript SDK is closer to functional paradigm instead of oop, so why shifting the paradigm instead of adapting it?
let's think what is the main problem?

the main problem for me I am not able to inject other services into my activities, for example if I have an activity interacts with the outside world so it needs the httpService and the configService, so basically the main problem is dependency injection problem, how this could be solved?

To solve this problem I built an internal package in my company that does dependency injection for functions, so my activity looks like this

```typescript

export const GetPaymentMethod =
  ({
    logger,
    configService,
    httpService,
  }: {
    logger: any;
    configService: ConfigService;
    httpService: HttpService;
  }) =>
  async ({
    brand,
    id,
    customerId,
  }: {
    brand: string;
    id: string;
    customerId: string;
  }) => {
    logger.info('started executing get payment method', {});
    try {
      logger.info('started getting payment method', { brand, id, customerId });
      const profileServiceBseURL =
        configService.get<string>('profileService.url');
      const { status, data } = await firstValueFrom(
        httpService.get('hrlHere', { headers: {} }),
      );
      if (status != HttpStatus.OK) {
        throw data;
      }
      return data ? (data as PaymentMethodDTO) : null;
    } catch (err) {
      logger.error('failed to get payment method', { err });
      throw err;
    }
  };

export const getPaymentMethod = InjectIn(GetPaymentMethod);
```

Basically it's a higher order function so I am injecting the needed dependencies in the outer function and the inner one I have the needed logic, which helps a lot to make the code testable
and at the end I am using `InjectIn` which is a function exported from the library I did that basically injects the needed dependency from the container, it injects them at runtime so no matter about the ordering of the injected dependencies

now in each module I have in my app I am doing the following:

```typescript
export class OrdersModule implements OnModuleInit {
  constructor(private readonly configService: ConfigService, httpService: HttpService) {}
  onModuleInit() {
    const firebaseModules = initFirebase(this.configService);
    GetContainer().Bind(logger, { name: 'logger' });
    GetContainer().Bind(getAuthorizationHeader);
    GetContainer().Bind(this.configService, { name: 'configService' });
     GetContainer().Bind(this.httpService, { name: 'httpService' })
  }
}
```

I am binding the needed dependencies to the container to  make them available for the functions

</details>

<details>
<summary><strong>liho00</strong> commented on 2025-06-22 17:32:21.000 UTC</summary>

we need this official support

Reactions: üëé 1

</details>

<details>
<summary><strong>clintonb</strong> commented on 2025-06-22 17:35:33.000 UTC</summary>

https://github.com/KurtzL/nestjs-temporal has worked well for us over the past couple years. 

Reactions: üëç 1

</details>


---

<a id="928"></a>

### #928: [Bug] Jest detects open handles

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/928 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-10-17 18:26:52.000 UTC (3y 2m ago) |
| **Updated** | 2025-09-11 07:22:29.000 UTC |
| **Upvotes** | 7 |
| **Comments** | 26 |
| **Priority Score** | 40 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üëç 7 |

#### Description

Getting this warning when running a simple test with the test environment:

```
 $ ./node_modules/.bin/jest --detectOpenHandles

...
Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ‚óè  neon threadsafe function
...
```


Code for reproduction:

```ts
import { TestWorkflowEnvironment } from '@temporalio/testing';
import { Worker, Runtime, DefaultLogger, LogEntry } from '@temporalio/worker';
import { someWorkflow } from './workflows';

let testEnv: TestWorkflowEnvironment;

beforeAll(async () => {
  // Use console.log instead of console.error to avoid red output
  // Filter INFO log messages for clearer test output
  Runtime.install({
    logger: new DefaultLogger('WARN', (entry: LogEntry) => console.log(`[${entry.level}]`, entry.message)),
  });

  testEnv = await TestWorkflowEnvironment.createTimeSkipping();
});

afterAll(async () => {
  await testEnv?.teardown();
});

test('some random test', async () => {
  const { client, nativeConnection } = testEnv;
  const worker = await Worker.create({
    connection: nativeConnection,
    taskQueue: 'test',
    workflowsPath: require.resolve('./workflows'),
    activities: {
      // ...
    },
  });

  await worker.runUntil(async () => {
    const result = await client.workflow.execute(someWorkflow, {
      args: [],
      workflowId: 'money-transfer-test-workflow',
      taskQueue: 'test',
    });

    expect(result).toEqual('test');
  });
});
```

#### Comments (26)

<details>
<summary><strong>lorensr</strong> commented on 2022-10-17 19:03:48.000 UTC</summary>

Val did some investigating in https://github.com/temporalio/samples-typescript/issues/189

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-22 13:49:56.000 UTC</summary>

Test case can be reduced to this:

```
test(`core-bridge registerErrors() doesn't leave open handles`, async () => {
    const native = require("@temporalio/core-bridge");

    native.registerErrors({
        IllegalStateError: () => ({}),
        ShutdownError: () => ({}),
        TransportError: () => ({}),
        UnexpectedError: () => ({}),
        GracefulShutdownPeriodExpiredError: () => ({}),
    });
});
```

The issue is specifically with `registerErrors()`. For example, that one doesn't trigger the error message:

```
test(`core-bridge getTimeOfDay() doesn't leave open handles`, async () => {
    const native = require("@temporalio/core-bridge");
    native.getTimeOfDay();
}
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-22 14:20:24.000 UTC</summary>

The issue relates to usage of the `.root()` function to keep references to error constructors from Rust land.

```
pub fn register_errors(mut cx: FunctionContext) -> JsResult<JsUndefined> {
    // ...

    let mapping = cx.argument::<JsObject>(0)?;
    let shutdown_error = mapping
        .get::<JsFunction, _, _>(&mut cx, "ShutdownError")?
        .root(&mut cx);   // <----
```

Neon's `Root` object internally register a [`ThreadSafeFunction`](https://nodejs.org/api/n-api.html#asynchronous-thread-safe-function-calls), which is a special type of resource provided by Node's napi allowing native code to call a JavaScript function from any thread. It is that `ThreadSafeFunction` resource that Jest detects as being left open.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-28 21:03:10.000 UTC</summary>

Opened a ticket in Neon: https://github.com/neon-bindings/neon/issues/948

</details>

<details>
<summary><strong>igorsechyn</strong> commented on 2022-12-31 13:59:20.000 UTC</summary>

We hit the same issue in our test setup. Weirdly it causes issues in CircleCI as jest just won't exit despite using `--forceExit` flag. We upgraded to the latest version of sdk and the issue still persists. It is intermittent, so it is hard to pinpoint it to temporal tests, but this behaviour started around the same time as we added temporal tests

</details>

<details>
<summary><strong>mandriv</strong> commented on 2023-02-28 09:42:23.000 UTC</summary>

Is there any known workaround?

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-02-28 12:28:51.000 UTC</summary>

Since the new version we are hitting an issue with Jest on CircleCI as well.
Running into `Too long with no output (exceeded 10m0s): context deadline exceeded`

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-02-28 16:45:07.000 UTC</summary>

> Is there any known workaround?

I'm not aware of any workaround regarding Jest's warning about open handle. This warning message can simply be ignored. This may also cause a 10 seconds delay on process termination, which should generally not be that much of an issue.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-02-28 17:11:32.000 UTC</summary>

> Since the new version we are hitting an issue with Jest on CircleCI as well. Running into `Too long with no output (exceeded 10m0s): context deadline exceeded`

> We hit the same issue in our test setup. Weirdly it causes issues in CircleCI as jest just won't exit despite using --forceExit flag. We upgraded to the latest version of sdk and the issue still persists. It is intermittent, so it is hard to pinpoint it to temporal tests, but this behaviour started around the same time as we added temporal tests

I don't think this is related to the "detected open handle" bug. Wondering if [this](https://github.com/facebook/jest/issues/12972) might be related, though there's unfortunately very little context to work with.

@mandriv @Irvenae Let assume this is a different issue... Could you please provide more details on these situations? Here are some ideas info that might help figure this out, but feel free to add whatever that you think could be useful:
- Temporal SDK/Jest/Node versions?
- Collecting coverage metrics?
- Is that behaviour happening consistently or is it intermittent?
- If you run these tests locally using the very same command as when these tests are being run in CircleCI, does execution completes normally and process stops by itself?
- Do you very get long period of time where the process stop outputting anything? How long 
- Can you still reproduce the error with a reduced test suite?

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-03-01 09:03:29.000 UTC</summary>

- Temporal SDK v1.6.0, Jest 29.3.0, node v16.15.0
- No coverage metrics
- intermittent
- Locally tests complete (tried it 10 times)

This is the log we get in circleCI:
```
2023-02-28T09:49:27.110Z [WARN] This program is running inside a containerized environment with a memory constraint (eg. docker --memory 70226m). Node itself does not consider this memory constraint in how it manages its heap memory. There is consequently a high probability that the process will crash due to running out of memory. To increase reliability, we recommend adding '--max-old-space-size=52669' to your node arguments. Refer to https://docs.temporal.io/application-development/worker-performance for more advice on tuning your workers.
2023-02-28T09:49:27.145998Z  INFO temporal_sdk_core::ephemeral_server: Downloading https://temporal.download/assets/temporalio/sdk-java/releases/download/v1.17.0/temporal-test-server_1.17.0_linux_amd64.tar.gz to /tmp/temporal-test-server-sdk-typescript-1.6.0
2023-02-28T09:49:27.871Z [INFO] Creating worker {
  options: {
    namespace: 'default',
    identity: '454@f5f8c41c3a04',
    shutdownGraceTime: '10s',
    maxConcurrentActivityTaskExecutions: 100,
    maxConcurrentLocalActivityExecutions: 100,
    enableNonLocalActivities: true,
    maxConcurrentWorkflowTaskExecutions: 100,
    stickyQueueScheduleToStartTimeout: '5m',
    maxHeartbeatThrottleInterval: '60s',
    defaultHeartbeatThrottleInterval: '30s',
    isolateExecutionTimeout: '4294967295ms',
    workflowThreadPoolSize: 1,
    maxCachedWorkflows: 1761,
    enableSDKTracing: false,
    showStackTraceSources: true,
    reuseV8Context: true,
    debugMode: true,
    interceptors: { activityInbound: [Array], workflowModules: [Array] },
    sinks: { logger: [Object] },
    workflowsPath: '/root/repo/packages/temporal-features/src/tests/allWorkflows.ts',
    bundlerOptions: { webpackConfigHook: [Function: webpackConfigHook] },
    activities: {
      cancelJob: [Getter],
      createItem: [Getter],
      createItemWithData: [Getter],
      deleteItem: [Getter],
      findItems: [Getter],
      findItemsInAllVersions: [Getter],
      getFileJson: [Getter],
      getItem: [Getter],
      persistData: [Getter],
      setItem: [Getter],
      createOrMemoizeJob: [Getter],
      getJobResult: [Getter],
      getResult: [Getter],
      queryWorkflow: [Getter],
      signalWithStartWorkflowForItem: [Getter],
      signalWorkflow: [Getter],
      startAndQueryWorkflowForItem: [Getter]
    },
    taskQueue: 'test',
    connection: NativeConnection {
      nativeClient: [External: 7fe4b80045b0],
      referenceHolders: Set(0) {}
    },
    shutdownGraceTimeMs: 10000,
    stickyQueueScheduleToStartTimeoutMs: 300000,
    isolateExecutionTimeoutMs: 4294967295,
    maxHeartbeatThrottleIntervalMs: 60000,
    defaultHeartbeatThrottleIntervalMs: 30000,
    loadedDataConverter: {
      payloadConverter: [DefaultPayloadConverter],
      failureConverter: [DefaultFailureConverter],
      payloadCodecs: []
    }
  }
}
2023-02-28T09:49:36.018Z [INFO] asset workflow-bundle-a2ca801512c61451083d.js 22.2 MiB [emitted] [immutable] (name: main)
2023-02-28T09:49:36.018Z [INFO] runtime modules 1.25 KiB 6 modules
2023-02-28T09:49:36.018Z [INFO] modules by path ./packages/ 4.44 MiB 726 modules
2023-02-28T09:49:36.019Z [INFO] modules by path ./node_modules/ 3.54 MiB 293 modules
2023-02-28T09:49:36.019Z [INFO] modules by path ./tooling/tool-version-sync/lib/*.js 4.99 KiB
2023-02-28T09:49:36.019Z [INFO]   ./tooling/tool-version-sync/lib/index.js 1.2 KiB [built] [code generated]
2023-02-28T09:49:36.019Z [INFO]   ./tooling/tool-version-sync/lib/toolVersions.js 1.54 KiB [built] [code generated]
2023-02-28T09:49:36.019Z [INFO]   ./tooling/tool-version-sync/lib/toolMemoryLimits.js 2.25 KiB [built] [code generated]
2023-02-28T09:49:36.019Z [INFO] __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
2023-02-28T09:49:36.019Z [INFO] __temporal_custom_failure_converter (ignored) 15 bytes [built] [code generated]
2023-02-28T09:49:36.019Z [INFO] webpack 5.75.0 compiled successfully in 7586 ms
2023-02-28T09:49:36.116Z [INFO] Workflow bundle created { size: '22.12MB' }
2023-02-28T09:49:37.170023Z  INFO temporal_sdk_core::worker: Initializing worker task_queue=test namespace=default
2023-02-28T09:49:37.172Z [INFO] Worker state changed { state: 'RUNNING' }
(node:454) MaxListenersExceededWarning: Possible EventTarget memory leak detected. 11 abort listeners added to [AbortSignal]. Use events.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)

Too long with no output (exceeded 10m0s): context deadline exceeded
```

In this run it only runs 1 test file. In this test file we only create 1 timeSkipping test env, which we reuse for 12 tests.
I checked the memory and we only use at a max 25% Mem of the instance so OOM is out of the question.
The `MaxListenersExceededWarning` can be ignored, sth in our code we need to resolve.

A successful run would have 3 min later the Worker state changed { state: 'STOPPING' } and etc. We only print info logs I will try to reproduce with debug logs as well.

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-03-01 13:57:01.000 UTC</summary>

I might have been on the wrong track, I today reran this 10 times on CircleCI but no failure. I know for sure this happens when we have multiple tests running, but there it could be OOM as well (so setting node options and/or going to a single Jest worker to see if it is resolved). Anyway, I am also further investigating to potentially pinpoint it better.

</details>

<details>
<summary><strong>igorsechyn</strong> commented on 2023-03-01 15:32:23.000 UTC</summary>

FWIW, we found that we were either running out CPU or Memory, when executing in CircleCI. The only thing that helped us is to reduce number of jest workers. we had not had a single failure since then.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-01 18:44:52.000 UTC</summary>

>I checked the memory and we only use at a max 25% Mem of the instance so OOM is out of the question.

Not sure if this is the issue here, but I personally recommend to _always_ explicitly set Node's `--max-old-space-size` (see [this page](https://legacy-documentation-sdks.temporal.io/typescript/production-deploy#properly-configure-nodes-memory-in-docker) for some details).

Based on your log, it appears you are executing inside a containerized environment with a memory constraint. Node itself doesn't play great in such cases, because it doesn't know about those constraints and instead configure its heap allocation and garbage collection to based on the machine's total memory.

The opposite is also possible: by default, Node will configure its heap allocation limit and garbage collection algorithms to 25% of available memory, up to a limit of 4GB (assuming node 14 to 18, with 64 bits cpu). That means that your Node process may not be taking advantage of all the resources available to it, which could explain that it is not performing as it should.

Both cases can be resolved by explicitly setting and properly tuning Node's `--max-old-space-size`.

</details>

<details>
<summary><strong>NivOclear</strong> commented on 2023-04-18 08:16:20.000 UTC</summary>

so any progress regarding this issue ? this not just a warning in our cicd its break the jest test and not passing them 

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-04-18 08:33:48.000 UTC</summary>

We have resolved it by using a bigger machine and reducing the number of jest workers and setting `--max-old-space-size` (taking into account the nr of workers).

I am now evaluating AVA tbh, because attaching the debugger is spotty with Jest.

</details>

<details>
<summary><strong>Kannndev</strong> commented on 2023-11-21 07:46:35.000 UTC</summary>

I am not sure if this is relevant, but i will add here just to get others opinion as well,

When I run the test with `createLocal` it works but when i use `createTimeSkipping` test times out even after 60s. The example test is 

```
import { DefaultLogger, LogEntry, Runtime, Worker } from '@temporalio/worker';

import { TestWorkflowEnvironment } from '@temporalio/testing';
import { WorkflowCoverage } from '@temporalio/nyc-test-coverage';
import { example } from './workflow';

describe('Example workflow with mocks', () => {
  let testEnv: TestWorkflowEnvironment;
  const workflowCoverage = new WorkflowCoverage();

  beforeAll(async () => {
    // Use console.log instead of console.error to avoid red output
    // Filter INFO log messages for clearer test output
    Runtime.install({
      logger: new DefaultLogger('WARN', (entry: LogEntry) => console.log(`[${entry.level}]`, entry.message)),
    });

    testEnv = await TestWorkflowEnvironment.createLocal();
  });

  afterAll(async () => {
    await testEnv?.teardown();
  });

  afterAll(() => {
    workflowCoverage.mergeIntoGlobalCoverage();
  });

  it('successfully completes the Workflow with a mocked Activity', async () => {
    const { client, nativeConnection } = testEnv;
    const taskQueue = 'test';

    const worker = await Worker.create(
      workflowCoverage.augmentWorkerOptions({
        connection: nativeConnection,
        taskQueue: 'test',
        workflowsPath: require.resolve('../workflows'),
        activities: {
          greet: async () => 'Hello, Temporal!',
        },
      })
    );

    await worker.runUntil(async () => {
      const result = await client.workflow.execute(example, {
        args: ['Temporal'],
        workflowId: 'test',
        taskQueue,
      });
      expect(result).toEqual('Hello, Temporal!');
    });
  });
});

```

Why is this behaviour happening ?, 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-12-15 16:14:30.000 UTC</summary>

> When I run the test with createLocal it works but when i use createTimeSkipping test times out even after 60s. The example test is

Thanks for the feedback.

We haven't had the capacity to investigate this further for now, we'll need more work to understand what's going on here.

</details>

<details>
<summary><strong>jbsil</strong> commented on 2024-02-01 14:40:51.000 UTC</summary>

We've found a workaround for this when running `Worker`s using the `TestWorkflowEnvironment` in jest with `--detectOpenHandles`. This does not appear to work for activities run using the `MockActivityEnvironment`, where the open handles still persist.

the summary of the worker workaround is:
1. when you create your `TestWorkflowEnvironment`, store it on global, e.g. `global.TemporalEnvironment: TestWorkflowEnvironment`
2. as you `Worker.create` each of your workers, store the `Worker` (await the call to create) into _something_ on global, e.g. `global.workers: Worker[]`
3. as you `worker.run()` each of your workers, store the run promise as well into _something_ on global, e.g. `global.workerPromises: Promise[]`
4. setup a [jest globalTeardown](https://jestjs.io/docs/configuration#globalteardown-string) to clean up all of this stuff
5. on each of the `global.workers`, call `.shutdown()`, which will cause the workers to (eventually) shut down. do not try to await this
6. instead, wait for all of the worker run promises, e.g. `await Promise.all(global.workerPromises)`
7. finally, teardown the TWE, e.g. `await global.TemporalEnvironment.teardown()`
e.g. teardown.ts
```ts
export default async function teardown() {
  // ask each worker to start shutting down
  global.workers.forEach((worker) => {
    // do not wait for this, it is non-blocking
    worker.shutdown();
  });
  // the promises created by `Worker.run` will resolve once the worker has actually shutdown
  await Promise.all(global.workerPromises);
  // fyi - teardown the environment won't work until after the workers disconnect
  await global.TemporalEnvironment?.teardown();
}
```

To get your typing correct, you can `declare global`, but note that you have to `var` your variables, `let` and `const` [wont work](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-4.html?#type-checking-for-globalthis).
e.g. 
```ts
declare global {
  var TemporalEnvironment: TestWorkflowEnvironment;
  var workers: Worker[];
  var workerPromises: Promise[];
}
```

We have found that the most "sane" configuration of this is to use a [jest globalSetup](https://jestjs.io/docs/configuration#globalsetup-string) to start the `TestWorkflowEnvironment` and all of the workers involved, because it more closely mirrors what will be happening in production (the server and workers will be running before a workflow payload arrives). But, you don't _have_ to do that part.

In our worker repos, using Node 18 and temporalio/* @ 1.9.0, this closes all of our handles and lets jest exit gracefully.

We're still unable to work around the open handles from the `MockActivityEnvironment`, though, which is disappointing.

Reactions: üëç 2

</details>

<details>
<summary><strong>jbsil</strong> commented on 2024-02-01 17:48:02.000 UTC</summary>

It turns out that the handles opened by `MockActivityEnvironment` are in the `Runtime`. That means that you can 
jest config
```json
{
  ...,
  "globalTeardown": "tests/teardown.ts"
}
```
teardown.ts
```ts
import { Runtime } from '@temporalio/worker';
export default async function() {
  await Runtime.getInstance().shutdown();
}
```
and your open handles will get cleaned up. There is some delay (a few seconds) after the tests finish while the Runtime shuts down, but it stops jest from complaining! 
Hurray!

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-02 14:36:46.000 UTC</summary>

Thanks a lot @jbsil for sharing your findings on this issue. It will certainly help a few of our users.

I have to admit that I'm very intrigued by why this solution actually resolves the symptom, as I'm pretty sure that this will not force unloading of Neon's global `ThreadSafeFunction`, but glad to know that it works. We're planning to dig into more into Jest related issues soon; I will experiment more with your workaround at that moment.

Reactions: üëç 1

</details>

<details>
<summary><strong>ilijaNL</strong> commented on 2024-05-04 09:23:32.000 UTC</summary>

This is still ongoing issue, sometimes it also takes sometime before everything is terminated according to jest runner. 

Reactions: üëç 1

</details>

<details>
<summary><strong>jamespsterling</strong> commented on 2024-09-24 13:32:36.000 UTC</summary>

We are seeing this for `MockActivityEnvironment`, 


```ts
Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ‚óè  neon threadsafe function

      34 |
      35 |   beforeEach(async () => {
    > 36 |     env = new MockActivityEnvironment({ attempt: 2 });
         |           ^
      37 |
      38 |     const compiledSubject = await compileTemplate({
      39 |       mergeFields: allMergeFields,

      at ../../../../node_modules/@temporalio/core-bridge/index.js:16:14
      at Function.create (../../../../node_modules/@temporalio/worker/src/runtime.ts:202:31)
      at Function.instance (../../../../node_modules/@temporalio/worker/src/runtime.ts:194:17)
      at Activity.makeActivityLogger (../../../../node_modules/@temporalio/worker/src/activity.ts:82:34)
      at new Activity (../../../../node_modules/@temporalio/worker/src/activity.ts:61:12)
      at new MockActivityEnvironment (../../../../node_modules/@temporalio/testing/src/index.ts:416:21)
      at Object.<anonymous> (src/lib/actions/emails/prepareEmailAndMessageData.spec.ts:36:11)
```

</details>

<details>
<summary><strong>Charly-xepelin</strong> commented on 2024-11-13 22:16:46.000 UTC</summary>

As @jbsil suggested I simple kept in the jest describe the promise returned by `worker.run` and waited for it in the afterAll:

```typescript
describe('My tests', () => {
    let worker: Worker;
    let client: typeof testEnv.client;
    let workerRunPromise: Promise<void>;

    // beforeAll and afterAll are injected by Jest
    beforeAll(async () => {
        testEnv = await TestWorkflowEnvironment.createTimeSkipping();

        worker = await Worker.create({
            connection: testEnv.nativeConnection,
            taskQueue: 'test',
            workflowsPath: require.resolve('./workflow'),
            activities: mockActivities,
        });

        workerRunPromise = worker.run().catch((err) => console.log(err));

        client = testEnv.client;
    });

    afterAll(async () => {
        if (worker) {
            worker.shutdown();
            await workerRunPromise;
        }
        await testEnv?.teardown();
    });
});
```

Reactions: üéâ 2

</details>

<details>
<summary><strong>caiokf</strong> commented on 2024-11-28 04:58:51.000 UTC</summary>

in the afterAll, `await Runtime._instance?.shutdown()` worked for me

</details>

<details>
<summary><strong>Thexumaker</strong> commented on 2024-12-06 06:05:47.000 UTC</summary>

@Charly-xepelin this worked for me as well


</details>

<details>
<summary><strong>QuentinLemCode</strong> commented on 2025-09-11 07:22:29.000 UTC</summary>

Hi ! I'm also affected by the issue. 
Even doing `await Runtime.getInstance().shutdown()` doesn't work for me. I'm using the latest version (1.13.0)
@mjameswh Do you have any update ?

</details>


---

<a id="1658"></a>

### #1658: [Feature Request] Add support for opentelemetry v2

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1658 |
| **State** | OPEN |
| **Author** | karlismelderis-mckinsey (Karlis Melderis) |
| **Created** | 2025-03-24 08:17:17.000 UTC (9 months ago) |
| **Updated** | 2025-12-01 18:13:12.000 UTC |
| **Upvotes** | 19 |
| **Comments** | 1 |
| **Priority Score** | 39 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 19 |

#### Description

### Is your feature request related to a problem? Please describe.

Open Telemetry got new major version - v2 and some libs `0.200.0`
Please update your lib to support new Otel library version


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-12-01 18:13:12.000 UTC</summary>

This is coming up soon.

Unfortunately, we can't simply "upgrade" to OTel v2, as that would be a breaking change for all existing Temporal setups. The plan is therefore to make a _new_ package for this, something like `@temporalio/interceptors-opentelemetry2` (haven't made a final decision on the package name), so that both plugin versions can coexist.

Now, we're going through some heavy work to improve the completeness and DX on the OTel v1 interceptor at the moment. Those improvements will also be applicable to the v2, so much that it makes little sense to create the OTel v2 before we're done with present work on v1.

So the path forward will be, in proper order:

1. Complete current efforts on [covering _all_ events](https://github.com/temporalio/sdk-typescript/pull/1835) through the OTel v1 interceptors
2. Complete effort on extending the OTel interceptors v1 to the new Plugin form.
3. Address serialization issues with the workflow/sink layer that are causing errors in some setups (#1779 and #1738).
4. Duplicate the OTel v1 package to a new OTel v2 package, and adapt the code as needed.

In the mean time, you may use your own v2 copy of the OTel interceptors. There's really nothing here that requires that to be part of the official SDK.

Reactions: üëç 3

</details>


---

<a id="1773"></a>

### #1773: [Bug] error: TypeError: (0 , ms_1.default) is not a function

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1773 |
| **State** | CLOSED |
| **Author** | anh-rivergon |
| **Created** | 2025-08-26 03:31:18.000 UTC (4 months ago) |
| **Updated** | 2025-08-27 09:38:41.000 UTC |
| **Closed** | 2025-08-26 19:10:35.000 UTC |
| **Upvotes** | 11 |
| **Comments** | 11 |
| **Priority Score** | 33 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 11 |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Trying to start a worker. Used to work fine.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

    error: TypeError: (0 , ms_1.default) is not a function
          at msWithValidation (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/common/lib/time.js:80:37)
          at msToNumber (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/common/lib/time.js:77:12)
          at compileWorkerOptions (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/worker/lib/worker-options.js:236:68)
          at Worker.create (/home/anh/workspace/oneb-main/services/contact/contact-services/contact-temporal/contact-temporal-workers/node_modules/@temporalio/worker/lib/worker.js:186:75)

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction
 According to ChatGPT, the use of "ms": "^3.0.0-canary.1" is the root cause.

Solution is to use "ms": "2.1.3"

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (11)

<details>
<summary><strong>anh-rivergon</strong> commented on 2025-08-26 03:35:11.000 UTC</summary>

Added the below to package.json as temporary fix.
{
  "overrides": {
    "ms": "2.1.3",
    "@temporalio/common": { "ms": "2.1.3" },
    "@temporalio/worker": { "ms": "2.1.3" }
  }
}

Reactions: üëç 2

</details>

<details>
<summary><strong>cam-at-tactiq</strong> commented on 2025-08-26 04:21:31.000 UTC</summary>

This affected us too, seems wrong to rely on a `canary` version from this package, and I think it should depend on `2.1.3` so long as it works

Reactions: üëç 3

</details>

<details>
<summary><strong>maurovanetti</strong> commented on 2025-08-26 10:10:37.000 UTC</summary>

Same issue, ~~fixed with the suggested override.~~ Thank you.

Canary versions should not be used as dependencies in production.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-26 15:44:10.000 UTC</summary>

[Related upstream discussion](https://github.com/vercel/ms/issues/254).

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-26 16:21:18.000 UTC</summary>

For users affected by this, the recommended mitigation is to add a local version pin override on `ms@3.0.0-canary.1`.

There are different ways to do this. The easiest solution will vary based on which package manager you are using and your specific project structure (notably, whether you are using a monorepo).

- In most cases, the easiest solution is to add an explicit dependency on `ms@3.0.0-canary.1` from one of your own packages (preferably the ones importing `@temporalio/*` packages).
- Alternatively, you may add a dependency override directive in your own `package.json` file. For NPM, this will look something like this:

  ```
  {
    "dependencies": {
      // ...
    },
    "overrides": {
      "ms": "3.0.0-canary.1",
      "@temporalio/common": { "ms": "3.0.0-canary.1" },
      "@temporalio/worker": { "ms": "3.0.0-canary.1" }
    }
  }
  ```

A dependency on `2.1.3` will work fine at runtime in most environments, but may cause compile-time errors of user code if it transitively depends on the TS type definitions exposed by the official `ms@3.x` package. This may notably affect deployments where workflow code is bundled at runtime, rather than being prebundled.

Reactions: üëç 3

</details>

<details>
<summary><strong>maurovanetti</strong> commented on 2025-08-26 16:45:58.000 UTC</summary>

Thank you @mjameswh, I've been struggling with this issue for some time today, and I realised later than downgrading to `ms@2.1.3` does not actually fix everything. It worked in a project but not in another one, depending on which parts of `@temporalio/common` I'm actually using in either project.

As I understood it from the discussion in the ms repo you linked, the problem here is that `ms` has been using canary versions as official releases (üò≤), and you could only follow suit with the dependency. Not your fault, definitely. Then a little mess happened at `ms`, semantic versioning was broken and now the caret dependency from `^3.0.0-canary.1` resolves to later, incompatible canary releases. You rightly suggested to bump these new versions to v4 but I'm not sure this is happening anytime soon.

But more weirdness is coming. Your snippet is slightly wrong, it should be written like this to be accepted by npm (my version at least):

```
  "overrides": {
    "ms": "3.0.0-canary.1",
    "@temporalio/common": { "ms": "3.0.0-canary.1" },
    "@temporalio/worker": { "ms": "3.0.0-canary.1" }
  }
```
(Also, I'm not sure we need to mention `@temporalio/worker` among the overrides but this is a finer point.)
Unfortunately, though, if I do this, and I really can't explain why, I get this in my package-lock.json:

```
    "node_modules/@temporalio/common/node_modules/ms": {
      "version": "3.0.0-canary.0",
      "resolved": "https://registry.npmjs.org/ms/-/ms-3.0.0-canary.0.tgz",
      "integrity": "sha512-FrdRKJ9G+nm9Bw6atUMrbIhGTJ2emtf0KRgtzgSrAW1nnV9RuQAXc7sbFWdr1RfOH3fcNk0MyK+ma4iihdLmyA==",
      "engines": {
        "node": ">=12.13"
      }
    },
```

Therefore, the override does not install `canary.1` but `canary.0`, and that version is broken in another way. ü§ï 
I'm puzzled. 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-26 17:31:29.000 UTC</summary>

> Your snippet is slightly wrong, it should be written like this to be accepted by npm (my version at least)

That's right, copy-paste error from my part. Fixed. Thanks for pointing it out.

> Therefore, the override does not install canary.1 but canary.0

- Any hint if you look at `npm why ms`?

- Have you tried adding an explicit dependency to `ms@3.0.0-canary.1` from your own package, instead of adding an override? NPM will generally try to avoid bringing in different versions of a package if it can find a way to do so without breaking requirements.

</details>

<details>
<summary><strong>dimitropoulos</strong> commented on 2025-08-26 18:33:37.000 UTC</summary>

hi!  apologies for any disruption.  we're shaking the dust off after many years without a release.  if you still want to depend on the canary you can use the release linked here: https://github.com/vercel/ms/issues/254#issuecomment-3225280621

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-26 19:10:35.000 UTC</summary>

Awesome @dimitropoulos! Thank you so much for your collaboration.

I just confirmed that running `npm i --prefer-online` on a sample project makes it run perfectly, without any change to declared dependencies. It downloaded 3.0.0-canary.202508261828.

That resolves the case.

Reactions: üéâ 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-26 19:30:01.000 UTC</summary>

**Still observing this issue?**

You might need to force your package manager to query the NPM registry. Otherwise, it may end up reusing a problematic version of the package from its cache.

Run one of the following command, depending on your package manager:

- NPM: `npm i --prefer-online`
- PNPM: `pnpm install --prefer-online`
- Yarn Classic (v1): `yarn install --update-checksums`
- Yarn Berry/3+: `yarn install --check-cache`


**Preventing this in production**

To avoid surprises from fresh upstream releases in CI or production, we strongly recommend committing your project's lockfile (package-lock.json, pnpm-lock.yaml, or yarn.lock) to source control.

Then, make sure your package manager honor that lock file when installing dependencies in your CI or production environment:
- NPM: `npm ci`
- PNPM: `pnpm install --frozen-lockfile`
- Yarn Classic (v1): `yarn install --frozen-lockfile`
- Yarn Berry/3+: `yarn install --immutable`

This ensures that your deployment replicates the latest "known good" dependency tree.

Reactions: ‚ù§Ô∏è 3

</details>

<details>
<summary><strong>maurovanetti</strong> commented on 2025-08-27 09:38:41.000 UTC</summary>

Thank you @mjameswh, it was definitely a cache issue with npm. However, everything was fixed with the latest changes.
Well played.

Reactions: üëç 2

</details>


---

<a id="421"></a>

### #421: [Feature Request] pnpm support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/421 |
| **State** | CLOSED |
| **Author** | mengyazhu96 (jessica) |
| **Created** | 2021-12-06 17:57:54.000 UTC (4y 1m ago) |
| **Updated** | 2022-04-21 21:56:28.000 UTC |
| **Closed** | 2022-04-21 21:56:28.000 UTC |
| **Upvotes** | 6 |
| **Comments** | 18 |
| **Priority Score** | 30 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 6 |

#### Description

### Is your feature request related to a problem? Please describe.
When using pnpm with the Typescript SDK, the Temporal worker's webpack building step fails. As a workaround, we had to add the `shamefully-hoist=true` option so that pnpm reverts to npm/yarn style module locations, e.g. putting everything in `./node_modules` instead of in workspace node modules, e.g. `./workspaces/*/node_modules`

### Describe the solution you'd like
Support pnpm. I'm not sure what this entails üòÖ 

### Additional context
From Slack thread here: https://temporalio.slack.com/archives/C01DKSMU94L/p1638764279342400

cc @bergundy @spikebrehm


#### Comments (18)

<details>
<summary><strong>spikebrehm</strong> commented on 2021-12-07 14:04:49.000 UTC</summary>

There may be multiple layers of issues, but the immediate one that surfaces has to do with missing dependencies listed in your monorepo packages' `package.json`. For example, grep for `protobufjs`; you‚Äôll note that it‚Äôs listed in `packages/worker/package.json` but is only used in the `packages/workflow` package, and not listed in its `package.json`. probably a mistake during refactoring. That's the first example that errored for us but there may be more issues like this in your monorepo.

Relatedly, this is why we moved from npm -> pnpm ‚Äî it fails loudly when packages/workspaces haven‚Äôt configured dependencies correctly.


</details>

<details>
<summary><strong>flybayer</strong> commented on 2021-12-09 18:26:41.000 UTC</summary>

@mengyazhu96 I'm unable to get it working even with `shamefully-hoist=true`. Was there anything else you had to do?

```
2021-12-09T18:25:30.281Z [ERROR] ERROR in ../../node_modules/.pnpm/@temporalio+common@0.16.4/node_modules/@temporalio/common/lib/time.js 7:31-46
2021-12-09T18:25:30.281Z [ERROR] Module not found: Error: Can't resolve 'long' in '/Users/b/c/flightcontrol/node_modules/.pnpm/@temporalio+common@0.16.4/node_modules/@temporalio/common/lib'
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+common@0.16.4/node_modules/@temporalio/common/lib/index.js 24:13-30
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/worker-interface.js 9:17-46
2021-12-09T18:25:30.281Z [ERROR]  @ ../../../../../../src/main.js 1:0-68 4:0-19 5:0-18 26:4-7
2021-12-09T18:25:30.281Z [ERROR]
2021-12-09T18:25:30.281Z [ERROR] ERROR in ../../node_modules/.pnpm/@temporalio+common@0.16.4/node_modules/@temporalio/common/lib/time.js 8:29-42
2021-12-09T18:25:30.281Z [ERROR] Module not found: Error: Can't resolve 'ms' in '/Users/b/c/flightcontrol/node_modules/.pnpm/@temporalio+common@0.16.4/node_modules/@temporalio/common/lib'
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+common@0.16.4/node_modules/@temporalio/common/lib/index.js 24:13-30
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/worker-interface.js 9:17-46
2021-12-09T18:25:30.281Z [ERROR]  @ ../../../../../../src/main.js 1:0-68 4:0-19 5:0-18 26:4-7
2021-12-09T18:25:30.281Z [ERROR]
2021-12-09T18:25:30.281Z [ERROR] ERROR in ../../node_modules/.pnpm/@temporalio+proto@0.16.0/node_modules/@temporalio/proto/lib/coresdk.js 4:16-45
2021-12-09T18:25:30.281Z [ERROR] Module not found: Error: Can't resolve 'protobufjs/minimal' in '/Users/b/c/flightcontrol/node_modules/.pnpm/@temporalio+proto@0.16.0/node_modules/@temporalio/proto/lib'
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/worker-interface.js 10:18-58
2021-12-09T18:25:30.281Z [ERROR]  @ ../../../../../../src/main.js 1:0-68 4:0-19 5:0-18 26:4-7
2021-12-09T18:25:30.281Z [ERROR]
2021-12-09T18:25:30.281Z [ERROR] ERROR in ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/internals.js 38:31-46
2021-12-09T18:25:30.281Z [ERROR] Module not found: Error: Can't resolve 'long' in '/Users/b/c/flightcontrol/node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib'
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/worker-interface.js 11:20-42
2021-12-09T18:25:30.281Z [ERROR]  @ ../../../../../../src/main.js 1:0-68 4:0-19 5:0-18 26:4-7
2021-12-09T18:25:30.281Z [ERROR]
2021-12-09T18:25:30.281Z [ERROR] ERROR in ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/internals.js 39:32-61
2021-12-09T18:25:30.281Z [ERROR] Module not found: Error: Can't resolve 'protobufjs/minimal' in '/Users/b/c/flightcontrol/node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib'
2021-12-09T18:25:30.281Z [ERROR]  @ ../../node_modules/.pnpm/@temporalio+workflow@0.16.3/node_modules/@temporalio/workflow/lib/worker-interface.js 11:20-42
2021-12-09T18:25:30.281Z [ERROR]  @ ../../../../../../src/main.js 1:0-68 4:0-19 5:0-18 26:4-7
2021-12-09T18:25:30.281Z [ERROR]
2021-12-09T18:25:30.281Z [ERROR] 5 errors have detailed information that is not shown.
2021-12-09T18:25:30.281Z [ERROR] Use 'stats.errorDetails: true' resp. '--stats-error-details' to show it.
2021-12-09T18:25:30.281Z [ERROR]
2021-12-09T18:25:30.281Z [ERROR] webpack 5.65.0 compiled with 5 errors in 4357 ms
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-12-09 18:55:35.000 UTC</summary>

Sounds like all we need is to add the missing dependencies to each package.
I think there's some lint rule that checks that any referenced package in your code is referenced in `package.json`, I'll get to this soon.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-12-23 00:52:38.000 UTC</summary>

While trying to reproduce this, I got errors that are unrelated to missing dependencies.
Even dependencies that are defined properly aren't being found by webpack if I install the packages with `pnpm`.
I'll continue working on it and see what I can find.

</details>

<details>
<summary><strong>akurkin</strong> commented on 2021-12-23 09:47:08.000 UTC</summary>

Encountered same issue when trying to setup monorepo with temporal typescript SDK using rushjs.io monorepo approach (which uses pnpm)

Reactions: üëÄ 1

</details>

<details>
<summary><strong>spikebrehm</strong> commented on 2021-12-23 15:28:09.000 UTC</summary>

I ended having to add all these dependencies directly to our own workspace, e.g. `packages/temporal-worker/package.json` in our monorepo:

```
    "@protobufjs/aspromise": "^1.1.2",
    "@protobufjs/base64": "^1.1.2",
    "@protobufjs/eventemitter": "^1.1.0",
    "@protobufjs/float": "^1.0.2",
    "@protobufjs/inquire": "^1.1.0",
    "@protobufjs/pool": "^1.1.0",
    "@protobufjs/utf8": "^1.1.0",
    "@temporalio/proto": "^0.16.0",
    "long": "^5.2.0",
    "ms": "^2.1.3",
    "protobufjs": "^6.11.2",
    "ts-loader": "^9.2.6",
    "tslib": "^2.3.1",
    "webpack": "^5.20.0",
```

these instead should be specified as deps in your sdk

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-12-24 17:10:15.000 UTC</summary>

@spikebrehm what's strange to me is that I'm getting errors for packages that are specified as dependencies.
Some of the ones you've posted here are already set as dependencies in the SDK.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-12-24 17:10:26.000 UTC</summary>

See the pnpm issue here: https://github.com/pnpm/pnpm/issues/4155

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-04 02:03:22.000 UTC</summary>

The `temporalio@next` package still isn't working for me, but the individual packages are working with [`0.19.0-rc.1`](https://github.com/temporalio/sdk-typescript/blob/main/CHANGELOG.md#0190-rc1---2022-03-02):

```ts
git clone git@github.com:temporalio/samples-typescript.git
cd samples-typescript/hello-world
pnpm rm temporalio
pnpm add @temporalio/worker@next @temporalio/workflow@next @temporalio/client@next @temporalio/activity@next
pnpm start
```

```ts
pnpm run workflow
```

Reactions: üëç 1

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-03-08 00:01:02.000 UTC</summary>

lets document this! makes sense that the bundle package doesnt work?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-08 00:02:11.000 UTC</summary>

I don't know? I was thinking we'd be able to make it work, and then we won't have anything to document. Haven't looked into it yet

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-09 21:19:59.000 UTC</summary>

Looks like `pnpm add temporalio` doesn't install `temporalio`'s dependencies. I opened an issue, but with 718 open issues, not sure when they'll get to it. Anyone more familiar with pnpm up for taking a look? cc @flybayer 

https://github.com/pnpm/pnpm/issues/4428

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-14 19:18:57.000 UTC</summary>

> Looks like pnpm add temporalio doesn't install temporalio's dependencies.

AFAIK that this is the expected behaviour for `pnpm` and `yarn3`. They both impose strict dependency resolution, which means that a package can _never_ get transitive access to dependencies of its own dependencies. If a user package needs to use some library package, it has to name that library package explicitly in its own package.json.

That means that the `temporalio` meta package simply doesn't make any sense when using `pnpm` or `yarn3`. The generic install procedure for these environments should list all temporal public packages explicitly.

I think the only way around this would be to have the meta package reexport the content of all public packages, using package.json's `exports` field, and have users always import though that meta package. So for example, instead of:

```
import { proxyActivities } from '@temporalio/workflow';
```

the user would write:

```
import { proxyActivities } from 'temporalio/workflow';
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-14 19:48:13.000 UTC</summary>

Ah, thanks! That makes sense. Looks like Yarn PnP is used by default since v2, and while it [works in loose mode](https://yarnpkg.com/features/pnp#pnp-loose-mode), strict mode has been default since v2.1.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-14 20:43:52.000 UTC</summary>

> ```ts
> import { proxyActivities } from 'temporalio/workflow';
> ```

I have considered this before but I'm not convinced this is the right direction.
One of the advantages of having separate packages is that the client does not depend on any native libraries and can be easily used in environments where there's limited control of the deployment process such as serverless functions.
We could add aliases from `temporalio/*` to `@temporalio/*` but then users that only want the client would need to refactor their imports or include the native library. It would also mean that our docs and samples should reflect these alternative APIs which isn't ideal IMHO.
I'm not 100% convinced this would be a real issue, I can be convinced otherwise.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-14 21:15:28.000 UTC</summary>

> We could add aliases from `temporalio/*` to `@temporalio/*` but then users that only want the client would need to refactor their imports or include the native library. It would also mean that our docs and samples should reflect these alternative APIs which isn't ideal IMHO.

I agree. Officially supporting both syntaxes would mean uncertainties for users. Not desirable.

> I'm not 100% convinced this would be a real issue, I can be convinced otherwise.

Don't count on me to convince you, I personally don't think this is an issue either ü§£  Honestly, I only mentioned the alternative for completeness.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-14 22:33:55.000 UTC</summary>

Okay then soft plan is to document: 

"Don't install the `temporalio` package if you're using yarn or pnpm. Instead, install the `@temporalio/*` packages that you import from."

Leaving this issue open for a bit to see if yarn/pnpm users have a different preference or ideas.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-21 21:56:28.000 UTC</summary>

I think it's safe to close this issue.
If anyone feels this is not solved, please reopen.

</details>


---

<a id="537"></a>

### #537: [Feature Request] Allow webpack configuration

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/537 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-14 16:40:22.000 UTC (3y 10m ago) |
| **Updated** | 2022-08-17 18:37:50.000 UTC |
| **Closed** | 2022-08-16 00:07:54.000 UTC |
| **Upvotes** | 10 |
| **Comments** | 7 |
| **Priority Score** | 27 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 10 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->
Users needing or wanting to configure webpack in various ways.
### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->
@mjameswh listed a couple ideas in https://github.com/temporalio/sdk-typescript/issues/516#issue-1162103439

> Allow users to apply more generic overrides to the Webpack config. For example, an optional property webpackConfigOverrides could be added to BundleOptions. If it is there, that property would be merged with the default/calculated Webpack configuration. Alternatively, it could be an override function, which receive the default/calculated Webpack configuration, and returns the modified configuration (this is much more flexible, and easier from our point of view, more harder to work with for developers). This is for example [how Gatsby works](https://www.gatsbyjs.com/docs/how-to/custom-configuration/add-custom-webpack-config/). This approach would not only solve the current issue, but also provide a way to deal with many other very custom needs that developers may have (think of.. Hey guys! We would like to use [define](https://webpack.js.org/plugins/define-plugin/) for our workflows üòÑ ) However, this would be more complex for developers to use, and arguably, there are not that many things that can be customized in Temporal's Webpack build process without risking breaking things.


#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-14 16:46:25.000 UTC</summary>

Related: https://github.com/temporalio/sdk-typescript/issues/483

</details>

<details>
<summary><strong>clarkdave</strong> commented on 2022-03-15 18:55:39.000 UTC</summary>

It'd be great if we could adjust the webpack config!

In particular, my team would like to turn off type checking (i.e. pass the `transpileOnly` option to the `ts-loader`), because:

- it's not needed for us because we do all our typechecking in a separate process already
- it causes workers to crash for things like unused vars (annoying in development)
- it can slow down the workflow bundle dramatically (typechecking on a large project can take tens of seconds)

It seems like it is just about possible to shim the (private) `WorkflowCodeBundler.prototype.compile` method, but it'd be a _lot_ easier if we could, say, have a method that allows to manipulate the webpack config before the compile takes place.

---

As a test, I shimmed the `WorkflowCodeBundler.prototype.compile` method so it runs ts-loader using the `transpileOnly` option and it dropped our workflow bundle duration from **12 seconds** to **300ms**, which is a huge difference.

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-16 16:50:30.000 UTC</summary>

The time it takes to bundle workflows is definitely an issue, but I think that this should not be a use case for customization of the bundler's Webpack config... People would expect fast bundling to be the default, not an advanced scenario.

But now that it has been mentioned... Is there any reason for `transpileOnly` not being enabled by default? My understanding is that `ts-loader + transpileOnly` has essentially the same "behaviour" as using `swc-loader` (#525), which would now be the current loader had it not be for the `regenerator-runtime` bug (#534). Would there still be any _significant_ advantage to using `swc-loader` instead of `ts-loader+transpileOnly`?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-17 00:00:45.000 UTC</summary>

> Is there any reason for transpileOnly not being enabled by default?

If there's a way to do that without losing the benefits you get from static type checking, I'd be totally on board.
In our samples we aim for ease of use, which is why we run with `ts-node`, I'd need to double check but if by using `ts-node` we get type checking, I think that'd be good enough.
I also checked on the `ts-loader` README and they recommend using `transpileOnly` with the [fork-ts-checker-webpack-plugin](https://github.com/Realytics/fork-ts-checker-webpack-plugin), we should look into that too.

Having said that, I'm pretty sure we'd still get requests to customize our bundler so we will probably end up making it more extensible for those (presumably) rare cases.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-17 15:14:49.000 UTC</summary>

> If there's a way to do that without losing the benefits you get from static type checking, I'd be totally on board.

Indeed. I'm also a big fan of static type checking in TS. I didn't knew that SWC actually performed type checking. That's definitely a big advantage over `ts-loader+transpileOnly`.

>In our samples we aim for ease of use, which is why we run with ts-node, I'd need to double check but if by using ts-node we get type checking, I think that'd be good enough.

I doubt this would work. `ts-node` will only typecheck TS files it gets to load at runtime. The Worker never loads workflow code inside its own execution context. The only time `ts-node` actually loads the workflow code is after it has been bundled, at which point the code is plain JS.

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2022-05-25 09:09:18.000 UTC</summary>

I see this issue got stale.
Maybe there is already a way to do this, but I would like to use absolute paths in my application instead of relative ones.
However, I can't get webpack configured to include my src directory as search path.

Is this possible in a way?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-05 19:01:41.000 UTC</summary>

Looks like this isn't possible today, we'll prioritize this and hopefully get to it soon.

</details>


---

<a id="1229"></a>

### #1229: [Feature Request] Add support for custom metrics

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1229 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-08-29 19:55:20.000 UTC (2y 4m ago) |
| **Updated** | 2025-05-21 15:15:26.000 UTC |
| **Closed** | 2025-05-21 15:15:26.000 UTC |
| **Upvotes** | 13 |
| **Comments** | 0 |
| **Priority Score** | 26 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üëç 13 |

#### Description

### Context

This is the first half of the work required to reach #1177. With https://github.com/temporalio/sdk-core/pull/544 landed, we need to:

- Update to latest Core SDK, making sure that existing Prometheus and OpenTelemetry options still work correctly;
- Add support for users to add/record metrics;
- Remove support for Tracing.

### Extra context

API should mostly follow the precedent established by [DotNET SDK](https://github.com/temporalio/sdk-dotnet/pull/129) and [Python SDK](https://github.com/temporalio/sdk-python/pull/380).


---

<a id="207"></a>

### #207: [Feature Request] Enable in-browser usage of gRPC client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/207 |
| **State** | OPEN |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-08-24 21:21:27.000 UTC (4y 4m ago) |
| **Updated** | 2024-12-17 21:16:02.000 UTC |
| **Upvotes** | 9 |
| **Comments** | 7 |
| **Priority Score** | 25 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 9 üëÄ 3 |

#### Description

### Is your feature request related to a problem? Please describe.

Some users have indicated interest in being able to use the gRPC client in the browser. Enable this.

### Describe the solution you'd like

Solution probably will need to leverage https://github.com/grpc/grpc-web 

### Additional context

Client package needs to be free of deps on not-just-proto core code


#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2021-12-10 23:43:17.000 UTC</summary>

We could make `@temporalio/client` work in the browser by replacing `grpc-js` with `grpc-web` perhaps even in the same package, e.g. https://github.com/lquixada/cross-fetch.

See related discussion here:
https://temporalio.slack.com/archives/CTRCR8RBP/p1639166317413200

</details>

<details>
<summary><strong>cretz</strong> commented on 2021-12-13 15:35:53.000 UTC</summary>

Note of course that this requires server-side support, it's not a drop-in solution. May be worth looking into existing/new efforts of REST-ifying the server instead.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-12-13 22:09:02.000 UTC</summary>

Yes, I'm aware.

It makes a lot of sense to me to expose grpc web endpoints especially because we already have a type-safe JS client which (with minimal effort) could be used in the browser.

</details>

<details>
<summary><strong>nadilas</strong> commented on 2021-12-16 11:40:01.000 UTC</summary>

> Note of course that this requires server-side support, it's not a drop-in solution. May be worth looking into existing/new efforts of REST-ifying the server instead.

Not necessarily. I am currently using `grpc-web` from the browser via envoy-proxy, which translates the web requests for the frontend. A simple sidecar or built-in proxy could do as well (e.g. https://github.com/improbable-eng/grpc-web/tree/master/go/grpcwebproxy)

</details>

<details>
<summary><strong>cretz</strong> commented on 2021-12-16 14:49:05.000 UTC</summary>

> Not necessarily. I am currently using grpc-web from the browser via envoy-proxy,

To clarify, this is what I meant by server-side support. Something must be setup on the server side currently. A built-in proxy makes plenty of sense in the Temporal server and is worth a discussion for sure.

Reactions: üëç 2

</details>

<details>
<summary><strong>burakakca</strong> commented on 2023-07-06 08:31:35.000 UTC</summary>

Currently it does not support working in temporal/client browser, is it true?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-07-06 08:38:42.000 UTC</summary>

We're working on an HTTP/1.1 API that can be used to back running the TS SDK client in a browser.

https://github.com/temporalio/api/pull/301

Reactions: üëç 3

</details>


---

<a id="1750"></a>

### #1750: [Bug] Workflow logs not propagated unless telemetryOptions.logging.filter is DEBUG or TRACE

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1750 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2025-07-24 21:19:31.000 UTC (5 months ago) |
| **Updated** | 2025-08-27 21:06:21.000 UTC |
| **Closed** | 2025-08-27 21:06:21.000 UTC |
| **Upvotes** | 7 |
| **Comments** | 10 |
| **Priority Score** | 24 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 7 |

#### Description


### Describe the bug

Using sample https://github.com/temporalio/samples-typescript/tree/main/custom-logger unless the worker 
configures core logging filter to DEBUG or TRACE, workflow application logging, i.e.,  using `log.info` in workflow code, will not show up in the logs.

This is confusing because it would be expected if telemetryOptions.logging.filter is set to INFO, a `log.info` in workflow code will be reflected in the logs

### Minimal Reproduction
Change line https://github.com/temporalio/samples-typescript/blob/main/custom-logger/src/worker.ts#L33 to

`filter: makeTelemetryFilterString({ core: 'INFO' }),`

and the log.info in 
https://github.com/temporalio/samples-typescript/blob/main/custom-logger/src/workflows/index.ts#L10

does not show up in the logs

### Environment/Versions

Latest TS SDK 1.12.1



#### Comments (10)

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-25 15:50:03.000 UTC</summary>

Ehh? That's a very surprising situation.

> This is confusing because it would be expected if `telemetryOptions.logging.filter` is set to INFO, a log.info in workflow code will be reflected in the logs

Not only that, but more importantly, the value of `telemetryOptions.logging.filter` is only ever passed to Core (i.e. to control verbosity of log messages emitted by _core_), which is not involved in collecting log messages coming from Workflows (that one is implemented using sinks).

One thing that comes to my mind‚Ä¶ When core's logs are forwarded to lang, log messages get buffered for a few miliseconds through the `NativeLogCollector` class, which ensures proper ordering of messages. The thing is that this class only flushes buffered messages when it receives a log message from Core. It could be that if core is configured at INFO, we get very few messages from Core, and so the buffer rarely gets flushed. But I would still expect the log message to eventually get flushed at some point; in the worst case, that would be on Worker shutdown. Does that matches your observation?

Reactions: üëç 1

</details>

<details>
<summary><strong>antlai-temporal</strong> commented on 2025-07-26 00:33:31.000 UTC</summary>

I don't see the messages with graceful worker shutdown. I added a `console.log("Worker gracefully shutdown"` after `await worker.run();` and then use `kill -TERM ...` to trigger worker shutdown. It prints the "Worker gracefully..." message but not the info logs from the workflow...
However, it is true that there are no more core messages after the workflow starts (with info), even after shutdown, so it could be that we need to guarantee to always flush the collector during shutdown...
Frankly, there are very few core log messages with info+, so relying on them for flushing workflow logs is a bad idea...

</details>

<details>
<summary><strong>tatejones</strong> commented on 2025-07-29 21:22:07.000 UTC</summary>

Come to think of it, I believe it maybe related to the flush as I would see them during a shutdown phase.

</details>

<details>
<summary><strong>Nielsvanbree</strong> commented on 2025-08-01 12:50:38.000 UTC</summary>

> One thing that comes to my mind‚Ä¶ When core's logs are forwarded to lang, log messages get buffered for a few miliseconds through the `NativeLogCollector` class, which ensures proper ordering of messages. The thing is that this class only flushes buffered messages when it receives a log message from Core. It could be that if core is configured at INFO, we get very few messages from Core, and so the buffer rarely gets flushed. But I would still expect the log message to eventually get flushed at some point; in the worst case, that would be on Worker shutdown. Does that matches your observation?

This looks like the core problem for what our team also experiences. After upgrading to Temporal 1.12.x we don't see any of our worker logs until we redeploy the worker: in that moment, all past logs are written in 1 go. Even if we don't deploy for a few days, the logs don't get written until we redeploy.

Setting the filter to DEBUG like @antlai-temporal showed resolved the issue for us, even though we expect it to work with INFO (which it was set to for months without issues).


</details>

<details>
<summary><strong>SamuelMS</strong> commented on 2025-08-15 23:39:06.000 UTC</summary>

Yep, I can confirm this, or something similar ‚Äì¬†our activity logs get suppressed when we use `makeTelemetryFilterString` at `INFO`, and `DEBUG`/`TRACE` are too noisy for production use. Removing the option surfaces the missing logs (which were emitted at `INFO`). We were stumped as to why our worker entrypoint was logging just fine but activities were failing until we found this issue.

</details>

<details>
<summary><strong>saniul</strong> commented on 2025-08-18 13:06:40.000 UTC</summary>

Same, can confirm this too. We've had to downgrade to `1.11.8` to ensure we can see our workflow logs in production without enabling `DEBUG` logs from the Core.

Reactions: üëç 1

</details>

<details>
<summary><strong>geuben</strong> commented on 2025-08-22 10:26:43.000 UTC</summary>

Also seeing this.

My workflow logs do get emitted when the worker process receives a SIGTERM but that's not acceptable behaviour.

Reactions: üëç 1

</details>

<details>
<summary><strong>SamuelMS</strong> commented on 2025-08-22 15:17:35.000 UTC</summary>

@mjameswh Given @geuben's comment above, maybe your guess that something's going awry with log flushing is correct?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-27 19:07:17.000 UTC</summary>

Extra note: [it has been pointed out](https://temporalio.slack.com/archives/C01DKSMU94L/p1756221182888799?thread_ts=1754500828.319189&cid=C01DKSMU94L) that this might cause a memory leak, as the LogCollector's buffer may grow to a significant number of log entries (thanks to @geuben for surfacing that aspect).

</details>

<details>
<summary><strong>antlai-temporal</strong> commented on 2025-08-27 19:25:41.000 UTC</summary>

@mjameswh This could be related to a memory leak reported by one of Temporal's customer (see https://temporalsupport.zendesk.com/agent/tickets/14825). They are using an OTEL logger combined with Winston and seeing
a clear memory leak running locally and in Cloud.

Reactions: üëç 1

</details>


---

<a id="279"></a>

### #279: [Feature Request] Plan for supporting npm modules that require ESM, eg node-fetch

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/279 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-04 18:10:21.000 UTC (4y 3m ago) |
| **Updated** | 2022-07-08 17:00:14.000 UTC |
| **Closed** | 2021-10-15 16:11:28.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 19 |
| **Priority Score** | 23 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

Right now, we have no way to support "pure ESM" node modules. our Webpack config is hardcoded to commonjs.

So @vkarpov15 [found](https://github.com/temporalio/samples-node/commit/c8a16cd888066c632f60a7531f34d46cbb239e93#comments) that importing `node-fetch@3` had an issue and had to downgrade to `node-fetch@2`.

over time, this will increasingly be a problem, as more and more of the Node ecosystem [goes pure ESM](https://blog.sindresorhus.com/get-ready-for-esm-aa53530b3f77).

### Describe the solution you'd like

"smooth" bundling solution that addresses ESM and CJS. 

#### Comments (19)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-05 04:33:40.000 UTC</summary>

I wasn‚Äôt aware es modules are not supported, they should be supported in webpack and in node.
What does the error message look like?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-05 15:48:45.000 UTC</summary>

repro: https://github.com/lorensr/samples-node/tree/fetch

```
cd activities-examples
npm i
npm start
```

```
> temporal-http@0.1.0 start
> ts-node src/worker.ts

/Users/me/gh/samples-node/activities-examples/src/activities/cancellable-fetch.ts:8
  if (contentLengthHeader === null) {
                                     ^
Error [ERR_REQUIRE_ESM]: require() of ES Module /Users/me/gh/samples-node/activities-examples/node_modules/node-fetch/src/index.js from /Users/me/gh/samples-node/activities-examples/src/activities/cancellable-fetch.ts not supported.
Instead change the require of index.js in /Users/me/gh/samples-node/activities-examples/src/activities/cancellable-fetch.ts to a dynamic import() which is available in all CommonJS modules.
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/src/activities/cancellable-fetch.ts:8:38)
    at Module.m._compile (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/index.js:704:29)
    at Object.require.extensions.<computed> [as .ts] (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/index.js:706:16)
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/src/activities/index.ts:10:27)
    at Module.m._compile (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/index.js:704:29)
    at Object.require.extensions.<computed> [as .ts] (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/index.js:706:16)
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/src/worker.ts:27:33)
    at Module.m._compile (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/index.js:704:29)
    at Object.require.extensions.<computed> [as .ts] (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/index.js:706:16)
    at main (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/bin.js:237:16)
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/node_modules/ts-node/dist/bin.js:350:5) {
  code: 'ERR_REQUIRE_ESM'
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-05 15:57:01.000 UTC</summary>

Could this be a ts node issue? Did you try with node?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-05 15:58:32.000 UTC</summary>

```
$ node lib/worker.js
/Users/me/gh/samples-node/activities-examples/lib/activities/cancellable-fetch.js:8
const node_fetch_1 = __importDefault(require("node-fetch"));
                                     ^

Error [ERR_REQUIRE_ESM]: require() of ES Module /Users/me/gh/samples-node/activities-examples/node_modules/node-fetch/src/index.js from /Users/me/gh/samples-node/activities-examples/lib/activities/cancellable-fetch.js not supported.
Instead change the require of index.js in /Users/me/gh/samples-node/activities-examples/lib/activities/cancellable-fetch.js to a dynamic import() which is available in all CommonJS modules.
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/lib/activities/cancellable-fetch.js:8:38)
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/lib/activities/index.js:10:27)
    at Object.<anonymous> (/Users/me/gh/samples-node/activities-examples/lib/worker.js:27:33) {
  code: 'ERR_REQUIRE_ESM'
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-05 16:25:34.000 UTC</summary>

What happens if you just run node lib/activities.js?
If you get the same error this is probably an issue with node fetch

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-05 16:26:47.000 UTC</summary>

You can also confirm by trying to import a different es module

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-05 17:45:26.000 UTC</summary>

> What happens if you just run node lib/activities.js?

Same error. Got it working by having TypeScript output ESM, but that results in a new error from the worker:

repro: https://github.com/lorensr/samples-node/tree/fetch-esm


```
$ node lib/worker.js
(node:12420) ExperimentalWarning: stream/web is an experimental feature. This feature could change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
2021-10-05T17:37:34.763Z [INFO] asset main.js 4.24 KiB [emitted] (name: main)
2021-10-05T17:37:34.764Z [INFO] runtime modules 274 bytes 1 module
2021-10-05T17:37:34.764Z [INFO] ../../../../../src/main.js 704 bytes [built] [code generated]
2021-10-05T17:37:34.764Z [INFO] webpack 5.54.0 compiled successfully in 73 ms
2021-10-05T17:37:34.782Z [INFO] Worker state changed { state: 'RUNNING' }
2021-10-05T17:37:34.807Z [ERROR] Failed to activate workflow {
  runId: '1fe38040-3e24-403c-830d-3190b0ab8309',
  error: ReferenceError: require is not defined
      at eval (webpack-internal:///../../../../../src/main.js:2:13)
      at Object.../../../../../src/main.js (workflow-isolate:20:1)
      at workflow-isolate:47:60
      at workflow-isolate:50:12
      at (<isolated-vm boundary>)
      at getContext (/Users/me/gh/samples-node/activities-examples/node_modules/@temporalio/worker/lib/isolate-context-provider.js:25:22),
  workflowExists: false
}
2021-10-05T17:37:44.808Z [ERROR] Failed to activate workflow {
  runId: '1fe38040-3e24-403c-830d-3190b0ab8309',
  error: ReferenceError: require is not defined
      at eval (webpack-internal:///../../../../../src/main.js:2:13)
      at Object.../../../../../src/main.js (workflow-isolate:20:1)
      at workflow-isolate:47:60
      at workflow-isolate:50:12
      at (<isolated-vm boundary>)
      at getContext (/Users/me/gh/samples-node/activities-examples/node_modules/@temporalio/worker/lib/isolate-context-provider.js:25:22),
  workflowExists: false
}
```


</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-06 18:45:36.000 UTC</summary>

Interesting, webpack supports both commonjs and esm.
Looks like it's the dynamic loading that's causing these issues.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-13 14:21:18.000 UTC</summary>

Moved out of the beta milestone.

</details>

<details>
<summary><strong>schickling</strong> commented on 2021-10-14 12:16:05.000 UTC</summary>

Running into the same problem when I've set ` "type": "module",` in my `package.json` (which is become the default for new codebases).

This will also require the following code change:

```ts
  const workflowsPath = new URL('./workflows.js', import.meta.url).toString().replace(/^file:\/\//, '')
  // const workflowsPath = require.resolve('./workflows.js') // instead of this
  const worker = await Worker.create({
    workflowsPath,
```

Reactions: üëç 2

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-14 20:33:48.000 UTC</summary>

We should probably support `URL` in as a param to workflowsPath.
I'll look into why webpack is failing.
Looks like ts-node also doesn't work well with modules.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-14 22:02:55.000 UTC</summary>

I've hacked away until I finally got webpack to support ESM.
My current solution feels a bit too hacky though.
I'll keep working on it until I find a good solution.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 04:09:46.000 UTC</summary>

After cleaning up, I realized it was actually pretty easy to support this.
Note that with ESM imports the [file extension is mandatory](https://nodejs.org/api/esm.html#esm_mandatory_file_extensions) and I couldn't get it running with `ts-node`.
AFAICT this is `ts-node` support is still WIP, see https://github.com/TypeStrong/ts-node/issues/1007.

I considered supporting URLs in `workflowsPath` and `nodeModulesPaths` but I think there's not that much value in it.

```ts
const workflowsPath = new URL('./workflows.js', import.meta.url).pathname;
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 04:33:43.000 UTC</summary>

Got it working with `ts-node` esm loader by changing workflowPath to:
```ts
// support running both complied code and ts-node/esm loader
const workflowsPath = new URL(`./workflows${path.extname(import.meta.url)}`, import.meta.url).pathname;
```

```bash
node --experimental-specifier-resolution=node --loader ts-node/esm src/worker.ts
```

Reactions: üéâ 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 04:36:21.000 UTC</summary>

Sample can be found here: https://github.com/temporalio/samples-node/compare/esm?expand=1

</details>

<details>
<summary><strong>schickling</strong> commented on 2021-10-15 06:59:22.000 UTC</summary>

Thanks for pushing this forward @bergundy üöÄ 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 16:13:18.000 UTC</summary>

No problem, better now than later :)

Reactions: üëç 2

</details>

<details>
<summary><strong>gajus</strong> commented on 2022-07-08 10:12:34.000 UTC</summary>

This does work, but I am getting a warning about missing sourcemaps.

```
2022-07-08T10:11:29.956Z [INFO] WARNING in ./node_modules/@temporalio/workflow/lib/workflow.js
2022-07-08T10:11:29.956Z [INFO] Module Warning (from ./node_modules/source-map-loader/dist/cjs.js):
2022-07-08T10:11:29.956Z [INFO] Failed to parse source map from '/Users/gajus/Documents/dev/gajus/repchad/node_modules/@temporalio/workflow/src/workflow.ts' file: Error: ENOENT: no such file or directory, open '/Users/gajus/Documents/dev/gajus/repchad/node_modules/@temporalio/workflow/src/workflow.ts'
2022-07-08T10:11:29.956Z [INFO] Error: Failed to parse source map from '/Users/gajus/Documents/dev/gajus/repchad/node_modules/@temporalio/workflow/src/workflow.ts' file: Error: ENOENT: no such file or directory, open '/Users/gajus/Documents/dev/gajus/repchad/node_modules/@temporalio/workflow/src/workflow.ts'
2022-07-08T10:11:29.956Z [INFO]     at fetchFromFilesystem (/Users/gajus/Documents/dev/gajus/repchad/node_modules/source-map-loader/dist/utils.js:129:11)
2022-07-08T10:11:29.956Z [INFO]     at runNextTicks (node:internal/process/task_queues:60:5)
2022-07-08T10:11:29.956Z [INFO]     at processImmediate (node:internal/timers:442:9)
2022-07-08T10:11:29.956Z [INFO]     at async fetchFromURL (/Users/gajus/Documents/dev/gajus/repchad/node_modules/source-map-loader/dist/utils.js:239:9)
2022-07-08T10:11:29.956Z [INFO]     at async /Users/gajus/Documents/dev/gajus/repchad/node_modules/source-map-loader/dist/index.js:105:11
2022-07-08T10:11:29.956Z [INFO]     at async Promise.all (index 0)
2022-07-08T10:11:29.956Z [INFO]     at async Object.loader (/Users/gajus/Documents/dev/gajus/repchad/node_modules/source-map-loader/dist/index.js:89:27)
2022-07-08T10:11:29.956Z [INFO]  @ ./node_modules/@temporalio/workflow/lib/index.js 93:13-34
2022-07-08T10:11:29.956Z [INFO]  @ ./src/workflows.ts 1:0-55 2:19-34
2022-07-08T10:11:29.956Z [INFO]  @ ./src/workflows-entrypoint-bce092c5-4064-45b4-9502-b007ae936111.js
```

Not entirely clear what is the fix.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-08 17:00:14.000 UTC</summary>

This will be fixed in the next release, coming soon.

</details>


---

<a id="443"></a>

### #443: [Feature Request] Improve default data converter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/443 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-01-10 02:06:30.000 UTC (4 years ago) |
| **Updated** | 2023-05-11 17:24:40.000 UTC |
| **Closed** | 2023-05-11 17:24:40.000 UTC |
| **Upvotes** | 4 |
| **Comments** | 13 |
| **Priority Score** | 21 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 4 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Users expect that when they return or pass a `Date`, they'll receive a `Date`. Instead, they receive an ISO string. 

[Repro](https://github.com/lorensr/samples-node/commit/8ec2ef538f276bd40d07fe021392865e20beb3bf)
[User feedback on slack](https://temporalio.slack.com/archives/C01DKSMU94L/p1641736724022000)

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

It would be helpful if they received `Date`s and other types lost during `JSON.parse`.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

Slack discussions:
- https://temporalio.slack.com/archives/C01DKSMU94L/p1641779190022800?thread_ts=1641736724.022000&cid=C01DKSMU94L
- https://temporalio.slack.com/archives/C01DKSMU94L/p1645146054222929
- https://temporalio.slack.com/archives/C01DKSMU94L/p1648694634475969?thread_ts=1648684821.751929&cid=C01DKSMU94L

#### Comments (13)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-02 19:34:55.000 UTC</summary>

I'm not convinced we should solve this issue.
Date isn't part of the JSON spec, there are of course ways to support it but we'd need a cross SDK solution.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-02 19:43:47.000 UTC</summary>

We could publish a custom data converter, and clearly in the docs say:

Note: the default Data Converter doesn't support Date, Y, Z, because it uses JSON for compatibility with the other SDKs. If you're only using the TS SDK (or can create equivalent custom data converters in your other SDK), you can use `MsgpackPayloadConverter`, which supports Date, Y, and Z:

```ts
import { MsgpackPayloadConverter } from `@temporalio/common/converter/msgpack`

...
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-03 01:03:31.000 UTC</summary>

This is one (probably incomplete) approach where users can keep using JSON and have date serialization:

```js
// Unique prefix to add to date strings so they don't get mixed up with other ISO date strings
const prefix = "5062374f-3be6-4562-84f4-984a49678e13_date_";
function maybeSerializeDate(o) {
  if (o instanceof Date) {
    return `${prefix}${o.toJSON()}`;
  }
  return o;
}

function customJSONSerializer(o) {
  return JSON.stringify({ wrapped: o }, (k, v) => {
    if (Array.isArray(v)) {
      return v.map(maybeSerializeDate);
    }
    if (typeof v === "object" && v != null) {
      return Object.fromEntries(
        Object.entries(v).map(([e, vv]) => [e, maybeSerializeDate(vv)])
      );
    }
    return v;
  });
}

function customJSONDeserializer(s) {
  return JSON.parse(s, (k, v) => {
    if (typeof v === "string" && v.startsWith(prefix)) {
      return new Date(v.replace(prefix, ""));
    }
    return v;
  }).wrapped;
}

const s = customJSONSerializer({ d: new Date(), arr: [new Date()] });
console.log(s);
const revived = customJSONDeserializer(s);
console.log(revived);

```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-22 17:50:52.000 UTC</summary>

Looked at [OData](https://www.odata.org/documentation/odata-version-2-0/json-format/) and searched for others, but most popular least seems like it might be [EJSON](https://docs.mongodb.com/manual/reference/mongodb-extended-json/?_ga=2.110350661.1777308973.1647907483-776353751.1647907483), which converts `Date`s and their `Binary` type:

<img width="424" alt="image" src="https://user-images.githubusercontent.com/251288/159542368-0bdc0e29-3154-4565-a726-5807ab63d958.png">

<img width="552" alt="image" src="https://user-images.githubusercontent.com/251288/159543675-4fb1997a-a3a0-4b45-9b2f-566e5463097e.png">

Thinking of doing a sample `EjsonPayloadConverter`, and maybe we'll bring it into the SDK.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-22 18:38:39.000 UTC</summary>

That would work, I'm wondering if it's even worth making it the default since this is proven to be a pain for users.
The caveat would be that it wouldn't be a polyglot solution.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-03-23 13:27:30.000 UTC</summary>

> I'm wondering if it's even worth making it the default since this is proven to be a pain for users.

That pain exists in the JS JSON ecosystem as a whole. How would they send the JSON over `fetch` or use `Response.json()` to get JSON back if we were talking HTTP here? I vote we stick with the native JSON.stringify/JSON.parse by default and just make sure these other formats easily opt-in.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-23 20:16:23.000 UTC</summary>

I think the surprise comes from it not looking like you're making network requests, and the typing.

In workflow:

```ts
await activityFn(new Date())
```

Activity:

```ts
export activityFn(when: Date): number { 
  return when.getDate()
}
```

It compiles fine, but fails at runtime. 

Of course, they'll probably reach this point anyway, when trying to send instances of their own models: `activityFn(new User())` and calling User methods in the Activity. Wondering about a more general-purpose DC where the user registers all their classes, and it serializes and re-instantiates instances. 

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-03-23 20:27:51.000 UTC</summary>

This is the cost of Temporal's abstractions. Just because we abstract that things need to be serialized doesn't mean we need to support all serializable things. What's next, `BigInt`? `RegExp`? I think default JSON w/ opt-in helpers is ideal.

> Wondering about a more general-purpose DC where the user registers all their classes, and it serializes and re-instantiates instances.

I think this is definitely reasonable for opt-in. `dataConverter = CustomClassDataConverter({ encoding: "my-encoding", classes: [MyClass1, MyClass2] })` where each class must have a static `deserialize` and a non-static `serialize`. But that isn't a default thing.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-23 21:28:20.000 UTC</summary>

I agree that we can't solve all of these cases, date is pretty standard so it might be worth an exception but, yeah, it's debatable if we should support it OOTB.

We can't take the class approach for serialization either BTW because we don't know have the function signature at runtime.
There was a proposal to add annotations to the SDK but it was rejected.

At some point we might want to add TS only features to get signatures at runtime.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-03-23 21:42:05.000 UTC</summary>

> because we don't know have the function signature at runtime.

Why do you need the signatures in JS? On to-payload you check whether the object has `serialize` (or `temporalSerialize` or whatever), invoke it, and use the metadata to maintain the class type (`.constructor.name`). Then on from-payload, just to the lookup and invoke the matching `deserialize` static call on the class prototype. Yes it means JS users can pass something that doesn't have `serialize`, but such is life in untyped JS.

Reactions: üëç 2

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-04-17 18:31:42.000 UTC</summary>

Would like to say early on in docs:

When building a TypeScript-only project (one where all the Clients and Workers use the TS SDK, versus a mix of different language SDKs), we recommend using `EjsonCompositePayloadConverter`, which supports:

- Dates (`Date`)
- Binary (`Uint8Array`)
- Special numbers (`NaN`, `Infinity`, and `-Infinity`)
- Regular expressions (`RegExp`)

as well as custom types.

```ts
// payload-converter.ts
import { EjsonCompositePayloadConverter } from '@temporalio/common/lib/ejson'
export const payloadConverter = new EjsonCompositePayloadConverter()

// data-converter.ts
export const dataConverter = { payloadConverterPath: require.resolve('./payload-converter') }

// worker.ts
import { dataConverter } from './data-converter.ts'
const worker = await Worker.create({
  dataConverter,
  ...
});

// client.ts
import { dataConverter } from './data-converter.ts'
const client = new WorkflowClient(new Connection().service, {
  dataConverter,
});
```

Or could simplify, for cases in which codecs aren't needed, with:

```ts
// data-converter.ts
import { EjsonDataConverter } from '@temporalio/common/lib/ejson'
export const dataConverter = new EjsonDataConverter()

// worker.ts
import { dataConverter } from './data-converter.ts'
const worker = await Worker.create({
  dataConverter,
  ...
});

// client.ts
import { dataConverter } from './data-converter.ts'
const client = new WorkflowClient(new Connection().service, {
  dataConverter,
});
```

---

This would involve adding the EJSON sample to `packages/common`: 

https://github.com/temporalio/samples-typescript/tree/main/ejson

and documenting how to use `addType`:

![image](https://user-images.githubusercontent.com/251288/163727292-aba140b3-b2dd-4910-966d-0df0560fb8d5.png)


</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-18 15:22:52.000 UTC</summary>

@lorensr that would be a good approach for TS only, I'm wondering if there's a better cross language solution or if we even need one if we have protobuf DCs.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 17:24:40.000 UTC</summary>

We're not doing this for now, let's close to avoid stacking up issues

</details>


---

<a id="1615"></a>

### #1615: [Bug] Cannot use Temporal with NextJS 15 because workflowTypes come from function names

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1615 |
| **State** | OPEN |
| **Author** | rclmenezes (Rodrigo Menezes) |
| **Created** | 2025-01-28 23:19:25.000 UTC (11 months ago) |
| **Updated** | 2025-10-11 05:50:34.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 14 |
| **Priority Score** | 20 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 |

#### Description

### What are you really trying to do?

Use Temporal with NextJS 15 in production

### Describe the bug

Temporal Typescript uses the function name as the workflow type. This causes issues when the code is minified.

When using NextJS, the function names get mangled by default. In NextJS <=14, you could set `swcMinify: false` in your next-config to get around this issue:
https://github.com/vercel/next.js/issues/74332#issuecomment-2620236458

However, that is not an option in Next 15, which disabled swcMinify as an option. The only option there is to make a custom webpack config to disable optimization altogether.

### Minimal Reproduction

The official example of nextjs-temporal breaks:
https://github.com/temporalio/nextjs-temporal-one-click-template/issues/3

### Environment/Versions

All of them

### Additional context

I think Temporal Typescript's SDK should support minification, full stop. Users shouldn't have to make a magic webpack config to make things happen.

#### Comments (14)

<details>
<summary><strong>rclmenezes</strong> commented on 2025-01-28 23:50:34.000 UTC</summary>

One hack around I tried: export your workflows separately as an object:

``` typescript
import * as workflows from "./workflows";

export { workflows };
```

And then you can import the object instead:

```typescript
      await temporalClient.workflow.start(workflows.myWorkflow, {
        args: [],
        taskQueue: TEMPORAL_TASK_QUEUE,
        workflowId: `whatever`,
      });
```

EDIT: nope this doesn't work either.

</details>

<details>
<summary><strong>rclmenezes</strong> commented on 2025-01-30 00:32:16.000 UTC</summary>

Here's a solution that worked -- disabling minification on the server. Here's my next-js config:

```typescript
export default {
  webpack: (config) => {
    if (config.name === "server") {
      // Disable minification for server builds to avoid temporal build errors
      config.optimization.minimize = false;
    }
    return config;
  },
};
```

It sucks that we have to do this. Using function names is not great in the long run. Maybe a decorator is a better long-term solution, or turning workflows into classes of some kind.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-30 23:26:51.000 UTC</summary>

I totally understand how this kind of things can be frustrating, and I do agree that we need to improve the overall developer experience for Temporal + Next.js users.

My plan is to eventually provide plugins to ease integration between Temporal TS SDK and other major frameworks. The present issue could very easily be resolved by such a plugin, e.g. by having the plugin apply specific AST transformations during the bundling process.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-30 23:42:58.000 UTC</summary>

> Using function names is not great in the long run. Maybe a decorator is a better long-term solution, or turning workflows into classes of some kind.

Sorry, I strongly disagree on this.

The difficulties you describe are the result of conflicting DX optimizations made respectively by the Temporal SDK and the Next.js teams, which are both sensible defaults for our respective community.

- On the Next.js side ‚Äî There is technically no strong requirement for bundling, minimizing and optimizing the _backend_ code, but the Next.js community recognized that most developers would appreciate the reduced deployment size, and therefore decided to enable those options by default, leaving the possibility for users _to opt out_ of that feature by using a configuration hook.

- On the Temporal side ‚Äî A Workflow Type is really just a simple string. We however recognized that most of our developers would appreciate the type safety provided by passing the Workflow function object, and therefore chose to promote that approach in most of our samples; users may however opt out of that feature by passing raw strings rather than functions. Similarly, we chose to define Workflow implementations as publicly exported functions on a module because we recognized that most of our users would appreciate the simplicity of that model; users may however opt in to implement alternate mapping logic (e.g. Workflows as classes or methods) by registering a single default Workflow function.

Default behaviors on both sides are sensible and in the best interest of our respective communities. They only conflict when trying to combine both libraries' defaults in a same project, at which point one needs to do some extra work or to simply opt out to some feature in either libraries.

Would it make sense to say that "Next.js stripping the name property on functions on backend code is not great in the long run"? Obviously not. That decision makes sense for most users in the Next.js community.

Similarly, the patterns we encourage regarding Workflow definition make sense for most users of the Temporal TypeScript SDK. A user may easily implement alternate approaches, including decorator functions and classes. But those alternatives also have drawbacks, and would definitely not be in the interest of most users.

</details>

<details>
<summary><strong>rclmenezes</strong> commented on 2025-01-31 00:21:30.000 UTC</summary>

Thanks for the in-depth response, James.

Framing it as "sensible defaults" on both sides make sense. That said -- I'm surprised that I'm the first to bring this up! I would have thought that most other batteries-included frameworks like Remix minimize backend code by default as well, but if I'm the first to bring this up, then I might be wrong!

Providing a NextJS plugin as a paved path could be a very neat approach. Or at least making the sample repo work in production :)

As an aside... I never knew that `client.workflow.start` takes a raw string as well as a function! That's a really great escape hatch. I wish I saw that in the docs. It opens the door to a lot of custom solutions as you suggest.

I still think that an _optional_ decorator could be a great approach where we keep existing defaults and provide a nice paved path:

```typescript
import {temporalWorkflow} from "temporalio/workflow";

@temporalWorkflow(workflowType='myWorkflow')
function myWorkflow() {
    ...
}
```

In this scenario, `workflow.start` could default back to the function name if some special attribute like `fn.workflowName` isn't present

For now, if I want minification, I'll probably make a quick and dirty custom wrapper for `client.workflow.start`:

```typescript
const workflows: Record<string, WorkflowFn> = {};

async function startFlow<Name extends keyof typeof workflows>(name: Name, args: Parameters<typeof workflows[Name]>[0], workflowId: string) {
  const client = await getTemporalClient();
  return client.workflow.start(name, {
    args: [args],
    taskQueue: TEMPORAL_TASK_QUEUE,
    workflowId,
  });
}
```

Thanks again

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-31 03:49:29.000 UTC</summary>

> I still think that an optional decorator could be a great approach where we keep existing defaults and provide a nice paved path:
> 
> ```
> import {temporalWorkflow} from "temporalio/workflow";
> 
> @temporalWorkflow(workflowType='myWorkflow')
> function myWorkflow() {
>     ...
> }
> ```

Yeah, we would have done that a very long time ago if that was possible, but unfortunately, decorators  (both the ECMAScript Stage 3 proposal _and_ the TypeScript's current spec) only support classes/methods/props‚Ä¶ Not simple functions.

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-31 03:58:24.000 UTC</summary>

> For now, if I want minification, I'll probably make a quick and dirty custom wrapper for client.workflow.start:
> 
> ```
> const workflows: Record<string, WorkflowFn> = {};
> 
> async function startFlow<Name extends keyof typeof workflows>(name: Name, args: Parameters<typeof workflows[Name]>[0], workflowId: string) {
>   const client = await getTemporalClient();
>   return client.workflow.start(name, {
>     args: [args],
>     taskQueue: TEMPORAL_TASK_QUEUE,
>     workflowId,
>   });
> }
> ```
> 

Yeah, that would work.

Another possibility is to make a proxy object that has the type of your workflow.ts module, but simply return the property name as a string. As a proof of concept, I was able to get the nextjs-ecommerce-oneclick sample running in prod mode by adding this at the top of the `startBuy.js` file:

```
/**
 * @type {import('../../temporal/lib/workflows.js')}
 */
const workflows = new Proxy({}, {
  get: (target, prop) => {
    return prop;
  }
})
```

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-31 04:16:31.000 UTC</summary>

> I would have thought that most other batteries-included frameworks like Remix minimize backend code by default as well

Nowadays, yes, but that's kind of a new thing. Back a few years ago, bundlers were all about frontend stuff. On the server side, you'd always have a `node_modules` directory.

I'd say that IMHO, a major contribution to that trend is that most frameworks are now backed by companies that want to sell you hosting services for your app, so they design the tooling to be very efficient to host, even if that means being less convenient for the developers. And once developers know that they _could_ minimize their backend code, they feel like they are missing something if they don't.

This has a few drawbacks, notably with libraries that have native dependencies, that load files dynamically at runtime (e.g. plugins, languages files, etc), and those that depends on preserving exact properties names and objects names (including Temporal, of course, but also Protobuf, ORMs, and others). That's why most of those frameworks maintain some internal list of libraries known to be non-minimizable safe (see [Next.js](https://github.com/vercel/next.js/blob/cdb275c7b8d77afc27026584e2b0c15448d9688c/packages/next/src/lib/server-external-packages.json#L4)), but in this particular case, it is _your_ code, and not Temporal's NPM packages, that need special handling, so that list can't help.

Reactions: üëÄ 1

</details>

<details>
<summary><strong>rclmenezes</strong> commented on 2025-01-31 21:14:51.000 UTC</summary>

> decorators (both the ECMAScript Stage 3 proposal and the TypeScript's current spec) only support classes/methods/props‚Ä¶ Not simple functions.

Ugh, I didn't know that. I honestly never use decorators in TS, they're a little too Python-y for me.

> Another possibility is to make a proxy object that has the type of your workflow.ts module, but simply return the property name as a string.

I like it -- thanks!

For now, I'm probably just going to disable minification and call it a day. I'm hosting on ECS anyway.

> I'd say that IMHO, a major contribution to that trend is that most frameworks are now backed by companies that want to sell you hosting services for your app, so they design the tooling to be very efficient to host, even if that means being less convenient for the developers. 

You're 100% right about this. My favorite example is actually Next.js middleware. It's so custom built for their own edge infrastructure that it's practically useless.

Literally every other framework I've used in my career has middleware that sees both request and response so you can log or have custom error class handling or identify users in Sentry or whatever. Instead, I have to make a custom wrapApiHandler fo things like this... or move my API to a separate service entirely and deal with the extra infra. What a mess!



Anyway, thanks again! 



Reactions: üëç 1

</details>

<details>
<summary><strong>gregbrowndev</strong> commented on 2025-02-08 19:56:29.000 UTC</summary>

@rclmenezes I just got burnt by this, too. Putting this here to help others land on this thread:

```
TypeError: Failed to initialize workflow of type 'tY': no such function is exported by the workflow bundle
``` 

This is because NextJS' production build minifies the Temporal SDK code used to start the workflows. This is the first TypeScript project I've set up with Temporal (done a lot of work with the Python SDK), so I'm contending with multiple build challenges to get an app into production. It's particularly challenging as NextJS also uses tsconfig paths. So I went down a rabbit hole thinking it was something wrong with the worker / workflow bundle / webpack config / tsx/ts-node, etc. etc. I feel pretty dumb now as I can see in the Temporal UI the workflow was triggered with type "tY", so the issue was coming from upstream üò© 

Thanks, @mjameswh for all the helpful info in this thread. Personally, I do hope TS moves towards fully ahead-of-time compiled executables like Bun's build tool. I think that would be awesome, but it is interesting to see the angle that hosting services are pushing it. 

</details>

<details>
<summary><strong>gregbrowndev</strong> commented on 2025-02-09 11:08:18.000 UTC</summary>

To build on the suggested solutions, you can use the string-based argument but still set the type param as appropriate (I've used this approach to call Python-based workflows from TS)

```ts
  // kick off the purchase async
  await getTemporalClient().workflow.start<typeof OneClickBuy>("OneClickBuy", {
    taskQueue: 'ecommerce-oneclick',
    workflowId: transactionId,
    args: [itemId],
  });
```

This will give you type-safety on `args` and the handle if you need it for later.

The name mangling doesn't seem to affect signals/queries, though. 

</details>

<details>
<summary><strong>pilsy</strong> commented on 2025-02-21 18:01:27.000 UTC</summary>

I implemented support for using Decorators to define workflows using classes, the way i got around the function name being the entry point is:

```typescript
/**
 * Temporal Decorator
 *
 * A class decorator that transforms a TypeScript class into a Temporal workflow function.
 * This decorator handles the registration, initialization, and lifecycle management of workflows
 * in the TemporalForge framework.
 *
 * Key Features:
 * - Automatically registers the class as a Temporal workflow
 * - Manages workflow initialization and lifecycle events
 * - Handles workflow naming and task queue assignment
 * - Provides automatic error handling and cancellation support
 * - Supports dynamic class extension for non-Workflow classes
 *
 * The decorator performs the following operations:
 * 1. Ensures the class extends the Workflow base class (creates dynamic extension if needed)
 * 2. Sets up workflow metadata and configuration
 * 3. Binds event handlers, hooks, and signals
 * 4. Manages workflow execution flow and error handling
 *
 * @param options - Configuration options for the workflow
 * @returns A class decorator function that transforms the target class into a Temporal workflow
 */
export function Temporal(options?: TemporalOptions) {
  return function (constructor: any) {
    const { name: optionalName, taskQueue, tracerName = 'temporal_worker', ...extraOptions } = options || {};
    const workflowName: string = optionalName ?? constructor.name;

    if (!(constructor.prototype instanceof Workflow)) {
      abstract class DynamicTemporal extends Workflow {
        constructor(params: any, options: TemporalOptions = {}) {
          super(params, options);
          Object.assign(this, new constructor(params, options));
        }
      }
      constructor = DynamicTemporal;
    }

    const construct = new Function(
      'workflow',
      'constructor',
      'extraOptions',
      `
      return async function ${workflowName}(...args) {
        extraOptions.workflowType = '${workflowName}';
        const instance = new constructor(args[0], extraOptions);

        try {
          await instance.bindEventHandlers();
          await instance.emitAsync('setup');
          await instance.emitAsync('hooks');
          await instance.emitAsync('init');

          const executionMethod = instance.continueAsNew
            ? 'executeWorkflow'
            : 'execute';

          return await instance[executionMethod](...args);
        } catch (e) {
          if (workflow.isCancellation(e)) {
            await workflow.CancellationScope.nonCancellable(async () => {
              await workflow.condition(() => instance.status === 'cancelled');
            });
          }
          throw e;
        }
      }
    `
    )(workflow, constructor, extraOptions);

    return construct;
  };
}
```

You can checkout the npm package here - https://github.com/pilsy/chrono-forge/blob/main/README.md
List of decorators here - https://github.com/pilsy/chrono-forge/tree/main/src/decorators

Here is an example:
```typescript
import {
  Property,
  Temporal,
  StatefulWorkflow,
  StatefulWorkflowParams,
  StatefulWorkflowOptions,
  ManagedPaths,
  SchemaManager,
  Signal,
  Query,
  Before,
} from "temporal-forge";

import type { Vendor as VendorModel, Product as ProductModel } from "../types";

import { proxyActivities } from "@temporalio/workflow";
import type * as activities from "../activities";

const { getVendor } = proxyActivities<typeof activities>({
  retry: {
    initialInterval: 1000 * 60,
    maximumAttempts: 30,
  },
});

@Temporal({
  schemaName: "Vendor",
  schemas: SchemaManager.schemas,
})
export class VendorWorkflow extends StatefulWorkflow<
  StatefulWorkflowParams<VendorModel>,
  StatefulWorkflowOptions
> {
  protected managedPaths: ManagedPaths = {
    products: {
      autoStart: true,
      entityName: "Product",
      workflowType: "ProductWorkflow",
    },
  };

  // implement so that data may be loaded using an activity
  protected async loadData() {
    return {
      data: await getVendor(this.id),
    };
  }

  @Property({ path: "name" })
  protected name!: string;

  // this decorator sets up query and signal, and automatically maps via proxy to this.data.products
  @Property({ path: "products" })
  protected products!: ProductModel[];

  // provides a signal named "mySignal"
  @Signal()
  async mySignal() {
    console.log(`[Vendor]-(${this.id}):mySignal()...`);
  }

  // provides a query named "customQuery"
  @Query("customQuery")
  async myQuery() {
    console.log(`[Vendor]-(${this.id}):myQuery()...`);
  }

  // Uses the @Hook decorator to run code before the execute method
  @Before("execute")
  async beforeExecute() {
    console.log(`[Vendor]-(${this.id}):beforeExecute()...`);
  }

  protected async execute() {
    console.log(`[Vendor]-(${this.id}):execute()-> running...`);
  }
}
```

Reactions: üëç 2 üöÄ 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-30 06:42:30.000 UTC</summary>

@pilsy If you haven't done so yet, I would strongly encourage you to share your project on [Temporal's Code Exchange](https://temporal.io/code-exchange). I know that many Temporal TS developers are looking for this kind of class+decorator experience.

</details>

<details>
<summary><strong>bgw</strong> commented on 2025-10-10 22:14:52.000 UTC</summary>

üëã Reporting in from the Turbopack team here.

First off, sorry that this is causing pain for folks. The last thing we want are breakages when updating Next.js or migrating from webpack. With [Turbopack becoming default in Next 16](https://nextjs.org/blog/next-16-beta#turbopack-stable), we want to make sure there‚Äôs a good solution for users of Temporal and Next.js.

I don‚Äôt think that disabling mangling or minification is a good idea. Bundling and compressing server-side code is part of how Next.js and ‚Äúserverless‚Äù platforms like Vercel, Cloudflare, and Netlify reduce cold-start times.

It seems like the culprit is relying on the `name` property for functions here: [https://github.com/temporalio/sdk-typescript/blob/9a67b062c9a985475ccf0b7c443bd5feaebd046a/packages/common/src/workflow-options.ts#L262-L273](https://github.com/temporalio/sdk-typescript/blob/9a67b062c9a985475ccf0b7c443bd5feaebd046a/packages/common/src/workflow-options.ts#L262-L273)

## Function Names are *never* Guaranteed

A function‚Äôs `name` property is defined in the spec as:

> a String that is descriptive of the function. The name **has no semantic significance** but is **typically** a variable or property name that is used to refer to the function at its point of definition in ECMAScript source text.
> 

‚Äî [https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-function-instances-name](https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-function-instances-name)

While the function name is typically the one used in the source text, the specification doesn‚Äôt actually make any guarantees about function names.

Because the vast majority of applications don‚Äôt (and shouldn‚Äôt!) care about function names, and because function names tend to be quite long, minifiers (like SWC, OXC, and Terser) often take advantage of this to perform name ‚Äúmangling‚Äù:

> Be careful when using the name property with source-code transformations, such as those carried out by JavaScript compressors (minifiers) or obfuscators. These tools are often used as part of a JavaScript build pipeline to reduce the size of a program prior to deploying it to production. Such transformations often change a function's name at build time.
> 

‚Äî [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name#javascript_compressors_and_minifiers](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name#javascript_compressors_and_minifiers)

Runtimes that perform ahead-of-time compilation, like Hermes, may also choose to strip function names for similar reasons.

In addition to minification, bundler scope hoisting implementations may also choose to rename functions to avoid conflicts in the hoisted module.

Whether or not a specific function name is mangled depends on the minifier chosen and how a number of internal transformations interact. Just because a function name isn‚Äôt mangled with one version of Webpack or Vite doesn‚Äôt mean it won‚Äôt be mangled with the next version.

Whether or not the name actually gets mangled by a specific bundler, you cannot depend on function names for correctness. Mangled function names can change between builds due to the shape of the module graph and internal heuristics.

**The only valid use case of function names is for debugging**, typically against a development build.

## Related: How Does React Handle This?

React has a similar problem, as it uses the function‚Äôs name in the React dev tools, but sometimes those functions are anonymous or dynamically-generated (e.g. in the case of higher order components).

For this purpose, their dev tools will first look for a `.displayName` property:

- [https://legacy.reactjs.org/docs/react-component.html#displayname](https://legacy.reactjs.org/docs/react-component.html#displayname)
- [https://legacy.reactjs.org/docs/higher-order-components.html#convention-wrap-the-display-name-for-easy-debugging](https://legacy.reactjs.org/docs/higher-order-components.html#convention-wrap-the-display-name-for-easy-debugging)
- [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/displayName](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/displayName)

This is not a standard, but a convention that React has adopted. In some cases, this property can be added with a Babel transform: [https://babeljs.io/docs/babel-plugin-transform-react-display-name](https://babeljs.io/docs/babel-plugin-transform-react-display-name)

## Recommendations

It looks like Temporal uses function names [for workflow ‚Äútypes‚Äù](https://docs.temporal.io/workflows#intro-to-workflows), and needs these names to be stable?

If that‚Äôs the case, the best thing to do would be the change the API to require an explicit `workflowType` property to be set on functions. I understand that would make the experience of writing new Temporal workflows worse, but it‚Äôs the most reliable solution.

Another option is to make sure the functions are always properties on exported objects. You can rely on the fact that object keys are never mangled ([except in the case of Closure Compiler](https://developers.google.com/closure/compiler/docs/limitations#implications-of-global-variable,-function,-and-property-renaming:)):

```jsx
// workflows.ts
export const workflows = {
  async createExpenseReport() {},
  async approveExpenseReport() {},
};

// Registration
for (const [workflowType, fn] of Object.entries(workflows)) {
  registerWorkflow({ workflowType, fn }); // never rely on fn.name
}
```

If no other solution seems viable, you could take a page from React‚Äôs `displayName` playbook and [apply a transform to the source code before it‚Äôs bundled and minified](https://babeljs.io/docs/babel-plugin-transform-react-display-name), but this comes with a performance penalty, and would be harder for the Temporal team to maintain:

- [SWC supports plugins](https://nextjs.org/docs/architecture/nextjs-compiler#swc-plugins-experimental). This is the most performant solution, but the plugin API is not stable and [requires matching the version of the plugin with the version of SWC used](https://plugins.swc.rs/). If you do this, [you should get the plugin upstreamed into the official repository, so that it gets rebuilt against each new SWC version](https://github.com/swc-project/plugins).
- Next 16 Beta supports Babel plugins in Turbopack, but they come with a significant performance penalty, so that should be a last resort. Next 15 does not support Babel plugins with Turbopack. [https://nextjs.org/docs/beta/app/api-reference/turbopack#language-features](https://nextjs.org/docs/beta/app/api-reference/turbopack#language-features)
- Turbopack supports most Webpack loaders. If only a small set of files need to be transformed and can be identified using a file name glob (e.g. `workflows.ts`), this might be a reasonably performant solution, even if it uses Babel under the hood. [https://nextjs.org/docs/beta/app/api-reference/config/next-config-js/turbopack#configuring-webpack-loaders](https://nextjs.org/docs/beta/app/api-reference/config/next-config-js/turbopack#configuring-webpack-loaders)

Reactions: üëç 10

</details>


---

<a id="310"></a>

### #310: [Feature Request] Support separating bundling and executing of workers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/310 |
| **State** | CLOSED |
| **Author** | schickling (Johannes Schickling) |
| **Created** | 2021-10-19 14:16:23.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-26 04:11:19.000 UTC |
| **Closed** | 2021-10-26 04:11:19.000 UTC |
| **Upvotes** | 7 |
| **Comments** | 6 |
| **Priority Score** | 20 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |
| **Reactions** | üëç 7 |

#### Description

Currently the worker entrypoint file(s) (e.g. `src/worker.ts`) are doing both bundling and execution.

![CleanShot 2021-10-19 at 16 12 20](https://user-images.githubusercontent.com/1567498/137928470-a112c37a-2f15-4ea8-a3d6-5e4e6e629c40.png)

For my application, I'd like to take the responsibility of the bundling (and e.g. use something like `esbuild` instead of Webpack) and have my worker entrypoint (e.g. invoked by `nodemon`) only trigger the actual code execution and not any kind of building/bundling when starting.

#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-19 15:41:54.000 UTC</summary>

@schickling it'd take some work to support bundling with anything other than webpack from my experience.
The bundling process isn't that straight forward, user code needs to be lazily loaded so the runtime can be properly prepared for workflow execution.
It should be straight forward to save the bundle to disk and load it on worker startup for cases like production deployment.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-20 21:24:39.000 UTC</summary>

@lorensr @schickling @sw-yx I'd like some feedback on the public API for this.

In order to support this we'd need to export the `WorkflowCodeBundler` class added in #317 for users to be able to create the bundle.
In addition we need to understand how to pass this into the WorkerOptions, a few options come to mind.

1. Remove the `workflowsPath` and `nodeModulesPaths` options in favor of a new `workflowCodeBundle` option
  * Pro: much more explicit about what's going on
  * Con: More verbose samples
2. Add the `workflowCodeBundle` option to the existing options.

`workflowCodeBundle` could either be a path (string), the bundle itself (string / buffer / stream), I'm not sure what would be most convenient.
I'm leaning towards the string because it's the most flexible option.

Example:
```ts
const workflowCodeBundle = await WorkflowCodeBundler({ workflowsPath });
const worker = await Worker.create({ workflowCodeBundle, ... });
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-20 21:44:45.000 UTC</summary>

> I'm leaning towards the string because it's the most flexible option.

By string do you mean path?

Awaiting a SentenceCase function feels weird to me. SentenceCase makes me want to do `new WorkflowCodeBundler()` or `WorkflowCodeBundler.bundle()`. What about:

```ts
// built-in bundling
const workflowCodeBundle = await bundleWorkflowCode({ workflowsPath });
const worker = await Worker.create({ workflowCodeBundle, ... });

// dev doing their own bundling:
const worker = await Worker.create({ workflowCodeBundle: './bundle.js', ... });
```

That thing is happening where the word "bundle" is starting to sound really strange to me üòÜ

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-21 03:20:33.000 UTC</summary>

So the return value of `bundleWorkflowCode` is a string which means that we can't use pass a path using the same parameter name.
I usually like to call path params what they are for clarity, e.g. `workflowCodeBundlePath`.
Another option is to have `workflowCodeBundle` param type: `{ path: string } | { code: string }` and have `bundleWorkflowCode` return `{ code: string }`.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-25 19:12:00.000 UTC</summary>

We could have both `bundleWorkflowCode` and `workflowCodeBundlePath`:

```ts
// built-in bundling
const workflowCodeBundle = await bundleWorkflowCode({ workflowsPath });
const worker = await Worker.create({ workflowCodeBundle, ... });

// dev doing their own bundling:
const worker = await Worker.create({ workflowCodeBundle: 'js code', ... });
const worker = await Worker.create({ workflowCodeBundlePath: './bundle.js', ... });
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-25 19:24:52.000 UTC</summary>

IDK, I kind of like the `{ path: string } | { code: string }` solution.
Removes some of the clutter from the already overwhelming WorkerOptions interface.

Reactions: üëç 1

</details>


---

<a id="1271"></a>

### #1271: [Feature Request] Add minimal support to link core-bridge against musl

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1271 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-10-26 19:39:58.000 UTC (2y 2m ago) |
| **Updated** | 2025-02-07 15:52:07.000 UTC |
| **Closed** | 2025-02-07 15:52:06.000 UTC |
| **Upvotes** | 8 |
| **Comments** | 3 |
| **Priority Score** | 19 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 8 |

#### Description

### Is your feature request related to a problem? Please describe.

Some TS SDK users have strong requirement of only using alpine-based Docker images. This is a problem, as the `alpine` distribution is based on the `musl` C library (rather than the GNU's `libc` found in most other distributions), which isn't supported at the moment by the `@temporalio/core-bridge` package. Is is therefore not possible to run a TS SDK Worker in an alpine-based container.

The team is hesitant about shipping a `musl`-based native library out of the box, as this would increase the download size for all of our users.

In theory, self-building the native library would be a reasonably simple solution, since `core-bridge` is designed to build the native lib if it can't find the binary file corresponding to the current target environment. However, the TS logic that identify the current target can't recognize the fact that it is running on a `musl`-based system (node itself provides no information on that regard).


### Describe the solution you'd like

- [ ] Modify `core-bridge`'s target environment detection logic to recognize that it is running in a `musl`-based system, and to consequently return the proper build target for those environments.

  With this change, the `@temporalio/core-bridge` will correctly identify that it is running in a `musl` environment, and therefore try to load the `musl`-based native library. Assuming that this library can't be found (ie. because we don't ship the musl), and that the proper go toolchain is installed, then the package would automatically build the native library. This build operation would only happen the first time the application execute, and the built artifact could be copied over. It would therefore be reasonably easy to include this build step as part of a multi-stage Dockerfile.

- [ ] Add some `musl`-based environment to the CI test matrix

#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-27 17:24:42.000 UTC</summary>

Marking this issue as Good First Contribution ‚Äî specifically the first part: "adding detection logic to recognize `musl` environment". That requires modifying [this file](https://github.com/temporalio/sdk-typescript/blob/main/packages/core-bridge/common.js). Can probably find hints of a `musl` build by looking into `process` or `os`, or maybe `process.report.getReport()` (IIRC, that last one provides the list of loaded libraries).

Adding `musl` to the CI test matrix might be best left to official maintainers.

</details>

<details>
<summary><strong>korbin</strong> commented on 2024-11-20 03:52:09.000 UTC</summary>

https://github.com/angellist/sdk-typescript/commit/c34ba641d05541647dfd0aa94bdd81be6f1a0593

I don't have time to pull through the CI-related changes to make this work, but, this does seem to work without issue on an Alpine system with:

``` 
apk add --no-cache build-base cmake protoc protobuf-dev rustup
rustup-init -y

export RUSTFLAGS="-C target-feature=-crt-static"
export BUILD_CORE_RELEASE="true"
```

I added `strip = true` to the release profile and the `musl` binary is only 6.9MB. This build takes long enough (6m on c8g.16xlarges) that it's probably worth including in the prebuilt binaries list.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-02-07 15:52:06.000 UTC</summary>

Superseded by #1621.

</details>


---

<a id="139"></a>

### #139: [Bug] EvalError: Code generation from strings disallowed for this context

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/139 |
| **State** | CLOSED |
| **Author** | zomble (Paul Croker) |
| **Created** | 2021-06-26 01:11:05.000 UTC (4y 6m ago) |
| **Updated** | 2021-08-31 14:03:11.000 UTC |
| **Closed** | 2021-08-31 14:03:11.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 17 |
| **Priority Score** | 19 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |
| **Reactions** | üëç 1 |

#### Description

**Describe the bug**

Workflow fails due to eval call in webpack generated code.

**To Reproduce**

Steps to reproduce the behaviour:

1. Follow examples (with sourcemaps)
2. Run a workflow.

**Expected behaviour**

Workflow executes.

**Screenshots/Terminal output**

```
{
  "message": "Code generation from strings disallowed for this context",
  "source": "",
  "stackTrace": "EvalError: Code generation from strings disallowed for this context\n    at Object../build/workflows sync recursive ^\\.\\/.*\\.js$ (<isolated-vm>:118:1)\n    at __webpack_require__ (<isolated-vm>:623:42)\n    at eval (webpack://lib/../../../../../../src/main.js?:11:13)\n    at eval (webpack://lib/./node_modules/@temporalio/workflow/lib/internals.js?:63:25)\n    at Activator.startWorkflow (webpack://lib/./node_modules/@temporalio/workflow/lib/internals.js?:67:9)\n    at activate (webpack://lib/./node_modules/@temporalio/workflow/lib/worker-interface.js?:128:45)",
  "cause": null,
  "applicationFailureInfo": {
    "type": "EvalError",
    "nonRetryable": false,
    "details": null
  },
  "failureInfo": "applicationFailureInfo"
}
```

**Versions**
 - OS: Linux
 - Temporal Version 1.10.0
 - Docker

**Additional context**

It's due to default devtool in webpack development mode, `eval`. Either setting the mode to production, or devtool (like "source-map") to something else not using eval corrects the issue.


#### Comments (17)

<details>
<summary><strong>bergundy</strong> commented on 2021-06-26 16:35:29.000 UTC</summary>

Hi, can you please post a sample Workflow that reproduces this behavior?
We run the example in CI and I haven't seen any issues with webpack.
I'll look into changing the devtool as you suggested, I just left the default webpack config because it "just worked".


</details>

<details>
<summary><strong>zomble</strong> commented on 2021-06-28 00:32:44.000 UTC</summary>

Hey, I can repro following the getting started guide.

https://docs.temporal.io/docs/node/getting-started

`node lib/worker/schedule-workflow.js` returns

```
WorkflowExecutionFailedError: Code generation from strings disallowed for this context
    at Connection.untilComplete (/home/user/temporal/example/node_modules/@temporalio/client/lib/index.js:204:19)
    at processTicksAndRejections (internal/process/task_queues.js:95:5)
    at async Object.start (/home/user/temporal/example/node_modules/@temporalio/client/lib/index.js:284:25)
    at async run (/home/user/temporal/example/lib/worker/schedule-workflow.js:11:20)
```

With this result in temporal as:

```
{
  "message": "Code generation from strings disallowed for this context",
  "source": "",
  "stackTrace": "EvalError: Code generation from strings disallowed for this context\n    at Object../lib/workflows sync recursive ^\\.\\/.*\\.js$ (<isolated-vm>:30:1)\n    at __webpack_require__ (<isolated-vm>:524:42)\n    at eval (webpack://lib/../../../../../src/main.js?:11:13)\n    at eval (webpack://lib/./node_modules/@temporalio/workflow/lib/internals.js?:63:25)\n    at Activator.startWorkflow (webpack://lib/./node_modules/@temporalio/workflow/lib/internals.js?:67:9)\n    at activate (webpack://lib/./node_modules/@temporalio/workflow/lib/worker-interface.js?:128:45)",
  "cause": null,
  "applicationFailureInfo": {
    "type": "EvalError",
    "nonRetryable": false,
    "details": null
  },
  "failureInfo": "applicationFailureInfo"
}
```

![Screenshot (23)](https://user-images.githubusercontent.com/542255/123564266-1d67bb80-d7fc-11eb-8206-f18543f53874.png)



</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-28 00:37:40.000 UTC</summary>

Which node version are you using?
I'm trying to figure out why I can't reproduce.

</details>

<details>
<summary><strong>zomble</strong> commented on 2021-06-28 01:01:34.000 UTC</summary>

$ node --version
v14.17.1
```
$ cat node_modules/temporalio/package.json
{
  "name": "temporalio",
  "version": "0.2.5",
  "description": "Temporal.io SDK meta-package",
  "dependencies": {
    "@temporalio/client": "^0.4.3",
    "@temporalio/proto": "^0.2.3",
    "@temporalio/worker": "^0.5.0",
    "@temporalio/workflow": "^0.4.0"
  },
  "author": "Roey Berman <roey@temporal.io>",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/temporalio/sdk-node.git"
  },
  "keywords": [
    "temporal",
    "workflow",
    "isolate"
  ],
  "bugs": {
    "url": "https://github.com/temporalio/sdk-node/issues"
  },
  "homepage": "https://github.com/temporalio/sdk-node#readme",
  "publishConfig": {
    "access": "public"
  },
  "engines": {
    "node": ">=14.0.0"
  },
  "gitHead": "766f94c1154962fe367f5b2d8737a50bc3badde9"
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-28 04:52:10.000 UTC</summary>

I'll try to reproduce this when I get the chance

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-28 14:24:45.000 UTC</summary>

I tried to reproduce but I can't.
Ran with docker image amd64/node:14, followed the instructions on the getting started page and it worked.
I'm using `temporalio@0.2.5` and node `v14.17.1`.
I'm wondering if it's an issue with cached packages since we usually test on fresh machines.
Can you try to run with a different node version (using `nvm` for example) to make sure that you're not using any cached packages on your system?
That's the best lead I have so far.


</details>

<details>
<summary><strong>zomble</strong> commented on 2021-06-29 00:01:16.000 UTC</summary>

Okay. Strange.

```
$ rm -Rf node_modules/
$ rm package-lock.json
$ nvm use 16
Now using node v16.3.0 (npm v7.17.0)
$ npm cache clean --force
npm WARN using --force Recommended protections disabled.
$ npm install

added 125 packages, and audited 126 packages in 20s

11 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

$ npm run build.watch
[9:32:22 am] Starting compilation in watch mode...

[9:32:22 am] Found 0 errors. Watching for file changes.

$ npm run start

> example@0.1.0 start
> node lib/worker

2021-06-28T23:36:09.425Z [INFO] asset main.js 4.81 MiB [emitted] (name: main)
2021-06-28T23:36:09.426Z [INFO] runtime modules 1.13 KiB 5 modules
2021-06-28T23:36:09.426Z [INFO] modules by path ./node_modules/ 4.68 MiB
2021-06-28T23:36:09.426Z [INFO]   modules by path ./node_modules/@temporalio/ 4.57 MiB 21 modules
2021-06-28T23:36:09.426Z [INFO]   modules by path ./node_modules/protobufjs/ 51.2 KiB 11 modules
2021-06-28T23:36:09.426Z [INFO]   modules by path ./node_modules/@protobufjs/ 23.7 KiB 7 modules
2021-06-28T23:36:09.426Z [INFO]   ./node_modules/long/src/long.js 39.2 KiB [built] [code generated]
2021-06-28T23:36:09.426Z [INFO]   ./node_modules/ms/index.js 2.95 KiB [built] [code generated]
2021-06-28T23:36:09.426Z [INFO] modules by path ../../../../../src/ 769 bytes
2021-06-28T23:36:09.426Z [INFO]   ../../../../../src/main.js 555 bytes [built] [code generated]
2021-06-28T23:36:09.426Z [INFO]   ../../../../../src/@activities/greeter.js 214 bytes [built] [code generated]
2021-06-28T23:36:09.426Z [INFO] modules by path ./lib/workflows/ 575 bytes
2021-06-28T23:36:09.426Z [INFO]   ./lib/workflows/ sync ^\.\/.*\.js$ 177 bytes [built] [code generated]
2021-06-28T23:36:09.426Z [INFO]   ./lib/workflows/example.js 398 bytes [built] [code generated]
2021-06-28T23:36:09.426Z [INFO] webpack 5.41.0 compiled successfully in 717 ms
2021-06-28T23:36:09.659Z [INFO] Worker state changed { state: 'RUNNING' }

$ node lib/worker/schedule-workflow

WorkflowExecutionFailedError: Code generation from strings disallowed for this context
    at Connection.untilComplete (/home/user/temporal/example/node_modules/@temporalio/client/lib/index.js:204:19)
    at processTicksAndRejections (internal/process/task_queues.js:95:5)
    at async Object.start (/home/user/temporal/example/node_modules/@temporalio/client/lib/index.js:284:25)
    at async run (/home/user/temporal/example/lib/worker/schedule-workflow.js:11:20)
 ```
 
 The moment I alter  `./node_modules/@temporalio/worker/lib/isolate-builder.js:L123` with `+            devtool: 'cheap-source-map',` or any devtool options that isn't eval including false, and restart the worker.
 
```
  $ node lib/worker/schedule-workflow
Hello, Temporal!
```

Do you get if you forcefully set the devtool to something eval based? Just wondering if webpack is selecting false for you over eval, but it shouldn't be.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-29 00:51:34.000 UTC</summary>

Could it be some environment variable that you have set?
I will explicitly set the devtool so this can't happen but I want to understand why this is happening to you.

</details>

<details>
<summary><strong>zomble</strong> commented on 2021-06-30 23:41:37.000 UTC</summary>

Hey @bergundy I have been reading through webpack's config code, and I don't see what environment variable would influence webpack outside of NODE_ENV, and DEBUG. Both being not set when I run the examples fyi.

Ty for the change though. I think it makes sense given isolated-vm doesn't allow eval by default.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-06 15:29:48.000 UTC</summary>

I'm going to reopen this issue since using a non eval based devtool (#145) causes stack traces to loose the original filename which will make it extremely hard for users to debug failures.
I'll ask the isolated-vm maintainer for some help since we cannot reproduce this.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-06 20:57:57.000 UTC</summary>

@zomble do you by any chance have node aliased?
Can you post the output of `which node` and `env` (omit any sensitive information of course)?

</details>

<details>
<summary><strong>zomble</strong> commented on 2021-07-06 23:52:11.000 UTC</summary>

````
$ which node
/home/user/.nvm/versions/node/v14.17.1/bin/node

$ env
SHELL=/bin/bash
SESSION_MANAGER=local/host:@/tmp/.ICE-unix/43615,unix/host:/tmp/.ICE-unix/43615
QT_ACCESSIBILITY=1
COLORTERM=truecolor
XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg
XDG_MENU_PREFIX=gnome-
GNOME_DESKTOP_SESSION_ID=this-is-deprecated
NVM_IOJS_ORG_MIRROR=https://iojs.org/dist
GTK2_MODULES=overlay-scrollbar
LANGUAGE=en_AU:en
MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path
GNOME_SHELL_SESSION_MODE=ubuntu
SSH_AUTH_SOCK=/run/user/1000/keyring/ssh
XMODIFIERS=@im=ibus
DESKTOP_SESSION=ubuntu
SSH_AGENT_PID=43580
GTK_MODULES=gail:atk-bridge
PWD=/home/user
LOGNAME=user
XDG_SESSION_DESKTOP=ubuntu
XDG_SESSION_TYPE=x11
MANPATH=/home/user/.nvm/versions/node/v14.17.1/share/man:/usr/local/man:/usr/local/share/man:/usr/share/man
GPG_AGENT_INFO=/run/user/1000/gnupg/S.gpg-agent:0:1
XAUTHORITY=/run/user/1000/gdm/Xauthority
GJS_DEBUG_TOPICS=JS ERROR;JS LOG
WINDOWPATH=2
HOME=/home/user
USERNAME=user
IM_CONFIG_PHASE=1
LANG=en_AU.UTF-8
LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:
XDG_CURRENT_DESKTOP=ubuntu:GNOME
VTE_VERSION=6003
GNOME_TERMINAL_SCREEN=/org/gnome/Terminal/screen/d5c771fd_c36b_43ef_bff4_860d15b7c91a
INVOCATION_ID=fc0a94a6696649eb98c2d568714a95c3
MANAGERPID=43369
GJS_DEBUG_OUTPUT=stderr
NVM_DIR=/home/user/.nvm
LESSCLOSE=/usr/bin/lesspipe %s %s
XDG_SESSION_CLASS=user
TERM=xterm-256color
DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path
LESSOPEN=| /usr/bin/lesspipe %s
USER=user
GNOME_TERMINAL_SERVICE=:1.106
DISPLAY=:1
SHLVL=1
NVM_CD_FLAGS=
QT_IM_MODULE=ibus
XDG_RUNTIME_DIR=/run/user/1000
NVM_NODEJS_ORG_MIRROR=https://nodejs.org/dist
JOURNAL_STREAM=9:78150
XDG_DATA_DIRS=/usr/share/ubuntu:/home/user/.local/share/flatpak/exports/share:/var/lib/flatpak/exports/share:/usr/local/share/:/usr/share/:/var/lib/snapd/desktop:/var/lib/snapd/desktop
PATH=/home/user/.nvm/versions/node/v14.17.1/bin:/home/user/.cargo/bin:/home/user/bin:/home/user/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/go/bin:/home/user/.mos/bin:/home/user/.pulumi/bin
GDMSESSION=ubuntu
DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
NVM_BIN=/home/user/.nvm/versions/node/v14.17.1/bin
_=/usr/bin/env
````

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-07 01:45:05.000 UTC</summary>

I don't see anything here that would cause node to disable code generation from strings.
Thanks for posting.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-12 15:08:12.000 UTC</summary>

@zomble IDK if you've been following the issue in isolated-vm but can you check if you get the "right" error when installing isolated-vm from `main`: `Code generation from large string was denied`?
https://github.com/laverdet/isolated-vm/issues/251


</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2021-07-15 23:09:24.000 UTC</summary>

@bergundy this has started happening in samples-node as of v0.2.5 for me as well. Didn't happen in v0.2.4.

[This comment](https://github.com/laverdet/isolated-vm/issues/251#issuecomment-876574028) is the likely explanation: my default `maxIsolateMemoryMB` is `30944.29296875` and I get the below error

```
$ npm run schedule-workflow

> example2@0.1.0 schedule-workflow /home/val/Workspace/temporalio/samples-node/hello-world
> node ./src/starter

WorkflowExecutionFailedError: Code generation from strings disallowed for this context
    at Connection.untilComplete (/home/val/Workspace/temporalio/samples-node/hello-world/node_modules/@temporalio/client/lib/index.js:204:19)
    at processTicksAndRejections (internal/process/task_queues.js:97:5)
    at async Object.start (/home/val/Workspace/temporalio/samples-node/hello-world/node_modules/@temporalio/client/lib/index.js:284:25)
    at async run (/home/val/Workspace/temporalio/samples-node/hello-world/src/starter/index.js:10:18)
```

If I increase `maxIsolateMemoryMB` to 66250, my hello world example works fine. If I only increase `maxIsolateMemoryMB` to 65000, I get the same error. This would seem to indicate that the isolate is somehow `eval()`-ing an 8 GB string. Does this help in any way? As far as I can tell, the webpack compiled code is only 5 MB, so I haven't been able to guess where this huge `eval()` might be coming from.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-16 18:23:22.000 UTC</summary>

So I've managed to reproduce this on my mac.
Interestingly, the error appears if with the isolate memory limits of:
- `30944.29296875`
- `30944`
But not with these values:
- `65000` (more than I have on my 16GB MBP)
- `200`

I'll post this back in the isolated-vm issue

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-29 14:07:30.000 UTC</summary>

Looks like the fix in `isolated-vm` should allow us to revert #145, I'm adding this issue to the `beta` milestone. 

</details>


---

<a id="496"></a>

### #496: [Bug] Fix flakey tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/496 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-23 05:13:03.000 UTC (3y 10m ago) |
| **Updated** | 2022-11-24 04:21:04.000 UTC |
| **Closed** | 2022-11-24 04:11:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 18 |
| **Priority Score** | 18 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

There are a number of transient CI failures that we'd like to fix with code instead of the "rebuild" button üòÑ Let's collect them.

Here's one:

https://github.com/temporalio/sdk-typescript/runs/5296245052?check_suite_focus=true

```
Run node scripts/init-from-verdaccio.js --registry-dir /tmp/registry --sample https://github.com/temporalio/samples-typescript/tree/next/hello-world-mtls
Starting local registry
Error: Path D:\tmp\registry\verdaccio.log does not exist
```

[compile-binaries (macos-latest, x86_64-apple-darwin)](https://github.com/temporalio/sdk-typescript/runs/5631928072?check_suite_focus=true#logs)

```
Warning, failed destroying registry ChildProcessError: Process failed
    at ChildProcess.<anonymous> (/Users/runner/work/sdk-typescript/sdk-typescript/scripts/utils.js:18:[16](https://github.com/temporalio/sdk-typescript/runs/5631928072?check_suite_focus=true#step:10:16))
    at ChildProcess.emit (node:events:5[20](https://github.com/temporalio/sdk-typescript/runs/5631928072?check_suite_focus=true#step:10:20):28)
    at Process.ChildProcess._handle.onexit (node:internal/child_process:291:12) {
  code: 1,
  signal: null
}
Error: Path /tmp/registry/verdaccio.log does not exist
```

#### Comments (18)

<details>
<summary><strong>lorensr</strong> commented on 2022-02-23 05:14:50.000 UTC</summary>

## timeouts publishing to or initing from verdaccio

[test-npm-init (windows-latest, x86_64-pc-windows-msvc, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#logs)

```
Run node scripts/init-from-verdaccio.js --registry-dir /tmp/registry --sample https://github.com/temporalio/samples-typescript/tree/next/hello-world-mtls
Starting local registry
Error: Timed out waiting for verdaccio - {"level":40,"time":1646420388935,"pid":1944,"hostname":"fv-az140-90[7](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#step:6:7)","content":"htpasswd","prefix":"verdaccio","msg":"Plugin successfully loaded: @{prefix}-@{content}"}
{"level":40,"time":16464203[8](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#step:6:8)8[9](https://github.com/temporalio/sdk-typescript/runs/5426842695?check_suite_focus=true#step:6:9)57,"pid":1944,"hostname":"fv-az140-907","addr":"http://localhost:4873/","version":"verdaccio/5.7.0","msg":"http address - @{addr} - @{version}"}

    at Timeout._onTimeout (D:\a\sdk-typescript\sdk-typescript\scripts\registry.js:59:18)
Error: Process completed with exit code 1.
```

https://github.com/temporalio/sdk-typescript/runs/5298726692?check_suite_focus=true

```
Run node scripts/publish-to-verdaccio.js --registry-dir /tmp/registry
Starting local registry
Error: Timed out waiting for verdaccio - {"level":40,"time":1645592119724,"pid":3384,"hostname":"fv-az140-199","content":"htpasswd","prefix":"verdaccio","msg":"Plugin successfully loaded: @{prefix}-@{content}"}
{"level":40,"time":1645592119745,"pid":3384,"hostname":"fv-az140-199","addr":"http://localhost:4873/","version":"verdaccio/5.6.0","msg":"http address - @{addr} - @{version}"}

    at Timeout._onTimeout (D:\a\sdk-typescript\sdk-typescript\scripts\registry.js:59:18)
Error: Process completed with exit code 1.
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-23 16:22:25.000 UTC</summary>

[sdk-features-tests / build-ts](https://github.com/temporalio/sdk-typescript/runs/5298947280?check_suite_focus=true#logs) > Checkout typescript SDK repo

```
34s
Run actions/checkout@v2
Syncing repository: temporalio/sdk-typescript
Getting Git version info
Initializing the repository
Disabling automatic garbage collection
Setting up auth
Fetching the repository
  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=[1](https://github.com/temporalio/sdk-typescript/runs/5298947280?check_suite_focus=true#step:4:1) origin +refs/heads/remove-comments*:refs/remotes/origin/remove-comments* +refs/tags/remove-comments*:refs/tags/remove-comments*
  The process '/usr/bin/git' failed with exit code 1
  Waiting [18](https://github.com/temporalio/sdk-typescript/runs/5298947280?check_suite_focus=true#step:4:18) seconds before trying again
  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +refs/heads/remove-comments*:refs/remotes/origin/remove-comments* +refs/tags/remove-comments*:refs/tags/remove-comments*
  The process '/usr/bin/git' failed with exit code 1
  Waiting 15 seconds before trying again
  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +refs/heads/remove-comments*:refs/remotes/origin/remove-comments* +refs/tags/remove-comments*:refs/tags/remove-comments*
  Error: The process '/usr/bin/git' failed with exit code 1
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-23 17:30:06.000 UTC</summary>

[build-and-test (16, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5304505605?check_suite_focus=true#logs) > npm test

```
Error: alio/test: 2022-02-23T14:19:05.438Z [ERROR] Worker failed {
@temporalio/test:   error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\packages\worker\src\worker.ts:[393](https://github.com/temporalio/sdk-typescript/runs/5304505605?check_suite_focus=true#step:11:393):17
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\map.ts:58:33
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run throws if not shut down gracefully
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\mergeInternals.ts:85:24
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\map.ts:58:20
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test: }
@temporalio/test: 2022-02-23T14:19:05.460Z [INFO] Worker state changed { state: 'FAILED' }
```

[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5307583046?check_suite_focus=true#logs)

```
@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run shuts down gracefully
@temporalio/test: 2022-02-23T17:45:23.226Z [INFO] Worker state changed { state: 'STOPPING' }
Error: alio/test: 2022-02-23T17:45:23.239Z [ERROR] Worker failed {
@temporalio/test:   error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\packages\worker\src\worker.ts:393:17
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\map.ts:58:33
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\mergeInternals.ts:85:24
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\map.ts:58:20
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test: }
```

[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5339291839?check_suite_focus=true#logs) > npm test

```
@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run shuts down gracefully
@temporalio/test: 2022-02-25T21:13:56.045Z [INFO] Worker state changed { state: 'STOPPING' }
Error: alio/test: 2022-02-25T21:13:56.052Z [ERROR] Worker failed {
@temporalio/test:   error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\packages\worker\src\worker.ts:391:17
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\map.ts:58:33
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test:   ‚àö worker-lifecycle ¬ª Mocked run throws if not shut down gracefully
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\mergeInternals.ts:85:24
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test:       at D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\map.ts:58:20
@temporalio/test:       at OperatorSubscriber._this._next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\operators\OperatorSubscriber.ts:43:13)
@temporalio/test:       at OperatorSubscriber.Subscriber.next (D:\a\sdk-typescript\sdk-typescript\node_modules\rxjs\src\internal\Subscriber.ts:75:12)
@temporalio/test: }
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-02 23:50:04.000 UTC</summary>

[test-npm-init (windows-latest, x86_64-pc-windows-msvc, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/runs/5399993983?check_suite_focus=true#logs)

```
Run node scripts/test-example.js --work-dir /tmp/registry/example
Starting worker
WorkflowExecutionAlreadyStartedError: Workflow execution already started
    at WorkflowClient._startWorkflowHandler (D:\tmp\registry\example\node_modules\@temporalio\client\src\workflow-client.ts:659:[15](https://github.com/temporalio/sdk-typescript/runs/5399993983?check_suite_focus=true#step:12:15))
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at async WorkflowClient.execute (D:\tmp\registry\example\node_modules\@temporalio\client\src\workflow-client.ts:378:5)
    at async run (D:\tmp\registry\example\src\execute-workflow.ts:38:[18](https://github.com/temporalio/sdk-typescript/runs/5399993983?check_suite_focus=true#step:12:18)) {
  workflowId: 'my-business-id',
  workflowType: 'example'
}
```

[test-npm-init (windows-latest, x86_64-pc-windows-msvc, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/runs/5514867672?check_suite_focus=true#logs)

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-08 00:33:04.000 UTC</summary>

Buildkite https://buildkite.com/temporal/typescript-sdk/builds/785#a8a253f2-23f1-407b-b9b6-35daac9a835e

![image](https://user-images.githubusercontent.com/251288/157141914-8b8eb1d5-79e0-4b61-8768-75f945749b10.png)


</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-11 01:30:22.000 UTC</summary>

[test-npm-init (ubuntu-latest, x86_64-unknown-linux-gnu, 16, local, hello-world)](https://github.com/temporalio/sdk-typescript/runs/5504329163?check_suite_focus=true#logs) 

hanging, perhaps due to a failed attempt at GH canceling it because another test failed? 

<img width="894" alt="image" src="https://user-images.githubusercontent.com/251288/157784306-606f7093-931e-4021-a764-abe2984293a8.png">

Thanks to @julianocomg for reporting

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-21 18:11:17.000 UTC</summary>

[build-and-test (14, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/5631927497?check_suite_focus=true#logs)

```
@temporalio/test: npm ERR! code ELIFECYCLE
@temporalio/test:   ‚úî workflows ‚Ä∫ nestedCancellation (607ms)
@temporalio/test: npm ERR! errno 1
@temporalio/test:   ‚úî workflows ‚Ä∫ partialShield (600ms)
@temporalio/test: npm ERR! @temporalio/test@0.19.1 test: `ava ./lib/test-*.js`
@temporalio/test:   ‚îÄ
@temporalio/test: npm ERR! Exit status 1
@temporalio/test:   testenvironment ‚Ä∫ before hook
@temporalio/test: npm ERR! 
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test: npm ERR! Failed at the @temporalio/test@0.19.1 test script.
@temporalio/test:   Error {
@temporalio/test: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
@temporalio/test:     message: 'Failed to connect before the deadline',
@temporalio/test:   }
@temporalio/test:   ‚Ä∫ checkState (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/src/client.ts:172:18)
@temporalio/test:   ‚Ä∫ Timeout._onTimeout (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/src/channel.ts:712:9)
@temporalio/test:   ‚îÄ
@temporalio/test:   1 hook failed
@temporalio/test: npm WARN Local package.json exists, but node_modules missing, did you mean to install?
@temporalio/test: npm ERR! A complete log of this run can be found in:
@temporalio/test: npm ERR!     /Users/runner/.npm/_logs/2022-03-21T18_00_02_510Z-debug.log
lerna ERR! npm run test exited 1 in '@temporalio/test'
npm ERR! Test failed.  See above for more details.
Error: Process completed with exit code 1.
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-22 00:22:36.000 UTC</summary>

[build-and-test (16, ubuntu-latest)](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#logs)

```
Run npm run wait-namespace

> wait-namespace
> node ./scripts/wait-on-temporal.mjs

Failed to connect Error: 1[4](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:4) UNAVAILABLE: No connection established
    at Object.callErrorFromStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/call.js:31:26)
    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/client.js:180:[5](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:5)2)
    at /home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/call-stream.js:111:35
    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/lib/grpc-retry.js:89:37)
    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:3[6](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:6)5:141)
    at Object.onReceiveStatus (/home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:328:181)
    at /home/runner/work/sdk-typescript/sdk-typescript/node_modules/@grpc/grpc-js/build/src/call-stream.js:182:[7](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:7)[8](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:8)
    at processTicksAndRejections (node:internal/process/task_queues:78:[11](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:11)) {
  code: [14](https://github.com/temporalio/sdk-typescript/runs/5635846701?check_suite_focus=true#step:11:14),
  details: 'No connection established',
  metadata: Metadata { internalRepr: Map(0) {}, options: {} }
}
Error: Process completed with exit code 1.
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-27 00:13:03.000 UTC</summary>

This one was local:

```
@temporalio/test:   local-activities ‚Ä∫ Local activity backs off with timer
@temporalio/test:   Difference:
@temporalio/test:   - 0
@temporalio/test:   + 1
@temporalio/test:   ‚Ä∫ src/test-local-activities.ts:236:9
@temporalio/test:   ‚Ä∫ runWorker (src/test-local-activities.ts:21:3)
@temporalio/test:   ‚Ä∫ src/test-local-activities.ts:222:5
```

<img width="1123" alt="image" src="https://user-images.githubusercontent.com/251288/170603741-b801dbab-82fa-49bf-a8c6-fafe7074bacc.png">


</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-06-10 16:35:50.000 UTC</summary>

[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/6820063801?check_suite_focus=true#logs)

```
@temporalio/test:   testenvironment ¬ª TestEnvironment can toggle between normal and skipped time
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test:   UnexpectedError {
@temporalio/test:     message: 'Found more than one reference to the native Worker',
@temporalio/test:   }
@temporalio/test:   ¬ª Runtime.deregisterWorker (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/runtime.ts:310:51)
@temporalio/test:   ¬ª NativeWorker.finalizeShutdown (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/worker.ts:178:24)
@temporalio/test:   ¬ª Worker.run (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/worker.ts:1485:31)
@temporalio/test:   ¬ª withWorker (src/test-testenvironment.ts:26:20)
@temporalio/test:   ¬ª src/test-testenvironment.ts:90:3
@temporalio/test:   testenvironment ¬ª after.always hook
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test:   IllegalStateError {
@temporalio/test:     message: 'Cannot close connection while Workers hold a reference to it',
@temporalio/test:   }
@temporalio/test:   ¬ª NativeConnection.close (D:/a/sdk-typescript/sdk-typescript/packages/worker/src/connection.ts:51:13)
@temporalio/test:   ¬ª TestWorkflowEnvironment.teardown (D:/a/sdk-typescript/sdk-typescript/packages/testing/src/index.ts:240:33)
@temporalio/test:   ¬ª src/test-testenvironment.ts:43:3
@temporalio/test:   ‚îÄ
@temporalio/test:   1 hook failed
@temporalio/test:   1 test failed
```

Reactions: üöÄ 2

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-15 19:53:50.000 UTC</summary>

Just fixed the latest one in #701 

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-06-24 23:51:13.000 UTC</summary>

[build-and-test (14, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#logs)

[build-and-test (14, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/7224994035?check_suite_focus=true#logs)

[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/7240533126?check_suite_focus=true#logs)

```
Run npm ci --ignore-scripts
  npm ci --ignore-scripts
  shell: /bin/bash -e {0}
  env:
    GITHUB_TOKEN: ***
npm ERR! cb() never called!
npm ERR! This is an error with npm itself. Please report this error at:
npm ERR!     <https://npm.community>
npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/runner/.npm/_logs/[2](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:2)022-06-2[4](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:4)T21_42_[5](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:5)0_24[8](https://github.com/temporalio/sdk-typescript/runs/7048994137?check_suite_focus=true#step:6:9)Z-debug.log
Error: Process completed with exit code 1.
```

Make `/Users/runner/.npm/_logs` a build artifact?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-08 19:18:18.000 UTC</summary>

[build-and-test (16, macos-latest)](https://github.com/temporalio/sdk-typescript/runs/7201322718?check_suite_focus=true#logs)

[build-and-test (16, ubuntu-latest)](https://github.com/temporalio/sdk-typescript/runs/7352016624?check_suite_focus=true#logs)

```
@temporalio/test:   replay ‚Ä∫ cancel-fake-progress-replay
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test:   UnexpectedError {
@temporalio/test:     message: 'channel closed',
@temporalio/test:   }
@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/worker.js:887:54
@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/tracing.js:65:26
@temporalio/test:   ‚Ä∫ NoopContextManager.with (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@opentelemetry/api/build/src/context/NoopContextManager.js:36:24)
@temporalio/test:   ‚Ä∫ ContextAPI.with (/Users/runner/work/sdk-typescript/sdk-typescript/node_modules/@opentelemetry/api/build/src/api/context.js:71:54)
@temporalio/test:   ‚Ä∫ instrument (/Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/tracing.js:61:29)
@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/worker.js:883:51
@temporalio/test:   ‚Ä∫ /Users/runner/work/sdk-typescript/sdk-typescript/packages/worker/lib/worker.js:352:33
@temporalio/test:   ‚îÄ
@temporalio/test:   1 test failed
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-09 00:49:02.000 UTC</summary>

Awesome work tracking all of this @lorensr I think some of these issues have already been solved.
Might be worth tracking each individual flake.

The new channel closed one worries me and could happen to users in production but it might just be during shutdown so it might not be too critical.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-09 00:51:06.000 UTC</summary>

Hmm.. nm looks like it happens in the replay worker, still troubling but not as much

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-15 05:09:13.000 UTC</summary>

Got above channel closed failure a few times locally, and also this new version of it:

```
@temporalio/test:   replay ‚Ä∫ cancel-fake-progress-replay-nondeterministic
@temporalio/test:   lib/test-replay.js:68
@temporalio/test:    67:     hist.events[0].workflowExecutionStartedEventAttributes.workflowType.‚Ä¶
@temporalio/test:    68:     await t.throwsAsync(worker_1.Worker.runReplayHistory({
@temporalio/test:    69:         workflowsPath: require.resolve('./workflows'),
@temporalio/test:   Promise rejected with unexpected exception:
@temporalio/test:   UnexpectedError {
@temporalio/test:     message: 'channel closed',
@temporalio/test:   }
@temporalio/test:   Expected instance of:
@temporalio/test:   Function DeterminismViolationError {}
@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/worker.js:910:54
@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/tracing.js:65:26
@temporalio/test:   ‚Ä∫ NoopContextManager.with (/Users/me/gh/sdk2/node_modules/@opentelemetry/api/build/src/context/NoopContextManager.js:36:24)
@temporalio/test:   ‚Ä∫ ContextAPI.with (/Users/me/gh/sdk2/node_modules/@opentelemetry/api/build/src/api/context.js:71:54)
@temporalio/test:   ‚Ä∫ instrument (/Users/me/gh/sdk2/packages/worker/lib/tracing.js:61:29)
@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/worker.js:906:51
@temporalio/test:   ‚Ä∫ /Users/me/gh/sdk2/packages/worker/lib/worker.js:379:33
@temporalio/test:   ‚îÄ
```

https://app.warp.dev/block/cnnzcwtjYDvLxKkYu7YEFK

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-23 21:57:48.000 UTC</summary>

@bergundy @lorensr Do you guys remember seeing any of these flakes recently? If not, I suggest that we close this issue now, and just track any further flake pattern in distinct, specific issues.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-11-24 04:21:03.000 UTC</summary>

I think we addressed all of the known flakes.
From time to time I see npm ci failing with an internal npm error and I‚Äôm considering moving from npm but we can track this separately.

</details>


---

<a id="1355"></a>

### #1355: [Bug] `reuseV8Context` breaks workflow isolation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1355 |
| **State** | CLOSED |
| **Author** | neelance (Richard Musiol) |
| **Created** | 2024-02-08 16:32:24.000 UTC (1y 11m ago) |
| **Updated** | 2024-02-15 03:35:59.000 UTC |
| **Closed** | 2024-02-08 17:01:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 17 |
| **Priority Score** | 17 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We just ran into the issue that v1.9.0 broke our workflow code. The issue is that we were using a global variable (global = at the top-level of the TypeScript file) to collect cleanup steps that were supposed to get executed at the end of the workflow. Prior to v1.9.0 this worked fine, because each workflow run had its own set of global variables.

With `reuseV8Context` however it caused the cleanup steps to leak into other workflow runs. If workflow run X added a cleanup step and went to sleep and then another workflow run Y got executed with the same V8 context, then Y would also invoke the cleanup steps of X.

This issue was hard to notice during testing. Fortunately we were able to recover with no long-lasting impact.

It seems like a footgun that it is so easy to break isolation now. One improvement would be to make [AsyncLocalStorage](https://nodejs.org/api/async_context.html) available to the workflow code. I wanted to use if back when I implemented the cleanup logic, but it was not available so I opted for the global variable instead.

#### Comments (17)

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 16:39:56.000 UTC</summary>

Thanks for reporting.

Can you post a repro?

You can use workflow specific [`AsyncLocalStorage`](https://typescript.temporal.io/api/namespaces/workflow#asynclocalstorage).

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-08 17:01:29.000 UTC</summary>

I did not know that you are exposing `AsyncLocalStorage` via `@temporalio/workflow`. This is perfect and the proper way to implement it. Thanks!

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 17:31:27.000 UTC</summary>

@neelance I'm curious how `reuseV8Context` broke isolation for you.
Could you please provide more details?

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-08 17:51:55.000 UTC</summary>

Here is the concept:
```
const someList: string[] = [];

export async function testWorkflow() {
   someList.push(workflowInfo().workflowId);
   sleep(10_000);
   await activities.printList(someList);
}
```

I think you should be able to observe entries from other workflows when you invoke it multiple times.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 20:46:59.000 UTC</summary>

I can't reproduce this:

https://github.com/temporalio/sdk-typescript/pull/1356/files



</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-08 22:52:54.000 UTC</summary>

Strange. I just reproduced it like this:
```ts
let value = 0;
export async function example(): Promise<number> {
  value++;
  return value;
}
```

Every time I run this workflow, I get the next number until I restart the worker. When I disable `reuseV8Context` I always get `1`. I wonder what's the difference between our setups...

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 23:02:08.000 UTC</summary>

How are you creating your bundle (ignore if you don't know what I mean) and worker?

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-08 23:08:27.000 UTC</summary>

Yes, that's exactly what I was just looking at and I think I found it: We're building the workflow bundle on our own and you seem to manipulate the `__webpack_module_cache__`, which does not seem to work with our bundle. We're still using Webpack, so I guess there should be some way to make it work...

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-08 23:10:35.000 UTC</summary>

```ts
    code = code.replace(
      'var __webpack_module_cache__ = {}',
      'var __webpack_module_cache__ = globalThis.__webpack_module_cache__'
    );
```
üôà 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 23:14:37.000 UTC</summary>

I see, well we definitely don't support that. You're on your own there üò¨ 

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-08 23:30:05.000 UTC</summary>

Problem is that using your bundler comes with inconsistencies to how we bundle the rest of our codebase...

And well, you're not really discouraging it either:
![CleanShot 2024-02-09 at 00 27 33](https://github.com/temporalio/sdk-typescript/assets/16184/c507b564-3bac-4813-ac72-bbee4124ef80)
![CleanShot 2024-02-09 at 00 28 05](https://github.com/temporalio/sdk-typescript/assets/16184/c48c945b-9071-4a9f-ad0a-d473a343fef8)
https://docs.temporal.io/dev-guide/typescript/foundations

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 23:35:34.000 UTC</summary>

`bundleWorkflowCode` is a utility that we maintain and support.
It's used internally by the worker if you give it a `workflowsPath` option.

What are the inconsistencies I wonder.
Is using the webpack hook we provide not enough?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-08 23:36:01.000 UTC</summary>

I'll have the docs fixed, don't know who put this advice there.

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-09 00:01:14.000 UTC</summary>

> Is using the webpack hook we provide not enough?

I just tried `bundleWorkflowCode` and got it to work. We simplified our Webpack setup in the last months, so that helped. Honestly, I'm still not that happy about having a second bundler. I'll think about it some more...

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-09 00:40:54.000 UTC</summary>

Thanks for the updates.

Let me know if you have more thoughts on the subject.

</details>

<details>
<summary><strong>neelance</strong> commented on 2024-02-14 08:33:11.000 UTC</summary>

Here's an update:

We have switched to using `bundleWorkflowCode`. It was easy enough to integrate into our current build setup. Especially the Webpack hook helped.

However, we've still found a slightly different workflow isolation bug, which still happens when using your bundler. We were also able to resolve it with `AsyncLocalStorage`, but you probably want to look into it. Unfortunately it is again difficult for me to come up with a reproduction, so I will describe what we saw and maybe you can already see the issue:

We saw some workflows getting stuck with a nondeterminism error. However, I was able to replay these workflows locally on the same code without any issue. I then guessed that they will probably resolve when restarting the workers. We then restarted all workers without any code change and the workflows completed fine as expected. This strongly suggests an isolation issue.

The difference to the case above is that this time it is not an execution of workflow A leaking into workflow B, but one execution of workflow A leaking into a replay (on the worker) of the same workflow A. In our case signals were involved: The signal handler was writing the data it received into a global variable which served as a map (the data is keyed). Some specific `condition` then waited for an entry in this map. The nondeterminism was due to code at the beginning of the workflow already reading data from the map that should not yet be available until some later signal in the history of the workflow.

Have I explained it well enough? My best guess is that you are not discarding the Webpack module cache when replaying a workflow.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-02-15 03:35:58.000 UTC</summary>

Thanks for the update and detailed report.

I wonder what is going on there, I don‚Äôt see a reason why this would happen.

Does disabling reuse v8 context also prevent workers getting into this state?

</details>


---

<a id="770"></a>

### #770: [Bug] Timeout on last runReplayHistory

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/770 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-21 20:38:20.000 UTC (3y 5m ago) |
| **Updated** | 2022-07-29 18:06:06.000 UTC |
| **Closed** | 2022-07-29 18:06:06.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 11 |
| **Priority Score** | 15 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

Report from user:

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

I‚Äôm creating a workflowBundle of all the workflows i‚Äôm replaying, passing the workflowBundle in to runReplayHistory, and adding the promise from runReplayHistory to an array of promises on which I use Promise.all() at the end.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

I‚Äôm seeing mostly successful replays, with all executing correctly except for the last one, where I get the error:

```
Unhandled rejection { runId: undefined } Error: Replay failed. Details: Workflow activation completion failed: Failure { failure: Some(Failure { message: "Timed out waiting for task result", source: "TypeScriptSDK", stack_trace: "Error: Timed out waiting for task result\n    at Object.waitForTaskComplete (webpack-internal:///./src/work_session_manager/atlas_work_task_complete_signal.ts:36:27)", cause: None, failure_info: None }) }
```

If I skip replaying the last workflow, everything succeeds and the function actually finishes/returns.

#### Comments (11)

<details>
<summary><strong>rupalivohra</strong> commented on 2022-07-27 16:48:49.000 UTC</summary>

Hey @lorensr - any thoughts on when y'all will get to this? 
We want to put workflow replays in our CI pipeline, but without bundling and without a bulk endpoint, it's very slow to start up a new worker for each workflow replay.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-27 17:13:11.000 UTC</summary>

Not sure, but adding the `next` label!

</details>

<details>
<summary><strong>alex766</strong> commented on 2022-07-27 20:15:24.000 UTC</summary>

Hi! Roey mentioned that you've seen this issue but haven't been able to reliably reproduce it, and I wanted to add that I have seen the error every time with bundling, but it often occurs in different places - I'm bundling about 10 workflows together and sometimes it fails on the 5th or last workflow's replay while sometimes it fails on the 2nd. I'm not sure if this is what you noticed, but thought I would add this information. 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-27 20:26:05.000 UTC</summary>

Thanks everyone for jumping in on this conversation.

@alex766 this doesn't look like the same issue we're seeing in the SDK CI.

I _think_ this issue is not related to the SDK, it might just be some failure in a sink or some other source.

@rupalivohra can you please provide a reproduction?
The exception is thrown from your code, so we don't have a way to examine this further.

</details>

<details>
<summary><strong>alex766</strong> commented on 2022-07-27 21:09:37.000 UTC</summary>

Hi, thanks for the quick response! The error I'm getting from the SDK is first 
`WARN temporal_sdk_core::worker: Failing workflow activation, run_id: "e676ec84-1b0b-4ff3-9ddd-8ca235d5f403", failure: Failure { failure: Some(Failure { message: "WorkflowUpdateError { source: Fatal(\"Child workflow machine does not handle this event\"), run_id: \"e676ec84-1b0b-4ff3-9ddd-8ca235d5f403\" }", source: "", stack_trace: "", cause: None, failure_info: Some(ApplicationFailureInfo(ApplicationFailureInfo { r#type: "", non_retryable: false, details: None })) }) }` 
and the following error that I mentioned earlier is (I think) the result from the sink. Does that match what you were seeing?

As for the code, the relevant snippets are below. I first create the bundle then use `listWorkflowExecutions` to get the 3 oldest running workflows for each workflow type, grab their history, and kick off the replay using the workflowBundle. I then await for the results of the replay. 
```
const workflowBundle = await bundleWorkflowCode({
    workflowsPath: require.resolve('../scheduling/workflows/all_workflows'),
  });
```

```
const resultIDs = await conn.service.listWorkflowExecutions({
    namespace: replayNamespace,
    pageSize: 3,
    query: `WorkflowType = '${workflowName}' and ExecutionStatus = 'Running'
       ORDER BY StartTime ASC`,
  });

  const queriedIDs = resultIDs.executions.map(({ execution }) => execution!.workflowId!);

  for (const ID of queriedIDs) {
    const { history } = await conn.service.getWorkflowExecutionHistory({
      namespace: replayNamespace,
      execution: {
        workflowId: ID,
      },
    });

    if (!history) {
      throw new ReplayExecutionHistoryError(ID);
    }

    workflowReplays.push(
      Worker.runReplayHistory(
        {
          workflowBundle,
          replayName: `replayed-${ID}`,
          interceptors,
          sinks,
        },
        history,
      ),
    );
}

try {
  await Promise.all(workflowReplays);
} catch (error) {
  isDeterministic = false;
}

```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-28 00:21:48.000 UTC</summary>

@alex766 this looks like non-determinism of workflow code, that would be the most likely option.
If this is the case, it likely means you modified the workflow code in a backwards incompatible manner and the replayer caught that.

If you think otherwise, please provide a reproduction with the workflow code so we can examine that more closely.

</details>

<details>
<summary><strong>alex766</strong> commented on 2022-07-28 17:08:52.000 UTC</summary>

@bergundy Hm, I recognize that the error is similar to a non-determinism error thrown, but I'm pretty certain that it is not coming from non-determinism because (1) I didn't change any of the workflow code when running the replay, and (2) when I run the replay serially without any bundling, no workflow non-determinism errors are raised and the replays all run to completion. 

Do you have any other ideas for what it could be?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-28 17:10:33.000 UTC</summary>

@alex766 it'd be hard for me to guess without seeing sample workflow code and corresponding history.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-28 17:13:12.000 UTC</summary>

I'm not sure how to reproduce this myself, I would need assistance from your to recreate the scenario.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-28 20:56:55.000 UTC</summary>

@alex766 @rupalivohra can we resolve this issue based on our slack conversation?

We figured out that the cause was that the bundle wasn't created with the same interceptors that were passed in to the worker.

</details>

<details>
<summary><strong>alex766</strong> commented on 2022-07-29 17:20:54.000 UTC</summary>

Yep, thank you for all the help!

</details>


---

<a id="1499"></a>

### #1499: [Feature Request] Native Request Batching to Prevent "received message larger than max" Errors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1499 |
| **State** | OPEN |
| **Author** | dp-dandy (David Parsons) |
| **Created** | 2024-08-16 20:06:29.000 UTC (1y 4m ago) |
| **Updated** | 2024-08-21 14:07:58.000 UTC |
| **Upvotes** | 7 |
| **Comments** | 0 |
| **Priority Score** | 14 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 7 |

#### Description

### Is your feature request related to a problem? Please describe.

#### Context
Our team recently encountered a significant issue when attempting to start a large number of activities (~600) asynchronously within a single Temporal workflow. The SDK grouped the activity scheduling requests together, leading to a gRPC error (`ResourceExhausted`) because the total message size (15MB) exceeded the gRPC-imposed limit of 4MB.

This issue causes the workflow to freeze, as the SDK retries the `RespondWorkflowTaskCompleted` API call, which continues to fail due to the message size. Currently, the SDK does not provide any built-in mechanism to automatically handle this limitation, nor does it throw a runtime error that could help developers detect and manage the issue proactively.

#### Underlying Issue
- The Temporal SDK batches multiple activity scheduling commands into a single gRPC request.
- When the cumulative size of these commands exceeds 4MB, gRPC rejects the request with a `ResourceExhausted` error.
- The SDK does not provide an intuitive way to manage this situation, leading to potential workflow freezes and silent failures.

### Describe the solution you'd like

#### Feature Request
To improve the developer experience and robustness of the Temporal SDK, we request the following enhancements:

1. **Automatic Request Splitting**:
   - Implement a mechanism in the SDK to detect when the cumulative size of a gRPC request is approaching the 4MB limit.
   - Automatically split the activity scheduling commands into smaller batches that stay within the size limit, sending them in multiple gRPC requests if necessary.

2. **Runtime Error for Exceeding Limits**:
   - If automatic splitting is not feasible, the SDK should throw a descriptive runtime error when a request exceeds the gRPC message size limit.
   - This error should include suggestions or documentation references on how to adjust the code to stay within the limit, such as reducing the number of activities started simultaneously or compressing payloads.

3. **Improved Logging and Monitoring**:
   - Enhance the logging around gRPC message size limits to make it easier for developers to diagnose issues related to request size.

### Additional Considerations
- **Custom Data Converters**: Although developers can use custom data converters to compress payloads, this should be a secondary approach. The SDK should still provide safeguards against exceeding gRPC limits.
- **Documentation**: Update the SDK documentation to clearly explain the gRPC size limitation, how it interacts with Temporal workflows, and best practices for avoiding issues.

### Impact
Implementing these changes would significantly reduce the likelihood of silent workflow failures and improve the overall resilience of systems built using the Temporal SDK. Developers would have better tools to manage gRPC limitations, leading to more reliable and maintainable code.

---
A rough incomplete solution that we are piloting is something like:
```typescript
import type { ActivityFunction } from '@temporalio/common';
import { DefaultPayloadConverter } from '@temporalio/common';

const MAX_BATCH_PAYLOAD_SIZE = 3 * 1024 * 1024; // 3MB, leaving a buffer for any unknown overhead associated with the activities

const defaultPayloadConverter: DefaultPayloadConverter = new DefaultPayloadConverter();

function getPayloadSize<PayloadType extends Parameters<ActivityFunction>>(args: PayloadType): number {
    const payload = defaultPayloadConverter.toPayload(args);
    if (payload.data instanceof Uint8Array) {
        return payload.data.length;
    }
    return 0;
}

function groupIntoMaxSizePayloads<PayloadType extends Parameters<ActivityFunction>>(
    activityArgs: PayloadType[],
    maxSize: number = MAX_BATCH_PAYLOAD_SIZE,
): PayloadType[][] {
    const payloadGroups: PayloadType[][] = [];

    let currentGroup: PayloadType[] = [];
    let currentGroupSize = 0;
    for (const args of activityArgs) {
        const argsSize = getPayloadSize(args);
        if (argsSize > maxSize) {
            // throw some error about the request size being too big
        }
        // If the current group size plus the size of the next args is greater than the max size,
        // push the current group and start a new one
        if (currentGroupSize + argsSize > maxSize) {
            payloadGroups.push(currentGroup);
            currentGroup = [];
            currentGroupSize = 0;
        }
        currentGroup.push(args);
        currentGroupSize += argsSize;
    }
    // Push the last group if it's not empty
    if (currentGroup.length > 0) {
        payloadGroups.push(currentGroup);
    }
    return payloadGroups;
}

export async function safeStartActivities<Activity extends ActivityFunction, Arguments>(
    activity: Activity,
    args: Arguments[],
): Promise<PromiseSettledResult<Awaited<ReturnType<Activity>>>[]> {
    const maxRequestSizeBatches: Parameters<Activity>[][] = groupIntoMaxSizePayloads(
        args.map((arg: Arguments) => arg as Parameters<Activity>),
    );
    const results: PromiseSettledResult<Awaited<ReturnType<Activity>>>[] = [];
    for (const maxRequestSizeBatch of maxRequestSizeBatches) {
        const promises: Promise<ReturnType<Activity>>[] = maxRequestSizeBatch.map((args: Parameters<Activity>) =>
            activity(args),
        );
        const awaited = await Promise.allSettled(promises);
        results.push(...awaited);
    }
    return results;
}

```

### Additional context
Cloud Support Thread: https://temporalio.slack.com/archives/C046BRWDV2R/p1723743294696369

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1069"></a>

### #1069: [Feature Request] Support countWorkflowExecutions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1069 |
| **State** | CLOSED |
| **Author** | jdnichollsc (J.D Nicholls) |
| **Created** | 2023-03-02 22:47:29.000 UTC (2y 10m ago) |
| **Updated** | 2024-12-09 22:40:43.000 UTC |
| **Closed** | 2024-12-09 22:40:43.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 10 |
| **Priority Score** | 14 |
| **Labels** | enhancement, good first issue |
| **Assignees** | THardy98 |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

I'm trying to check if a workflow execution exists by using the workflowId.

### Describe the solution you'd like

I was checking the types from the TypeScript packages and I was trying to implement the below solution:
```ts
async checkWorkflowExecutionExists(workflowId: string): Promise<boolean> {
  const request = new temporal.api.workflowservice.v1.DescribeWorkflowExecutionRequest({
    execution: new temporal.api.common.v1.WorkflowExecution({ workflowId }),
    namespace: 'default',
  });
  const { count } = await this.client.workflowService.countWorkflowExecutions(request);
  return count.greaterThan(0);
}
```

### Additional context

But I'm getting this error:
```
‚îÇ [Nest] 40  - 03/02/2023, 10:15:15 PM   ERROR [ExceptionsHandler] proto_1.temporal.api.workflowservice.v1.D ‚îÇ
‚îÇ TypeError: proto_1.temporal.api.workflowservice.v1.DescribeWorkflowExecutionRequest is not a constructor   ‚îÇ
‚îÇ     at CheckoutService.checkWorkflowExecutionExists (/baxus-services/dist/apps/api/main.js:2066:25)        ‚îÇ
‚îÇ     at CheckoutController.checkWorkflowExecutionExists (/baxus-services/dist/apps/api/main.js:1889:37)     ‚îÇ
‚îÇ     at /baxus-services/node_modules/@nestjs/core/router/router-execution-context.js:38:29                  ‚îÇ
‚îÇ     at processTicksAndRejections (node:internal/process/task_queues:96:5)                                  ‚îÇ
‚îÇ     at /baxus-services/node_modules/@nestjs/core/router/router-execution-context.js:46:28                  ‚îÇ
‚îÇ     at /baxus-services/node_modules/@nestjs/core/router/router-proxy.js:9:17  
```

I was inspecting the code of the '@temporalio/proto' package but I don't see any reference to that `DescribeWorkflowExecutionRequest` constructor, so why the types are wrong?

Thanks for your support! <3

#### Comments (10)

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-02 22:59:41.000 UTC</summary>

`countWorkflowExecutions` is an operation against the visiblity API (ie. going to your ElasticSearch server, and it might possibly take to time to reflect a result).

A better way to test for the existence of a specific workflow would be `client.workflow.getHandle(workflowId).describe()`. This method will throw if there is no such workflow. It will return a `WorkflowExecutionInfo` corresponding to the latest execution of a workflow with that workflowId if such a workflow exists. On this description, you can check the `status` property to know if that workflow execution is still running, has failed, or has completed normally.

Reactions: üëÄ 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-02 23:07:10.000 UTC</summary>

Also, we do not yet provide a high level API for the `countWorkflowExecutions` operation, but we do for the `listWorkflowExecutions`:

```
  for await (const workflowInfo of client.workflow.list({ query: 'WorkflowId="MyWorkflowId"' })) {
    console.log(`${workflowInfo.workflowId} ${workflowInfo.runId}`);
  }
```

Note that both `listWorkflowExecutions` and `countWorkflowExecutions` are based on search queries. They are generally meant to find a list of workflows, not a single workflow.

If you still want to use the `countWorkflowExecutions` operation, you can do so through the raw gRPC API. The syntax for this would be:

```ts
    const response = await client.workflow.workflowService.countWorkflowExecutions({
      namespace: this.options.namespace,
      query: "WorkflowId = 'test'",
    });
    const count = response.count;
```

Reactions: üëÄ 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-02 23:11:42.000 UTC</summary>

We could add an abstraction for this, couldn't hurt.

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>jdnichollsc</strong> commented on 2023-03-02 23:16:57.000 UTC</summary>

> client.workflow.

I was checking the types and I don't see any workflow object from the client:
![workflow client](https://user-images.githubusercontent.com/2154886/222584041-94841bd8-dc82-4814-80d8-baa9a2d5a0ee.png)

Let me try that gRPC API, is that a good solution or do you recommend any other alternative? <3

Thanks for your amazing support folks!

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-02 23:20:01.000 UTC</summary>

From your screenshot, it looks like you already have a `WorkflowClient`, so that would be:
- `this.client.getHandle(workflowId).describe()`,
- `this.client.workflow.list()`, or
- `this.client.workflowService.countWorkflowExecutions` for the raw gRPC api.

</details>

<details>
<summary><strong>jdnichollsc</strong> commented on 2023-03-02 23:23:02.000 UTC</summary>

> Also, we do not yet provide a high level API for the `countWorkflowExecutions` operation, but we do for the `listWorkflowExecutions`:
> 
> ```
>   for await (const workflowInfo of client.workflow.list({ query: 'WorkflowId="MyWorkflowId"' })) {
>     console.log(`${workflowInfo.workflowId} ${workflowInfo.runId}`);
>   }
> ```
> 
> Note that both `listWorkflowExecutions` and `countWorkflowExecutions` are based on search queries. They are generally meant to find a list of workflows, not a single workflow.
> 
> If you still want to use the `countWorkflowExecutions` operation, you can do so through the raw gRPC API. The syntax for this would be:
> 
> ```ts
>     const response = await client.workflow.workflowService.countWorkflowExecutions({
>       namespace: this.options.namespace,
>       query: "WorkflowId = 'test'",
>     });
>     const count = response.count;
> ```

Oh I'm getting this other error:
```sh
> ‚îÇ [Nest] 60  - 03/02/2023, 11:19:44 PM   ERROR [ExceptionsHandler] 3 INVALID_ARGUMENT: Operation not support ‚îÇ
‚îÇ Error: 3 INVALID_ARGUMENT: Operation not supported. Please use on Elasticsearch                            ‚îÇ
‚îÇ     at Object.callErrorFromStatus (/baxus-services/node_modules/@grpc/grpc-js/src/call.ts:81:17)           ‚îÇ
‚îÇ     at Object.onReceiveStatus (/baxus-services/node_modules/@grpc/grpc-js/src/client.ts:358:36)            ‚îÇ
‚îÇ     at /baxus-services/node_modules/@grpc/grpc-js/src/call-stream.ts:210:27                                ‚îÇ
‚îÇ     at onReceiveStatus (/baxus-services/node_modules/@temporalio/client/src/grpc-retry.ts:176:17)          ‚îÇ
‚îÇ     at Object.onReceiveStatus (/baxus-services/node_modules/@temporalio/client/src/grpc-retry.ts:180:13)   ‚îÇ
‚îÇ     at InterceptingListenerImpl.onReceiveStatus (/baxus-services/node_modules/@grpc/grpc-js/src/call-strea ‚îÇ
‚îÇ     at Object.onReceiveStatus (/baxus-services/node_modules/@grpc/grpc-js/src/client-interceptors.ts:462:3 ‚îÇ
‚îÇ     at Object.onReceiveStatus (/baxus-services/node_modules/@grpc/grpc-js/src/client-interceptors.ts:424:4 ‚îÇ
‚îÇ     at /baxus-services/node_modules/@grpc/grpc-js/src/call-stream.ts:334:24                                ‚îÇ
‚îÇ     at processTicksAndRejections (node:internal/process/task_queues:78:11)                                 ‚îÇ
‚îÇ for call at                                                                                                ‚îÇ
‚îÇ     at ServiceClientImpl.makeUnaryRequest (/baxus-services/node_modules/@grpc/grpc-js/src/client.ts:328:30 ‚îÇ
‚îÇ     at Service.rpcImpl (/baxus-services/node_modules/@temporalio/client/src/connection.ts:340:21)          ‚îÇ
‚îÇ     at Service.rpcCall (/baxus-services/node_modules/protobufjs/src/rpc/service.js:94:21)                  ‚îÇ
‚îÇ     at executor (/baxus-services/node_modules/@protobufjs/aspromise/index.js:44:16)                        ‚îÇ
‚îÇ     at new Promise (<anonymous>)                                                                           ‚îÇ
‚îÇ     at Object.asPromise (/baxus-services/node_modules/@protobufjs/aspromise/index.js:28:12)                ‚îÇ
‚îÇ     at Service.rpcCall (/baxus-services/node_modules/protobufjs/src/rpc/service.js:86:21)                  ‚îÇ
‚îÇ     at Service.countWorkflowExecutions (eval at Codegen (/baxus-services/node_modules/@protobufjs/codegen/ ‚îÇ
‚îÇ     at CheckoutService.checkWorkflowExecutionExists (/baxus-services/dist/apps/api/main.js:2065:61)        ‚îÇ
‚îÇ     at CheckoutController.checkWorkflowExecutionExists (/baxus-services/dist/apps/api/main.js:1889:37)  
```

Let me try the other alternatives!

</details>

<details>
<summary><strong>jdnichollsc</strong> commented on 2023-03-03 00:04:05.000 UTC</summary>

> * this.client.getHandle(workflowId).describe()

This is working great, thanks for your help! :tada: 

About the implementation to validate if a workflow is running with this SDK, is this Ok?

```ts
async checkIfWorkflowExecutionIsRunning(workflowId: string): Promise<boolean> {
  try {
    const { status } = await this.client.getHandle(workflowId).describe();
    return (
      status.code === temporal.api.enums.v1.WorkflowExecutionStatus.WORKFLOW_EXECUTION_STATUS_RUNNING ||
      status.code === temporal.api.enums.v1.WorkflowExecutionStatus.WORKFLOW_EXECUTION_STATUS_CONTINUED_AS_NEW
    );
  } catch (error) {
    this.logger.error(`checkIfWorkflowExecutionIsRunning(${workflowId})`, error);
    if (error instanceof WorkflowNotFoundError) {
      return false;
    }
    throw error;
  }
}

```

Thanks folks!

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-03 00:08:26.000 UTC</summary>

Checking for status code `WORKFLOW_EXECUTION_STATUS_RUNNING` should be enough.

If the workflow continued as new, then `getHandle(workflowId)` (without a `runId`) should have returned the continuation workflow, which will be "running", rather than the original workflow, which will have status "continued as new".

Reactions: ‚ù§Ô∏è 2

</details>

<details>
<summary><strong>jdnichollsc</strong> commented on 2023-03-03 00:23:51.000 UTC</summary>

@mjameswh Beautiful, thanks James for your amazing feedback! <3

You save my day, have a great day folks :+1: 

</details>

<details>
<summary><strong>nikhilbhatia08</strong> commented on 2024-10-01 15:32:26.000 UTC</summary>

I would like to give this issue a try.

</details>


---

<a id="933"></a>

### #933: [Feature Request] Create a separate "core" library for workflows that does not include bundler deps.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/933 |
| **State** | OPEN |
| **Author** | psigen (Pras Velagapudi) |
| **Created** | 2022-10-22 16:24:02.000 UTC (3y 2m ago) |
| **Updated** | 2025-02-06 13:52:26.000 UTC |
| **Upvotes** | 6 |
| **Comments** | 2 |
| **Priority Score** | 14 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 6 |

#### Description

### Is your feature request related to a problem? Please describe.

Dependencies are structured in `@temporalio/worker`'s package.json such that there is no way to not include `webpack` + `@swc/core` in a runtime build, because `@temporalio/worker` includes them in `dependencies` regardless of whether runtime bundling is required or not.

`@swc/core` is around ~150MB, so it adds a lot of bloat to distroless images and goes completely unused if workflow bundling has already happened in a separate build step, which is common in containerized build processes.

### Describe the solution you'd like

It would be great if we had a runtime package (e.g. `@temporalio/worker-core`) which just contained minimal deps for running a worker and excluded bundler components.  It could itself be a dependency of the full `@temporalio/worker` for compatibility.

### Additional context

I added an example build with a step to manually strip out bundler dependencies here:
https://github.com/psigen/temporal-ts-example/blob/main/Dockerfile#L77

This reduced runtime images by almost 200MB, to a pretty manageable <300MB overall size for a distroless image.

Original idea from [this slack thread](https://temporalio.slack.com/archives/C01DKSMU94L/p1666364463170599?thread_ts=1666045881.718069&cid=C01DKSMU94L)

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 19:48:34.000 UTC</summary>

This is a summary of [my comment here](https://github.com/temporalio/sdk-typescript/issues/1613#issuecomment-2619435978):

To avoid breaking existing code, we should really split the current `worker` package in two: `bundler` and `worker-core`, then have `worker` reexport everything from the two others. The `worker` package would be deprecated, but would need to be kept around until the next major release.

Now, that's totally feasible, but has some painful consequences in regard to other ongoing development efforts ‚Äî pretty much all outstanding PRs and WIP on feature branches would get broken by this change, requiring non-trivial manual work to conciliate changes. That's obviously not a complete blocker, but simply means that we should try to complete and merge as much ongoing work as we can before investing effort in splitting `worker`.

In the mean time, one may work around this by using any of the following mechanisms:
- [NPM's `overrides` property](https://docs.npmjs.com/cli/v11/configuring-npm/package-json#overrides);
- [`yarn`'s resolutions property](https://classic.yarnpkg.com/en/docs/package-json#toc-resolutions);
- [PNPM's `overrides` property](https://pnpm.io/package_json#pnpmoverrides);
- [PNPM's `readPackage` hook](https://pnpm.io/pnpmfile).

Reactions: üëç 3

</details>

<details>
<summary><strong>shamrin</strong> commented on 2025-02-06 13:52:26.000 UTC</summary>

NPM `overrides` feature lacks an ability to skip dependency. I had to manually edit `package-lock.json` to accomplish it:

```shell
# step 1: install worker
npm install @temporalio/worker

# step 2: manually remove all references to `@swc/core` and `swc-loader` from package-lock.json

# step 3: reinstall everything based on modified package-lock.json
rm -rf node_modules/
npm install
```

</details>


---

<a id="852"></a>

### #852: Unable to get @temporalio/nyc-test-coverage working in jest

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/852 |
| **State** | CLOSED |
| **Author** | bennidhamma (Ben Joldersma) |
| **Created** | 2022-08-29 02:27:44.000 UTC (3y 4m ago) |
| **Updated** | 2022-09-17 22:15:58.000 UTC |
| **Closed** | 2022-09-17 22:15:58.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 12 |
| **Priority Score** | 14 |
| **Labels** | bug |
| **Assignees** | vkarpov15 |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Trying to get `@temporalio/nyc-test-coverage` working with our typescript temporal jest tests. 

### Describe the bug

After following the instructions in the [package readme](https://github.com/temporalio/sdk-typescript/blob/main/packages/nyc-test-coverage/README.md), no coverage is generated.

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

I've generated a minimal repro draft PR: https://github.com/temporalio/samples-typescript/pull/192

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux x86_64
- Temporal Version: 1.1.0
- using temporal test server

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (12)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-29 02:36:02.000 UTC</summary>

Sorry, that's hopefully fixed in https://github.com/temporalio/sdk-typescript/pull/843 , which I can release Tuesday

</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 03:05:33.000 UTC</summary>

I don't /think/ so? I pulled the repo down, built and linked the nyc-test-coverage package directly in locally and still don't get any workflow coverage in the activities-examples sample project jest tests.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-29 03:18:58.000 UTC</summary>

I haven‚Äôt tried this package, it was contributed by @vkarpov15.
In the readme he put instructions explaining how to use this with mocha, I‚Äôm not sure if it works with jest.

</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 05:26:46.000 UTC</summary>

@vkarpov15, do you know if nyc-test-coverage works with jest? Any chance you could update the activities-examples sample to work with it?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-29 16:33:36.000 UTC</summary>

Looking at how this is used, it seems like it should be supported in jest but I'd test and verify.
@bennidhamma can you explain exactly what steps you took?
Does this work with mocha locally?

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-08-29 19:59:44.000 UTC</summary>

@bennidhamma we haven't tried it with Jest yet, I'll give it a shot and see if we can get it working.

Reactions: üéâ 1

</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 20:02:57.000 UTC</summary>

I'll take a look at mocha too!

</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 22:21:35.000 UTC</summary>

I was able to get it to run and generate output in mocha. But... it doesn't look like the body of the workflow function is being covered:
![image](https://user-images.githubusercontent.com/309808/187309150-6f98c572-2e40-4f6f-86b8-93f8ebb1cad2.png)

![image](https://user-images.githubusercontent.com/309808/187309047-61574bd4-2745-441e-a582-fe797beb1942.png)



</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 23:23:54.000 UTC</summary>

> @bennidhamma can you explain exactly what steps you took?
1. install `nyc`, and `@temporalio/nyc-test-coverage` (note: I linked nyc-test-coverage from a local build with lib dir)
2. add workflow coverage instrumentation interceptor, sink, and call merge in after function
3. build
4. run `nyc instrument lib lib --in-place`
5. run mocha with `npx nyc --report-dir nyc-cov --reporter lcov --reporter=text-summary mocha "lib/mocha/*.js"`

</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 23:27:26.000 UTC</summary>

(mocha changes are also in https://github.com/temporalio/samples-typescript/pull/192)

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-29 23:36:08.000 UTC</summary>

Thanks for looking into this @bennidhamma, I've assigned @vkarpov15 to it for further investigation.

Reactions: üéâ 1

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-09-16 17:11:31.000 UTC</summary>

@bennidhamma I'm unable to repro. I was thinking maybe there was some issue with using npx in step 5, but that doesn't seem to matter. Below is the output of running the last 3 steps with 8100ddc6c8bbe82d4b3dcfff84ed3721aa130511:

```
$ npm run build

> temporal-activities-examples@0.1.0 build
> tsc --build

$ ./node_modules/.bin/nyc instrument lib lib --in-place
$ npx nyc --report-dir nyc-cov --reporter lcov --reporter=text-summary mocha "lib/mocha/*.js"


  example workflow
    ‚úì returns correct result
    ‚úì retries one failure
    ‚úì bubbles up activity errors


  3 passing (2s)


=============================== Coverage summary ===============================
Statements   : 50% ( 22/44 )
Branches     : 0% ( 0/4 )
Functions    : 30% ( 3/10 )
Lines        : 47.5% ( 19/40 )
================================================================================
$ 

```

Below is a screenshot of the lcov HTML report for `src/workflows.ts` from the `nyc-cov` directory. It does show that `httpWorkflow()` is executed during the tests.

![image](https://user-images.githubusercontent.com/1620265/190690766-063179cb-177a-49ae-ba03-2af321314fa0.png)

My best guess is that you're somehow re-building after manually instrumenting.

</details>


---

<a id="181"></a>

### #181: [strawman] React-like API proposal

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/181 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-08-09 18:59:10.000 UTC (4y 5m ago) |
| **Updated** | 2021-09-13 06:38:53.000 UTC |
| **Closed** | 2021-09-13 06:38:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 14 |
| **Priority Score** | 14 |
| **Labels** | None |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

just sketching out what a React-like API might look like. it might help solve some of our API design challenges (by starting from something already proven) and our adoption might be helped GREATLY since most JS people know React.

where we depart from React: 
- React doesn't model Sagas
- React doesn't need hook registration in advance
- React doesn't allow external invocations.

other design considerations: 
- flexible file and folder structure as much as possible.
- type safety without poor JS dev experience

## Workflows and Activities

```tsx
import { Activity, Workflow } from 'fakeTemporal'

export const activities = {
	async chargeStripe(amount) {
		res = await call('/charge', amount)
		return res // todo: handle err case
	}
	async reverseCharge(id) {
		res = await call('/reverse', id)
		return res // todo: handle err case
	}
	async function chargeStripe(amount) {
		res = await call('/charge', amount)
		return res // todo: handle err case
	}
} 


type ValidStatuses = 'EMAIL' | 'COMPLETE' | 'CANCELED'
const invoke = (activity, ...args) = {
	// convenience function; users can call Activity.create directly if they need to customize/override these
	return Activity.create({
				activity, 
				options: {
					startToCloseTimeout: 1000 // this is the default if options not specified
				}
			})(...args)
}
export class MyWorkflow extends Workflow <WFInterface> {
	status: ValidStatuses = 'EMAIL' // all non private variables are queryable
	activities = activities // a workflow registers its own activities by convenience
	signals = {
		cancelTransaction() {
			if (status === 'COMPLETE') {
				return 'Transaction already completed, cannnot be canceled"
			} else {
				status = 'CANCELED'
			}
		}
	}
	async execute(amount) {
		const transactionId = invoke(activities.chargeStripe, amount)
		sleep(3000) // wait for cancel
		if (status === 'CANCELED') {
			await invoke(activities.reverseCharge, amount)
			status = 'COMPLETE'
		} else {
			await invoke(activities.emailUser, transactionId)
		}
	}
}

// usage
import { Client } from 'fakeTemporal'

const client = new Client({ 
	register: MyWorkflow, // register both WF and associated activity
	taskQueue: 'my-workflow' // defaults to `node-workflow`
})
client.execute(amount)
console.log(client.query.status) // 'EMAIL'
client.signal.cancelTransaction() // cancel
console.log(client.query.status) // 'CANCEL'
```


## Infinite Workflows

Infinite Workflows have no `execute`, they are always live and `continueAsNew` under the hood. We might also call them `Entity`s

```tsx
import { Activity, InfiniteWorkflow } from 'fakeTemporal'

// as above
export class MyWorkflow extends InfiniteWorkflow <WFInterface> {
	status: ValidStatuses = 'WAITING'
	activities = activities // a workflow registers its own activities by convenience
	signals = {
		cancelTransaction() {
			status = 'CANCELED'
		}
		startTransaction() {
			const transactionId = invoke(activities.chargeStripe, amount)
			sleep(3000) // wait for cancel
			if (status === 'CANCELED') {
				await invoke(activities.reverseCharge, amount)
				status = 'WAITING'
			} else {
				await invoke(activities.emailUser, transactionId)
			}		
		}
	}
}

// usage
import { Client } from 'fakeTemporal'

const client = new Client({ 
	register: MyWorkflow, // register both WF and associated activity
})
client.signal.startTransaction() // started
console.log(client.query.status) // 'WAITING'
client.signal.cancelTransaction() // canceled
console.log(client.query.status) // 'CANCELED'
```



#### Comments (14)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 20:06:52.000 UTC</summary>

Yes, this is the direction I was going too.
Using a class for workflows, I still like the anonymous class (`{ main, ... }`) option but the downside of it is that it doesn't have a reference-able name like a class, this might solve the workflow client issue where you need to give the filename and the type: `client.stub<WFInterface>('filename')`, this can turn into `client.stub(MyWorkflow)` as you suggested.

I thought about renaming `main` to `execute` too, it aligns with the workflow stub method.

Some issues that I see with this sketch:
- Workflows and activities can't live in the same file because workflows can't import everything activities can
  - This may be solvable by adding some boundaries to where activities and workflows are in the file sort of like svelte's tags
- The are to problems with the `invoke` function:
  1. There's no way to pass in activity options
  2. What would be the equivalent of `invoke` for child workflows?
 
I like this instead of invoke:
```ts
const { myActivity } = Context.activities({ taskQueue: 'q' });
await myActivity(...argsWithTypeHints);  // Typescript only :(
```

Making `invoke` return a Promise is very important too because users can use familiar `async / await` and `Promise.{all,catch}` syntax.

I have managed to flatten the signals and queries and still keep the implementation type safe.

It still requires you to define signals nested in the interface though:
```ts
export interface MyInterface extends WorkflowInterface {
  execute(x: number): Promise<void>;
  signals: {
    incr(i: number): void;
  };
}

export class MyWorkflow implements Workflow<MyInterface> {
  incrSignal(i: number): Promise<void> {
    // ...
  }
  execute(x: number): Promise<void> {
    // ...
  }
}
```

This can be achieved with template literals in TS:
```ts
export type Signals<S extends WorkflowInterface['signals']> = S extends Record<string, WorkflowSignalType>
  ? {
      [P in keyof S as `${string & P}Signal`]: (...args: Parameters<S[P]>) => ReturnType<S[P]>;
    }
  : {};

export type Workflow<W extends WorkflowInterface> = Signals<W['signals']> & {
  execute(...args: Parameters<W['execute']>): ReturnType<W['execute']>;
};
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 20:28:08.000 UTC</summary>

A direct implementation of the current workflow interface with a class would look like:
```ts
export class MyAlternative implements MyInterface {
  value = 0;

  async execute(x: number): Promise<void> {
    this.value = x;
    await CancellationScope.current().cancelRequested;
  }

  signals = {
    incr: (i: number): void => { // bind this to the MyAlternative instance
      this.value += i;
    },
  };
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 20:35:30.000 UTC</summary>

As for infinite workflows I've given some thought to that too, we all have... :)
The biggest problem is that you can't insure that there'll be an opportunity to continue as new, for example here:
```ts
export class InfiniteExample extends InfiniteWorkflow<SomeInterface> {
  signals = {
    preventContinueAsNew: async (): Promise<void> => {
      for (;;) {
        await sleep(1000);
      }
    },
  };
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 20:57:23.000 UTC</summary>

Another option that comes to mind is having named factory function.
This approach allows more flexibility because it allows customization of the workflow based on given arguments. It has already been requested by someone on the community slack.
Another advantage here is that initialization is done when workflow starts, so there's no need to pre-initialize variables like `value` as shown in the example above.

```ts
// makeWorkflow receives execute args
export function myWorkflow(initialValue: number) {
  let value = initialValue;

  async function execute(): Promise<void> {
    await CancellationScope.current().cancelRequested;
  }
  const signals = {
    incr(i: number): void {
      value += i;
    },
  };
  const queries = {
    value(): number {
      return value;
    },
  };

  return {
    execute,
    signals,
    queries,
  };
  // alternatively return the MyAlternative from the sample above
  // but change the initial value value to be provided in the constructor instead of the execute function.
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 21:06:09.000 UTC</summary>

We could use the function name for registration (export them all from `index.ts`?)

Using registration we can remove the need to specify both type and filename to create a workflow stub:
```ts
// workflows/index.ts
export function workflowA() { ... }
export function workflowB() { ... }

// express-app/start-a-workflow.ts
import { workflowA } from '../workflows';
const client = new WorkflowStub(workflowA);
```


Reactions: üëç 1

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-08-11 00:59:33.000 UTC</summary>

> Workflows and activities can't live in the same file because workflows can't import everything activities can

i am ok with this for the convenience. can use hooks style linting but honestly i dont really think we need it, people understand that different rules apply for different thigns

> The are to problems with the invoke function: There's no way to pass in activity options

you can, the `invoke` function is a thin wrapper for `Activity.create` (made up API), you can change whatever you want

> What would be the equivalent of invoke for child workflows?

`Workflow.StartChild`?

> The biggest problem is that you can't insure that there'll be an opportunity to continue as new, for example here

bad code will always be possible and we shouldnt try to solve the halting problem :shrug:

> Another option that comes to mind is having named factory function.

You can also customize workflows in constructor or with public class fields. but i dont really mind this is close enough to classes that its not that different

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-15 10:28:07.000 UTC</summary>

> > Workflows and activities can't live in the same file because workflows can't import everything activities can
> 
> i am ok with this for the convenience. can use hooks style linting but honestly i dont really think we need it, people understand that different rules apply for different thigns

What are you saying, that there's a way to put workflows and activities in the same file?

> > The are to problems with the invoke function: There's no way to pass in activity options
> 
> you can, the `invoke` function is a thin wrapper for `Activity.create` (made up API), you can change whatever you want

Then why do you even need invoke, if create can just return a callable?

> > What would be the equivalent of invoke for child workflows?
> 
> `Workflow.StartChild`?

Wouldn't that imply that invoke should be called startActivity or something similar?
 
> > The biggest problem is that you can't insure that there'll be an opportunity to continue as new, for example here
> 
> bad code will always be possible and we shouldnt try to solve the halting problem ü§∑

I'd rather come up with a solution that does not allow users to write WFs that can get stuck, there are other scenarios which can prevent a WF from continuing as new, some not as obvious.

> > Another option that comes to mind is having named factory function.
> 
> You can also customize workflows in constructor or with public class fields. but i dont really mind this is close enough to classes that its not that different

It's very similar but more flexible.

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-08-30 17:48:23.000 UTC</summary>

we discussed this offline - Roey will explore ways to organize WF+Activities as a single file (so we closely model React components and hooks/lifecycle methods) and/or look at multiple workflow directories so we can organize activities and workflows in logical biz logic units

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-08-30 18:25:12.000 UTC</summary>

more meeting notes: we agreed on functions

- multiple WFs in same file
- WFs and activities in same file?
- simple init value behavior
- no global state 
	- advanced users can optimize by reusing v8 context for multiple wf's
	- wf code run in browser


## normal workflow

```ts
export function myWorkflow(initialValue: number) {
  let value = initialValue; // EVERY variable queryable (unless _prefixed)

  return {
	execute() {
		// "main" loop - if omitted, becomes an "infinite" workflow that continuesasnew after every signal?
	}
    signals: {
      incr(i: number): void {
        value += i;
      },
    }
  };
}
```



</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-30 19:46:30.000 UTC</summary>

We can't continue as new after every signal, there might be running activities / timers / child workflows.
The only time you can auto continue as new is when there aren't any pending completions in the workflow.
Even that's not completely safe, but we may be able to make it "safe enough" by constraining the API.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-30 19:47:08.000 UTC</summary>

We also agreed to flatten the `Context` object into the `@temporalio/workflow` package.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-01 12:37:24.000 UTC</summary>

Tried to get our proposal working and it ran into a TS limitation where type safety for `execute` args requires our users to do some extra work.

First of all if we define the workflow interface as follows:
```ts
export interface MyWorkflow extends WorkflowInterface {
  execute(a: number, b: string): Promise<string>;
}
```

If we want to implement a factory for it we need a `WorkflowFactory` generic type to validate the factory args:

```ts
export const myWorkflow: WorkflowFactory<MyWorkflow> = (a: number, b: string) => {
  return {
    async execute(): Promise<string> {
      return 'hey';
    },
  };
}
```

Or with a `function`:

```ts
export const myWorkflow: WorkflowFactory<MyWorkflow> = function(a: number, b: string) {
  return {
    async execute(): Promise<string> {
      return 'hey';
    },
  };
}
``` 

With classes this is impossible to validate in one go and requires 2 additional types, `WorkflowImpl` and `WorkflowConstructor`:

```ts
// "implements" here is redundant because `WorkflowConstructor<T>` validates this below.
class MyWorkflowImpl implements WorkflowImpl<MyWorkflow> {
  // implements WorkflowImpl<MyWorkflow> does not type check the constructor
  constructor(protected a: number, protected b: string) {}

  async execute(): Promise<string> {
    return 'wow';
  }

  signals = {
    async quit() {},
  };
}

const myWorkflow: WorkflowConstructor<MyWorkflow> = MyWorkflowImpl;

// Or with a factory

const myWorkflow: WorkflowFactory<MyWorkflow> = (...args) => new MyWorkflowImpl(...args);
```

It might not be the end of the world, just a minor inconvenience.

@sw-yx WDYT?

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-09-02 17:11:44.000 UTC</summary>

i think its ok too. function style still seems best. realistically i'm not really going to implement `WorkflowFactory<>` in my code, i'm just going to expect TypeScript to ducktype validate at the callsite.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-07 19:05:35.000 UTC</summary>

I estimate that 60% of Typescript programmers are familiar with React. That's a large number, but still leaves a substantial number who aren't. Therefore I caution against overestimating the cognitive resonance achieved from a React API. (Which is not to say that this isn't a good idea on its own merits.)

</details>


---

<a id="1731"></a>

### #1731: [Bug] Unable to run tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1731 |
| **State** | CLOSED |
| **Author** | ksapchuk (Kirill) |
| **Created** | 2025-06-25 03:03:42.000 UTC (6 months ago) |
| **Updated** | 2025-06-26 16:32:46.000 UTC |
| **Closed** | 2025-06-26 15:31:44.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 7 |
| **Priority Score** | 13 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 üëÄ 4 |

#### Description

### What are you really trying to do?
Something changed in the last few days and we are no longer able to run tests using the temporal test library. 
<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

### Describe the bug
The tests fail to start the temporal test server with an error 
```
The current machine does not support all of the following CPU features that are required by the image: [CX8, CMOV, FXSR, MMX, SSE, SSE2, SSE3, SSSE3, SSE4_1, SSE4_2, POPCNT, LZCNT, AVX, AVX2, BMI1, BMI2, FMA, F16C].
```
<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction
Install the time skipping test example https://github.com/temporalio/samples-typescript/tree/main/timer-examples#testing and run the tests
```
timer-examples % npm test

> temporal-timer@0.1.0 test
> mocha --require ts-node/register --require source-map-support/register src/test/*.test.ts


  countdownWorkflow
The current machine does not support all of the following CPU features that are required by the image: [CX8, CMOV, FXSR, MMX, SSE, SSE2, SSE3, SSSE3, SSE4_1, SSE4_2, POPCNT, LZCNT, AVX, AVX2, BMI1, BMI2, FMA, F16C].
Please rebuild the executable with an appropriate setting of the -march option.
```
### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Apple M3 Pro
- Temporal Version: Typescript 1.11.8

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (7)

<details>
<summary><strong>EssentKoen</strong> commented on 2025-06-25 11:49:51.000 UTC</summary>

+1
We are experiencing the same issue.

OS - mac - M1 through M4.
Something seems to be broken with https://temporal.download as well, but the error seems to indicate a version is available, but somehow broken. 
I see that I have a new version which is 10MB smaller. You can actually use this (search for "temporal-test-server-sdk-typescript-1.11.8" in /private/var) to locate the broken executable.

Colleagues who still have the temporal-dev-server cached locally have no problems whatsoever, so as a workaround if you really need to, you can manually put that executable on your laptop on that location, then run again. Not sure where you can download a correct version at the moment, we are just lucky to still have the old one lying around.

If you download a correct test server, btw - you can also configure temporal to use a custom path so you don't have to finnick around as much as I previously indicated ;)

</details>

<details>
<summary><strong>vault-pay</strong> commented on 2025-06-25 17:14:21.000 UTC</summary>

I'm experiencing the same problem. I'm on M2 Max. 

</details>

<details>
<summary><strong>Seven4ME</strong> commented on 2025-06-25 17:15:30.000 UTC</summary>

^ Same for me

</details>

<details>
<summary><strong>Seven4ME</strong> commented on 2025-06-25 17:28:42.000 UTC</summary>

Who faced same issue - try to execute `fd temporal /private/var/folders | xargs rm` and then re-run tests.
Its helped to me.

Reactions: üëç 1

</details>

<details>
<summary><strong>EssentKoen</strong> commented on 2025-06-26 05:54:55.000 UTC</summary>

I think @Seven4ME 's comment suggests the download is no longer broken. 
I verified this by removing the existing executable and it indeed works. The download size is still down by 10MB, so that's nice I guess.

I would love to hear a report out from someone from Temporal on how to prevent something like this - we're now quite dependent on the download actually working at all times.

Other than that, I think this issue can be closed.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-26 15:31:44.000 UTC</summary>

**TLDR**

The upstream download file has been fixed. If you're still seeing the error message, you may need to remove the cached download file; just run `rm $TMPDIR/temporal-test-server-sdk-typescript-*` from a terminal window.

We're very sorry for that.


**What happened?**

The Temporal Test Server is developed in Java. It is then built into a standalone executable using GraalVM.

Until recently, due to limitations of our build system, it was not possible to use GraalVM to build standalone executables for ARM-based architectures. On MacOS, that was not a problem in most cases, because Apple's Rosetta would allow transparent execution the AMD64 build instead. But that wouldn't work on Linux, including in Docker running on Mac, which was a pain to many of our users.

Test Server 1.30.0 added native support for ARM64. To achieve that, we had to [completely rewrite our native-build scripts](https://github.com/temporalio/sdk-java/pull/2448). However, this new native-build script unintentionally turned on some compiler optimizations that depend on specific AMD64 CPU features. Some of those CPU features are not emulated by Apple's Rosetta, which means that using the Test Server 1.30.0 on an AMD-based Mac would not work, resulting in this error message:

```
The current machine does not support all of the following CPU features that are required by the image: [CX8, CMOV, FXSR, MMX, SSE, SSE2, SSE3, SSSE3, SSE4_1, SSE4_2, POPCNT, LZCNT, AVX, AVX2, BMI1, BMI2, FMA, F16C].
```

To be clear, we did not explicitly turn on those compiler optimizations: they are enabled by default by GraalVM's compiler, and need to be explicitly opted out. We didn't, and that was an oversight from our part.

The native-build process for our Test Server [has now been fixed](https://github.com/temporalio/sdk-java/pull/2571), so Test Server 1.30.1 will again run properly on MacOS.


**Why are we still downloading the AMD64 build on MacOS?**

Since we are now publishing an ARM64 build of the Test Server for MacOS, some may wonder why did the SDK downloaded the AMD64 1.30.0 build, which requires these CPU flags, rather than downloading and using the ARM build, which would completely avoid the need for Rosetta? After all, using the proper executable would have also avoided the observed issue.

That's because download of the Test Server executable happens indirectly through a download service we maintain (https://temporal.download/), which is there to provide a caching layer over downloading the executables directly from GitHub. That service also provides some basic routing rules, including the rule that says "If requesting Test Server for ARM64 on MacOS, then return the AMD64 build instead". As part of the work on publishing Test Server for ARM64, our download service has obviously been fixed is; that is: "If requesting Test Server *prior to 1.30.0*, for ARM64 on MacOS, then return the AMD64 build instead; otherwise, return the ARM64 build".

We had already fixed the download service code, but we intentionally delayed redeployment of the service, to be done _after_ the release of Test Server 1.30.0. There was simply no reason to urge this redeployment, as the legacy behavior (i.e. sending AMD64 build instead of ARM64 to MacOS users) should have still been correct, simply not optimal. More importantly, doing things in that order would make it easier for us to run some final tests before turning this on by default for all of our users.


**How can we protect ourself from similar incidents in the future?**

The SDK's `TestWorkflowEnvironment.createLocal()` and `TestWorkflowEnvironment.createTimeSkipping()` functions both accept passing in the path to predownloaded executables, rather than let them be automatically downloaded at run time by the SDK. Simply download manually the [Temporal CLI](https://github.com/temporalio/cli/releases) and the [Temporal Test Server](https://github.com/temporalio/sdk-java/releases) executables from their respective project's GitHub release page, then provide the file path of those executables when creating your `TestWorkflowEnvironment`.

Despite the extra work, this may actually be highly desirable depending on your specific needs.

Pre-downloading both executables have several benefits, including:

- Avoid test timeout flakes due to download taking too much time;
- Avoid being affected by ocasional outtages that may affect the download service;
- Guarantee that your tests are always running with the same version of the server.


Reactions: üéâ 1 ‚ù§Ô∏è 2

</details>

<details>
<summary><strong>EssentKoen</strong> commented on 2025-06-26 16:32:46.000 UTC</summary>

Thanks for the extensive update @mjameswh - much appreciated!

</details>


---

<a id="1443"></a>

### #1443: [Bug] Failure to start ephemeral server prevents shutdown of the process

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1443 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-06-14 16:02:00.000 UTC (1y 6m ago) |
| **Updated** | 2025-02-20 23:06:32.000 UTC |
| **Upvotes** | 6 |
| **Comments** | 1 |
| **Priority Score** | 13 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 6 |

#### Description

### Describe the bug

We regularly see patterns like the following in our CI; I presume this also affects users. The cause of the failure to start an ephemeral server isn't important (in this case, trying to use the time skipping server on Linux ARM, which isn't supported).

```
integration-workflows ‚Ä∫ before hook
Rejected promise returned by test. Reason:
UnexpectedError {
  message: 'Failed to start ephemeral server: HTTP status client error (404 Not Found) for url (https://temporal.download/temporal-test-server/default?arch=arm64&platform=linux&sdk-name=sdk-typescript&sdk-version=1.10.1)',
}

integration-workflows ‚Ä∫ after.always hook
Rejected promise returned by test. Reason:
TypeError {
  message: 'Cannot read properties of undefined (reading \'teardown\')',
}
‚Ä∫ <anonymous> (src/helpers-integration.ts:89:30)

...then process never completes shutdown
```

#### Comments (1)

<details>
<summary><strong>diogotorres97</strong> commented on 2025-02-20 23:06:32.000 UTC</summary>

Do we have a fix to run this on ARM machines?

Reactions: üëÄ 1

</details>


---

<a id="357"></a>

### #357: [Feature Request] Expose history size to Workflow code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/357 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-03 19:06:54.000 UTC (4y 2m ago) |
| **Updated** | 2022-06-01 17:58:40.000 UTC |
| **Closed** | 2022-06-01 17:58:40.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 9 |
| **Priority Score** | 13 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |
| **Reactions** | üëç 2 |

#### Description

[As discussed on our community slack](https://temporalio.slack.com/archives/C01DKSMU94L/p1635615168067800), we'd like to expose the number of history events and the aggregated payloads size to via `WorkflowInfo` so Workflow authors can make smarter decisions for when to continue as new.

#### Comments (9)

<details>
<summary><strong>calumpwebb</strong> commented on 2021-11-03 20:08:14.000 UTC</summary>

can the same issue (or way of solving this) be used for other sdks? We're mainly using the Go SDK and would want workflow history size on there too. 

</details>

<details>
<summary><strong>cretz</strong> commented on 2021-11-03 21:49:28.000 UTC</summary>

Definitely. Once implementation is defined on how best to do this, we can put this information on `WorkflowInfo` in Go assuming it's readily available. Same for Java (we try to maintain parity across SDKs). I will open the issues once the details are a bit better defined.

Reactions: üëç 2

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-12-07 19:35:45.000 UTC</summary>

are people able to use https://typescript.temporal.io/api/classes/proto.temporal.api.workflowservice.v1.workflowservice-1/#getworkflowexecutionhistory to get this?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-12-08 00:02:47.000 UTC</summary>

Yes but this isn't accessible to workflows

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-01-29 04:31:03.000 UTC</summary>

Related: 

> We should give `Workflow.isContinueAsNewNeeded` flag to the SDKs. And it should be coming from the service.

https://temporaltechnologies.slack.com/archives/C01FT8U10GK/p1643400086752909?thread_ts=1643398281.925129&cid=C01FT8U10GK

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-01 00:43:29.000 UTC</summary>

Corresponding sdk-features issue: https://github.com/temporalio/sdk-features/issues/16

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-10 17:25:58.000 UTC</summary>

Length we can expose now, size is waiting on it being provided by the server, which should come soon.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-05-13 15:53:27.000 UTC</summary>

> Length we can expose now, size is waiting on it being provided by the server, which should come soon.

Obtaining the history length from the SDK would already be a huge improvement.

Right now, in long running workflows, we need to "estimate" the history length so that we can `continueAsNew()` once we reach some arbitrary threshold. Determining an appropriate threshold is not _per se_ the issue here: it can be simply assumed that you have to continue as new after 10000 events... Lower this number if your workflow deals with large payloads...

Estimating the history length, however, is the hard part at present. There is simply no good and simple way to do it.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-06-01 14:08:51.000 UTC</summary>

In case it might be useful to someone else, it is possible to get a pretty good estimate of the history length using the following workflow interceptor:

```
import { WorkflowInterceptors } from '@temporalio/workflow';

let historyLength = 0;

export const interceptors = (): WorkflowInterceptors => ({
    internals: [
        {
            activate(input, next) {
                // +2 events per activation (WorkflowTaskScheduled and WorkflowTaskStarted)
                if (input.batchIndex === 0) historyLength += 2;

                // +1 event for each incoming "job", ie.:
                //
                // (history event type) ................ (job type)
                // ----------------------------------------------------
                // WorkflowExecutionStarted ............ startWorkflow
                // WorkflowExecutionSignaled ........... signalWorkflow
                // ChildWorkflowExecutionStarted ....... resolveChildWorkflowExecutionStart
                // ExternalWorkflowExecutionSignaled ... resolveSignalExternalWorkflow
                // TimerFired .......................... fireTimer
                // WorkflowTaskCompleted ............... resolveActivity
                // ChildWorkflowExecutionStarted ....... resolveChildWorkflowExecution
                // ...
                //
                historyLength += input.activation.jobs?.length ?? 0;

                // Note that some [uncommon] incoming events does not result in a 'job'.
                // The estimate may therefore be inaccurate. Can't do much about it.

                return next(input);
            },
            concludeActivation(input, next) {
                // +1 event per conclusion (WorkflowTaskCompleted)
                historyLength += 1;

                // +1 event for each outgoing "command", ie.:
                //
                // (command type) ...................... (history event type)
                // ----------------------------------------------------
                // startChildWorkflowExecution ......... StartStartChildWorkflowExecutionInitiated
                // signalExternalWorkflowExecution ..... SignalExternalWorkflowExecution
                // startTimer .......................... TimerStarted
                // ...
                //
                historyLength += input.commands?.length ?? 0;

                return next(input);
            },
        },
    ],
});

export function getTemporalHistoryLength() {
    return historyLength;
}
```

</details>


---

<a id="226"></a>

### #226: [Feature Request] Test support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/226 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2021-09-07 19:48:48.000 UTC (4y 4m ago) |
| **Updated** | 2022-10-11 23:28:04.000 UTC |
| **Closed** | 2022-10-11 23:28:04.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 9 |
| **Priority Score** | 13 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

Testability is a major selling point of Temporal but the Node SDK and its docs are [currently lacking](https://docs.temporal.io/docs/node/hello-world#testing):

> There's no official support for testing Workflows and Activities.
> * Since Activities are async functions, they should be testable as long as you avoid using Context or are able to mock it.
> * You can test Workflows by running them with a WorkflowClient.

I added a basic ts-jest configuration in [one example](https://github.com/temporalio/temporal-pendulum/blob/main/position-node/jest.config.js), but I couldn't figure out how to write a workflow test.

### Describe the solution you'd like

I think I need something like the TestWorkflowEnvironment that Java and Go provide before I can easily test workflows.

It would be helpful if the create-project example included a basic jest (and eslint) configuration.

### Additional context

It would also be helpful if the create-project example included a basic eslint configuration. Something that was useful, but not too bloated, and easily swapped out if needed.

#### Comments (9)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 08:43:24.000 UTC</summary>

This is a known issue, thanks for opening this so it can be tracked.

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2021-09-20 15:21:33.000 UTC</summary>

@joebowbeer you can take a look at https://github.com/temporalio/samples-node/pull/11, I added a basic test case there.

The trick is that you can stub out activity dependencies using sinon. The big thing that's missing is being able to advance time programatically, which is something that the Go SDK has a neat API for.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-20 22:09:16.000 UTC</summary>

@vkarpov15 Thanks! I'm motivated to have another look at the pendulum test now.

I like sinon and occasionally will even use proxyquire for the most test-resistant cases.

At first glance, though, I like the readability of the golang tests better, but the http test reads OK once I dive in.

I'll try ts-jest in the pendulum sample and see how it goes. Jest is simpler and more opinionated than mocha, and provides its own mocking support.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-21 20:51:40.000 UTC</summary>

@vkarpov15 Following up, after looking at the http sample _integration_ test in more detail:

### Should TypeScript workflows be unit-testable?

The Go and Java SDKs have an in-memory runner to enable this. The http _integration_ test is doing something similar to what the Go and Java docs present as _unit_ tests. I tried to run the samples-node http test, saw a transport error, and only then realized I needed to run a real local temporal server.

### ts-tester vs transpiled src

It surprised me that the test was importing from `../lib` which, e.g., the starter code does not do explicitly.

I'm bothered by the inconsistency of having ts-node load the test code, while the code under test is loaded from the transpiler's outDir: `../lib`.

Unless ts-node can run everything, I'd prefer to see the src and test code handled the same way: transpiled first and loaded from the outDir. This way, perhaps with some aliasing, the explicit `../lib` can be hidden from the test code.

### mocha vs jest

I think jest would make a better impression.

Jest is newer, simpler, more-opinionated mocha, and jest mocking should be able to replace sinon as well. I think most react programmers are using jest now.

### src vs test

I would prefer to have the test files beside their src counterpart.

For example:  https://github.com/temporalio/temporal-pendulum/blob/main/position-node/src/workflows/pendulum.test.ts

This simplifies adding a new test file, and as another benefit, it easily hides at least one of the explicit references to `../lib`.

Not a big difference, but simpler is better when it comes to samples.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-22 06:58:43.000 UTC</summary>

@joebowbeer we have plans to support proper testing for Core based SDKs, it's quite an undertaking because we have to implement a mocked version of the server for time skipping support.

Some test runners ([jest included](https://www.npmjs.com/package/ts-jest)) support running TS directly ([alternative](https://github.com/facebook/jest#using-typescript)).
I've usually avoided that because I always have a terminal running the typescript compiler in watch mode which is significantly faster than recompiling from scratch (not sure if there's a test runner that can do that).

I don't have a test framework preference, both jest and mocha are okay IMO.

As for src vs. test, a lot of devs like to separate their test code.
We might want to use [project references](https://www.typescriptlang.org/docs/handbook/project-references.html) to preserve the output directory structure (`src` -> `lib` instead of `src` -> `lib/src`).

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-22 08:02:31.000 UTC</summary>

@bergundy Thanks for clarifying. To be clear, I'm pushing for a simple approach to make the samples easy to read and test, and to encourage testing from day -1. (What I would actually use in a commercial project might be different.)

What you are describing sounds good to me: Have both src and test code transpiled via watch and run from the outDir.

I wrote:

> I'd prefer to see the src and test code handled the same way: transpiled first and loaded from the outDir

By doing this, the explicit outDir path should not need to appear in the src or test code.

However, this is not how the http integration test is currently configured. Only its src is transpiled to outDir while its test code is transpiled by ts-mocha, and there are two references to outDir in the test code.

When transpiling both src and tests, I think it works best if the path relationships are maintained in the outDir. Then the relative paths and aliases will be preserved in the outDir.

Example: `src` -> `lib/src`, `test` -> `lib/test`

Another way to preserve this relationship is to have `.ts` and `.test.ts` as siblings in the same folder, as I prefer for unit tests, but neither way should be precluded.

Similarly, neither jest nor mocha+sinon should be precluded, but I think jest will make for better examples because it has fewer moving parts and is designed for ease of use.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-07 18:32:22.000 UTC</summary>

For Google, the error you get when you call an activity function directly (eg when unit testing) that uses `Context.current()`: `Activity context not initialized`. 

Current solution is to mock Context or use integration tests (have a Worker call activities, which will work because the Worker sets up Context)

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-08 08:10:44.000 UTC</summary>

Test framework is coming, and it will support mocking the activity context.

Reactions: üëÄ 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:28:04.000 UTC</summary>

Closing this as part of issue cleanup.

</details>


---

<a id="1866"></a>

### #1866: [Bug] Signal caused `condition` to fail with `CancelledFailure` on `1.14.0`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1866 |
| **State** | CLOSED |
| **Author** | justinadkins (Justin Adkins) |
| **Created** | 2025-12-23 14:18:56.000 UTC (17 days ago) |
| **Updated** | 2026-01-09 17:06:07.000 UTC |
| **Closed** | 2026-01-08 17:46:13.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 8 |
| **Priority Score** | 12 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### What are you really trying to do?

We bumped our Temporal dependencies to `1.14.0` today from `1.13.1` and upon deploying started seeing workflows fail due to the following error:
```ts
CancelledFailure: Workflow cancelled
    at RootCancellationScope.cancel (/tmp/build_d69c691a/node_modules/.pnpm/@temporalio+workflow@1.14.0/node_modules/@temporalio/workflow/src/cancellation-scope.ts:264:16)
    at /tmp/build_d69c691a/node_modules/.pnpm/@temporalio+workflow@1.14.0/node_modules/@temporalio/workflow/src/workflow.ts:1171:36
```

Rolling back to `1.13.1` resolves the issue. We've reset the effected workflows to the signal event and they now run correctly. A race condition seems to have been introduced since we do observe some of our workflows succeeding with a signal and `condition`.

### Describe the bug
We started seeing phantom `CancelledFailure` errors surface in our workflows after updating to `1.14.0` that seem to be coming from `condition`. Nothing else about our code has changed. An example of the code where this appears to be failing:

<img width="1382" height="652" alt="Image" src="https://github.com/user-attachments/assets/a07f3f62-9b47-4438-825e-b81cec6d9930" />

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

Unable to reproduce locally so far. We have over 30 workflows in production that have experienced this.

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux
- Temporal Version: 1.14.0
- Are you using Docker or Kubernetes or building Temporal from source? From source


#### Comments (8)

<details>
<summary><strong>yosefrev</strong> commented on 2025-12-25 15:03:46.000 UTC</summary>

We‚Äôre experiencing this as well ‚ûï 

Reactions: üëç 1

</details>

<details>
<summary><strong>yardenli</strong> commented on 2025-12-29 13:37:21.000 UTC</summary>

We also started experiencing it as well with updates. 
We have an update with timeout, and experienced it in some workflows right after the update was accepted, and in some after the update reached it's timeout. 
It is important to mention that it happened in some workflows while other succeeded, and we couldn't find a clear pattern.

</details>

<details>
<summary><strong>chris-olszewski</strong> commented on 2025-12-29 16:08:55.000 UTC</summary>

For those affected by this:
 - Have you observed this with `1.13.2` or exclusively with `1.14.0`?
 - Do you have interceptors setup such as `@temporalio/interceptors-opentelemetry`?

</details>

<details>
<summary><strong>yardenli</strong> commented on 2025-12-30 08:38:33.000 UTC</summary>

@chris-olszewski we observed it exclusively with `1.14.0`. After going back to `1.13.2` we observed no issues.
We do have interceptor set up using `@temporalio/interceptors-opentelemetry` (we are using `OpenTelemetryWorkflowClientInterceptor`).

</details>

<details>
<summary><strong>justinadkins</strong> commented on 2025-12-30 14:59:27.000 UTC</summary>

@chris-olszewski We only observe this on `1.14.0`. We are not using an interceptor. However, for activities we have this custom wrapper used for creating spans with Datadog.

<img width="1338" height="1336" alt="Image" src="https://github.com/user-attachments/assets/71ef9bc9-4199-4fe8-8f85-d5470aae90b9" />

</details>

<details>
<summary><strong>Stereobit</strong> commented on 2026-01-02 10:15:43.000 UTC</summary>

Same issue here, no `interceptors`

</details>

<details>
<summary><strong>obrunodelgado</strong> commented on 2026-01-07 13:07:50.000 UTC</summary>

Hello guys,

I had the same problem and as others said, after downgrading to version `1.13.2` the application stopped receiving CancellationFailures.

</details>

<details>
<summary><strong>chris-olszewski</strong> commented on 2026-01-09 17:06:07.000 UTC</summary>

Hello all, the fix #1871 was released in 1.14.1, upgrading should fix the issue.

Reactions: ‚ù§Ô∏è 1

</details>


---

<a id="1749"></a>

### #1749: [Bug] Workflow task not found after SDK upgrade

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1749 |
| **State** | OPEN |
| **Author** | btravers (Benoit Travers) |
| **Created** | 2025-07-23 05:56:52.000 UTC (5 months ago) |
| **Updated** | 2025-09-08 16:23:59.000 UTC |
| **Upvotes** | 4 |
| **Comments** | 4 |
| **Priority Score** | 12 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 4 |

#### Description

### What are you really trying to do?

We are upgrading Temporal SDK from 1.11.8 to 1.12.1.

### Describe the bug

We have a long-running workflow. After upgrading the SDK, we are experiencing the following error: `"Workflow task not found."`
When we roll back to the previous version, the error disappears.


#### Comments (4)

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-25 15:17:40.000 UTC</summary>

Do you see any other error message besides the "Workflow task not found."? Any information that could help diagnose or reproduce what you are observing?

</details>

<details>
<summary><strong>shaz1v</strong> commented on 2025-07-31 07:57:15.000 UTC</summary>

We are seeing similar issues as-well with the new version, the workflows we tested the new SDK version with were short-running ones with large number activities, and the new SDK resulted in very slow processing and workflow being stuck for few good minutes before picking up the next activity, reverting resolved and everything instantly closed

The full log line we saw was

> 2025-07-31T07:46:46.723583Z  WARN temporal_sdk_core::worker::workflow: Task not found when completing error=status: NotFound, message: "Workflow task not found.", details: [8, 5, 18, 24, 87, 111, 114, 107, 102, 108, 111, 119, 32, 116, 97, 115, 107, 32, 110, 111, 116, 32, 102, 111, 117, 110, 100, 46, 26, 66, 10, 64, 116, 121, 112, 101, 46, 103, 111, 111, 103, 108, 101, 97, 112, 105, 115, 46, 99, 111, 109, 47, 116, 101, 109, 112, 111, 114, 97, 108, 46, 97, 112, 105, 46, 101, 114, 114, 111, 114, 100, 101, 116, 97, 105, 108, 115, 46, 118, 49, 46, 78, 111, 116, 70, 111, 117, 110, 100, 70, 97, 105, 108, 117, 114, 101], metadata: MetadataMap { headers: {"content-type": "application/grpc", "server": "temporal", "date": "Thu, 31 Jul 2025 07:46:46 GMT"} } run_id="01985f6f-b5ea-73a8-bb25-93b37c8db50d"

Reactions: üëç 1

</details>

<details>
<summary><strong>koliaVasyliv</strong> commented on 2025-08-28 09:01:42.000 UTC</summary>

hey, @mjameswh have you been able to look into this issue? it's blocking us to upgrade to newer versions.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-09-08 16:14:27.000 UTC</summary>

Hey! Sorry, I was out for a few days.

Unfortunately, I haven't been able to reproduce this error myself, and I don't observe any issue with any of our regular performance tests. It also seems like this is affecting only a very small subset of users, which suggests there might be some particular conditions required to reproduce this.

The log entry reported above isn't helping either; the "details" shown contain nothing more than the error status and message that are already printed out as plain text, just above. And in any case, the `Workflow task not found.` error is almost certainly just a secondary symptom; the real problem is that the Worker is not completing task within the allowed time (i.e. 10 seconds by default). The performance problem is what needs to be figured out.

Before anything else, I would recommend trying this again, with v1.13.0. That release notably [fixed a bug](https://github.com/temporalio/sdk-typescript/pull/1777) that could surface as an apparent memory leak in some Worker configurations. The increased memory pressure caused by this bug might have increased time spent in GC, thus considerably reducing the Worker's performance.

If this is not fixed by v1.13.0, could you please provide the following:
- Your `Runtime`'s options
- Your `Worker`'s options
- Graphs of your CPU usage and Memory usage
- When does that happen? Is that after the Worker's has been quietly running for a long time? Are you seeing many of those errors in short time, then no more for some time, and then again?
- Anything in your Worker's logs that seems potentially pertinent.

</details>


---

<a id="1233"></a>

### #1233: [Bug] `nyc-test-coverage` is excessively difficult to use correctly

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1233 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-09-06 19:19:07.000 UTC (2y 4m ago) |
| **Updated** | 2025-08-20 07:54:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 12 |
| **Priority Score** | 12 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | ‚ù§Ô∏è 3 |

#### Description

### Describe the bug

At the moment, using the `@temporalio/nyc-test-coverage` package to collect coverage data for Workflow tests is quite difficult and generally fragile. Though it works with appropriate setup (eg. we have a sample demonstrating that it works), some users are struggling at replicating that "winning combination" in their own project, despite considerable efforts and willingness to accept applicable constraints (eg. use Mocha or AVA, ts-node rather than ts-mocha or similar, pre-transpile TS code to pure-JS, hardcode workflow name in their test files to avoid importing wokrlfow.ts from tests, etc).

### What need to be done

This situation can be improved from two sides:
1. Improve the tool itself so that it is less fragile / more resilient to changes in its runtime environment
2. Provide clear instructions on how to use it

#### Comments (12)

<details>
<summary><strong>zijianzz</strong> commented on 2023-09-11 13:05:04.000 UTC</summary>

Here is our version of story about this issue

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->
Test `@temporalio/nyc-test-coverage` package to collect coverage data by using either Jest or Mocha

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Workflow example: 
<img width="662" alt="image" src="https://github.com/temporalio/sdk-typescript/assets/91457486/7f1b5db9-023d-4509-ba20-571ac34a0502">


Jest test code

```
import { TestWorkflowEnvironment } from '@temporalio/testing';
import { Worker } from '@temporalio/worker';
import { WorkflowCoverage } from '@temporalio/nyc-test-coverage';
import * as activities from '../../../activities';
import { exampleWorkflow } from '../test';

jest.mock('../../../activities');
const mockedActivties = jest.mocked(activities);
async function setupTestEnv(timeSkipping: boolean = true): Promise<TestWorkflowEnvironment> {
  return timeSkipping ? TestWorkflowEnvironment.createTimeSkipping() : TestWorkflowEnvironment.createLocal();
}

async function setupTestWorker(env: TestWorkflowEnvironment, workflowCoverage: WorkflowCoverage) {
  return Worker.create(
    workflowCoverage.augmentWorkerOptions({
      connection: env.nativeConnection,
      workflowsPath: require.resolve('../../test'),
      activities,
      taskQueue: 'test',
    }),
  );
}

describe('create restaurant', () => {
  let testEnv: TestWorkflowEnvironment;
  let worker: Worker;
  const workflowCoverage = new WorkflowCoverage();

  beforeAll(async () => {
    testEnv = await setupTestEnv();
  });

  afterAll(async () => {
    await testEnv?.teardown();
    jest.setTimeout(5000);
    jest.clearAllMocks();
    jest.resetAllMocks();
    workflowCoverage.mergeIntoGlobalCoverage();
  });

  beforeEach(async () => {
    worker = await setupTestWorker(testEnv, workflowCoverage);
  });

  describe('Successful case', () => {
    it('should return true', async () => {
      mockedActivties.testActivity.mockResolvedValueOnce(undefined);
      const result = await worker.runUntil(async () => {
        return testEnv.client.workflow.execute(exampleWorkflow, {
          workflowId: 'a-fake-workflow-id',
          taskQueue: 'test',
          args: [
            {
              ok: true,
            },
          ],
        });
      });

      expect(result).toStrictEqual(true);
    });
  });
});

```

Mocha test code

```
import { Worker } from '@temporalio/worker';
import { TestWorkflowEnvironment } from '@temporalio/testing';
import * as assert from 'assert';
import { v4 as uuid } from 'uuid';
import { after, before, describe, it } from 'mocha';
import { WorkflowCoverage } from '@temporalio/nyc-test-coverage';
import { ActivityFunction } from '@temporalio/common';
import * as activities from '../../../activities';
import { exampleWorkflow } from '../test';

const workflowCoverage = new WorkflowCoverage();
const mockedActivities: Record<string, ActivityFunction> = {};
const activitiesNames = Object.keys(activities);
for (const name of activitiesNames) {
  mockedActivities[name] = async () => undefined;
}

describe('createRestaurant workflow', async function () {
  let worker: Worker;
  let env: TestWorkflowEnvironment;

  this.slow(10_000);
  this.timeout(20_000);
  before(async function () {
    // Filter INFO log messages for clearer test output
    env = await TestWorkflowEnvironment.createTimeSkipping();
  });

  beforeEach(async () => {
    worker = await Worker.create(
      workflowCoverage.augmentWorkerOptions({
        connection: env.nativeConnection,
        taskQueue: 'test',
        workflowsPath: require.resolve('../../'),
        activities: {
          ...mockedActivities,
        },
      }),
    );
  });

  after(async () => {
    await env?.teardown();
  });

  after(() => {
    workflowCoverage.mergeIntoGlobalCoverage();
  });

  it('sucessfully return true if ok is true', async () => {
    const result = await worker.runUntil(async () => {
      return env.client.workflow.execute(exampleWorkflow, {
        taskQueue: 'test',
        workflowId: uuid(),
        args: [
          {
            ok: true,
          },
        ],
      });
    });
    assert.deepStrictEqual(result, true);
  });

  it('sucessfully return true if ok is false', async () => {
    const result = await worker.runUntil(async () => {
      return env.client.workflow.execute(exampleWorkflow, {
        taskQueue: 'test',
        workflowId: uuid(),
        args: [
          {
            ok: false,
          },
        ],
      });
    });
    assert.deepStrictEqual(result, true);
  });
});

```

By using jest with following jest config + `@temporalio/nyc-test-coverage`, sdk will send us runtime js error depending on version of sdk we used
```
module.exports = {
  testEnvironment: 'node',
  forceExit: true,
  collectCoverage: true,
  coverageDirectory: 'coverage/jest',
  coverageProvider: 'babel',
  roots: ['<rootDir>/src'],
  preset: 'ts-jest',
  moduleNameMapper: {
    '^@lafourchette/tfm-restaurant-composite-types/dist/(.*)$': '<rootDir>/packages/types/src/$1',
  },
  testMatch: ['**/__tests__/**/*.+(ts|tsx|js)', '**/?(*.)+(spec|test).+(ts|tsx|js)', '!**/__tests__/**/*.mocha.test.+(ts|tsx|js)'],
};

```


- sdk version 1.8.4 or 1.7.4 + jest => runtime js error
```
Error: Invalid file coverage object, missing keys, found:data
    at assertValidObject (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/file-coverage.js:38:15)
    at new FileCoverage (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/file-coverage.js:119:9)
    at maybeConstruct (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/coverage-map.js:15:12)
    at /Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/coverage-map.js:25:19
    at Array.forEach (<anonymous>)
    at loadMap (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/coverage-map.js:24:28)
    at new CoverageMap (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/coverage-map.js:42:25)
    at maybeConstruct (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/coverage-map.js:15:12)
    at CoverageMap.merge (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/istanbul-lib-coverage/lib/coverage-map.js:53:23)
    at CoverageReporter.onTestResult (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/@jest/reporters/build/CoverageReporter.js:167:25)
    at ReporterDispatcher.onTestFileResult (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/@jest/core/build/ReporterDispatcher.js:32:24)
    at onResult (/Users/zzuo/Git/tfm-restaurant-composite/node_modules/@jest/core/build/TestScheduler.js:154:7)
```

By using mocha and launching following command + `@temporalio/nyc-test-coverage`, sdk will send us either inaccurate coverage data, timeout error depending on version of sdk we used

`nyc --reporter=lcov --reporter=text ts-mocha src/**/*.mocha.test.ts`


- 1.7.4 => timeout error
<img width="1350" alt="image" src="https://github.com/temporalio/sdk-typescript/assets/91457486/3cbabb88-fdda-43f4-932d-fe954dd0daa9">

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

Mac os 13.5
SDK 1.7.4 or 1.8.4

### Additional context

<!-- Add any other context about the problem here. -->


</details>

<details>
<summary><strong>jamespsterling</strong> commented on 2023-12-01 17:14:20.000 UTC</summary>

I had the same `Error: Invalid file coverage object, missing keys, found:data` error and fixed it by patching `istanbul-lib-coverage`.

```patch
diff --git a/node_modules/istanbul-lib-coverage/lib/file-coverage.js b/node_modules/istanbul-lib-coverage/lib/file-coverage.js
index 4ed4c09..08e272c 100644
--- a/node_modules/istanbul-lib-coverage/lib/file-coverage.js
+++ b/node_modules/istanbul-lib-coverage/lib/file-coverage.js
@@ -206,6 +206,8 @@ class FileCoverage {
             this.data = emptyCoverage(pathOrObj, reportLogic);
         } else if (pathOrObj instanceof FileCoverage) {
             this.data = pathOrObj.data;
+        } else if (typeof pathOrObj === 'object' && pathOrObj.data) {
+            this.data = pathOrObj.data;
         } else if (typeof pathOrObj === 'object') {
             this.data = pathOrObj;
         } else {
```

The underlying issue is that `FileCoverage` is receiving an instance of `CoverageMap` when it's expecting instance of `FileCoverage` in the constructor branching assignment to `this.data`.

https://github.com/istanbuljs/istanbuljs/blob/5584b50305a6a17d3573aea25c84e254d4a08b65/packages/istanbul-lib-coverage/lib/file-coverage.js#L205-L213

Reactions: üëç 3

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-01 21:53:31.000 UTC</summary>

@jamespsterling Thanks for sharing your findings. Yes, I believe there's been a recent regression (possibly on our side) that made our `nyc-test-coverage` plugin fails in cases where it was previously working. What you are pointing at should help figure out where that regression lies.

</details>

<details>
<summary><strong>ilijaNL</strong> commented on 2024-05-01 12:37:52.000 UTC</summary>

Any update on this?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-01 15:36:04.000 UTC</summary>

> Any update on this?

Not yet, sorry.

</details>

<details>
<summary><strong>ilijaNL</strong> commented on 2024-05-01 18:41:25.000 UTC</summary>

This area needs some improvement. We use a monorepo setup with jest (ts-jest as transformer). We have high code coverage requirement thus we using `collectCoverageFrom`. Somehow when we use the nyc-test-coverage package, the coverage is not merged correctly and we get really weird code coverage report. I assume this is due that the final sourcemaps are different between what ts-jest transforms and webpack (used by temporal sdk). 
This is kind of deal breaker atm.

</details>

<details>
<summary><strong>surjyams</strong> commented on 2024-05-29 15:51:30.000 UTC</summary>

Is there any update on this? We are running into the same issue with @temporalio/nyc-test-coverage@1.10.1

</details>

<details>
<summary><strong>gaurav1999</strong> commented on 2024-07-04 14:39:07.000 UTC</summary>

@mjameswh Facing same issue

```
‚óè Test suite failed to run

    Invalid file coverage object, missing keys, found:data

      at assertValidObject (../node_modules/istanbul-lib-coverage/lib/file-coverage.js:38:15)
      at new FileCoverage (../node_modules/istanbul-lib-coverage/lib/file-coverage.js:214:9)
      at maybeConstruct (../node_modules/istanbul-lib-coverage/lib/coverage-map.js:15:12)
      at ../node_modules/istanbul-lib-coverage/lib/coverage-map.js:25:19
          at Array.forEach (<anonymous>)
      at loadMap (../node_modules/istanbul-lib-coverage/lib/coverage-map.js:24:28)
      at new CoverageMap (../node_modules/istanbul-lib-coverage/lib/coverage-map.js:42:25)
      at maybeConstruct (../node_modules/istanbul-lib-coverage/lib/coverage-map.js:15:12)
```

```
 const worker = await Worker.create(workflowCoverage.augmentWorkerOptions({
      connection: nativeConnection,
      taskQueue,
      workflowsPath: require.resolve('./runops-success.test.ts'),
      activities
    }));

```

</details>

<details>
<summary><strong>0xBigBoss</strong> commented on 2024-07-06 02:56:39.000 UTC</summary>

> I had the same `Error: Invalid file coverage object, missing keys, found:data` error and fixed it by patching `istanbul-lib-coverage`.
> 
> ```diff
> diff --git a/node_modules/istanbul-lib-coverage/lib/file-coverage.js b/node_modules/istanbul-lib-coverage/lib/file-coverage.js
> index 4ed4c09..08e272c 100644
> --- a/node_modules/istanbul-lib-coverage/lib/file-coverage.js
> +++ b/node_modules/istanbul-lib-coverage/lib/file-coverage.js
> @@ -206,6 +206,8 @@ class FileCoverage {
>              this.data = emptyCoverage(pathOrObj, reportLogic);
>          } else if (pathOrObj instanceof FileCoverage) {
>              this.data = pathOrObj.data;
> +        } else if (typeof pathOrObj === 'object' && pathOrObj.data) {
> +            this.data = pathOrObj.data;
>          } else if (typeof pathOrObj === 'object') {
>              this.data = pathOrObj;
>          } else {
> ```
> 
> The underlying issue is that `FileCoverage` is receiving an instance of `CoverageMap` when it's expecting instance of `FileCoverage` in the constructor branching assignment to `this.data`.
> 
> https://github.com/istanbuljs/istanbuljs/blob/5584b50305a6a17d3573aea25c84e254d4a08b65/packages/istanbul-lib-coverage/lib/file-coverage.js#L205-L213

[This patch is working for me.](https://github.com/temporalio/sdk-typescript/issues/1233#issuecomment-1836484772) 

Side note, this seems it's also being tracked in the `nyc` github. https://github.com/istanbuljs/nyc/issues/1226


</details>

<details>
<summary><strong>jgnieuwhof</strong> commented on 2024-07-25 00:01:35.000 UTC</summary>

@ilijaNL 

> ... Somehow when we use the nyc-test-coverage package, the coverage is not merged correctly and we get really weird code coverage report. I assume this is due that the final sourcemaps are different between what ts-jest transforms and webpack (used by temporal sdk). This is kind of deal breaker atm.

I found the same thing - I was getting coverage but the lines didn't make sense, and were actually inconsistent depending on which test files I included in the test run. The issue does appear to be with how the `mergeIntoGlobalCoverage` function performs its merge, as coverage is correct when bypassing the merge and just writing the coverage data to `.nyc_output`.

Here's the workaround that solved the issue for me:

```typescript

// instead of this
afterAll(async () => {
  workflowCoverage.mergeIntoGlobalCoverage();
});

// do this
import { createCoverageMap } from "istanbul-lib-coverage";

afterAll(async () => {
  const coverageMap = createCoverageMap();
  for (const data of workflowCoverage.coverageMapsData) {
    coverageMap.merge(data);
  }
  await fs.writeFile(
    path.join(".nyc_output", `${uuid4()}.json`),
    JSON.stringify(coverageMap)
  );
});
```


</details>

<details>
<summary><strong>ilijaNL</strong> commented on 2024-07-26 04:41:13.000 UTC</summary>

> @ilijaNL
> 
> > ... Somehow when we use the nyc-test-coverage package, the coverage is not merged correctly and we get really weird code coverage report. I assume this is due that the final sourcemaps are different between what ts-jest transforms and webpack (used by temporal sdk). This is kind of deal breaker atm.
> 
> I found the same thing - I was getting coverage but the lines didn't make sense, and were actually inconsistent depending on which test files I included in the test run. The issue does appear to be with how the `mergeIntoGlobalCoverage` function performs its merge, as coverage is correct when bypassing the merge and just writing the coverage data to `.nyc_output`.
> 
> Here's the workaround that solved the issue for me:
> 
> ```ts
> // instead of this
> afterAll(async () => {
>   workflowCoverage.mergeIntoGlobalCoverage();
> });
> 
> // do this
> import { createCoverageMap } from "istanbul-lib-coverage";
> 
> afterAll(async () => {
>   const coverageMap = createCoverageMap();
>   for (const data of workflowCoverage.coverageMapsData) {
>     coverageMap.merge(data);
>   }
>   await fs.writeFile(
>     path.join(".nyc_output", `${uuid4()}.json`),
>     JSON.stringify(coverageMap)
>   );
> });
> ```

This is okaay if your whole describe block only include workflow tests, if it includes some non workflow test, jest (global.__coverage__) will not include those in the coverage. 

</details>

<details>
<summary><strong>diephil</strong> commented on 2025-08-20 07:54:16.000 UTC</summary>

Hi there, is there any progress on this topic? We're using jest with @temporalio/nyc-test-coverage@1.11.7 and we are facing the `Error: Invalid file coverage object, missing keys, found:data` issue as well.

</details>


---

<a id="1160"></a>

### #1160: [Typescript] Workflow update support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1160 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-07-05 16:55:47.000 UTC (2y 6m ago) |
| **Updated** | 2023-12-05 19:01:34.000 UTC |
| **Closed** | 2023-12-05 19:01:34.000 UTC |
| **Upvotes** | 6 |
| **Comments** | 0 |
| **Priority Score** | 12 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 6 üéâ 2 |

#### Description

*No description provided.*


---

<a id="755"></a>

### #755: [Bug] with yarn pnp, there are issues running workflow tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/755 |
| **State** | CLOSED |
| **Author** | albertyfwu (Albert) |
| **Created** | 2022-07-13 23:15:01.000 UTC (3y 6m ago) |
| **Updated** | 2023-03-09 00:21:50.000 UTC |
| **Closed** | 2023-03-09 00:21:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 12 |
| **Priority Score** | 12 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to write workflow tests as described at https://docs.temporal.io/typescript/testing/#testing-workflows

### Describe the bug

I actually ran into a similar issue while writing temporal tests:

The script in my package.json looks like this:
```
"scripts": {
    "test": "NODE_ENV=test jest"
  },
```
I am running `yarn workspace <workspace> test`.
At first, I get this error: `You need to run with a version of node that supports ES Modules in the VM API. See https://jestjs.io/docs/ecmascript-modules`


Then, if I run `NODE_OPTIONS=--experimental-vm-modules yarn workspace <workspace> test` I get this error:
```
Cannot find module 'pnpapi' from '/Users/albertwu/workspace/project/.yarn/cache/enhanced-resolve-npm-5.10.0-7941304306-0bb9830704.zip/node_modules/enhanced-resolve/lib'

    Require stack:
      /Users/albertwu/workspace/project/.yarn/cache/enhanced-resolve-npm-5.10.0-7941304306-0bb9830704.zip/node_modules/enhanced-resolve/lib/index.js
      /Users/albertwu/workspace/project/.yarn/__virtual__/webpack-virtual-4d546bab61/0/cache/webpack-npm-5.73.0-fc8c985a74-aa434a241b.zip/node_modules/webpack/lib/CacheFacade.js
      /Users/albertwu/workspace/project/.yarn/__virtual__/webpack-virtual-4d546bab61/0/cache/webpack-npm-5.73.0-fc8c985a74-aa434a241b.zip/node_modules/webpack/lib/Compiler.js
      /Users/albertwu/workspace/project/.yarn/__virtual__/webpack-virtual-4d546bab61/0/cache/webpack-npm-5.73.0-fc8c985a74-aa434a241b.zip/node_modules/webpack/lib/webpack.js
      /Users/albertwu/workspace/project/.yarn/__virtual__/webpack-virtual-4d546bab61/0/cache/webpack-npm-5.73.0-fc8c985a74-aa434a241b.zip/node_modules/webpack/lib/index.js
      /Users/albertwu/workspace/project/.yarn/cache/@temporalio-worker-npm-1.0.0-rc.1-2998f0d7a7-147819cf17.zip/node_modules/@temporalio/worker/lib/workflow/bundler.js
      /Users/albertwu/workspace/project/.yarn/cache/@temporalio-worker-npm-1.0.0-rc.1-2998f0d7a7-147819cf17.zip/node_modules/@temporalio/worker/lib/worker.js
      /Users/albertwu/workspace/project/.yarn/cache/@temporalio-worker-npm-1.0.0-rc.1-2998f0d7a7-147819cf17.zip/node_modules/@temporalio/worker/lib/index.js
      /Users/albertwu/workspace/project/.yarn/unplugged/@temporalio-testing-npm-1.0.0-rc.1-8641517f72/node_modules/@temporalio/testing/lib/index.js
```

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (12)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-13 23:19:11.000 UTC</summary>

Thanks for reporting.
I don't know much about yarn pnp, we'd have to look into this.

</details>

<details>
<summary><strong>albertyfwu</strong> commented on 2022-07-13 23:41:44.000 UTC</summary>

maybe related to this? https://github.com/webpack/enhanced-resolve/pull/349

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 00:10:32.000 UTC</summary>

Might be, jest is a pretty complicated JS runtime.

Can you verify that this doesn't happen when using a simpler test runner?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-14 00:45:12.000 UTC</summary>

> maybe related to this? https://github.com/webpack/enhanced-resolve/pull/349

Seems like it, in which case it'd be fixed when this is merged: https://github.com/webpack/enhanced-resolve/pull/301

In the meantime, some workarounds are using mocha or not using pnp. Here's a mocha sample: https://github.com/temporalio/samples-typescript/blob/bd2e6d73dcc5de5ff41215a74745ab363ee7e52a/activities-examples/package.json#L11

</details>

<details>
<summary><strong>albertyfwu</strong> commented on 2022-07-14 00:53:58.000 UTC</summary>

Thanks.

Can't I also just write unit tests directly by mocking activities? Is the main benefit of the test runner the ability to do time skipping?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 01:12:43.000 UTC</summary>

I think you mean the test framework `@temporalio/testing` the main benefit of it is auto time skipping, yes.
We've also wrapped up starting the server and all of the utilities in the test environment which provides pure convenience.
The issue you're experiencing isn't related to that though.

</details>

<details>
<summary><strong>albertyfwu</strong> commented on 2022-07-14 01:23:58.000 UTC</summary>

If I didn't use `@temporalio/testing` and just directly executed the workflow function (without going through worker), wouldn't that bypass the webpack issues?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 01:37:24.000 UTC</summary>

This isn't currently possible, workflows can only be run in the isolated runtime at the moment since they rely on global state.
I have some plans to loosen the runtime requirement eventually for unit testing purposes but so far it hasn't been high priority for us and you're the first one to request this "feature".

Reactions: üëç 1

</details>

<details>
<summary><strong>esuh-descript</strong> commented on 2022-07-18 17:47:35.000 UTC</summary>

We are running into this issue (the original error about ESM modules) without `yarn pnp` also (using just `yarn` and `jest`). The only fixes we've found are to apply the patches:

```diff
diff --git a/node_modules/@temporalio/testing/lib/index.js b/node_modules/@temporalio/testing/lib/index.js
index 863bf4f..24b4831 100644
--- a/node_modules/@temporalio/testing/lib/index.js
+++ b/node_modules/@temporalio/testing/lib/index.js
@@ -96,7 +96,7 @@ function addDefaults({ testServer, logger, }) {
 }
 // TS transforms `import` statements into `require`s, this is a workaround until
 // tsconfig module nodenext is stable.
-const _importDynamic = new Function('modulePath', 'return import(modulePath)');
+const _importDynamic = require;
 /**
  * An execution environment for running Workflow integration tests.
  *

diff --git a/node_modules/get-port/index.js b/node_modules/get-port/index.js
index 06e993a..07bab92 100644
--- a/node_modules/get-port/index.js
+++ b/node_modules/get-port/index.js
@@ -1,5 +1,5 @@
-import net from 'node:net';
-import os from 'node:os';
+const net = require('net');
+const os = require('os');
 
 class Locked extends Error {
 	constructor(port) {
@@ -79,7 +79,7 @@ const portCheckSequence = function * (ports) {
 	yield 0; // Fall back to 0 if anything else failed
 };
 
-export default async function getPorts(options) {
+module.exports.default = async function getPorts(options) {
 	let ports;
 	let exclude = new Set();
 
@@ -151,7 +151,7 @@ export default async function getPorts(options) {
 	throw new Error('No available ports found');
 }
 
-export function portNumbers(from, to) {
+module.exports.portNumbers = function portNumbers(from, to) {
 	if (!Number.isInteger(from) || !Number.isInteger(to)) {
 		throw new TypeError('`from` and `to` must be integer numbers');
 	}
```

For now, we are unblocked by using `patch-package` to fix the issue, but it would be great to not have to patch the code ourselves. Perhaps given the small amount of code in `get-port`, it might be worthwhile to vendor and patch the upstream code in the `@temporalio/testing` package itself?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-18 18:01:02.000 UTC</summary>

@esuh-descript Did you try `NODE_OPTIONS=--experimental-vm-modules yarn test`? 

Other notes on using Jest are:

- Needs to be `>= 27.0.0`
- Use [`testEnvironment: 'node'`](https://jestjs.io/docs/configuration#testenvironment-string). `testEnvironment: 'jsdom'` is not supported.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-18 20:38:35.000 UTC</summary>

I'm considering vendoring [`get-port`](https://www.npmjs.com/package/get-port) and porting to commonjs, unfortunately that package moved from commonjs to ESM which breaks a bunch of dependencies.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-09 00:21:50.000 UTC</summary>

Closing, we don't depend on `get-port` anymore.

</details>


---

<a id="327"></a>

### #327: [Feature Request] Add statsd support to Typescript SDK

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/327 |
| **State** | CLOSED |
| **Author** | mengyazhu96 (jessica) |
| **Created** | 2021-10-22 03:34:14.000 UTC (4y 2m ago) |
| **Updated** | 2022-01-21 18:48:59.000 UTC |
| **Closed** | 2021-11-02 02:23:40.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 10 |
| **Priority Score** | 12 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.
Per the [production deployment docs](https://docs.temporal.io/docs/server/production-deployment#scaling-and-metrics) we've set up metrics using statsd since it's easy to pipe to Datadog for our Temporal server deployment. However, as specified the most important metric to track is ScheduleToStart which is an SDK metric.

### Describe the solution you'd like
It would be great to be able to specify [statsd configuration similar to the server config](https://docs.temporal.io/docs/server/configuration/#metrics) in the Typescript SDK on Worker creation to be able to send ScheduleToStart metrics.

### Additional context
https://temporalio.slack.com/archives/C01DKSMU94L/p1634848505016400


#### Comments (10)

<details>
<summary><strong>mengyazhu96</strong> commented on 2021-10-22 03:36:50.000 UTC</summary>

On a related note, I think the production deployment docs should explicitly call out that `ScheduleToStart` is an SDK-issued metric, where that metrics piping is set up independently of the server -- maybe this already exist in the docs for the other SDKs. I'm happy to file an issue in the server repo if helpful, or open a PR with suggested documentation updates.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-26 03:01:32.000 UTC</summary>

@Sushisource can you please look into this?
How easy would it be to support statsd metrics exporter by default in core?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-30 02:30:51.000 UTC</summary>

So the way to do this is to just to use the OTel collector exporter and configure the collector to route to statsd. Or, in this case since the real end goal is datadog, the datadog exporter. https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/datadogexporter

I'm really hesitant to add more kinds of exporters into the code directly since this is exactly the territory the collector solves. @mengyazhu96 Let me know if you have any trouble with this approach or it's unclear how to get it going.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-02 02:23:40.000 UTC</summary>

Closing this issue @mengyazhu96.
We'll add documentation to explain how to set this up.

</details>

<details>
<summary><strong>rupalivohra</strong> commented on 2022-01-20 19:26:44.000 UTC</summary>

There's overhead to setting up an OTel collector. It'd be great if the SDK supported routing to DataDog more directly.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-01-21 03:56:18.000 UTC</summary>

I see that there's a Rust DataDog exporter [crate](https://crates.io/crates/opentelemetry-datadog) but I'm not convinced we should embed it in Core.
@Sushisource can you think of a way to optionally include it?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-01-21 17:29:45.000 UTC</summary>

@bergundy These are the options:

1. Embed it, always linked in. Optionally enabled. Needs more config options, will increase bin size, and sets precedent that we might include every otel exporter directly in core. Also doesn't work with combining data from Lang SDKs, as now they also need to direct-export to datadog.
2. Same as above except force users to recompile core so it isn't always linked in. This obviously is no fun.
3. Same as above except dynamically link in somehow. Better than forcing recompile but complex.

I can definitely sympathize with the overhead of deploying an OTel Collector, but it adds a lot of flexibility for users once they do. They can centralize their config, easily export to multiple destinations and collect from multiple sources, etc.

The big problem here is that we emit metrics from both Core and Lang. Every direct export we support it needs to exist in Core and all langs on top of core and that pretty quickly adds up to supporting a _lot_ of different exporters. That, or we figure out piping metrics into one side so it can always emit them for both halves, but as you probably remember that was a sisyphean undertaking when I first went down that path.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-01-21 17:43:44.000 UTC</summary>

It should be noted we don't support statsd natively in Go/Java SDK. Rather they use the abstract "Tally" libs from Uber (and in Go, it's not even compiled in by default). There just so happen to be connectors for that lib to statsd.

Is it possible to provide metrics from core to lang upon request? I think the pull model works w/ prom, otel, etc but I'd have to confirm. Then lang can choose what to do with them, including statsd export. There's an added benefit of having all metrics in one place. The structures for our metrics (counter, gauge, time-based all w/ optional labels) shouldn't be that difficult to abstract if you didn't want the otel-specific structures going over the bridge.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-01-21 18:06:48.000 UTC</summary>

@cretz that's what we initially tried to do for both metrics and traces but from what @Sushisource reports it ended up being a lot of work and didn't have good support from otel.

I still think exporting to lang is more flexible because it allows users to use their library of choice to export telemetry.

Reactions: üëç 1

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-01-21 18:48:59.000 UTC</summary>

It was an absolute nightmare to do that kind of exporting. We could make our own metrics abstractions, but that's a business I don't particularly want to be in. There's quite a bit of complexity in getting that right. I think it's definitely a direction we could eventually end up going, but priorities wise I don't think it's the best use of time at the moment.

Reactions: üëç 1

</details>


---

<a id="312"></a>

### #312: Expose health check on WorkflowClient

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/312 |
| **State** | CLOSED |
| **Author** | Spikhalskiy (Dmitry Spikhalsky) |
| **Created** | 2021-10-19 16:57:33.000 UTC (4y 2m ago) |
| **Updated** | 2023-07-10 08:38:27.000 UTC |
| **Closed** | 2022-10-11 23:20:01.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 6 |
| **Priority Score** | 12 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 |

#### Description

Temporal SDK should expose a method like WorkflowServiceStubs#healthCheck or WorkflowServiceStubs#isHealthy that allows users to check if the WorkflowClient/WorkflowServiceStubs underlying channel / connection to Temporal server is healthy.
There were quite a bit of user requests for such a method from users for all SDKs.
Having this method on Stubs is preferable over WorkflowClient, because it's the lowest level abstraction on top of the channel and WorkflowClient can just fall back on the WorkflowServiceStubs method. But if the language doesn't have a wrapper for stubs (like Java does), this method may be on WorkflowClient.

Issues for other SDKs:
https://github.com/temporalio/sdk-java/issues/828
https://github.com/temporalio/sdk-go/issues/595

#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-03 17:08:33.000 UTC</summary>

We probably won't expose this on `WorkflowClient`, there's a plan to add a "meta" `Client` that will contain the more specific clients.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:20:01.000 UTC</summary>

This is now exposed via the raw gRPC client.

</details>

<details>
<summary><strong>clintonb</strong> commented on 2023-06-11 23:32:20.000 UTC</summary>

@bergundy can you provide an example of how to use this, please?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-12 04:00:16.000 UTC</summary>

See https://typescript.temporal.io/api/classes/client.Connection#healthservice.
If you can‚Äôt make sense out of that I can post the example

</details>

<details>
<summary><strong>AlexHayton</strong> commented on 2023-07-09 20:44:47.000 UTC</summary>

I have tried to implement it based on the docs but getting stuck at `grpc.health.v1.Health.create()` - @bergundy  if it's not too much trouble, please could you post your example? 

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-07-10 08:38:27.000 UTC</summary>

```ts
import { Connection } from '@temporalio/client';
import { grpc } from '@temporalio/proto';

const connection = await Connection.connect();
const health = await connection.healthService.check({});
console.log(grpc.health.v1.HealthCheckResponse['ServingStatus'][health.status]);
```

Reactions: ‚ù§Ô∏è 2

</details>


---

<a id="258"></a>

### #258: [Feature Request] Support single-file workflowsPath

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/258 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-21 18:54:57.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 14:31:54.000 UTC |
| **Closed** | 2021-10-07 14:31:54.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 10 |
| **Priority Score** | 12 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

```
await Worker.create({
    workflowsPath: path.join(__dirname, 'workflows'),
```

doesn't work for `./workflows.js`‚Äîit only works for a `./workflows/` directory.

### Describe the solution you'd like

The ability to have this file structure: https://github.com/lorensr/samples-node/blob/1d6ff776fb4d1376d62045621a7179d73b890eb1/hello-world/src/worker.ts#L18

### Additional context

This would fix https://github.com/temporalio/samples-node/issues/13


#### Comments (10)

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-21 19:26:57.000 UTC</summary>

The goal of this RFE is for the isolate to implement [Node-style import resolution](https://www.typescriptlang.org/docs/handbook/module-resolution.html#node) for `workflows`?

Because ts-loader does this, most TypeScript programmers will expect this and will trip over it if it doesn't work.

There may be some leads in the following discussion:

https://github.com/webpack/webpack/issues/13252

For example, [this comment](https://github.com/webpack/webpack/issues/13252#issuecomment-828587290)

I think the "fix" would need to be added to this code:

https://github.com/temporalio/sdk-node/blob/52f67499860526cd180912797dc3e6d7fa4fc78f/packages/worker/src/isolate-builder.ts#L104

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-23 08:46:31.000 UTC</summary>

I think it's easy to just look if `workflows/index.js` exists and if it doesn't try `workflows.js` probably somewhere in the isolate builder or the worker.

Reactions: üëç 1

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-25 04:06:14.000 UTC</summary>

Started looking into this here: https://github.com/lorensr/sdk-node/tree/single-file

with these changes: https://github.com/lorensr/sdk-node/commit/270793cb620fa81036173585ac319e5a100800b1

```
workflowsPath: `${__dirname}/workflow-file.js`
```

When I comment out these 3 lines:

https://github.com/lorensr/sdk-node/commit/270793cb620fa81036173585ac319e5a100800b1#diff-6ca636db1dc7530aefb4f6e9c60d7d81b77e2c128068ff41f5940bb47fe67fc5R115-R117

The test doesn't succeed, but it stops erroring:

![image](https://user-images.githubusercontent.com/251288/134757195-bf806136-4a84-4f9a-afae-04ff5072327f.png)

With those lines uncommented, webpack build error is:

![image](https://user-images.githubusercontent.com/251288/134757280-a6f34f69-c237-42e7-be28-43a5b366632b.png)

I think most telling is the line:

`/Users/me/gh/sdk-node/packages/test/lib/workflow-file.js is not a directory`, which I'm guessing is coming from:

`return require(${JSON.stringify(this.workflowsPath)} + '${path.sep}' + path)[name];`



</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-25 08:49:39.000 UTC</summary>

> I think it's easy to just look if `workflows/index.js` exists and if it doesn't try `workflows.js` probably somewhere in the isolate builder or the worker.

Checking that `workflows` path exists in worker:

https://github.com/temporalio/sdk-node/blob/e08ffada21ea2fe10071e1cd36683ee4573185f7/packages/worker/src/worker.ts#L279

const workflowsDir = resolve(workDir, 'workflows');
return fs.existsSync(workflowsDir) ? workflowsDir : resolve(workDir, 'workflows.js');

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-25 22:55:44.000 UTC</summary>

I realized I'm conflating two different issues:
* Support for single-file workflows, e.g., `workflows.js` <= THIS ISSUE
* Support defaulting `workflowsPath` to single-file `workflows.js` <= #267 

A fix for THIS issue won't necessarily fix the workflowsPath default issue, but is probably a prerequisite.

@lorensr in the webpack error (_is not a directory_) reported above, note the `in '/src'` in the error message. I think this means that `require` is being called with path: '/src'

DRAFT PR to support workflows.js as workflowsPath default: https://github.com/temporalio/sdk-node/pull/267

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-27 06:42:53.000 UTC</summary>

@joebowbeer commented on your draft PR with directions on how to properly support the different cases.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-27 15:39:24.000 UTC</summary>

@bergundy more questions for you in #267 

As I wrote there,

> I think the first step is to get the single-file loading working (#258) in isolate-builder, and then adjust the default workflowsPath in worker if needed to support custom loaders (incl. working around deficiencies in the loaders).

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-29 10:19:23.000 UTC</summary>

I'm moving this discussion here from #267 - I think #267 is too simplistic, and this issue needs to be fixed first.

Note that the list of extensions is dependent on the loader, e.g., ts-loader or babel-loader, either of which might be used with TypeScript.

The webpack module resolver (see below) or any custom loader should both be able to work with an absolute or relative path that resolves to a folder or file, e.g. "../workflows".

If it resolves to a folder, `package.json` may select the file that is loaded. When specified as a filename, it typically does not include an extension, and when it does the custom loader may replace it. See resolve.extensions.

https://webpack.js.org/concepts/module-resolution/#module-paths

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 15:10:12.000 UTC</summary>

@joebowbeer I looked into it a bit.
It seems like webpack works with no extension if I comment out this line:
https://github.com/temporalio/sdk-node/blob/9531fe25a7d3263285e8c6f98689db6d060cd59d/packages/worker/src/isolate-builder.ts#L111

So all that's left is to support workflow interceptor imports, I'll think about it some more.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-04 11:10:53.000 UTC</summary>

Looks like the best way to solve this is to make interceptor module locations flexible too:

```ts
await Worker.create({
  workflowsPath: require.resolve('./workflows'),
  interceptorModules: [require.resolve('./workflows/interceptors')],
});
```

</details>


---

<a id="1681"></a>

### #1681: [Bug] TLS server name override not respected

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1681 |
| **State** | CLOSED |
| **Author** | dan8f (dani) |
| **Created** | 2025-04-17 20:01:31.000 UTC (8 months ago) |
| **Updated** | 2025-05-28 17:09:31.000 UTC |
| **Closed** | 2025-05-28 17:02:26.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 7 |
| **Priority Score** | 11 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### What are you really trying to do?

Setting a TLS server name override in client connection connect

### Describe the bug

When setting a server name override in client connection, the TLS server name is mishandled by `grpc-js` library and ends up overridden with the address provided

### Minimal Reproduction

```
  import { Connection, Client } from '@temporalio/client';

  const connection = await Connection.connect(
    {
      address: '<address>:7233',

      tls: {
        serverNameOverride: '<override>',
      },

      apiKey,

      metadata
    })

```

### Environment/Versions

TS SDK 1.11.7

### Additional context

[grpc-js servername override](https://github.com/grpc/grpc-node/blob/c2b914d4fd085679f7b48fae5356c5e7702b4a34/packages/grpc-js/src/channel-credentials.ts#L257)


#### Comments (7)

<details>
<summary><strong>kazaz-lumida</strong> commented on 2025-04-20 05:32:16.000 UTC</summary>

Yes please :) This is blocking us from taking our app to production where we only want to use PrivateLink and not go through the internet

Reactions: üëç 2

</details>

<details>
<summary><strong>kazaz-lumida</strong> commented on 2025-05-15 14:17:59.000 UTC</summary>

Can anyone please let us know what is the status here?
This is a MAJOR security issue from our side and a core functionality of the SDK.
To be honest I'm surprised it was not addressed right away given its importance and what seems to be an easy fix.

Reactions: üëç 3

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-15 17:01:35.000 UTC</summary>

Very sorry for the delay. I was honestly under the impression that our support team had already provided you a suitable workaround through our Zendesk portal, but this might have been a different conversation. My bad.

The current workaround is to add this dependency to your own package.json:

```
"@grpc/grpc-js": "1.12.6"
```

This will get Client connections through Private Link working properly.

</details>

<details>
<summary><strong>kazaz-lumida</strong> commented on 2025-05-16 07:04:21.000 UTC</summary>

Thank you @mjameswh , any estimation on getting a real fix?
Fixing the version also means I'm not going to get any new security updates on such critical package which is a security concern on its own

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-16 14:58:55.000 UTC</summary>

> any estimation on getting a real fix?

There are actually two solutions coming up:
1. https://github.com/grpc/grpc-node/pull/2956;
2. https://github.com/temporalio/sdk-typescript/pull/1699 (to be released in TS SDK 1.12.0).

Any of these two will resolve the problem you are facing.

I expect both to be available in the next few days.

Reactions: üöÄ 1

</details>

<details>
<summary><strong>kazaz-lumida</strong> commented on 2025-05-28 06:33:42.000 UTC</summary>

Hi @mjameswh , seems like https://github.com/grpc/grpc-node/releases/tag/%40grpc%2Fgrpc-js%401.13.4 was merged and released üéâ 

Can the Temporal team update the package and release a security patch version so this topic will be resolved?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-28 17:02:26.000 UTC</summary>

> seems like https://github.com/grpc/grpc-node/releases/tag/%40grpc%2Fgrpc-js%401.13.4 was merged and released üéâ

Indeed. We just confirmed that running Temporal TS SDK 1.11.8 with `@grpc/grpc-js` 1.13.4 works fine and allows connection to Temporal Cloud through Private Link.

Affected users may update that dependency locally by simply doing:

```
npm update @grpc/grpc-js
```

> Can the Temporal team update the package and release a security patch version so this topic will be resolved?

We won't bump that dependency nor make a new release. That's not necessary, as that dependency is controlled from the user's project `package-lock.json` file anyway. Simply do `npm update @grpc/grpc-js`, which is actually easier than having to update all of your `@temporalio/*` dependencies. And other users may have their own reasons to prefer some older releases of `grpc-js`; there's no sufficient reason we should prevent them from doing so in this case.

</details>


---

<a id="1432"></a>

### #1432: [Feature Request] Simplify proper usage of `AsyncLocalStorage` in Workflow context

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1432 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-05-30 20:06:15.000 UTC (1y 7m ago) |
| **Updated** | 2026-01-08 17:46:13.000 UTC |
| **Closed** | 2026-01-08 17:46:13.000 UTC |
| **Upvotes** | 5 |
| **Comments** | 1 |
| **Priority Score** | 11 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 5 |

#### Description

### Description

`AsyncLocalStorage` are frequently used inside of Workflow context, for example to implement correlation/tracing/context propagation mechanisms. However, most users don't know (or forget) that ALS must be "disabled" when they are no longer required (i.e. when the workflow execution gets evicted from cache). Otherwise, they do retain heap and still get called for every single `AsyncResource` (e.g. mostly `Promise` in this context) creation.

Given that we already control access to the `AsyncLocalStorage` in Workflow context, it would be easy for the SDK to track instantiation of `AsyncLocalStorage`, and automatically dispose them when the execution context is about to be destroyed.

We also need to investigate either usage of ALS inside of Workflow Context is efficient. Since ALS hooks work at the Worker Thread level, each ALS instance ‚Äútags‚Äù (i.e. adds a `[kResourceStore]` property on) every single `AsyncResource` that gets created in that Worker Thread, without regard to which VM the ALS or the AsyncResource was created in.

This could possibly mean that, even when ALS get disposed properly, using ALS inside workflows may currently add a memory and performance penalty that grows exponentially with the number of currently cached workflows. Based on memory snapshots provided by a customer, the constant multiplier here would be relatively small (48 bytes per ‚Äútag‚Äù in >99% of cases), and therefore, this problem may not be immediately apparent, but could still have sizable impact on Workflow Worker where `maxCachedWorkflow` is high.

Again, given that we already control access to the `AsyncLocalStorage` in Workflow context, it would be possible for the SDK to provide a custom implementation of ALS that is workflow-aware and/or that scales better.

#### Comments (1)

<details>
<summary><strong>neelance</strong> commented on 2024-11-03 13:08:34.000 UTC</summary>

Please see #1557.

</details>


---

<a id="1280"></a>

### #1280: Bundle using Vite

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1280 |
| **State** | OPEN |
| **Author** | gajus (Gajus Kuizinas) |
| **Created** | 2023-11-03 17:23:53.000 UTC (2y 2m ago) |
| **Updated** | 2023-11-09 04:16:41.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 5 |
| **Priority Score** | 11 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 |

#### Description

I am sure you are already familiar with Vite https://vitejs.dev/

Webpack is great, but it is pretty slow and waiting 10 seconds for bundle to complete can become a nuisance.

It would be really nice to be able to bundle using Vite.

#### Comments (5)

<details>
<summary><strong>bkniffler</strong> commented on 2023-11-05 00:03:24.000 UTC</summary>

I'm using esbuild and building for production only takes 0.6s (workflows.js and worker.js), no need to use the built-in webpack bundling. For dev/watch mode, I'm using https://github.com/esbuild-kit/tsx.

<img width="369" alt="Bildschirmfoto 2023-11-05 um 00 58 44" src="https://github.com/temporalio/sdk-typescript/assets/4349324/22766018-badb-4873-8c75-7fa28997e352">

I agree it would be cool if temporal moved to a faster build-in bundler (vite or esbuild). Think cloudflare wrangler and aws sdk  have gone for esbuild by default.

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-11-05 03:09:05.000 UTC</summary>

> I'm using esbuild and building for production only takes 0.6s (workflows.js and worker.js), no need to use the built-in webpack bundling.

Can you elaborate how?

</details>

<details>
<summary><strong>bkniffler</strong> commented on 2023-11-05 09:05:54.000 UTC</summary>

Build script js file building index.js and workflows.js via esbuild
https://gist.github.com/bkniffler/9fe91f6a1a8ba05f1eeb993441c7cdb5

Dev NPM script using tsx to run worker
`NODE_NO_WARNINGS=1 tsx watch src/index.ts`

If I've some time, I'd be happy to provide a simple sample project.

</details>

<details>
<summary><strong>baileywickham</strong> commented on 2023-11-08 19:13:35.000 UTC</summary>

@bkniffler If you have time to create a sample project, I would definitely appreciate it. 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-11-09 04:16:41.000 UTC</summary>

@bkniffler AFAICT you still need the sdk‚Äôs webpack bundler after you generate your js bundle with esbuild.
How are you instantiating your worker?

Reactions: üëç 1

</details>


---

<a id="1033"></a>

### #1033: [Bug] Silent crashes when awaiting promises returned from `Client` (using `hello-world` sample)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1033 |
| **State** | CLOSED |
| **Author** | yamen (Yamen Sader) |
| **Created** | 2023-01-25 04:13:58.000 UTC (2y 11m ago) |
| **Updated** | 2023-06-07 19:07:40.000 UTC |
| **Closed** | 2023-06-07 19:07:39.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 7 |
| **Priority Score** | 11 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### What are you really trying to do?

Trying to run `npm run workflow` inside the `hello-world` app created using `npx @temporalio/create@latest`.

Also found this issue at other times, but this was the simplest way of replicating it.

### Describe the bug

All examples use the `hello-world` project as a baseline.

In a client side script that gets a workflow handle, awaiting on operations that return a Promise can silently crash the script:

``` javascript
  // console.log is never run, process just silently exits
  const handle = await client.workflow.start(example, {
    args: ['Temporal'],
    taskQueue: 'hello-world',
    workflowId: 'workflow-' + nanoid(),
  });

  console.log(Date.now());
```

Removing the `await` on the Promise (and sleeping to allow the relevant calls to finish without exiting the script) works just fine.

```javascript
    // console.log runs now
   const handle = client.workflow.start(example, {
    args: ['Temporal'],
    taskQueue: 'hello-world',
    workflowId: 'workflow-' + nanoid(),
  });

  await new Promise((resolve) => setTimeout(resolve, 100));

  console.log(Date.now());
```

Awaiting on the returned Promise _indirectly_ (via say a `Promise.all`) also works:

```javascript
  // console.log runs here too
  const handle = client.workflow.start(example, {
    args: ['Temporal'],
    taskQueue: 'hello-world',
    workflowId: 'workflow-' + nanoid(),
  });

  await Promise.all([handle, new Promise((resolve) => setTimeout(resolve, 100))]);

  console.log(Date.now());
```

### Minimal Reproduction

As per above, the current `hello-world` example should fail 'as is'. See above steps for 'fixing' it by awaiting indirectly with a sleep (or other promise).

### Environment/Versions

This has been validated in at least two very different environments (Windows WSL and Mac):

- Both Windows WSL2 running Ubuntu 22.04 and an M1 Mac
- SDK 1.5.2
- Both Temporalite and Docker Compose tried
- Both Node 16.x and Node 18.x

### Additional context

* When stepping through with a debugger, it seems a different code path is executed based on whether `await` is called directly on the Promise or not.
* Attaching some process exit hooks and debug logging will show that the process will hard exit as soon as the `Client` call is made and returns. Adding a delay to this exit will allow it to complete running.

```javascript
process.on('beforeExit', (code) => {
  console.log(`Process will exit in 1 second with code: ${code}`);
  setTimeout(() => {
    process.exit(code);
  }, 1000);
});

process.on('exit', (code) => {
  // Only synchronous calls
  console.log(`Process exited with code: ${code}`);
});
```


#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-25 04:59:07.000 UTC</summary>

I experienced the same issue with grpc-js 1.8.x, we're going to release a version that fixes `@grpc/grpc-js` to `~1.7.3`.
For now I recommend using that workaround.


</details>

<details>
<summary><strong>yamen</strong> commented on 2023-01-25 05:36:06.000 UTC</summary>

I can confirm that this fixes the issue!

</details>

<details>
<summary><strong>yamen</strong> commented on 2023-01-25 05:44:44.000 UTC</summary>

Seems related to this issue: https://github.com/grpc/grpc-node/issues/2318

* v1.7.3 works
* v1.8.4 works (but seems to hold a connection open, ie script doesn't exit)
* Any version works as long as there is some ref open in the script (eg calling `setInterval(() => {}, 1_000_000_000)` somewhere in the code)

</details>

<details>
<summary><strong>chadobado</strong> commented on 2023-01-25 15:28:55.000 UTC</summary>

For those unfamiliar, you can work around this by adding an override to package.json:

If using npm
```json
"overrides": {
    "@temporalio/client": {
      "@grpc/grpc-js": "1.7.3"
    }
  }
  ```

If using yarn (must be in root package.json if monorepo):
```json
"resolutions": {
    "@temporalio/client/@grpc/grpc-js": "1.7.3"
  },
```

</details>

<details>
<summary><strong>yamen</strong> commented on 2023-01-25 23:00:06.000 UTC</summary>

Seems to be fixed properly in 1.8.7 now.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-25 23:40:43.000 UTC</summary>

Thanks for pointing this out @yamen.
CC @mjameswh.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-07 19:07:39.000 UTC</summary>

Closing as there is nothing more to be done on this ticket. Updating `@grpc/grpc-js` to 1.8.x is already tracked in #1023.

</details>


---

<a id="868"></a>

### #868: [Feature Request] Add lint rule that prevents Query handlers from mutating state

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/868 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-16 01:08:55.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-22 00:33:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 11 |
| **Priority Score** | 11 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

The only hole in TS's enforced determinism (besides intentionally escaping the vm) is mutating state in Query handlers. 

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

A lint rule that prevents mutations in Query handlers.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

From Roey:

https://github.com/jfmengels/eslint-plugin-fp/blob/master/docs/rules/no-mutation.md

Unsure if there's a way to apply it to specific functions. May need to fork.

#### Comments (11)

<details>
<summary><strong>vkarpov15</strong> commented on 2022-09-18 02:03:03.000 UTC</summary>

@lorensr I took a look and the `no-mutation` rule just disallows `UpdateExpression` and `AssignmentExpression`, so sufficiently simple that we don't need to fork.

The tricky part of this task is making ESLint understand to only apply this rule to `setHandler()` function calls, and only to `setHandler()` calls where the first argument is a Query. I'll look into this a little more to see if I can get TypeScript types in ESLint rules. So far the best I've been able to come up with is making guesses based on the name:

```javascript
  rules: {
    'no-restricted-syntax': [
      'error',
      {
        selector: 'CallExpression[callee.name=\'setHandler\'][arguments.0.name=/.*Query/] AssignmentExpression',
        message: 'Cannot assign values in query handlers'
      },
      {
        selector: 'CallExpression[callee.name=\'setHandler\'][arguments.0.name=/.*Query/] UpdateExpression',
        message: 'Cannot assign values in query handlers'
      }
    ],
```

That rule will throw, for example, on the 2nd `setHandler()` call of the following:

```javascript
  let isBlocked = true;
  setHandler(unblockSignal, () => void (isBlocked = false));
  setHandler(isBlockedQuery, () => {
    isBlocked = isBlocked || true;
    return isBlocked;
  });
```

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-09-18 18:01:52.000 UTC</summary>

I came up with a basic example of a custom ESLint rule that looks for functions named 'setHandler' whose first param is of type `QueryDefinition`, and reports an error if there is an assignment in that function's body. The below code is an example implementation and basic test case.

This isn't quite bulletproof because it checks for 'setHandler' and 'QueryDefinition' by name, so if there are conflicting userland functions with the same names this rule would still trigger.

```javascript
'use strict';

const { ESLintUtils } = require('@typescript-eslint/utils');

const rule = ESLintUtils.RuleCreator.withoutDocs({
  create(context) {
    return {
      AssignmentExpression(node) {
        const parserServices = ESLintUtils.getParserServices(context);
        const checker = parserServices.program.getTypeChecker();

        // Does this assignment expression have an ancestor that is a `setHandler()`
        // CallExpression where the first arg is a `QueryDefinition`?
        const ancestors = context.getAncestors();
        for (const ancestor of ancestors) {
          if (ancestor.type !== 'CallExpression') {
            continue;
          }
          
          if (ancestor.callee.name !== 'setHandler' && !ancestor.callee.name.endsWith('setHandler')) {
            continue;
          }
  
          const firstArg = parserServices.esTreeNodeToTSNodeMap.get(
            ancestor.arguments[0]
          );
          const nodeType = checker.getTypeAtLocation(firstArg);
  
          if (nodeType.symbol.escapedName !== 'QueryDefinition') {
            continue;
          }

          context.report({
            messageId: 'queryHandlerMutation',
            node,
          });
        }
      },
    };
  },
  meta: {
    docs: {
      category: 'Best Practices',
      description: 'Avoid mutations in query handlers.',
    },
    messages: {
      queryHandlerMutation: 'Avoid mutations in query handlers.',
    },
    type: 'suggestion',
    schema: [],
  },
  defaultOptions: []
});

const ruleTester = new ESLintUtils.RuleTester({
  parser: '@typescript-eslint/parser',
  parserOptions: {
    project: './tsconfig.json',
    tsconfigRootDir: __dirname,
  },
});

const valid = [];

valid.push(`
import { setHandler, defineQuery, defineSignal } from '@temporalio/workflow';

export const unblockSignalButLooksLikeQuery = defineSignal('unblock');
export const isBlockedQuery = defineQuery<boolean>('isBlocked');

setHandler(unblockSignalButLooksLikeQuery, () => void (isBlocked = false));
setHandler(isBlockedQuery, () => isBlocked);
`);

const invalid = [];

invalid.push(`
import { setHandler, defineQuery, defineSignal } from '@temporalio/workflow';

export const unblockSignalButLooksLikeQuery = defineSignal('unblock');
export const isBlockedQuery = defineQuery<boolean>('isBlocked');

setHandler(unblockSignalButLooksLikeQuery, () => void (isBlocked = false));
setHandler(isBlockedQuery, () => {
  isBlocked = !isBlocked;
  return isBlocked;
});
`);

ruleTester.run('test', rule, {
  valid: valid.map(code => ({ code })),
  invalid: invalid.map(code => ({ code, errors: [{ messageId: 'queryHandlerMutation' }] }))
});
```

@lorensr do you think it is worth buttoning this up, or would you suggest an alternative approach? A couple other potential options I've thought of:

1. Recommend manually putting `/* eslint no-restricted-syntax: ['error', 'AssignmentExpression', 'UpdateExpression'] */` at the top of query handler function bodies
2. Recommend defining query handlers in a separate file, and tell ESLint config to apply `eslint no-restricted-syntax: ['error', 'AssignmentExpression', 'UpdateExpression']` to those files.

Further reading:

- https://github.com/typescript-eslint/typescript-eslint/blob/8c98d16034a10ebddef35a0a59e31f9f9ca406f8/docs/development/CUSTOM_RULES.md
- https://developers.mews.com/how-to-write-custom-eslint-rules/
- https://eslint.org/docs/latest/developer-guide/working-with-rules

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-19 23:46:53.000 UTC</summary>

I like this approach, @vkarpov15, what are the caveats?
Thanks for looking into it!

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-09-20 01:23:42.000 UTC</summary>

Awesome! 

> This isn't quite bulletproof because it checks for 'setHandler' and 'QueryDefinition' by name, so if there are conflicting userland functions with the same names this rule would still trigger.

I'm fine with this. Perhaps we could help by letting user configure those two names? (eg if uses `setHandler` for something else and always imports `{ setHandler as setTemporalHandler }`) And letting user only apply this plugin/rule to certain files.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-20 04:46:37.000 UTC</summary>

What about if a user imports our setHandler as foo will the rule trigger?

</details>

<details>
<summary><strong>JoshuaKGoldberg</strong> commented on 2022-09-20 13:29:02.000 UTC</summary>

> > This isn't quite bulletproof because it checks for 'setHandler' and 'QueryDefinition' by name, so if there are conflicting userland functions with the same names this rule would still trigger.
> 
> I'm fine with this. Perhaps we could help by letting user configure those two names? (eg if uses `setHandler` for something else and always imports `{ setHandler as setTemporalHandler }`) And letting user only apply this plugin/rule to certain files.

You can be more precise if you want. For example, this bit of code checks if the callee is declared in an import statement that specifies the `"@temporalio/workflow"` module:

```js
const calleeSymbol = checker.getSymbolAtLocation(callee);
const [calleeDeclaration] = calleeSymbol.declarations;

if (
  calleeDeclaration.parent.kind === ts.SyntaxKind.NamedImports &&
  calleeDeclaration.parent.parent.parent.moduleSpecifier.text ===
    "@temporalio/workflow"
) {
  console.log("Got it!");
}
```

(there may be a way to use [`@typescript-eslint/scope-manager`](https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/scope-manager), but I haven't played with that one much)

Alternately, this checks whether the callee's type was declared in a file in a path that contains `node_modules/@temporalio`:

```js
const calleeType = checker.getTypeAtLocation(callee);
const [calleeSignature] = calleeType.getCallSignatures();
const calleeDeclarationFile = calleeSignature.getDeclaration().getSourceFile();

if (calleeDeclarationFile.fileName.includes("node_modules/@temporalio")) {
    console.log("Got it!");
}
```

Keep in mind, though, that users might write their own functions that wrap `setHandler`, with names like `setHandlerWithMyFancyCustomLogging`. If they do that then the latter strategy of checking the signature declaration type won't work, as the function will be declared in their own code. https://github.com/typescript-eslint/typescript-eslint/issues/5271 describes some of the pains we've had in typescript-eslint-land trying to nail down ways to specify custom named functions.

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-09-27 19:57:26.000 UTC</summary>

@JoshuaKGoldberg @lorensr @bergundy thanks for the suggestions! I applied the suggestions from :point_up:  and some other tricks, and came up with the following. Let me know what you think!

It covers:

1. `import` aliases
2. Name collisions - userland `QueryDefinition` and `setHandler` not a problem
3. Allow modifying parameters to the `setHandler` callback.

```javascript
'use strict';

const { ESLintUtils } = require('@typescript-eslint/utils');
const ts = require('typescript');

const temporalWorkflowSuffix = '/node_modules/@temporalio/workflow/lib/workflow.d.ts';
const temporalInternalWorkflowSuffix = '/node_modules/@temporalio/internal-workflow-common/lib/interfaces.d.ts';

const rule = ESLintUtils.RuleCreator.withoutDocs({
  create(context) {
    return {
      AssignmentExpression(node) {
        const parserServices = ESLintUtils.getParserServices(context);
        const checker = parserServices.program.getTypeChecker();

        const lhs = parserServices.esTreeNodeToTSNodeMap.get(node.left);
        const lhsSymbol = checker.getSymbolAtLocation(lhs);

        // Does this assignment expression have an ancestor that is a `setHandler()`
        // CallExpression where the first arg is a `QueryDefinition`?
        const ancestors = context.getAncestors();
        for (const ancestor of ancestors) {
          if (ancestor.type !== 'CallExpression') {
            continue;
          }

          const callee = parserServices.esTreeNodeToTSNodeMap.get(
            ancestor.callee
          );

          const calleeSymbol = checker.getSymbolAtLocation(callee);
          const calleeDeclaration = calleeSymbol?.declarations?.[0];
          if (!calleeDeclaration) {
            continue;
          }
          
          let isSetHandlerFromNamedImport = false;
          let isSetHandlerFromDefaultImport = false;

          if (calleeDeclaration.parent?.kind === ts.SyntaxKind.NamedImports &&
              calleeDeclaration.parent?.parent?.parent?.moduleSpecifier?.text === '@temporalio/workflow') {
            // `import { setHandler } from '@temporalio/workflows'` or
            // `import { setHandler as something } from '@temporalio/workflows'`
            const declaration = calleeDeclaration?.parent?.elements
              .find(el => el?.name?.escapedText === ancestor.callee.name);
            if (declaration === undefined) {
              continue;
            }
            isSetHandlerFromNamedImport = declaration.propertyName != null ?
              declaration.propertyName.escapedText === 'setHandler' :
              declaration.name.escapedText === 'setHandler';
          } else if (calleeDeclaration.parent?.kind === ts.SyntaxKind.SourceFile &&
            calleeDeclaration.parent?.fileName?.endsWith(temporalWorkflowSuffix)) {
            // `import wf from '@temporalio/workflows'` or
            // `import * as wf from '@temporalio/workflows'`
            isSetHandlerFromDefaultImport = calleeDeclaration?.name?.escapedText === 'setHandler';
          }
  
          if (!isSetHandlerFromNamedImport && !isSetHandlerFromDefaultImport) {
            continue;
          }

          const firstArg = parserServices.esTreeNodeToTSNodeMap.get(
            ancestor.arguments[0]
          );
          const nodeType = checker.getTypeAtLocation(firstArg);
  
          // If first arg is not of type `QueryDefinition`, skip
          if (nodeType?.symbol?.escapedName !== 'QueryDefinition' ||
              !nodeType?.symbol?.parent?.valueDeclaration?.path?.endsWith(temporalInternalWorkflowSuffix)) {
            continue;
          }

          if (lhsSymbol?.declarations?.[0]?.kind === ts.SyntaxKind.Parameter &&
              lhsSymbol.declarations[0]?.parent?.parent?.expression === callee) {
            // Modifying a function argument is OK if it is a parameter to `setHandler()` callback
            continue;
          }

          context.report({
            messageId: 'queryHandlerMutation',
            node,
          });
        }
      },
    };
  },
  meta: {
    docs: {
      category: 'Best Practices',
      description: 'Avoid mutations in query handlers.',
    },
    messages: {
      queryHandlerMutation: 'Avoid mutations in query handlers.',
    },
    type: 'suggestion',
    schema: [],
  },
  defaultOptions: []
});

const ruleTester = new ESLintUtils.RuleTester({
  parser: '@typescript-eslint/parser',
  parserOptions: {
    project: './tsconfig.json',
    tsconfigRootDir: __dirname,
  },
});

const valid = [];

valid.push(`
import { setHandler, defineQuery, defineSignal } from '@temporalio/workflow';

export const unblockSignalButLooksLikeQuery = defineSignal('unblock');
export const isBlockedQuery = defineQuery<boolean>('isBlocked');

setHandler(unblockSignalButLooksLikeQuery, () => void (isBlocked = false));
setHandler(isBlockedQuery, () => isBlocked);
`);

valid.push(`
import { setHandler as notSetHandler, defineQuery } from '@temporalio/workflow';

export const isBlockedQuery = defineQuery<boolean>('isBlocked');

notSetHandler(isBlockedQuery, () => isBlocked);
`);

valid.push(`
import { setHandler as notSetHandler, defineQuery } from '@temporalio/workflow';

export const isBlockedQuery = defineQuery<boolean, [string]>('isBlocked');

notSetHandler(isBlockedQuery, (arg: string) => {
  arg = arg.toLowerCase();
  if (arg === 'skip') {
    return false;
  }
  return isBlocked;
});
`);

const invalid = [];

invalid.push(`
import { setHandler, defineQuery, defineSignal } from '@temporalio/workflow';

export const unblockSignalButLooksLikeQuery = defineSignal('unblock');
export const isBlockedQuery = defineQuery<boolean>('isBlocked');

setHandler(unblockSignalButLooksLikeQuery, () => void (isBlocked = false));
setHandler(isBlockedQuery, () => {
  isBlocked = !isBlocked;
  return isBlocked;
});
`);

invalid.push(`
import {
  setHandler as definitelyNotSetHandler,
  defineQuery
} from '@temporalio/workflow';

export const isBlockedQuery = defineQuery<boolean>('isBlocked');

definitelyNotSetHandler(isBlockedQuery, () => {
  isBlocked = !isBlocked;
  return isBlocked;
});
`);

invalid.push(`
import wf from '@temporalio/workflow';

export const isBlockedQuery = wf.defineQuery<boolean>('isBlocked');

wf.setHandler(isBlockedQuery, () => {
  isBlocked = !isBlocked;
  return isBlocked;
});
`);

invalid.push(`
import * as wf from '@temporalio/workflow';

export const isBlockedQuery = wf.defineQuery<boolean>('isBlocked');

wf.setHandler(isBlockedQuery, () => {
  isBlocked = !isBlocked;
  return isBlocked;
});
`);

ruleTester.run('test', rule, {
  valid: valid.map(code => ({ code })),
  invalid: invalid.map(code => ({ code, errors: [{ messageId: 'queryHandlerMutation' }] }))
});
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-19 22:46:18.000 UTC</summary>

I played with this locally and found another case that we don't cover:

```ts
import * as wf from '@temporalio/workflow';

export const isBlockedQuery = wf.defineQuery<boolean>('isBlocked');

function mySetHandler(fn: () => boolean) {
  wf.setHandler(isBlockedQuery, fn);
}

mySetHandler(() => {
  isBlocked = !isBlocked;
  return isBlocked;
});
```

I also rewrote this in TypeScript and fixed some of the type assertions.
I'll push my work to a branch and try to figure out a way to address the case above.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-20 02:07:38.000 UTC</summary>

This isn't caught either:

```ts
import { setHandler, defineQuery, defineSignal } from '@temporalio/workflow';

export const isBlockedQuery = defineQuery<boolean>('isBlocked');

let isBlocked = false;

function mutator() {
  isBlocked = !isBlocked;
}

setHandler(isBlockedQuery, () => {
  mutator();
  return isBlocked;
});
```

I'm working on this, I'll try to find a solution for these cases.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-21 21:32:43.000 UTC</summary>

I'm going to table this for now.
I'll post my code in a branch, it requires more time than I have to spend on it currently and it's not high priority for us.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-22 00:33:44.000 UTC</summary>

Pushed my branch, you can see the work here:
https://github.com/temporalio/sdk-typescript/blob/query-linter/packages/test/src/query-linter.ts
It's mostly work that @vkarpov15 did, I added a few abstractions, rewrote in TS, and added the test cases above.

There's probably a simpler case that @vkarpov15's code misses that I haven't added yet:

```ts
import { setHandler, defineQuery } from '@temporalio/workflow';

export const isBlockedQuery = defineQuery<boolean>('isBlocked');

let isBlocked = false;

function handler() {
  isBlocked = !isBlocked;
  return isBlocked;
}

setHandler(isBlockedQuery, handler);
```

</details>


---

<a id="573"></a>

### #573: temporal-client-0.1.0: 3 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/573 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-01 03:20:03.000 UTC (3y 9m ago) |
| **Updated** | 2024-01-02 17:59:16.000 UTC |
| **Closed** | 2024-01-02 17:59:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 11 |
| **Priority Score** | 11 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>temporal-client-0.1.0</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/core-bridge/Cargo.toml</p>
<p>Path to vulnerable library: /packages/core-bridge/Cargo.toml</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (temporal-client version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [WS-2023-0305](https://github.com/rustls/webpki/commit/4ea052366f342a06344aab589565179b59b342d3) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | rustls-webpki-0.100.1.crate | Transitive | N/A* | &#10060; |
| [CVE-2018-16875](https://www.mend.io/vulnerability-database/CVE-2018-16875) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | rustls-webpki-0.100.1.crate | Transitive | N/A* | &#10060; |
| [WS-2023-0366](https://github.com/bytecodealliance/rustix/commit/31fd98ca723b93cc6101a3e29843ea5cf094e159) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.5 | rustix-0.37.20.crate | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> WS-2023-0305</summary>


###  Vulnerable Library - <b>rustls-webpki-0.100.1.crate</b></p>

<p>Web PKI X.509 Certificate Verification.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/rustls-webpki/0.100.1/download">https://crates.io/api/v1/crates/rustls-webpki/0.100.1/download</a></p>
<p>Path to dependency file: /packages/core-bridge/Cargo.toml</p>
<p>Path to vulnerable library: /packages/core-bridge/Cargo.toml</p>
<p>

Dependency Hierarchy:
  - temporal-client-0.1.0 (Root Library)
    - temporal-sdk-core-protos-0.1.0
      - tonic-0.9.2.crate
        - tokio-rustls-0.24.1.crate
          - rustls-0.21.2.crate
            - :x: **rustls-webpki-0.100.1.crate** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
rustls-webpki: CPU denial of service in certificate path building

<p>Publish Date: 2023-08-22
<p>URL: <a href=https://github.com/rustls/webpki/commit/4ea052366f342a06344aab589565179b59b342d3>WS-2023-0305</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-fh2r-99q2-6mmg">https://github.com/advisories/GHSA-fh2r-99q2-6mmg</a></p>
<p>Release Date: 2023-08-22</p>
<p>Fix Resolution: rustls-webpki - 0.100.2,0.101.4</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2018-16875</summary>


###  Vulnerable Library - <b>rustls-webpki-0.100.1.crate</b></p>

<p>Web PKI X.509 Certificate Verification.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/rustls-webpki/0.100.1/download">https://crates.io/api/v1/crates/rustls-webpki/0.100.1/download</a></p>
<p>Path to dependency file: /packages/core-bridge/Cargo.toml</p>
<p>Path to vulnerable library: /packages/core-bridge/Cargo.toml</p>
<p>

Dependency Hierarchy:
  - temporal-client-0.1.0 (Root Library)
    - temporal-sdk-core-protos-0.1.0
      - tonic-0.9.2.crate
        - tokio-rustls-0.24.1.crate
          - rustls-0.21.2.crate
            - :x: **rustls-webpki-0.100.1.crate** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The crypto/x509 package of Go before 1.10.6 and 1.11.x before 1.11.3 does not limit the amount of work performed for each chain verification, which might allow attackers to craft pathological inputs leading to a CPU denial of service. Go TLS servers accepting client certificates and TLS clients are affected.

<p>Publish Date: 2018-12-14
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2018-16875>CVE-2018-16875</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-fh2r-99q2-6mmg">https://github.com/advisories/GHSA-fh2r-99q2-6mmg</a></p>
<p>Release Date: 2018-12-14</p>
<p>Fix Resolution: golang 1.10.6,golang 1.11.3, webpki - 0.22.2, rustls-webpki - 0.100.2,0.101.4</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> WS-2023-0366</summary>


###  Vulnerable Library - <b>rustix-0.37.20.crate</b></p>

<p>Safe Rust bindings to POSIX/Unix/Linux/Winsock2-like syscalls</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/rustix/0.37.20/download">https://crates.io/api/v1/crates/rustix/0.37.20/download</a></p>
<p>Path to dependency file: /packages/core-bridge/Cargo.toml</p>
<p>Path to vulnerable library: /packages/core-bridge/Cargo.toml</p>
<p>

Dependency Hierarchy:
  - temporal-client-0.1.0 (Root Library)
    - temporal-sdk-core-protos-0.1.0
      - prost-wkt-types-0.4.2.crate
        - prost-build-0.11.9.crate
          - tempfile-3.6.0.crate
            - :x: **rustix-0.37.20.crate** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
rustix's `rustix::fs::Dir` iterator with the `linux_raw` backend can cause memory explosion

<p>Publish Date: 2023-10-18
<p>URL: <a href=https://github.com/bytecodealliance/rustix/commit/31fd98ca723b93cc6101a3e29843ea5cf094e159>WS-2023-0366</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c827-hfw6-qwvm">https://github.com/advisories/GHSA-c827-hfw6-qwvm</a></p>
<p>Release Date: 2023-10-18</p>
<p>Fix Resolution: rustix - 0.35.15,0.36.16,0.37.25,0.38.19</p>

</p>

<p></p>

</details>

#### Comments (11)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-21 04:11:59.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-06-21 18:50:10.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-19 17:13:25.000 UTC</summary>

The risk here is a segfault. If anyone experiences this issue with the Worker, we will prioritize. For now, we'll wait for opentelemetry to update their dashmap version: https://github.com/open-telemetry/opentelemetry-rust/issues/846

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-09-16 21:58:45.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-09-19 23:57:04.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-09-29 01:16:09.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-02-26 15:31:26.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>SamFerwerda</strong> commented on 2023-03-02 13:02:33.000 UTC</summary>

Can the remove_dir_all be updated to ^0.8.0 as this will fix the vulnerability. Latest version of remove_dir_all has been updated a week ago

Reactions: üëç 1

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-06-28 22:12:12.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-29 17:18:11.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2024-01-02 17:59:15.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="333"></a>

### #333: [Bug] Package initializer does not work for some users

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/333 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-24 10:19:49.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-02 01:24:50.000 UTC |
| **Closed** | 2021-11-02 01:24:50.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 9 |
| **Priority Score** | 11 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the bug

https://temporalio.slack.com/archives/C01DKSMU94L/p1634944174028300

### To Reproduce

i could reproduce (on both node 14 and 16) with

```
 npx @temporalio/create@latest moop
‚úî Which sample would you like to use? ‚Ä∫ hello-world
Creating a new Temporal project in /Users/swyx/Temporal/testnodesdk/moop/

‚úî Directory /Users/swyx/Temporal/testnodesdk/moop/ already exists. Would you like to replace it? ‚Ä¶ yes
Downloading files for sample hello-world. This might take a moment.

Installing packages. This might take a couple of minutes.

npm ERR! code ENOENT
npm ERR! syscall open
npm ERR! path /Users/swyx/package.json
npm ERR! errno -2
npm ERR! enoent ENOENT: no such file or directory, open '/Users/swyx/package.json'
npm ERR! enoent This is related to npm not being able to find a file.
npm ERR! enoent 

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/swyx/.npm/_logs/2021-10-24T10_08_05_549Z-debug.log

Aborting installation.
  npm has failed.
```

notice that my error shows a different root than Ramazan's:

```
ramazanozer@Ramazans-MBP-39 alphademov2 % npx @temporalio/create@latest
‚úî What is your project named? ‚Ä¶ my-temporal
‚úî Which sample would you like to use? ‚Ä∫ hello-world
Creating a new Temporal project in /Users/ramazanozer/IdeaProjects/alphademov2/my-temporal/

Downloading files for sample hello-world. This might take a moment.

Installing packages. This might take a couple of minutes.


Aborting installation.
Unexpected error. Please report it as a bug:
Error: ENOENT: no such file or directory, open '/Users/ramazanozer/IdeaProjects/alphademov2/my-temporal/package.json'
    at Object.openSync (fs.js:497:3)
    at readFileSync (fs.js:393:35)
    at updateNodeVersion (/Users/ramazanozer/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/helpers/install.js:32:52)
    at processTicksAndRejections (internal/process/task_queues.js:95:5)
    at async createApp (/Users/ramazanozer/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/create-project.js:141:5)
    at async start (/Users/ramazanozer/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/index.js:126:5) {
  errno: -2,
  syscall: 'open',
  code: 'ENOENT',
  path: '/Users/ramazanozer/IdeaProjects/alphademov2/my-temporal/package.json'
}
```


### Context

i think https://github.com/temporalio/sdk-typescript/blob/4f4e3f6fc03abe928fae1f3f2459b2b256ed3017/packages/create-project/src/helpers/install.ts#L44 needs better error handling - readFileSync is just too error prone.

but the root cause is not the file read, it is the lack of package.json in the cloned folder.

#### Comments (9)

<details>
<summary><strong>swyxio</strong> commented on 2021-10-24 10:20:16.000 UTC</summary>

cc @lorensr 


</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-25 15:08:02.000 UTC</summary>

I think this is due to the lack of a samples-node repo on GitHub. The code has been updated to download from `samples-typescript`, but the `create` package hasn't been published.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-25 15:10:28.000 UTC</summary>

@lorensr `samples-node` redirects to `samples-typescript` at least on web.
I'll publish soon.

The error that @sw-yx posted doesn't seem to be related though:
```
npm ERR! enoent ENOENT: no such file or directory, open '/Users/swyx/package.json'
```
Can you please look into it?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-25 15:19:26.000 UTC</summary>

I did‚ÄîI was able to repro by changing back to `samples-node`, although I think it was the extract step, not the download step:

![image](https://user-images.githubusercontent.com/251288/138723057-f223f4c9-e5b0-401a-bc9a-01e2388a6494.png)

Results in an empty project dir, and when you run `cli.js` from outside `sdk-typescript`, this is the error you get when the script `npm install`s inside the empty project dir:

![image](https://user-images.githubusercontent.com/251288/138723292-d926e02d-30de-4ecf-bcd7-b924b7f7828b.png)


</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-25 15:45:30.000 UTC</summary>

Does the tar step not throw an error?
Looks like the error should be thrown somewhere else to detect that an invalid sample url was provided, this could happen in cases where user uses a full url instead of just sample name

</details>

<details>
<summary><strong>matang-dave</strong> commented on 2021-10-25 18:46:33.000 UTC</summary>

Facing the same issue.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-25 21:08:14.000 UTC</summary>

I'm preparing to release a new version by the end of the day.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-30 00:18:24.000 UTC</summary>

@lorensr could you please make the script fail more gracefully in the case of sample not found?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-30 00:33:20.000 UTC</summary>

Here's what we print when the provided repo doesn't have a `package.json`:

```
$ npx @temporalio/create@latest t2 -s https://github.com/lorensr/food-delivery/tree/main/components
Error: Could not locate a package.json at "https://api.github.com/repos/lorensr/food-delivery/contents/components/package.json?ref=main".
Please check that the repository is a Temporal TypeScript SDK template and try again.
```

I can add a check that covers when the provided repo has changed names/orgs.

Here's what we print when a chosen sample doesn't have a `package.json`:

![image](https://user-images.githubusercontent.com/251288/139513619-6fa78b83-a48c-47e1-a7fd-085e5df9a807.png)

I'll also have it print a list of samples and link to samples-typescript.


</details>


---

<a id="136"></a>

### #136: [Feature Request] Organize samples in repo

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/136 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-24 10:10:19.000 UTC (4y 6m ago) |
| **Updated** | 2021-09-29 09:41:10.000 UTC |
| **Closed** | 2021-09-29 09:41:10.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 9 |
| **Priority Score** | 11 |
| **Labels** | enhancement, good first issue |
| **Assignees** | vkarpov15 |
| **Milestone** | beta |
| **Reactions** | üëç 1 |

#### Description

Currently the samples live in the `create-project` package and are not easily browsable.
The opentelemetry sample added in https://github.com/temporalio/sdk-node/pull/135 is a first attempt to change that by adding a top level samples directory.

Samples share a lot of code and configuration (`tsconfig.json`) which we should strive not to duplicate.
A simple solution to keep the code browsable while avoiding duplication is to symlink shared files.
We should also move the `tsconfig.json` definitions out of the script body and into actual files.
There will still be duplication within the sample files but I think that's a good enough compromise.
All samples should have automated testing.

#### Comments (9)

<details>
<summary><strong>joebowbeer</strong> commented on 2021-08-17 09:55:13.000 UTC</summary>

What is relationship between samples here and in https://github.com/temporalio/samples-node ?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-17 12:49:49.000 UTC</summary>

Right now, we have samples in both repos, `samples-node` is relatively new.
We will move most of the samples into that repo once it has automated testing and linting.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-31 11:31:47.000 UTC</summary>

As discussed yesterday, @lorensr will take care of:
- [ ] Moving the opentelemetry and mtls samples from this repo into the samples-node repo
- [ ] Modifying the package initializer to pull samples from the samples-node repo
- [ ] CI in the samples-node repo

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-06 00:31:52.000 UTC</summary>

I'll symlink once https://github.com/temporalio/samples-node/pull/4 is done. Would like to discuss linting & testing on our Tues call

Reactions: üëç 1

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-20 17:01:51.000 UTC</summary>

Symlink pros vs cons. Do we want to use them?

> Samples share a lot of code and configuration (tsconfig.json) which we should strive not to duplicate.
> A simple solution to keep the code browsable while avoiding duplication is to symlink shared files.


![image](https://user-images.githubusercontent.com/251288/134042947-29754ca0-1f7d-4210-a68e-21b5fe8eae0e.png)

Pros:

- When we update one of the shared files, we only have to update a single file

Cons:

- From @vkarpov15 : My only concern is that the shared config adds friction for devs that want to copy one of the samples into a separate repo using `cp -r`. 
- Not as browsable on GitHub. Instead of seeing the file, you get a line of text and have to go navigate to the target file yourself:

![image](https://user-images.githubusercontent.com/251288/134043196-bfc595c4-665b-4e68-8bea-c6210ea3bbc2.png)
https://github.com/lorensr/samples-node/blob/p2/hello-world/tsconfig.json


</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-20 17:13:50.000 UTC</summary>

Having the samples interdependent via shared config is also a drag on the developer, who just wants to copy and paste one example to get started.  But I can understand the trade-off.

However, I would be annoyed and a little frightened if I had to deal with symlinks. How do you even do them portably? I fear that's venturing into husky territory, where I do not go.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-20 18:15:09.000 UTC</summary>

Alternative suggestion from Val: precommit hook that copies root tsconfig to each sample

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-20 18:28:30.000 UTC</summary>

> Alternative suggestion from Val: precommit hook that copies root tsconfig to each sample

I like it, best of both worlds 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 09:41:10.000 UTC</summary>

I'm closing this, the samples have been moved out of this repo into `samples-node`.
Thanks @lorensr for the awesome work on the new `@temporalio/create` package.

</details>


---

<a id="1036"></a>

### #1036: How to add module to disallowedModules?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1036 |
| **State** | CLOSED |
| **Author** | gajus (Gajus Kuizinas) |
| **Created** | 2023-01-26 15:20:21.000 UTC (2y 11m ago) |
| **Updated** | 2023-01-26 17:38:58.000 UTC |
| **Closed** | 2023-01-26 17:38:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 10 |
| **Priority Score** | 10 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We need to exclude a module from being bundled.

Contrary to the documentation, `ignoreModules` does not achieve that.

#### Comments (10)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-26 16:10:16.000 UTC</summary>

Can you please provide more information why ignoreModules doesn't achieve what you want?
Here's what the bundler does internally FTR: https://github.com/temporalio/sdk-typescript/blob/31c8cc27287ec91e495397e85cd52a30c0d1236a/packages/worker/src/workflow/bundler.ts#L180.
Here's a test that successfully ignores `dns` https://github.com/temporalio/sdk-typescript/blob/31c8cc27287ec91e495397e85cd52a30c0d1236a/packages/test/src/test-bundler.ts#L60.

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 16:24:17.000 UTC</summary>

I've added `['slonik', 'node:crypto']` and still getting error:

```
2023-01-26T16:23:52.171Z [ERROR] ERROR in node:crypto
2023-01-26T16:23:52.171Z [ERROR] Module build failed: UnhandledSchemeError: Reading from "node:crypto" is not handled by plugins (Unhandled scheme).
2023-01-26T16:23:52.171Z [ERROR] Webpack supports "data:" and "file:" URIs by default.
2023-01-26T16:23:52.171Z [ERROR] You may need an additional plugin to handle "node:" URIs.
```

so it seems at least one of them is still being included

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 16:49:41.000 UTC</summary>

Actually, now that I look at the Temporal source code, there is no logic there to actually exclude module. It only adds a warning if it is not already excluded.

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 16:50:37.000 UTC</summary>

It seems that it attempts to exclude it using `alias`, which unfortunately does not work for modules such as `node:`

https://github.com/webpack/webpack/issues/14166

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-26 17:01:45.000 UTC</summary>

LMK if removing the `node:` prefix solves your issue for now.

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 17:06:47.000 UTC</summary>

> LMK if removing the node: prefix solves your issue for now.

It does not, as explained in that webpack issue.

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 17:07:09.000 UTC</summary>

I have no control over `node:` referenced in code, as it is coming from dependencies.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-26 17:19:34.000 UTC</summary>

The issue you are facing is not directly about `ignoreModules`. It is that the workflow bundler is not compiling for the node target, and therefore, webpack does not even know how to process dependencies in the `node:` namespace.

Would it be possible for you to ignore the module that does import that `node:` dependency?

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 17:20:39.000 UTC</summary>

That's what I am trying to do with `externals`.

Anyway, overriding externals does the job.

```ts
// @see https://github.com/temporalio/sdk-typescript/issues/1036#issuecomment-1405322953
config.externals = {
  "node:crypto": "{}"
};
```

</details>

<details>
<summary><strong>gajus</strong> commented on 2023-01-26 17:22:47.000 UTC</summary>

A Temporal-compatible patch:

```ts
const temporalExternals = config.externals;

config.externals = async (context, callback) => {
  if (context.request === 'node:crypto') {
    return 'var {}';
  }

  return temporalExternals(context, callback);
};

config.resolve.alias = {
  ...config.resolve.alias,
  '@': path.resolve(__dirname, '../..'),
  slonik: false,
};
```

</details>


---

<a id="939"></a>

### #939: [Bug] Worker crashes with "async hook stack has become corrupted" on Workflow Task timeout

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/939 |
| **State** | OPEN |
| **Author** | thehellmaker (Akash Ashok) |
| **Created** | 2022-10-28 09:54:30.000 UTC (3y 2m ago) |
| **Updated** | 2025-12-04 05:49:26.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 8 |
| **Priority Score** | 10 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
We had a workflow in development where we were still developing on it. Older version of workflow is still running when we change the code of workflow and deployed it and we see a crash in the system


### Describe the bug
Error: async hook stack has become corrupted (actual: 112970, expected: 3)
 1: 0x10229dab8 node::AsyncHooks::FailWithCorruptedAsyncStack(double) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 2: 0x102232164 node::AsyncHooks::pop_async_context(double) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 3: 0x102231d8c node::InternalCallbackScope::Close() [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 4: 0x10223266e node::InternalMakeCallback(node::Environment*, v8::Local<v8::Object>, v8::Local<v8::Object>, v8::Local<v8::Function>, int, v8::Local<v8::Value>*, node::async_context) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 5: 0x10224a238 node::AsyncWrap::MakeCallback(v8::Local<v8::Function>, int, v8::Local<v8::Value>*) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 6: 0x102346af6 node::worker::MessagePort::OnMessage(node::worker::MessagePort::MessageProcessingMode) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 7: 0x102cd275b uv__async_io [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 8: 0x102ce654b uv__io_poll [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
 9: 0x102cd2ce1 uv_run [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
10: 0x102232f9f node::SpinEventLoop(node::Environment*) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
11: 0x1023a9cae node::worker::Worker::Run() [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
12: 0x1023ad6a2 node::worker::Worker::StartThread(v8::FunctionCallbackInfo<v8::Value> const&)::$_3::__invoke(void*) [/Users/random/.nvm/versions/node/v16.16.0/bin/node]
13: 0x7ff81c0e84e1 _pthread_start [/usr/lib/system/libsystem_pthread.dylib]
14: 0x7ff81c0e3f6b thread_start [/usr/lib/system/libsystem_pthread.dylib]
[nodemon] app crashed - waiting for file changes before starting...
^C


#### Comments (8)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-28 13:13:32.000 UTC</summary>

Interesting.. this looks like a Node.js issue, can you try running with different Node.js versions?

</details>

<details>
<summary><strong>thehellmaker</strong> commented on 2022-10-28 16:23:21.000 UTC</summary>

Actually i figured out the issue. It was a bug in the worker code which lead to an infinite loop. But this should be handled better by temporal i feel with proper error messaging

My worker has a code like this

```
while(true) {
        // FIX: currentState = WorkflowState.COMPLETE
        await condition(() => currentState !== WorkflowState.COMPLETE);
        if (currentState === WorkflowState.REVIEWED_AND_SAVED) {
            // call an activity and
            return response
        }
}
```

The commented out line with // FIX:  is the fix

The problem here is 

- current state is updated by a Signal
- When the signal sets the currentState to anything other than  WorkflowState.REVIEWED_AND_SAVED or  WorkflowState.COMPLETE then the condition clause is always satisfied and the if condition is never satisfied 
- The worker now goes into infinite loop without any condition waits.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-28 16:32:39.000 UTC</summary>

I don't know how much we can handle this since it looks like the error happens deep in Node internals.
I can see why this happens though.
Thanks for the report.

The SDK does protect you from tight loops by setting a timeout on workflow activations but looks like something else is going on here.

It looks like async_hooks and the vm context execution timeout clash.
We should try to reproduce this and see if there's anything the SDK can do or to mitigate this but I suspect the issue is an unhandled edge case in Node.js.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-24 20:04:56.000 UTC</summary>

Here is a repro without `condition`:

```
// Fails with corrupted async stack
export async function testWorkflow(): Promise<void> {
  while (true) {
    await new CancellationScope({ cancellable: true }).run(() =>
      Promise.resolve(true)
    );
  }
}
```

This is obviously an endless loop. I'd expect the WFT to ends with "Error: Script execution timed out after 10000ms", but instead get an async hook stack corruption, as described above.

My investigation got it down to an issue in node involving: vm + microtaskMode: 'afterEvaluate' + runInContext with timeout + AsyncLocalStorage. I know for sure that it happens after the runInContext‚Äôs timeout fires. Seems like either the AsyncLocalStorage internal state is not properly cleaned up on context timeout, or there are still some live functions (probably native code) attached to that context's AsyncLocalStorage that tries to access the storage after it has been cleaned up.

Proposed solution to improve the error message is to replace Node's builtin but experimental implementation of AsyncLocalStorage with our own implementation.

</details>

<details>
<summary><strong>vymarkov</strong> commented on 2025-01-07 10:56:54.000 UTC</summary>

Unfortunately I've faced with the same issue 

</details>

<details>
<summary><strong>vymarkov</strong> commented on 2025-01-09 09:24:20.000 UTC</summary>

@mjameswh I would like to add that we're currently use temporal sdk v1.11.5, we use AsyncLocalStorage which is a part of @temporalio/workflow package

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-09 16:23:47.000 UTC</summary>

@vymarkov The way this error message shows up is certainly surprising, but the fact that you are getting this indicates that execution of your workflow code is timing out.

To be exact, a single call into the workflow sandbox takes more than 10 seconds to complete; that most invariably means that you have some endless loop with nothing in it to slow down looping. That's something you will need to figure out and fix by yourself.

Look for the following:
- Missing `await` on `sleep()`, activity execution, child workflows, and other APIs that returns `Promise`;
- `await condition()` where the predicate function immediately evaluates to true.

</details>

<details>
<summary><strong>yash261</strong> commented on 2025-12-04 05:49:26.000 UTC</summary>

Getting the same error but it is happening randomly. I am running the playwright script in the worker

</details>


---

<a id="516"></a>

### #516: [Bug] bundleWorkflowCode fails on "heavyweight" dependencies

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/516 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2022-03-08 01:10:56.000 UTC (3y 10m ago) |
| **Updated** | 2022-08-16 13:58:51.000 UTC |
| **Closed** | 2022-08-16 13:58:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 10 |
| **Priority Score** | 10 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

We have a workflow that depends on some interfaces/enums/basic utility functions in another module, which in turn depends on some "heavyweight" external package. That external package could actually be any package that depends on node's internal packages (such as filesystem, dns, buffer, url...), or any package that contains native code. When the workflow code gets bundled (either implicitly in `Worker.create(...)` or explicitly by calling `bundleWorkflowCode(...)`), **Webpack is sometime unable to determine that the external package is not actually required at runtime, and will therefore try to load it, causing a build failure.**

The error message looks something like the following (truncated to keep it readable; I actually get 46 errors). Note that in this case, the "external" package is `got` (an HTTP client, similar to `request`) and problematic dependencies are `process`, `util`, `url`, `dns` and others, which are all packages provided internally by node.

```
[ERROR] modules with errors 390 bytes [errors]
[ERROR]   node:process 39 bytes [built] [code generated] [1 error]
[ERROR]   node:util 39 bytes [built] [code generated] [1 error]
[ERROR]   node:url 39 bytes [built] [code generated] [1 error]
[ERROR]   + 7 modules
        ...
[ERROR] ERROR in ./node_modules/cacheable-lookup/source/index.js 10:4-18
[ERROR] Module not found: Error: Can't resolve 'dns' in '/Users/jwatkins/Development/temporal/bug-heavyweight-dependency-bundling/node_modules/cacheable-lookup/source'
[ERROR] resolve 'dns' in '/Users/jwatkins/Development/temporal/bug-heavyweight-dependency-bundling/node_modules/cacheable-lookup/source'
        ...
[ERROR]   Parsed request is a module
[ERROR]   using description file: /Users/jwatkins/Development/temporal/bug-heavyweight-dependency-bundling/node_modules/cacheable-lookup/package.json (relative path: ./source)
        ...
[ERROR]  @ ./node_modules/got/dist/source/core/options.js 10:0-47 28:25-40
[ERROR]  @ ./node_modules/got/dist/source/index.js 2:0-40 4:17-24 11:0-55 11:0-55 12:0-34 12:0-34
[ERROR]  @ ./src/api/client.ts 7:30-44
[ERROR]  @ ./src/api/index.ts 17:13-32
[ERROR]  @ ./src/temporal/myWorkflow.ts 4:16-39
[ERROR]  @ ./src/temporal/myWorkflow-entrypoint-caf2c449-bc91-46c7-9b6b-dc05043a9065.js
```

### Minimal Reproduction

See https://github.com/mjameswh/temporalio-sdk-typescript-issue-heavyweight-dependency-bundling for a workspace that demonstrate this issue.

Note that, in this specific case, the issue can easily be worked around by simply importing from `../api/models` instead of `../api/index` (in myWorkflow.ts). However, our actual use case spans multiple projects in a monorepo structure, and we have not yet found any simple, practical solution to this issue.

### Environment/Versions

- Temporal typescript-sdk version: 0.19.0-rc.1

### Solutions to be considered

- **Add [`target: 'node'`](https://webpack.js.org/configuration/target/) to bundleWorkflowCode's [webpack config](https://github.com/temporalio/sdk-typescript/blob/82351ccc69a5d3876e5b44d4860c20ec71cfca28/packages/worker/src/workflow/bundler.ts#L117).** Without this option, Webpack will simply not allow importing node's internal packages. In fact, by default, Webpack assume that you are bundling for a browser environment, which could cause some weird issues at some point in the future. Still, given that most of node's internal packages are unusable in isolated vm context, it is not clear if allowing these imports would actually help or just push issues a little bit father. It also does not resolve similar issues caused by packages that contains native code.

- **Allow users to specify a list of dependencies to be ignored.** For example, an optional property `ignoreModules` could be added to [`BundleOptions`](https://github.com/temporalio/sdk-typescript/blob/82351ccc69a5d3876e5b44d4860c20ec71cfca28/packages/worker/src/workflow/bundler.ts#L189). That list would be used to dynamically add values to Webpack's `resolve.alias` or `resolve.fallback` (ie. `{ "got": false }`). That would solve this specific issue and would be relatively easy to understand for most developers facing similar issues.

- **Allow users to apply more generic overrides to the Webpack config.** For example, an optional property `webpackConfigOverrides` could be added to `BundleOptions`. If it is there, that property would be merged with the default/calculated Webpack configuration. Alternatively, it could be an override function, which receive the default/calculated Webpack configuration, and returns the modified configuration (this is much more flexible, and easier from our point of view, more harder to work with for developers). This is for example [how Gatsby works](https://www.gatsbyjs.com/docs/how-to/custom-configuration/add-custom-webpack-config/). This approach would not only solve the current issue, but also provide a way to deal with many other very custom needs that developers may have (think of.. _Hey guys! We would like to use [`define`](https://webpack.js.org/plugins/define-plugin/) for our workflows_ üòÑ ) However, this would be more complex for developers to use, and arguably, there are not that many things that can be customized in Temporal's Webpack build process without risking breaking things.

#### Comments (10)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-08 01:34:49.000 UTC</summary>

Thanks for the detailed summary @mjameswh.

Have you tried any of the workarounds you've suggested successfully?
Seems like, as you're suggesting, `resolve.alias` and `resolve.fallback` would address this issue.

Up until now we've purposefully hidden any advanced webpack options because we consider webpack to be an implementation detail, for example, I know some user on our slack channel replaced webpack with esbuild and got dramatically faster builds.
I do understand that there are some advanced users that would like the extra power so we'd have to discuss how best to exposed this functionality.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-08 02:37:07.000 UTC</summary>

Haven't started implementing any of this yet, though I have done something very similar to my second proposition on another project.

I'm highly confident that both propositions 2 and 3 can solve the issue we have right now. I just wanted to see first which (if any) would make sense to your team. I agree that this is somewhat lower level matters and I know that you want to avoid exposing developers to implementation details. That's exactly why I'm hesitating. But I also think that this issue will hurt more and more people as the typescript SDK get used in larger and larger projects, and that, in the end, developers might be exposed to even more complicated issues if there is no practical solution to this. 

Arguably, the `ignoreModules` approach would not be that much of an implementation detail... I think the very same option could also work in a esbuild bundling process (either using `--external` or an `onLoad` plugin). On a side note, I have to admit that I would be very interested in an esbuild bundler; our application have quite a few workflows already, and were planing to have many times more. I expect that bundling workflows could represent a significant time by the end of the project. I may give it a shot later on, but can't do this right now.

If that's good for you, I'll try to have something along the line of proposition number 2 tomorrow.

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-03-08 02:39:05.000 UTC</summary>

and you probably already saw this but just in case you havent, you can bundle code yourself and just specify `workflowBundle`: https://docs.temporal.io/docs/typescript/production-deploy#pre-build-code

should serve as a temporary fix while we try to figure out a better solution to our default bundling.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-08 02:42:25.000 UTC</summary>

@sw-yx Yes I know. But using `bundleWorkflowCode(...)` won't help since the webpack's config is an internal detail of `WorkflowCodeBundler`. One alternative would be make a custom bundler (eg. a copy of the original bundler, with private modifications), but then, shouldn't I share my contribution with others? üòâ 

Actually, I was going to say to that I would add customization options only on the `bundleWorkflowCode()`/`BundleOptions` interface... That is, I think the `Worker.create(...)` function should _not_ include such feature, so most users would not even be exposed to this.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-08 03:40:39.000 UTC</summary>

Thanks James, I really appreciate the clarity and thoroughness of your issues & PRs üòäüôè

Personally in favor of the bundler-agnostic `ignoreModules`, although would like something more automatic / better DX, like ignoring all built-in Node modules by default. Issue with that is I'm not sure how to make clear what's happening when errors are thrown from the ignored modules actually being used (like `dns.resolve()` being run)? I guess we could replace `dns` with a file that had all the same exports but threw an informative error. But that only covers functions. Wonder if default-exporting a Proxy that errored on access to all properties would work? üòÑ

If we can't make that clear, then I think it would be nice if, instead of or in addition to this being logged:

`Module not found: Error: Can't resolve 'dns' in`

, we logged: 

```
Your Workflow code (or a library used by your Workflow code) is importing `dns`, a built-in Node module. Workflow code don't have access to built-in Node modules (in order to help enforce determinism). If your code just imports `dns` and doesn't use what it imports, you can add it to `BundleOptions.ignoreModules`. If your code uses what it imports, then you need to change the code or remove the library.

https://typescript.temporal.io/api/namespaces/worker/#bundleworkflowcode
```

>  I have to admit that I would be very interested in an esbuild bundler

Yay üòÉüíÉ

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-08 03:56:06.000 UTC</summary>

> I guess we could replace `dns` with a file that had all the same exports but threw an informative error. But that only covers functions. Wonder if default-exporting a Proxy that errored on access to all properties would work? üòÑ

Well... I don't think it would be that hard... Technically, we could add a stub module in modules-overrides that does exactly that, and then alias every node-internal packages to the path of that module. But I doubt this would really give the usability we're hopping for.

```
Your Workflow code (or a library used by your Workflow code) is importing `dns`, a built-in Node module. Workflow code don't have access to built-in Node modules (in order to help enforce determinism). If your code just imports `dns` and doesn't use what it imports, you can add it to `BundleOptions.ignoreModules`. If your code uses what it imports, then you need to change the code or remove the library.

https://typescript.temporal.io/api/namespaces/worker/#bundleworkflowcode
```

Now, that sounds like a great idea... IIRC, `resolve.fallback` can be a function, which is called with the name of the module being requested... I'll give it a try.

Still, let's not forget that it won't help with dependencies that contains native code...

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-08 15:09:10.000 UTC</summary>

After some research, I don't think it is desirable to ignore all Node built-in modules by default.

A few modules pose actually no issue at all (`util`, `punycode`, `path/posix`, `path/win32`, `buffer`...), or are very unlikely to pose actual issue in real life (`path` would pose an issue only if replaying a workflow on a different platform). For many others modules, only some functions are problematic, while other functions of the same package are not problematic AND could be arguably useful in workflows for some use cases; eg. `crypto` is likely to be non-deterministic when cyphering data (which might implies using a secure RNG), but should be deterministic in most other situations (including deciphering and validating hashes...)

I think we should allow node built-in modules, but report a warning indicating the list of found modules dependencies that are known to be potential issues. More over, that list could grow over time to include known popular external libraries that also pose issues (eg. native code) and/or that are probable marker of issues in how the workflow is designed (eg. `@temporalio/client`, `mysql`, `aws-sdk`, `axios`...).

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-09 01:37:51.000 UTC</summary>

We will not allow node built-ins because we eventually want to support running untrusted workflow code.
That being said, we can allow injection of some of these node built-ins for users that don't want that feature.

There's more thought to be put in here though.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-09 05:13:07.000 UTC</summary>

> We will not allow node built-ins because we eventually want to support running untrusted workflow code.

I totally agree.

Actually, forget about my previous comment, it was based on an incorrect understanding of my part.... I originally thought that `require` and node built-ins were accessible inside isolated environments, and that only a Webpack misconfiguration was preventing it from working. So my earlier argument was essentially that Webpack should not add _artificial_ restrictions, as this reduced usability without improving security and determinism (eg. one could do `eval('require(...)')` inside a workflow to work around a Webpack-level restriction). I backtracked on my previous opinion once I realized I had this fact wrong.
 
>That being said, we can allow injection of some of these node built-ins for users that don't want that feature.
>
>There's more thought to be put in here though.

I think there is a potential need here, but that's more hypothetical at this point. I can imagine that, at some point, one may report something like: "Can't bundle my workflow because it _legitimately_ needs access to the `foo` module". Think for example custom data converter that provides data encryption, using the `crypto` built-in module (haven't checked that, but I assume that custom data converters are loaded inside the workflows isolated environment...).

Still, there are very few node built-in modules that are likely to be used in such scenarios. `assert` is one of them, and it has already been handled using a stub module  [`assert` module](https://github.com/temporalio/sdk-typescript/blob/82351ccc69a5d3876e5b44d4860c20ec71cfca28/packages/worker/src/workflow/module-overrides/assert.ts). That seems like the way to go for such cases.

But that would be distinct issues...

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-12 21:59:50.000 UTC</summary>

> I think there is a potential need here, but that's more hypothetical at this point. I can imagine that, at some point, one may report something like: "Can't bundle my workflow because it legitimately needs access to the foo module". Think for example custom data converter that provides data encryption, using the crypto built-in module (haven't checked that, but I assume that custom data converters are loaded inside the workflows isolated environment...).

So far I haven't seen a legitimate request to access node built-ins, we can offer that if needed.
As for custom data converters, encryption and compression should be done in `PayloadCodec`s which are run outside of the sandbox.

</details>


---

<a id="254"></a>

### #254: [Feature Request] Better crash message than [TransportError: transport error] when docker-compose not running

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/254 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-09-20 17:39:20.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-12 16:14:16.000 UTC |
| **Closed** | 2021-10-12 16:14:16.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 4 |
| **Priority Score** | 10 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 |

#### Description

### Is your feature request related to a problem? Please describe.

if you init a new project and run it with no local temporal instance running:

```bash
npx @temporalio/create@latest ./example
cd example
npm run start.watch
```

you get this:

```bash


> example@0.1.0 start.watch
> nodemon src/worker.ts

[nodemon] 2.0.12
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): src/**/*
[nodemon] watching extensions: ts
[nodemon] starting `ts-node src/worker.ts`
[TransportError: transport error]
[nodemon] app crashed - waiting for file changes before starting...
^C
```


### Describe the solution you'd like

a nicer explainer than "TransportError".


#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-22 16:58:55.000 UTC</summary>

@Sushisource can this be done in Core?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-09-22 17:09:50.000 UTC</summary>

If it's coming from core, yeah we can try to detect and provide a slightly nicer error message. It's not clear to me that this one is? If that error was from core it should have `[temporal_sdk_core::xxx]` type thing in front of it. I know sometimes it can come from core, but I think that might be from node

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-27 11:27:09.000 UTC</summary>

It's coming from Core, when creating a new Core instance it connects to the server and the error is propagated back to lang and logged using `console.error`.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 16:14:16.000 UTC</summary>

Not relevant anymore since we will log a warning and retry when Core cannot connect (#290)

</details>


---

<a id="1790"></a>

### #1790: [Bug] Replay workflow history fails with nondeterminism error, child workflow ids do not match

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1790 |
| **State** | OPEN |
| **Author** | mishabruml (Misha Bruml) |
| **Created** | 2025-09-26 13:36:06.000 UTC (3 months ago) |
| **Updated** | 2025-12-08 18:13:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 9 |
| **Priority Score** | 9 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Related: #1582 

### What are you really trying to do?

I am trying to write a "workflow history compatibiltiy test" using `Worker.runReplayHistory`, so it can be run in CI to protect our team against accidentally introducing non-deterministic changes into our workflows.

### Describe the bug

I am grabbing workflow history from a recent successful workflow run, pasting it as a JSON blob, and running a test like this: 

```typescript
import { Worker } from '@temporalio/worker';
import workflowHistory from './workflow-history.json';

describe('Workflow history compatibility', () => {
  test('Workflow history is compatible', async () => {
    await Worker.runReplayHistory(
      {
        workflowsPath: require.resolve('../workflow.ts'),
      },
      workflowHistory
    );
  });
});
```

The workflow contains several child workflows, for example:

```typescript
  const child = executeChild(ChildWorkflow, {
    args: [childBody],
    taskQueue: QueueConfig.ChildWorkflow,
  });
```

When I run the test (locally), I get the following error:

```
DeterminismViolationError: Replay failed with a nondeterminism error. This means that the workflow code as written is not compatible with the history that was fed in. Details: Workflow activation completion failed: Failure { failure: Some(Failure { message: "[TMPRL1100] Nondeterminism error: Child workflow id of scheduled event '83ade076-5748-4685-b311-39985365e54c' does not match child workflow id of command '01324793-0653-4b87-ba22-639e2eaffe97'", source: "", stack_trace: "", encoded_attributes: None, cause: None, failure_info: Some(ApplicationFailureInfo(ApplicationFailureInfo { r#type: "", non_retryable: false, details: None, next_retry_delay: None, category: Unspecified })) }), force_cause: NonDeterministicError }
```

I have also tried modifying the workflow so that the child workflow executions start like this: 

```typescript
  import { uuid4 } from '@temporalio/workflow';

  const child = executeChild(ChildWorkflow, {
    args: [childBody],
    taskQueue: QueueConfig.ChildWorkflow,
    workflowId: uuid4(),
  });
```

And ran the workflow succesfully, grabbed the history from this run, and dropped that into my test- same outcome.

This seems like a bug, the child workflowId should not affect the determinism of the workflow run.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. Apple M2 Pro, Sequoia 5.6.1 (24G90)]
- Temporal Version: 
```json
    "@temporalio/activity": "^1.11.1",
    "@temporalio/client": "^1.11.3",
    "@temporalio/common": "^1.11.2",
    "@temporalio/interceptors-opentelemetry": "^1.11.7",
    "@temporalio/nyc-test-coverage": "^1.11.2",
    "@temporalio/worker": "^1.11.1",
    "@temporalio/workflow": "^1.11.1",
```
 
- Are you using Docker or Kubernetes or building Temporal from source? Docker


#### Comments (9)

<details>
<summary><strong>mjameswh</strong> commented on 2025-10-06 16:37:18.000 UTC</summary>

> ```
>     "@temporalio/activity": "^1.11.1",
>     "@temporalio/client": "^1.11.3",
>     "@temporalio/common": "^1.11.2",
>     "@temporalio/interceptors-opentelemetry": "^1.11.7",
>     "@temporalio/nyc-test-coverage": "^1.11.2",
>     "@temporalio/worker": "^1.11.1",
>     "@temporalio/workflow": "^1.11.1",
> ```

Those would be version numbers as they are declared in your package.json, but not necessarily what's actually installed. Can you print the _installed_ version numbers of those dependencies? You should be able to get them using `npm ls`.

Mixing packages of different versions of `@temporalio/*` packages is not supported, not even at the patch level. Our packages have exact dependencies to other packages to avoid such incoherencies. So in practice, I expect that all of these packages will have actually been installed at 1.11.7 (or 1.11.3 if using an older version of NPM that didn't support peer dependencies).

</details>

<details>
<summary><strong>mishabruml</strong> commented on 2025-10-07 09:04:15.000 UTC</summary>

thanks, it appears to be 1.13.0

we're on yarn 4.9.2, node 22.18.0 (npm 10.9.3)
```
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/activity@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/client@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/common@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/interceptors-opentelemetry@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/nyc-test-coverage@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/testing@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/worker@1.13.0
‚îÇ ‚îú‚îÄ‚îÄ @temporalio/workflow@1.13.0
```

</details>

<details>
<summary><strong>mishabruml</strong> commented on 2025-10-23 12:42:58.000 UTC</summary>

hi sorry @mjameswh any update on this? üôè 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-10-23 15:10:36.000 UTC</summary>

Given that you are using the OpenTelemetry Interceptors, I suppose you are hitting the issue described in #1677. We are working on a fix for that bug.

To confirm, how is your workflow getting started? e.g. are you using signal-with-start or update-with-start? And from where are you starting child workflows? e.g. directly from your workflow function, from signal/update handler, or both?

</details>

<details>
<summary><strong>mishabruml</strong> commented on 2025-10-23 15:56:45.000 UTC</summary>

We're starting workflows with `client.workflow.start()` and we're starting child workflows directly from the workflow function using `startChild`/`executeChild`

Thanks for the hint, I'll look into #1677 üëÄ 

</details>

<details>
<summary><strong>jamipouchi</strong> commented on 2025-11-27 15:31:02.000 UTC</summary>

Same thing is happening to us. We have 2 workflows that failed 
[TMPRL1100] Nondeterminism error: Child workflow id of scheduled event 'f378473c-2231-4ed6-ae2f-9d7effa1ab67' does not match child workflow id of command '2a14255c-0888-4964-adc8-b39ef7edf225'

We are also starting workflows with `client.workflow.start()`, and also starting child workflows directly using `executeChild`.
Have created a ticket: https://support.temporal.io/?tab=issues&durationMs=31536000000&conversationID=ea0ee5ee-aa1f-4914-a122-929ba0be5a56




</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-12-01 16:45:17.000 UTC</summary>

Which version of the Temporal SDK are you using?

If not already, can you give a try usig v1.13.2? It's fixing issue #1677, which is a very likely explanation for this bug.

</details>

<details>
<summary><strong>jamipouchi</strong> commented on 2025-12-01 17:02:57.000 UTC</summary>

Using `v1.13.2` already.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-12-08 18:13:12.000 UTC</summary>

@jamipouchi Given new information I just received privately, I'm pretty sure you're hitting this issue: #1744. There's work in progress on resolving that bug.

Reactions: üëç 1

</details>


---

<a id="1352"></a>

### #1352: [Feature Request] Support Pino as a logging framework with Runtime.install

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1352 |
| **State** | CLOSED |
| **Author** | paymog (Paymahn Moghadasian) |
| **Created** | 2024-02-07 10:55:21.000 UTC (1y 11m ago) |
| **Updated** | 2024-02-23 15:44:26.000 UTC |
| **Closed** | 2024-02-19 18:47:06.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 5 |
| **Priority Score** | 9 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

Support Pino as a logging framework with `Runtime.install`

### Describe the solution you'd like

Currently, the `Logger` interface is Winston-like. This makes it difficult for teams that use Pino to have a familiar interface when doing workflow AND activity logging. Right now we're forced to either

1. use `LoggerSinks` (which seem to be deprecated) for Pino workflow logging
2. use winston-style logging in workflows and pino style logging in activities

### Additional context

I've done quite a bit of hacking to get Pino logging for workflows working. Here's what I've done (reduced a bit to make it more legible)

```typescript
export interface PinoLoggerSink extends Sinks {
  logger: {
    fatal(objOrMessage: object | string, msg?: string): void;
    error(objOrMessage: object | string, msg?: string): void;
    warn(objOrMessage: object | string, msg?: string): void;
    info(objOrMessage: object | string, msg?: string): void;
    debug(objOrMessage: object | string, msg?: string): void;
    trace(objOrMessage: object | string, msg?: string): void;
  };
}

export type LoggerSinks = PinoLoggerSink;

  const loggerOptions: LoggerOptions = {
    base: { pid: process.pid },
    formatters: {
      level: (label) => {
        return { level: label };
      },
    },
  };

  if (!IS_PRODUCTION) {
    loggerOptions.transport = {
      target: "pino-pretty",
      options: {
        translateTime: "HH:MM:ss Z",
        ignore: "pid,hostname",
      },
    };
  }

  const baseLogger = pino(loggerOptions);
  const activityLogger = baseLogger.child({ name: "activity" });
  const workflowPinoLogger = baseLogger.child({ name: "workflow" });

  const injectedWorkflowLoggerSink: InjectedSinks<LoggerSinks> = {
    logger: {
      fatal: {
        fn(workflowInfo, objOrMessage, message) {
          if (typeof objOrMessage === "string") {
            workflowPinoLogger.fatal({ ...workflowInfo }, objOrMessage);
          } else {
            workflowPinoLogger.fatal(
              { ...workflowInfo, ...objOrMessage },
              message
            );
          }
        },
        callDuringReplay: false,
      },
      error: {
        fn(workflowInfo, objOrMessage, message) {
          if (typeof objOrMessage === "string") {
            workflowPinoLogger.error({ ...workflowInfo }, objOrMessage);
          } else {
            workflowPinoLogger.error(
              { ...workflowInfo, ...objOrMessage },
              message
            );
          }
        },
        callDuringReplay: false,
      },
      warn: {
        fn(workflowInfo, objOrMessage, message) {
          if (typeof objOrMessage === "string") {
            workflowPinoLogger.warn({ ...workflowInfo }, objOrMessage);
          } else {
            workflowPinoLogger.warn(
              { ...workflowInfo, ...objOrMessage },
              message
            );
          }
        },
        callDuringReplay: false,
      },
      info: {
        fn(workflowInfo, objOrMessage, message) {
          if (typeof objOrMessage === "string") {
            workflowPinoLogger.info({ ...workflowInfo }, objOrMessage);
          } else {
            workflowPinoLogger.info(
              { ...workflowInfo, ...objOrMessage },
              message
            );
          }
        },
        callDuringReplay: false,
      },
      debug: {
        fn(workflowInfo, objOrMessage, message) {
          if (typeof objOrMessage === "string") {
            workflowPinoLogger.debug({ ...workflowInfo }, objOrMessage);
          } else {
            workflowPinoLogger.debug(
              { ...workflowInfo, ...objOrMessage },
              message
            );
          }
        },
        callDuringReplay: false,
      },
      trace: {
        fn(workflowInfo, objOrMessage, message) {
          if (typeof objOrMessage === "string") {
            workflowPinoLogger.trace({ ...workflowInfo }, objOrMessage);
          } else {
            workflowPinoLogger.trace(
              { ...workflowInfo, ...objOrMessage },
              message
            );
          }
        },
        callDuringReplay: false,
      },
    },
  };

  const runtimeOptions: RuntimeOptions = {
    logger: {
      log<Level extends string = LogLevel>(
        level: Level,
        message: string,
        meta?: LogMetadata
      ) {
        switch (level) {
          case "TRACE":
            baseLogger.trace(meta, message);
            break;
          case "DEBUG":
            baseLogger.debug(meta, message);
            break;
          case "INFO":
            baseLogger.info(meta, message);
            break;
          case "WARN":
            baseLogger.warn(meta, message);
            break;
          case "ERROR":
            baseLogger.error(meta, message);
            break;
          default:
            throw new Error(`Unknown log level: ${level}`);
        }
      },
      trace(message: string, meta?: LogMetadata) {
        baseLogger.trace(meta, message);
      },
      debug(message: string, meta?: LogMetadata) {
        baseLogger.debug(meta, message);
      },
      info(message: string, meta?: LogMetadata) {
        baseLogger.info(meta, message);
      },
      warn(message: string, meta?: LogMetadata) {
        baseLogger.warn(meta, message);
      },
      error(message: string, meta?: LogMetadata) {
        baseLogger.error(meta, message);
      },
    },
    telemetryOptions: {
      logging: {
        forward: {},
      },
    },
  };

  if (IS_PRODUCTION) {
    runtimeOptions.telemetryOptions = {
      ...runtimeOptions.telemetryOptions,
      metrics: {
        prometheus: {
          bindAddress: `0.0.0.0:${PROMETHEUS_PORT}`,
        },
      },
    };
  }

  Runtime.install(runtimeOptions);

  const worker = await Worker.create({
    interceptors: appendDefaultInterceptors({
      activityInbound: [
        (ctx) => new ActivityInboundLogInterceptor(ctx, activityLogger),
      ],
    }),
    sinks: injectedWorkflowLoggerSink,
    shutdownGraceTime: SHUTDOWN_GRACE_TIME,
  });
```

#### Comments (5)

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-07 15:54:56.000 UTC</summary>

IIUC, there's four distinct requests here:

1. Allow for Pino-style logging API in Workflow context;
2. Allow for Pino-style logging API in Activity context;
3. Make it easy to pass a Pino-style logger to `Runtime.install`;
4. Add annotations on log messages to determine where they come from (e.g. `name: activity` or `name: workflow`).

@paymog Anything missing?

</details>

<details>
<summary><strong>paymog</strong> commented on 2024-02-08 09:03:16.000 UTC</summary>

I guess so? I'm still wrapping my head around how logging works in temporal. My understanding is that if `Runtime.install` supported Pino style logging (item 3) then items 1, 2, and 4 would naturally fall into place because of how the Runtime logger is accessed in workflows and activities. 

If `Runtime.install` doesn't work for both Workflows and Activities then yes, items 1, 2, and 3 are all separate. Item 4 is super low priority in my opinion because Pino supports child loggers and because the "location" of the log (workflow vs activity) can be inferred from the other metadata/context on the log that gets injected by the worker.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-19 18:09:32.000 UTC</summary>

Let me first respond to the feature request.

We discussed this with the team, and we strongly feel that the SDK itself must remain logger-framework agnostic. I can see how the SDK's `Logger` interface seems to adhere to Winston's style (same way of naming log levels functions, same order of arguments), but this is pretty much coincidental and only true at a shallow level (e.g. there is no actual import or dependency on Winston; only the simplest call signature is supported; no support for many winston-specific log levels; etc).

The SDK already provides a way to funnel all log messages emitted from Workflow code, Activity code, by the SDK itself and by the underlying Core SDK, through a single upstream logger (i.e. `Runtime.logger`). Relaying log messages emitted by any of these subsystems through a specific logging library simply require registration of a log adaptor on `Runtime.logger`. Note that even connecting to a Winston upstream logger requires such an adaptor. There's little we can do in the SDK itself to make this part easier while remaining log-framework agnostic.

Regarding the logger interface exposed to activities and workflows, again, there's not that much we can do within the SDK itself to simplify usage of alternate logging APIs. It is simply not possible to expose the logger object directly to workflow code, due to the fact that workflows executes in a sandboxed environment and on a different worker thread. As for exposing your custom logger object directly to activity code, this would technically be possible (actually, it is, already), but then it would be impossible for the SDK to automatically inject contextual metadata on log messages and to automatically emit lifecycle tracing messages. I can't see how that would be an improvement.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-19 18:46:52.000 UTC</summary>

Regarding the code you shared on how you connected to Pino, it could have been much simpler.

Here are a few specific things you could have done differently:
- There was no need to register a custom logger sink; instead, you could simply create an adaptor class that exposes Pino-style log methods, but internally transmit these using the existing Logger's signature.
- This very same adaptor could be used to provide Pino-style logger API in activity code, obliterating the need to register an `ActivityInboundLogInterceptor` (by the way, both `ActivityInboundLogInterceptor` and `appendDefaultInterceptors` are deprecated since 1.9.0).
- To support the `fatal` log level, or any other custom level, the ingress adaptor could copy the log level name to a metadata field; then, the outgress adaptor could look for that field, and if present, call the corresponding log functions on your upstream Pino logger.
- To implement your egress adaptor on `Runtime.logger`, you could have used the SDK provided `DefaultLogger` class, and then, only provide the generic `log` function.

I will try to come up with a sample for this.

</details>

<details>
<summary><strong>paymog</strong> commented on 2024-02-23 15:44:25.000 UTC</summary>

> must remain logger-framework agnostic

Totally agree!

> but this is pretty much coincidental and only true at a shallow level

Gotcha

> there's not that much we can do within the SDK itself to simplify usage of alternate logging APIs

hmm, can you make two interfaces and use a type union for the base logger?

> I will try to come up with a sample for this.

I would love that, thank you!

</details>


---

<a id="1172"></a>

### #1172: [Feature Request] Sentry integration

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1172 |
| **State** | CLOSED |
| **Author** | hwang251 (Hank Hwang) |
| **Created** | 2023-07-13 16:40:34.000 UTC (2y 6m ago) |
| **Updated** | 2025-02-04 18:29:32.000 UTC |
| **Closed** | 2025-02-04 18:29:31.000 UTC |
| **Upvotes** | 4 |
| **Comments** | 1 |
| **Priority Score** | 9 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 4 |

#### Description

### Is your feature request related to a problem? Please describe.

Currently there is no out of the box Sentry support. To log errors to Sentry in activities, an `ActivityInboundCallsInterceptor` needs to be implemented.

### Describe the solution you'd like

Some type of integration that allows us to easily add Sentry support

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-02-04 18:29:31.000 UTC</summary>

We have no plan to add out-of-the-box support for Sentry in the foreseeable future, and users can easily do that themselves by registering a custom logger.

</details>


---

<a id="1149"></a>

### #1149: [Support] How to cache data between different interceptors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1149 |
| **State** | CLOSED |
| **Author** | YufeeXing (Mason Xing) |
| **Created** | 2023-06-27 08:48:47.000 UTC (2y 6m ago) |
| **Updated** | 2023-06-30 07:42:01.000 UTC |
| **Closed** | 2023-06-27 16:34:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 9 |
| **Priority Score** | 9 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

The situation is: We want to authenticate the values in the grpc header. The local activity is used here in the interceptor to get env variables like authentication URL and send the values in the header to the URL to authenticate. 
But how to cache these user headers if there are more than one interceptors and we want to get the cache in other interceptors. Like something in Java is thread local storage.

#### Comments (9)

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-27 08:52:19.000 UTC</summary>

In summary, Is there any way to store data in workflow execution context when excuting a activity? Then the data can be used in different child workflows, activities.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-27 16:18:06.000 UTC</summary>

You can store data either in the global scope, which is *not* shared between workflow instances. Or using the workflow's `AsyncLocalStorage`, or just in the closure where you instantiate the interceptors.
Note that you should avoid storing sensitive information in the persisted Temporal headers (the ones used in interceptors, not to be confused with grpc or http headers) as they are not encrypted by default (yet).

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-27 16:34:46.000 UTC</summary>

Here's how we use AsyncLocalStorage for implementing the opentelemetry interceptors: https://github.com/temporalio/sdk-typescript/blob/aec754c1d81520752d0c86d6a025348835c77959/packages/interceptors-opentelemetry/src/workflow/context-manager.ts#L2

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-28 09:59:47.000 UTC</summary>

> Here's how we use AsyncLocalStorage for implementing the opentelemetry interceptors:
> 
> https://github.com/temporalio/sdk-typescript/blob/aec754c1d81520752d0c86d6a025348835c77959/packages/interceptors-opentelemetry/src/workflow/context-manager.ts#L2

Thanks for your help, @bergundy. Your reply is very helpful.
I am using https://www.npmjs.com/package/continuation-local-storage to act as a storage like AsyncLocalStorage.
Hope this can work, too.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-29 01:27:06.000 UTC</summary>

continuation-local-storage is outdated so I would not use it at all and in any case it will not work from the workflow context.

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-29 03:27:38.000 UTC</summary>

> continuation-local-storage is outdated so I would not use it at all and in any case it will not work from the workflow context.

I copied the context-manager.ts and export a new ContextManager() to get a instance
`export default new ContextManager();`
But got a strange error:
![image](https://github.com/temporalio/sdk-typescript/assets/42690790/fd662bc5-8c7a-4564-ab43-2869564d8b4d)



</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-29 05:46:47.000 UTC</summary>

Can you post a full reproduction?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-29 05:47:21.000 UTC</summary>

Are you using this in workflow context?

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-30 07:40:03.000 UTC</summary>

> Are you using this in workflow context?

Yes, @bergundy.  In workflow context. I used it like this:
1. Just copy the context-manager.ts, but export a default instance of it
```
import * as otel from '@opentelemetry/api';
import { AsyncLocalStorage } from '@temporalio/workflow';

export class ContextManager implements otel.ContextManager {
  protected storage = new AsyncLocalStorage<otel.Context>();

  active(): otel.Context {
    return this.storage.getStore() || otel.ROOT_CONTEXT;
  }

  bind<T>(context: otel.Context, target: T): T {
    if (typeof target !== 'function') {
      throw new TypeError(`Only function binding is supported, got ${typeof target}`);
    }

    // Stolen from https://github.com/open-telemetry/opentelemetry-js/blob/main/packages/opentelemetry-context-async-hooks/src/AbstractAsyncHooksContextManager.ts
    const contextWrapper = (...args: unknown[]) => {
      return this.with(context, () => target.apply(this, args));
    };
    Object.defineProperty(contextWrapper, 'length', {
      enumerable: false,
      configurable: true,
      writable: false,
      value: target.length,
    });
    /**
     * It isn't possible to tell Typescript that contextWrapper is the same as T
     * so we forced to cast as any here.
     */
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    return contextWrapper as any;
  }

  enable(): this {
    return this;
  }

  disable(): this {
    this.storage.disable();
    return this;
  }

  with<A extends unknown[], F extends (...args: A) => ReturnType<F>>(
    context: otel.Context,
    fn: F,
    thisArg?: ThisParameterType<F>,
    ...args: A
  ): ReturnType<F> {
    const cb = thisArg == null ? fn : fn.bind(thisArg);
    return this.storage.run(context, cb, ...args);
  }
}
export default new ContextManager()
```

Then in a workflow activity file, the instance was imported and used like this:
```
import contextmanager from './contextmanager';

async function _activity1(headers: Headers): Promise<string> {
}

async function _activity2(headers: Headers): Promise<string> {
}

const localContext = contextmanager.active() || {};
const activity1= contextmanager.bind(localContext, _activity1);
const activity2 = contextmanager.bind(localContext, _activity2);

export { activity1, activity2 }
```
Then got the error.

</details>


---

<a id="1013"></a>

### #1013: [Bug] ScheduleClient.list() fails to return any schedules

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1013 |
| **State** | CLOSED |
| **Author** | Quinn-With-Two-Ns (Quinn Klassen) |
| **Created** | 2023-01-04 18:31:16.000 UTC (3 years ago) |
| **Updated** | 2023-01-25 21:51:12.000 UTC |
| **Closed** | 2023-01-25 21:51:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 9 |
| **Priority Score** | 9 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### What are you really trying to do?

List schedules with the `ScheduleClient.list()` API

### Describe the bug

No schedules are returned when I can verify there are schedules through `tctl`, the UI and go-sdk.

### Minimal Reproduction

See the `basic` typescript test here https://github.com/temporalio/sdk-features/pull/192

### Environment/Versions


- OS and processor:M1 Mac
- Temporal Version: tried temporalite 1.17 and 1.19
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (9)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-04 21:23:20.000 UTC</summary>

Is there any chance that the spec is falsy in those schedules?

https://github.com/temporalio/sdk-typescript/blob/f16d1dac5176c3a695e3332de0b420bad07bbf5b/packages/client/src/schedule-client.ts#L373

</details>

<details>
<summary><strong>igorsechyn</strong> commented on 2023-01-20 07:44:07.000 UTC</summary>

I am hitting the same issue in our setup. What I noticed is that `workflowService.listSchedules` does not always return the full response. In most cases it just returns an array of schedule ids and thats it. However sometimes i saw responses containing the full information.

This is how I create schedules 
```
await temporalClient.schedule.create({
        scheduleId,
        action: {
          taskQueue: Config.TEMPORAL_TASK_QUEUE,
          type: "startWorkflow",
          workflowType: workflow,
          args: [anonymousWorkflowContext],
          workflowId: workflow,
        },
        spec: {
          cronExpressions: [cronConfig.schedule],
        },
        policies: {
          overlap: ScheduleOverlapPolicy.SKIP,
        },
      });
```

So the spec should not be falsy

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-20 19:48:06.000 UTC</summary>

@igorsechyn The schedules list response is eventually consistent, you may have to wait for your schedule to appear in the response.

</details>

<details>
<summary><strong>Quinn-With-Two-Ns</strong> commented on 2023-01-20 20:06:43.000 UTC</summary>

@bergundy the schedule spec is not falsy.  The issue I saw only happens in the typescript sdk not the go sdk.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-20 20:17:10.000 UTC</summary>

>The issue I saw only happens in the typescript sdk not the go sdk.

@igorsechyn is reporting this issue using raw GRPC calls... The SDK is essentially not involved there. I personally think this is an eventual consistency issue, but then... how come we never observe this using the Go SDK?!?

</details>

<details>
<summary><strong>igorsechyn</strong> commented on 2023-01-23 05:13:14.000 UTC</summary>

> The schedules list response is eventually consistent, you may have to wait for your schedule to appear in the response.

I dont think this is the case. Our use case:
- on app startup we check, if there are any cron jobs we need to run, if there are we create temporal schedule objects. 
- if we remove a cron from our codebase, we also want to delete corresponding schedule in temporal, so on each startup we fetch the list of schedules

I have been testing it locally and although schedules were running for some time now, on app restart we only get a list with schedule's id, i.e. when using `workspaceService`. So it's not that we do not see any schedules, we see them, but the response only contains an id. This is what i see in response from `workspaceService`

```
[{
  "scheduleId": "my-schedule-id"
}]
```

I think thats the reason, why the schedule client returns an empty array, cause the workflowService does not return any spec. 

More details:
- sdk version: 1.5.2
- temporal version: 1.18.3



</details>

<details>
<summary><strong>igorsechyn</strong> commented on 2023-01-23 07:52:58.000 UTC</summary>

Just tested again, and after a schedule running for multiple hours querying the list on our app restart, temporal still returns just schedule ids.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-24 21:49:49.000 UTC</summary>

@igorsechyn Which "deployment type" of Temporal server are you using exactly (ie. Docker, temporalite, temporal-cli, etc) and which persistence backends?

</details>

<details>
<summary><strong>igorsechyn</strong> commented on 2023-01-25 07:36:50.000 UTC</summary>

> @igorsechyn Which "deployment type" of Temporal server are you using exactly (ie. Docker, temporalite, temporal-cli, etc) and which persistence backends?

We are running temporal on kubernetes using docker images. We currently use postgres as a persistence backend.

</details>


---

<a id="849"></a>

### #849: [Feature Request] Get workflow info / activity context in PayloadCodec

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/849 |
| **State** | CLOSED |
| **Author** | klesniewski (Kris) |
| **Created** | 2022-08-24 13:49:46.000 UTC (3y 4m ago) |
| **Updated** | 2025-05-30 07:38:14.000 UTC |
| **Closed** | 2025-05-30 07:38:00.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 7 |
| **Priority Score** | 9 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

We have a codec that makes calls to an external service. As such, for various reasons encoding/decoding could fail. This will be retried and hopefully eventually works. However, we would like to see that failure in workflow/activity execution logs. This means we would like to attach for example `workflowId` to our logs, so that when we search for logs of particular workflow, we get to see these log messages.

Unfortunately, I didn't find a way to get this information in codecs. I could only make it work when decoding (but not encoding) for an activity, as then (and only then) `Context.current()` works.

We have this working in Go SDK through context-aware data converters, but I didn't find a way to make it work in TypeScript SDK.

### Describe the solution you'd like

A way to access the activity/workflow execution metadata, so it can be added to logs. Information like:
- workflowType
- workflowId
- runId
- activityType
- activityId
- attempt

### Additional context

TS SDK version: 1.0.1


#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-24 14:03:34.000 UTC</summary>

As a temporary solution, you can pass that context in the payload metadata from a PayloadConverter and read it (and delete it) in your PayloadCodec.

I hope we can get to this issue soon.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-27 16:26:56.000 UTC</summary>

There's somewhat of a chicken-or-egg problem here. `WorkflowInfo` and `ActivityContext` both contains some fields that needs decoding/encoding. It would not makes sense therefore to make these objects directly accessible to the PayloadCodec.

Providing trimmed down context object, specific to PayloadCodec would however be reasonable. It may also be useful to include request headers there. And a logger.

</details>

<details>
<summary><strong>pzerelles</strong> commented on 2024-05-06 15:29:10.000 UTC</summary>

> As a temporary solution, you can pass that context in the payload metadata from a PayloadConverter and read it (and delete it) in your PayloadCodec.
> 
> I hope we can get to this issue soon.

How exactly is this possible with the Typescript SDK?

</details>

<details>
<summary><strong>pzerelles</strong> commented on 2024-05-06 15:30:10.000 UTC</summary>

> There's somewhat of a chicken-or-egg problem here. `WorkflowInfo` and `ActivityContext` both contains some fields that needs decoding/encoding. It would not makes sense therefore to make these objects directly accessible to the PayloadCodec.
> 
> Providing trimmed down context object, specific to PayloadCodec would however be reasonable. It may also be useful to include request headers there. And a logger.

Is there a plan when this will be available? I need to pass tenant specific context from a workflow to a PayloadCodec.

</details>

<details>
<summary><strong>jroof88</strong> commented on 2024-08-08 18:08:47.000 UTC</summary>

üëã Hi just checking in here...is this something that is being considered? I'd love to have this in the Go SDK and be able to use `workflow.Context` in my `PayloadCodec`

Reactions: üëç 1

</details>

<details>
<summary><strong>raymondregrello</strong> commented on 2025-05-13 05:11:06.000 UTC</summary>

Possibly a dupe of https://github.com/temporalio/sdk-typescript/issues/1661?



Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-30 07:38:00.000 UTC</summary>

Indeed, @raymondregrello. Thanks for pointing this out!

Closing in favor of the recently opened, cross SDK ticket.

</details>


---

<a id="754"></a>

### #754: [Feature Request] Add friendly version of listWorkflowExecutions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/754 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-12 20:12:50.000 UTC (3y 6m ago) |
| **Updated** | 2023-01-25 05:45:54.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 7 |
| **Priority Score** | 9 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

Current: https://typescript.temporal.io/api/interfaces/proto.temporal.api.workflowservice.v1.ilistworkflowexecutionsrequest/#nextpagetoken

Proposed: `workflowClient.listWorkflows()` that maybe makes pagination easier and converts types of returned executions

https://typescript.temporal.io/api/interfaces/proto.temporal.api.workflowservice.v1.ilistworkflowexecutionsresponse/

#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-12 23:10:29.000 UTC</summary>

I have a bunch of ideas for this

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-13 04:05:59.000 UTC</summary>

List vs Scan? Scan says for a large amount and unordered. Don't see a difference in the request types:

https://github.com/temporalio/api/blob/223f02944d1a5fcec43918a466e7eed51ab84171/temporal/api/workflowservice/v1/service.proto#L267-L277

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 03:49:00.000 UTC</summary>

I think scan is being deprecated, need to check

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-19 00:53:20.000 UTC</summary>

This should be an sdk-features issue

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-08-11 20:15:42.000 UTC</summary>

- Method returns an async interator
- Type-safe query builder for List Filters

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-12-08 22:53:47.000 UTC</summary>

Partially implemented in #942 (basic listing returning an async iterator, with support for textual query).

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-01-25 05:45:54.000 UTC</summary>

Query builder inspiration: https://twitter.com/leeerob/status/1617699252645539841?s=46&t=YzEupBtrueWqpY9F-MaJ5g

</details>


---

<a id="727"></a>

### #727: [Bug] Deprecate `temporalio` meta package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/727 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-27 18:56:25.000 UTC (3y 6m ago) |
| **Updated** | 2022-07-15 04:08:32.000 UTC |
| **Closed** | 2022-07-15 04:08:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 9 |
| **Priority Score** | 9 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | 1.0 |

#### Description

`npm install temporalio` doesn't work with package managers that do [strict dependency resolution](https://github.com/temporalio/sdk-typescript/issues/421#issuecomment-1067196052) (don't support transitive deps) like pnpm and yarn3.

We could either:
- keep `temporalio`, and warn at the top of the README and on install to not use it if you're using such a package manager
- change our setup instructions and samples `package.json`s to install the direct packages:

  ```
  npm install @temporalio/{client,worker,workflow,activity,common}
  ```

I think the latter is simpler / will result in less confusion.

#### Comments (9)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-29 21:04:00.000 UTC</summary>

No need to install common directly

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-07 20:40:22.000 UTC</summary>

Update: we'll do both, including `npm deprecate temporalio "message"`: 

https://docs.npmjs.com/cli/v8/commands/npm-deprecate

How's this deprecation message?

```
Instead of installing `temporalio`, we recommend directly installing our packages: npm remove temporalio; npm install @temporalio/client @temporalio/worker @temporalio/workflow @temporalio/activity
```

Will show up in the "Author message" field:

<img width="670" alt="image" src="https://user-images.githubusercontent.com/251288/177867313-df27cde2-2e0c-42e2-8bf1-e983eab2f2fc.png">


</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-08 06:19:09.000 UTC</summary>

SGTM

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-07-08 12:39:39.000 UTC</summary>

Question - how do other projects do "umbrella" packages like this? Might it make more sense to just have a simple index file for the `temporalio` that imports all of those packages instead? I figure reading "No need to install common directly" that transitive dependencies _are_ actually included if referenced?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-08 14:54:24.000 UTC</summary>

We can‚Äôt export everything from the umbrella package as is because of workflow sandbox limitations.
We can work around it but I still want to support using the individual packages and would rather be consistent in our docs and samples.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-07-08 15:55:46.000 UTC</summary>

> We can‚Äôt export everything from the umbrella package as is because of workflow sandbox limitations.

I am confused, if I only import things from `@temporalio/workflow` in the sandbox, how does that affect what's referenced from `@temporalio`? But understanding this issue now, it doesn't really apply (I was confused what was meant by transitive here, I thought the problem was we never referenced those other packages in code).

My other questions still stand. Restated:

1. How do other projects do "umbrella" packages like this?
2. Why "No need to install common directly"? If I use anything out of `@temporalio/common`, won't pnpm or yarn fail if I use the setup instructions that we're now using? If so, why are we ok with telling a user "you must install specific package if you use it with pnpm/yarn" for "common" but not the others?

It seems like the limitations of pnpm and yarn would apply to those installing w/ those package managers while those using npm can still use umbrella packages. I'm curious what other projects do here.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-08 17:09:46.000 UTC</summary>

I'll explain what I meant.

If we encourage using the umbrella (meta) package, we'll have code in samples and such that looks like:
```ts
import * as wf from '@temporalio/workflow'
// and
import * as wf from 'temporalio/workflow'
```

I'd like to avoid this confusion and have a single "blessed" way to import our packages.
I'd also like users only wanting to use the client not to have to install the worker's native dependencies, this will especially become important when we write a browser client.

The problem with transitive dependencies is that package managers like pnpm prevent using a dependency without explicitly installing it (e.g specifying in package.json), this is due to the way they organize the packages and work around node's default module resolution.

> How do other projects do "umbrella" packages like this?

From what I've seen, you always install the packages you use.

> Why "No need to install common directly"? If I use anything out of @temporalio/common, won't pnpm or yarn fail if I use the setup instructions that we're now using? If so, why are we ok with telling a user "you must install specific package if you use it with pnpm/yarn" for "common" but not the others?

If you use anything from common with pnpm and yarn, you'll fail (at runtime), this is an expected by users of these package managers. We re-export most of the relevant common utilities from the other packages so you rarely need to install common directly.

> It seems like the limitations of pnpm and yarn would apply to those installing w/ those package managers while those using npm can still use umbrella packages. I'm curious what other projects do here.

That's a valid point, we don't **have** to deprecate the meta package, I may be uneducated here but it seems like the node ecosystem is going towards the more strict package layout scheme and I'd rather steer users in the right direction. When pnpm and yarn3 users see `npm install temporalio` in our getting started guides they'll try the same with their package manager and fail.


</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-08 17:12:12.000 UTC</summary>

1. Apollo Client used to have a long list of packages to install. Now they re-export everything from the meta package:

<img width="323" alt="image" src="https://user-images.githubusercontent.com/251288/178038461-7c457b15-5538-4bb3-8051-c5571976afba.png">

2. Most samples don't import from `@temporalio/common`, since most things are re-exported from the relevant client/activity/workflow package. I'll add to docs that use common (I think just custom data converters) to `npm install @temporalio/common`.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-07-08 17:39:47.000 UTC</summary>

Thanks! That things are re-exported and the common package isn't directly referenced now makes sense. As for a "meta" package, I can understand not wanting that. All of my concerns/questions are handled.

</details>


---

<a id="481"></a>

### #481: Tracking: spec-compliant JSON in protobuf.js

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/481 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-15 18:55:52.000 UTC (3y 10m ago) |
| **Updated** | 2023-05-11 17:28:48.000 UTC |
| **Closed** | 2023-05-11 17:28:48.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 7 |
| **Priority Score** | 9 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Problem

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

protobufjs's `.toJSON` doesn't do [proto3-spec-compliant](https://developers.google.com/protocol-buffers/docs/proto3#json) JSON encoding, which means that if we used it, it would either error or be incompatible with the other SDKs, which use Google's libraries, which are spec-compliant. 

To work around this, we do this:

https://github.com/lorensr/sdk-node/blob/custom-data-converter/docs/protobuf-libraries.md#current-solution

which is awkward / more setup and code than is ideal.

### Solution

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Make it easier to use protobufs by changing protobufjs, either by fixing their `toJSON` implementation or adding a `toProto3JSON` method. For the status of that, follow:

https://github.com/protobufjs/protobuf.js/issues/1304


#### Comments (7)

<details>
<summary><strong>cretz</strong> commented on 2022-02-15 19:28:03.000 UTC</summary>

I think the most challenging-yet-needed thing is making it work from the outside on external protobufjs-generated protos too, not just Temporal ones. Bonus points if this can be a standalone library for anyone using protobufjs (granted it'll be more maintenance and quite the test suite).

I can think of ways to do this. Most are probably similar to the linked issue where a custom `toObject` is used that understands well known types.

I could also understand punting proto JSON support until the ecosystem gets it together.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-15 19:39:59.000 UTC</summary>

> making it work from the outside on external protobufjs-generated protos too

There are different ways that protobufjs generates protos. [proto3-json-serializer](https://www.npmjs.com/package/proto3-json-serializer) (and therefore temporal) supports one of the ways. In order to support the other ways, the protobufjs generator would need to be changed to at least include types in generated `static` classes.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-15 20:13:56.000 UTC</summary>

This doesn't look like an issue for our repo, instead it's an issue with `protobuf.js`.
The workaround that we have now using `proto3-json-serializer` is fine, our users shouldn't care about proto JSON serialization at all, that's handled by the converter.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-02-15 20:25:17.000 UTC</summary>

> our users shouldn't care about proto JSON serialization at all, that's handled by the converter.

From the doc linked in the description, it looks like they do have to care because they have to create protos a certain way (e.g. for returning) and maybe an extra protoc generator or something similar? I'm ok w/ whatever's easiest on users of course. I guess without a type registry and descriptor available there is little choice but making the user care.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-15 21:10:11.000 UTC</summary>

> This doesn't look like an issue for our repo

I like to keep issues open just for tracking external issues. But also, this issue is more broad‚Äîeg could include discussion of whether to support `static` generated messages for just `binary/protobuf`.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-15 21:42:02.000 UTC</summary>

> From the doc linked in the description, it looks like they do have to care because they have to create protos a certain way (e.g. for returning) and maybe an extra protoc generator or something similar? I'm ok w/ whatever's easiest on users of course. I guess without a type registry and descriptor available there is little choice but making the user care.

@lorensr surveyed the alternative protobuf implementations and the solution we came up with is the only one that covers all of the cases.
So yes, the users care to some degree but it doesn't matter if the proto class has a `toJSON` method or we use an external library for JSON support.

> I like to keep issues open just for tracking external issues. But also, this issue is more broad‚Äîeg could include discussion of whether to support static generated messages for just binary/protobuf.

So I'd change the description of this issue to reflect that this is its purpose, and possibly close / tag it as (nothing to do now / external issue).

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 17:28:48.000 UTC</summary>

No need to track as an open issue, it's cluttering up the repo's issues.

</details>


---

<a id="127"></a>

### #127: [Bug] No message returned when running hello world sample app

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/127 |
| **State** | CLOSED |
| **Author** | denjalonso (Denis Juan Alonso Glez) |
| **Created** | 2021-06-17 15:59:47.000 UTC (4y 6m ago) |
| **Updated** | 2021-06-18 19:44:50.000 UTC |
| **Closed** | 2021-06-18 15:25:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 9 |
| **Priority Score** | 9 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**
No message returned when i start the Workflow, running getting started (hello world sample app), step 3 "Run your Workflow".

**To Reproduce**
Steps to reproduce the behavior:
1. Go to https://docs.temporal.io/docs/node/getting-started/
2. Follow steps
3. Then when running `node lib/worker/schedule-workflow.js` it not returns "Hello, Temporal!" message:
````
$ node lib/worker/schedule-workflow.js

````
**Expected behavior**
Starts the scheduled workflow

**Screenshots/Terminal ouput**
<img width="880" alt="Screenshot 2021-06-17 at 16 53 14" src="https://user-images.githubusercontent.com/3237551/122431767-a83eef80-cf8c-11eb-988d-80f13b850562.png">

Temporal web after start (state is running):
<img width="2544" alt="Screenshot 2021-06-17 at 16 55 30" src="https://user-images.githubusercontent.com/3237551/122432127-f7852000-cf8c-11eb-88fa-6f494d807114.png">

Workflow detail in temporal web (state is running):
<img width="2553" alt="Screenshot 2021-06-17 at 16 56 58" src="https://user-images.githubusercontent.com/3237551/122432344-256a6480-cf8d-11eb-8ac5-2ab4028b237a.png">



**Versions (please complete the following information where relevant):**
 - OS: macOs Big Sur 11.4 Apple M1
 - Node v16.3.0 (tj/n)
 - `"temporalio": "0.2.2"`
 - Temporal server with docker compose

**Additional context**
I have tried with different versions of node.


#### Comments (9)

<details>
<summary><strong>denjalonso</strong> commented on 2021-06-17 16:02:41.000 UTC</summary>

This is the log output in the server (temporal):

```
Jun 17 16:53:05.003  WARNtemporal_sdk_core::workflow_tasks: Attempted to complete activation for nonexistent run, run_id: ""
    in temporal_sdk_core::complete_workflow_task with completion=WfActivationCompletion(run_id: , status: Success( ScheduleActivity ))
```

Reactions: üëç 1

</details>

<details>
<summary><strong>zomble</strong> commented on 2021-06-18 07:38:38.000 UTC</summary>

I see that same issue.

```
const activation = coresdk.workflow_activation.WFActivation.decode(new Uint8Array(buffer));
```

Is producing:

```
WFActivation {
  jobs: [ WFActivationJob { startWorkflow: [StartWorkflow] } ],
  taskToken: Uint8Array(36) [
    55, 52, 55, 53, 100, 53, 102,  53,  45,
    49, 50, 57, 98,  45, 52,  50,  98, 100,
    45, 98, 55, 51,  99, 45, 100, 102,  99,
    52, 49, 50, 57,  49, 51, 100,  97,  57
  ],
  timestamp: Timestamp {
    seconds: Long { low: 1624001582, high: 0, unsigned: false },
    nanos: 535530575
  }
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-18 12:32:21.000 UTC</summary>

Thanks for the detailed report.
Looks like we published a version with a mismatch in the proto definitions between core and the worker.
I'll make sure to publish a new version ASAP.
We have an open issue to automate the release process which should eliminate these sort of bugs. 

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-18 14:01:47.000 UTC</summary>

I just noticed that since the proto library contains generated code it doesn't automatically get published.
Working on a fix for that.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-18 14:33:15.000 UTC</summary>

Once CI passes for #128 I'll republish the packages.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-18 16:23:13.000 UTC</summary>

AFK, will publish as soon as I'm back online.

</details>

<details>
<summary><strong>denjalonso</strong> commented on 2021-06-18 16:25:34.000 UTC</summary>

Thx

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-18 19:44:22.000 UTC</summary>

Just published

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-18 19:44:50.000 UTC</summary>

`temporalio@0.2.4` with `@temporalio/proto@0.2.2`

</details>


---

<a id="78"></a>

### #78: [Bug] Path aliases easily confused with package scopes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/78 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2021-04-30 00:21:25.000 UTC (4y 8m ago) |
| **Updated** | 2021-05-20 13:58:11.000 UTC |
| **Closed** | 2021-05-20 13:58:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 9 |
| **Priority Score** | 9 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**
The use of `@` aliases in the auto-generated packages is unnecessarily confusing and may increase the chance of unintended aliasing with 3rd party packages:

```
      paths: {
        '@workflows': ['../workflows'],
        '@workflows/*': ['../workflows/*'],
        '@activities': ['../activities'],
        '@activities/*': ['../activities/*'],
        '@interfaces': ['../interfaces'],
        '@interfaces/*': ['../interfaces/*'],
      },
```

Source: https://github.com/temporalio/sdk-node/blob/main/packages/create-project/src/index.ts#L128

For many developers and code reviewers, the `@` prefix indicates a package scope, such as `@temporalio` and not an alias prefix.

At the least, I suggest changing to a different prefix that won't be confused with similarly-spelled package scopes. 

However, because of the many problems and surprises with path aliases (see below), my advice is to _not_ add them to auto-generated code. Rather, let the devs add them at their discretion.

**Additional context**
In my experience, Typescript's path aliases have been a continual source of problems. I do use them on large projects, but I've made certain compromises in doing so, and always with the fear that there is yet another issue to be uncovered.

For example:

https://mitchellsimoens.com/2019/08/07/why-typescript-paths-failed-me/


#### Comments (9)

<details>
<summary><strong>bergundy</strong> commented on 2021-05-04 05:51:22.000 UTC</summary>

Hi,

I'm totally fine with changing the prefix from `@`, do you have a suggestion for a better one?
I've only seen `@` used for aliases before and FWIU that's what is commonly used.

The article has some really good points but they don't apply to us since we only use the aliases for type information meaning that the aliases are omitted from the generated code.
There's one thing I would change in the in package initializer and that's not to add aliases to the worker package.
The only aliases we should have is `@activities` and `@interfaces` in the workflow project and `@interfaces` in the activities package.
WDYT?

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-05-04 07:11:28.000 UTC</summary>

`~` is another common alias character. I'd prefer it to `@`.

The problems I have path aliases stem from the fact that they are designed for loaders that allow remapping, not for rewriting paths:

https://github.com/microsoft/TypeScript/issues/10866#issuecomment-246789510

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-04 07:49:39.000 UTC</summary>

I'm fine with changing to `~` (even though it's also an alias to a user's home directory).

We have a custom module loader for the isolate runtime so that qualifies as a valid use case for path aliases.
See the worker code for loading activities [here](https://github.com/temporalio/sdk-node/blob/8ccedd2d4f186a5bc50019caea0bba7480dbc106/packages/worker/src/worker.ts#L387).
As for the `@interfaces` alias, it's supposed to only hold type definitions so it should be OK.

Does that make sense to you?

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-05-04 08:12:15.000 UTC</summary>

Thanks for pointing me to the loader code.

A potential issue with an `interfaces` path alias might be if they are published and later imported. I think the path aliases would need to be rewritten before publication, both in the published code and in the published ts types.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-04 08:16:12.000 UTC</summary>

That's a fair point.
Can you try and reproduce this behavior?

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-05-04 08:31:20.000 UTC</summary>

> Can you try and reproduce this behavior?

I think that's the first issue described here:

https://mitchellsimoens.com/2019/08/07/why-typescript-paths-failed-me/

To repro, look at the generated code and `types.d.ts` output from `npm pack`

I've used `ttsc` to translate the path aliases before publication.


</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-04 10:48:07.000 UTC</summary>

Just reproduced it, thanks!
The aliases are definitely broken after `npm pack`.
We can get rid of the interfaces alias but we need the activities alias for the module loader.
I suggest we either change the behavior of the module loader (not sure how yet) or live with the restriction that the project cannot be published.


</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-04 11:35:09.000 UTC</summary>

Or use ttsc as you've pointed out to keep the current behavior and support publishing.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-20 12:26:01.000 UTC</summary>

Once #106 is merged I think we can close this issue.
The only alias left is the special `@activities` alias which is required for our custom webpack resolver (https://github.com/temporalio/sdk-node/blob/d59051c732e961100ba75fdc431b742a489cfebb/packages/worker/src/isolate-builder.ts#L93).
I'm OK with the `@` prefix and I believe it's not that confusing and is more commonly used than the alternative proposed here (`~`), we can easily make this configurable BTW.

If you feel strongly against this decision feel free to reopen the issue and continue the discussion.

</details>


---

<a id="1724"></a>

### #1724: [Bug] TypeError: Failed to initialize workflow of type 'sayHello': no such function is exported by the workflow bundle

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1724 |
| **State** | CLOSED |
| **Author** | liho00 (LiHo) |
| **Created** | 2025-06-10 18:52:14.000 UTC (7 months ago) |
| **Updated** | 2025-09-15 17:31:17.000 UTC |
| **Closed** | 2025-06-11 08:03:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 8 |
| **Priority Score** | 8 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

 TypeError: Failed to initialize workflow of type 'sayHello': no such function is exported by the workflow bundle



```
[12:22:05 AM] Starting compilation in watch mode...

[12:22:07 AM] Found 0 errors. Watching for file changes.

[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [NestFactory] Starting Nest application...
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClientModule] Connecting to Temporal server at localhost:7233
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [InstanceLoader] TemporalWorkerModule dependencies initialized +10ms
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClientModule] Connected to Temporal server, using namespace "default"
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [InstanceLoader] TemporalClientModule dependencies initialized +1ms
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [InstanceLoader] TemporalModule dependencies initialized +0ms
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [InstanceLoader] AppModule dependencies initialized +0ms
Starting Temporal worker...
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [RoutesResolver] HelloWorkflowController {/}: +2ms
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [RoutesResolver] AppController {/}: +1ms
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [RouterExplorer] Mapped {/hello/:name, GET} route +1ms
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClient] Enhanced Temporal service initialized
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClient] Discovered: 0 controllers, 0 workflows, 0 scheduled
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClient] Schedules: 0 total, 0 active
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClient] Worker: not initialized, 0 activities registered
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [WorkflowDiscovery] Discovered workflow controller: HelloWorkflowController
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [WorkflowDiscovery] Discovered 1 controllers with 1 workflow methods
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [WorkflowDiscovery] Found 0 scheduled workflows, 0 signals, 0 queries
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [WorkflowDiscovery] Controller: HelloWorkflowController (taskQueue: hello-world)
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [WorkflowDiscovery]   - Workflow: sayHello (sayHello)
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalClientService] Temporal client initialized successfully
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalScheduleService] Temporal schedule client initialized
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalWorker] Initializing Temporal worker...
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Using workflows from filesystem path (recommended for development)
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalWorker] Found 2 activity providers
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Processing activity class: GreetingActivities
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [ActivityExecution] Found activity method: GreetingActivities.formatGreeting -> formatGreeting
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [ActivityExecution] Found activity method: GreetingActivities.logGreeting -> logGreeting
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Registered activity: GreetingActivities.formatGreeting
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Registered activity: GreetingActivities.logGreeting
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Processing activity class: GreetingActivities
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Registered activity: GreetingActivities.formatGreeting
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Registered activity: GreetingActivities.logGreeting
[Nest] 56464  - 06/11/2025, 12:22:07 AM     LOG [TemporalWorker] Registered 2 activity methods in total
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Connecting to Temporal server at localhost:7233
[Nest] 56464  - 06/11/2025, 12:22:07 AM   DEBUG [TemporalWorker] Temporal connection established
2025-06-10T16:22:07.984Z [INFO] Creating worker {
  sdkComponent: 'worker',
  taskQueue: 'hello-world',
  options: {
    namespace: 'default',
    identity: '56464@Lis-MacBook-Pro.local',
    useVersioning: false,
    buildId: undefined,
    shutdownGraceTime: 0,
    enableNonLocalActivities: true,
    maxConcurrentWorkflowTaskPolls: 5,
    maxConcurrentActivityTaskPolls: 10,
    stickyQueueScheduleToStartTimeout: '10s',
    maxHeartbeatThrottleInterval: '60s',
    defaultHeartbeatThrottleInterval: '30s',
    isolateExecutionTimeout: '5s',
    workflowThreadPoolSize: 2,
    maxCachedWorkflows: 914,
    showStackTraceSources: false,
    debugMode: false,
    interceptors: { activity: [], workflowModules: [] },
    nonStickyToStickyPollRatio: 0.2,
    sinks: { __temporal_logger: [Object] },
    connection: NativeConnection {
      nativeClient: [External: 138226a70],
      referenceHolders: Set(0) {}
    },
    taskQueue: 'hello-world',
    activities: Map(2) {
      'formatGreeting' => [Function: bound formatGreeting] AsyncFunction,
      'logGreeting' => [Function: bound logGreeting] AsyncFunction
    },
    workflowsPath: '/Users/liho/Desktop/taocan/taocan-workflow/dist/workflows',
    reuseV8Context: false,
    tuner: {
      workflowTaskSlotSupplier: [Object],
      activityTaskSlotSupplier: [Object],
      localActivityTaskSlotSupplier: [Object]
    },
    shutdownGraceTimeMs: 0,
    shutdownForceTimeMs: undefined,
    stickyQueueScheduleToStartTimeoutMs: 10000,
    isolateExecutionTimeoutMs: 5000,
    maxHeartbeatThrottleIntervalMs: 60000,
    defaultHeartbeatThrottleIntervalMs: 30000,
    loadedDataConverter: {
      payloadConverter: [DefaultPayloadConverter],
      failureConverter: [DefaultFailureConverter],
      payloadCodecs: []
    }
  }
}
2025-06-10T16:22:08.421Z [INFO] asset workflow-bundle-98eb4e810cf2eec45dcd.js 921 KiB [emitted] [immutable] (name: main)
modules by path ./node_modules/@temporalio/ 229 KiB
  modules by path ./node_modules/@temporalio/common/ 98.7 KiB 24 modules
  modules by path ./node_modules/@temporalio/workflow/ 130 KiB
    ./node_modules/@temporalio/workflow/lib/worker-interface.js 8.38 KiB [built] [code generated]
    ./node_modules/@temporalio/workflow/lib/global-overrides.js 4.09 KiB [built] [code generated]
    ./node_modules/@temporalio/workflow/lib/cancellation-scope.js 9.92 KiB [built] [code generated]
    + 13 modules
modules by path ./dist/ 444 bytes
  ./dist/workflows-autogenerated-entrypoint.cjs 443 bytes [built] [code generated]
  ./dist/workflows/index.js 1 bytes [built] [code generated]
__temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
__temporal_custom_failure_converter (ignored) 15 bytes [built] [code generated]
./node_modules/long/umd/index.js 49.8 KiB [built] [code generated]
webpack 5.99.6 compiled successfully in 267 ms { sdkComponent: 'worker', taskQueue: 'hello-world' }
2025-06-10T16:22:08.422Z [INFO] Workflow bundle created { sdkComponent: 'worker', taskQueue: 'hello-world', size: '0.90MB' }
[Nest] 56464  - 06/11/2025, 12:22:08 AM     LOG [TemporalWorker] Worker created for queue: hello-world in namespace: default
[Nest] 56464  - 06/11/2025, 12:22:08 AM     LOG [TemporalWorker] Worker configuration summary:
[Nest] 56464  - 06/11/2025, 12:22:08 AM     LOG [TemporalWorker] {
  "taskQueue": "hello-world",
  "namespace": "default",
  "workflowSource": "filesystem",
  "activitiesCount": 2,
  "autoStart": true,
  "environment": "development"
}
[Nest] 56464  - 06/11/2025, 12:22:08 AM     LOG [TemporalWorker] Temporal worker initialization completed
[Nest] 56464  - 06/11/2025, 12:22:08 AM     LOG [ScheduleManager] No scheduled workflows found
[Nest] 56464  - 06/11/2025, 12:22:08 AM     LOG [TemporalWorker] Starting worker for task queue: hello-world
2025-06-10T16:22:08.509Z [INFO] Worker state changed { sdkComponent: 'worker', taskQueue: 'hello-world', state: 'RUNNING' }
2025-06-10T16:23:11.558Z [ERROR] Failed to process Worklow Activation {
  sdkComponent: 'worker',
  taskQueue: 'hello-world',
  runId: '01975a93-9917-7c97-810e-4950029c94b9',
  error: /Users/liho/Desktop/taocan/taocan-workflow/workflow-bundle-98eb4e810cf2eec45dcd.js:4485
          throw new TypeError(`Failed to initialize workflow of type '${activator.info.workflowType}': ${details}`);
          ^
  
  TypeError: Failed to initialize workflow of type 'sayHello': no such function is exported by the workflow bundle
      at Object.initRuntime (/Users/liho/Desktop/taocan/taocan-workflow/node_modules/@temporalio/workflow/src/worker-interface.ts:87:10)
      at evalmachine.<anonymous>:1:18
      at Script.runInContext (node:vm:149:12)
      at Object.runInContext (node:vm:301:6)
      at Proxy.<anonymous> (/Users/liho/Desktop/taocan/taocan-workflow/node_modules/@temporalio/worker/lib/workflow/vm.js:41:46)
      at VMWorkflowCreator.createWorkflow (/Users/liho/Desktop/taocan/taocan-workflow/node_modules/@temporalio/worker/lib/workflow/vm.js:48:24)
      at async handleRequest (/Users/liho/Desktop/taocan/taocan-workflow/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:13)
      at async MessagePort.<anonymous> (/Users/liho/Desktop/taocan/taocan-workflow/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:32),
  workflowExists: false
}

```

#### Comments (8)

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-11 03:51:51.000 UTC</summary>

That error could indicate any of a multitude of problems. Can you please provide more details on how you got there? Any code you can share?

Also, I see this is a Nest application. We do not officially provide or support any Temporal+Nest integration module. You may find it useful to review documentation or samples from the integration library you are using.

</details>

<details>
<summary><strong>liho00</strong> commented on 2025-06-11 04:08:08.000 UTC</summary>

> That error could indicate any of a multitude of problems. Can you please provide more details on how you got there? Any code you can share?
> 
> Also, I see this is a Nest application. We do not officially provide or support any Temporal+Nest integration module. You may find it useful to review documentation or samples from the integration library you are using.

reproduce repo: https://github.com/liho00/nestjs-temporal
@mjameswh 


https://github.com/harsh-simform/nestjs-temporal-core
@harsh-simform

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-11 08:03:39.000 UTC</summary>

I see. Yeah, that issue really is specific to the Temporal+Nest integration library that you are using. Given my own very limited knowledge of Nest JS, there's very little I can do to help you on this.

I however want to point out that your frustration regarding that library probably result from a misalignment between what you are looking for and what that library really is doing.

Bridging Nest dependency injection and Temporal's Workflow sandbox, is a complex and difficult thing. It is simply not possible to load the `@nestjs/common` or `@nestjs/core` packages inside the Workflow sandbox, as they themselves depend on various non-deterministic-safe modules, so a library doing this would not only need to dynamically generate an entrypoint file for all the workflows definitions, but would also need some form of compile time transformation mechanism to replace Nest's decorators in the generated Workflow bundle.

Looking specifically at this project, I don't see any such thing. The recently introduced "Automatic discovery of workflow controllers" feature is about collecting metadata on Workflows, signals, queries, etc. Those metadata can be used for example to automatically add the appropriate task queue name when starting a workflow using the exposed `TemporalService`, which is some kind of NestJS-style Temporal _Client_. But Workflow metadata don't affect the Worker's Workflow bundle.

You are therefore left with the responsibility of generating the corresponding Workflow bundle, or for exporting some kind of `workflows.ts` file, and that bundle can't contain reference to  `@nestjs/common` or `@nestjs/core`, nor can it reference the `nestjs-temporal-core` package as it itself imports `@nestjs/common` and `@nestjs/core`.

</details>

<details>
<summary><strong>frct1</strong> commented on 2025-06-11 18:36:07.000 UTC</summary>

@mjameswh 
Hello there!
Started to looking for ways to bring Temporal.io into projects and stuck on a nestjs-temporal-core lib. It has a nice readme though devs really didn't found the way to bundle workflows via decorated class (as nestjs completely rely on through some sort of discovery logic to bind classes/method to actual package).
But, the [v2.0.8](https://github.com/harsh-simform/nestjs-temporal-core/tree/v2.0.8) works enough except some nits like it uses the current recommended way on exporting workflows to allow bundler pick them up.
What could be workarounds on this case? Nest provides solid way building apps and node.js at this time doesn't have any efficient job queue integrating many languages except temporal.io.

I got some questions on this behalf (to be edited probably): 
> Can we use any another way on exporting workflows to the temporal worker? 

Note: I see that at this moment it is required to provide workflowsPath or workflowsBundle.

</details>

<details>
<summary><strong>clintonb</strong> commented on 2025-09-15 16:23:59.000 UTC</summary>

We just encountered this issue with the latest version of nestjs-temporal and both Temporal 1.12.0 and 1.13.0. The problem does _not_ exist with Temporal 1.11.3.

</details>

<details>
<summary><strong>clintonb</strong> commented on 2025-09-15 17:20:16.000 UTC</summary>

I think this may be a Webpack issue. I can see that my workflows are bundled and exported; however, the call to `importWorkflows()` in `@temporalio/workflow/src/worker-interface.ts` does not return all of the exported workflows. I get about 30 of 35 functions. I'm combining multiple workflow files into a single file by exporting (see the example below). If I remove one of the files, my all other functions _are_ returned by `importWorkflows()`.

```ts
// NOTE: We do not generally like barrel files. We make an exception here
// because our current Temporal helper code assumes each Temporal module has
// a single workflow file.

export * from '../export-to-email/export-to-email.workflow';
export * from '../sftp-file-transfer/sftp-transfer.workflow';
export * from './eplum/eplum.workflow';
export * from './payments/payments.workflow';
export * from './workflows/backfill/pos-backfill.workflow';
export * from './workflows/ditto.workflow';
export * from './workflows/inventory.workflow';
export * from './workflows/pos-transaction-report.workflow';
// No functions exported beyond this point are returned by `importWorkflows`.
// If I comment out `pos-transaction-report.workflow`, all functions below
// ARE exported. There is nothing "special" about pos-transaction-report.workflow.

export * from './workflows/shopper.workflow';
export * from './workflows/stuck-invoices.workflow';
export * from './workflows/wic.workflow';

```

</details>

<details>
<summary><strong>clintonb</strong> commented on 2025-09-15 17:24:16.000 UTC</summary>

Hmm...I'm pretty sure my issues are due to some interplay between Bluebird and Webpack. Removing Bluebird `map()` calls from workflow functions result in all functions being exported.

</details>

<details>
<summary><strong>clintonb</strong> commented on 2025-09-15 17:31:17.000 UTC</summary>

Confirmed. Replacing Bluebird with [p-map](https://www.npmjs.com/package/p-map) resolves this issue for me. No changes need to be made to nestjs-temporal.

</details>


---

<a id="1621"></a>

### #1621: [Feature Request] Include musl-based shared library in package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1621 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-02-05 22:38:08.000 UTC (11 months ago) |
| **Updated** | 2025-02-05 22:38:08.000 UTC |
| **Upvotes** | 4 |
| **Comments** | 0 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 4 |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/594


---

<a id="1587"></a>

### #1587: [Bug] Using async functions degrades performance

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1587 |
| **State** | OPEN |
| **Author** | c0sx (Koshkin Nikolai) |
| **Created** | 2024-12-13 17:00:39.000 UTC (1 years ago) |
| **Updated** | 2025-06-03 06:55:41.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 6 |
| **Priority Score** | 8 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 üëÄ 3 |

#### Description

### What are you really trying to do?

Hi, I have a workflow like dsl-interpreter from [sample](https://github.com/temporalio/samples-typescript/tree/main/dsl-interpreter) and I found that my workflow is slow.

### Describe the bug

For some reason using async functions in workflows is drastically slower than sync functions. Could you help me? 

I have 2 identical workflows (synthetic examples), the difference only in using async in functions:

```js
// sync workflow
async function run() {
  const iters = () => 0;
  const condition = (iters) => iters < 10_000;
  const incr = (iters) => iters + 1;
  const out = (iters) => iters;

  let i = iters();

  while (condition(i)) {
    i = incr(i);
  }

  return out(i);
}

// async workflow
async function run() {
  const iters = async () => 0;
  const condition = (iters) => iters < 10_000;
  const incr = async (iters) => iters + 1;
  const out = async (iters) => iters;

  let i = await iters();

  while (condition(i)) {
    i = await incr(i);
  }

  return await out(i);
}
```

My worker and client
```js
// worker.js
const path = require('path');

const { Worker } = require('@temporalio/worker');

async function main() {
  const worker = await Worker.create({
    workflowsPath: path.join(__dirname, './workflows.js'),
    taskQueue: 'hello-javascript',
  });

  await worker.run();
}

main().catch((err) => {
  console.error(err);
  process.exit(1);
});

// client.js
const { Client, Connection } = require('@temporalio/client');

const { run } = require('./workflows');

async function main() {
  const connection = await Connection.connect({});

  const client = new Client({
    connection,
  });

  console.time('client'); // start timer

  const result = await client.workflow.execute(run, {
    taskQueue: 'hello-javascript',
    workflowId: 'my-business-id',
    args: ['Temporal'],
  });

  console.timeEnd('client'); // end timer
  console.log(result);
}

main().catch((err) => {
  console.error(err);
  process.exit(1);
});
```

And I have this results

| Sync workflow | Async workflow | 
| --- | --- |
| 25-30ms | 350-400ms |

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M3 Mac
- Temporal Version: 

```bash
temporal -v
temporal version 1.0.0 (Server 1.24.2, UI 2.28.0)
```
- SDK: typescript-sdk:  1.10.3

- Are you using Docker or Kubernetes or building Temporal from source? 
I installed temporal from brew


#### Comments (6)

<details>
<summary><strong>c0sx</strong> commented on 2024-12-16 08:16:11.000 UTC</summary>

I found that this problem related with `promiseHooks` in `vm-shared` worker [here](https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/workflow/vm-shared.ts#L205).

Is it really important to handle any promise?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-16 15:26:30.000 UTC</summary>

>I found that this problem related with promiseHooks in vm-shared worker [here](https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/workflow/vm-shared.ts#L205).

Yeah, I had the intuition the issue you described would be related to this `promiseHook`.

If you want to dig a bit more, I would expect that the largest part of that extra time comes from [these lines](https://github.com/temporalio/sdk-typescript/blob/53233c9091d2eb8d855839f0e8d4bab324913581/packages/worker/src/workflow/vm-shared.ts#L165-L167), which gets called [from the promise hook](https://github.com/temporalio/sdk-typescript/blob/53233c9091d2eb8d855839f0e8d4bab324913581/packages/worker/src/workflow/vm-shared.ts#L221C13-L224) (see the `.stack`, which internally calls the `prepareStackTrace` function).

> Is it really important to handle any promise?

The goal of that hook is to capture the data we need for the `__stack_trace` and `__enhanced_stack_trace` Workflow queries, which are called from the Temporal UI to help diagnose Workflow issues. That's a nice to have feature, but definitely not required. In fact, `promiseHooks` is not supported on Node <16.14, in which case [that hook simply doesn't get registered](https://github.com/temporalio/sdk-typescript/blob/53233c9091d2eb8d855839f0e8d4bab324913581/packages/worker/src/workflow/vm-shared.ts#L203).

Adding a worker config option to turn off this feature would be a possibility.

I would however like to investigate first what can be done to reduce the runtime overhead of capturing stack traces on async contexts. I have a few ideas in mind that, I believe, could reduce the cost to nearly zero, without compromising on availability of this feature.

Reactions: üëç 1

</details>

<details>
<summary><strong>c0sx</strong> commented on 2024-12-24 07:42:42.000 UTC</summary>

@mjameswh Hi, do you have any news?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-27 18:33:38.000 UTC</summary>

No, not at this time.

Reactions: üëÄ 1

</details>

<details>
<summary><strong>c0sx</strong> commented on 2025-06-03 06:53:18.000 UTC</summary>

@mjameswh Hi, do you have any updates that you could share?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-03 06:55:40.000 UTC</summary>

Still not. Sorry.

Reactions: üòï 1 üëÄ 1

</details>


---

<a id="1557"></a>

### #1557: [Feature Request] allow opt-out of workflow isolation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1557 |
| **State** | OPEN |
| **Author** | neelance (Richard Musiol) |
| **Created** | 2024-11-03 13:08:22.000 UTC (1y 2m ago) |
| **Updated** | 2025-07-24 07:52:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 8 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | ‚ù§Ô∏è 8 üëÄ 1 |

#### Description

The bug #1432 just caused a lot of pain for us. It made our workers consume a lot of memory over time (and go OOM repeatedly) and made them go really slow over time, since every (implicit) call to `new Promise` was affected. It took me several weeks of investigating, giving up and then trying again on a different day to track down this root cause. This is because the issue only happened in production and most metrics that I could get from production did not clearly point to the issue. Even diffs on heap snapshots did not clearly point to `AsyncLocalStorage` because it contained a huge amount of other heap differences and `AsyncLocalStorage` did not catch my attention. I only got lucky that a CPU profile seemed odd and I noticed that the internals of `Promise` took much too long.

Our code was using `new AsyncLocalStorage` as a constant at the toplevel of a module. Normally such a constant only gets initialised once. It is quite unintuitive that with workflow isolation one has to consider that this code gets executed multiple times and thus reason through performance implications. #1432 plans to hide these implications, but it also mentions that `maxCachedWorkflow` might still be a performance issue.

This is not the first issue that we have due to the workflow isolation feature and I'm sorry, but I doubt that it will be the last. In theory workflow isolation seems like a good idea, but in practice it adds complexity that causes very uncommon issues. I want to point out that for example the Go SDK does not try to apply workflow isolation. Instead it expects the developer to write proper workflow code that respects deterministic execution requirements. I would rather teach my team to handle a transparent nondeterminism-error due to bad workflow code than to have issues like the one above. Therefore I would like to request the option to opt-out of workflow isolation (and instead opt-in to simplicity). I still appreciate the effort you've put into workflow isolation and its performance optimisations like reusable VMs.

#### Comments (8)

<details>
<summary><strong>lukeramsden</strong> commented on 2024-11-11 11:35:05.000 UTC</summary>

I'd like to echo this sentiment - while the fact that determinism can be "enforced" is very helpful early on, there are other mechanisms (such as replay testing) that more mature orgs can use that are less rigid at runtime. Integrating the workflow isolation with a projects build stack is also quite painful. 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-19 17:33:35.000 UTC</summary>

I totally understand the feeling, and I would personally also like to explore making sandboxing optional.

That is, however, a much larger effort than it may appear, which we can't prioritize just now. I would also point out that it is not clear to me at this point either getting rid of the Workflow sandbox would effectively result in less restrictions and lower technical complexity than what we have now. It may actually have the opposite effect.

The thing is that even though we generally present the sandbox as a way of isolating imports and global variables for determinism reasons, the sandbox also plays a second, more subtle but actually more important role: each Node's VMs come with a distinct event loop. That means that when the worker makes a call into the VM context, it is guaranteed that by the time that call returns, all outstanding microtasks belonging to that context will have been settled. This is how we know that a Workflow Task has completed, and how we know that operations are always replayed in the correct order.

Some languages make it possible to somehow customize scheduling of async completions; for example, in .Net, we created a [custom task scheduler](https://github.com/temporalio/sdk-dotnet/blob/46410a617fa4b155a4331b6423b768e44139a140/README.md?plain=1#L591-L595); for Python, [that's a custom `asyncio.AbstractEventLoop`](https://temporal.io/blog/durable-distributed-asyncio-event-loop#temporals-asyncio-event-loop). In other languages, such as Java and Go, we have had to provide a completely distinct set of APIs to deal with async stuff inside of Workflow context (e.g. `workflow.Go()` instead of the `go` statement, `wokrflow.Channel` instead of Go's `chan` type, `workflow.Selector` instead of go's `select statement`, `Promise` instead of Java's `Future` and `CompletableFuture`, etc).

Node doesn't allow us to interfere with how its event loop works, like we do in .Net and Python. To some extent, it may be possible to rely on `setImmediate()` to determine that a Workflow Task has completed, but that would result in much weaker guarantees, especially if the goal is to have Workflow code coexist in the same execution environment as non-Workflow code. This is obviously an avenue that would have to be investigated, but should it indeed not provide the guarantees we need, the only alternative might be to have a completely distinct async APIs, similar to what we do in Java and Go. And if we reach that point, then we would no longer be able to use pure `async` constructs, but may have to transpile those into generators, just like it was common to do a few years ago. That means that in practice, we'd just effectively be replacing the current sandbox by a different type of sandbox. That's certainly not better.

Given those uncertainties, I think it is better for now to focus on making the sandbox better and more transparent, rather than avoiding it completely.

Reactions: üëç 2 ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>neelance</strong> commented on 2025-07-22 15:46:42.000 UTC</summary>

We just had another sudden breakage when upgrading the Temporal SDK.

```
TypeError: Symbol.asyncDispose is not defined.
```

To make things worse, the error does not occur when replaying the workflow locally, it only happens in production / with a full worker. I guess https://github.com/temporalio/sdk-typescript/pull/1605 is throwing away our `Symbol.asyncDispose` polyfill, which we need due to https://github.com/nodejs/node/issues/50745.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-22 16:53:55.000 UTC</summary>

> ```
> TypeError: Symbol.asyncDispose is not defined.
> ```
>
> I guess https://github.com/temporalio/sdk-typescript/pull/1605 is throwing away our Symbol.asyncDispose polyfill [‚Ä¶].

Yeah, that's very likely related, though the symptoms are not exactly those I would expect. How are you loading the polfill?

I have work in progress to formalize the proper way to load polyfills; see #1743. The tricky thing is that polyfills that modify built-in globals need to be loaded early, when the workflow bundle gets loaded into the VM context (once, at worker startup time), rather than when your `workflow.ts` module actually gets executed (on every workflow start).

</details>

<details>
<summary><strong>neelance</strong> commented on 2025-07-22 22:38:06.000 UTC</summary>

For now I have moved the polyfill directly into the injected code of `reusable-vm.js` via patch. This seems to work good enough.

> The thing is that even though we generally present the sandbox as a way of isolating imports and global variables for determinism reasons, the sandbox also plays a second, more subtle but actually more important role: each Node's VMs come with a distinct event loop. That means that when the worker makes a call into the VM context, it is guaranteed that by the time that call returns, all outstanding microtasks belonging to that context will have been settled. This is how we know that a Workflow Task has completed, and how we know that operations are always replayed in the correct order.

This makes sense. Still, this feature could be used without all the isolation efforts, couldn't it? You would only need to initialise `maxConcurrentWorkflowTaskExecutions` VMs once and then just plainly use them for executing workflow tasks, without any additional isolation efforts whatsoever.

> Yeah, that's very likely related, though the symptoms are exactly those I would expect.

As a user of the SDK, I want to mention again that such symptoms (and debugging and patching them) are a negative impact for us and it does not seem to me that the advantages of workflow isolation outweigh them to result in a positive tradeoff.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-23 21:28:42.000 UTC</summary>

> This makes sense. Still, this feature could be used without all the isolation efforts, couldn't it?

Of course, and that's already supported. Just add `reuseV8Context: false` to your Worker options.

A new VM context gets created for each Workflow execution, so there's no for context bookeeping and switching. That's actually how the sandbox was initially designed, with a much simpler execution model, and therefore, less surprises and complications. The "Reuse V8 Context" optimization came in later, resulting in 2/3 reduction in memory usage and between 1/3 and 1/2 reduction in CPU usage, according to our internal stress tests and confirmed by many users. That's why we made that execution model the default, but the original executor was kept around, for those cases where restrictions of the "Reuse V8 Context" executor are too cumbersome.

>> Yeah, that's very likely related, though the symptoms are exactly those I would expect.
>
> As a user of the SDK, I want to mention again that such symptoms (and debugging and patching them) are a negative impact for us and it does not seem to me that the advantages of workflow isolation outweigh them to result in a positive tradeoff.

Once again, I fully sympathize. But exploring alternative execution models is simply not something we can prioritize at this time.

</details>

<details>
<summary><strong>neelance</strong> commented on 2025-07-24 07:51:01.000 UTC</summary>

> Of course, and that's already supported. Just add reuseV8Context: false to your Worker options.

> A new VM context gets created for each Workflow execution, so there's no for context bookeeping and switching.

This is not what I meant. I was talking about creating new VM contexts **only on startup** of the worker and then reusing them for the whole lifetime of the worker. This would attempt no workflow isolation and only use them for the microtask handling that you mentioned.

</details>

<details>
<summary><strong>neelance</strong> commented on 2025-07-24 07:52:43.000 UTC</summary>

> Once again, I fully sympathize. But exploring alternative execution models is simply not something we can prioritize at this time.

Thanks. I appreciate that you take the time for this conversation. I'll still keep a log of the issues that we see in this thread, so it can be used as a reference. It is up to you to decide which way to go.

</details>


---

<a id="1362"></a>

### #1362: [Feature Request] Worker.runReplayHistory() should accept a serialized History object fetched using fetchHistory()

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1362 |
| **State** | OPEN |
| **Author** | jhecking (Jan Hecking) |
| **Created** | 2024-02-19 12:26:50.000 UTC (1y 10m ago) |
| **Updated** | 2025-08-06 12:44:26.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 4 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

I'm testing a patched workflow, by replaying an "unpatched" workflow history, to verify that it does not fail with a non-determinism error. To get the workflow history, I'm using the `fetchHistory()` function of the workflow client. I persist the history object to disk using `JSON.serialize`:

```typescript
const history = await client.workflow.getHandle('wfId').fetchHistory()
await fs.writeFile('./unpatched-workflow-history.json', JSON.stringify(history))
```

Then I add another unit tests that does nothing but load the serialized workflow history from disk (using `JSON.parse`) and replay it, e.g.

```typescript
it('should replay an unpatched workflow history', async function () {
  const history = JSON.parse((await fs.readFile('./unpatched-workflow-history.json')).toString())
  Worker.runReplayHistory(DefaultWorkerOptions, history)
})
```

This fails with the following error:
> Error: fromProto3JSONToInternalRepresentation: google.protobuf.Timestamp must be a string but got object

It took me a while to figure out the problem with Antonio's help: https://temporalio.slack.com/archives/C01DKSMU94L/p1708310456162399?thread_ts=1708279751.707509&cid=C01DKSMU94L

I thought I was following the docs here: https://docs.temporal.io/dev-guide/typescript/testing#replay. In particular, this example:

```typescript
const filePath = './history_file.json';
const history = await JSON.parse(fs.promises.readFile(filePath, 'utf8'));
await Worker.runReplayHistory(
  {
    workflowsPath: require.resolve('./your/workflows'),
  },
  history,
);
```

What I didn't realize however, and what I don't think is very obvious, is that the JSON format returned by the Web UI and the Temporal CLI differs from the format returned by the `fetchHistory()` method.

### Describe the solution you'd like

What I eventually found out is that I can use the `History.fromObject` function to turn the JSON object loaded from disk back into a `History` object that's accepted by `Worker.runReplayHistory`, e.g. this works:

```typescript
it('should replay an unpatched workflow history', async function () {
  const history = History.fromObject(JSON.parse((await fs.readFile('./unpatched-workflow-history.json')).toString()))
  Worker.runReplayHistory(DefaultWorkerOptions, history)
})
```

I also noticed that the `runReplayHistory` method already has some built-in logic to determine whether the `history` input value is a JSON object (from the Web UI or CLI) or a `History` object. What would be nice is if it could also detect where it's being passed a `History` object serialized into a JSON object. It could just use `History.fromObject` in that case, just like I am doing now, as IMHO this distinction between the different JSON formats is very easy to miss and the conversion could be handled automatically for the user.

### Additional context

Filing this feature request on the recommendation of Antonio as per our Slack conversation: https://temporalio.slack.com/archives/C01DKSMU94L/p1708310456162399?thread_ts=1708279751.707509&cid=C01DKSMU94L

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2024-02-20 15:51:50.000 UTC</summary>

You can‚Äôt use plain JSON serialization on histories, they‚Äôre supposed to be encoded in a proto JSON format.

if you want to save a history you downloaded with a client you‚Äôll need to use https://www.npmjs.com/package/proto3-json-serializer. runReplayHistory supports JSON histories in that format.

</details>

<details>
<summary><strong>jhecking</strong> commented on 2024-02-21 04:32:45.000 UTC</summary>

Ok. Like I said, the way I've solved this problem is that I use `History.fromObject()` to convert the serialised history back into a `History` object before replaying it.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-27 18:02:19.000 UTC</summary>

I recently added a `historyToJSON()` function in common's `proto-utils.ts`, to properly encode an existing History object to JSON, for internal purpose.

There's definitely user-side use cases for this, and implementing this correctly is far from trivial, due to bugs in `proto3-json-serializer`. We should therefore expose that function explicitly as part of some "Temporal Utils" API.

Reactions: üëç 2

</details>

<details>
<summary><strong>kp-eugene-kulabuhovs</strong> commented on 2025-08-06 12:44:26.000 UTC</summary>

@jhecking could you provide a full code example? I'm not sure where you got the `History.fromObject()` function from. As a workaround for this issue I've tried downloading history from UI base64 encoded - it worked, but not as readable.

</details>


---

<a id="1302"></a>

### #1302: [Bug] Node discards promises created by calling into Core Bridge with callback

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1302 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-11-21 21:32:41.000 UTC (2y 1m ago) |
| **Updated** | 2025-05-05 21:18:41.000 UTC |
| **Closed** | 2025-05-05 21:18:41.000 UTC |
| **Upvotes** | 4 |
| **Comments** | 0 |
| **Priority Score** | 8 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 4 |

#### Description

### Describe the bug

Our bridge-to-rust layer extensively use a pattern where native Rust code is called with a callback function, which gets called asynchronously on completion of some Rust-side operation; on the TS side, we use the `promisify` function from the `node:util` built-in module to create a `Promise` that will resolve when the native code eventually invoke the provided callback function.

It appears that in some cases (possibly related to ESM and/or use of worker threads), Node may fail to recognize that such promise may still eventually resolve, and may therefore discard the promise as non-resolved. When that happens, it may cause sudden termination of the Node process (with [exit code 13](https://stackoverflow.com/questions/64602114/why-is-node-exiting-with-exit-code-13-rather-than-hanging)) or of some worker thread (for example when running tests).

I believe this is due to the fact that callback functions are [not marked as "referenced"](https://nodejs.org/docs/latest-v21.x/api/n-api.html#deciding-whether-to-keep-the-process-running) by the native code when they get passed to non-node threads (eg. when passing them to the Tokio runtime thread). Unfortunately, Neon doesn't currently expose the Thread Safe Functions API, which would have been the proper way to fix this issue.

### Minimal Reproduction

> ‚ö†Ô∏è The reproduction code presented below explicitly calls the `Runtime.shutdown()` function. **That function is not meant for public usage**. Calling it explicitly should never be required, and the specific sequence demonstrated below is expected to actually fail by throwing an exception.
>
> This particular sequence was only kept because it is the simplest currently known sequence that predictably trigger the issue described above, ie. that execution of the code gets completely dropped in some situations, with the node process exiting with error 13, rather than properly waiting on the completion of the promise (which in this case, should result in an error being thrown). ‚ö†Ô∏è

1. Make sure `package.json` contains the `"type": "module"` directive.

2. Save the following code to a file named example.ts

    ```
    import { Runtime } from '@temporalio/worker';
    import { TestWorkflowEnvironment } from '@temporalio/testing';
    import { setTimeout } from 'node:timers/promises';
    
    const main = async () => {
      const runtime = Runtime.install({});
    
      console.log('Start test env start');
      const testEnvironment = await TestWorkflowEnvironment.createLocal();
      console.log('shutdown test env start');
      await testEnvironment.teardown();
      console.log('shutdown completed');
    
      console.log('shutdown runtime - start');
      try {
        await runtime.shutdown();
      } catch (e) {
        console.error(e);
      }
    
      console.log('shutdown runtime - stop');
    };
    
    await main();
    console.log('after main');
    ```

3. Execute that code with `tsx example.ts ; echo $?`, and observe the following output:

    ```
    Start test env start
    shutdown test env start
    shutdown completed
    shutdown runtime - start
    13
    ```

4. Modify the code by replacing the `await runtime.shutdown();` line by `await Promise.all([runtime.shutdown(), setTimeout(2000)]);`.

5. Run again with the same command, and observe the following result:

    ```
    Start test env start
    shutdown test env start
    shutdown completed
    shutdown runtime - start
    [UnexpectedError: channel closed]
    shutdown runtime - stop
    after main
    0
    ```

Note that the `[UnexpectedError: channel closed]` error is expected, as the runtime has already been shutdown after shutting down the test environment (because there was no more native resources being tracked by the runtime). This is not a problem by itself, but was simply kept as an easy way to demonstrate the present issue.

Running the same code in non-ESM context completes as expected.


---

<a id="1292"></a>

### #1292: [Bug] ESM Custom payload converters cannot be loaded

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1292 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-11-14 17:58:06.000 UTC (2y 1m ago) |
| **Updated** | 2025-01-16 00:47:53.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 6 |
| **Priority Score** | 8 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Use an ESM module as a custom payload converter.

### Describe the bug

When an ESM module is used as a custom payload converter, the SDK tries to `require` it, which results in the follow error:

https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/common/src/internal-non-workflow/data-converter-helpers.ts#L22

(from slack)

```
Error [ERR_REQUIRE_ESM]: require() of ES Module *****/services/asm-saas-worker/build/lib/payload-converter.js from /Users/nohehf/Documents/ESCAPE/product/node_modules/@temporalio/common/lib/internal-non-workflow/data-converter-helpers.js not supported.
Instead change the require of payload-converter.js in *****/node_modules/@temporalio/common/lib/internal-non-workflow/data-converter-helpers.js to a dynamic import() which is available in all CommonJS modules.
    at Hook._require.Module.require (*****/node_modules/require-in-the-middle/index.js:188:39)
    at requireConverter (*****/node_modules/@temporalio/common/lib/internal-non-workflow/data-converter-helpers.js:17:18)
    at loadDataConverter (*****/node_modules/@temporalio/common/lib/internal-non-workflow/data-converter-helpers.js:46:28)
    at compileWorkerOptions (*****/node_modules/@temporalio/worker/lib/worker-options.js:167:76)
    at Worker.create (*****/node_modules/@temporalio/worker/lib/worker.js:141:75)
    at createTemporalWorker (file://*****/packages/temporal-worker/build/index.js:21:33)
    at async file://*****/services/asm-saas-worker/build/index.js:44:16 {
  code: 'ERR_REQUIRE_ESM'
}
```

### Additional context

See the slack thread here (while the history is still retained): https://temporalio.slack.com/archives/C01DKSMU94L/p1699973888839069


#### Comments (6)

<details>
<summary><strong>nohehf</strong> commented on 2023-11-14 19:59:27.000 UTC</summary>

Thanks @bergundy for opening the issue, I'll report my findings here asap. I'm currently trying to find a way around this.

</details>

<details>
<summary><strong>nohehf</strong> commented on 2023-11-14 20:18:55.000 UTC</summary>

Here are the things I noticed while looking through the codebase:
The payload converter is loaded differently at: https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/common/src/internal-non-workflow/data-converter-helpers.ts#L22 and here https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/workflow/src/worker-interface.ts#L110

The payload converter is passed to Webpack via an alias: 
https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/worker/src/workflow/bundler.ts#L206

Whereas the other code that needs to be bundled (e.g. workflows code) is bundled in a file:
https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/worker/src/workflow/bundler.ts#L159

This might create some issues? I don't know how Webpack will resolve the aliases here, but as I have no issue importing ESM workflows, this might be the root cause.

Also, if I run this in my development mode (importing an ESM `.ts` payload converter) via [tsx](https://www.npmjs.com/package/tsx), so maybe it would help to bundle all the code via some modern bundler like [esbuild](https://github.com/evanw/esbuild) (which tsx uses) might help here (+ resolve other potential issues / add some benefits like speed).

Is there a particular reason why the bundle is in commonjs ? Just enforcing ESM seems to be the way to go nowadays. Also, node16 is not the LTS now.

PS: those are a few remarks I noted while trying to fix my issue, not critics, and I'm looking forward to helping/contributing here if possible; I hope this helps.

PS2: Also, having general guidelines / docs on how to pack our code (workflows, converters...) would be nice.

</details>

<details>
<summary><strong>nohehf</strong> commented on 2023-11-18 18:08:38.000 UTC</summary>

After a lot of trial and error, I could finally bundle my ESM code into a commonjs payload converter using `esbuild`.
Here's the command/settings that worked for me:
```bash
esbuild --bundle --outfile=build/index.cjs --target=esnext --platform=node --external:@temporalio/common --external:@bufbuild/protobuf src/index.ts
```
The key here was to externalize `@temporalio` dependencies from the bundle, causing issues if bundled. I also externalized the dependencies that could be imported from commonjs (here `@bufbuild/protobuf`).

Would you like to put this into the docs or integrate it into `@temporalio/worker` bundler?

</details>

<details>
<summary><strong>izakfilmalter</strong> commented on 2024-01-12 11:40:37.000 UTC</summary>

@nohehf are you using `bundleWorkflowCode`? Or are you creating your own bundle? Trying to understand how to make this work with https://github.com/temporalio/samples-typescript/tree/main/production

</details>

<details>
<summary><strong>nohehf</strong> commented on 2024-01-29 14:34:43.000 UTC</summary>

Hey @izakfilmalter
We use `bundleWorkflowCode` (indirectly through `Worker.create`).
We only manually bundle the converter to cjs via `esbuild` using the command above https://github.com/temporalio/sdk-typescript/issues/1292#issuecomment-1817586107. The converter is exported in a dedicated package and then imported using a require.
So in the end we have something like:
```ts
import * as activities from './activities/index.js';
// [...]
const connection = await NativeConnection.connect({ address: url });

const require = createRequire(import.meta.url);

const worker = await Worker.create({
  workflowsPath: require.resolve('./workflows/index.js'),
  taskQueue: 'my-ts-task-queue',
  activities,
  dataConverter: {
    payloadConverterPath: require.resolve('<organization>/temporal-converter'), // <organization>/temporal-converter being the package name in our yarn/npm workspaces
  },
});
```

Workflows and activities are written in TS ESM next.
Converter is bundled to cjs.
Hope this helps :))
PS: sorry for the delay, missed the notification somehow.

</details>

<details>
<summary><strong>rclmenezes</strong> commented on 2025-01-16 00:46:14.000 UTC</summary>

I ended up using tsup like this:

```javascript
// tsup.config.js
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/index.ts"],
  splitting: false,
  sourcemap: true,
  clean: true,
  outDir: "build",
  external: ["pg-native", "@temporal/common", "@bufbuild/protobuf"],
  target: "esnext",
});
```

And this in my package.json:
```json
{
  ...
  "scripts": {
    "build": "tsup --config tsup.config.js --dts",
    "dev": "dotenvx run --env-file=../app/.env --env-file=../app/.env.local --env-file=../app/.env.development -- pnpm tsx watch ./src/index.ts",
    "format": "prettier --write \"**/*.{ts,tsx,md}\"",
    "lint": "eslint ./src/*",
    "lint:fix": "pnpm lint --fix",
    "start": "node ./build/index.cjs",
    "start:dev": "dotenvx run --env-file=../app/.env --env-file=../app/.env.local --env-file=../app/.env.development -- pnpm tsx ./build/index.cjs",
    "typecheck": "tsc --noEmit"
  },
  ...
}
```

And to make my path work both in ESM and CJS:

```typescript
// worker.js

const currentDirname: string =
  typeof __dirname !== "undefined" ? __dirname : path.dirname(fileURLToPath(import.meta.url));

async function run() {
  const connection = await NativeConnection.connect({
    address: process.env.TEMPORAL_ADDRESS ?? "localhost:7233",
  });

  const worker = await Worker.create({
    workflowsPath: path.join(currentDirname, "../../../packages/workflows/src/workflows.ts"),
    activities,
    namespace: TEMPORAL_NAMESPACE,
    taskQueue: TEMPORAL_TASK_QUEUE,
    connection,
  });

  await worker.run();
}
```

Worked great

I still wish I could export as an ESM though... It would be lovely if @temporal/common didn't have dynamic requires

</details>


---

<a id="1021"></a>

### #1021: [Feature Request] async generator for cancellationScope

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1021 |
| **State** | OPEN |
| **Author** | Irvenae (Irven Aelbrecht) |
| **Created** | 2023-01-11 11:07:08.000 UTC (2y 12m ago) |
| **Updated** | 2025-02-07 03:50:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 8 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

I am using nested CancellationScopes to implement update logic and I want to be able to inject results from the previous iteration, where it was at that point. Mind that the internal cancellationScope could have a long duration.

For this I want to use an async generator, see snippet underneath.

I have 2 cancellationScopes, 1 for the update of the item and 1 for an update in the `cancellableComputeFn`. On each  `updateItemSignal` I want to run `cancellableComputeFn`. On each `updateSignal` I want to do a calculation.
At the end of the `cancellableComputeFn` I have a long sleep to wait for possible updates. On an update I don't want to lose progress of my itemRes. Mind that in reality this is split over a class so I can't use (variables known over the main() fn).

The reason to split it is to reuse the more generic item updating (and hide that from the specific computeFn).

```
async function main() {
	let updateScopeFn = new CancellationScope({ cancellable: true });
	let updateScopeItem = new CancellationScope({ cancellable: true });
	
	// In reality this handler is part of computationFn.
	setHandler(updateItemSignal, () => {
	  updateScopeItem.cancel();
	   updateScopeItem = new CancellationScope({ cancellable: true });
	   updateScopeFn = new CancellationScope({ cancellable: true, parent:  updateScopeItem });
	}
	setHandler(updateSignal, () => {
	   updateScopeFn.cancel();
	   updateScopeFn = new CancellationScope({ cancellable: true, parent: updateScopeFn.parent });
	}
		
	const cancellableComputeFn = async function* (itemRes) {
		let state = 'processing';
		let internalCount = itemRes.internalCount;
		while( state !== 'completed') {
			try {
				yield* updateScopeFn.run(async () => {
					internalCount += 1;
					yield {internalCount}; // Let 
					await sleep('1d');
					state = 'completed';
				}
			} catch(err) {
				// Catch cancellation error.
			}
		}
		return {internalCount};
	}
	
	// In my actual code this is a class such that I can place the updateScopeItem in this fn.
	const computationFn = async function () {
		let itemRes = {internalCount: 0};
		let state = 'processing';
		while( state !== 'completed') {
			// Do some other processing.
			try {
			  await updateScopeItem.run(async () => {
			  const computeFn = cancellableComputeFn(itemRes);
			  while (true) {
			    const { value, done } = await computeFn.next();
			    if (!done) {
			      itemRes = value;
			    }
			    if (done) {
			      return value;
			    }
			  }
			});
			state = 'completed';
			} catch(err) {
				// Catch cancellation error.
			}
		}
	}
	
	await computationFn();
}
```

Maybe you use other patterns to achieve this?



#### Comments (8)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-12 00:46:18.000 UTC</summary>

I'd write this workflow as shown below.
Does this look better to you?

```ts
export async function myWorkflow() {
  let internalCount = 0;
  for (;;) {
    try {
      await CancellationScope.cancellable(async () => {
        const scope = CancellationScope.current();
        setHandler(updateSignal, () => scope.cancel());
        for (;;) {
          try {
            await CancellationScope.cancellable(async () => {
              const scope = CancellationScope.current();
              setHandler(updateItemSignal, () => scope.cancel());
              internalCount++;
              await sleep('1d');
            });
            break;
          } catch (err) {
            // Catch cancellation error.
          }
        }
      });
      break;
    } catch (err) {
      // Catch cancellation error.
    }
  }
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-12 00:53:15.000 UTC</summary>

Or with a generator:

```ts
export async function myWorkflow() {
  async function* compute(internalCount = 0) {
    for (;;) {
      try {
        yield ++internalCount;
        await CancellationScope.cancellable(async () => {
          const scope = CancellationScope.current();
          setHandler(updateItemSignal, () => scope.cancel());
          await sleep('1d');
        });
        break;
      } catch (err) {
        // Catch cancellation error.
      }
    }
  }
  for (;;) {
    let internalCount = 0;
    try {
      await CancellationScope.cancellable(async () => {
        const scope = CancellationScope.current();
        setHandler(updateSignal, () => scope.cancel());
        for await (const c of compute(internalCount)) {
          internalCount = c;
        }
      });
      break;
    } catch (err) {
      // Catch cancellation error.
    }
  }
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-12 01:16:41.000 UTC</summary>

I think technically you can implement async generator support for cancellation scopes with something like this:

```ts
import { CancellationScope } from '@temporalio/workflow';
import { storage } from '@temporalio/workflow/lib/cancellation-scope';

export class MyCancellationScope extends CancellationScope {
  iter<I, F extends AsyncGenerator<I>>(f: () => F): AsyncGenerator<I> {
    return storage.run(this, f);
  }
}
```

`storage` is an internal API so I wouldn't recommend using it but if this solution works for you, I'd accept a contribution to the SDK to add the feature (with some proper tests).

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-01-12 08:11:08.000 UTC</summary>

Thanks for the quick response üöÄ 
There could be some nesting involved in the cancellationScopes in computeFn as well and some computations might be skipped dependent on the received signal, so moving out of the scope to do the yield isn't really an option.

So the example would be more like this.
```
async function* compute(internalCount = 0) {
    for (;;) {
      try {
        await CancellationScope.cancellable(async () => {
          const scope = CancellationScope.current();
          setHandler(updateSignal2, () => scope.cancel());
           // Do some other calculations.
		   internalCount = 2*internalCount;
          yield internalCount
          
          await CancellationScope.cancellable(async () => {
	          const scope = CancellationScope.current();
	          setHandler(updateSignalItem, () => scope.cancel());
	          yield ++internalCount;
	          
	          await sleep('1d');
	      });
        });
        break;
      } catch (err) {
        // Catch cancellation error.
      }
    }
  }
  ```

I will tryout the last suggestion.

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-01-12 10:57:34.000 UTC</summary>

Seems like that doesn't work. When you try to cancel the scope the iter method does not terminate.
how is this cancellation injected in the current run method?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-12 17:16:06.000 UTC</summary>

You should read the implementation of `CancellationScope`, it's fairly straightforward: https://github.com/temporalio/sdk-typescript/blob/main/packages/workflow/src/cancellation-scope.ts.
The heavy lifting is done by node's `AsyncLocalStorage`.

You might want to create scopes around each "sleep" or other `Promise`s awaited in your generator to have cancellable operations but I understand that it's not as elegant as having `CancellationScope` do this automatically for you.
You can create a helper as show here:

```ts
async function cancellableWithSignal(signalDef, fn) {
  return await CancellationScope.cancellable(async () => {
    const scope = CancellationScope.current();
    setHandler(signalDef, () => scope.cancel());
    await fn();
  });
}

async function* compute(internalCount = 0) {
    for (;;) {
      try {
        yield ++internalCount;
        await cancellableWithSignal(updateItemSignal, async () => {
          await sleep('1d');
        });
        break;
      } catch (err) {
        // Catch cancellation error.
      }
    }
  }
```

I can see why wrapping the generator with `storage.run` might not work properly since when you `yield` you're effectively leaving the scope.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-09 00:14:11.000 UTC</summary>

@Irvenae I'm curious what you ended up doing with this.

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2023-03-09 07:28:06.000 UTC</summary>

Worked around it for now by going out of the scope to do the yield ending up in ugly code...

</details>


---

<a id="756"></a>

### #756: [Bug] Support patched API inside condition.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/756 |
| **State** | CLOSED |
| **Author** | mfateev (Maxim Fateev) |
| **Created** | 2022-07-14 15:56:15.000 UTC (3y 6m ago) |
| **Updated** | 2024-02-01 19:09:37.000 UTC |
| **Closed** | 2024-02-01 19:09:36.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 6 |
| **Priority Score** | 8 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

A workflow is blocked on a condition.
```
await wf.condition(() => <some expression>)
```
A workflow has to be updated to block on a different condition expression. The naive way of

```
await wf.condition(() => patched("patchId") ? <new expression> : <old expression>) 
```
is not going to work. The problem is that condition is potentially called many times. And if the first time it is called the patch returns false then it will keep returning false even for the code that wasn't executed yet. A possible workaround is to use different patchId on every condition evaluation:

```
var i = 0;
await wf.condition(() => patched("patchId"+(i++)) ? <new expression> : <old expression>) 
```
### Proposal 

Do not require setting different patchId on every condition evaluation. The SDK should internally generate a different patch id on every call or do something else to avoid the wrong behavior. 


#### Comments (6)

<details>
<summary><strong>cretz</strong> commented on 2022-07-14 16:09:21.000 UTC</summary>

> The naive way of [...] is not going to work. The problem is that condition is potentially called many times. And if the first time it is called the patch returns false then it will keep returning false even for the code that wasn't executed yet. 

`patched` is safe for multiple executions and always gives the same bool value back for the same arguments for an entire workflow run from what I understand. Why is returning false all the time after the first time a bad thing? Is it possible to give a larger example showing how this would be a problem? I am a bit confused (may be due to my lack of understanding of how `patched` works).

(one option here is to make `patched()` be async which would disallow its use in the supposed-to-be-side-effect-free non-async `condition()` callback)

</details>

<details>
<summary><strong>mfateev</strong> commented on 2022-07-15 03:11:20.000 UTC</summary>

>  Why is returning false all the time after the first time a bad thing?

This is the same problem as using patched in a loop:
```
for (...) {
   if (patched("foo")) {
       activity2(...);
   } else {
      activity1(...);
  }
}
```
If the new code is deployed after a few iterations of the loop, the `activity2` will never be invoked even if loop makes a lot of new iterations. Users expect that each new iteration is going to use the new branch.

The issue is to allow using patched inside the condition to support the ability to update a condition expression _after_ the workflow is already blocked on the condition.



</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-15 03:47:50.000 UTC</summary>

> Users expect that each new iteration is going to use the new branch.

This is what happens though, I‚Äôm not following 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-15 03:55:07.000 UTC</summary>

> The issue is to allow using patched inside the condition to support the ability to update a condition expression after the workflow is already blocked on the condition.

patched already works this way today.
It evaluates to false during replay and once the marker is seen or workflow is no longer replaying it starts returning true. 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-16 13:43:17.000 UTC</summary>

@mfateev can we close this?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-01 19:09:36.000 UTC</summary>

That's already how TS SDK's `patch()` works.

</details>


---

<a id="456"></a>

### #456: [Feature Request] Add SAGA helpers?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/456 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-01 16:49:17.000 UTC (3y 11m ago) |
| **Updated** | 2023-05-11 17:24:00.000 UTC |
| **Closed** | 2023-05-11 17:23:59.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 4 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

[SAGA](https://microservices.io/patterns/data/saga.html) helpers are included in [Java](https://github.com/temporalio/samples-java/blob/main/src/main/java/io/temporal/samples/bookingsaga/TripBookingWorkflowImpl.java) and [PHP](https://github.com/temporalio/samples-php/blob/master/app/src/BookingSaga/TripBookingWorkflow.php) SDKs.

More info: https://temporaltechnologies.slack.com/archives/C01FT8U10GK/p1641244942124700

#### Comments (4)

<details>
<summary><strong>swyxio</strong> commented on 2022-02-03 13:14:47.000 UTC</summary>

i think worth it for parity and marketing

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-02-03 14:08:39.000 UTC</summary>

Can probably be done in samples, like encrypting data converters, instead of shipping the helpers. Yes Java has them included, but that doesn't mean we'd have to here or in Go or Python or .Net.

Reactions: üëç 2

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-02-04 01:31:22.000 UTC</summary>

coinbase-ruby has them as well. ultimately just need to see how nontrivial a good implementation is. we're not above providing sugar api's if it is a pattern we want to encourage

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 17:23:59.000 UTC</summary>

Decided not to do this for now, we'll reopen if we see demand.

</details>


---

<a id="274"></a>

### #274: [Feature Request] Signal total ordering

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/274 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-28 16:42:11.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-12 19:40:30.000 UTC |
| **Closed** | 2021-10-12 19:40:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 8 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

One issue @mfateev mentioned on the call yesterday is that some Temporal use cases require the processing of signals in the exact order they're received. We have a GH issue somewhere (I can't find it?) about how to do this for signals of a specific type, but I don't think it addressed doing it globally, across signal types.

### Describe the solution you'd like

In the workflow-object style, that could be the `signals` prop being an object or function:

```js
const MyWorkflow = () => ({
  execute() { ... },
  signals: {
    unblock(arg1, arg2) { ... }
  }
})


const TotalOrderWorkflow = () => ({
  execute() { ... },
  signals(type, arg1, arg2) {
    console.log(type) // "unblock"
  }
})
```

In the workflow-function style, that could be:

```js
function TotalOrderWorkflow(arg1, arg2, { signals }) {
  signals._globalHandler = () => {}
}
```

```js
function TotalOrderWorkflow(arg1, arg2, { registerSignalHandler }) {
  registerSignalHandler(() => {})
}
```

For how to ensure the first handling completes before the second handling starts, one option from the other issue is channels.

#### Comments (8)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-01 07:41:11.000 UTC</summary>

@lorensr I think you meant this issue: https://github.com/temporalio/sdk-node/issues/202

Reactions: üëç 1

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-07 22:21:20.000 UTC</summary>

Updated API for ordering within a single Signal type: add the `{ serial: true }` option, and SDK will not deliver the next signal of that type until:

- the previous Signal handler has returned, and
- if the return value is a Promise, the Promise has resolved

```js
export const unblockSignal = defineSignal<[]>('unblock', { serial: true });

export async function unblocked() {
  let isBlocked = true;
  unblockSignal.handler = () => (isBlocked = false);
}
```

Does this work for total ordering? For example, with this:

```js
export const unblockSignal = defineSignal<[]>('unblock', { serial: true });
export const fooSignal = defineSignal<[]>('foo', { serial: true });
```

Can we make sure `unblockSignal.handler`'s Promise resolves before we deliver the `foo` Signal?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-07 23:10:52.000 UTC</summary>

I'm also against the idea of making the SDK handle this. As Roey mentioned in the other issue this is pretty trivial for a user to implement with a mutex-like concept or however else they might like.

It's too easy to run into this problem where you gum up signal delivery. We could fix *that* by verifying you handled all signals in the WFT or else we fail it, but, now we have more complexity there etc etc. Seems like something that's very reasonable to expect the user to do if they desire it.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-08 20:54:54.000 UTC</summary>

Roey's alternative was channel-based. If we do channels, do we have to do the channel-flushing step before stopping the workflow/`continueAsNew`ing? Is there another way? Would this work?

```js
import { defineSignal, on } from '@temporalio/workflow';

export const unblockSignal = defineSignal('unblock');
export const fooSignal = defineSignal('foo');

export async function myWorkflow() {
  const queue = [];

  on(unblockSignal, (...args) => queue.push({ type: 'unblock', args }));
  on(fooSignal, (...args) => queue.push({ type: 'foo', args }));  

  while (true) {
    await condition(() => queue.length);
    const nextSignal = queue.shift();
    await process(nextSignal);
  }
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-09 03:38:41.000 UTC</summary>

This is great @lorensr, it won't compile in TS strict mode but I'd save this example.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-09 15:50:03.000 UTC</summary>

Okay, so in lieu of adding a feature to the SDK, we can add this example to the [docs page](https://docs.temporal.io/docs/node/signals-queries)‚Äîafter we explain `{ serial: true }`

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-11 01:03:42.000 UTC</summary>

I don't think we're going to do `serial: true`.
We can suggest using https://www.npmjs.com/package/async-mutex for serial processing.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 19:40:30.000 UTC</summary>

Closing this for now.
As mentioned above this is all possible to implement in "userspace".
If we get enough requests for this we'll revisit.

</details>


---

<a id="219"></a>

### #219: [Feature Request] Opentracing Support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/219 |
| **State** | CLOSED |
| **Author** | jmoseley (Jeremy Moseley) |
| **Created** | 2021-09-01 00:18:34.000 UTC (4y 4m ago) |
| **Updated** | 2021-10-28 17:06:52.000 UTC |
| **Closed** | 2021-10-28 17:06:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 8 |
| **Priority Score** | 8 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

We use OpenTracing in our existing worker (written in Go), but have been using the Node client to trigger workflows. Because the client does not yet have Golang support, we do not have full traces for the workflow.

### Describe the solution you'd like

I should be able to leverage my existing opentracing infrastructure to create spans when a workflow is triggered, and have this span encapsulate the entire workflow, including all activities.


#### Comments (8)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 08:41:38.000 UTC</summary>

This is supported by the SDK but you'll need to implement an opentracing interceptor on your own.
For reference, check out the opentelemetry interceptors package: https://github.com/temporalio/sdk-node/tree/main/packages/interceptors-opentelemetry

</details>

<details>
<summary><strong>jmoseley</strong> commented on 2021-09-10 16:04:37.000 UTC</summary>

Does the opentelemetry instrumentation integrate well will the existing opentracing instrumentation in the Go SDK? Does the trace IDs cross the boundary? I want to be able to trace between client calls (eg `ExecuteWorkflow`) and see spans in the Workflow with the same trace ID.

I think that Temporal uses headers to transfer this context, but its very challenging to trace exactly how that works.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 10:58:50.000 UTC</summary>

Is there an official temporal opentracing library for golang?
The node version uses this header: https://github.com/temporalio/sdk-node/blob/main/packages/interceptors-opentelemetry/src/workflow/index.ts#L19 and expects the value to be an otel `SpanContext`, it's decoded from payload (JSON) using data converter.
https://github.com/open-telemetry/opentelemetry-js-api/blob/a752e7f814e7b335e50705d281cb2c6e1bd38a35/src/trace/span_context.ts#L23

</details>

<details>
<summary><strong>jmoseley</strong> commented on 2021-09-13 18:48:12.000 UTC</summary>

> Is there an official temporal opentracing library for golang?

Yes, you can pass an Opentracing tracer to the golang SDK client. This gives you traces around activity execution.

https://github.com/temporalio/sdk-go/blob/e8455cbe8014d2587a2b72ce153ae490160d9b11/internal/client.go#L390

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-14 08:38:18.000 UTC</summary>

I wasn't aware of this, thanks!

IMO the interceptors will probably not be compatible.
We'll have to prioritize adding this, contributions are welcome.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-09-17 00:00:54.000 UTC</summary>

@jmoseley Where does your opentracing data end up? Opentelemetry exporters most likely exist for wherever that's going to.

As for having the spans connect, even if everything was going through opentracing I'm not sure they'd be attached properly as it stands, that might only work when everything is in Go. That's something I'm going to be looking into pretty soon, at least in the context of getting Opentelemetry spans shared between Node and the underlying rust Core connected.  Getting them connected with server is also on the menu but might take a bit.

</details>

<details>
<summary><strong>jmoseley</strong> commented on 2021-09-17 00:07:59.000 UTC</summary>

It's flowing to Datadog. They have an opentelemetry solution, but it requires some extra infrastructure that I'd prefer to avoid if possible.

We have spans connecting across languages with API calls originating from Go activities, and I just want to close the loop with API calls that kick off workflows.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-17 14:54:55.000 UTC</summary>

The spans connect with opentelemetry if the workflow starter is in **node**.
Activities started from the workflow are also connected to the same parent span.

</details>


---

<a id="1582"></a>

### #1582: [Bug] 1.11.2 workflow histories failing to replay on 1.11.5

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1582 |
| **State** | CLOSED |
| **Author** | selbyk (Selby Kendrick) |
| **Created** | 2024-12-10 22:00:40.000 UTC (1 years ago) |
| **Updated** | 2025-04-16 13:29:44.000 UTC |
| **Closed** | 2025-04-16 13:29:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëÄ 3 |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->
We want to update to the latest and have been running `@temporalio/*@1.11.2` since 9/25/24. I tried to update to `@temporalio/*@1.11.5` a few days ago and was faced with:
```
2024-12-10T21:41:34.484512Z  WARN temporal_sdk_core::worker::workflow: Failing workflow task run_id={{runId}} failure=Failure { failure: Some(Failure { message: "[TMPRL1100] Nondeterminism error: Child workflow id of scheduled event 'task/{{uuid}}' does not match child workflow id of command 'task/{{different_uuid}}'", source: "", stack_trace: "", encoded_attributes: None, cause: None, failure_info: Some(ApplicationFailureInfo(ApplicationFailureInfo { r#type: "", non_retryable: false, details: None, next_retry_delay: None })) }), force_cause: NonDeterministicError }
Replay failed https://cloud.temporal.io/namespaces/{{namespace}}/workflows/{{wfid}}/{{runid}}
DeterminismViolationError: Replay failed with a nondeterminism error. This means that the workflow code as written is not compatible with the history that was fed in. Details: Workflow activation completion failed: Failure { failure: Some(Failure { message: "[TMPRL1100] Nondeterminism error: Child workflow id of scheduled event 'task/{{uuid}}' does not match child workflow id of command 'task/{{different_uuid}}'", source: "", stack_trace: "", encoded_attributes: None, cause: None, failure_info: Some(ApplicationFailureInfo(ApplicationFailureInfo { r#type: "", non_retryable: false, details: None, next_retry_delay: None })) }), force_cause: NonDeterministicError }
    at evictionReasonToReplayError (/Users/selby/projects/monorepo/node_modules/.pnpm/@temporalio+worker@1.11.5_@swc+helpers@0.5.6_esbuild@0.21.5/node_modules/@temporalio/worker/lib/replay.js:34:20)
    at Worker.runReplayHistories (/Users/selby/projects/monorepo/node_modules/.pnpm/@temporalio+worker@1.11.5_@swc+helpers@0.5.6_esbuild@0.21.5/node_modules/@temporalio/worker/lib/worker.js:228:76)
    at async replayWorkflows (/Users/selby/projects/monorepo/apps/temporal-workers/workflow-tests/replay.ts:2:3826)
    at async replayWorkflowsInEnv (/Users/selby/projects/monorepo/apps/temporal-workers/workflow-tests/replay.ts:2:4907)
    at async replay (/Users/selby/projects/monorepo/apps/temporal-workers/workflow-tests/replay.ts:2:6297) 
```
on almost all of some of our workflow history types, including our latest histories. They seem to replay fine on `@temporalio/*@1.11.3`.

### Describe the bug

We use `uuid4()` (from `@temporalio/workflow`) to generate a `workflowId` => `task/uuid4()`, and we use that `workflowId` in `startChild({ workflowId })`. We replay all running and up to the last 500 completed histories on each of our workflow types on every PR/deploy, and this part of our code and the replays have been stable for months.

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

Maybe we can find a minimal reproduction together. I just want to get this on your radar.
<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M2 Mac and Linux (GH Actions)
- Temporal Version: 1.11.5

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (7)

<details>
<summary><strong>mjameswh</strong> commented on 2025-03-13 18:26:16.000 UTC</summary>

Hey @selbyk! Would you be able to provide a bit more information regarding this error?

</details>

<details>
<summary><strong>selbyk</strong> commented on 2025-04-09 18:35:21.000 UTC</summary>

Yeah, sorry for the delay. We were really hoping this was going to be a more widespread issue that would be resolved quickly. We're still on v1.11.2.

We have decided to make it a priority this sprint to investigate what's happening. Our core workflows are rather complex, so I will dig in and try to distill down to the root of it as best I can. I'll report back when I have something to share.

</details>

<details>
<summary><strong>selbyk</strong> commented on 2025-04-10 14:52:58.000 UTC</summary>

@mjameswh Ok, this morning I finally had some time to get on this. We have 3 workflows that have replay discrepancies between v1.11.2 and v1.11.7. Two of them are very complex, but fortunately one of them is relatively small and straight forward.

How do we go from here? What is valuable to help with this on your end?

Reactions: üëç 1

</details>

<details>
<summary><strong>selbyk</strong> commented on 2025-04-10 19:44:58.000 UTC</summary>

So, we have narrowed down the cause on our small, straight forward workflow. It appears like a breaking change to the behavior of `signalWithStart`.

I downloaded the workflow history and used the Temporal VS Code extension to run v1.11.2 and v1.11.7 in the debugger:

```ts
export const mvpWorkflow: MVPWorkflow.Definition = async ({
	webhooks = [],
}) => {
	setHandler(webhookPayload, (incomingWebhook) => { // Breakpoint 1
		webhooks.push(incomingWebhook);
		logger.debug('mvpWorkflow incoming webhook', { // Breakpoint 2
			webhooks,
			incomingWebhook,
		});
	});

	if (webhooks.length > 0) { // Breakpoint 3
		const lastWebhook = webhooks.at(-1)!;
		webhooks = [];
		logger.debug('processing webhook', {
			lastWebhook,
			webhooks,
		});
		await processUpdateOrCreate({ data: lastWebhook });
	}

	await sleep('1m');

	if (webhooks.length > 0) {
		return await continueAsNew<typeof mvpWorkflow>({
			metadata,
			webhooks,
		});
	}
};
```

v1.11.2 hits breaks in this order: `1`, `2`, `3` (webhooks.length = 1)

v1.11.7 hits breaks in this order: `1`, `3` (webhooks.length = 0), `2`

And expectedly, the v1.11.7 replay fails because the `processUpdateOrCreate` activity is never hit.

I will look into our other two workflows as well. One of those also uses `signalWithStart` heavily so I expect it to be the same issue, but the other one doesn't so I'll start there.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-04-11 18:01:50.000 UTC</summary>

@selbyk Thanks for the updates.

Assuming the webhookPayload signal is dispatched as part of the first workflow task (which is guaranteed to be the case when workflow is started using `signalWithStart`), the order should indeed be 1-2-3. This has never changed.

I can't reproduce the 1-3-2 sequence on my side. The following code gives me 1-2-3 in both 1.11.2 and 1.11.7. This is also the order I get if I put breakpoints on those three lines and replay using the Temporal VS Code extension using SDK 1.11.7.

```
// workflows.ts
export async function example(): Promise<void> {
  console.log('### checkpoint 1');
  setHandler(defineSignal('mySignal'), async () => {
    console.log('### checkpoint 2');
  });
  console.log('### checkpoint 3');
}

// client.ts
const handle = await client.workflow.signalWithStart(example, {
  taskQueue: 'repro',
  workflowId: 'workflow-' + nanoid(),
  signal: 'mySignal',
});
```

Can you try to work from this code and see if you can replicate the issue you are seeing?

</details>

<details>
<summary><strong>selbyk</strong> commented on 2025-04-15 21:27:04.000 UTC</summary>

@mjameswh I'm not sure what you want to do with this issue, but just to follow up for anyone else who may run into it and winds up here. We ended up hopping on a call last week and, thanks to James and Thomas, traced the issue(s) back to changes in the OpenTelemetry interceptors.

We fixed our non-determinism errors by patching the interceptors:
```ts
class OTELInboundInterceptor extends OpenTelemetryInboundInterceptor {
	public handleSignal(input: SignalInput, next: Next<WorkflowInboundCallsInterceptor, 'handleSignal'>): Promise<void> {
		if (patch) {
			// Patch needed because of a change in OpenTelemetryInboundInterceptor that broke determinism
			return super.handleSignal(input, next);
		}
		return next(input);
	}
}

class OTELOutboundInterceptor extends OpenTelemetryOutboundInterceptor {
	public async scheduleLocalActivity(
		input: LocalActivityInput,
		next: Next<WorkflowOutboundCallsInterceptor, 'scheduleLocalActivity'>,
	): Promise<unknown> {
		if (patch) {
			// Patch needed because of a change in OpenTelemetryOutboundInterceptor that broke determinism
			return super.scheduleLocalActivity(input, next);
		}
		return next(input);
	}
}
```

Replace `patch` with your patch.

Thank you again for so much of your time tracking down the issue. Next time I should be able to narrow it down further before opening a ticket with better details.

Reactions: üéâ 2

</details>

<details>
<summary><strong>selbyk</strong> commented on 2025-04-16 13:29:43.000 UTC</summary>

I see https://github.com/temporalio/sdk-typescript/issues/1677 was opened to cover this, so closing this one.

</details>


---

<a id="1423"></a>

### #1423: [Bug] Unexpected behaviour related to CancellationScope.nonCancellable

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1423 |
| **State** | CLOSED |
| **Author** | zijianzz |
| **Created** | 2024-05-21 13:11:37.000 UTC (1y 7m ago) |
| **Updated** | 2024-07-15 23:17:10.000 UTC |
| **Closed** | 2024-07-15 23:17:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->
Use condition with timeout inside nonCancellable scope, and wait a signal to unlock condition await

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

Hello, I recently saw a weird behaviour which I don‚Äôt know if it‚Äôs normal or not because I didn‚Äôt find any documentation related to this subject. Here is a test code I used to reproduce this issue

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->
```
export async function runCancellableActivity(): Promise<void> {
  try {
    await sleep(1000000);
  } catch (err) {
    await CancellationScope.nonCancellable(async () => {
      try {
        console.log('condition');
        await condition(() => false, 10000); // worked good for => await condition(() => false);
      } catch (error) {
        console.log('still error', error);
      }
    });
    throw err;
  }
}
```
### Minimal Reproduction
my condition is wrapped inside nonCancellable scope, if I understood well, CancelledFailure should never propagated into this scope but it‚Äôs not always the case, if I decide to give a timeout to my condition. my app did printed still error on console with CancelledFailure exception.

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor:  Mac Intel
- Temporal Version: SDK 1.8.6 -> 1.9.2
- Are you using Docker or Kubernetes or building Temporal from source? I used docker and locally host cluster

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2024-05-21 21:11:19.000 UTC</summary>

What Node version?

</details>

<details>
<summary><strong>zijianzz</strong> commented on 2024-05-22 05:11:26.000 UTC</summary>

> What Node version?

I tested in both 16 and 18, I got the same result

</details>

<details>
<summary><strong>cirias</strong> commented on 2024-05-24 01:03:44.000 UTC</summary>

I run into the same issue. This is because the timeout feature in condition is implemented through a cancellable CancellationScope. And a cancellable CancellationScope cancels when any of its parent scope cancels, even when the parent is nonCancellable.

The problem is why a scope could still be cancelled even when it's inside a nonCancellable scope. Intuitively a cancellable scope in a nonCancellable scope should only be cancelled by call `cancel` method directly on the scope object.

My guess is, when the root scope is cancelled, the workflow should propagates the cancel to all cancellable scope even it's in a nonCancellable scope. But we probably need an option to disable this feature.

</details>

<details>
<summary><strong>cirias</strong> commented on 2024-05-24 01:21:56.000 UTC</summary>

@zijianzz I've been using this hack function as a walk-around.

```
async function conditionTimeout(fn: () => boolean, timeout: Duration): Promise<void> {
  // here should check all parents is cancellable
  // in my use case this is enough
  if (CancellationScope.current().cancellable) {
    return condition(fn, timeout).then((pass) => {
      if (!pass) {
        throw ApplicationFailure.nonRetryable('condition timed out');
      }
    });
  }

  return Promise.race([
    // it's impossible to cancel this sleep later after the race resolved,
    // because if as long as you wrap it in a cancellable scope, it cancels immediately 
    // when any of the parent scopes cancelled, 
    // making it the same behavior as the original condition function.
    sleep(timeout).then(() => {
      throw ApplicationFailure.nonRetryable('condition timed out');
    }),
    condition(fn),
  ]);
}
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-24 14:41:13.000 UTC</summary>

Thanks for the repro. It looks like the behaviour for the cancelable/non-cancellable/cancellable case was never clearly defined, and the effective behaviour is definitively problematic. We'll discuss that internally.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-05-24 17:55:28.000 UTC</summary>

I don't think it was not clearly defined, just not properly implemented.
We'll need to fix this with a patch that ensures we don't break history compatibility.

</details>

<details>
<summary><strong>cirias</strong> commented on 2024-05-26 00:30:39.000 UTC</summary>

Thanks @mjameswh @bergundy ! While you discuss the cancellable/non-cancellable cases, please also consider the case of activity cancellation. Currently, to cancel an activity can only be achieved by calling it inside a cancelablescope. Given the current behavior of "cancel on root cancels all", we can't create a cancelable activity when the workflow is cancelled. Because the activity wrapped in a cancelablescope will be cancelled/skipped immediately.

In general, the problem is the during the cleanup process, when a workflow is cancelled, we still need the ability to control when to cancel some execution. For example, to use condition with timeout during the cleanup, or call an activity but also want to have the ability to cancel it later during the cleanup. Right now, since it cancels everything, we lose the control of cancellation.

</details>


---

<a id="1396"></a>

### #1396: [Feature Request] Better error details on why ephemeral test server didn't start

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1396 |
| **State** | CLOSED |
| **Author** | mikeroelens (Mike Roelens) |
| **Created** | 2024-04-19 15:00:21.000 UTC (1y 8m ago) |
| **Updated** | 2024-04-24 21:07:36.000 UTC |
| **Closed** | 2024-04-24 21:04:53.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 5 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.
Right now in CI we're randomly getting `Failed to start ephemeral server: Failed connecting to test server after 5 seconds` errors when calling `TestWorkflowEnvironment.createLocal`.  But there's no indication as to why the test server couldn't be started.

The relevant code in sdk-core is [here](https://github.com/temporalio/sdk-core/blob/409e74ec8e80ae4c1f9043e8b413b1371b65f946/core/src/ephemeral_server/mod.rs#L314). Looks like an attempt is made to start the ephemeral test server, then connect attempts every 100ms for 5s, if not connected at that point throw an error. 

**Key Problem:** No idea why the test server didn't start

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

### Describe the solution you'd like

A clear error reason logged as to why the test server didn't start. Right now it's also impossible to tell if there was an error or if the server was just slow to startup (e.g. maybe it would've started fine after 6s). 

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (5)

<details>
<summary><strong>cretz</strong> commented on 2024-04-19 15:06:06.000 UTC</summary>

> But there's no indication as to why the test server couldn't be started.

Usually there is stdout/stderr from the subprocess if there's an issue, so I think we need to debug your problem specifically and see what it is and if we can improve logs/output on this specific situation.

> when calling `TestWorkflowEnvironment.createLocal`

I assume you're using TypeScript? Can you try setting the `server` option for that call with a `log` with a `level` of `info` or `debug`? But that may not show anything either. This should just download latest non-RC of https://github.com/temporalio/cli and execute `temporal server start-dev`.

</details>

<details>
<summary><strong>mikeroelens</strong> commented on 2024-04-19 15:49:59.000 UTC</summary>

Thank you for the fast reply! Great call, let me see what I can do to improve logging. Yes we're using TypeScript. Looks like we were actually only setting `level: 'warn'`, we'll see if `'debug'` sheds some light ü§û 

</details>

<details>
<summary><strong>mikeroelens</strong> commented on 2024-04-19 19:03:40.000 UTC</summary>

Hi @cretz I've had no luck trying a bunch of different things. I've created a barebones reproducible example to show what I'm experiencing. If you can check it out that would be much appreciated üôè 

https://github.com/mikeroelens/temporal-test-server-error-debugging

</details>

<details>
<summary><strong>cretz</strong> commented on 2024-04-21 14:11:33.000 UTC</summary>

Transferring to `sdk-typescript` repo for help here (if it is indeed something we should fix in Core we can transfer back)

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-04-24 21:07:35.000 UTC</summary>

@mikeroelens Thanks for reporting. This has just been fixed.

> On posix platforms, stdout and stderr were not properly inherited by ephemeral servers, which meant that users would get no detail of why the server failed to start.
>
> For details: NodeJS is setting FD_CLOEXEC on all of its standard file descriptors (stdin, stdout, stderr), which means that these file descriptors are not inherited by child processes‚Ä¶ Now, the child_process module emulates the inheritance behavior by explicitly passing the file descriptor to new processes by default, so that‚Äôs not a problem when spawn is called from JS code. But it will bite you when you spawn from native code, for example when starting an ephemeral server through Core SDK‚Ä¶

</details>


---

<a id="1353"></a>

### #1353: [Bug] some metrics are not prefixed with "temporal_"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1353 |
| **State** | CLOSED |
| **Author** | antmendoza (Antonio Mendoza P√©rez) |
| **Created** | 2024-02-07 14:19:03.000 UTC (1y 11m ago) |
| **Updated** | 2024-07-16 22:51:41.000 UTC |
| **Closed** | 2024-07-16 22:51:40.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 5 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

### Describe the bug

Some metrics emited by the sdk are not prefixed with "temporal_", concretely `request` and `long_request`  



> url=http://localhost:9090/
> curl -s $url/api/v1/label/name/values | jq -r ".data[]" | sort
¬†
long_request
long_request_latency_bucket
long_request_latency_count
long_request_latency_sum
request
request_latency_bucket
request_latency_count
request_latency_sum
temporal_activity_execution_latency_bucket
temporal_activity_execution_latency_count
temporal_activity_execution_latency_sum
temporal_activity_poll_no_task
temporal_activity_schedule_to_start_latency_bucket
temporal_activity_schedule_to_start_latency_count
temporal_activity_schedule_to_start_latency_sum
temporal_activity_task_received
temporal_num_pollers
temporal_sticky_cache_hit
temporal_sticky_cache_size
temporal_worker_start
temporal_worker_task_slots_available
temporal_workflow_completed
temporal_workflow_endtoend_latency_bucket
temporal_workflow_endtoend_latency_count
temporal_workflow_endtoend_latency_sum
temporal_workflow_task_execution_latency_bucket
temporal_workflow_task_execution_latency_count
temporal_workflow_task_execution_latency_sum
temporal_workflow_task_queue_poll_empty
temporal_workflow_task_queue_poll_succeed
temporal_workflow_task_replay_latency_bucket
temporal_workflow_task_replay_latency_count
temporal_workflow_task_replay_latency_sum
temporal_workflow_task_schedule_to_start_latency_bucket
temporal_workflow_task_schedule_to_start_latency_count
temporal_workflow_task_schedule_to_start_latency_sum


This happen with v.1.9.0 and v.1.9.1, v1.8.6 seems ok 


<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (5)

<details>
<summary><strong>paymog</strong> commented on 2024-02-07 16:33:31.000 UTC</summary>

I'm also seeing a metric called `target_info` which doesn't have that prefix

```
# HELP long_request Count of long-poll request successes by rpc name
# HELP long_request_failure Count of long-poll request failures by rpc name
# HELP long_request_latency Histogram of client long-poll request latencies
# HELP request Count of client request successes by rpc name
# HELP request_latency Histogram of client request latencies
# HELP target_info Target metadata
# HELP temporal_activity_execution_latency Histogram of activity execution latencies
# HELP temporal_activity_poll_no_task Count of activity task queue poll timeouts (no new task)
# HELP temporal_activity_schedule_to_start_latency Histogram of activity schedule-to-start latencies
# HELP temporal_activity_task_received Count of activity task queue poll successes
# HELP temporal_num_pollers Current number of active pollers per queue type
# HELP temporal_sticky_cache_hit Count of times the workflow cache was used for a new workflow task
# HELP temporal_sticky_cache_size Current number of cached workflows
# HELP temporal_worker_start Count of the number of initialized workers
# HELP temporal_worker_task_slots_available Current number of available slots per task type
# HELP temporal_workflow_completed Count of successfully completed workflows
# HELP temporal_workflow_continue_as_new Count of continued-as-new workflows
# HELP temporal_workflow_endtoend_latency Histogram of total workflow execution latencies
# HELP temporal_workflow_failed Count of failed workflows
# HELP temporal_workflow_task_execution_latency Histogram of workflow task execution (not replay) latencies
# HELP temporal_workflow_task_queue_poll_empty Count of workflow task queue poll timeouts (no new task)
# HELP temporal_workflow_task_queue_poll_succeed Count of workflow task queue poll successes
# HELP temporal_workflow_task_replay_latency Histogram of workflow task replay latencies
# HELP temporal_workflow_task_schedule_to_start_latency Histogram of workflow task schedule-to-start latencies
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-19 15:31:58.000 UTC</summary>

@Sushisource I haven't yet dug into this one, but from a very quick look, it seems like the metrics that don't have the `temporal_` prefix come from the Rust client.

This is a regression introduced in TS SDK 1.9.0, so very likely related to the major metrics refactor done ~6 months ago. Does that ring a bell? Can you think of anything that we may have missed on the TS SDK/bridge side that would explain this?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-02-19 15:33:13.000 UTC</summary>

@antmendoza Would you mind checking if Python has the same issue?

</details>

<details>
<summary><strong>antmendoza</strong> commented on 2024-02-19 17:53:08.000 UTC</summary>

@mjameswh the current prometheus example https://github.com/temporalio/samples-python/tree/main/prometheus shows all metrics with temporal_ prefix 

it uses [python-sdk 1.5.0](https://github.com/temporalio/sdk-python/releases/tag/1.5.0) 

https://github.com/temporalio/samples-python/blob/6bcab28f85461c13e594ebc15ec3a111533a3ae7/pyproject.toml#L20 




Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-07-16 22:51:40.000 UTC</summary>

Fixed by #1441.

</details>


---

<a id="1325"></a>

### #1325: [Bug] Throwing an exception from a workflow may result in `Failed to activate workflow` due to `DataCloneError`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1325 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-12-21 00:15:52.000 UTC (2 years ago) |
| **Updated** | 2025-06-24 14:36:20.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 3 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Describe the bug

Throwing a non-Error and non-Failure exception and letting that exception bubble up out of the Workflow function causes activation failure (due to `DataCloneError`) if that object contains non-serializable objects.

Even though a `Failed to activate workflow` error message mentioning `DataCloneError` is visible in the log, the original exception is not accessible, making it difficult to figure out the origin of the failure.

We need to figure out how this situation can be handled better.

For example:
- We could consider serializing sink arguments immediately at the call site, rather than delaying that until completion of the activation, which would allow reporting the `DataCloneError` error in context (and also let's make that error message more obvious).
- By using a custom Serializer object, it might be possible to intercept serialization errors, and automatically replace problematic object by some safe alternative (ie. a JSON representation of that object, a string saying that item could not be serialized, etc).

### Minimal Reproduction

1. Execute the following workflow

```
class MyCustomError {
  public readonly x: any;
  constructor(public message: string) {
    this.x = () => 1;
  }
}

export async function exampleWorkflow(): Promise<void> {
  throw new MyCustomError('Intentional error');
}
```

2. Observe that execution produces the following error:

```
2023-12-20T23:39:49.741Z [ERROR] Failed to activate workflow {
  namespace: 'default',
  taskQueue: 'hello-world',
  workflowId: 'workflow-X0CYgbSxElPenLeMFU68e',
  runId: '3fe2dbe4-8f71-4755-9bee-b6fc4d02cac4',
  workflowType: 'example',
  error: DataCloneError: ()=>1 could not be cloned.
      at new DOMException (node:internal/per_context/domexception:53:5)
      at MessagePort.<anonymous> (/Users/jwatkins/Development/Temporal/TypeScriptSDK/samples-typescript/hello-world/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:20),
  workflowExists: true
}
```

3. Note that activation don't fail and no `DataCloneError` is thrown if the `MyCustomError` class is modified to extend `Error` (the workflow task still fails, which is expected), as follows:

```
class MyCustomError extends Error {
  public readonly x: any;

  constructor(public message: string) {
    super(message);
    this.x = () => 1;
  }
}
```

### Details

There are few factors contributing to this issue:
- The Workflow Worker automatically logs exceptions that bubble up out of the workflow function;
- The V8 Serialization can't serialize some type of objects (including functions), and throws a `DataCloneError` on encountering a non-serializable object.
- As the list of all sink calls is transferred from the worker thread to the main thread as a single message, the failure to encode a single object causes the whole operation to fail.

#### Comments (3)

<details>
<summary><strong>jan-stehlik</strong> commented on 2024-01-16 10:49:47.000 UTC</summary>

hey @mjameswh thanks for writing this up, we are experiencing the same behaviour. Do you have any idea when this might be picked up / prioritised? Thanks

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-22 15:20:18.000 UTC</summary>

@jan-stehlik If your workflow is throwing exceptions that results in a `DataCloneError`, then the proper thing to do is to intercept those exceptions and throw something that can be safely serialized using the V8 serialization algorithm, such as an `ApplicationFailure` or a class that extends `Error`.

This ticket is not about _resolving_ the fact that throwing non-serializable objects results in a `DataCloneError`, as this is inherent to the V8's serialization algorithm and we have pretty much no control on it, but rather to make it easier for users to understand these situations and figure out where the non-serializable object come from.

Reactions: üëç 2

</details>

<details>
<summary><strong>Jac0xb</strong> commented on 2025-06-24 14:36:20.000 UTC</summary>

I got this same error from the following (reset to right before the error and got the callstack)

```
  at Object.condition (/app/node_modules/.pnpm/@temporalio+workflow@1.11.8/node_modules/@temporalio/workflow/src/workflow.ts:1051:32)
    at condition (/app/backend/packages/temporal/src/transaction_indexer/head-sync.workflow.ts:74:40)

    at race (/app/backend/packages/temporal/src/transaction_indexer/head-sync.workflow.ts:74:20)
```


The Line

```
await Promise.race([sleep("15s"), condition(() => signaled)]);
```


```
[temporal-worker] 2025-06-24T14:35:30.813Z [ERROR] Failed to process Worklow Activation {
[temporal-worker]   sdkComponent: 'worker',
[temporal-worker]   taskQueue: '-----',
[temporal-worker]   runId: '5445c4de-3fcd-461f-a165-8f0acd6df6c5',
[temporal-worker]   namespace: 'default',
[temporal-worker]   workflowId: '6srGWWzz6aaEG2qjuBKdGQX7Dzenhnd9ZBVEeEJ6g9z2/head',
[temporal-worker]   workflowType: 'headSyncWorkflow',
[temporal-worker]   error: DataCloneError: [object Promise] could not be cloned.
[temporal-worker]       at new DOMException (node:internal/per_context/domexception:53:5)
[temporal-worker]       at MessagePort.<anonymous> (/app/node_modules/.pnpm/@temporalio+worker@1.11.8_@swc+helpers@0.5.17/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:20),
[temporal-worker]   workflowExists: true
[temporal-worker] }
```

</details>


---

<a id="1265"></a>

### #1265: [Bug] Webpack's output clog worker logs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1265 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-10-18 21:49:46.000 UTC (2y 2m ago) |
| **Updated** | 2025-01-28 21:31:20.000 UTC |
| **Closed** | 2025-01-28 21:31:18.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 3 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Describe the bug

Webpack calls `log()` repeatedly, and include lot of ANSI-color escape sequences.

This is fine and nice when logs are going straight to console, but horrible and hard to understand when logs are captured into some external system (eg. GitHub Actions logs, Datadog, Cloud Watch, etc).

We should gather Webpack log output into a single, structured log entry.

![image](https://github.com/temporalio/sdk-typescript/assets/6412169/1b527c44-44f1-4b43-88d2-ebc8dc2afad8)

#### Comments (3)

<details>
<summary><strong>alexjesp</strong> commented on 2023-10-25 09:20:45.000 UTC</summary>

I've just got around this by doing using a custom bundle with a custom Webpack logger (Typescript):

```js
import path from 'path';
import { bundleWorkflowCode } from '@temporalio/worker';
import c from 'ansi-styles';

// ...other code

const someFunction = async () => {
  const { workflowBundle, logEntries } = await collectLogs((logFn) => bundle('my-workflow', logFn));
  const bundleLogs = logEntries.map(({ message }) => c.unstyle(message)).join('\n');

  console.debug(`Worker bundled: ${workflow.name}`, { bundleLogs }); // unstyled webpack logs in one log
}

const bundle = async (
  workflowName,
  logFn: Logger,
): Promise<WorkflowBundleWithSourceMap> => {
  const workflowBundle = await bundleWorkflowCode({
    workflowsPath: path.resolve(__dirname, '..', workflowName),
    logger: logFn,
  });
  return workflowBundle;
};

// collects all logs emitted by fn
const collectLogs = async <T>(
  fn: (logFn: Logger) => Promise<T>,
): Promise<{ result: T; logEntries: LogEntry[] }> => {
  const logEntries: LogEntry[] = [];

  const logFn = new DefaultLogger(LOG_LEVEL, entry => logEntries.push(entry)); // custom webpack logger
  const result = await fn(logFn);

  return {
    result,
    logEntries,
  };
};
```

Reactions: üéâ 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-11-02 21:50:02.000 UTC</summary>

Thanks for sharing!

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 21:31:18.000 UTC</summary>

Resolved in #1414.

</details>


---

<a id="1124"></a>

### #1124: [Feature Request] Add `upsertMemo` command

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1124 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-05-26 00:37:11.000 UTC (2y 7m ago) |
| **Updated** | 2024-07-23 14:38:47.000 UTC |
| **Closed** | 2024-07-23 14:38:47.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 1 |
| **Priority Score** | 7 |
| **Labels** | enhancement, good first issue |
| **Assignees** | antlai-temporal |
| **Milestone** | None |
| **Reactions** | üëç 3 üëÄ 1 |

#### Description

### Describe the solution you'd like

- Add `upsertMemo` command to Workflow API.

### Additional context

- Underlying support already exists in Core SDK.


#### Comments (1)

<details>
<summary><strong>tharun208</strong> commented on 2023-12-15 16:05:41.000 UTC</summary>

@mjameswh I like to work on this

Reactions: üëç 1

</details>


---

<a id="1081"></a>

### #1081: [Proposal] Built-in registered handlers query

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1081 |
| **State** | CLOSED |
| **Author** | josiah-roberts (Josiah "Rebase" Roberts) |
| **Created** | 2023-03-16 17:15:35.000 UTC (2y 10m ago) |
| **Updated** | 2025-01-21 18:39:26.000 UTC |
| **Closed** | 2025-01-21 18:39:25.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 5 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

[Link to thread](https://temporalio.slack.com/archives/C01DKSMU94L/p1678908893942829) with @bergundy

### Is your feature request related to a problem? Please describe.

There's a common need to keep track of what queries and signals are legal to send to a workflow _at this moment_. My team is creating a layer for this internally, but it would be ideal to solve it on a SDK level.

### Describe the solution you'd like

I'd like to see a built-in query which returns the queries and signals being currently listened to. This could take two forms:

**Separate**  
* A `QueryDefinition<Array<string>, []>` named `queries`
* A `QueryDefinition<Array<string>, []>` named `signals`

**Together**
* A `QueryDefinition<Array<{ name: string, type: 'query' | 'signal' }>, []>` named `handlers`

In either case, we can't preserve the _type information_ about these queries or signals, but we can at least maintain the knowledge of whether there is an active `setHandler(name, () => {...})` for a given name. This allows us to drive UX experiences that only allow **_currently legal_** operations, which is a powerful technique for code-as-source-of-truth on our workflows.

### Additional context

Here's a spike implementation for a `trackHandler` shim over `setHandler` that we're working on internally. Workflows need to be wrapped with `trackHandlers` in the form `export const myWorkflow = (args: Args) => trackHandlers(myWorkflowImpl, args);`. _If this was built-in, such wrapping would not be needed._

```typescript
const trackedHandlerStorage = new AsyncLocalStorage<Set<string>>();
const getTrackedHandlers = () => {
  const handlers = trackedHandlerStorage.getStore();
  if (!handlers) {
    throw new IllegalStateError('Not in a tracked context!');
  }
  return handlers;
};

export const trackHandler: typeof setHandler = (def, handler) => {
  const handlers = getTrackedHandlers();
  handlers.add(def.name);
  setHandler(def, ((...args) => {
    trackedHandlerStorage.enterWith(handlers);
    if (handler) {
      return handler(...(args as Parameters<typeof handler>));
    }
    return undefined;
  }) as typeof handler);
};

export const clearHandler = (def: Parameters<typeof setHandler>[0]) => {
  const handlers = getTrackedHandlers();
  handlers.delete(def.name);
  setHandler(def, undefined);
};

export const clearHandlers = (defs: Array<Parameters<typeof setHandler>[0]>) => {
  for (const def of defs) {
    clearHandler(def);
  }
};

export const handlersQuery = defineQuery<string[]>('handlers');
export const trackHandlers = <R, TArgs extends any[]>(
  callback: (...args: TArgs) => R,
  ...args: TArgs
): R =>
  trackedHandlerStorage.run(new Set(), () => {
    const handlersRef = getTrackedHandlers();
    trackHandler(handlersQuery, () => [...handlersRef]);
    return callback(...args);
  });
```

#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2023-03-16 19:16:11.000 UTC</summary>

Thank you for this, I‚Äôm mostly afk until the end of the week. I‚Äôll take some time to think about this and respond.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-24 23:55:20.000 UTC</summary>

Haven't forgotten about this.
I want @cretz to review the response structure for the built-in query because we want this cross SDKs and he's really good and opinionated at API design.

</details>

<details>
<summary><strong>cretz</strong> commented on 2023-03-27 15:00:19.000 UTC</summary>

I made a comment at https://github.com/temporalio/features/issues/51#issuecomment-1485273243

Even though it contains a lot of details, can ignore most and just impl the "get workflow metadata" query to start with. We do need this as protos in https://github.com/temporalio/api/tree/master/temporal/api/sdk/v1 though, not just TS definitions.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-27 16:52:39.000 UTC</summary>

@antlai-temporal Can we close this ticket? I believe you implemented that in #1319. Anything left here?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-21 18:39:25.000 UTC</summary>

Covered by the metadata query. Done.

</details>


---

<a id="1008"></a>

### #1008: [Feature Request] Provide more output when webpack fails

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1008 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-12-30 22:02:50.000 UTC (3 years ago) |
| **Updated** | 2024-03-13 19:02:26.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 3 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

User: 

> I am getting this error, and it is hard to debug unless I know what source files are leading to these dependencies

![image](https://user-images.githubusercontent.com/251288/210114544-c461f592-fb1b-45d0-9b74-3e7b90a988b3.png)


### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

<img width="759" alt="image" src="https://user-images.githubusercontent.com/251288/210114537-ef82df07-90cf-4103-b31d-9ccf61d5c4f7.png">


#### Comments (3)

<details>
<summary><strong>nadilas</strong> commented on 2024-03-10 08:49:07.000 UTC</summary>

Hey guys, @bergundy @lorensr any workarounds available until this get's sorted?

</details>

<details>
<summary><strong>0xsiddharthks</strong> commented on 2024-03-13 07:25:05.000 UTC</summary>

+1. Been stuck on this for a while.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-03-13 19:02:25.000 UTC</summary>

Not yet.

If anyone wants to try this out, we may get more information from webpack by customizing the output if `hasError` is true in this line:

https://github.com/temporalio/sdk-typescript/blob/b38c70c2a5656a0e5fd2b3891cf2cc65b425e315/packages/worker/src/workflow/bundler.ts#L265

</details>


---

<a id="948"></a>

### #948: [Bug] Error is blank in `Failed to activate workflow` messages

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/948 |
| **State** | CLOSED |
| **Author** | yolken-airplane (Benjamin Yolken) |
| **Created** | 2022-11-03 02:42:15.000 UTC (3y 2m ago) |
| **Updated** | 2023-06-07 00:35:10.000 UTC |
| **Closed** | 2023-06-06 19:54:17.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 3 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### What are you really trying to do?

We're trying to detect when workflows fail to activate and return a reason back to our users.

### Describe the bug

We have some workflows that fail to activate due to timeouts and other issues. The worker outputs a `Failed to activate` message with an error, but it seems like this error is always empty, i.e. `"error":{}`. The "real error" is visible in a `TRACE` message later on, but that message doesn't have as much context and also sometimes doesn't appear (not sure why). 

It would be nice if the original `Failed to activate` message had more information on what happened.

Here's an example of the logs when the activation failure is due to a timeout:

```
[TRACE] Creating workflow {"namespace":"default","taskQueue":"hello-world","workflowId":"workflow-rB1OaMvJNTlJ0Qb6aZGp2","runId":"44fdc3ad-1e89-4676-8f37-1b73595031a5","workflowType":"example"}
[DEBUG] Workflow started {"namespace":"default","taskQueue":"hello-world","workflowId":"workflow-rB1OaMvJNTlJ0Qb6aZGp2","runId":"44fdc3ad-1e89-4676-8f37-1b73595031a5","workflowType":"example"}
[ERROR] Failed to activate workflow {"namespace":"default","taskQueue":"hello-world","workflowId":"workflow-rB1OaMvJNTlJ0Qb6aZGp2","runId":"44fdc3ad-1e89-4676-8f37-1b73595031a5","workflowType":"example","error":{},"workflowExists":true}
[TRACE] Got workflow activation {"jobs":[{"removeFromCache":{"message":"Workflow activation completion failed: Failure { failure: Some(Failure { message: \"Script execution timed out after 5000ms\", source: \"TypeScriptSDK\", stack_trace: \"Error: Script execution timed out after 5000ms\", encoded_attributes: None, cause: None, failure_info: None }) }","reason":"LANG_FAIL"}}],"runId":"44fdc3ad-1e89-4676-8f37-1b73595031a5","timestamp":{"seconds":"1667442437","nanos":223436135},"historyLength":6}
[TRACE] Disposing workflow {"runId":"44fdc3ad-1e89-4676-8f37-1b73595031a5"}
```

### Minimal Reproduction

Make the following changes to the ["hello-world" example](https://github.com/temporalio/samples-typescript/tree/main/hello-world):

1. Add a `while(true) {}` in the workflow `example` function
2. (Optional) Turn on trace logging in the worker via something like:

```
  const logger = new DefaultLogger("TRACE", ({ level, message, meta }) => {
    if (meta) {
      console.log(`[${level}] ${message} ${JSON.stringify(meta)}`);
    } else {
      console.log(`[${level}] ${message}`);
    }
  });
  Runtime.install({ logger });
```

### Environment/Versions

- OS and processor: M1 Mac
- Temporal Version: v1.18.1 (server), 1.4.3 (SDK)
- Are you using Docker or Kubernetes or building Temporal from source? Using temporalite

### Additional context

N/A

#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-06 19:52:12.000 UTC</summary>

Indeed. Let me add some context, as others are likely to stumble again on this issue.

This is actually the correct behavior in JavaScript, even though it surprises most of us. For example, try running `JSON.stringify(new Error('message'))` in a basic JS program, and you get an empty object.
```
$ node -e "console.log(JSON.stringify(new Error('message')))"
> {}
```

The reason for this is that [`JSON.stringify` only goes down on _enumerable own properties_](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify), whereas `Error.message` and `Error.stackTrace` are not enumerable properties.

Why then are these fields visible on the "Got workflow activation" line? Because at that point, you no longer have an `Error` object, but rather a `TemporalFailure` object that has been constructed from that error.

Possible solutions to this includes:
- Use [Node's `util.format(err)`](https://nodejs.org/api/util.html#utilformatformat-args) instead of `JSON.stringify(err)`
- Define `Error.prototype.toJSON` to a function that returns a non-`Error` object that contains all of the `Error`'s properties:
  ```
  Object.defineProperty(Error.prototype, 'toJSON', {
    value(this: any) {
      const alt: any = {};
      
      Object.getOwnPropertyNames(this).forEach((key) => {
        alt[key] = this[key];
      }, this);
      
      return alt;
    },
    configurable: true,
    writable: true,
  });
  ```
- Provide a replacer function to `JSON.stringify` (ie. `JSON.stringify(obj, () => {})`)
- Use [the `serialize-error` package](https://github.com/sindresorhus/serialize-error)

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-06 19:54:16.000 UTC</summary>

Now, regarding the TS SDK itself, I can't find any problematic case as of 1.7.3. The repro code above works correctly if not using the custom logger, or with the custom logger modified to use `util.format` instead of `JSON.stringify`.

Reactions: üéâ 2

</details>

<details>
<summary><strong>yolken-airplane</strong> commented on 2023-06-07 00:35:10.000 UTC</summary>

@mjameswh thanks for this explanation!

</details>


---

<a id="869"></a>

### #869: temporal-sdk-core-0.1.0: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/869 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-09-16 21:58:42.000 UTC (3y 3m ago) |
| **Updated** | 2024-01-02 17:59:11.000 UTC |
| **Closed** | 2024-01-02 17:59:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>temporal-sdk-core-0.1.0</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/core-bridge/Cargo.toml</p>
<p>Path to vulnerable library: /packages/core-bridge/Cargo.toml</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (temporal-sdk-core version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2018-16875](https://www.mend.io/vulnerability-database/CVE-2018-16875) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | webpki-0.22.0.crate | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2018-16875</summary>


###  Vulnerable Library - <b>webpki-0.22.0.crate</b></p>

<p>Web PKI X.509 Certificate Verification.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/webpki/0.22.0/download">https://crates.io/api/v1/crates/webpki/0.22.0/download</a></p>
<p>Path to dependency file: /packages/core-bridge/Cargo.toml</p>
<p>Path to vulnerable library: /packages/core-bridge/Cargo.toml</p>
<p>

Dependency Hierarchy:
  - temporal-sdk-core-0.1.0 (Root Library)
    - reqwest-0.11.18.crate
      - webpki-roots-0.22.6.crate
        - :x: **webpki-0.22.0.crate** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The crypto/x509 package of Go before 1.10.6 and 1.11.x before 1.11.3 does not limit the amount of work performed for each chain verification, which might allow attackers to craft pathological inputs leading to a CPU denial of service. Go TLS servers accepting client certificates and TLS clients are affected.

<p>Publish Date: 2018-12-14
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2018-16875>CVE-2018-16875</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-fh2r-99q2-6mmg">https://github.com/advisories/GHSA-fh2r-99q2-6mmg</a></p>
<p>Release Date: 2018-12-14</p>
<p>Fix Resolution: golang 1.10.6,golang 1.11.3, webpki - 0.22.2, rustls-webpki - 0.100.2,0.101.4</p>

</p>

<p></p>

</details>

#### Comments (7)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-09-19 23:57:07.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-09-29 01:16:07.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-19 02:51:30.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-01-10 22:15:42.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-04-13 16:27:38.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-29 17:18:07.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2024-01-02 17:59:10.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="834"></a>

### #834: [Bug] test-npm-init rate limited in CI 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/834 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-20 18:08:59.000 UTC (3y 4m ago) |
| **Updated** | 2022-09-16 21:54:49.000 UTC |
| **Closed** | 2022-09-16 21:54:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

This PR did not fix the rate limit failure:

https://github.com/temporalio/sdk-typescript/pull/721

I can't tell why. If we put a Cloudflare domain in front of `api.github.com`, we can switch both create and test packages to that domain (related: #782).

#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2022-09-09 00:49:58.000 UTC</summary>

Why does this access the GH API?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-09-09 01:46:48.000 UTC</summary>

fetches things from https://api.github.com/repos/

https://github.com/temporalio/sdk-typescript/search?q=api.github.com

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-09 04:26:15.000 UTC</summary>

Got it, so it‚Äôs just for downloading a folder from  the repo, yeah we can fix this with a cdn too

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-09 04:27:56.000 UTC</summary>

If this happens rarely let‚Äôs punt on it for now and save the complication 

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-09-09 05:32:02.000 UTC</summary>

Not rare IME

On Fri, Sep 9, 2022 at 12:28 AM Roey Berman ***@***.***>
wrote:

> If this happens rarely let‚Äôs punt on it for now and save the complication
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/834#issuecomment-1241485327>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AAB5LGDDD5JACS3XVDEJ6XTV5K4FPANCNFSM57DSR3YQ>
> .
> You are receiving this because you authored the thread.Message ID:
> ***@***.***>
>


</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-13 17:52:44.000 UTC</summary>

Looks like we weren't sending the auth header in one of the requests, I'm fixing this.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-13 18:05:38.000 UTC</summary>

https://github.com/temporalio/sdk-typescript/pull/865/commits/3aea4dee7ae298ea2b4c57aed3946bf3d35fbae4

I'm marking that PR as closing this issue, we can reopen if we see it again.

</details>


---

<a id="732"></a>

### #732: [Feature Request] Allow ability to track workflow/activity input with open telemetry spans

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/732 |
| **State** | CLOSED |
| **Author** | meg2208 (Matt Garbis) |
| **Created** | 2022-06-29 05:25:57.000 UTC (3y 6m ago) |
| **Updated** | 2022-12-28 06:07:24.000 UTC |
| **Closed** | 2022-06-29 23:40:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Was trying out the interceptors-opentelemetry sample and got it successfully pushing to datadog, which is great. The issue is that it doesn't send the activity input/outputs and I would like that to be send up to datadog for easier searching and analysis.

### Describe the solution you'd like

Looking at the opentelemetry sdk, `tracer.startActiveSpan` has an [another available signature](https://github.com/open-telemetry/opentelemetry-js-api/blob/6dd34e234eaa984f00a4c9339b16fddad7d7ea46/src/trace/tracer.ts#L91) where you can pass in a `SpanOptions` object and this has a field called `attributes` which lets you attach an arbitrary mapping of metadata to the span.

I think the best thing to do is to update `InstrumentOptions` to have an additional optional field called `attributes` whose type can be `SpanAttributes` (matching the type in `SpanOptions.attributes`) and then pass that to `SpanOptions` as `{ attributes }`. When calling `instrument` you can build the attributes object from the input args plus other important identifying fields.

I'm thinking this can be a global configuration (something like boolean `includeAttributes`) that come as an input to the interceptors.

Looking forward to hearing your thoughts!


#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-29 23:39:17.000 UTC</summary>

Instead you can add another interceptor to the chain after the otel interceptor and add the attributes you want to the current span:
```ts
const span = otel.trace.getSpan(otel.context.active())
span?.setAttributes(attributes)
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-29 23:40:41.000 UTC</summary>

I'm closing this issue, you can reopen if you think that there's a better solution 

</details>

<details>
<summary><strong>meg2208</strong> commented on 2022-06-30 20:36:05.000 UTC</summary>

Thanks for the reply. I was able to get that to work. Thanks!

</details>

<details>
<summary><strong>meg2208</strong> commented on 2022-06-30 21:39:46.000 UTC</summary>

@bergundy Do you know which interceptor I can use to pull the activity and workflow outputs?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-06-30 22:26:20.000 UTC</summary>

The output is the return value of `next()`. 

https://typescript.temporal.io/api/interfaces/workflow.workflowinboundcallsinterceptor/

So maybe something like this:

```ts
export class MyInterceptor implements WorkflowInboundCallsInterceptor {
  public async execute(
    input: WorkflowExecuteInput,
    next: Next<WorkflowInboundCallsInterceptor, 'execute'>
  ): Promise<unknown> {
    const span = otel.trace.getSpan(otel.context.active())
    span?.setAttributes({ args: input.args })
    
    const result = await next(input)
    span?.setAttributes({ result })
    
    return result
  }
}
```

If you can post what you get working, that would help others! And I can make it into a sample.

Reactions: ‚ù§Ô∏è 2

</details>

<details>
<summary><strong>meg2208</strong> commented on 2022-07-01 14:07:04.000 UTC</summary>

Sounds good. I can post it. Do you prefer it as a branch, fork, or just post the full diff here? I made changes to 4 or so files.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-12-28 06:07:24.000 UTC</summary>

@meg2208 sorry for the delay‚Äîif you're still up for it, a PR to the [otel sample](https://github.com/temporalio/samples-typescript/tree/main/interceptors-opentelemetry) would be most helpful ‚ò∫Ô∏è Otherwise post just the relevant code, or the commit link if it's a public repo.

</details>


---

<a id="665"></a>

### #665: [Feature Request] Allow for easy mocking 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/665 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-24 22:57:17.000 UTC (3y 7m ago) |
| **Updated** | 2024-12-20 22:12:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Mocking an SDK function is difficult. If you use a system [like Sinon](https://sinonjs.org/how-to/stub-dependency/) that depends on default exports, it doesn't work, since we don't do default exports. Even if you use a system like Jest that allows you to mock the whole package, there are two issues:

- Unless your code only uses a single function, you have to mock or add back in the other functions. This, for instance, creates a package that only exports `proxyActivities`:

```ts
const mockRequest = jest.fn<Promise<string>, []>();
mockRequest.mockResolvedValue('3');

test('httpWorkflow with mocked proxyActivities', async () => {
  jest.mock('@temporalio/workflow', () => ({
    proxyActivities: mockRequest,
  }));

  expect(await httpWorkflow()).toBe('The answer is 3');
});
```

- When you mock, you have to recreate the environment. For instance, if you run the above, you get:

```
 FAIL  src/workflows.test.ts (9.489 s)
  ‚óè httpWorkflow with mocked proxyActivities

    TypeError: exports.storage.getStore is not a function

      14 |
      15 | export async function httpWorkflow(): Promise<string> {
    > 16 |   const answer = await makeHTTPRequest();
         |                        ^
      17 |   return `The answer is ${answer}`;
      18 | }
      19 |

      at Function.current (node_modules/@temporalio/workflow/src/cancellation-scope.ts:156:20)
      at node_modules/@temporalio/workflow/src/workflow.ts:151:37
      at scheduleActivityNextHandler (node_modules/@temporalio/workflow/src/workflow.ts:150:10)
      at scheduleActivity (node_modules/@temporalio/workflow/src/workflow.ts:259:10)
      at node_modules/@temporalio/workflow/src/workflow.ts:493:18
      at httpWorkflow (src/workflows.ts:16:24)
      at Object.<anonymous> (src/workflows.test.ts:67:28)
```

### Solution

The current solution in the case of `proxyActivities` is to run a Worker with a test connection and mock activities ([like this](https://github.com/temporalio/samples-typescript/blob/622f40bada8438972d62c9e7f6f500fe6695dd33/activities-examples/src/workflows.test.ts#L47)), and to start a workflow using the test client. If you want to test a helper function used by workflows, then tell the Worker the helper is a workflow and start it, like this:

```ts
// workflow-helpers.ts
export function myHelper() { ... }
```

```ts
// workflow-helpers.test.ts
  const worker = await Worker.create({
    workflowsPath: require.resolve('./workflow-helpers'),
    ...
  });
  await withWorker(worker, async () => {
    const result = await workflowClient.execute(myHelper, {
      workflowId: uuid4(),
      taskQueue: 'test',
    });
    expect(result).toEqual('The answer is 99');
  });  
```

### Feedback

If the current solution described above doesn't work for your case, or isn't ideal for you, let us know in this thread! ‚ò∫Ô∏è

#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2022-05-24 23:14:33.000 UTC</summary>

You can mock the workflow functions but you need to it from the vm context otherwise it‚Äôll have no effect. I agree it‚Äôs hard to set up but probably possible with sinon (haven‚Äôt tried though). Not sure how much value there is to mocking parts of the workflow instead of using the test environment  

</details>

<details>
<summary><strong>rcarton</strong> commented on 2022-07-19 14:41:50.000 UTC</summary>

After a lot of trial and error, the least obtrusive method I've found is to use rewire and sinon:

```ts
// In workflow, must use `let` instead of const
let { getCustomerActivity } =
  proxyActivities<typeof activities>({
    startToCloseTimeout: "1 minute",
  });
```

```ts
// Test utils
type Activities = typeof activities;
type StubbedActivity<T extends keyof Activities> = sinon.SinonStub<
  Parameters<Activities[T]>,
  ReturnType<Activities[T]>
>;

// Taken from https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/rewire/index.d.ts
interface RewiredModule {
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  __set__(obj: { [variable: string]: any }): () => void;

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  __set__(name: string, value: any): () => void;

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  __get__<T = any>(name: string): T;

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  __with__(obj: { [variable: string]: any }): (callback: () => any) => any;
}

/**
 * Stub an activity
 *
 * @param sandbox a sandbox that you will be restore()'d after the test
 * @param module a rewired module
 * @param activity the name of the activity you want to stub
 */
export function getProxyActivityStub<T extends keyof Activities>(
  sandbox: sinon.SinonSandbox,
  module: RewiredModule,
  activity: T
): StubbedActivity<T> {
  const stub = sandbox.stub();
  module.__set__(activity, stub);
  return stub as StubbedActivity<T>;
}
```

```ts
// In test file
const Workflow = rewire(
  "@temporal-worker/workflows/workflow"
);

const sandbox = sinon.createSandbox();

const getCustomerActivityStub = getProxyActivityStub(
  sandbox,
  Workflow,
  "getCustomerActivity"
);
```




</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-19 19:58:08.000 UTC</summary>

Glad you got it working, we'll be working on improving this experience in the future

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-04 19:22:56.000 UTC</summary>

For the record and public visibility, here is a working proof of concept I developed a few months ago for mocking child workflows. The great things with this approach are 1) multiple tests can be performed using the same workflow.ts file (other methods require one workflow.ts per test case), 2) it ends up calling a callback function in the unit test context, so its easy to make test assertions there. This is probably not the way we'll end up implementing this in SDK, but can be useful to users that want this now. See below for limitations.

It works in three steps: first, an interceptor is used to catch `startChildWorkflow` calls from the Workflow under test, and replaces the workflow type of the child workflow to be started by a predefined "mock workflow" type. Second, the implementation of that "mock workflow" type calls an activity named "mockWorkflowActivity", passing it inputs received from the Workflow under test. Finally, activity type "mockWorkflowActivity" is registered directly on the test Worker.

Are are implementation instructions:

1. In workflow.ts (the one used by unit test), add this workflow:
```
export async function mockChildWorkflow(...args: unknown[]): Promise<string> {
  return await scheduleActivity('mockWorkflowActivity', args, { scheduleToCloseTimeout: '5s' });
}
```

2. Next to test files, create a file named mock-child-workflow-interceptor.ts, containing the following code:
```
import { WorkflowInterceptorsFactory } from '@temporalio/workflow';

export const interceptors: WorkflowInterceptorsFactory = () => {
  return {
    outbound: [
      {
        startChildWorkflowExecution(input, next) {
          return next({
            ...input,
            options: {
              ...input.options,
              args: [input.workflowType, ...input.options.args],
            },
            workflowType: 'mockChildWorkflow',
          });
        },
      },
    ],
  };
};
```

3. In unit test where we want to mock child workflows, define a function named `mockWorkflowActivity` and register it as an activity on the worker; also register the previously created interceptor. Assuming mocha, that could for example give:
```
  it('Mock child workflows', async () => {
    const { client, nativeConnection } = testEnv;

    function mockWorkflowActivity(workflowType: string, ...args: unknown[]): unknown {
      return 'test';
    }

    const worker = await Worker.create({
      connection: nativeConnection,
      taskQueue: 'test',
      workflowsPath: require.resolve('./workflows'),
      activities: { ...activities, mockWorkflowActivity },
      interceptors: { workflowModules: [require.resolve('./mock-child-workflow-interceptor')] },
    });

    await worker.runUntil(async () => {
      const result = await client.workflow.execute(parentWorkflow, {
        workflowId: uuid4(),
        taskQueue: 'test',
        args: ['alice', 'bob', 'charlie'],
      });
      assert.equal(result, 'test\ntest\ntest');
    });
  }).timeout(20000);
```

Note some caveats with this implementation:
- Exceptions ‚Äî Throwing from the mock workflow activity won‚Äôt result in the same thrown exception at the workflow level.
- Timing ‚Äî The mock workflow activity will have to return pretty quickly, where as the actual child workflow may have stayed alive for some time.
- Signals ‚Äî This implementation won‚Äôt work if you need the parent and child workflows to exchange signals.
- All or nothing ‚Äî The current implementation intercepts all child workflow executions. It can‚Äôt be selective on which invocations are to be catch. It would not be hard however to fix.

Reactions: üëç 5 üéâ 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-07-05 15:06:49.000 UTC</summary>

I like where you're going with this @mjameswh.

A few places where this can be expanded:
- Integration of this solution and make it easier to use and more configurable
- Integrations with mock frameworks as config packages
- Give control over which workflow types get mocked
- Make this not an activity so it (possibly, need to verify) doesn't affect time skipping (would need to introduce a new concept (`*`))
- Try an approach where mocks run in workflow context
- Add signal support
- Add exception translation support

`*` We were talking about a local activity that doesn't produce a marker that can be used in query handlers and update validators, this could be helpful here too.

Reactions: üëç 1

</details>

<details>
<summary><strong>gaurav1999</strong> commented on 2024-06-28 05:19:10.000 UTC</summary>

Here's an example if anyone's looking to test parent workflows executing child workflows.

Your workflow code -> src/workflows/order.workflow.ts [Parent]

Order workflow code executes a bunch of activities, and one child workflow called `sendNotificationWorkflow`.

In order to test order.workflow.ts and use mock child workflow `sendNotificationWorkflow` while testing.

Create a separate file src/workflow/tests/test-order.workflow.ts

```
export * from '../order.workflow.ts'; //Exporting the original order workflow since we want to test it's original code as it is

//Mock child workflow
export async function sendNotificationWorkflow(
    email: string,
   
  ): Promise<boolean> {
    return true;
}
```

And now, put this file in your worker worfklowsPath option so that it loads the code of your original workflow, and mock code of your child workflow

```

const worker = await Worker.create({
      connection: nativeConnection,
      taskQueue,
      workflowsPath: require.resolve('./test-order.workflow.ts'),
      activities,
      debugMode: true
 });
```

This works well for me!

I think, the idea is, that it's easier to give a mocked context to worker, rather rewiring the SDK components. 

Reactions: üëç 1

</details>

<details>
<summary><strong>chadxz</strong> commented on 2024-12-20 22:12:43.000 UTC</summary>

I was able to hack something together that worked for me based on @mjameswh's suggestion, but it definitely does not feel like a supported first-class experience. It would be great if I could pass mock workflows directly to Worker.create() similar to how the activities are provided.

In my scenario, I was using `startChild` in my workflow, which is async. I was having trouble with my tests being flaky, because worker.runUntil was returning before the mocked activity was called, so my assertion was failing. I put in a `for await` loop to wait for the remaining workflows to complete before allowing the worker to shutdown. Perhaps there's a better way to do that, though...

something like this:
```ts
await worker.runUntil(async () => {
  await client.workflow.execute(myWorkflowToBeTested, {
    workflowId: randomUUID(),
    taskQueue: "MyQueue",
    args: ["foo"],
  });

  for await (const { workflowId, runId } of client.workflow.list()) {
    await client.workflow.getHandle(workflowId, runId).result();
  }
});
```

</details>


---

<a id="614"></a>

### #614: [Bug] `ShutdownError: Core is shut down` error when running in jest 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/614 |
| **State** | CLOSED |
| **Author** | airhorns (Harry Brundage) |
| **Created** | 2022-04-26 14:23:53.000 UTC (3y 8m ago) |
| **Updated** | 2022-05-29 20:58:16.000 UTC |
| **Closed** | 2022-05-29 20:58:16.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 5 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Integrate temporal workflows into an existing TypeScript application tested using jest

### Describe the bug

I am able to create and complete workflows in one jest test file using helpers similar to those found in `sdk-typescript`'s repo, but as soon as I start using the client / workers in multiple jest test files, I get strange `ShutdownError: Core is shut down` or `ShutdownError: Core is shut down and there are no more workflow replay tasks` errors. These errors seem to occur after the workers have successfully completed open workflows and activities, and seem to happen somewhat inconsistently.

### Minimal Reproduction

Find a repro here: https://github.com/airhorns/temporal-jest

You must run multiple test files at once to trigger the issue.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: macOS 12.3.1, Intel Core i7
- Temporal Version: temporalite with `@temporalio/worker@0.21.1`
- No docker, k8s

### Additional context

jest uses some strange techniques to isolate each test suite (each *.test.js file) from each other. The tests run in the same process, but jest monkeypatches in a custom `require` function and evaluates the tests in a custom context, allowing each test file to muck with global state and not influence all the others. This is how jest supports their module mocking and a generally good practice for avoiding test flakes. That said, it can cause issues if code is not expecting to be required more than once, or somehow escapes their global state resetting approach. I am not sure it can be turned off for jest, but I do know that jest is a VERY popular test runner such that it'd be great to get support. See https://www.npmtrends.com/jest-vs-tap-vs-ava


#### Comments (5)

<details>
<summary><strong>vkarpov15</strong> commented on 2022-04-29 22:15:17.000 UTC</summary>

I took a closer look at this and confirmed that https://github.com/airhorns/sdk-typescript/commit/3955acdd638b2d0e5c2e7c736f1bbd19a8d4549e does fix this issue. The root cause looks like one file's copy of the Temporal module is getting another file's copy of `errors`. I haven't been able to find a better workaround than the one @airhorns suggested.

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2022-05-19 23:32:08.000 UTC</summary>

+1 for getting this fixed. 
I am also running in this issue. Should we make a PR for this?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-19 23:47:32.000 UTC</summary>

Let's open a PR with @airhorns' fix

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-19 23:48:05.000 UTC</summary>

I think @airhorns mentioned that it didn't fully work on slack, @airhorns can you confirm?

</details>

<details>
<summary><strong>airhorns</strong> commented on 2022-05-20 12:31:24.000 UTC</summary>

I think that might have been my mistake, just disabled the other mitigation I added beyond what we discussed and my big test suite still passed! Will open a PR

</details>


---

<a id="485"></a>

### #485: [Feature Request] Add workflow.getLastCompletionResult

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/485 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-17 17:41:35.000 UTC (3y 10m ago) |
| **Updated** | 2022-06-03 22:38:12.000 UTC |
| **Closed** | 2022-06-03 22:38:11.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 3 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | 0.20.0 |
| **Reactions** | üëç 2 ‚ù§Ô∏è 1 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Would like to get the result of last Workflow Run without using an activity & client.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Exposing [`last_completion_result`](https://github.com/temporalio/api/blob/e82978c745a07fb8820348ad77b1d02e226d182e/temporal/api/history/v1/message.proto#L69) to user.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

User inquiry & discussion: https://temporalio.slack.com/archives/C01DKSMU94L/p1645070483345729

Go: https://docs.temporal.io/docs/go/how-to-get-the-result-of-a-workflow-execution-in-go/#get-last-completion-result
Java: https://www.javadoc.io/doc/io.temporal/temporal-sdk/latest/io/temporal/workflow/Workflow.html

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2022-02-17 17:50:13.000 UTC</summary>

I didn't know this was available in the proto.

Looks like there's a lot of fields missing here: https://github.com/temporalio/sdk-typescript/blob/e31b4ef3acd4abb6e2422589f65e78f2ab67894a/packages/workflow/src/interfaces.ts#L8

We'll need to add those to the core proto: https://github.com/temporalio/sdk-core/blob/bcca27258775ceb1100f409f0cc40984218cdf3f/protos/local/temporal/sdk/core/workflow_activation/workflow_activation.proto#L80

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-14 16:18:18.000 UTC</summary>

Added in:

https://github.com/temporalio/sdk-core/commit/5fdaee15dcbb989e5d9765d3e4d91bc7efc16cbd

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-03 22:38:11.000 UTC</summary>

Done in #657 

</details>


---

<a id="234"></a>

### #234: [Bug] Load tests fail due to timeouts on buildkite

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/234 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-12 12:38:39.000 UTC (4y 4m ago) |
| **Updated** | 2021-10-13 14:20:12.000 UTC |
| **Closed** | 2021-10-13 14:20:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Some sample failures:

- https://buildkite.com/temporal/node-sdk/builds/94#f4020ec8-7b30-46e8-94b9-071acb1f7c7f
- https://buildkite.com/temporal/node-sdk/builds/93#088f173f-0a7f-48a6-bbcb-f0181570d504

#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-23 09:20:02.000 UTC</summary>

@Sushisource I think this overlaps with what you're working on, let's sync.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 14:03:46.000 UTC</summary>

@Sushisource I think once you merge retry interceptors we'll only have to deal with context deadline exceeded when polling on workflow result.
I can handle that tomorrow.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 12:55:58.000 UTC</summary>

DEADLINE EXCEEDED happens in GH actions as well.
After further investigation, it seems like it's always a query that hits the deadline.

AFAICT, retrying the query "eliminates" the issue and tests pass but I suspect that there's a bug in the query implementation causing timeouts.
The server logs show the query timeout:
```
temporal                | {"level":"info","ts":"2021-09-29T12:39:28.133Z","msg":"query directly through matching on sticky timed out, attempting to query on non-sticky","service":"history","shard-id":1,"address":"172.20.0.4:7234","shard-item":"0xc0004bce00","component":"history-engine","wf-namespace":"default","wf-id":"72f29e60-7fe3-4586-bd68-15550a411bab","wf-run-id":"0b00ddf4-5e5c-4b89-8d2c-ed61c509aa3d","wf-query-type":"isBlocked","wf-task-queue-name":"","wf-next-event-id":10,"logging-call-at":"historyEngine.go:921"}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 13:15:04.000 UTC</summary>

Apart from finding and fixing the root cause I suggest that we rethrow errors from the service in `WorkflowClient` because grpc errors are thrown asynchronously with a meaningless stack trace.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 15:25:51.000 UTC</summary>

Retrying the query sometimes results in the test timing out so it's not a valid workaround.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 16:02:54.000 UTC</summary>

Looks like there's general instability on buildkite: https://buildkite.com/temporal/node-sdk/builds/277

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-13 14:20:12.000 UTC</summary>

Tuning down the number of cached workflows seems to have stabilzed buildkite builds.
The occasional DEADLINE EXCEEDED on query requests is a server issue which was fixed here: https://github.com/temporalio/temporal/pull/2033


</details>


---

<a id="204"></a>

### #204: [Bug] Set the correct worker binary ID

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/204 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-24 12:59:57.000 UTC (4y 4m ago) |
| **Updated** | 2022-10-11 23:30:52.000 UTC |
| **Closed** | 2022-10-11 23:30:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

At the moment we pass the SDK version as the default binary ID, we should use the WF bundle checksum and perhaps include activity code as part of the checksum.

#### Comments (7)

<details>
<summary><strong>lorensr</strong> commented on 2022-02-10 21:36:31.000 UTC</summary>

For worker/activity code, `require.cache` has all the file paths that have been loaded in the current process, which we could read the contents of from disk to hash. More discussion:

https://temporaltechnologies.slack.com/archives/C01FG4BRQVB/p1644440779397319?thread_ts=1644439575.727109&cid=C01FG4BRQVB

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-02-10 22:19:33.000 UTC</summary>

FWIW this same concern applies to Python too. I would like to avoid reading all files or even walking the disk stat'ing them if at all possible (ntm it assumes you are running somewhere with a disk just like it assumes you are running nodejs, but we have already made those assumptions). I cannot find a way in Python to access contents of the modules without re-reading the files, I am unsure if `require.cache` makes any of that info available. But if we had to, you can possibly just get a hash of file names and each file's mtime to avoid reading entire files.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-10 22:27:56.000 UTC</summary>

![image](https://user-images.githubusercontent.com/251288/153507206-2cc43a2f-4768-4849-bd9c-347d0b627cf9.png)

path & mtime sounds good.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-02-10 23:58:18.000 UTC</summary>

I believe mtime will be quite unreliable in terms of being stable across different worker deployments which have the same code.

One of (perhaps the most) the common use cases here is "I just deployed a bunch of (the same) workers with this new stuff, they broke things, and I want to find/reset all workflows they messed up". So, ending up with a consistent id for all the workers in such a deployment is very desirable. 

The versioning stuff we're going to work on probably makes that a lot easier eventually, but that will always require some amount of manual specification by users, whereas this is ideally fully automatic (albeit less meaningful). 

So, to the extent we can make that scenario work automatically, I think it's worth even doing something like loading up and hashing files. Practically speaking I think it's pretty low cost since you're only doing it on startup and the size of user wf code isn't exactly huge in "hash these files" terms. We're still talking only a few hundred ms even using slow spinny disks with _megabytes_ of workflow code, which seems unlikely. Practically speaking the OS will keep them cached so we're not really reading them from disk twice.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-11 00:41:18.000 UTC</summary>

> I believe mtime will be quite unreliable in terms of being stable across different worker deployments which have the same code.

Ah, good point

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-02-11 14:23:29.000 UTC</summary>

True. It's a bit gross, but so long as you can override I guess it'll be ok.

Also, some deployments/packages do codegen that they then import that might have a "generated at XX" comment on it that'll break the hash. If cheap enough to use machine representation instead of source representation (it'll by bytecode in Python), I think we should. But I don't see where that's available in Node and I don't think it's reasonable to add a parse step.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:30:52.000 UTC</summary>

I think what we do now is good enough (using sha sum of the workflow bundle and SDK version).

https://github.com/temporalio/sdk-typescript/blob/dc63e490a22655fbdfa9e7fce4fa6f6fe57f2c92/packages/worker/src/worker.ts#L161

We can reopen if anyone feels the current approach is lacking.

</details>


---

<a id="202"></a>

### #202: [Feature Request] Go over WF activation logic

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/202 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-24 12:53:40.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-14 12:27:05.000 UTC |
| **Closed** | 2021-09-14 12:27:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 7 |
| **Priority Score** | 7 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Currently there are some TODOs in the codebase for executing signals first and handling activation errors.
We also wait for microtasks to run between each job, make sure that's really required.

#### Comments (7)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-01 08:46:42.000 UTC</summary>

Activations consist of multiple jobs.
Most jobs can run concurrently with the exception of signals, patches, and queries.

Suggestion for how node will process activations:

* process all patches (nothing async here)
* process all signals concurrently
* wait for microtasks to complete
* process remaining jobs except for queries concurrently
* wait for microtasks to complete
* process queries

Does that make sense @Sushisource @mfateev?

</details>

<details>
<summary><strong>mfateev</strong> commented on 2021-09-07 15:41:36.000 UTC</summary>

Looks good to me. There was a request to process signals one by one for the given type. It would be nice to make it default: https://github.com/temporalio/sdk-java/issues/214

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 13:55:17.000 UTC</summary>

@mfateev I'm not sure the Java issue is relevant to us.
In node the entire Workflow runs in a single thread (concurrently) if users want to process signals sequentially they can use a channel or equivalent to buffer the signals from the signal handlers.
Does that make sense to you?

Example:
```ts
export function myWorkflow() {
  const channel = new UnboundedChannel();
  
  return {
    async execute() {
      for await (const signal of channel) {
        // handle signal
      }
    },
    signals: {
      userInput(input: any) {
        channel.send(input);
      }
    }
  };
}
```

</details>

<details>
<summary><strong>mfateev</strong> commented on 2021-09-09 17:48:19.000 UTC</summary>

I think the node alternative would be not delivering a new signal until the `userInput` function returns.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 17:51:55.000 UTC</summary>

Why though?
This is pretty easy to manage in user code.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-10 00:54:39.000 UTC</summary>

It sounds like there are 2 options:

A. Signals are delivered as they're received
B. Signals are delivered sequentially‚Äîafter the previous function call has returned

The Java SDK will default to B, and maybe have A as an option. 

For Node, we currently only support A. We could support B or document how to ensure sequential execution, like with the code snippet above.

## Support B

A con is complicating the API. Eg saying "after the arguments that you provide to your signal function, you can pass an additional options arg for Temporal to read":

```
workflow.signal.userInput('foo arg');
workflow.signal.userInput('foo arg', { deliverSequentially: true }); // or false, depending on what the default is
```

A pro is the user doesn't have to code it.

Another con is complicating our advice on how to write workflows. Currently, you can do whatever you want in a signal handler, but with B support, we'd say eg "if you have deliverSequentially on, then don't do long-running logic or sleeping in your signal handlers, because you wouldn't be able to receive signals". Versus if we don't support B, it's clear from looking at the code when a `sleep()` would be blocking further signal processing. Further pros of not supporting B are flexibility in how sequential is coded and clarity when looking at the signal definition (versus in the Support B case, we don't know just from looking at the handler code whether it's being called with deliverSequentially on or off‚Äîwe'd have to search through the code of external systems to know).

I think I prefer not supporting B. As a Node dev, I'm used to the thought that my current function (eg an HTTP request handler) is going to be called non-sequentially, and program accordingly. It makes sense to me that a Signal, as a message from an outside system, would arrive and result in my handler being executed in the same fashion.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 07:44:56.000 UTC</summary>

I agree with @lorensr here.
Currently we don't implement channels, but if we did, we could add syntactic sugar for the sample above:

```ts
export function myWorkflow() {
  const signals = { userInput: new UnboundedChannel() };
  
  return {
    async execute() {
      for await (const signal of signals.userInput) {
        // handle signal
      }
    },
    signals,
  };
}
```

</details>


---

<a id="1437"></a>

### #1437: [Bug] NestJS integration, app/worker hot reloading error

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1437 |
| **State** | CLOSED |
| **Author** | tiberiu89 (Tiberiu Popa) |
| **Created** | 2024-06-10 15:20:38.000 UTC (1y 7m ago) |
| **Updated** | 2025-07-23 15:36:02.000 UTC |
| **Closed** | 2025-07-23 15:36:02.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 4 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 üòï 1 üëÄ 1 |

#### Description

I'm using nestjs-temporal package, but I assume it would be the same with the nestjs typescript samples provided(if using nest start worker --watch). Everything is good at first run, but after code changes and nestjs reloading, the worker cannot restart, saying address port is already in use(3000). 
Does anyone experienced this? Any ideas of a workaround would be appreciated. Manually restarting app is quite annoying.


#### Comments (4)

<details>
<summary><strong>tiberiu89</strong> commented on 2024-06-10 16:07:45.000 UTC</summary>

Maybe to answer my question, I found one possible alternative
We can split a nestjs app, by creating a separate entry point and main module that would create standalone app(no http server).
Then, edit the nest-cli.json to register this as a separate app. Code and modules can still be shared.

```ts
import { NestFactory } from '@nestjs/core';
import { MainRuntimeModule } from './runtime.module';

async function bootstrap() {
  await NestFactory.createApplicationContext(MainRuntimeModule);
}

bootstrap();
```
We load the module that registers workers only here + everything you need from the main codebase.

</details>

<details>
<summary><strong>jtomaszewski</strong> commented on 2025-07-22 09:36:35.000 UTC</summary>

Does the tip mentioned in https://github.com/KurtzL/nestjs-temporal/issues/54#issuecomment-2179000500 fixes this problem for you? (Adding `app.enableShutdownHooks()`) It does to me.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-22 14:35:42.000 UTC</summary>

Is the Temporal SDK itself playing any role in this?

I'd be inclined to close this ticket as non-actionable from our side.

Reactions: üëç 1

</details>

<details>
<summary><strong>n3vrax</strong> commented on 2025-07-22 14:53:57.000 UTC</summary>

It's been a while since I looked into this. It might have been fixed. From what I recall, I got to a satisfactory solution, maybe by using the tips mentioned here. And anyways, it was something happening in development. I would say this can be closed from my side.

Reactions: üëç 1

</details>


---

<a id="1406"></a>

### #1406: [Bug]Could not resolve "__temporal_custom_payload_converter"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1406 |
| **State** | CLOSED |
| **Author** | tiagomendonc (Tiago Mendon√ßa) |
| **Created** | 2024-04-30 21:11:00.000 UTC (1y 8m ago) |
| **Updated** | 2024-05-10 14:50:11.000 UTC |
| **Closed** | 2024-05-10 14:50:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | None |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to add a worker to my application so I can use workflows

### Describe the bug

Everytime that I try to build my application, it says that some requirements can not be found.

### Minimal Reproduction

<img width="889" alt="image" src="https://github.com/temporalio/sdk-typescript/assets/83790622/4e65fae5-0edb-413a-9eba-3e7bc1ea8a42">


### Environment/Versions

- OS and processor: M2 Mac
- Temporal Version: ÀÜ1.8.6
- Are you using Docker or Kubernetes or building Temporal from source? No



#### Comments (6)

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-01 17:18:37.000 UTC</summary>

It looks like you are trying to bundle the @temporalio/worker and @temporalio/workflow packages. This is not supported.

If you really need to bundle your Temporal Worker‚Äôs code, you will need to configure your bundler to keep the following packages as external:

    @temporalio/worker
    @temporalio/workflow
    @temporalio/core-bridge
    @temporalio/common
    @temporalio/worker
    @temporalio/proto

You will also need to pre-bundle your workflow code, e.g. by using bundleWorkflowCode() from your building script. See [this sample](https://github.com/temporalio/samples-typescript/blob/main/production/src/scripts/build-workflow-bundle.ts#L7). The file containing your Workflow Bundle‚Äôs code will also need to be marked as external.

</details>

<details>
<summary><strong>tiagomendonc</strong> commented on 2024-05-02 12:22:44.000 UTC</summary>

@mjameswh help me with a development issue than, without the worker, I can create and start a workflow execution, but I believe that without a worker, it will not be finished, since that my workflow do not complete, is aways in Running status. Is this right? 

</details>

<details>
<summary><strong>nubunto</strong> commented on 2024-05-03 17:43:55.000 UTC</summary>

>  it will not be finished

Exactly, it won't. The workflow is registered as started in Temporal Server, but if you don't have a worker listening on the task queue with the correct workflow definition, then it won't never advance.

</details>

<details>
<summary><strong>tiagomendonc</strong> commented on 2024-05-06 18:40:30.000 UTC</summary>

Got it. Still, I can't build my app with workers. What exactly should I do?

</details>

<details>
<summary><strong>tiagomendonc</strong> commented on 2024-05-06 18:44:14.000 UTC</summary>

Just to be more clear, I start my workflow client and than start the worker like this:
`const worker = await Worker.create({
    workflowsPath: require.resolve("./workflow"),
    taskQueue: "default",
    activities,
  });`
  

 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-07 15:40:34.000 UTC</summary>

@tiagomendonc At this point, I really can't tell anything more that what I said previously. Can you please give more details? Why and how are you bundling the Worker itself?

</details>


---

<a id="1351"></a>

### #1351: [Feature Request] Support updating schedule by cronExpression

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1351 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2024-02-06 22:53:09.000 UTC (1y 11m ago) |
| **Updated** | 2025-02-05 16:39:28.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 2 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

David says it's supported by Server. Looks like TS SDK doesn't support it in the update fn, I forget whether that was intentional.

#### Comments (2)

<details>
<summary><strong>vinycs1</strong> commented on 2024-02-20 22:38:20.000 UTC</summary>

This feature will be very helpful

Reactions: üëç 1

</details>

<details>
<summary><strong>cr0wst</strong> commented on 2025-02-05 16:39:27.000 UTC</summary>

We ran into this issue where when updating only the `cronExpression` you end up getting multiple intervals and upcoming runs.

I believe this is because temporal is not wiping the existing intervals out as part of the update, but it's applying the cron expressions to those intervals.

I found a workaround by deleting the intervals and calendars (probably only need one) from the `ScheduleUpdateOptions`

```ts
export async function update_schedule(id: string, args: UpdateScheduleArgs) {
  const handle = await get_schedule_handle(id);

  await handle.update((schedule: ScheduleUpdateOptions) => {
    schedule.spec.cronExpressions = [args.cron_expression];
    schedule.spec.timezone = args.timezone;
    delete schedule.spec.intervals;
    delete schedule.spec.calendars;

    return schedule;
  });
}
```

</details>


---

<a id="1348"></a>

### #1348: [Feature Request] Eager Workflow Start

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1348 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2024-01-29 19:13:58.000 UTC (1y 11m ago) |
| **Updated** | 2025-09-03 00:21:45.000 UTC |
| **Closed** | 2025-09-03 00:21:45.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 0 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 |

#### Description

### Is your feature request related to a problem? Please describe.
Support for Eager Workflow Start (EWS) was added in the server in 1.20, and is currently supported in Java, Python, Core, and Go SDKs. It reduces the latency to start a workflow by allowing the client to directly schedule the first workflow task to a local worker. See [https://github.com/temporalio/features/issues/242](https://github.com/temporalio/features/issues/242) for details.

The goal is to enable support for EWS in the TS SDK.

### Describe the solution you'd like
This is dependent on [https://github.com/temporalio/sdk-typescript/issues/3776](https://github.com/temporalio/sdk-typescript/issues/3776)




---

<a id="1317"></a>

### #1317: [Feature Request] Expose `updateId` to Update handlers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1317 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-12-11 17:35:45.000 UTC (2 years ago) |
| **Updated** | 2024-06-28 16:36:55.000 UTC |
| **Closed** | 2024-06-28 16:36:55.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 2 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Describe the solution you'd like

A Workflow Update carries an `updateId` field used to dedup updates. However, server side dedup is per-workflow-execution. Workflow implementers may have legitimate reasons to extend that guarantee across continue-as-new boundary.

Doing that effectively require access to the `updateId`, which is not exposed to the update handler at the moment.

We should make this information accessible through an `updateInfo()` function.

### Extra thoughts

`updateInfo()` would rely on an `asyncLocalStorage` set just before invoking interceptors. It might be interesting to make that `asyncLocalStorage` more general, so that it also get set while handling queries and signals, thus providing more general execution context tracking, with only marginal extra difficulty. This could possibly allow providing similar `signalInfo()` and `queryInfo()` APIs (though there seems to be very limited use cases for that ATM), but also allow detecting stuff like workflow commands started from a query handler.

#### Comments (2)

<details>
<summary><strong>Quinn-With-Two-Ns</strong> commented on 2023-12-11 17:36:57.000 UTC</summary>

This feature also exists in the Go SDK

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-11 17:37:21.000 UTC</summary>

Note that, even though the update handler don‚Äôt receive the `updateId`, workflow interceptors do. Therefore, in the mean time, one can capture the `updateId` form an interceptor, and make it accessible to your actual update handler code using an async local storage...

</details>


---

<a id="1192"></a>

### #1192: [Bug] @temporalio/worker-1.7.4: Memory occupied by worker not getting released on AWS ECS (OS: Linux)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1192 |
| **State** | CLOSED |
| **Author** | Naik1994 (Harish Naik B S) |
| **Created** | 2023-08-03 05:51:38.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-04 20:31:03.000 UTC |
| **Closed** | 2023-08-04 20:31:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We are using the Temporal SDK in one of our microservices deployed on an ECS container with a Linux OS. During load testing, we observed that the memory utilization gradually increased up to 50%, including heap memory, and it did not decrease until the server was restarted or stopped. Further investigation revealed that running the same codebase on a local system with Windows OS exhibited no issues. The heap memory was released promptly after 10 to 15 minutes. However, this behavior was not replicated when running the application on AWS environment.

However after passing the maxCachedWorkflows option as zero while creating the worker, the workflows are no longer being cached by the worker, and this has resolved the memory utilization issue. As a result, the heap memory is now getting released properly, and the problem is resolved temporarily as of now.

Request you to check and let us know if we need to do any specific configuration for container application to resolve above issue without passing **maxCachedWorkflows** option to worker.

await Worker.create({
    workflowsPath: require.resolve('./workflow'),
    connection,
    activities: createActivities(),
    taskQueue: 'test-'+process.env.stage,
    namespace: 'test',
    sinks: defaultSinks(workflowLogger),
    maxCachedWorkflows: 0
  })

### Describe the bug

We ran the hello world typescript sample shared by temporal on windows and observed that heap memory occupied while running activities got released automatically once the load gradually decreased on server.

1] without passing maxCachedWorkflows attribute in the option ->
numCachedWorkflows value was 100 since we triggered our code 100 times and heap memory got released slowly after the load is gone also it got released further once worker was idle for some time period.

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/64ca0cd3-c332-40c4-aebe-67d5a2afb5d3)

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/42110313-402d-476d-a718-8088f91b1873)

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/594ea0b6-6dbc-4196-be65-4670f3771c27)


2] by passing maxCachedWorkflows attribute in the option ->

Workflows were not getting cached i.e numCachedWorkflows value was mostly zero, hence memory got released immediately after load decreased gradually.

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/2657ceaa-c9c2-4182-8ada-33d125f6bf5a)


### Environment/Versions

<!-- Please complete the following information where relevant. -->

Below is the configuration we are using for our own application.
- OS and processor: [Linux]
- SDK version: 
    "@temporalio/activity": "^1.7.4",
    "@temporalio/client": "^1.7.4",
    "@temporalio/worker": "^1.7.4",
    "@temporalio/workflow": "^1.7.4"
- We have deployed our containerized application on AWS ECS with Node image 16.4.1



#### Comments (6)

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-03 14:42:31.000 UTC</summary>

I don't understand what is incorrect in your description. Seems like what you describe matches the expected behavior.

The `maxCachedWorkflows` setting control how many workflow executions are retained in local memory, so that further events affecting those workflow can be executed more efficiently. By definition, that means that increasing `maxCachedWorkflows` will increase memory usage.

Also note that Node JS heap is managed by a garbage collector. That means that objects in heap memory may not get immediately released. It's therefore expected that memory usage may take some time to go down after the completion of your workflows.

Here's something you can try: what happen if you steadily execute workflows for a long period of time. Does memory usage continue to grow, or does it stabilize at some point?

</details>

<details>
<summary><strong>Naik1994</strong> commented on 2023-08-03 15:16:55.000 UTC</summary>

We are not using the maxCachedWorkflows setting by default. Initially, we deployed our application without it, but then we observed that memory utilization increased during load testing. We monitored the system for 2-3 days after the load test, but the memory consumed during that period was not being released.

To address the memory issue, we decided to use the maxCachedWorkflows setting and set it to zero. After this change, we noticed that the occupied memory was getting released within 10-15 minutes after the load test. However, as a trade-off, we also observed an increase in CPU consumption.

Below are the graph screenshots for your reference, which we tested over the last week.
1] When tested without using the maxCachedWorkflows setting, the average memory utilization was around 34% for a couple of days. However, it decreased once we restarted the server.

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/5d6e6d0e-924f-40a5-a3a1-18d44dbdd3ad)

2] When we tested using the maxCachedWorkflows setting set to 0, memory utilization was indeed released within 10-15 minutes after the load test. However, we observed that the average CPU utilization went above 100%, indicating a significant increase in CPU usage.

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/3c781890-d7dc-455f-8566-b4a2bb6c0083)

However, in scenario 1, the application is functioning well on a local machine with Windows OS, and the heap memory is getting released as expected, even with cached workflows (please refer to the screenshots shared in the first thread). 

Please check and let us know if we are missing any configurations or if this is the default behavior. Even if it is the expected behavior, I'm concerned that at some point we will experience 100% memory utilization, which could crash the application, as the memory utilization has stabilized at a higher rate.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-03 19:18:13.000 UTC</summary>

First of all, I strongly recommend that you update your `@temporalio/*` dependencies to 1.8.2. The 1.8.0 release introduced several performance related improvements. I also recommend that you enable the `WorkerOptions.reuseV8Context` option on your Worker, as this greatly reduce both memory usage and CPU usage.

If unspecified, `maxCachedWorkflows` defaults to 250 wf per GB of heap memory (that is up to TS SDK 1.7.4; the exact formula changed in 1.8.0, see [here](https://github.com/mjameswh/sdk-typescript/blob/08958f03fa30555ae3511dcb555cb3b56fcbee9c/packages/worker/src/worker-options.ts#L299-L300) for details). This is generally appropriate for day-to-day development; we however recommend that you explicitly configure `maxCachedWorkflows` in production environment, based on your specific application needs. Correctly tuning this involves performance testing.

Explicitly setting `maxCachedWorkflows` to 0 disable workflow caching. This can be very detrimental for the performance of both your workers and your Temporal cluster. That is definitely not something you want to do in production.

> Initially, we deployed our application without it, but then we observed that memory utilization increased during load testing.

This is expected. The cache size will increase until it reaches `maxCachedWorkflows`. From that point on, least recently used workflows will get evicted, so that you never have more than `maxCachedWorkflows` workflows in heap. At that point, memory usage should stabilize.

> We monitored the system for 2-3 days after the load test, but the memory consumed during that period was not being released. [...] However, in scenario 1, the application is functioning well on a local machine with Windows OS, and the heap memory is getting released as expected, even with cached workflows (please refer to the screenshots shared in the first thread).

Note that in your Windows screenshots, in your first message, the number of cached workflows is _not_ going down, even after the system has been idle for some time. The cache remains steadily at 100 wfs, and yet actual memory usage comes down to ~70 MB. The workflow cache has an LRU semantic. I'm not saying that a memory leak is impossible, but as far as I can see, the metrics you expose are coherent with the expected behavior.

Why then is the memory usage not going down in ECS's memory usage graph when workflow caching is enabled, while it does on Windows or when workflow caching is disabled? I have several possible factors in mind that may contribute to this apparent incoherency, but essentially all of it comes down to the way generational garbage collection works, and the fact that Windows and Linux manage memory differently.

>  I'm concerned that at some point we will experience 100% memory utilization, which could crash the application, as the memory utilization has stabilized at a higher rate.

I understand your concern. Workflows are not the only contributor to your process' memory usage. Activities and various other things running in that process/container may also require memory. Avoiding out-of-memory situations require finding a proper balance between all of these, and configuring your WorkerOptions' accordingly.

</details>

<details>
<summary><strong>Naik1994</strong> commented on 2023-08-04 14:06:23.000 UTC</summary>

@mjameswh thanks for the support. We did test by upgrading all temporalio sdk libraries to latest version and enabling `reuseV8Context`, setting `maxCachedWorkflows` to 300 (just to see the behavior) and observed CPU utilization is below 100% however memory utilization is at 25% but stabilized. Does that mean memory will be at 25% and increasing as in when new workflows being executed?

![image](https://github.com/temporalio/sdk-typescript/assets/42242055/c281c026-deda-421c-9d7b-f164ff10a96d)

FYI, without enabling above settings default value of `maxCachedWorkflows` on Linux OS on AWS was set to 158 and on windows OS of local machine was 914. Meanwhile we will try to modify configuration and check the behavior further.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-04 17:16:24.000 UTC</summary>

>  Does that mean memory will be at 25% and increasing as in when new workflows being executed?

If that 25% memory usage actually represents the state where your workflow cache is full, then yes, memory usage should indeed stay relatively stable (variations are to be expected). If however that 25% correspond to your workflow cache currently containing only 100 workflows, and you allow your cache to grow to 300 workflows, then memory usage will increase when you'll start more workflows, until the cache reaches its full capacity.

Try running a few hundreds of workflows (I'd say at least twice the number you specified in `maxCachedWorkflows`). That will ensure that the cache reaches its full capacity. At that point, you be get a better view of how much memory your cache is really taking.

Note that the memory footprint of a single cached workflow really depends on the workflow code and the libraries used by that workflow. That's why you really need to measure this with your actual workflow.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-04 20:31:02.000 UTC</summary>

@Naik1994 I'm closing this ticket, as there is nothing to do on our side.

Feel free to continue the discussion if you still need help. You may also get help through our [Slack community](https://t.mp/slack) or our [community forum](https://community.temporal.io/).

</details>


---

<a id="1135"></a>

### #1135: [Support] How to implement a real Authorization workflow inbound interceptor

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1135 |
| **State** | CLOSED |
| **Author** | YufeeXing (Mason Xing) |
| **Created** | 2023-06-07 10:49:07.000 UTC (2y 7m ago) |
| **Updated** | 2023-06-27 08:42:07.000 UTC |
| **Closed** | 2023-06-27 08:42:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

From your official doc
![image](https://github.com/temporalio/sdk-typescript/assets/42690790/9cf3b316-94ec-4d59-b06b-e6d412535206)
If I want to validate the header by a remote authentication service. But in different env, the URL of the authentication service is different.

And for determinism, the 'process' is forbidden in this workflow inbound interceptor. So how to handle this situation?
Look forward to your reply. Thanks.


#### Comments (6)

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-08 20:53:25.000 UTC</summary>

One possibility would be to call a local activity from your Workflow inbound interceptor. From that activity, you will be able to access environment variables and make calls to your external auth service.

You will however need to be careful to ensure that no sensitive data get written to the history. Note that, at the moment, TS SDK does not process [headers through Payload codecs](https://github.com/temporalio/sdk-typescript/issues/514). You may however easily encode the auth header by yourself before starting the Workflow, and decode that in your auth checking Activity. You should also embed details about the Workflow execution itself in that same encrypted header (eg. the Workflow Id, a checksum of args, approximate date/time of start, etc) so that a previous header value can't be reused to start a new Workflow Execution.

Note that this design is not the only possible solution, and other approaches may be more appropriate in some use cases. Before taking a decision, you should carefully analyze your threat model.

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-09 01:50:19.000 UTC</summary>

> One possibility would be to call a local activity from your Workflow inbound interceptor. From that activity, you will be able to access environment variables and make calls to your external auth service.
> 
> You will however need to be careful to ensure that no sensitive data get written to the history. Note that, at the moment, TS SDK does not process [headers through Payload codecs](https://github.com/temporalio/sdk-typescript/issues/514). You may however easily encode the auth header by yourself before starting the Workflow, and decode that in your auth checking Activity. You should also embed details about the Workflow execution itself in that same encrypted header (eg. the Workflow Id, a checksum of args, approximate date/time of start, etc) so that a previous header value can't be reused to start a new Workflow Execution.
> 
> Note that this design is not the only possible solution, and other approaches may be more appropriate in some use cases. Before taking a decision, you should carefully analyze your threat model.

Thanks, @mjameswh. Got your point and will try.

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-09 05:34:50.000 UTC</summary>

So, must use a local activity,right? Becaust there is no grpc request between the workflow and the local activity, if all the grpc request need authentication.
How to define a local activity or how to judge a activity is local or not?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-09 21:38:58.000 UTC</summary>

> So, must use a local activity,right? Becaust there is no grpc request between the workflow and the local activity, if all the grpc request need authentication.

I mentioned Local Activities, but a regular Activity would also work. The main advantages of Local Activities are:

- Much lower latency
- Lower foot print in the Workflow History
- Guaranteed to be executed locally

For things such as "I want to get the value of an environment variable", using Local Activities is the obvious choice. We don't generally recommend using Local Activities for making call to external services, but they still sometime make sense if the service you are calling to is very fast, has very low probability of failure, and that retrying an operation is very cheap. I'm assuming this might be the case for your authorization service, but I may be wrong. I suggest you get a look at [this page](https://docs.temporal.io/activities#local-activity) for details on what Local Activities are and why you may want to use them over regular Activities. 

> How to define a local activity or how to judge a activity is local or not?

In TS SDK, the only difference in calling an Local Activity rather than an Activity is that you use `proxyLocalActivities(...)` rather than `proxyActivities(...)`. Also make sure that you set the `startToCloseTimeout` in `LocalActivityOptions` (there is a known bug in TS SDK up to 1.7.4 if you only set `scheduleToCloseTimeout`). That's it.

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-12 05:38:38.000 UTC</summary>

Thanks, @mjameswh .
I think a regular Activity may not work, becasue the goal is to authenticate all the grpc requests. As I know, There is a grpc request between a Workflow and a regular Activity. So the Activity about authtication with env variable may be blocked. This may cause a deadlock?

And how to change a grpc header in the Interceptor or in the Activity of a Interceptor. I found a setMetadata method of NativeConnection instance, but how to get a nativeConnection instance in a interceptor? Or is there another way to change the grpc headers in the interceptors?

</details>

<details>
<summary><strong>YufeeXing</strong> commented on 2023-06-13 10:20:09.000 UTC</summary>

```
 import { toPayloads, DefaultPayloadConverter } from '@temporalio/common';

// in a interceptor
const token: string = await generateToken();
input.headers.Authorization = toPayloads(new DefaultPayloadConverter() ,token)![0];
return await next(input);
```
I think this may work, but I am not sure if it can use the string token in the toPayloads function because the defaultPayloadConverter only support byteArray and JSON.

</details>


---

<a id="1062"></a>

### #1062: listWorkflowExecutions accept only 1 query params.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1062 |
| **State** | CLOSED |
| **Author** | ethanclear |
| **Created** | 2023-02-20 09:27:31.000 UTC (2y 10m ago) |
| **Updated** | 2023-03-09 00:16:29.000 UTC |
| **Closed** | 2023-03-09 00:16:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
I'm trying to pass 2 query params with the TS SDK listWorkflowExecutions.
<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->
I'm putting only 1 query params then filter it on my side.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->
When adding a params with a "AND" exactly like it should be i'm getting an error
example: WorkflowType = '${name}' AND ExecutionStatus = "Running"

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->
<img width="668" alt="image" src="https://user-images.githubusercontent.com/124141652/220065706-c56e5df5-97a2-4486-84c8-186d607ac549.png">

### The Error.

Error: 2 UNKNOWN: too many filter conditions specified
    at Object.callErrorFromStatus (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/call.ts:81:17)
    at Object.onReceiveStatus (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/client.ts:358:36)
    at /Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/call-stream.ts:210:27
    at Object.onReceiveStatus (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/src/grpc-retry.ts:176:17)
    at Object.onReceiveStatus (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/client-interceptors.ts:462:34)
    at Object.onReceiveStatus (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/client-interceptors.ts:424:48)
    at /Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/call-stream.ts:334:24
    at processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/node_modules/@grpc/grpc-js/src/client.ts:328:30)
    at Service.rpcImpl (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@temporalio/client/src/connection.ts:341:21)
    at Service.rpcCall (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/protobufjs/src/rpc/service.js:94:21)
    at executor (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@protobufjs/aspromise/index.js:44:16)
    at new Promise (<anonymous>)
    at Object.asPromise (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@protobufjs/aspromise/index.js:28:12)
    at Service.rpcCall (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/protobufjs/src/rpc/service.js:86:21)
    at Service.listWorkflowExecutions (eval at Codegen (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/node_modules/@protobufjs/codegen/index.js:50:33), <anonymous>:4:15)
    at TemporalService.getPendingWorkflowExecutions (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/src/temporal.service.ts:25:63)
    at SpecController.getPendingSpecs (/Users/ethansayagh/Desktop/DEV/work/clear/cal/catalog-service/src/spec/spec.controller.ts:17:57) {
  code: 2,
  details: 'too many filter conditions specified',
  metadata: Metadata {
    internalRepr: Map(1) { 'content-type' => [Array] },
    options: {}
  }


#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2023-02-20 16:25:26.000 UTC</summary>

Hi, I‚Äôm not sure I understand exactly what the problem is.
What error are you getting?

Side note: there‚Äôs a friendlier API for listing workflows, it won‚Äôt help your issue though.

https://typescript.temporal.io/api/classes/client.WorkflowClient#list

https://github.com/temporalio/samples-typescript/blob/ba6208155bc7b547c76931b7e14e92ce4594af28/food-delivery/apps/driver/pages/api/%5Btrpc%5D.ts#L19


</details>

<details>
<summary><strong>ethanclear</strong> commented on 2023-02-21 08:25:51.000 UTC</summary>

Updated

</details>

<details>
<summary><strong>ethanclear</strong> commented on 2023-02-21 09:08:03.000 UTC</summary>

Using the list method you gave me i get the same error: 2 UNKNOWN: too many filter conditions specified

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-02-21 12:09:20.000 UTC</summary>

That error message indicates that your temporal server is using a persistance backend that do not support queries containing two filter predicates.

How is your temporal server deployed, which version, and which persistance backend are you using?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-01 19:04:41.000 UTC</summary>

@ethanclear Is this resolved?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-09 00:16:28.000 UTC</summary>

I'm closing this, please reopen if you feel this isn't resolved.

</details>


---

<a id="1039"></a>

### #1039: [Bug] Unhandled promise rejections results in hard to diagnose WFT failure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1039 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-01-27 18:50:35.000 UTC (2y 11m ago) |
| **Updated** | 2025-02-27 23:00:16.000 UTC |
| **Closed** | 2025-02-27 23:00:16.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 2 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Describe the bug

Unhandled promise rejections causes WFT failures. This is reasonable given that Node 16's default policy is to crash the process on unhandled promise rejections.

However, when this happens, the WFT failure actually carries very little context information, making it difficult for the user to 1) understand the reason why the WFT failed and 2) the origin of the failing Promise.

It is therefore proposed that WFT failures caused by unhandled promise rejections should:
1. use an error message that clearly indicates "Unhandled promise rejection";
2. that the WFT failure should carry the stack trace to the place where failing promise was created; 
3. that a message with "Unhandled promise rejection" and the stack trace to the promise creation should be reported to the Worker's log.

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2024-08-09 06:35:47.000 UTC</summary>

Another surprising behavior of unhandled promise rejection: if the thrown error happens to be an instance of `TemporalFailure`, the failure will get encoded normally, but reported as a WFT failure rather than a WF failure as would generally be expected for `TemporalFailure`.

For example:

```
import * as wf from '@temporalio/workflow';

export async function parentWorkflow(): Promise<void> {
  // Note the missing `await` here
  wf.executeChild(childWorkflow);
  await wf.condition(() => false);
}

export async function childWorkflow(): Promise<void> {
  throw wf.ApplicationFailure.nonRetryable('I am a child and I failed');
}
```

results in the following history:

<img width="2158" alt="Screenshot 2024-08-09 at 02 32 55" src="https://github.com/user-attachments/assets/56c9509b-0d23-4dc2-a760-7d36d1e716c3">

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-10-08 21:04:33.000 UTC</summary>

**Personal notes on this issue**

1. There is currently no way for Activator methods to bubble up async non-`TemporalFailure` errors out of the sandbox; therefore, all async non-`TemporalFailure` actually become Unhandled Promise Rejections at some point.

2. Some Activator methods execute sync code, but don't catch errors; those errors may then bubble up through the VM abstraction, and up to the _Worker_, where the error will get encoded to protobuf. That means that, except when using the single thread workflow executor (`TEMPORAL_DEBUG=true`), those Errors may get V8 serialized through the Worker Thread's message port, causing lost of information on the errors.

    For example, the following code gives the expected failure when using the single thread wf executor, but not when running with the normal threaded executor:

    ```
    import * as wf from '@temporalio/workflow';
    
    export async function throwObject(): Promise<void> {
      // ignore
    }
    
    // Throw during `initRuntime`
    if (wf.inWorkflowContext()) {
      // eslint-disable-next-line no-debugger
      // debugger;
      throw { plainObject: true };
    }
    ```


</details>


---

<a id="1017"></a>

### #1017: [Feature Request] Allow strings to be passed for `tls.clientCertPair.crt/key`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1017 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-01-06 03:54:50.000 UTC (3 years ago) |
| **Updated** | 2025-01-21 18:53:36.000 UTC |
| **Closed** | 2025-01-21 18:53:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

So that I don't have to use `Buffer.from` with env vars:

![image](https://user-images.githubusercontent.com/251288/210926817-ed730125-7930-46c0-9e80-c3f658da88bf.png)


#### Comments (6)

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-20 01:07:50.000 UTC</summary>

Not sure. If we expect a string, people are likely to believe that they can give a file path. This might actually be more problematic than the status quo.

@lorensr What do you think?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-01-20 03:36:57.000 UTC</summary>

I see your point. I'd prioritize convenience here, and change doc to clarify: 

`crt   Buffer | string    The cert itself (not a file path).`

![image](https://user-images.githubusercontent.com/251288/213611261-aaebc566-6d50-4fcd-adad-d73f714af756.png)


</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-20 19:52:04.000 UTC</summary>

I'd consider adding support for strings but warning if the string looks like a path.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-20 21:30:34.000 UTC</summary>

Another option is to support:
```
Buffer | { content: string | Buffer } | { path: string }
```

That could help direct users in the right direction and remove some friction but I don't *love* it.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-24 01:52:10.000 UTC</summary>

> Another option is to support:
> 
> ```
> Buffer | { content: string | Buffer } | { path: string }
> ```
> 
> That could help direct users in the right direction and remove some friction but I don't _love_ it.

Don't really love it either, but I'd say this is the "least worst" option, and is quite easy to implement anyway.

Will do.

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-24 05:48:53.000 UTC</summary>

I‚Äôm on the fence‚Ä¶ let‚Äôs think about it some more

</details>


---

<a id="921"></a>

### #921: [Advice needed] Run temporal in meteor 2.7.3 / node 14.19.3

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/921 |
| **State** | CLOSED |
| **Author** | getarun (Dome) |
| **Created** | 2022-10-14 18:14:44.000 UTC (3y 2m ago) |
| **Updated** | 2023-01-24 01:56:15.000 UTC |
| **Closed** | 2023-01-24 01:56:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Expected Behavior

Temporal should execute as shown in the minimal examples (tested hello-world).
## Actual Behavior

Minimal examples run fine `ts-node src/client.ts`.
Code run in meteor with meteor run `src/client.ts` fails with error while executing `new Connection.connect()`

## Steps to Reproduce the Problem

  1. Set up meteor project with meteor 2.7.3
  2. Copy copy from example to server side (/server) and import it in /server/index.ts
  3. Run project with meteor run.
  4. When new Connection.connect() is called the error is thrown.
~~~
  W20221014-19:37:06.005(2)? (STDERR) TypeError: Cannot read property 'Symbol(kResourceStore)' of undefined
W20221014-19:37:06.005(2)? (STDERR)     at AsyncLocalStorage._propagate (async_hooks.js:288:34)
W20221014-19:37:06.005(2)? (STDERR)     at AsyncHook.init (async_hooks.js:255:22)
W20221014-19:37:06.005(2)? (STDERR)     at emitInitNative (internal/async_hooks.js:203:43)
W20221014-19:37:06.006(2)? (STDERR)     at emitInitScript (internal/async_hooks.js:493:3)
W20221014-19:37:06.006(2)? (STDERR)     at promiseInitHook (internal/async_hooks.js:323:3)
W20221014-19:37:06.006(2)? (STDERR)     at new Promise (<anonymous>)
W20221014-19:37:06.006(2)? (STDERR)     at FiberPool.run (/home/xxx/.meteor/packages/promise/.0.12.0.wdpd7b.4qul++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:94:19)
W20221014-19:37:06.006(2)? (STDERR)     at result (/home/xxx/.meteor/packages/promise/.0.12.0.wdpd7b.4qul++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:157:29)
W20221014-19:37:06.006(2)? (STDERR)     at processTicksAndRejections (internal/process/task_queues.js:95:5)
~~~

## Specifications

  - Version: Meteor 2.7.3, node 14.19.3
  - Platform: linux, x64
  - SDK: Typescript
  - npm package: @temporalio/client
  - function that crashes: Connection.connect();

## Thoughts
- Since there seem to be a meteor problem with newer versions (something I can't grasp in detail) and these kind of errors
  - (https://github.com/meteor/meteor/issues/11539)
  - (https://github.com/meteor/meteor/discussions/11505)

## Question
- How can I run temporal typescript sdk in a meteor 2.7.3 environment?
- Is there a way to maybe run it without AsyncLocalStorage (what seems to be the issue here)

Thank you for your time :)


#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-14 19:31:15.000 UTC</summary>

Oh i see meteor is using fibers, that might conflict with AsyncLocalStorage.
We could look into degrading the client capabilities when AsyncLocalStorage cannot be accessed.

</details>

<details>
<summary><strong>getarun</strong> commented on 2022-10-15 09:09:41.000 UTC</summary>

Yeah, is there a way to achieve this right now?¬¥Maybe me patching it? Not
sure where to look and what to replace it with :/

Am Fr., 14. Okt. 2022 um 21:31 Uhr schrieb Roey Berman <
***@***.***>:

> Oh i see meteor is using fibers, that might conflict with
> AsyncLocalStorage.
> We could look into degrading the client capabilities when
> AsyncLocalStorage cannot be accessed.
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/921#issuecomment-1279381162>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/ACOAYGLJGCJLC6O2VJ5QEI3WDGYI5ANCNFSM6AAAAAARFP6R2Y>
> .
> You are receiving this because you authored the thread.Message ID:
> ***@***.***>
>


</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-15 16:11:12.000 UTC</summary>

Probably this line:
https://github.com/temporalio/sdk-typescript/blob/bfb0065fe1c562fa3ca5725e254bd5c0a1ca6d16/packages/client/src/connection.ts#L334

</details>

<details>
<summary><strong>getarun</strong> commented on 2022-10-15 20:06:29.000 UTC</summary>

thank you, will have a look :)

Am Sa., 15. Okt. 2022 um 18:11 Uhr schrieb Roey Berman <
***@***.***>:

> Probably this line:
>
> https://github.com/temporalio/sdk-typescript/blob/bfb0065fe1c562fa3ca5725e254bd5c0a1ca6d16/packages/client/src/connection.ts#L334
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/921#issuecomment-1279775004>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/ACOAYGKS7VX5QNA4WJNBV6TWDLJSXANCNFSM6AAAAAARFP6R2Y>
> .
> You are receiving this because you authored the thread.Message ID:
> ***@***.***>
>


</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-16 23:45:24.000 UTC</summary>

@getarun Can we close this ticket?

</details>

<details>
<summary><strong>getarun</strong> commented on 2023-01-19 10:51:54.000 UTC</summary>

Yes

Am Di., 17. Jan. 2023 um 00:45 Uhr schrieb James Watkins-Harvey <
***@***.***>:

> @getarun <https://github.com/getarun> Can we close this ticket?
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/921#issuecomment-1384676173>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/ACOAYGJROUP5GHLSPQ4RDLDWSXMR7ANCNFSM6AAAAAARFP6R2Y>
> .
> You are receiving this because you were mentioned.Message ID:
> ***@***.***>
>


</details>


---

<a id="915"></a>

### #915: [Feature Request] Emit metrics from client connection

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/915 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-10-11 23:49:28.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-11 23:49:28.000 UTC |
| **Upvotes** | 3 |
| **Comments** | 0 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 3 |

#### Description

Currently metrics are only emitted when using NativeConnection (only used by the worker).
We need to emit metrics from the client connection as well.


---

<a id="900"></a>

### #900: [Bug] TypeError: (0 , common_1.errorMessage) is not a function

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/900 |
| **State** | CLOSED |
| **Author** | colinking (Colin) |
| **Created** | 2022-10-05 19:08:37.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-12 00:42:41.000 UTC |
| **Closed** | 2022-10-11 04:58:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Installing version `1.3.0` of `temporalio/worker` should install `1.3.0` of `temporalio/common` rather than the latest minor version. Ideally each Temporal SDK pins their Temporal dependencies.

### Describe the bug

Attempting to install an older version of the Temporal SDK will pull in the latest minor version of the underlying packages, e.g. `@temporalio/common`. This causes issues since there have been breaking changes in minor releases. For example, `1.4.0` unexported `errorMessage` so version `1.3.0` of `temporalio/worker` errors when trying to import it:

```
error: TypeError: (0 , common_1.errorMessage) is not a function
       at /airplane/.airplane/node_modules/@temporalio/worker/lib/tracing.js:70:102
       at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
       at async /airplane/.airplane/node_modules/@temporalio/worker/lib/worker.js:554:24
 }
```

### Minimal Reproduction

Create a `package.json` that depends on `1.3.0` like so:

```
{
  "dependencies": {
    "@temporalio/worker": "1.3.0",
    "@temporalio/workflow": "1.3.0"
  }
}
```

Run `npm install`. Inspect `package-lock.json` and notice it installs a mixture of `1.3.0` and `1.4.0` versions of the various Temporal SDK packages:

```
‚ñ∂ cat package-lock.json | grep -A5 temporal
    "@temporalio/workflow": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/@temporalio/workflow/-/workflow-1.3.0.tgz",
      "integrity": "sha512-iK6LkQLF5vN9R+eONZK+LGR+x5ZgFTc+mKigqNzNZFwLsAm4WM8MmBvh5uKCsIXdfN2F4tnxB/I6svUN6OZBdA==",
      "requires": {
        "@temporalio/common": "^1.3.0",
        "@temporalio/internal-workflow-common": "^1.3.0",
        "@temporalio/proto": "^1.3.0"
      }
    },

...


    "@temporalio/common": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/@temporalio/common/-/common-1.4.0.tgz",
      "integrity": "sha512-94TGVWh4iUQt86iojN/tc02Au4m+3WKXK4YVjYKxD33KTL0J7VYW1cZq3ELdicUNhVP35ioAr88K6Vs1KNPyLA==",
      "requires": {
        "@opentelemetry/api": "^1.0.3",
        "@temporalio/proto": "^1.4.0",
        "long": "^5.2.0",
        "ms": "^2.1.3",
        "proto3-json-serializer": "^1.0.3",
        "protobufjs": "^7.0.0"
      }
```

Since `@temporalio/workflow` depends on `"@temporalio/common": "^1.3.0"` instead of `"@temporalio/common": "1.3.0"`, it installs the latest minor version.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version: 1.3.0
- Are you using Docker or Kubernetes or building Temporal from source? N/A

```
‚ñ∂ npm version
  npm: '8.15.0',
  node: '18.7.0',
```

### Additional context

N/A


#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-05 19:11:50.000 UTC</summary>

Thanks for reporting this. We will address this in following releases.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-05 19:13:24.000 UTC</summary>

We will also publish a 1.3.1 patch 

</details>

<details>
<summary><strong>colinking</strong> commented on 2022-10-05 19:14:33.000 UTC</summary>

Fantastic. Thanks for the quick response, @bergundy.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 04:58:17.000 UTC</summary>

Fixed in 1.3.1 and 1.4.1

</details>

<details>
<summary><strong>colinking</strong> commented on 2022-10-12 00:22:29.000 UTC</summary>

@bergundy this issue appears fixed in `1.3.1`, but not `1.4.1` nor `1.4.2`.

## 1.3.1

Uses `~` and only accepts patch version updates (lgtm):

<img width="960" alt="CleanShot 2022-10-11 at 20 21 39" src="https://user-images.githubusercontent.com/2907397/195221487-58935290-144f-4054-b111-871b4c435347.png">

This lockfile was generated from this `package.json`:

```json
{
  "dependencies": {
    "@temporalio/worker": "1.3.1",
    "@temporalio/workflow": "1.3.1"
  }
}
```


## 1.4.2

Uses `^` and will accept minor version updates (broken):

<img width="921" alt="CleanShot 2022-10-11 at 20 18 00" src="https://user-images.githubusercontent.com/2907397/195221275-4cf7529d-c729-448c-9b9c-a158baa9dcc6.png">

This lockfile was generated from this `package.json`:

```json
{
  "dependencies": {
    "@temporalio/worker": "1.4.2",
    "@temporalio/workflow": "1.4.2"
  }
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-12 00:42:41.000 UTC</summary>

I know, we've updated the contributing guide explaining how to ping to minor.
Thanks for reporting.

</details>


---

<a id="800"></a>

### #800: [Bug] Panic on nondeterministic replay

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/800 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-21 20:36:44.000 UTC (3y 5m ago) |
| **Updated** | 2022-10-03 13:05:47.000 UTC |
| **Closed** | 2022-10-03 13:05:46.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 2 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Reported by user:

---

I‚Äôm creating a workflowBundle of all the workflows i‚Äôm replaying, passing the workflowBundle in to runReplayHistory, and adding the promise from runReplayHistory to an array of promises on which I use Promise.all() at the end.

If I do break determinism in one of the workflows, even though I‚Äôm catching errors on the Promise.all, I get this error:

```
thread '<unnamed>' panicked at 'Must call `into_inner` or `drop` on `Root` https://docs.rs/neon/latest/neon/sync/index.html#drop-safety', /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/neon-0.8.3/src/handle/root.rs:182:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
Unhandled rejection { runId: undefined } UnexpectedError: channel closed
```

and the function errors out. 

#### Comments (2)

<details>
<summary><strong>Sushisource</strong> commented on 2022-08-01 20:32:43.000 UTC</summary>

This is a bug in the TS bridge code. `neon` only exists there.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-03 13:05:46.000 UTC</summary>

I haven‚Äôt seen this since one of my recent changes to `Runtime`. Let‚Äôs reopen if we see it again.

</details>


---

<a id="731"></a>

### #731: [Bug] Nondeterminism error: Local activity machine can't handle TimerStarted

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/731 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-27 23:52:49.000 UTC (3y 6m ago) |
| **Updated** | 2022-09-21 04:31:58.000 UTC |
| **Closed** | 2022-07-07 18:45:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | 1.0 |

#### Description

Repro: https://github.com/temporalio/samples-typescript/compare/repro-local

Note that `refreshAccessToken` adds to `tasks` array, which makes the condition true.

```
git clone https://github.com/temporalio/samples-typescript.git
cd samples-typescript/hello-world
git checkout repro-local
npm start
```

`npm run workflow`

After 5 seconds, worker logs:

```
ERROR temporal_sdk_core::worker::workflow::managed_run: Error in run machines, error: RunUpdateErr { source: Nondeterminism("Local activity machine cannot handle this event: HistoryEvent(id: 5, Some(TimerStarted))"), complete_resp_chan: None }
```

event history: https://www.dropbox.com/s/n37xushdt9jstq3/08edc8df-2e2e-4b6a-9cf8-af20e777ae2c_events.json?dl=0

#### Comments (6)

<details>
<summary><strong>lorensr</strong> commented on 2022-06-29 03:40:18.000 UTC</summary>

Repro code, for posterity: 

```ts

import { condition, defineSignal, setHandler, proxyLocalActivities } from '@temporalio/workflow';

const { refreshAccessTokenLocalActivity } = proxyLocalActivities<typeof activities>({
  startToCloseTimeout: '1 minute',
});

export async function weirdWorkflowLoop() {
  const tasks: any = [];
  let token: any = {};
  let refreshAccessTokenPromise: any;

  function refreshAccessToken() {
    if (refreshAccessTokenPromise === undefined) {
      refreshAccessTokenPromise = (async () => {
        token = await refreshAccessTokenLocalActivity(); //NOTE: In the real Workflow this function is called with proxyLocalActivity

        tasks.push(() => {
          //this is just so the condition at the end of the main forloop unlocks
        });
      })();
    }
  }

  for (;;) {
    while (tasks.length) {
      const task = tasks.pop();
      await handleTask(task);
    }
    refreshAccessToken(); // intentionally not awaited
    // if (!token) refreshAccessToken();
    await condition(() => tasks.length > 0, '30s');
  }
}

async function handleTask(task: string) {
  console.log('performing task:', task);
  return new Promise((r) => setTimeout(r, 100));
}
```

```ts
export async function refreshAccessTokenLocalActivity(): Promise<any> {
  console.log('refreshAccessTokenLocalActivity');
  //This activity makes an http request so it can fetch an access token using the refreshToken
  return new Promise((resolve) => setTimeout(() => resolve({ token: 'token-foo', status: 'configured' }), 5000));
}
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-06-29 15:18:10.000 UTC</summary>

In case this can still be useful, here is a much shorter version of the repro code, more applicable to unit testing:

```
import { condition, proxyLocalActivities } from '@temporalio/workflow';
import type * as activities from './activities';

const { someLocalActivity } = proxyLocalActivities<typeof activities>({
  startToCloseTimeout: '1 minute',
});

export async function issue731workflow() {
  let completed = false;

  someLocalActivity()
    .then(() => {
      completed = true;
    })
    .catch(() => {
      /* intentionnaly ignored */
    });

  await condition(() => completed, '30s');
  await sleep(100);
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-29 15:36:19.000 UTC</summary>

Thanks @mjameswh 

</details>

<details>
<summary><strong>JoshVee</strong> commented on 2022-09-19 11:36:43.000 UTC</summary>

This is still happening in 1.2.0:
```
2022-09-19T11:26:32.518958Z ERROR temporal_sdk_core::worker::workflow::managed_run: Error in run machines, error: RunUpdateErr { source: Nondeterminism("Continue as new workflow machine does not handle this event: HistoryEvent(id: 30, Some(TimerStarted))"), complete_resp_chan: Some(Sender { inner: Some(Inner { state: State { is_complete: false, is_closed: false, is_rx_task_set: true, is_tx_task_set: false } }) }) }
```

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-09-19 16:59:32.000 UTC</summary>

> This is still happening in 1.2.0:
> 
> ```
> 2022-09-19T11:26:32.518958Z ERROR temporal_sdk_core::worker::workflow::managed_run: Error in run machines, error: RunUpdateErr { source: Nondeterminism("Continue as new workflow machine does not handle this event: HistoryEvent(id: 30, Some(TimerStarted))"), complete_resp_chan: Some(Sender { inner: Some(Inner { state: State { is_complete: false, is_closed: false, is_rx_task_set: true, is_tx_task_set: false } }) }) }
> ```

@JoshVee This would be a different problem, and is very likely a result of nondeterminism in your workflow code (possibly due to deploying new, incompatible code), where it's choosing to continue as new but the existing history was starting some timer at that point. If you believe your code is deterministic & you did not deploy new incompatible code, feel free to open a different issue - ideally with some example workflow code & history. Thanks!

</details>

<details>
<summary><strong>JoshVee</strong> commented on 2022-09-21 04:31:58.000 UTC</summary>

Thanks for the response @Sushisource. Seems like the issue was caused by workflows that had been originally started on the older SDK worker, but then `ContinuedAsNew` onto the v1.2.0 worker.

</details>


---

<a id="635"></a>

### #635: [Bug] Fix message when objects are thrown

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/635 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-05 18:20:57.000 UTC (3y 8m ago) |
| **Updated** | 2022-06-09 19:37:25.000 UTC |
| **Closed** | 2022-06-09 19:37:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Currently, `throw {a : 'test'}` results in a failure with message `"[object Object]"`. It should be `{a: "test"} [A non-Error value was thrown from your code. We recommend throwing Error objects so that we can provide a stack trace.]`

#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 18:25:45.000 UTC</summary>

Are you suggesting we call `util.inspect` on the value? I wouldn't want to use `JSON.stringify` for this.
Even `util.inspect` might be overkill.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-05 18:32:51.000 UTC</summary>

Currently it's supposed to use `JSON.stringify`. Happy to switch to `util.inspect`

https://github.com/temporalio/sdk-typescript/blob/main/packages/common/src/failure.ts#L346

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 19:52:26.000 UTC</summary>

It would work with the current workflow runtime but if we ever want to make a safer sandbox which allows running untrusted code we won't be able to use that.

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-05-31 16:05:27.000 UTC</summary>

I took a look - wasn't this fixed with #467 ? Given the below workflow:

```ts
export async function example(name: string): Promise<string> {
  throw { answer: 42 };
  return await greet(name);
}
```

I get the below in worker logs.

```
2022-05-31T16:00:50.567114Z  WARN temporal_sdk_core::worker: Failing workflow activation, run_id: "9bc347c2-8ac1-40f7-ac4e-778822c4cef8", failure: Failure { failure: Some(Failure { message: "{\"answer\":42} [A non-Error value was thrown from your code. We recommend throwing Error objects so that we can provide a stack trace.]", source: "TypeScriptSDK", stack_trace: "", cause: None, failure_info: None }) }
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-31 16:08:29.000 UTC</summary>

Yes, thanks! 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-31 16:18:59.000 UTC</summary>

TBH, we probably shouldn't be using JSON.stringify here (or util.inspect which isn't available in the workflow context).
We can maybe wrap the `JSON.stringify` call or it'll throw in some cases:

```
> JSON.stringify(1n)
Uncaught TypeError: Do not know how to serialize a BigInt
    at JSON.stringify (<anonymous>)
```

</details>


---

<a id="604"></a>

### #604: [Bug] Runtime logger isn't used by webpack bundler

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/604 |
| **State** | CLOSED |
| **Author** | airhorns (Harry Brundage) |
| **Created** | 2022-04-21 13:27:04.000 UTC (3y 8m ago) |
| **Updated** | 2022-06-04 15:21:46.000 UTC |
| **Closed** | 2022-06-04 00:41:03.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 4 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

I'm trying to override the runtime logger to use existing logging infrastructure for formatting and structuring, and it works great for logs generated by the worker and sinks and whatnot, but the logs generated by webpack when building the workflow bundle do not flow through my logger. 

### Describe the bug

Logs are emitted using `console.error`, instead of the custom entry function passed to the `DefaultLogger` passed to `Runtime.install`

### Minimal Reproduction

```typescript
// install the runtime with a custom logger
Runtime.install({
  logger: new DefaultLogger("INFO", (entry) => {
    console.log("here's a prefix:", entry)
  })
});

// then boot a worker with workflowsPath so webpack builds the bundle
await Worker.create({
  workflowsPath: require.resolve(...)
});

// note how webpack logs are not prefixed
```

### Environment/Versions


- OS and processor: macOS 12.1.3
- Temporal Version: temporalite + `@temporalio/worker@0.20.2`
- No docker, no k8s

### Additional context

Thanks!


#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-04-25 17:44:04.000 UTC</summary>

Thanks for reporting, we'll look into it

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-06-04 00:30:06.000 UTC</summary>

I took a look and I'm unable to repro this issue. Running the below code:

```ts
import { Runtime, DefaultLogger, Worker } from '@temporalio/worker';
import * as activities from './activities';

async function run() {
  // Step 1: Register Workflows and Activities with the Worker and connect to
  // the Temporal server.
  Runtime.install({
    logger: new DefaultLogger("INFO", (entry) => {
      console.log("here's a prefix:", entry)
    })
  });

  const worker = await Worker.create({
    workflowsPath: require.resolve('./workflows'),
    activities,
    taskQueue: 'hello-world',
  });
  // Worker connects to localhost by default and uses console.error for logging.
  // Customize the Worker by passing more options to create():
  // https://typescript.temporal.io/api/classes/worker.Worker
  // If you need to configure server connection parameters, see docs:
  // https://docs.temporal.io/docs/typescript/security#encryption-in-transit-with-mtls

  // Step 2: Start accepting tasks on the `tutorial` queue
  await worker.run();
}

run().catch((err) => {
  console.error(err);
  process.exit(1);
});
```

gives me the below output:

```
$ npm start

> temporal-hello-world@0.1.0 start
> ts-node src/worker.ts

  2022-06-04T00:22:18.462740Z  INFO temporal_sdk_core::worker: Initializing worker, task_queue: hello-world

here's a prefix: {
  level: 'INFO',
  message: 'asset \x1B[1m\x1B[32mmain.js\x1B[39m\x1B[22m 518 KiB \x1B[1m\x1B[32m[emitted]\x1B[39m\x1B[22m (name: main)',
  meta: undefined,
  timestampNanos: 1654302138979125441n
}
here's a prefix: {
  level: 'INFO',
  message: 'runtime modules 937 bytes 4 modules',
  meta: undefined,
  timestampNanos: 1654302138980769534n
}
here's a prefix: {
  level: 'INFO',
  message: 'modules by path \x1B[1m./node_modules/@temporalio/\x1B[39m\x1B[22m 140 KiB',
  meta: undefined,
  timestampNanos: 1654302138980860746n
}
```

It looks like Webpack output is running through the logger. Am I missing something?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-04 00:41:03.000 UTC</summary>

Going over the code, it looks like we do pass the logger in (and confirmed by @vkarpov15 - thanks).
The only case where the runtime logger isn't used is if you manually call `bundleWorkflowCode` which I think is acceptable since it doesn't require instantiating the Rust Core runtime.

</details>

<details>
<summary><strong>airhorns</strong> commented on 2022-06-04 15:21:46.000 UTC</summary>

Thanks folks! I think I did notice that this got fixed somewhere along the way as well -- forgot to come over here and close this, my bad!

</details>


---

<a id="542"></a>

### #542: [Feature Request] Require a Worker to specify either workflowsPath or workflowBundle

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/542 |
| **State** | CLOSED |
| **Author** | ksapchuk (Kirill) |
| **Created** | 2022-03-16 02:46:58.000 UTC (3y 10m ago) |
| **Updated** | 2023-05-29 17:12:45.000 UTC |
| **Closed** | 2023-05-29 17:12:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.
When creating a worker both the workflowPath and workflowBundle are optional. 

https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/worker-options.ts#L33-L53
If neither of these are specified the worker happily starts up and does not pick up any work since it's not aware of any workflows it can run. This can be painful to debug since everything appears to be working. 
```
2022-03-16T02:28:38.496Z [INFO] Worker state changed { state: 'RUNNING' }
```

### Describe the solution you'd like
The worker should fail to start without any workflows specified or the types should require one of the options to be passed in. 

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-16 16:07:19.000 UTC</summary>

This is by design, you can run activity only workers.

We could log a warning if that would help.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-16 16:25:54.000 UTC</summary>

I was thinking we could also do:

```ts
export type WorkerOptions = RequireAtLeastOne<WorkerOptionsWithOptionalCode, 'activities' | 'workflowsPath' | 'workflowsBundle' >
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-17 00:10:56.000 UTC</summary>

That could be nice but I fear it would make the API reference for that interface hard to parse.

</details>

<details>
<summary><strong>ksapchuk</strong> commented on 2022-03-17 18:04:11.000 UTC</summary>

What if the worker could print out what activities or workflows it was able to find? It's not as full proof as type check but at least simplifies debugging. 

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-03-17 23:47:02.000 UTC</summary>

@bergundy I opened an item a while back about logging warning. Other users have wasted time on this as well: https://github.com/temporalio/sdk-typescript/issues/471

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-29 17:12:44.000 UTC</summary>

Both "no workflows registered" and "no activity registered" results in warning messages being logged (fixed in #808).

</details>


---

<a id="534"></a>

### #534: [Bug] regenerator-runtime not found

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/534 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-13 00:14:59.000 UTC (3y 10m ago) |
| **Updated** | 2022-04-18 23:58:48.000 UTC |
| **Closed** | 2022-04-18 23:58:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Version: `0.19.0`

Running a worker with `ts-node` sometimes* results in `swc-loader` including code with `require('regenerator-runtime')` in the bundle, which Webpack tries to resolve, and fails.

Related issue in `swc`: https://github.com/swc-project/swc/issues/1461

*sometimes: works in `samples-typescript` repo, but not when using `@temporalio/create`

### works

```
git clone https://github.com/temporalio/samples-typescript.git
cd samples-typescript/hello-world
npm i temporalio@0.19.0
npm start
```

### errors

```
npx @temporalio/create@latest ./example
cd example
npm i temporalio@0.19.0 @temporalio/worker@0.19.0
npm start

...
2022-03-12T23:27:08.424Z [ERROR] ERROR in ./src/workflows.ts 30:0-53
2022-03-12T23:27:08.424Z [ERROR] Module not found: Error: Can't resolve 'regenerator-runtime' in '/Users/me/test/example/src'
```

In both locations, `tsc && node lib/worker` works.

#### Comments (6)

<details>
<summary><strong>julianocomg</strong> commented on 2022-03-13 00:58:05.000 UTC</summary>

@lorensr  Did you try installing regenerator-runtime as a dependency?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-13 01:18:53.000 UTC</summary>

Yes, adding it as a devDep is a workaround, but we'd like to figure out when/why it's included in the webpack bundle in the first place (we'd like to keep bundle size down, and it shouldn't be needed for our build target, Node 14+).

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-15 03:19:24.000 UTC</summary>

> We'll definitely want to support swc-loader we will consider making it the default, I just want to verify it works as expected and doesn't transform generators and async functions.
‚ÄîRoey

</details>

<details>
<summary><strong>julianocomg</strong> commented on 2022-03-15 03:21:19.000 UTC</summary>

@lorensr can‚Äôt wait for that. thank you üôè

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-03-15 12:18:42.000 UTC</summary>

If I paste the following code on https://swc.rs/playground, it seems that `regenerator-runtime` and `_asyncToGenerator` completely disappear once `target` is set at least to ES2017... Could be worth trying setting this option through `swc-loader`'s options...

```
import { y } from 'abc';

async function asyncFunc() {
    await y();
}

function *genFunc() {
    yield 'a';
    yield 'b';
    yield 'c';
}
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-04-18 23:58:44.000 UTC</summary>

`swc-loader` included in `0.20.2`

</details>


---

<a id="506"></a>

### #506: [Feature Request] Get proto comments in API docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/506 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-02 18:47:18.000 UTC (3y 10m ago) |
| **Updated** | 2023-05-30 18:53:26.000 UTC |
| **Closed** | 2023-05-30 18:53:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

`protobufjs`-generated classes like:

https://typescript.temporal.io/api/classes/proto.temporal.api.workflowservice.v1.RecordActivityTaskHeartbeatByIdRequest

don't explain what the properties are beyond their types. 

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

It would be nice if the proto comments showed up:

https://github.com/temporalio/api/blob/eff34dc3a970cdbf3a10a7be827edf1b1528b125/temporal/api/workflowservice/v1/request_response.proto#L376

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

User question looking at current docs: https://temporalio.slack.com/archives/C01DKSMU94L/p1646242515967829

#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-02 19:23:55.000 UTC</summary>

Core needs to use `/** */` style comments in the API for protobufjs to generate the docs.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-03-02 20:10:17.000 UTC</summary>

Protojs should do this translation properly. If we use `/** */` everywhere I'm worried that just breaks other languages whose generators expect to see `//` for comments (since the[ actual spec](https://developers.google.com/protocol-buffers/docs/proto#adding_comments) expects `//` or `/* */`). The Rust protobuf generator just turns `//` into `///` for example.

This should (in theory) be a fairly trivial contribution to make to `protobufjs` is we can do that and get it merged

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-03 00:44:10.000 UTC</summary>

protobufjs isn't really maintained unfortunately, last commit was May 2021

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-03 00:44:41.000 UTC</summary>

Also why would `/**` break other generators?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-03-03 17:40:10.000 UTC</summary>

They may expect to see `//` or `/*` - assuming they support the latter, it may still work, but will add an extra `*` to every comment :)

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-03-08 00:05:24.000 UTC</summary>

alternative way to tackle this @lorensr  - can we make docusaurus link back to source code? kills a couple birds with one stone

</details>


---

<a id="489"></a>

### #489: [Bug] `npm i --production` insufficient

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/489 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-17 23:15:59.000 UTC (3y 10m ago) |
| **Updated** | 2022-02-24 23:33:48.000 UTC |
| **Closed** | 2022-02-24 23:33:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

@idoshamun reported in https://github.com/temporalio/documentation/pull/917 that they needed to `npm i` instead of `npm i --production` (or `npm i --only=prod` or `NODE_ENV=production npm i`), which implies that we need to move at least one devDep to deps somewhere. I haven't repro'd yet. Ido‚Äîdo you have the error message, or remember which package it was in?

#### Comments (6)

<details>
<summary><strong>idoshamun</strong> commented on 2022-02-18 07:08:49.000 UTC</summary>

Here it is:
```
2022-02-15T20:51:37.521Z [INFO] [temporal_sdk_core] Registering worker task_queue="content-pipeline"
Error: Cannot find module 'acorn'
Require stack:
- /opt/app/node_modules/acorn-import-assertions/lib/index.js
- /opt/app/node_modules/webpack/lib/javascript/JavascriptParser.js
- /opt/app/node_modules/webpack/lib/javascript/JavascriptModulesPlugin.js
- /opt/app/node_modules/webpack/lib/WebpackOptionsApply.js
- /opt/app/node_modules/webpack/lib/webpack.js
- /opt/app/node_modules/webpack/lib/index.js
- /opt/app/node_modules/@temporalio/worker/lib/workflow/bundler.js
- /opt/app/node_modules/@temporalio/worker/lib/worker.js
- /opt/app/node_modules/@temporalio/worker/lib/index.js
- /opt/app/src/temporal/worker.js
- /opt/app/index.js
    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:880:15)
    at Function.Module._load (internal/modules/cjs/loader.js:725:27)
    at Module.require (internal/modules/cjs/loader.js:952:19)
    at require (internal/modules/cjs/helpers.js:88:18)
    at Object.<anonymous> (/opt/app/node_modules/acorn-import-assertions/lib/index.js:8:38)
    at Module._compile (internal/modules/cjs/loader.js:1063:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)
    at Module.load (internal/modules/cjs/loader.js:928:32)
    at Function.Module._load (internal/modules/cjs/loader.js:769:14)
    at Module.require (internal/modules/cjs/loader.js:952:19) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    '/opt/app/node_modules/acorn-import-assertions/lib/index.js',
    '/opt/app/node_modules/webpack/lib/javascript/JavascriptParser.js',
    '/opt/app/node_modules/webpack/lib/javascript/JavascriptModulesPlugin.js',
    '/opt/app/node_modules/webpack/lib/WebpackOptionsApply.js',
    '/opt/app/node_modules/webpack/lib/webpack.js',
    '/opt/app/node_modules/webpack/lib/index.js',
    '/opt/app/node_modules/@temporalio/worker/lib/workflow/bundler.js',
    '/opt/app/node_modules/@temporalio/worker/lib/worker.js',
    '/opt/app/node_modules/@temporalio/worker/lib/index.js',
    '/opt/app/src/temporal/worker.js',
    '/opt/app/index.js'
  ]
}
```

</details>

<details>
<summary><strong>idoshamun</strong> commented on 2022-02-20 14:10:21.000 UTC</summary>

Following James Watkins-Harvey advice on Slack (https://temporalio.slack.com/archives/CTRCR8RBP/p1645195758175629?thread_ts=1644943893.749649&cid=CTRCR8RBP), I managed to find the root cause.
I used `workflowsPath` instead of `workflowBundle` which caused temporal to build my workflows in production.

I somehow missed the point here:
https://docs.temporal.io/docs/typescript/production-deploy#pre-build-code

I think we can close this issue now.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-02-21 18:46:08.000 UTC</summary>

@idoshamun Glad it helped.

It might still be useful though to highlight this point in documentation. Using `workflowsPath` is essentially a "development mode", and implies that you need to install development dependencies.

Along the same line, it could be useful to make the dependency from @temporalio/worker to webpack a dev-dependency (see [here](https://github.com/temporalio/sdk-typescript/blob/817312d4059200c2c15a608282d159ad51679915/packages/worker/package.json#L35)). It would be much easier for people to understand the situation when they get a message saying they're missing webpack than some less known package down the road.

</details>

<details>
<summary><strong>idoshamun</strong> commented on 2022-02-22 08:56:06.000 UTC</summary>

@mjameswh you're right.
See my PR here: https://github.com/temporalio/documentation/pull/930
Hopefully it will get reviewed and merged soon

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-22 21:57:06.000 UTC</summary>

We'd like `workflowsPath` to work in prod, so let's add acorn and whatever else we need. 

My repro gives this output:

```
git clone https://github.com/temporalio/samples-typescript
cd samples-typescript/hello-world
npm i --production
npm run build
node lib/worker.js
```

```
2022-02-22T21:40:25.170Z [ERROR] ERROR in ./node_modules/@temporalio/common/lib/time.js 8:29-42
2022-02-22T21:40:25.170Z [ERROR] Module not found: Error: Can't resolve 'ms' in '/Users/me/gh/samples-typescript/hello-world/node_modules/@temporalio/common/lib'
2022-02-22T21:40:25.170Z [ERROR] resolve 'ms' in '/Users/me/gh/samples-typescript/hello-world/node_modules/@temporalio/common/lib'
2022-02-22T21:40:25.170Z [ERROR]   Parsed request is a module
2022-02-22T21:40:25.170Z [ERROR]   using description file: /Users/me/gh/samples-typescript/hello-world/node_modules/@temporalio/common/package.json (relative path: ./lib)
2022-02-22T21:40:25.170Z [ERROR]     Field 'browser' doesn't contain a valid alias configuration
2022-02-22T21:40:25.170Z [ERROR]     resolve as module
2022-02-22T21:40:25.170Z [ERROR]       looking for modules in /Users/me/gh/samples-typescript/hello-world/node_modules
2022-02-22T21:40:25.170Z [ERROR]         single file module
2022-02-22T21:40:25.170Z [ERROR]           using description file: /Users/me/gh/samples-typescript/hello-world/package.json (relative path: ./node_modules/ms)
2022-02-22T21:40:25.170Z [ERROR]             no extension
2022-02-22T21:40:25.170Z [ERROR]               Field 'browser' doesn't contain a valid alias configuration
2022-02-22T21:40:25.170Z [ERROR]               /Users/me/gh/samples-typescript/hello-world/node_modules/ms doesn't exist
2022-02-22T21:40:25.170Z [ERROR]             .ts
2022-02-22T21:40:25.170Z [ERROR]               Field 'browser' doesn't contain a valid alias configuration
2022-02-22T21:40:25.170Z [ERROR]               /Users/me/gh/samples-typescript/hello-world/node_modules/ms.ts doesn't exist
2022-02-22T21:40:25.170Z [ERROR]             .js
2022-02-22T21:40:25.170Z [ERROR]               Field 'browser' doesn't contain a valid alias configuration
2022-02-22T21:40:25.170Z [ERROR]               /Users/me/gh/samples-typescript/hello-world/node_modules/ms.js doesn't exist
2022-02-22T21:40:25.170Z [ERROR]         /Users/me/gh/samples-typescript/hello-world/node_modules/ms doesn't exist
2022-02-22T21:40:25.170Z [ERROR]  @ ./node_modules/@temporalio/common/lib/index.js 25:13-30
2022-02-22T21:40:25.170Z [ERROR]  @ ./node_modules/@temporalio/workflow/lib/worker-interface.js 9:17-46
2022-02-22T21:40:25.170Z [ERROR]  @ ../../../../../src/main.js 1:0-68 4:0-19 5:0-18 16:0-15
2022-02-22T21:40:25.170Z [ERROR] 
2022-02-22T21:40:25.170Z [ERROR] webpack 5.69.1 compiled with 1 error in 373 ms
Error: Webpack finished with errors, if you're unsure what went wrong, visit our troubleshooting page at https://docs.temporal.io/docs/typescript/troubleshooting#webpack-errors
```

`ms` is a dep of `@temporalio/common`:

<img width="724" alt="image" src="https://user-images.githubusercontent.com/251288/155225608-8a77cbed-a161-46b0-9785-9e9173d1b171.png">

But it doesn't appear in `node_modules/ms` until I run `npm i` (without --production).

Not sure when I'll get to this, but happy to review a PR if anyone would like to contribute! üòä

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-02-23 13:38:06.000 UTC</summary>

I was wrong. Acorn is a regular dependency of webpack, not a dev dependency. The problem isn't there.

But let's focus on the issue with `ms` for now. With `npm i`, I get the following copies of `ms`:

```
node_modules/@temporalio/client/node_modules/ms
node_modules/@temporalio/common/node_modules/ms
node_modules/@temporalio/worker/node_modules/ms
node_modules/ms
```

But with `npm i --production`, I get only get the followings:

```
node_modules/@temporalio/client/node_modules/ms
node_modules/@temporalio/common/node_modules/ms
node_modules/@temporalio/worker/node_modules/ms
```

So npm hoisted `ms` from some development package in the first case (actually, from `nodemon -> debug -> ms`), but didn't dedup `ms` (because `debug@4.3.3` require exact version `ms@2.1.2`, which is incompatible with requirement `ms@^2.1.3` from `@temporalio/common`). Now, when giving `--production`, npm actually calculates its ideal dependency tree including _all_ dependencies (ie. including dev and optional dependencies), then prune (if requested) dev and optional dependencies at a very late stage. That explains why `ms` is not getting hoisted/dedup with `npm i --production`.

One way or another, both are valid given Node's module resolution algorithm. It isn't working with our webpack bundler, however, because our default value for `resolve.modules` only includes absolute (see [here](https://github.com/temporalio/sdk-typescript/blob/fba4d46b668ef9b0feec0d953b359ab10adb9e01/packages/worker/src/workflow/bundler.ts#L106-L108) and  [here](https://github.com/temporalio/sdk-typescript/blob/fba4d46b668ef9b0feec0d953b359ab10adb9e01/packages/worker/src/worker-options.ts#L295-L299)). To get webpack to resolve dependencies using an algorithm compatible with Node's algorithm, we must also include the string  'node_modules' in `resolve.modules`.

For example, if I manually specify `nodeModulesPaths` in `hello-world/src/worker.ts`, _and add 'node_modules' to the array_, as follow:

```
  const worker = await Worker.create({
    workflowsPath: require.resolve('./workflows'),
    nodeModulesPaths: [`${__dirname}/../node_modules/`, 'node_modules'],
    activities,
    taskQueue: 'tutorial',
  });
```

then I no longer have any issue executing after `npm i --production`. Turns out that the missing `acorn` was similarly hiding inside `node_modules/webpack/node_modules/acorn`, there again because of a version incompatibility between a dev dependency and a runtime dependency.

So we simply add `node_modules` to the provided `nodeModulesPaths`, and voil√†! I shall submit a PR for this soon.

Reactions: üéâ 1

</details>


---

<a id="358"></a>

### #358: [Docs] Add SDK errors to code and API docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/358 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-06 03:03:35.000 UTC (4y 2m ago) |
| **Updated** | 2023-05-11 17:17:03.000 UTC |
| **Closed** | 2023-05-11 17:17:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | documentation |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

- Runtime discovery of undocumented SDK errors
- Inelegant classification in code: https://github.com/lorensr/samples-node/commit/6d5ef4083fe6afd5e895db3b8dad7d5b3bc342b7

### Describe the solution you'd like

- Be able to see in a method's API docs which error types it can throw
- Be able to use `instanceof` like this: https://github.com/temporalio/sdk-typescript/pull/353#issue-1041793587

### Additional context

Community slack threads: 
- https://temporalio.slack.com/archives/C01DKSMU94L/p1636119442111300
- https://temporalio.slack.com/archives/C01DKSMU94L/p1642107633045900

#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-07 22:00:23.000 UTC</summary>

We already have an error for this in `@temporalio/workflow` for starting a child that already exists, we should move it to `common` and reuse in `client`:
https://github.com/temporalio/sdk-typescript/blob/ace29a3feb7b32379bf9d711bf3fc592c3ca7c77/packages/workflow/src/errors.ts#L27

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-02-03 18:18:20.000 UTC</summary>

@lorensr i'd like to work on this with you when you get around to this, i know its not the highest priority

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-17 19:34:02.000 UTC</summary>

@lorensr I thought I closed this in #468 

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-17 22:56:10.000 UTC</summary>

Oh yeah, I forgot you added `WorkflowExecutionAlreadyStartedError` and `WorkflowNotFoundError`. 

Not sure if there are other codes we can create error classes for (is there a comprehensive list somewhere?), and would still like to document the set of possible errors that can be thrown by which methods.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-10 17:33:23.000 UTC</summary>

@lorensr Can this be closed? Otherwise, what exactly still needs to be done?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-11 17:17:02.000 UTC</summary>

Will be covered as a cross SDK effort. Closing.

</details>


---

<a id="305"></a>

### #305: [Feature Request] Help users avoid old-worker-code bug

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/305 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-10-15 17:13:08.000 UTC (4y 2m ago) |
| **Updated** | 2023-01-12 03:15:32.000 UTC |
| **Closed** | 2023-01-10 17:18:56.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 4 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

When devs have an old version of their code in a worker (in the background or another shell they forgot about), they can face an issue where they `npm run workflow`, and sometimes the tasks are picked up by the up-to-date worker, and sometimes they're picked up by an old worker, and they don't realize the latter is happening, so they don't know why sometimes things aren't working.

### Describe the solution you'd like

While we could add this to the [troubleshooting page](https://docs.temporal.io/docs/node/troubleshooting), I think a better solution would be to warn users‚Äîwhen the worker starts in development, can it search for other worker processes on the current machine and log a warning with the PID(s)?

```
‚ö†Ô∏è Warning: There is another worker process running on this machine. 
If it was started with an older version of your Worker and Activity code, 
we recommend stopping it to ensure that only your current code is being run. 
You can stop it by running this command in your shell:
kill 1234
```

### Additional context

While I've experienced this before, I didn't think about solving it for others until @schickling had the issue‚Äîthanks!


#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 17:40:08.000 UTC</summary>

@lorensr can you describe exactly how you think this will work?
By development do you mean that the worker connects to localhost or to check `NODE_ENV`?

`tctl` has a feature to describe the task queue and list connected workers which we may be able to use (by calling the server API not invoking `tctl`)

```shellsession
$ tctl tq desc --tq test
  WORKFLOW POLLER IDENTITY |   LAST ACCESS TIME
  27354@macbearpig.lan     | 2021-10-15T17:37:02Z
```

Maybe this could be done by `nodemon` when running `start.watch`? It doesn't cover all of the cases though.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-10-15 19:25:15.000 UTC</summary>

### How to determine if in development

- `const inDevelopment = !["production", "staging"].includes(process.env.NODE_ENV)`? Some users may not set `NODE_ENV` in prod, so this isn't completely accurate, but the inaccurate case‚Äîhaving extra irrelevant console output in prod‚Äîisn't that bad.
- Is worker connecting to localhost? Possible to develop non-localhost. Don't know how common that is.

### How to determine if other worker processes

I was just imagining checking `ps` for any processes with matching commands to self. The tctl API seems better‚Äîif the check is being done inside `worker.run`, we'll know which task queue, and we know our own PID from `process.pid`.


</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-10 17:18:56.000 UTC</summary>

Should probably be resolved using worker versioning instead.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-01-12 03:15:32.000 UTC</summary>

@Sushisource does versioning solve this development use case, or is it just for deployment?

</details>


---

<a id="243"></a>

### #243: [Feature Request] Asynchronous Activity Completion

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/243 |
| **State** | CLOSED |
| **Author** | mikegai (Michael Gai) |
| **Created** | 2021-09-15 06:57:07.000 UTC (4y 3m ago) |
| **Updated** | 2021-12-10 18:12:20.000 UTC |
| **Closed** | 2021-12-10 18:12:20.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 4 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

We have a Node activity that makes a POST request to an existing (Node) AWS Lambda function, which in turn launches a process that can last over a minute.
The Lambda is behind an API gateway so has a maximum timeout of 30 seconds. So we can't wait for the lambda to return the final response.
Right now we have the lambda immediately returning a 200 upon start of the process, and then later signaling success/failure back to the workflow when done.
However that makes us add extra signal(s) (success/fail) just to complete a simple activity. It's just a few lines of code so is not onerous, but it does add some noise to an otherwise smooth flow.
In the Go SDK we see an incrementally more attractive approach.

### Describe the solution you'd like

In the Go SDK you can "asynchronously complete an activity":
https://docs.temporal.io/docs/go/activities#asynchronous-activity-completion
We would like the same in node.
That way we can preserve the separation of concerns between workflow and activities: workflows execute activities while activities take care of any internal execution complexity, saving signals for true inter-"actor" collaboration and external events.



#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-18 11:10:18.000 UTC</summary>

This is definitely something we want to support.
Technically this is already supported since you can complete the activity using the service client but you can‚Äôt make the worker ‚Äúforget‚Äù about which will cause resource leak.

I‚Äôll make sure to prioritize forgetting activities after we release beta.

cc @Sushisource 


</details>

<details>
<summary><strong>zlalvani</strong> commented on 2021-10-21 20:26:56.000 UTC</summary>

@bergundy I'm running into the same need, can you explain what you mean by the worker not forgetting if we use `WorkflowService.respondActivityTaskCompleted`?

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-21 21:02:28.000 UTC</summary>

Right now the worker takes ownership of an activity.
This means that when your activity function returns or throws it will report the result back to the server.
There's no way of letting the worker know that the activity will be resolved asynchronously.

If you were to never return from the activity function (assuming no timeout on the activity task) the worker would leak memory tracking all of the open activities.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-02 01:21:52.000 UTC</summary>

I plan on implementing the TypeScript side tomorrow or Wednesday, core support was already added.

</details>


---

<a id="220"></a>

### #220: [Bug] Can't resolve built-in node libraries

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/220 |
| **State** | CLOSED |
| **Author** | alex-dixon (Alex Dixon) |
| **Created** | 2021-09-01 15:43:56.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-12 11:29:44.000 UTC |
| **Closed** | 2021-09-09 08:38:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Webpack compilation fails when code imports built-in node libraries like `fs`, `os` etc.

### To Reproduce


1. `import * as fs from 'fs'`
2. console.log('fs',fs)
3. Should throw an error similar to the below

### Expected behavior

Compile without polyfills for built-in node libraries.

### Screenshots/Terminal output
```
2021-09-01T15:21:12.290Z [INFO] ERROR in ./node_modules/@airbrake/node/esm/filter/node.js 2:9-22
2021-09-01T15:21:12.291Z [INFO] Module not found: Error: Can't resolve 'os' in '/node_modules/@airbrake/node/esm/filter'
2021-09-01T15:21:12.291Z [INFO] 
2021-09-01T15:21:12.292Z [INFO] BREAKING CHANGE: webpack < 5 used to include polyfills for node.js core modules by default.
2021-09-01T15:21:12.292Z [INFO] This is no longer the case. Verify if you need this module and configure a polyfill for it.
2021-09-01T15:21:12.293Z [INFO] 
2021-09-01T15:21:12.293Z [INFO] If you want to include a polyfill, you need to:
2021-09-01T15:21:12.293Z [INFO]     - add a fallback 'resolve.fallback: { "os": require.resolve("os-browserify/browser") }'
2021-09-01T15:21:12.293Z [INFO]     - install 'os-browserify'
2021-09-01T15:21:12.293Z [INFO] If you don't want to include a polyfill, you can use an empty module like this:
2021-09-01T15:21:12.294Z [INFO]     resolve.fallback: { "os": false }
2021-09-01T15:21:12.294Z [INFO] resolve 'os' in '/node_modules/@airbrake/node/esm/filter'
```

### Versions
- OS: Linux
- Temporal Version 0.3.0
- Are you using Docker or Kubernetes or building Temporal from source?
Docker + Kubernetes

### Additional context

Adding `target: "node"` to the webpack configuration may be all that is needed to fix this. It defaults to "web".

#### Comments (6)

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-07 19:00:07.000 UTC</summary>

Is `fs` a native node API, in which case it can't be used in the WF isolate?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 08:38:48.000 UTC</summary>

`fs` is a native node API and cannot be imported in the Workflow isolate, you should use an activity to access the filesystem.
https://docs.temporal.io/docs/node/determinism/#imports-in-workflow-code

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 08:44:53.000 UTC</summary>

In the future, we'll add local activities and side-effects support so you can read from a *local* FS from workflow code.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-09 09:36:14.000 UTC</summary>

By the way, I like the Node SDK name, but I can see that this behavior would seem more intuitive if the SDK were renamed TypeScript SDK, as some have suggested.

</details>

<details>
<summary><strong>alex-dixon</strong> commented on 2021-09-09 14:23:10.000 UTC</summary>

Couple thoughts: 

1. Maybe we could polyfill/wrap things like fs with a default activity implementation? Then we wouldn‚Äôt all need to write activities for things like writing files. Existing code (eg fs.writeFileSync) would just work (and have all the benefits of an activity). 

2. Adding something like ‚Äúrules of workflows‚Äù to the docs may help others in the future. Determinism seems like a separate concern from native node modules. ‚Äòquerystring‚Äô is a pure function. Is it allowed?




</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 11:29:44.000 UTC</summary>

1. The thing with activities is that they run on different workers, writing to the filesystem isn't encouraged in this sort of setup.

Take the following workflow for example:
```ts
await writeFile('a.txt', 'hello')
await sleep(100000000)
await readFile('a.txt')
```

`writeFile` and `readFile` will possibly run on different workers. Even with local activities, there's no guarantee that the same worker will pick up the workflow after it's resumed.

2. `querystring`(deprecated) is a pure function and should technically be importable if it is implemented in pure JS (no native code) and webpack can find it. I'll try to clarify the docs to make this easier to find.



</details>


---

<a id="119"></a>

### #119: [Feature Request] Review timeout / retries and reconnection configuration for the client connection

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/119 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-03 17:50:23.000 UTC (4y 7m ago) |
| **Updated** | 2021-10-01 20:25:05.000 UTC |
| **Closed** | 2021-10-01 20:25:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 6 |
| **Priority Score** | 6 |
| **Labels** | enhancement |
| **Assignees** | Sushisource |
| **Milestone** | beta |

#### Description

*No description provided.*

#### Comments (6)

<details>
<summary><strong>bergundy</strong> commented on 2021-07-22 16:54:32.000 UTC</summary>

@vitarb once you're done with this work in core can you do this one please?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-31 14:32:35.000 UTC</summary>

@vitarb looks like in Java we have both [gRPC level retries](https://github.com/temporalio/sdk-java/tree/6e21990343467afe4b0d63e80c7016800147728e/temporal-serviceclient/src/main/java/io/temporal/serviceclient/rpcretry) and [SDK level retries](https://github.com/temporalio/sdk-java/blob/6e21990343467afe4b0d63e80c7016800147728e/temporal-sdk/src/main/java/io/temporal/internal/common/WorkflowExecutionUtils.java#L203).

I'll take care of exposing the retry configuration, you can use some sane defaults for now.



</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 12:49:53.000 UTC</summary>

Related:
- https://github.com/temporalio/sdk-java/pull/709
- https://github.com/temporalio/sdk-java/issues/653
- https://github.com/temporalio/sdk-java/issues/666

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-23 18:06:14.000 UTC</summary>

@Sushisource are you handling this now?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-09-23 21:01:31.000 UTC</summary>

@bergundy Yeah I'll handle it.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-01 20:25:05.000 UTC</summary>

Closing this since the retryer exists, is configurable, and does not retry deadline exceeded errors by default which is the right thing to do. The Java change dealt with automatic deadline propagation, but it seems that won't happen in `grpc-js`:

https://github.com/grpc/grpc-node/blob/master/packages/grpc-js/src/constants.ts#L46

</details>


---

<a id="1765"></a>

### #1765: [Bug] Network error while sending worker heartbeat after updating to 1.12.2

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1765 |
| **State** | CLOSED |
| **Author** | HalfdanJ (Jonas Jongejan) |
| **Created** | 2025-08-19 16:00:44.000 UTC (4 months ago) |
| **Updated** | 2025-08-19 23:46:09.000 UTC |
| **Closed** | 2025-08-19 20:17:56.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 3 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Run temporal worker in typescript with sdk version `1.12.2`

### Describe the bug

We are running a typescript worker, after updating to version 1.12.2 from 1.12.1 our worker keeps crashing in production environment. 

```
Network error while sending worker heartbeat ^[
Status { 
  code: PermissionDenied, 
  message: "Request unauthorized.", 
  details: b"\x08\x07\x12\x15Request unauthorized.\x1a\x8d\x01\nHtype.googleapis.com/temporal.api.errordetails.v1.PermissionDeniedFailure\x12A\n?caller has insufficient permissions for namespace '<REDACTED>'", 
  metadata: MetadataMap { headers: {"content-type": "application/grpc", "server": "temporal", "date": "Tue, 19 Aug 2025 14:32:54 GMT"} }, 
  source: None
 }
```

This is not happening when running locally connected to the local temporal dev environment. Only when connecting to Temporal Cloud. 

I'm using API key to connect, could this have something to do with it? 

I'm noticing in the diff a change was made regarding worker heartbeat. https://github.com/temporalio/sdk-typescript/compare/v1.12.1...v1.12.2#diff-4fbe311f299e2a07f622e1a29cb87cd1950978df54e13a3fe116a3e1bdd201acR307 


### Minimal Reproduction

Havent yet made a code sample for this, but can do

### Environment/Versions

- OS and processor: Linux
- Temporal Version: 1.12.2
- Are you using Docker or Kubernetes or building Temporal from source? Docker (in Google Cloud Run)

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (3)

<details>
<summary><strong>THardy98</strong> commented on 2025-08-19 16:49:33.000 UTC</summary>

Hi @HalfdanJ ,

Could you open a Zendesk ticket for this issue?

Reactions: üëç 1

</details>

<details>
<summary><strong>HalfdanJ</strong> commented on 2025-08-19 16:55:02.000 UTC</summary>

Done > #15108

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-19 23:46:09.000 UTC</summary>

Fixed in [TS SDK v1.12.3](https://github.com/temporalio/sdk-typescript/releases/tag/v1.12.3).

Reactions: üéâ 1

</details>


---

<a id="1668"></a>

### #1668: [Bug] common package not importing @types/ms

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1668 |
| **State** | OPEN |
| **Author** | cosn (Cosmin Nicolaescu) |
| **Created** | 2025-04-03 02:26:11.000 UTC (9 months ago) |
| **Updated** | 2025-05-28 00:48:27.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 1 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

The `common` package imports `ms` but not its types. As such, there is no validation on e.g. `Duration` props. However, if the package is pulled in from some other dependency, it will break any temporal usage that does not `as const` or explicitly type the props.

#### Comments (1)

<details>
<summary><strong>wi-ski</strong> commented on 2025-05-28 00:48:26.000 UTC</summary>

Same

</details>


---

<a id="1663"></a>

### #1663: [Bug] Can't use structuredClone in workflow code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1663 |
| **State** | OPEN |
| **Author** | pn1k |
| **Created** | 2025-04-01 20:10:23.000 UTC (9 months ago) |
| **Updated** | 2025-05-15 19:28:24.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Make a copy of value in workflow code with structuredClone() function of nodejs.

### Describe the bug

It seems that webpack'ed code lack of structuredClone function.

### Minimal Reproduction

// in workflow code
const someData = { foo: 'bar' }
const cloneData = structuredClone(someData);

### Environment/Versions
- Node 22.14.0
- OS and processor: Linux x86
- Temporal SDK: 1.11.7



#### Comments (5)

<details>
<summary><strong>lukeramsden</strong> commented on 2025-04-16 13:33:34.000 UTC</summary>

I've just found this too, trying to use structuredClone to copy some input arrays that are then modified inside a class. @mjameswh is there any reason not to expose this in the workflow sandbox same as we did for TextDecoder etc? I can open a PR to do that.

</details>

<details>
<summary><strong>lukeramsden</strong> commented on 2025-04-16 13:51:03.000 UTC</summary>

```diff
diff --git a/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js b/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js
index f3a06d6..8fb90fd 100644
--- a/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js
+++ b/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js
@@ -60,6 +60,7 @@ class ReusableVMWorkflowCreator {
             TextEncoder: node_util_1.TextEncoder,
             TextDecoder: node_util_1.TextDecoder,
             AbortController,
+            structuredClone,
         };
         this._context = node_vm_1.default.createContext(globals, { microtaskMode: 'afterEvaluate' });
         this.injectConsole();
diff --git a/node_modules/@temporalio/worker/lib/workflow/vm.js b/node_modules/@temporalio/worker/lib/workflow/vm.js
index 239aa90..21e2655 100644
--- a/node_modules/@temporalio/worker/lib/workflow/vm.js
+++ b/node_modules/@temporalio/worker/lib/workflow/vm.js
@@ -69,6 +69,7 @@ class VMWorkflowCreator {
             TextEncoder: node_util_1.TextEncoder,
             TextDecoder: node_util_1.TextDecoder,
             AbortController,
+            structuredClone,
         };
         const context = node_vm_1.default.createContext(globals, { microtaskMode: 'afterEvaluate' });
         this.script.runInContext(context);
```

If you use patch-package, this is a patch that will get this working. Testing myself in our system it all seems to work fine.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-15 05:34:40.000 UTC</summary>

_This is a summary from [this](https://temporalio.slack.com/archives/C01DKSMU94L/p1745351976943959) Slack conversation._

If the `structuredClone` function is injected this way, cloned objects prototypes will be associated with the wrong execution context, which means that `instanceof` will always return `false`, even for built-in types.

For example (this was executed ):

```
let x = { a: [1], b: new Error(), c: new Date() };
let y = structuredClone(x);

[x, y].map((z) => (z instanceof Object)
 => [true, false]

[x, y].map((z) => (z.a instanceof Array)
 => [true, false]

[x, y].map((z) => (z.b instanceof Error)
 => [true, false]

[x, y].map((z) => (z.c instanceof Date)
 => [true, false]
```

We have [a utility function](https://github.com/mjameswh/sdk-typescript/blob/4dcc82aa48fc285119978bd2a93acc3a0e9fd231/packages/workflow/src/worker-interface.ts#L165) that we use internally to recursively fix some well known prototypes on objects being transferred from an outer execution context. However, using that over `structuredClone` would break the contract of `structuredClone`, i.e. a single object reachable through multiple paths inside a source object graph should be cloned to a single object in the resulting graph. The `fixPrototypes` function could also fall in a never ending loop if the source graph contains self reference loops.

For those reasons, the best approach at this time is to load a polyfill.

Reactions: üëç 1

</details>

<details>
<summary><strong>lukeramsden</strong> commented on 2025-05-15 09:24:19.000 UTC</summary>

Fascinating - didn't know that. I would say that's worth documenting since I think this will come up again a lot. Going to replace my patch with a poly-fill.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-15 19:28:23.000 UTC</summary>

> I would say that's worth documenting since I think this will come up again a lot.

Yeah, been thinking about this for some time. We definitely need to provide more clarity regarding what expectations hold inside the workflow sandbox and why some things are not provided. Our current claim about only exposing "APIs that are deterministic-safe" is too imprecise, and not sufficient since there are other constraints at play.

Reactions: üëç 1

</details>


---

<a id="1541"></a>

### #1541: [Bug] Memory leak on the temporal worker side(OperatorSubscriber Class Objects are taking much of the memory)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1541 |
| **State** | CLOSED |
| **Author** | jainshivsagar |
| **Created** | 2024-10-08 07:39:13.000 UTC (1y 3m ago) |
| **Updated** | 2024-12-17 21:33:52.000 UTC |
| **Closed** | 2024-12-17 21:33:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We are using the TypeScript SDK v1.9.0 for our temporal worker.
We are doing the load testing in the local System. At the start of the worker the Memory(or Heap) utilization was <120MB, post the load testing, the Memory(or Heap) increased to ~300MB. After 5-10 minutes of load testing the memory utilization didn't come down.
Please refer to the below screenshots of Chrome DevTool(Memory Profiler):-

Memory Utilization after starting the worker:-

![image](https://github.com/user-attachments/assets/22394454-9cbe-4fa2-8aef-581f0ec32418)

Memory Utilization after load testing:-
![image](https://github.com/user-attachments/assets/f8cb4fc1-319b-4fbb-aae3-463f42bb1458)


Comparison of first two Heap snapshots:-
![image](https://github.com/user-attachments/assets/c304481c-e0e0-414f-96f7-aff0ef22295a)

### Environment/Versions

- OS and processor: 2.6 GHz 6-Core Intel Core i7, MacOs Sequoia(v15.0.1)
- Temporal Version: Temporal TypeScript SDK v1.9.0
- We running the worker in K8 nodes on the Staging/Prod ENV.

### Worker Configurations:-
```
  const worker = await Worker.create({
    connection,
    namespace: config.Temporal.Namespace,
    taskQueue: config.Temporal.TaskQueue,
    workflowsPath: require.resolve('./workflows'),
    activities: getActivities(),
    // maxActivitiesPerSecond: 100,
    // maxTaskQueueActivitiesPerSecond: 100,
    // maxConcurrentActivityTaskExecutions: 2000,
    maxConcurrentWorkflowTaskExecutions: 200,
    maxConcurrentWorkflowTaskPolls: 100,
    // maxConcurrentActivityTaskPolls: 1000,
    // maxCachedWorkflows: 3000,
    maxConcurrentLocalActivityExecutions: 200,
    // workflowThreadPoolSize: 100,
    enableNonLocalActivities: false
  });
```


#### Comments (5)

<details>
<summary><strong>mjameswh</strong> commented on 2024-10-08 22:40:54.000 UTC</summary>

>  After 5-10 minutes of load testing the memory utilization didn't come down.

What happens if you continue feeding workflows to the worker? Does memory continue to go up, or does it stay stable around some value, e.g. ~300MB?

The Worker caches Workflows in an LRU; a Workflow stays in the cache until it gets evicted either 1) to make room for another workflow that‚Äôs coming in, or 2) because processing of a Workflow Task failed. Completion of a Workflow doesn‚Äôt result in eviction.

That means that, assuming there‚Äôs no Workflow Task failures, the sticky cache size should quickly grow up to its maximum value, and then stay at that number for very long period of time (i.e. until the pod gets shutdown).

</details>

<details>
<summary><strong>jainshivsagar</strong> commented on 2024-10-09 06:37:24.000 UTC</summary>

Hi @mjameswh ,
I posted the above data after 3-4 rounds of load testing. After each round of testing, I observed that heap memory utilization was growing incrementally. After the 4th round of testing  & waiting for 5-10 mins, the heap memory utilization didn't come down.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-10-15 18:13:55.000 UTC</summary>

> waiting for 5-10 mins, the heap memory utilization didn't come down.

As I said before, we do not expect a Worker's memory usage to come down once a Workflow has completed. Completed Workflows may still be queried, so caching them may still be beneficial.

What we'd expect is for memory usage to grow until the cache size reaches its maximum capacity (`maxCachedWorkflows`), after which memory usage should remain relatively stable, as less recently used Workflows will get evicted from cache.

> After each round of testing, I observed that heap memory utilization was growing incrementally.

- How many Workflows get started per round?
- What is the capacity of your workflow cache? i.e. `maxCachedWorkflows`? If unsure, look at your Worker Options printed to logs on Worker start.
- Can you please try this with SDK 1.11.2?
- In your heap snapshot, how many instances of `VMWorkflowThreadProxy` do you have? How many instances of `Activity`?

Your screenshot indicates 43'890 instances of `OperatorSubscriber`. That's certainly a lot, yet could still be legitimate, depending on the number of cached Workflows; there are multiple `OperatorSubscriber` per cached Workflows and per pending Activities.

- At which point in your test sequence was your heap snapshot taken?
- By any chance, would it be possible for you to share your heap snapshot file? If you are a Temporal Cloud user, you may open a Zendesk ticket and include the file as a secure attachment.
- Otherwise, could you please try to provide reproduction code that demonstrates this issue?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-05 23:38:11.000 UTC</summary>

@jainshivsagar Are you still observing issues, or may we close this ticket?

</details>

<details>
<summary><strong>josh-berry</strong> commented on 2024-12-17 21:33:51.000 UTC</summary>

Closing since we haven't heard back.

</details>


---

<a id="1458"></a>

### #1458: [Feature Request] Support passing preloaded data converters to Client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1458 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-07-08 14:28:04.000 UTC (1y 6m ago) |
| **Updated** | 2024-09-22 06:07:15.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 1 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 üéâ 1 |

#### Description

### Describe the solution you'd like

At this time, all public APIs that accept `DataConverter`s require payload converter and failure converter to be specified as paths. That requirement originally stemmed from a desire of being consistent with the way `DataConverter`s are passed to Workflow Workers, where paths are required because these two converters need to be loaded inside the Workflow Sandbox.

It however appears that in this specific case, consistency is often counter-productive. Workflow code and client code are often part of distinct deployment units, with distinct build processes for workflow vs client code, so that‚Äôs already inconsistent. By imposing consistency, we are forcing users to adapt and complexify the build process of all non-Workflow Worker components without no real reason to do so.

Instead, we should make `Client` accept pre-loaded data converters. And possibly do the same for Activity-only Workers.

#### Comments (1)

<details>
<summary><strong>ilijaNL</strong> commented on 2024-09-22 06:07:05.000 UTC</summary>

Possible workaround for now is 
```ts
const worker = await Worker.create({
    connection,
    dataConverter: await getDataConverter(),
    ...rest
  });

  const loadedDataConverter = worker.options.loadedDataConverter;
  if (loadedDataConverter)
    loadedDataConverter.failureConverter = new DefaultFailureConverter({
      encodeCommonAttributes: true,
    });
```

Reactions: üëç 1

</details>


---

<a id="1427"></a>

### #1427: [Bug] Latest update to v1.10.0 makes build fail

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1427 |
| **State** | CLOSED |
| **Author** | johnrjj (John Johnson) |
| **Created** | 2024-05-23 01:53:46.000 UTC (1y 7m ago) |
| **Updated** | 2024-05-27 14:02:23.000 UTC |
| **Closed** | 2024-05-27 14:02:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Build started failing after updating latest 1.1.0. Also repro'd in Render environment:

`Error: /lib/x86_64-linux-gnu/libm.so.6: version `GLIBC_2.29' not found (required by /opt/render/project/src/node_modules/.pnpm/@temporalio+core-bridge@1.10.0/node_modules/@temporalio/core-bridge/releases/x86_64-unknown-linux-gnu/index.node)`

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

### Describe the bug

Update @temporalio packages to v^1.10.0. Build in remote CI, build fails.

Bun had a similar issue it appears -- https://github.com/oven-sh/bun/issues/255

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (5)

<details>
<summary><strong>johnrjj</strong> commented on 2024-05-23 14:58:45.000 UTC</summary>

Will try to create a repro over weekend -- just wanted to post issue here for visibility in case others encounter same problem. In the meantime I downgraded back to 1.9.0 without any issue.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-23 20:46:11.000 UTC</summary>

@johnrjj What's the [version of Node.js](https://docs.render.com/node-version) in your Render environment?

As mentioned in [v1.10.0's release notes](https://github.com/temporalio/sdk-typescript/releases/tag/v1.10.0), Node 14.x is no longer supported. Also note that Node 16 will no longer be supported starting with v1.11.

See this annoucement from our [v1.9.0 release notes](https://github.com/temporalio/sdk-typescript/releases/tag/v1.9.0):

> Support for Node.js 14 and Node.js 16 will soon be dropped. Node.js 14 officially reached end-of-life on April 30th, 2023, and Node.js 16 reached end-of-life on September 11th, 2023 (see [Node.js release schedule](https://nodejs.org/en/about/previous-releases#release-schedule)).
>
> This has since then caused a rippling effect, as more and more libraries in the NPM ecosystem are progressively dropping support for both of those older targets. Given that challenges to maintaining compatibility with these outdated Node.js releases will only continue to grow, it is evident that we will soon need to follow suit in discontinuing support for Node.js 14 and 16 in the Temporal TypeScript SDK.
>
> For those reasons:
>
>    TS SDK v1.9 will be the last minor release to support Node.js 14.
>    TS SDK v1.10 could possibly be the last minor release to support Node.js 16. Note that this also implies that GLIBC 2.27 will no longer be supported from that point on, since Node.js 18+ won‚Äôt compile on GLIBC older than 2.28.
>
> We strongly encourage everyone to take immediate action in updating their deployments to supported versions of Node.js to ensure continued compatibility and receive the latest features and security updates.

</details>

<details>
<summary><strong>johnrjj</strong> commented on 2024-05-23 21:01:40.000 UTC</summary>

Using latest/default (>=18). Will try for a repro. Will also try debugging a bit more deeply.

```
INFO==> Requesting node version >=18
INFO==> Using Node version 22.2.0 via /opt/render/project/src/package.json
INFO@repo/temporal:build: > @repo/temporal@0.1.0 build:workflow /opt/render/project/src/apps/temporal
INFO@repo/temporal:build: > ts-node src/scripts/build-workflow-bundle.ts
INFO@repo/temporal:build: 
ERROR@repo/temporal:build: Error: /lib/x86_64-linux-gnu/libm.so.6: version `GLIBC_2.29' not found (required by /opt/render/project/src/node_modules/.pnpm/@temporalio+core-bridge@1.10.0/node_modules/@temporalio/core-bridge/releases/x86_64-unknown-linux-gnu/index.node)
INFO@repo/temporal:build:     at Object.Module._extensions..node (node:internal/modules/cjs/loader:1544:18)
INFO@repo/temporal:build:     at Module.load (node:internal/modules/cjs/loader:1249:32)
INFO@repo/temporal:build:     at Function.Module._load (node:internal/modules/cjs/loader:1065:12)
INFO@repo/temporal:build:     at Module.require (node:internal/modules/cjs/loader:1271:19)
INFO@repo/temporal:build:     at require (node:internal/modules/helpers:123:16)
INFO@repo/temporal:build:     at Object.<anonymous> (/opt/render/project/src/node_modules/.pnpm/@temporalio+core-bridge@1.10.0/node_modules/@temporalio/core-bridge/index.js:26:20)
INFO@repo/temporal:build:     at Module._compile (node:internal/modules/cjs/loader:1434:14)
INFO@repo/temporal:build:     at Module._extensions..js (node:internal/modules/cjs/loader:1518:10)
INFO@repo/temporal:build:     at Object.require.extensions.<computed> [as .js] (/opt/render/project/src/node_modules/.pnpm/ts-node@10.9.2_@swc+core@1.5.7_@swc+helpers@0.5.11__@types+node@16.11.43_typescript@5.4.5/node_modules/ts-node/src/index.ts:1608:43)
INFO@repo/temporal:build:     at Module.load (node:internal/modules/cjs/loader:1249:32) {
INFO@repo/temporal:build:   code: 'ERR_DLOPEN_FAILED'
INFO@repo/temporal:build: }
INFO@repo/temporal:build: ‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
INFO@repo/temporal:build: ‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
ERROR@repo/temporal:build: ERROR: command finished with error: command (/opt/render/project/src/apps/temporal) /usr/bin/pnpm run build exited (1)
INFO@repo/temporal#build: command (/opt/render/project/src/apps/temporal) /usr/bin/pnpm run build exited (1)
INFO
```

Right now the only obvious change in config was upgrading the temporal packages. (and reverting back made it work again immediately)

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-23 22:01:14.000 UTC</summary>

I see. That means Render is using glibc 2.28 based image for their containers. Node 18 requires at least glibc 2.28, but 1.10.0 requires glibc 2.29 (or 2.35 on linux-arm64).

We're already working on a solution to [build TS SDK 1.10 on an older glibc](https://github.com/temporalio/sdk-typescript/pull/1428). Unfortunately, some recent/upcoming changes in GitHub Actions are making this harder than it should be, but I have good hope that making it work on glibc 2.28 is possible.


</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-27 14:02:23.000 UTC</summary>

Fixed by #1428. See [v1.10.1](https://github.com/temporalio/sdk-typescript/releases/tag/v1.10.1).

</details>


---

<a id="1402"></a>

### #1402: [Feature Request] search attributes update on schedule

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1402 |
| **State** | CLOSED |
| **Author** | jesse-triplewhale |
| **Created** | 2024-04-24 08:57:59.000 UTC (1y 8m ago) |
| **Updated** | 2025-08-21 16:51:23.000 UTC |
| **Closed** | 2025-08-21 16:51:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Happy to submit the PR myself but I wanted to check if there is a reason this is not supported?

https://github.com/temporalio/sdk-typescript/blob/e41596bf3d78852c342f3f36b4ea21514f133c21/packages/client/src/schedule-types.ts#L131

Thanks!

#### Comments (5)

<details>
<summary><strong>jesse-triplewhale</strong> commented on 2024-04-24 09:02:18.000 UTC</summary>

related? https://github.com/temporalio/temporal/issues/4858

</details>

<details>
<summary><strong>jesse-triplewhale</strong> commented on 2024-04-24 11:32:31.000 UTC</summary>

My mistake - this is `searchAttributes` on the schedule - whereas search attributes on the workflow are `action.searchAttributes`. maybe renaming to `scheduleSearchAttributes` would reduce confusion?

</details>

<details>
<summary><strong>jeffmhastings</strong> commented on 2025-04-03 15:24:24.000 UTC</summary>

I've run into this as well. The typescript SDK seems to ignore search attributes in the update operation. I'd like to update some existing schedules to set search attributes on the schedule itself and on the workflow. 

</details>

<details>
<summary><strong>THardy98</strong> commented on 2025-04-29 20:14:24.000 UTC</summary>

The work for this is done https://github.com/temporalio/sdk-typescript/pull/1625
We plan to release an SDK update with this change soon.

Reactions: üéâ 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-08-21 16:51:23.000 UTC</summary>

This has been released as part of [v1.12.0](https://github.com/temporalio/sdk-typescript/releases/tag/v1.12.0).

</details>


---

<a id="1308"></a>

### #1308: [Chore] Add tests to assert proper type rules on all "user defined function with args" APIs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1308 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-12-05 21:17:45.000 UTC (2y 1m ago) |
| **Updated** | 2023-12-26 18:30:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Context

Our APIs contain multiple places where a user defined function expect arguments, and where various TypeScript features are used to ensure type coherency and correctness.

Though all of these APIs are expected covered by functional tests, we sometime notice deficiencies in type coherency assertions, like [here](https://github.com/temporalio/sdk-typescript/pull/1307) and [there](https://github.com/temporalio/sdk-typescript/issues/1051).

These errors could have been caught with tests that are designed specifically to trigger build time errors if some type assertion fails. Some tests of that kind already exist in our code base (notably some that got introduced in response to the two issues mentioned previously), but our test coverage is inconsistent and incomplete.

## Describe the task

Assess current typing tests coverage, and add any missing tests.

The following is a non-exhaustive list of our APIs that should be included in this effort. Most of these APIs may require more than a single assertion (e.g. user function requiring args vs accepting no arg, returning a `Promise`, some value, or void, etc).

### Signals
- [ ] `defineSignal`
- [ ] `wf.setHandler`
- [ ] `client.getWorkflowHandler().signal()`
- [ ] `client.getWorkflowHandler().signalWithStart()`
- [ ] `wf.getExternalWorkflowHandler().signal()`
- [ ] `wf.startChild(...).signal()`

### Updates
- [ ] `defineUpdate`
- [ ] `wf.setHandler` (both updater handler and validation handler)
- [ ] `client.getWorkflowHandler().update()`

### Queries
- [ ] `defineQuery`
- [ ] `wf.setHandler`
- [ ] `client.getWorkflowHandler().query()`

### Workflows
- [ ] `client.start(...)`
- [ ] `client.execute(...)`
- [ ] `client.signalWithStart(...)`
- [ ] `wf.startChild()`

### Activities
- [ ] `wf.proxyActivities()`

### Local Activities
- [ ] `wf.proxyLocalActivities()`

### Schedules
- [ ] `client.createSchedule({ ... })`
- [ ] `client.getScheduleHandle().update({ ... })`

#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2023-12-13 05:19:49.000 UTC</summary>

Apart from that [one issue](https://github.com/temporalio/sdk-typescript/issues/1051) where we weren‚Äôt maintaining the name in the type, we haven‚Äôt had any complaints about deficiencies in the type definitions.

I fear over testing the types is a non productive effort. How come non of our other SDKs are subjected to such requirements?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-14 05:41:15.000 UTC</summary>

> Apart from that https://github.com/temporalio/sdk-typescript/issues/1051 where we weren‚Äôt maintaining the name in the type, we haven‚Äôt had any complaints about deficiencies in the type definitions.

That one and the one that Dan just exposed. And I vaguely remember a few related issues that got introduced during work on features like Schedule and Updates, but got identified and fixed before the PRs got merged in.

I mean, I'm not claiming we have tons of similar deficiencies. But the difficulty here is that this is really about deficiencies that affect _incorrect_ user code (i.e. some code that should not compile does due to improper typing rules).

When an incorrect type definition prevents correct code from compiling, we are very likely to identify and fix these very quickly. But when an incorrect type accepts incorrect code, you won't figure it out unless you actually know that code is incorrect, i.e. by writing code that you would expect to not compile. Users writing incorrect code that compiles probably don't realize they made a mistake, and we are certainly not intentionally introducing mistakes in our tests.

That's why they can stay there for very long time without getting noticed, and why it's very easy to introduce similar issues while developing new features.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-14 05:47:09.000 UTC</summary>

> How come non of our other SDKs are subjected to such requirements?

Is that a philosophical question? I'm tempted to say that's because only TypeScript has a type system so extensive and so expressive (even to the point that it is Turing complete)... yet it fails to actually impose even the most basic of these rules at runtime.

I mean, each language is different, and I don't think I can't reasonably provide a short yet complete answer to that question. Still, I feel that in other SDKs, the responsibility of asserting type coherency on workflows/activities/signals/etc arguments relies either on very simple and highly reliable language level constructs (eg. interfaces + proxies in Java and call tree analysis in .Net both ends up making these looks like pure method calls from the compiler's perspective) and/or on runtime level features (eg. reflectively calling a method with incorrect signature will result in a runtime failure in most languages)... or clearly is the responsibility of users when that is not possible (eg. when starting a workflow or scheduling an activity in Go, args are untyped, that's the way it is, so deal with it).

In TS SDK, most of that burden falls on us (or arguably, _we accepted_ that burden for the convenience of our users). Arguments are often accepted through non-simple language constructs (e.g. mapped/conditional/inferred types/parameterized functions/etc), and users get the impression that they can trust and rely on type assertions that our APIs impose, including those resulting from calculated types. These typing assertions are especially important given that runtime is not helping out.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-14 05:57:11.000 UTC</summary>

> I fear over testing the types is a non productive effort.

I don't see this is as a long or complex effort. Each case is very simple (one liners in most cases) and involve no _functional_ assertions. Many of the tests have already been written out in [test-interface-type-safety.ts](https://github.com/temporalio/sdk-typescript/pull/1307/files#diff-8d2392d50a59028e11acd1d694a5cb9a4fab8a4c6737b8f010c6d261fe94142d), and missing ones will just follow the same patterns.

The only real effort here is just to assesses which APIs have effectively been covered and which haven't, and copy-paste the code to cover whatever's missing at this point.

Hopefully we don't find any new issue... great! Still, we'll have gained a way to reduce the probability of future regressions, and avoid repeating some past mistakes when eventually introducing new features.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-12-26 18:30:54.000 UTC</summary>

Seems like fairly low ROI.

> That one and the one that Dan just exposed.

That issue was closed, it was working as expected.

So again, it's just a single time where we didn't capture the name of the signal / query definition.

I'm okay with leaving this open, I would just rather prioritize other features and bugs over this.

</details>


---

<a id="1291"></a>

### #1291: [Bug] Custom payload converter not being passed to "Activator"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1291 |
| **State** | CLOSED |
| **Author** | nohehf |
| **Created** | 2023-11-14 13:11:27.000 UTC (2y 1m ago) |
| **Updated** | 2023-11-14 20:30:16.000 UTC |
| **Closed** | 2023-11-14 20:30:16.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 3 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Using a custom payload converter in a temporal typescript worker.

### Describe the bug

After implementing and loading a custom payload converter in a typescript worker, it is being used as expected to start my workflow (I get logs and I can confirm it's working as expected). Still, when the activity resolves I get a `Failed to activate workflow` error.
The error being:
```
2023-11-14T12:50:06.988Z [ERROR] Failed to activate workflow {
  namespace: 'default',
  taskQueue: 'my-task-queue',
  workflowId: 'worflowId',
  runId: '8c924e14-1c20-4c38-a490-50e4f1c6ac6d',
  workflowType: 'MyWorkflowType',
  error: **************/workflow-bundle-66b7a6885e00fd3df11b.js:438
              throw new errors_1.ValueError(`Unknown encoding: ${encoding}`);
              ^

  ValueError: Unknown encoding: custom/encoding
      at DefaultPayloadConverter.fromPayload (*******/node_modules/@temporalio/common/src/converter/payload-converter.ts:163:12)
      at Activator.resolveActivity (*******/node_modules/@temporalio/workflow/src/internals.ts:411:62)
      at *******/node_modules/@temporalio/workflow/src/worker-interface.ts:215:29
      at Object.activate (*******/node_modules/@temporalio/workflow/src/worker-interface.ts:221:2)
      at evalmachine.<anonymous>:1:18
      at Script.runInContext (node:vm:134:12)
      at Object.runInContext (node:vm:282:6)
      at Proxy.<anonymous> (*******/node_modules/@temporalio/worker/lib/workflow/vm.js:40:46)
      at VMWorkflow.activate (*******/node_modules/@temporalio/worker/lib/workflow/vm-shared.js:313:33)
      at handleRequest (*******/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:50:47),
  workflowExists: true
}
```

After digging into the `sdk-typescript` code to check what would cause this error I noticed that in https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/workflow/src/internals.ts#L263 the payload converter being used is always the default one. Whereas in other files, the custom payload converter is being used if passed, eg: https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/workflow/src/worker-interface.ts#L110

I guess the payloadConverter should be passed here: https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/workflow/src/worker-interface.ts#L96

If I'm mistaken could you clarify why the defaultPayloadConverter has to be used here? Also, I must say that It has been it hard and painful to work with custom payload converters.

### Environment/Versions

Machine:
```
OS: macOS 13.4.1 22F82 arm64
Host: MacBookPro18,3
Kernel: 22.5.0
CPU: Apple M1 Pro
GPU: Apple M1 Pro
```

- Temporal Version: `@temporalio/worker@npm:1.8.4 (via npm:^1.8.2)`
- Are you using Docker or Kubernetes or building Temporal from source: Docker for local development

### Additional context

I might try to open a PR for a fix if you confirm that this is indeed a bug :))

### Edit 1
It seems I was mistaken, and the payload converter is indeed passed to the activator here: https://github.com/temporalio/sdk-typescript/blob/3088f86ce6fe0c7072ba55c4db901a70b631f87e/packages/workflow/src/worker-interface.ts#L113

I managed to make it work by passing a TS file directly to `payloadConverterPath`. The issue might happen when the payload converter is bundled / from what it is bundled. Any advice on how to bundle it and pass it to the worker? I've had a lot of issues with this (not able to load an ESM payload converter, so I have to bundle it to esm).

I still wonder how the custom converter could work for the `toPayload` but not `fromPayload`. I will try to provide a minimum reproduction.


#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2023-11-14 17:54:04.000 UTC</summary>

The custom payload converter is passed to the activator and should be loaded properly if you pass the `payloadConveterPath` worker option.

I think we may have an issue with custom converters and ESM. I'll open an issue to track that separately.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-11-14 17:58:25.000 UTC</summary>

https://github.com/temporalio/sdk-typescript/issues/1292

</details>

<details>
<summary><strong>nohehf</strong> commented on 2023-11-14 20:30:16.000 UTC</summary>

I think it is indeed an issue with how I transformed my ESM ts into a commonjs bundle, but it is weird that it works to create the payload and start the activity, but not when the activity completes. I added some of my research to #1292. I'll close this issue and I hope that we will be able to fix this or provide guidelines to bundle payload converters (both would be the best actually). Ty!

</details>


---

<a id="1210"></a>

### #1210: [Feature Request] Add retry configuration to activity info

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1210 |
| **State** | CLOSED |
| **Author** | scott-rc (Scott C√¥t√©) |
| **Created** | 2023-08-21 19:31:49.000 UTC (2y 4m ago) |
| **Updated** | 2025-04-30 14:37:31.000 UTC |
| **Closed** | 2025-04-30 14:37:30.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 3 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.
<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

My team and I are using the following interceptor to capture exceptions from our activities and send them to our monitoring service.

```ts
export class ActivityInboundExceptionInterceptor implements ActivityInboundCallsInterceptor {
  public readonly info: Info;

  constructor(ctx: Context) {
    this.info = ctx.info;
  }

  async execute(input: ActivityExecuteInput, next: Next<ActivityInboundCallsInterceptor, "execute">): Promise<unknown> {
    try {
      return await next(input);
    } catch (err: any) {
      reportErrorForInvestigation(err, {
        message: "activity threw an uncaught exception",
        temporalInfo: this.info,
      });
      throw err;
    }
  }
}
```

When one of our activities throws an unexpected exception, it works great! However, some of our workflows call activities that are likely to fail at first, but succeed eventually, so we configure them with a higher `retry.maximumAttempts`.

We'd like to only report exceptions that are thrown on the final attempt, but `ActivityInboundExceptionInterceptor` only knows which attempt the activity threw the exception on, it doesn't know how many attempts the activity has left. This causes us to send more exceptions to our monitoring service than we'd like.

### Describe the solution you'd like
<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Ideally, [`info`](https://typescript.temporal.io/api/interfaces/activity.Info) would contain the `retry` options the activity was configured with or how many attempts the activity has left.



#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2023-08-25 15:44:20.000 UTC</summary>

We should be able to expose this as it's available on the `PollActivityTaskQueueResponse` message: https://github.com/temporalio/api/blob/8f89bdc358642e1358876f164c7f4e663e225117/temporal/api/workflowservice/v1/request_response.proto#L419.

I think sdk-core does not expose this field at the moment, so we'll have to start there.

Reactions: üéâ 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-10 03:27:30.000 UTC</summary>

Even though [the protobuf definition](https://github.com/temporalio/api/blob/master/temporal/api/workflowservice/v1/request_response.proto#L446-L449) indeed contains a retry policy field, it looks like [the matching server](https://github.com/temporalio/temporal/blob/5bb4d5f5c56694921fe0023859e8ca2c51e5974c/service/matching/matching_engine.go#L2195-L2212) is actually not populating it, so the field is empty.

I opened [a ticket](https://github.com/temporalio/temporal/issues/6502) on the server side.

</details>

<details>
<summary><strong>maciejdudko</strong> commented on 2025-04-30 14:37:30.000 UTC</summary>

Closing as duplicate in favor of the cross-SDK issue.

</details>


---

<a id="1131"></a>

### #1131: [Bug] Pin dependencies

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1131 |
| **State** | CLOSED |
| **Author** | leeweisberger (Lee Weisberger) |
| **Created** | 2023-06-03 13:29:20.000 UTC (2y 7m ago) |
| **Updated** | 2023-06-06 14:38:42.000 UTC |
| **Closed** | 2023-06-06 10:53:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

There is currently a [bug](https://github.com/streamich/unionfs/issues/765) in the latest release of https://github.com/streamich/unionfs. The `@temporalio/worker` package does not pin this dependency (currently set to `"unionfs": "^4.4.0"`) so the package is unusable causing a company-wide outage for us. This same thing has happened on multiple occasions over the last few months.

This sdk is a core piece of infrastructure and should not suddenly break when indirect dependencies are updated. 

Error code from offending package:
```
Error: Cannot find module 'node_modules/unionfs/lib/index.js'. Please verify that the package.json has a valid "main" entry
```


#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2023-06-03 23:07:47.000 UTC</summary>

Looks like unionfs was fixed here:
https://github.com/streamich/unionfs/commit/708def6c02f1a8795d2754ba814cdf1c433b174c

@mjameswh let‚Äôs consider pinning the dependencies.

Reactions: üòï 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-05 21:44:31.000 UTC</summary>

>Looks like unionfs was fixed here:

For now, I updated the dependency to jump over the broken release of unionfs.

>This sdk is a core piece of infrastructure and should not suddenly break when indirect dependencies are updated.

>let‚Äôs consider pinning the dependencies.

I suppose you mean pinning _all_ dependencies. That's an interesting idea, but I'm not sure how much we can really help on this without causing more damage than we're trying to avoid.

We would need to pin all dependencies of our packages to exact version, as even a patch release can introduce the kind of issue unionfs had. And we would only be able to fix our own direct dependencies, so even by pinning all of our direct dependencies, this kind of situation could still happen because of some transitive dependency (there is no "universal way" to pin _transitive_ dependencies in NPM/package.json world).

I'll have to think about this more. Could be useful to have a look at what other projects have done to avoid similar issues... if any.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-06-06 05:18:38.000 UTC</summary>

I wonder what other packages do here.
I too was thinking that transitive dependencies can‚Äôt be pinned. The only way around it is vendoring which I don‚Äôt think we want.
We try to minimize our dependencies to avoid situations like this but there‚Äôs only so much we can do while we rely on a bundler like webpack.

</details>

<details>
<summary><strong>leeweisberger</strong> commented on 2023-06-06 10:53:03.000 UTC</summary>

Here's a good discussion: https://docs.renovatebot.com/dependency-pinning/#so-whats-best

TIL the recommendation here is to not pin dependencies to avoid a false sense of security and forcing consumers to confirm multiple versions of the same package.

Thanks for considering, but I'll go ahead and close. 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-06 14:38:42.000 UTC</summary>

@leeweisberger Thank you for the reference. The article is indeed very useful.

After some more thinking, I indeed believe that there's nothing we can do on our side to completely avoid the issue you described, and trying to pins our dependencies would like cause more harm to our community.

However, it would be possible for users who wants to protect against this kind of risk to themselves vendor out the Temporal SDK (and all of its dependencies, using _our_ package-lock.json file, installing deps in CI mode) to a local directory, and simply point their `@temporalio/*` dependencies to the packages in that local directory instead. This would ensure that the Temporal SDK itself only use dependencies against which tests have been run.

If anyone wants to experiment with that idea, I'll be glad to provide some more insights on how to get there.

</details>


---

<a id="1115"></a>

### #1115: Workflow Task Failed with Unspecified Cause

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1115 |
| **State** | CLOSED |
| **Author** | Uria1 (Uria Ashkenazy Adler) |
| **Created** | 2023-05-02 11:32:29.000 UTC (2y 8m ago) |
| **Updated** | 2023-05-31 07:23:10.000 UTC |
| **Closed** | 2023-05-30 15:28:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Expected Behavior
A workflow with failed activities should:

1. Change the status to "Failed"
2. Execute code in a `catch` block if the failed activity is awaited from within a `try` block

## Actual Behavior
1. Workflow remains in status "Running" and later times out assuming a timeout was set.
2. Workflow code in a `catch` block isn't always executed.
3. We see a "WorkflowTaskFailed" in the history with cause=unspecified. The failure details contain the same information as the failed activity.

## Steps to Reproduce the Problem
- Could not create a minimal reproducible example

## Specifications
  - Version:
  - Platform: 
  - SDK: TypeScript

![Screen Shot 2023-05-02 at 14 29 54](https://user-images.githubusercontent.com/26362206/235654331-7d7f615d-9996-499b-a929-7e502f43f0ba.png)


#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2023-05-26 19:48:18.000 UTC</summary>

The expected behavior that you're describing is something that we test extensively so I don't think it's an SDK bug.

My first goto would be to check if you have multiple versions of any `@temporalio/*` packages as we use `instanceof` checks to determine whether a workflow run or task should fail.

</details>

<details>
<summary><strong>Uria1</strong> commented on 2023-05-30 07:07:20.000 UTC</summary>

I managed to solve the problem.
The issue was that activities that were started in parallel (without `await`) resulted in promises without proper error handling. I had to add a `catch` block to each activity promise, save any errors that are thrown, and then within the main workflow function, check if any errors occurred and fail the workflow by throwing an `ApplicationFailure`.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-30 15:28:22.000 UTC</summary>

@mjameswh we need to make unhandled rejection clearer. Will save a lot of headaches for users.

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-30 16:22:30.000 UTC</summary>

Duplicate of #1039

</details>

<details>
<summary><strong>Uria1</strong> commented on 2023-05-31 07:23:10.000 UTC</summary>

> @mjameswh we need to make unhandled rejection clearer. Will save a lot of headaches for users.

Certainly. It wasn't clear and I waisted way too much time trying to fix it.

</details>


---

<a id="1023"></a>

### #1023: [Bug] node takes 10 seconds to exit since @grpc/grpc-js 1.8.0

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1023 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-01-11 22:45:05.000 UTC (2y 12m ago) |
| **Updated** | 2023-01-12 20:39:22.000 UTC |
| **Closed** | 2023-01-12 20:39:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Describe the bug

Running a very simple program using `Client` or `Connection`. At the end, `node` wait 10 seconds before exiting, unless we add an explicit `process.exit(0)` in the code.

This was reproduced using @grpc/grpc-js 1.8.0 and 1.8.3, but does not happens on 1.7.3.

**Example:**

<img width="769" alt="image (1)" src="https://user-images.githubusercontent.com/6412169/211933605-2dc29c08-9ab7-43b7-8168-b49f4a2c3a10.png">


### Minimal Reproduction

```
import { Connection } from '@temporalio/client';

Connection.connect()
  .then(() => console.log('Connected'))
  .catch((e) => console.log(e));
```

#### Comments (5)

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-11 22:49:57.000 UTC</summary>

Seems to be related to the recent addition of _retries_ directly in the library. For some reason, the [deadline timer](https://github.com/grpc/grpc-node/blob/master/packages/grpc-js/src/resolving-call.ts#L95) does not cleared on some successful calls.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-11 23:02:08.000 UTC</summary>

Good catch, do you think this could be related to the jest hang we're seeing?
Does it help if the grpc client is closed?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-01-11 23:11:20.000 UTC</summary>

No change when I add this line:

<img width="522" alt="image" src="https://user-images.githubusercontent.com/251288/211937928-e0560a6f-ff61-432c-b405-1de46fc7a1bf.png">


<img width="208" alt="image" src="https://user-images.githubusercontent.com/251288/211937943-0074efd5-a4af-4b2f-91a4-c75e242ea6c3.png">


</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-11 23:23:33.000 UTC</summary>

>Good catch, do you think this could be related to the jest hang we're seeing?

No, 1.8.0 was released December 7th, the Jest issue existed well before that. It could however possibly explain some issues observed in `features` tests, but it is too early to make statement here.

Anyway, I personally think that 1.8.0 should have been a major. They introduced a new retry mechanism, which make it breaking for any software that already implemented retries at another level. We'll have to put a quite a lot of thinking and testing before we move to 1.8+.

So for now, I think the only reasonable solution is to change dependency to ~1.7.3.



</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-01-12 00:22:57.000 UTC</summary>

I'd be fine with pinning the minor version and keeping an open issue to upgrade to >=1.8 when were ready to invest more into this.

</details>


---

<a id="917"></a>

### #917: [Bug] Docs Search Result Link 404

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/917 |
| **State** | CLOSED |
| **Author** | ricmatsui (Ricardo Matsui) |
| **Created** | 2022-10-12 14:46:30.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-15 23:49:06.000 UTC |
| **Closed** | 2022-10-15 04:16:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug, documentation |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Using the docs, we want to search for classes and then share the link to the search result. The shared link should always work.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

Clicking on a search result from the docs search navigates to a URL that may contain uppercase characters. Opening this URL in a new tab goes to a 404 if it contains uppercase characters.

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

- Go to https://typescript.temporal.io/
- Click the Search button on the top right (Cmd+K)
- Search for `ApplicationFailure` and click the Class result
- The search result links to this URL: https://typescript.temporal.io/api/classes/common.applicationfailure/
- Open the URL in a new tab, or refresh the page
- The page is a 404

The correct URL for the search result should be https://typescript.temporal.io/api/classes/common.ApplicationFailure

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Intel Mac
- Temporal Version: N/A
- Are you using Docker or Kubernetes or building Temporal from source? N/A

### Additional context

<!-- Add any other context about the problem here. -->

This could be an issue with https://docusaurus.io/docs/search#using-algolia-docsearch or `docusaurus-plugin-typedoc`


#### Comments (5)

<details>
<summary><strong>lorensr</strong> commented on 2022-10-14 03:29:14.000 UTC</summary>

The 2 solutions I've found are:

- Changing typedoc plugin: https://github.com/tgreyuk/typedoc-plugin-markdown/issues/358
- Adding [custom normalization rules](https://www.algolia.com/doc/api-reference/api-parameters/customNormalization/?client=javascript) like `{A: 'A', B: 'B', etc}` to algolia. The [index UI](https://www.algolia.com/apps/FL5BOEA5LF/explorer/configuration/typescript-temporal/special-characters#customNormalization-section) only allows one at a time, and I balked at filling out 26 forms, and wanted to write a script, but I should probably just do that. Okay self, I'll do that now.

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-10-14 03:35:54.000 UTC</summary>

Okay nevermind, while it wasn't that hard to submit 26 forms, when I hit save I got this:

<img width="418" alt="image" src="https://user-images.githubusercontent.com/251288/195756166-94d0cd36-cef6-49d9-ae69-6ca860c60c07.png">

On the Vercel side, all I found was this:

https://vercel.com/docs/build-output-api/v3#build-output-configuration/supported-properties/routes/handler-route

but don't think you can use regex src and groups in dest to say "whatever comes in, if you don't find a file for it, try camelcase-ing part of it"

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-10-14 03:39:28.000 UTC</summary>

Submitted a Vercel support ticket in case they have a setting I couldn't find

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-10-14 18:02:23.000 UTC</summary>

> Due to the nature of our infrastructure, these will always be case sensitive and isn't something we have the ability to change. 
>
> As a workaround, you could consider catching these requests or standardizing them in middleware and redirecting them to the correct locations.

The [Edge Middleware](https://vercel.com/docs/concepts/functions/edge-middleware) would need to determine what a word is (converting `common.applicationfailure` to `common.ApplicationFailure`), so I'm leaning toward the typedoc plugin change.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-10-15 04:16:12.000 UTC</summary>

Netlify was redirecting from SentenceCase URLs to lowercase, so that's how lowercase URLs wound up in the index. After the crawler crawled the site hosted on Vercel (which doesn't redirect), it got SentenceCase URLs, which work fine. Thanks for reporting @ricmatsui üòä

Reactions: üéâ 1

</details>


---

<a id="728"></a>

### #728: [Bug] jest times-out on first run of TestWorkflowEnvironment

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/728 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2022-06-27 20:40:15.000 UTC (3y 6m ago) |
| **Updated** | 2022-10-03 13:08:14.000 UTC |
| **Closed** | 2022-10-03 13:08:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Unit testing workflow using jest and TestWorkflowEnvironment

### Describe the bug

jest is likely to timeout the first time I run the tests

### Minimal Reproduction

```bash
git checkout https://github.com/temporal/temporal-pendulum
cd position-node
nvm use
npm i
npm t
```

On the first run, I see timeout failures:

```
  2022-06-27T20:13:26.565908Z  WARN temporal_sdk_core::worker::workflow: Task not found when completing, error: status: NotFound, message: "Completed workflow", details: [], metadata: MetadataMap { headers: {"content-type": "application/grpc"} }, run_id: "5d3c6943-1da7-43ab-b5cf-344429e4fa4a"
```

  ‚úï pendulum exitSignal (5006 ms)
  ‚úï pendulum getGameInfoQuery (1575 ms)
  ‚úì pendulum updateGameInfoSignal (323 ms)

![fail](https://user-images.githubusercontent.com/28679/176031519-e5b19ab7-51a2-48bf-9a6c-3699ddfbb886.png)

The next time it usually passes:

  ‚úì pendulum exitSignal (839 ms)
  ‚úì pendulum getGameInfoQuery (338 ms)
  ‚úì pendulum updateGameInfoSignal (312 ms)

![pass](https://user-images.githubusercontent.com/28679/176031542-304f72ff-6982-48e6-abd2-0221327856ee.png)

### Environment/Versions

M1 Mac
@temporal/testing 1.0.0-rc.0 
Node 16.15.1

### Additional context

Is there a race starting the test env?
Is there a timeout I can/should increase?

#### Comments (5)

<details>
<summary><strong>vkarpov15</strong> commented on 2022-07-11 00:40:15.000 UTC</summary>

@joebowbeer I'm unable to repro this on either my mac or my linux box. For example, below is my output running `npm test` on temporal-pendulum after a clean install:

```
$ npm test

> position-node@0.2.0 test /Users/val/Workspace/temporalio/temporal-pendulum/position-node
> NODE_OPTIONS=--experimental-vm-modules jest

(node:26895) ExperimentalWarning: VM Modules is an experimental feature. This feature could change at any time
(Use `node --trace-warnings ...` to show where the warning was created)

 RUNS  src/workflows.test.ts
  2022-07-11T00:26:28.902615Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller died, shutting down
 RUNS  src/workflows.test.ts
  2022-07-11T00:26:30.480330Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller died, shutting down
 RUNS  src/workflows.test.ts
  2022-07-11T00:26:31.970849Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller d PASS  src/workflows.test.ts (15.569 s)
  ‚úì gameInfo without overrides (2 ms)
  ‚úì gameInfo with overrides (1 ms)
  ‚úì pendulum exitSignal (3733 ms)
  ‚úì pendulum getGameInfoQuery (1570 ms)
  ‚úì pendulum updateGameInfoSignal (1493 ms)

--------------|---------|----------|---------|---------|-------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
--------------|---------|----------|---------|---------|-------------------
All files     |   51.72 |      100 |       0 |   51.72 |                   
 workflows.ts |   51.72 |      100 |       0 |   51.72 | 29-56             
--------------|---------|----------|---------|---------|-------------------
Test Suites: 1 passed, 1 total
Tests:       5 passed, 5 total
Snapshots:   0 total
Time:        15.808 s
Ran all test suites.
$ npm test

> position-node@0.2.0 test /Users/val/Workspace/temporalio/temporal-pendulum/position-node
> NODE_OPTIONS=--experimental-vm-modules jest

(node:26920) ExperimentalWarning: VM Modules is an experimental feature. This feature could change at any time
(Use `node --trace-warnings ...` to show where the warning was created)

 RUNS  src/workflows.test.ts
  2022-07-11T00:26:49.897900Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller died, shutting down
 RUNS  src/workflows.test.ts
  2022-07-11T00:26:51.311469Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller died, shutting down
 RUNS  src/workflows.test.ts
  2022-07-11T00:26:52.602291Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller d PASS  src/workflows.test.ts (14.429 s)
  ‚úì gameInfo without overrides (3 ms)
  ‚úì gameInfo with overrides
  ‚úì pendulum exitSignal (3622 ms)
  ‚úì pendulum getGameInfoQuery (1417 ms)
  ‚úì pendulum updateGameInfoSignal (1288 ms)

--------------|---------|----------|---------|---------|-------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
--------------|---------|----------|---------|---------|-------------------
All files     |   51.72 |      100 |       0 |   51.72 |                   
 workflows.ts |   51.72 |      100 |       0 |   51.72 | 29-56             
--------------|---------|----------|---------|---------|-------------------
Test Suites: 1 passed, 1 total
Tests:       5 passed, 5 total
Snapshots:   0 total
Time:        14.718 s, estimated 16 s
Ran all test suites.
$ 
$ 
$ 
$ npm test

> position-node@0.2.0 test /Users/val/Workspace/temporalio/temporal-pendulum/position-node
> NODE_OPTIONS=--experimental-vm-modules jest

(node:27004) ExperimentalWarning: VM Modules is an experimental feature. This feature could change at any time
(Use `node --trace-warnings ...` to show where the warning was created)

 RUNS  src/workflows.test.ts
  2022-07-11T00:28:28.392233Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller died, shutting down
 RUNS  src/workflows.test.ts
  2022-07-11T00:28:29.883512Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller died, shutting down
 RUNS  src/workflows.test.ts
  2022-07-11T00:28:31.279849Z  WARN temporal_sdk_core::worker::workflow::workflow_stream: WFT poller d PASS  src/workflows.test.ts (14.787 s)
  ‚úì gameInfo without overrides (2 ms)
  ‚úì gameInfo with overrides
  ‚úì pendulum exitSignal (3706 ms)
  ‚úì pendulum getGameInfoQuery (1488 ms)
  ‚úì pendulum updateGameInfoSignal (1477 ms)

--------------|---------|----------|---------|---------|-------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
--------------|---------|----------|---------|---------|-------------------
All files     |   51.72 |      100 |       0 |   51.72 |                   
 workflows.ts |   51.72 |      100 |       0 |   51.72 | 29-56             
--------------|---------|----------|---------|---------|-------------------
Test Suites: 1 passed, 1 total
Tests:       5 passed, 5 total
Snapshots:   0 total
Time:        15.109 s
Ran all test suites.
$ 
```

The tests are slow, but seem to work. Couple of potential explanations:

1. Can you try increasing the test timeout using `jest.setTimeout(15000)`? 
2. All the examples in the [testing docs](https://docs.temporal.io/typescript/testing) use `execute()` instead of `start()`, because [`start()` starts the workflow in "normal time" as opposed to "skipped time"](https://github.com/temporalio/documentation/pull/1252). Maybe worthwhile to try using the [pattern I use in temporal-ecommerce-ts for testing queries and signals](https://github.com/vkarpov15/temporal-ecommerce-ts/blob/95b7be70d0b2a8d95cea93ec719453c94fa68f2e/src/test/workflows.test.ts#L65-L80) rather than `runUntil()`?

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2022-07-11 05:42:04.000 UTC</summary>

@vkarpov15 wrote:

> The tests are slow, but seem to work.

> Can you try increasing the test timeout using jest.setTimeout(15000)?

Thanks for looking into it. I'll play with jest's `testTimeout` next time I have an opportunity. This can be configured in `jest.config.js`. However, I just tried to repro in GitPod and I'm not seeing the timeout at the moment.

> All the examples in the [testing docs](https://docs.temporal.io/typescript/testing) use execute() instead of start(), because https://github.com/temporalio/documentation/pull/1252. Maybe worthwhile to try using the [pattern I use in temporal-ecommerce-ts for testing queries and signals](https://github.com/vkarpov15/temporal-ecommerce-ts/blob/95b7be70d0b2a8d95cea93ec719453c94fa68f2e/src/test/workflows.test.ts#L65-L80) rather than runUntil()?

I use `start` because this workflow does not complete until it is signaled.

Thanks for showing me the pattern. LGTM but I don't like that each test leaves a dangling workflow (right?). It would be more hermetic for `afterEach` to complete the workflow.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-12 03:11:10.000 UTC</summary>

@vkarpov15 you can still use runUntil, although if you have multiple tests in the same file each creating their own worker I‚Äôd suggest bundling the workflows once during setup because that could take up a lot of resources  

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-12 03:12:39.000 UTC</summary>

I generally wouldn‚Äôt recommend leaving dangling workflows around in tests but it‚Äôs okayish when using the ephemeral test server 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-03 13:08:13.000 UTC</summary>

We‚Äôve redone the test framework in 1.3.0. And haven‚Äôt been able to reproduce this, closing until this is reproducible.

</details>


---

<a id="669"></a>

### #669: protobufjs-6.11.2.tgz: 1 vulnerabilities (highest severity is: 7.5)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/669 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-05-29 15:18:46.000 UTC (3y 7m ago) |
| **Updated** | 2022-07-29 05:55:58.000 UTC |
| **Closed** | 2022-07-29 05:55:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>protobufjs-6.11.2.tgz</b></p></summary>

<p>Protocol Buffers for JavaScript (& TypeScript).</p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz</a></p>
<p>Path to dependency file: /packages/testing/package.json</p>
<p>Path to vulnerable library: /packages/testing/node_modules/protobufjs/package.json,/node_modules/protobufjs/package.json,/packages/proto/node_modules/protobufjs/package.json,/packages/client/node_modules/protobufjs/package.json,/packages/common/node_modules/protobufjs/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-25878](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | protobufjs-6.11.2.tgz | Direct | 6.11.3 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25878</summary>


###  Vulnerable Library - <b>protobufjs-6.11.2.tgz</b></p>

<p>Protocol Buffers for JavaScript (& TypeScript).</p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz</a></p>
<p>Path to dependency file: /packages/testing/package.json</p>
<p>Path to vulnerable library: /packages/testing/node_modules/protobufjs/package.json,/node_modules/protobufjs/package.json,/packages/proto/node_modules/protobufjs/package.json,/packages/client/node_modules/protobufjs/package.json,/packages/common/node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - :x: **protobufjs-6.11.2.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The package protobufjs before 6.11.3 are vulnerable to Prototype Pollution which can allow an attacker to add/modify properties of the Object.prototype. This vulnerability can occur in multiple ways: 1. by providing untrusted user input to util.setProperty or to ReflectionObject.setParsedOption functions 2. by parsing/loading .proto files

<p>Publish Date: 2022-05-27
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878>CVE-2022-25878</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878</a></p>
<p>Release Date: 2022-05-27</p>
<p>Fix Resolution: 6.11.3</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>

#### Comments (5)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-05-29 21:02:19.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-07-05 17:40:41.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-19 16:20:14.000 UTC</summary>

We have a PR in progress for this: #741

However, it is not issue for the SDK, as neither of these apply:

> This vulnerability can occur in multiple ways: 

1. by providing untrusted user input to util.setProperty or to ReflectionObject.setParsedOption functions 
2. by parsing/loading attacker-provided .proto files

</details>

<details>
<summary><strong>Unknown</strong> commented on 2022-07-28 20:09:24.000 UTC</summary>

Hey @lorensr, thanks for the explanation of how the vulnerability is mitigated. Unfortunately, it still gets flagged by library scanners such as Snyk. It would be good to have this closed up. 

The PR in question is closed, doesn't seem like it made it in.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-29 00:48:59.000 UTC</summary>

@citrix-eg we're working on it again in #789 

</details>


---

<a id="655"></a>

### #655: [Bug] ActivityInterface adds a string index to any interface that implements it

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/655 |
| **State** | CLOSED |
| **Author** | beaucollins (Beau Collins) |
| **Created** | 2022-05-18 17:15:47.000 UTC (3y 7m ago) |
| **Updated** | 2022-07-07 00:57:46.000 UTC |
| **Closed** | 2022-07-07 00:57:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We have problems surrounding the `ActivityInterface` type adding a string index to our interfaces.



### Describe the bug

The `proxyActivities<A extends ActivityInterface>(options: AcitivityOptions): A` function takes a generic parameter `A` that _must_ implement/extend `AcivityInterface`.

In order to use our interface we must say say it `extends ActivityInterface`:

```ts
interface MyActivities extends ActivityInterface {
  customActivity(): Promise<'cool stuff'>;
}
```

When used with `proxyActivities<A extends ActivityInterface>(options: ActivityOptions): A` `tsc` now allows us to call any method whether it exists or not because of `ActivityInterface`'s string index.

```ts
const activities = proxyActivities<MyActivities>({});

// Runtime error, this isn't actually a function
activities.whateverTypeScriptDoesntCare().then(/* */);
```

If we remove `extends ActivityInterface` then `tsc` only allows calling methods defined in `MyActivities` but doesn't allow it to be used with `proxyActivities<A extends ActivityInterface>(options: ActivityOptions): A`

#### Our Workaround

```ts
/**
 * A utility type that only presents the methods that conform to `ActivityFunction<any[], any>`
 */
type ActivityInterfaceFor<T> = Pick<T, keyof {[K in keyof T as T[K] extends ActivityFunction<any[], any> ? K : never]: T[K]}>;

const ourProxyActivities = proxyActivities as (<A>(options: ActivityOptions) => ActivityInterfaceFor<A>);

const {
    customActivity,
    // tsc correctly identifies this a problem because the method doesn't exist.
    nonExistentMethod
} = ourProxyActivities<MyActivities>({});
```
### Minimal Reproduction

[This playground example is pretty similar to our environment and shows the problem and our workaround][problem-workaround].

### Environment/Versions


-  @temporalio/workflow@0.21.0
- `tsc version 4.6.3`

### Additional context

<!-- Add any other context about the problem here. -->

[problem-workaround]: https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgQQMY2AN2DAngSQDsYBTKAMwENUSAaFdLHXAMQFdDGJD60Ns8AeTAZuAZ3pgoEAB64+TDCTFwAvnHLSQcAOQABUuGiUANsAgB6AO7QA1uRMQrOgNwAoD8GJkqNOAFk2VAALAHU7BycVEhlSQgATFQUBAm8KahJENzg4MB9oEHCoWwAKLzA2GAAuOAAjCAgTEkpCAEoagAUtYDESAB4dVAhwJtIdOAAfXStgylJMMh0APjdVDzchwjF4G2LIqzEawJCi+0cDuABeLJycvIoC05qSgH1yytarpbgu4Z6SAB0UGUjQWJUGwzAoxIOlaqw8FgscBgwR6cBAJBREHicDEwQgbBM8UIOngMR6MHotUqDH4zCIpHSflmKkouJgUC8AHM4F54jFkbg8m5EXADGIALQxPLoKVQaRQOAbcTwQjcACiMgpJGI-kx+Jx112ZyiAOCJBMjncIoAVDbsja4KFMtKSOg4NwTLhkeb0frsSpuAEgmEIucVDAIHVMpRMJRgCZKLUmgC4AAhGkonoO3H4i4ouZweJsTKRn2Zbacwg8vkCoMAA2S9LSvhI9bgVkyqBaOcoYlsGmgcBeLVwLz9WJxLRxMDEqB9XlsKhwOlZhDgjcYKXYnFEhD6o4A2gBdeijpb1gEOiwipHiqUyGUwOUK5VbeAIbK3FHKOhfnKUMCtD-nApgmMBtx1JQ8SrFcuTSHITZKGIfTHKGezhksJQIKorTWps2zoiGpz7Co1xSLI8hbjgwDKKhxFhlEWE4Xht4oGqP6KjElAjJkMxkKWqIqBik65gSRJwBxcDktsbH3q6spkAqSogAxGGmualoQCUrEInaOYACpCWJ+a+rUJCzNgQ6dh2LTwJowzInOg6Kj+cDAjAbBQOueB5B65AbhRiHUch9Y5tSOxdi0pJwGwvQbgActwADC3DkAU3IkeG7bmd2cWZDgRYQMoJLwJZMbslWNYJDEOYFvAm50ngDI+Bk7bAgAjmwwDAio6WKvWfTINJsQ6oktKKKkjKtheV5wDaN5uF400ZHASWEKlhD9SAmWMRcn6QXc+RQIUdhlIQFTVHUDRNC07Q-N0vQDEMvFjJM0yzPMiwrGsCJIs6cDdqVsXxfW62bdtu3qQcOVupQ+W8vA8TFWIwMxHEOKNZNLVMm2b6EdQTW0WR8GUUhxN9ODaUZdWWVMdhuH4SqNy3KKRloi8yPKOOSlDrl8PxTZyNo6NCQTSkOOtiBoryY+brPrzUAgVmYgsPGJhiMgYiak+JAweo1yE4oxPWhY+nzXA7PLoGXkdnYgEEgkc2OjmLA9QTsUYGYeCCn59UeoQXrwb+xARr6IkGmHhabNtyJRlj24cFw+5HqeoGELgF7Xh4vmZEhU2tTQLDQH0BnfNcHTAKgtil-QtgkLgEABQgh4ANK8uu9eNwFBmgSoBlt8eI0Y0kIWsEne4HhnJ5nhn3wAPxwO3NSECQCxQMeNQD63x6qEsTPvh6Xm-MFRPKHBQVUWfrIqCUQ1YRAIjmFsNT58Ie5iJ8lzfPnksZMXUB766TNvaC22cCIfhAvcbapwIK3AgJxPUk5YLXAJFAE+V9jZ0SpltGmXI6YHGYozDwQA

#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2022-05-18 17:29:28.000 UTC</summary>

Thanks for reporting, we will look into it

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-18 17:53:21.000 UTC</summary>

There are 2 problems I see here:
1. You must extend `ActivityInterface` in order to use it as a type param in `proxyActivities`
  - This isn't too bad but I'd be happy if it can be avoided (as in your solution)
3. The returned proxy object supports using any key as an `ActivityFunction<any[], any>`
  - You won't get any completions from the TS language server for undeclared properties but compilation still passes so that's not great

Your workaround could be used as the actual type for proxy activities.
The only downside I see to that is that if you use a type that doesn't have any methods with a valid activity signature (`ActivityFunction`) you won't get any compiler errors, you simply wouldn't see them on the proxy.

FTR, I managed to simplify the `ActivityInterfaceFor` type a bit:
```ts
type ActivityInterfaceFor<T> = {[K in keyof T as T[K] extends ActivityFunction<any[], any> ? K : never]: T[K]};
```

Overall, I like your suggestion and I think we should change the signature.


</details>

<details>
<summary><strong>beaucollins</strong> commented on 2022-05-18 18:01:11.000 UTC</summary>

> FTR, I managed to simplify the ActivityInterfaceFor type a bit:

I originally had that but the downside to your simplified version is `tsc` no longer links the source definition's method to the returned type which has a poorer developer experience.

For example, with your simplified version, using the playground link I provided:

```ts
const {
    performWork,
} = ourProxyActivities<NonConformingWorkflows>({});
```

Command click on `performWork ` and it doesn't know where to take you because the type references are no longer connected.

If you leave the `Pick<T, keyof /* ... */>` in, command click the `performWork` and it takes you to the interface that defined it.

</details>

<details>
<summary><strong>beaucollins</strong> commented on 2022-05-18 18:36:48.000 UTC</summary>

A better way to communicate what's going on we can split that `ActivityInterfaceFor` into two different utility functions.

```ts
// union of keys of T that extend V
type KeysWhere<T, V> = keyof {[K in keyof T as T[K] extends V ? K : never]: T[K]};

// Only pick the keys that conform
type ActivityInterfaceFor<T> = Pick<T, KeysWhere<T, ActivityFunction<any[], any>;
```

> The only downside I see to that is that if you use a type that doesn't have any methods with a valid activity signature, you simply wouldn't see them on the proxy.

I haven't actually used the API at all so I'm not entirely familiar with the expectations of using temporal here. Would it be expected to use `proxyActivities()` without calling a method on the returned interface? Because you'll get compilation errors on any attempts to use a method that doesn't exist.



</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-18 21:19:59.000 UTC</summary>

Not sure I understand the question.

Here's what I think could be a reasonable interface

```ts
import { ActivityInterface, ActivityFunction, ActivityOptions } from '@temporalio/workflow';

const NotAnActivityMethod = Symbol.for('__TEMPORAL_NOT_AN_ACTIVITY_METHOD');
type UntypedActivities = ActivityInterface;
type ActivityInterfaceFor<T> = {[K in keyof T]: T[K] extends ActivityFunction<any[], any> ? T[K] : typeof NotAnActivityMethod};
// The other option would be to map to `never` but that means that there's no signal to the user if they've misconfigured an activity function.
// Downside of the Symbol approach is that it's misleading, we can't ensure at runtime that you get a Symbol.

function proxyActivities<A = UntypedActivities>(options: ActivityOptions): ActivityInterfaceFor<A> {
    return {} as any
}

interface NonConformingWorkflows {
  performWork(input: boolean): Promise<'complete' | 'whatever'>;
  invalidDefinition(input: boolean): string;
}

const act = proxyActivities<NonConformingWorkflows>({});

act.performWork(true);
act.invalidDefinition();
// ^^ TS complains with:
// (property) invalidDefinition: typeof NotAnActivityMethod
// This expression is not callable.
// Type 'Symbol' has no call signatures.(2349)

// For JS users this still works:
const act2 = proxyActivities({});
act2.notFound();
```


</details>


---

<a id="499"></a>

### #499: [Feature Request] Add WorkflowExecutionAlreadyTerminated

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/499 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-24 22:59:50.000 UTC (3y 10m ago) |
| **Updated** | 2022-03-01 00:01:25.000 UTC |
| **Closed** | 2022-03-01 00:01:24.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 3 |
| **Priority Score** | 5 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

For terminating an already-terminated workflow with the same ID

#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2022-02-24 23:04:07.000 UTC</summary>

Implemented similar to `WorkflowExecutionAlreadyStartedError`:

All references: https://github.com/temporalio/sdk-typescript/search?q=WorkflowExecutionAlreadyStartedError

Core logic: https://github.com/temporalio/sdk-typescript/blob/d54476f91493c4f33f1baedfedc77f69e9b8f829/packages/client/src/workflow-client.ts#L638-L650

Not sure what the grpc status code or message will be for `AlreadyTerminated`, but we'll find out when we write a failing test.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-28 23:32:06.000 UTC</summary>

It'd just be not found and we already have that exception

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-01 00:01:24.000 UTC</summary>

Thanks! @rupalivohra just wanted to make sure you saw ^

</details>


---

<a id="461"></a>

### #461: [Feature Request] Log all errors in Worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/461 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-02 18:55:13.000 UTC (3y 11m ago) |
| **Updated** | 2022-07-11 22:51:01.000 UTC |
| **Closed** | 2022-07-11 22:51:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

If you `throw { }` or `throw new Error("error in workflow")` in a Workflow, the Worker outputs:

```
2022-02-02T17:41:23.579Z [WARN] [temporal_sdk_core::worker] Failing workflow activation run_id="c14a832e-ec8f-4d04-8019-013002e629da" failure=Failure { failure: Some(Failure { message: "Error: error in workflow", source: "TypeScriptSDK", stack_trace: "", cause: None, failure_info: None }) } 
```

But if you throw an instance of `TemporalFailure`, there's no output. 

Related:  https://github.com/temporalio/sdk-typescript/issues/407

#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2022-02-02 19:27:35.000 UTC</summary>

You're not supposed to directly throw `TemporalFailure`, it's up to the framework to do that.

I would add a logger for activity tasks and workflow activations.
We already have DEBUG logging, maybe we just need to increase the log level.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-02 19:37:33.000 UTC</summary>

> You're not supposed to directly throw TemporalFailure, it's up to the framework to do that.

I meant anything that has `TemporalFailure` as an ancestor.

![image](https://user-images.githubusercontent.com/251288/152223766-a8819ff6-2c31-4a7c-94bb-d3e4655910e3.png)

I took these docs to mean that I, as a user, should sometimes throw `ApplicationFailure`s and make my own errors by extending `TemporalFailure`. Also, I know that if I don't extend `TemporalFailure`, and just throw `new Error()`, I'll just fail the WorkflowTask, versus sometimes I might want to fail the WorkflowExecution.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-02 23:06:47.000 UTC</summary>

You're not supposed to subclass any of the failure classes, they have a one to one mapping with the proto definitions.
To fail the workflow execution you should throw an `ApplicationFailure`.

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-02-03 13:14:02.000 UTC</summary>

we should probably document that better

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-03 15:59:04.000 UTC</summary>

Yep, will do

On Thu, Feb 3, 2022 at 8:14 AM swyx ***@***.***> wrote:

> we should probably document that better
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/461#issuecomment-1028978976>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AAB5LGANEARMWGJUNIIEZXTUZJ5SJANCNFSM5NM3XXFQ>
> .
> You are receiving this because you authored the thread.Message ID:
> ***@***.***>
>


</details>


---

<a id="437"></a>

### #437: [Feature Request] Add headers to signal and query interceptors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/437 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-12-28 19:37:37.000 UTC (4 years ago) |
| **Updated** | 2021-12-28 22:28:27.000 UTC |
| **Closed** | 2021-12-28 22:28:27.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 1 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

Server support for headers in signal and query requests was added in https://github.com/temporalio/temporal/pull/2149.

The TypeScript SDK needs to expose this in the various interceptors.


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-12-28 22:28:27.000 UTC</summary>

Duplicate of #438 

</details>


---

<a id="407"></a>

### #407: [Feature Request] Update users on their Workflow Execution progress in the shell 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/407 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-28 23:38:16.000 UTC (4y 1m ago) |
| **Updated** | 2022-07-14 22:18:11.000 UTC |
| **Closed** | 2022-07-14 22:18:11.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 1 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

There are various types of issues that currently require viewing the web console to debug. For instance, as @JoshuaKGoldberg reported, an uncaught error in an Activity results in a hanging `npm run workflow` and no Worker output.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Give the user more information in the shell on what's happening.

During `worker.run()`, if `NODE_ENV` isn't `staging|production`, logging progress updates like:

```
Polling for tasks on queue "tutorial"
Starting execution of `example` workflow with:
  ID: 'my-business-id'
  Arguments:  ['Temporal']
Calling activity `greet` with args: 'Temporal'
Activity failed with:
  Error: test
  Error
    at Activity.greet [as fn] (/Users/me/gh/samples-typescript/hello-world/src/activities.ts:3:9)
Calling activity `greet` with args: 'Temporal' (attempt #2)
Activity failed with:
  Error: test
  Error
    at Activity.greet [as fn] (/Users/me/gh/samples-typescript/hello-world/src/activities.ts:3:9)
```

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

Related: https://github.com/temporalio/sdk-typescript/issues/305

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 22:18:11.000 UTC</summary>

We recently added logging interceptors so the default SDK logs should be much more informative.
I think we can close this.

</details>


---

<a id="403"></a>

### #403: [Feature Request] Help users avoid no-worker bug

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/403 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-26 21:31:11.000 UTC (4y 1m ago) |
| **Updated** | 2023-01-10 17:48:15.000 UTC |
| **Closed** | 2023-01-10 17:48:15.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 3 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->
Situation:
- A user either doesn't have a worker running, or they have it running on the wrong taskQueue
- They start/execute a workflow
- They think it's broken because they're not getting the intended result 

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

One way to help is to educate users on when and how to debug via the web UI. 

A more helpful way to address this specific situation is:

If user is [in development](https://github.com/temporalio/sdk-typescript/issues/305#issuecomment-944606605), when `start|execute|signalWithStart` is called and there are no workers polling on the queue, log:

```
‚ö†Ô∏è There are no Workers polling on task queue 'my-queue'. 
In order to start running this `logSampleWorkflow` workflow, run a Worker with `taskQueue: 'my-queue'`.
```

### Additional context

Similar issue: #305 

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-27 01:32:46.000 UTC</summary>

Let's discuss this, I'm not convinced this is the right way to go

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-05 20:11:42.000 UTC</summary>

Got bit by this again üòÜ (wrong task queue)

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-10 17:48:15.000 UTC</summary>

UI now provides a banner helping with those cases.

</details>


---

<a id="283"></a>

### #283: [Bug] It's too easy to get confused by importing an activity directly

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/283 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-10-06 22:44:26.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-14 21:14:06.000 UTC |
| **Closed** | 2021-10-14 21:14:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | documentation, enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

While writing a new integ test I tried to load the fake progress activity directly from `activities/fake-progress.ts` like so:

```ts
import * as fakeProgAct from '../activities/fake-progress';

const { fakeProgress } = createActivityHandle<typeof fakeProgAct>({
  startToCloseTimeout: '5s',
  scheduleToCloseTimeout: '10s',
  heartbeatTimeout: '3s',
  cancellationType: ActivityCancellationType.WAIT_CANCELLATION_COMPLETED,
});
```

But, the workflow would then run the `fakeProgress` wrapper defined in `activities/index.js` even though a user would expect that not to happen.

### To Reproduce
:point_up: 

### Expected behavior

The imported activity should be the activity that gets run, or if that's not reasonable to fix, we should at least throw some kind of error about having conflicting names at registration time.

### Screenshots/Terminal output

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Versions
master

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-06 23:27:14.000 UTC</summary>

Workflows can't import activity implementations, only type definitions, these types are lost at runtime.
Due to this limitation it isn't possible to "fix" the issue.
The best we can do is document how to properly use activities which is to use the same activities that are registered in the worker.
`createActivityHandle` returns a `Proxy` object with the same type of the activity types passed in the template parameter, it gives us inference for both the activity names and signatures.
As a side note, this might happen when calling activities cross languages and services.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-06 23:40:49.000 UTC</summary>

@bergundy What about the other option? Can we just barf at registration time if you define multiple same-named exports?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 00:08:02.000 UTC</summary>

Typescript already protects from that but only for a single file: `Cannot redeclare exported variable 'X'`.
There's nothing stopping a developer from defining activities in multiple files and exporting them all in an index file, I'd say it's good practice.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-12 18:48:30.000 UTC</summary>

Reviving this to track giving users help in the event they run into weird webpack errors because of this.

It's super easy to have the IDE import your activity function for you and not realize what's going on and then webpack barfs all over your worker.

We should at least link to a FAQ "Why am I getting webpack errors" page when this happens

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-13 02:56:21.000 UTC</summary>

@Sushisource this isn't the same error you got today AFAICT, you tried to run the activity directly, right?

</details>


---

<a id="269"></a>

### #269: [Feature Request] replace workDir with utility func, and switch to `nodeModulesPaths` array for webpack

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/269 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-09-27 18:05:03.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 14:31:54.000 UTC |
| **Closed** | 2021-10-07 14:31:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

### To Reproduce

<!-- 
Steps to reproduce the behavior: 
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error
-->

### Expected behavior

<!-- A clear and concise description of what you expected to happen. -->

### Screenshots/Terminal output

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Versions

<!-- Please complete the following information where relevant. -->

- OS: [e.g. Mac, Windows, Linux]
- Temporal Version [e.g. 1.7.0?]
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (5)

<details>
<summary><strong>lorensr</strong> commented on 2021-09-27 19:15:45.000 UTC</summary>

Default `nodeModulesPath`: the first `node_modules/` reached when searching from the `workflowsPath` and up.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-27 19:17:50.000 UTC</summary>

```
import * as activities from './activities';

Worker.create({
  workflowsPath: path.join(__dirname, 'workflows'),
  activities,
  taskQueue: 'test',
});
```

And if default doesn't work for user, they add `nodeModulesPath: path.join(__dirname, '../sibling/node_modules'),`

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 05:51:45.000 UTC</summary>

@lorensr with your suggestion above we might not need a helper function at all.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 15:23:28.000 UTC</summary>

@lorensr, even better IMHO:

```ts
import * as activities from './activities';

Worker.create({
  workflowsPath: require.resolve('./workflows'),
  activities,
  taskQueue: 'test',
});
```

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-29 15:30:19.000 UTC</summary>

Yeah that‚Äôs better!

On Wed, Sep 29, 2021 at 11:23 AM Roey Berman ***@***.***>
wrote:

> @lorensr <https://github.com/lorensr>, even better IMHO:
>
> import * as activities from './activities';
> Worker.create({
>   workflowsPath: require.resolve('./workflows'),
>   activities,
>   taskQueue: 'test',});
>
> ‚Äî
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-node/issues/269#issuecomment-930281618>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AAB5LGF3LZ3KUF5VRI32UVTUEMVPXANCNFSM5E3ELTMA>
> .
>


</details>


---

<a id="244"></a>

### #244: [Bug] Auto generated changelogs and versions are not working as intended

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/244 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-15 09:46:10.000 UTC (4y 3m ago) |
| **Updated** | 2022-09-08 00:16:19.000 UTC |
| **Closed** | 2022-09-08 00:16:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

### Describe the bug

lerna does not understand that the meta package (`temporalio`) version should be incremented according to its dependencies.
The last 2 releases were breaking changes but this was not reflected in the package version, bumped from `0.4.0` to `0.4.1` and then `0.4.2`. It should have been on version `0.6.0` by now.

At this point, I'm thinking it might make more sense to have a single version for all of the packages in the mono-repo.

lerna changelog seems to be broken, `feat!` commits are being classified as bug fixes and the changelog messages are duplicated across any package that was part of the commit that changed.

https://github.com/temporalio/sdk-node/commit/23da8507a90049774cc6ddd28a8ec3dfc37d345f#diff-639cb7cb3eda69b4a479a3a8e11c556d1ac91b6ba1552785fd17fb5970f67150

Using a single version for all packages, we'll be able to get rid of all of the package specific changelogs and get rid the duplication.


#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-11 12:53:09.000 UTC</summary>

If we're doing a single version for all packages, we can remove the `protos` dependency on `core-bridge` and close #172.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 19:51:15.000 UTC</summary>

We now have a single version for all packages and a single changelog, much better!
As discussed on slack with @Sushisource, we'll drop the conventional commit CI check and only check that PR titles follow the convention.
Right before the PR is merged there's a window to break the convention if the title is edited but we won't go that far to enforce conventions.
Before releasing we'll still want to manually edit the CHANGLOG, so this is not as critical as it was when lerna auto-generated changlogs.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 19:54:15.000 UTC</summary>

We'll also probably want to disable rebase and merge and only use squash commits

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-13 14:17:15.000 UTC</summary>

Removed the beta milestone because the important part has been done already.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-08 00:16:19.000 UTC</summary>

Our current process is good enough, we can add a CI step to validate the PR title but it's overkill IMHO, we end up manually editing the auto-generated CHANGELOG anyways.

</details>


---

<a id="228"></a>

### #228: [Feature Request] Flexible workflow and main method naming

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/228 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2021-09-07 21:02:54.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-12 10:03:18.000 UTC |
| **Closed** | 2021-09-12 10:03:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Ideally one should be able to implement any workflow in any language supported by Temporal. This is important when migrating to a new language, e.g., from PHP to Typescript. However, there are currently some incompatibilities regarding workflow and workflow method naming.

For example, I wanted to provide a Typescript implementation of the game rules in a [polyglot snake example](https://github.com/joebowbeer/temporal-polyglot-snake), but ran into some issues that required changes in the workflow's client.

* The PHP workflow is named BoardRules.new whereas the Node SDK currently assigns the workflow names from their filenames.
* The game code expects a workflow method named `exec` whereas the Node SDK requires a method named `main`.

See https://github.com/tsurdilo/temporal-polyglot-snake/blob/main/game/src/main/java/io/temporal/snakegame/GameRulesWorkflowInterface.java#L10-L11

As I result, I needed to modify the game code to work with the new Typescript workflow implementation.

### Describe the solution you'd like

Please eliminate incompatibilities, or at the least document them and recommend strategies to avoid them.

#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 08:36:28.000 UTC</summary>

I don't think we want to support renaming `main` (now called `execute`), I don't see much value in it, I feel like it's simpler to just have this as a convention.
In #225 we change workflow registration to be export based instead of file based, you can use any export compatible name for your workflow.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-09 10:09:17.000 UTC</summary>

Regarding the `execute` entrypoint:

Searching for PHP WorkflowMethod annotations, I see a lot of different entrypoint names being used, and I do think they make the code more expressive:

run, handle, handler, exec, execute, greet, greetPeriodically, composeGreeting, createGreeting, bookTrip, transfer, compensate, and so on and so on.

In some of the Java examples the entrypoint name is not only part of the named interface but is also referenced in the code: WorkflowInterface::exec.

I think it would be a rude surprise for someone hoping to migrate to TypeScript to realize that they have to change a lot of legacy workflow interfaces.

My documentation suggestion is meant to avoid this surprise.

Also, I think it would be wise to consider how this might be supported in a future enhancement. In TypeScript this seems to me like a job for Decorators.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-09 13:48:18.000 UTC</summary>

I thought about using decorators with typescript but ruled it out because we want JS to be fully supported in the SDK so we can't use any exclusive TS features.
I can't think of an ergonomic way to support custom method names and I'm not convinced it adds much in terms of readability.
I think this is one of those cases where we should go with the language constraints.
Note that the go SDK doesn't even have an `execute` method and the prototype rust SDK doesn't either.
Also note that there's no real meaning to this method other perhaps for improved readability.
You can still define a Workflow interface in Java (or PHP) with a custom method name and use that to call a Workflow in node.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-09-12 01:54:52.000 UTC</summary>

Thanks for the explanation.

At the generic SDK level, that is, not specific to the Node SDK, I think it would be helpful to provide a compatibility matrix showing what can call what, within certain naming restrictions. That would clarify how to code for maximum cross-language compatibility.

Related: #232 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 10:03:18.000 UTC</summary>

I agree, we should document how to call workflows and activities in other languages, ideally we'd have the full matrix.
As mentioned above using `execute` vs. custom method name is purely superficial, there are no compatibility issues.

I can have the following workflow interface in Java:
```java
@WorkflowInterface
public interface GreetingWorkflow {
    @WorkflowMethod
    void greet(String name);
}
```

And call it from node via:
```ts
type GreetingWorkflow = (name: string) => {
  execute(): Promise<void>;
}

const wf = client.stub<GreetingWorkflow>('greeting', { taskQueue: 'example' });
await wf.execute('joe'); // calls `createGreeting` in Java
```

Or this node Workflow (using the type above):
```ts
export function greetingWorkflow(name: string) {
  return {
    async execute() {
      // ...
    }
  };
}
```

And call it from Java:

```java
GreetingWorkflow workflow = client.newWorkflowStub(GreetingWorkflow.class, workflowOptions);
workflow.greet("joe") // calls `execute` in node
```

</details>


---

<a id="110"></a>

### #110: [Bug] Getting a "ValueError: Unknown Encoding: ^PÔøΩ)^F0ÔøΩ" error when running hello world sample app

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/110 |
| **State** | CLOSED |
| **Author** | vkarpov15 (Valeri Karpov) |
| **Created** | 2021-05-25 22:08:47.000 UTC (4y 7m ago) |
| **Updated** | 2021-06-30 20:56:49.000 UTC |
| **Closed** | 2021-06-30 20:56:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**
A clear and concise description of what the bug is.

**To Reproduce**
Steps to reproduce the behavior:
1. Go to https://docs.temporal.io/docs/node/getting-started/
2. Follow steps
3. Get below error when running `node lib/worker/schedule-workflow.js`:

```
2021-05-25T22:02:48.562Z [INFO] webpack 5.37.1 compiled successfully in 744 ms
2021-05-25T22:02:48.696Z [INFO] Worker state changed { state: 'RUNNING' }
2021-05-25T22:02:51.942Z [ERROR] Worker failed {
  error: ValueError: Unknown encoding: ^PÔøΩ)^F0ÔøΩ
      at CompositeDataConverter.fromPayload (/home/val/Workspace/temporalio/example/node_modules/@temporalio/workflow/lib/converter/data-converter.js:29:19)
      at /home/val/Workspace/temporalio/example/node_modules/@temporalio/workflow/lib/converter/data-converter.js:54:47
      at Array.map (<anonymous>)
      at Object.arrayFromPayloads (/home/val/Workspace/temporalio/example/node_modules/@temporalio/workflow/lib/converter/data-converter.js:54:20)
      at /home/val/Workspace/temporalio/example/node_modules/@temporalio/worker/lib/worker.js:303:55
      at rxjs_1.pipe.operators_1.mergeScan.state (/home/val/Workspace/temporalio/example/node_modules/@temporalio/worker/lib/rxutils.js:15:68)
      at MergeScanSubscriber._next (/home/val/Workspace/temporalio/example/node_modules/rxjs/internal/operators/mergeScan.js:55:23)
      at MergeScanSubscriber.Subscriber.next (/home/val/Workspace/temporalio/example/node_modules/rxjs/internal/Subscriber.js:66:18)
      at Subject.next (/home/val/Workspace/temporalio/example/node_modules/rxjs/internal/Subject.js:60:25)
      at GroupBySubscriber._group (/home/val/Workspace/temporalio/example/node_modules/rxjs/internal/operators/groupBy.js:98:19)
}
2021-05-25T22:02:51.943Z [INFO] Worker state changed { state: 'FAILED' }
  May 25 18:02:51.943  WARNtemporal_sdk_core::workflow::concurrency_manager: Sending side of workflow machine creator was dropped. Likely the WorkflowConcurrencyManager was dropped. This indicates a failure to call shutdown.

```

**Expected behavior**
A clear and concise description of what you expected to happen.

No error

**Screenshots/Terminal ouput**
If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports.

![image](https://user-images.githubusercontent.com/1620265/119574933-3952ea00-bd84-11eb-8a9a-eda734016a2b.png)


**Versions (please complete the following information where relevant):**
 - OS: [e.g. Mac, Windows, Linux]
 - Temporal Version [e.g. 1.7.0?]
 - are you using Docker or Kubernetes or building Temporal from source?

Xubuntu 18.04, Node v14.4.0, [@temporalio/create](https://www.npmjs.com/package/@temporalio/create) v0.3.0

**Additional context**
Add any other context about the problem here.


#### Comments (5)

<details>
<summary><strong>vkarpov15</strong> commented on 2021-05-25 22:31:18.000 UTC</summary>

This problem goes away when I change task queue names, so I think it may be due to an old entry in the task queue causing issues.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-26 08:40:17.000 UTC</summary>

Sounds like you figured out the issue.
You can verify by listing open Workflows on you Temporal server and finding one that uses the default namespace and the tutorial task queue.
If you change the Worker [log level](https://docs.temporal.io/docs/node/logging/) to `DEBUG` you might find out some more information too.
We can definitely improve the error message and probably should prevent this sort of error from killing the Worker. 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-26 08:43:24.000 UTC</summary>

TBH, I don't think we can improve the error message much, looks like the Payload metadata contains non-unicode characters https://github.com/temporalio/sdk-node/blob/a25c0feca791a195eb5e50cf8c0fd9e0b5a1db83/packages/workflow/src/converter/data-converter.ts#L65

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-05-26 12:38:51.000 UTC</summary>

use temporal, unleash cthulu!

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-28 23:31:49.000 UTC</summary>

@vkarpov15 can we close this?

</details>


---

<a id="48"></a>

### #48: Implement worker limits

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/48 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-24 14:52:28.000 UTC (4y 9m ago) |
| **Updated** | 2022-08-17 18:37:50.000 UTC |
| **Closed** | 2022-06-01 16:34:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 5 |
| **Priority Score** | 5 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Worker should respect the limits defined in [`WorkerOptions`](https://github.com/temporalio/sdk-node/blob/19703305a1a8874a13d50429b6cdf20fb65b8e68/packages/worker/src/worker.ts#L131)

#### Comments (5)

<details>
<summary><strong>bergundy</strong> commented on 2021-04-22 09:05:22.000 UTC</summary>

#71 implements `maxConcurrentActivityExecutions` and `maxConcurrentWorkflowTaskExecutions`, we'll finish the rest after the alpha release.

</details>

<details>
<summary><strong>rbialek</strong> commented on 2022-05-19 13:08:10.000 UTC</summary>

Any progress on the ActivityExecution implementation? 
Any ETA/plans to implement eg, maxTaskQueueActivitiesPerSecond ? 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-19 15:59:09.000 UTC</summary>

We can easily expose `maxTaskQueueActivitiesPerSecond` the other rate limits aren't implemented in Core yet.
@Sushisource 

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-05-19 16:51:40.000 UTC</summary>

@bergundy The only one that isn't implemented is `maxWorkerActivitiesPerSecond` 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-19 17:34:40.000 UTC</summary>

For some reason I thought we have RL for workflows too

</details>


---

<a id="1800"></a>

### #1800: [Feature Request] Provide a way to distinguish error types in logs from TypeScript SDK (errors lose type info across Worker <-> Workflow)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1800 |
| **State** | OPEN |
| **Author** | antmendoza (Antonio Mendoza P√©rez) |
| **Created** | 2025-10-16 09:02:31.000 UTC (2 months ago) |
| **Updated** | 2025-10-16 09:02:31.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 0 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Currently users cannot distinguish error types in Temporal‚Äôs TypeScript SDK logs, all logged errors appear as plain Error objects with no type information. This prevents detecting whether a failure came from an Activity or a Workflow, making it impossible to set appropriate log levels (e.g., log failures as ERROR instead of WARN). 


### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->
> I see, it is a documented limitation of NodeJS. Can you guys introduce some indication of type in the field? As I pointed out above (type or code). It will solve the issue. Also, I noticed that failure field is also a string instead of proper object where we can see details. I understand if you change it to an object, it will be a breaking functionality for someone. Maybe we can introduce another one?

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->
Slack thread: https://temporalio.slack.com/archives/C01DKSMU94L/p1756795588257069

> To be clear, what we‚Äôre talking about here are limitations of either Node or V8 themselves, not bugs of the Temporal SDK. See [here](https://nodejs.org/docs/latest-v20.x/api/worker_threads.html#considerations-when-cloning-objects-with-prototypes-classes-and-accessors).


---

<a id="1738"></a>

### #1738: [Bug] opentelemetry traceState is handled properly in  makeWorkflowExporter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1738 |
| **State** | OPEN |
| **Author** | safareli (Irakli Safareli) |
| **Created** | 2025-07-04 16:13:50.000 UTC (6 months ago) |
| **Updated** | 2025-10-09 17:23:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

When using otel if workflow has tracestate header like this:

<img width="641" height="168" alt="Image" src="https://github.com/user-attachments/assets/c450bc8e-ec7c-4d16-8bc3-ee0051a26509" />

exporting span from worker fails


### Describe the bug

getting this errors:

```
TypeError: _a.serialize is not a function
    at sdkSpanToOtlpSpan (/app/node_modules/.pnpm/@opentelemetry+otlp-transformer@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-transformer/src/trace/internal.ts:44:33)
    at <anonymous> (/app/node_modules/.pnpm/@opentelemetry+otlp-transformer@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-transformer/src/trace/internal.ts:159:11)
    at Array.map (<anonymous>)
    at spanRecordsToResourceSpans (/app/node_modules/.pnpm/@opentelemetry+otlp-transformer@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-transformer/src/trace/internal.ts:158:34)
    at createExportTraceServiceRequest (/app/node_modules/.pnpm/@opentelemetry+otlp-transformer@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-transformer/src/trace/internal.ts:110:20)
    at Object.serializeRequest (/app/node_modules/.pnpm/@opentelemetry+otlp-transformer@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-transformer/src/trace/json/trace.ts:26:52)
    at OTLPExportDelegate.export (/app/node_modules/.pnpm/@opentelemetry+otlp-exporter-base@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-exporter-base/src/otlp-export-delegate.ts:69:48)
    at OTLPTraceExporter.export (/app/node_modules/.pnpm/@opentelemetry+otlp-exporter-base@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/otlp-exporter-base/src/OTLPExporterBase.ts:32:26)
    at Object.fn (/app/node_modules/.pnpm/@temporalio+interceptors-opentelemetry@1.11.7_@temporalio+activity@1.11.7_@temporalio+c_49fd2775686fed0552daf86155185cd7/node_modules/@temporalio/interceptors-opentelemetry/src/worker/index.ts:86:24)
    at <anonymous> (/app/node_modules/.pnpm/@temporalio+worker@1.11.7/node_modules/@temporalio/worker/src/worker.ts:1364:23)
    at Array.map (<anonymous>)
    at Worker.processSinkCalls (/app/node_modules/.pnpm/@temporalio+worker@1.11.7/node_modules/@temporalio/worker/src/worker.ts:1362:21)
    at Worker.handleActivation (/app/node_modules/.pnpm/@temporalio+worker@1.11.7/node_modules/@temporalio/worker/src/worker.ts:1208:22)

```

### Minimal Reproduction


reproducing this locally was bit hacky.
had to add this so tracestate was passed to temporal when invoking a workflow via js client.

<img width="1686" height="234" alt="Image" src="https://github.com/user-attachments/assets/050feb21-0218-4e3b-bff2-3aeffe610421" />


then once the trace state is passed to workflow  in the makeWorkflowExporter that's passed to Worker.create we get `traceState` that is instance of Object and not an instance of expected TraceState. via debugger you can see this:

<img width="521" height="198" alt="Image" src="https://github.com/user-attachments/assets/6feb9579-94e6-4e79-b7d2-999da58d428f" />

because of this then at some point when span is converted to an request to otel collector as there is traceState .serialize is called on it but this object has no methods only that `_internalState` which is private prop of the TraceState see:

<img width="944" height="539" alt="Image" src="https://github.com/user-attachments/assets/51d91e1f-77f2-458a-a398-c65ccd00c402" />


I suppose the trace state is moved across different JS contexts (from workflow code to host) and information that this object is instance of TraceState is lost and on the other end we just get Object.

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions



- OS and processor: M1 Mac
- Temporal SDK Version: 1.11.7
- Are you using Docker or Kubernetes or building Temporal from source? no



#### hacky fix on my end was to do this:

```ts
const fixTemporalBug = (traceState: TraceState): TraceState => {
  const res = new TraceState();

  (res as any)._internalState = (traceState as any)._internalState;

  return res;
};

// inlined version of makeWorkflowExporter that fixes traceState bug in Temporal
const makeWorkflowExporterFixed = (
  exporter: SpanExporter,
  resource: Resource,
): InjectedSink<OpenTelemetryWorkflowExporter> => {
  return {
    export: {
      fn: (info: WorkflowInfo, spanData: SerializableSpan[]): void => {
        const spans = spanData.map((serialized) => {
          Object.assign(serialized.attributes, info);
          // Spans are copied over from the isolate and are converted to ReadableSpan instances
          const {
            spanContext: { traceState, ...spanContext },
            ...rest
          } = serialized;

          return {
            spanContext: (): SpanContext => ({
              ...spanContext,
              traceState: traceState == null ? traceState : fixTemporalBug(traceState as any),
            }),
            resource,
            ...rest,
          };
        });

        // Ignore the export result for simplicity
        exporter.export(spans, () => undefined);
      },
    },
  };
};
```

#### Comments (4)

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-09 06:20:21.000 UTC</summary>

Thanks for the detailed report, that's helpful.

This is actually the second time I here about this issue (see [previous discussion](https://temporalio.slack.com/archives/C01DKSMU94L/p1746432163574499) on our Slack workspace), though we never got far enough in investigating this the other time.

Interestingly, however, you are _only_ the second user reporting this, which makes me think that this may only show up in some specific environment. Do you happen to have a dependency on the `dd-trace` package? Or any other particular trace/otel-related dependency?

Both your trace and the other user's traces show the `@opentelemetry/otlp-transformer@0.57.2` package, whereas our SDK is built and tested against v0.46.0 without problem. But `otlp-transformer` [introduced that specific `ctx.traceState?.serializer()` line](https://github.com/open-telemetry/opentelemetry-js/commit/5b070b80a43f8c29ac1ea87f868b5ba01b11b0a3#diff-f43120d2e8669c168489dd2e7b44fb28f5e0316e64c5270418294378bb8ed284R35) in v0.35.1. So I suppose `traceState` would "normally" be undefined unless something else is present that forces those to be generated...

In any case, this is indeed an issue from our side, and  it needs to be fixed. As you correctly figured out, the trace data are sent from the Workflow Worker thread to the main thread, which goes through V8's serialization protocol. Functions and classes do not survive that serialization, and there's really nothing we can do about that. That means we'll probably need to adopt a solution kind of similar to the hack you figured out. Or maybe we can/should just drop the `traceState` entirely, WDYT?

</details>

<details>
<summary><strong>safareli</strong> commented on 2025-07-12 14:13:25.000 UTC</summary>

Instances of TraceState  have .serialize() method which converts it to string. long term solution in workflow land will perform that method call to get serialized string version of trace state. and then `makeWorkflowExporter` will addopt my changes but use `new TraceState(traceStateSerialized)` instead of my hacky way.

</details>

<details>
<summary><strong>JCMais</strong> commented on 2025-07-14 16:03:19.000 UTC</summary>

We are having the same issue after adding trace propagation, all temporal packages are on `1.11.7`, and here are the other related packages:
```
        "dd-trace": "5.22.0",
        "@sentry/node": "9.12.0",
        "@sentry/opentelemetry": "9.12.0",
        "@opentelemetry/api": "1.9.0",
        "@opentelemetry/auto-instrumentations-node": "0.56.0",
        "@opentelemetry/core": "1.30.1",
        "@opentelemetry/exporter-metrics-otlp-grpc": "0.57.2",
        "@opentelemetry/exporter-metrics-otlp-http": "0.57.2",
        "@opentelemetry/exporter-trace-otlp-grpc": "0.57.2",
        "@opentelemetry/exporter-trace-otlp-http": "0.57.2",
        "@opentelemetry/host-metrics": "0.35.5",
        "@opentelemetry/instrumentation": "0.57.2",
        "@opentelemetry/resource-detector-gcp": "0.33.0",
        "@opentelemetry/resources": "1.30.1",
        "@opentelemetry/sdk-metrics": "1.30.1",
        "@opentelemetry/sdk-node": "0.57.2",
        "@opentelemetry/sdk-trace-base": "1.30.1",
        "@opentelemetry/sdk-trace-node": "1.30.1",
        "@opentelemetry/semantic-conventions": "1.30.0",
```

Adding Sentry as related just because the trace propagation is done through Sentry-related headers:

<img width="687" height="197" alt="Image" src="https://github.com/user-attachments/assets/3cbb71ab-d611-4857-b7ba-06190071db0d" />

Stack trace:
```
TypeError: _a.serialize is not a function
at sdkSpanToOtlpSpan (trace/internal.js:14:83)
at trace/internal.js:110:62
at Array.map (<anonymous>)
at spanRecordsToResourceSpans (trace/internal.js:110:42)
at createExportTraceServiceRequest (trace/internal.js:74:24)
at Object.serializeRequest (protobuf/trace.js:27:72)
at OTLPExportDelegate.export (src/otlp-export-delegate.js:44:52)
at OTLPTraceExporter.export (src/OTLPExporterBase.js:29:30)
at Object.fn (lib/worker/index.js:88:32)
at worker/lib/worker.js:899:29
at Array.map (<anonymous>)
at Worker.processSinkCalls (worker/lib/worker.js:897:41)
at Worker.handleActivation (worker/lib/worker.js:778:32)
```

</details>

<details>
<summary><strong>lukeramsden</strong> commented on 2025-10-09 17:23:22.000 UTC</summary>

Seeing this issue too

```
$ npm ls | grep @opentelemetry
‚îú‚îÄ‚îÄ @opentelemetry/api@1.9.0
‚îú‚îÄ‚îÄ @opentelemetry/auto-instrumentations-node@0.55.2
‚îú‚îÄ‚îÄ @opentelemetry/exporter-trace-otlp-proto@0.57.0
‚îú‚îÄ‚îÄ @opentelemetry/resources@1.30.0
‚îú‚îÄ‚îÄ @opentelemetry/sdk-node@0.57.0
‚îú‚îÄ‚îÄ @opentelemetry/sdk-trace-base@1.30.0
‚îú‚îÄ‚îÄ @opentelemetry/semantic-conventions@1.34.0
$ npm ls | grep @temporalio
‚îú‚îÄ‚îÄ @temporalio/activity@1.13.0
‚îú‚îÄ‚îÄ @temporalio/client@1.13.0
‚îú‚îÄ‚îÄ @temporalio/common@1.13.0
‚îú‚îÄ‚îÄ @temporalio/interceptors-opentelemetry@1.13.0
‚îú‚îÄ‚îÄ @temporalio/testing@1.13.0
‚îú‚îÄ‚îÄ @temporalio/worker@1.13.0
‚îú‚îÄ‚îÄ @temporalio/workflow@1.13.0
```


```
"TypeError: _a.serialize is not a function\n    at sdkSpanToOtlpSpan (/opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-transformer/build/src/trace/internal.js:14:83)\n    at /opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-transformer/build/src/trace/internal.js:110:62\n    at Array.map (<anonymous>)\n    at spanRecordsToResourceSpans (/opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-transformer/build/src/trace/internal.js:110:42)\n    at createExportTraceServiceRequest (/opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-transformer/build/src/trace/internal.js:74:24)\n    at Object.serializeRequest (/opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-transformer/build/src/trace/protobuf/trace.js:27:72)\n    at OTLPExportDelegate.export (/opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-exporter-base/build/src/otlp-export-delegate.js:44:52)\n    at OTLPTraceExporter.export (/opt/app/lib/node_modules/@opentelemetry/exporter-trace-otlp-proto/node_modules/@opentelemetry/otlp-exporter-base/build/src/OTLPExporterBase.js:29:30)\n    at Object.fn (/opt/app/lib/node_modules/@temporalio/interceptors-opentelemetry/lib/worker/index.js:91:32)\n    at /opt/app/lib/node_modules/@temporalio/worker/lib/worker.js:1035:29"
```

</details>


---

<a id="1718"></a>

### #1718: [Feature Request] Lazily load webpack

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1718 |
| **State** | OPEN |
| **Author** | arlyon (Alexander Lyon) |
| **Created** | 2025-05-22 01:06:43.000 UTC (7 months ago) |
| **Updated** | 2025-05-30 07:33:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Hi

I would like to strip webpack from my bundle for container efficiency reasons but can't because webpack is loaded eagerly. By lazily loading `workflow/bundler` in [index](https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/worker.ts) and in [worker](https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/worker.ts) you can get away with deleting webpack and friends from the bundle (in my case the docker container)

I have achieved it by applying this patch (on the build outputs) but I am sure doing a similar thing would be fairly easy on the typescript side. Note I have just removed the default interceptor warning altogether.

```diff
diff --git a/lib/index.js b/lib/index.js
index ac5a7f9594321f75f52ac0641621d91c02c9ba8c..3aaa482c51d04627d9d7a2b96755f721ec2b5949 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -52,8 +52,7 @@ Object.defineProperty(exports, "defaultPayloadConverter", { enumerable: true, ge
 Object.defineProperty(exports, "Worker", { enumerable: true, get: function () { return worker_1.Worker; } });
 var replay_1 = require("./replay");
 Object.defineProperty(exports, "ReplayError", { enumerable: true, get: function () { return replay_1.ReplayError; } });
-var bundler_1 = require("./workflow/bundler");
-Object.defineProperty(exports, "bundleWorkflowCode", { enumerable: true, get: function () { return bundler_1.bundleWorkflowCode; } });
+Object.defineProperty(exports, "bundleWorkflowCode", { enumerable: true, get: function () { return require("./workflow/bundler").bundleWorkflowCode; } });
 /* eslint-disable deprecation/deprecation */
 // Anything below this line is deprecated
 var activity_log_interceptor_1 = require("./activity-log-interceptor");
diff --git a/lib/worker.js b/lib/worker.js
index e8cf98a86e9e1045af378319f6242f1ba66a3194..d4fc8999e3ef50d64c3d87338d930f3a0e0c28e8 100644
--- a/lib/worker.js
+++ b/lib/worker.js
@@ -57,7 +57,6 @@ const rxutils_1 = require("./rxutils");
 const utils_1 = require("./utils");
 const worker_options_1 = require("./worker-options");
 const workflow_codec_runner_1 = require("./workflow-codec-runner");
-const bundler_1 = require("./workflow/bundler");
 const reusable_vm_1 = require("./workflow/reusable-vm");
 const threaded_vm_1 = require("./workflow/threaded-vm");
 const vm_1 = require("./workflow/vm");
@@ -317,12 +316,6 @@ class Worker {
                 logger.warn('Ignoring WorkerOptions.bundlerOptions because WorkerOptions.workflowBundle is set');
             }
             const modules = new Set(compiledOptions.interceptors.workflowModules);
-            // Warn if user tries to customize the default set of workflow interceptor modules
-            if (modules &&
-                new Set([...modules, ...bundler_1.defaultWorkflowInterceptorModules]).size !== bundler_1.defaultWorkflowInterceptorModules.length) {
-                logger.warn('Ignoring WorkerOptions.interceptors.workflowModules because WorkerOptions.workflowBundle is set.\n' +
-                    'To use workflow interceptors with a workflowBundle, pass them in the call to bundleWorkflowCode.');
-            }
             if ((0, worker_options_1.isCodeBundleOption)(compiledOptions.workflowBundle)) {
                 return parseWorkflowCode(compiledOptions.workflowBundle.code);
             }
@@ -335,6 +328,7 @@ class Worker {
             }
         }
         else if (compiledOptions.workflowsPath) {
+            const bundler_1 = require("./workflow/bundler");
             const bundler = new bundler_1.WorkflowCodeBundler({
                 logger,
                 workflowsPath: compiledOptions.workflowsPath,

```

#### Comments (4)

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-28 18:28:44.000 UTC</summary>

Yeah, making this dependency optional is definitely in my plans.

The approach you propose is a much lighter alternative to what was discussed in #933. I like it.

I don't think that the modification you did in `index.js` can be done in pure TS (nor would it be compatible with ESM once we get there), as you technically can't `export` a property getter. It would however be possible to export a stub `bundleWorkflowCode` function that internally does a dynamic `import` to the actual `bundleWorkflowCode` implementation, which could then live in a different, _optional_ package.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-28 18:47:36.000 UTC</summary>

Regarding the user land workaround you described, you have not mentioned how you prevent the webpack package from being installed in the `node_modules` directory (or from your generated worker bundle, if applicable), to start with, which is required if your goal is to save disk space.

I'm just curious how you did this. Are you using another bundling tool to bundle your _worker_ code? Or are you doing this by using some form of dependency tree modifiers specific to either NPM/PNPM/Yarn (e.g. `overrides`, `resolutions`, `readPackage`, etc)?

</details>

<details>
<summary><strong>arlyon</strong> commented on 2025-05-29 10:52:49.000 UTC</summary>

Hey!

Yes, the onus is still up to the user to make sure it doesn't get shipped, but this change makes it possible at least even if nodejs lacks the nuance to make it automatic.

We ship docker containers so I went down the rabbit hole to optimise them for size / layers. The basic process is to figure out which are external dependencies (things that cannot be bundled) and copy _only_ those (and their transitive dependencies) from your node modules into the final container. A side effect is that you might end up with the same module in your bundle and in your node_modules since your externals might need it. You could probably get around it but it's not worth my time.

https://gist.github.com/arlyon/c48c39b61c518e03da4e13b3086b37e5

Short explainer:
- use tsup
- force webpack to be an external dependency
- parse the tsup metafile to get the internal / external dependencies
- parse `pnpm list` to traverse dependencies of external dependencies and get the transitive closure (since an external dependency can only look for its dependencies in node_modules, not your bundle)
- filter out packages you know you don't need at runtime
  - I looked at overriding those deps with an empty package in `package.json` but we'd have to apply that only to the builds inside the container (which felt a little black-magic-y) since they are still needed during dev runtime.

I realise this is maybe overkill but you end up with very cacheable layers and very fast / light builds. We currently ship:

- total container size: 335MB
- OS: ~130MB
  - node: 110MB 
- external deps layer: 145MB
  - temporalio: 100MB
  - otel: 27MB
- code layer: 44MB
  - worker bundle: 5MB
  - worker source map: 24MB
  - workflow bundle: 12MB (with sourcemaps embedded)

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-30 07:33:26.000 UTC</summary>

Nice!

You should be able to strip an extra 60 MB very easily by removing native library files you don't need from the `node_modules/@temporalio/core-bridge/releases` directory. Just keep the one for your target platform.

</details>


---

<a id="1646"></a>

### #1646: [Feature Request] Initial Nexus implementation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1646 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-03-11 14:15:38.000 UTC (10 months ago) |
| **Updated** | 2025-11-14 08:48:05.000 UTC |
| **Closed** | 2025-08-26 16:58:55.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the solution you'd like

Alongside Nexus TypeScript SDK, need Temporal-specific implementation in this SDK. See https://github.com/temporalio/features/issues/609


#### Comments (2)

<details>
<summary><strong>rooque</strong> commented on 2025-07-03 13:58:25.000 UTC</summary>

@mjameswh hi! is there any estimate when nexus will be available for TS SKD?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-09 04:55:45.000 UTC</summary>

@rooque We're actively working on this.

If interested, you can keep an eye on ongoing work on the [nexus-rpc/sdk-typescript repository](https://github.com/nexus-rpc/sdk-typescript), as well as PR #1708.

Reactions: üëç 1

</details>


---

<a id="1613"></a>

### #1613: [Feature Request] Split worker build tool dependencies into a separate package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1613 |
| **State** | CLOSED |
| **Author** | pauldraper (Paul Draper) |
| **Created** | 2025-01-25 22:20:50.000 UTC (11 months ago) |
| **Updated** | 2025-01-28 19:49:32.000 UTC |
| **Closed** | 2025-01-28 19:48:54.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

Temporal workers are incredibly heavy.

```sh
yarn init
yarn add @temporalio/worker
du -Ahs node_modules
```

```txt
169M    node_modules
```

A simple "Hello world" worker is over 100 MiB. *Excluding* the Node.js runtime.

### Describe the solution you'd like

It appears that Temporal worker pulls in developer tooling: webpack, swc, webassemblyjs, etc.

I generate the workflow file at build time. (As a general rule, I run all of my build tools at -- well -- build time. I recommend it.)

If Temporal wants to do it in production, I guess that's convenient for someone. But put in `@temporalio/worker-build` or `@temporalio/worker-dev` or something.

### Additional context

\-

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 16:07:54.000 UTC</summary>

I agree, this is a problem for some target environments. That has been on my personal wish list for a very long time.

Unfortunately, fixing this at this point won't be easy. A large portion of our users rely on the "bundle workflows at runtime" ability in their production setup. Moving build tools to a different package would be breaking for those users. Same for marking Webpack and other build dependencies as optional (unfortunately, NPM doesn't allow users to be selective in which optional deps should be installed; you either install all of them or none).

A possible way to get there would be to not only move build dependencies out of `worker`, but to _completely_ split that package in two, let's say `bundler` and `worker-core`, and reexport everything exposed by those two packages from the legacy `worker` package. Then, users like you who want to avoid build dependencies would depend on the `worker-core` package, rather than `worker`.

Now, that's totally feasible, but still has some painful consequences, especially in regard to other ongoing development efforts (pretty much all outstanding PRs and WIP on feature branches would get broken by this change, requiring non-trivial manual work to conciliate changes). That's obviously not a complete blocker, but simply means that we should try to complete and merge as much ongoing work as we can before investing effort in splitting `worker`.

In the mean time, I think you should be able to have `yarn` ignore the offending dependencies by perusing [the `resolutions` property](https://classic.yarnpkg.com/en/docs/package-json#toc-resolutions) in your `package.json` file. That is, make those dependencies to a very simple stub package that you define locally. I never did that with Yarn classic, but I remember doing that with PNPM a very long time ago.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 19:49:15.000 UTC</summary>

Closing as duplicate of #933.

</details>


---

<a id="1607"></a>

### #1607: [Bug] TypeScript error TS2322: Type 'AsyncIterableIterator<any[]>' is not assignable to type 'AsyncIterable<[B]>'.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1607 |
| **State** | CLOSED |
| **Author** | philwhln (Phil Whelan) |
| **Created** | 2025-01-20 18:32:41.000 UTC (11 months ago) |
| **Updated** | 2025-01-23 05:12:20.000 UTC |
| **Closed** | 2025-01-23 05:12:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Calling list workflows

```
client.workflow.list();
```

### Describe the bug

TypeScript throws this error

```
node_modules/@temporalio/client/src/iterators-utils.ts:59:9 - error TS2322: Type 'AsyncIterableIterator<any[]>' is not assignable to type 'AsyncIterable<[B]>'.
  The types returned by '[Symbol.asyncIterator]().next(...)' are incompatible between these types.
    Type 'Promise<IteratorResult<any[], any>>' is not assignable to type 'Promise<IteratorResult<[B], any>>'.
      Type 'IteratorResult<any[], any>' is not assignable to type 'IteratorResult<[B], any>'.
        Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorResult<[B], any>'.
          Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorYieldResult<[B]>'.
            Type 'any[]' is not assignable to type '[B]'.
              Target requires 1 element(s) but source may have fewer.

59   const emitterEventsIterable: AsyncIterable<[B]> = on(emitter, 'result', { signal: controller.signal });
           ~~~~~~~~~~~~~~~~~~~~~

node_modules/@temporalio/client/src/iterators-utils.ts:65:17 - error TS2322: Type 'AsyncIterator<any[], any, undefined>' is not assignable to type 'AsyncIterator<void, any, undefined>'.
  The types returned by 'next(...)' are incompatible between these types.
    Type 'Promise<IteratorResult<any[], any>>' is not assignable to type 'Promise<IteratorResult<void, any>>'.
      Type 'IteratorResult<any[], any>' is not assignable to type 'IteratorResult<void, any>'.
        Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorResult<void, any>'.
          Type 'IteratorYieldResult<any[]>' is not assignable to type 'IteratorYieldResult<void>'.
            Type 'any[]' is not assignable to type 'void'.

65           const releaseEvents: AsyncIterator<void> = toAsyncIterator(
                   ~~~~~~~~~~~~~


Found 2 errors in the same file, starting at: node_modules/@temporalio/client/src/iterators-utils.ts:59
```

### Minimal Reproduction

```
client.workflow.list();
```

### Environment/Versions

TypeScript SDK version 1.11.6

Apple M1 Pro
15.2 (24C101)

Temporal Cloud

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (4)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-21 17:46:38.000 UTC</summary>

Add this to your `tsconfig.json` file:

```
{
  // ...
  "compilerOptions": {
    // ...
    "skipLibCheck": true  // <<--- This line
  },
  // ...
}
```

Or make your config extends `@tsconfig/node22/tsconfig.json`, which sets `skipLibCheck` to true.

Having TypeScript performs type checking on the `node_modules` directory not only slow down compilation, but also exposes you to various compilation errors if your project is not using exactly the same version of the TypeScript compiler as the one the library has been compiled with.

</details>

<details>
<summary><strong>philwhln</strong> commented on 2025-01-22 06:19:39.000 UTC</summary>

@mjameswh Thanks for the response. We do have that set

```
‚ùØ cat tsconfig.json | jq .compilerOptions.skipLibCheck
true
```

Is this compiled under Node 22? We're on Node 20. Not sure if that affects things at all.

</details>

<details>
<summary><strong>philwhln</strong> commented on 2025-01-22 18:06:06.000 UTC</summary>

Also on the latest update `typescript` npm package version

</details>

<details>
<summary><strong>philwhln</strong> commented on 2025-01-22 21:41:37.000 UTC</summary>

Managed to create a patch that fixes these two TypeScript errors

```
‚ùØ cat patches/@temporalio+client+1.11.5.patch
diff --git a/node_modules/@temporalio/client/src/iterators-utils.ts b/node_modules/@temporalio/client/src/iterators-utils.ts
index df86d14..9e66d70 100644
--- a/node_modules/@temporalio/client/src/iterators-utils.ts
+++ b/node_modules/@temporalio/client/src/iterators-utils.ts
@@ -56,13 +56,13 @@ export async function* mapAsyncIterable<A, B>(

   const emitter = new EventEmitter();
   const controller = new AbortController();
-  const emitterEventsIterable: AsyncIterable<[B]> = on(emitter, 'result', { signal: controller.signal });
+  const emitterEventsIterable: AsyncIterable<B[]> = on(emitter, 'result', { signal: controller.signal });
   const emitterError: Promise<unknown[]> = once(emitter, 'error');

   const bufferLimitSemaphore =
     typeof bufferLimit === 'number'
       ? (() => {
-          const releaseEvents: AsyncIterator<void> = toAsyncIterator(
+          const releaseEvents: AsyncIterator<any[]> = toAsyncIterator(
             on(emitter, 'released', { signal: controller.signal })
           );
           let value = bufferLimit + concurrency;
```

But found this is not necessary if TypeScript errors are ignored, which they would have been with `skipLibCheck` if there wasn't some bogus imports ü§¶ 

```
-import { WorkflowExecutionDescription } from "@temporalio/client/src/types";
-import { AsyncWorkflowListIterable } from "@temporalio/client/src/workflow-client";
+import { WorkflowExecutionDescription } from "@temporalio/client";
+import { AsyncWorkflowListIterable } from "@temporalio/client";
```

Reactions: üòÑ 1

</details>


---

<a id="1600"></a>

### #1600: [Feature Request] OTel metrics over HTTP

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1600 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-01-15 13:40:25.000 UTC (11 months ago) |
| **Updated** | 2025-05-28 23:56:54.000 UTC |
| **Closed** | 2025-02-07 23:41:09.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the solution you'd like

Expose ability to have Core OTel metrics use HTTP instead of default gRPC protocol. Would recommend a simple default-false http boolean. See https://github.com/temporalio/sdk-core/issues/820.

#### Comments (2)

<details>
<summary><strong>clintonb</strong> commented on 2025-05-28 23:56:42.000 UTC</summary>

This doesn't actually work. I'm using 1.11.8, and am not seeing the updated type for `OtelCollectorExporter`. If I set `http` to `true` and pass an OTLP-HTTP URL, I get an error:

```
 ERROR temporal_sdk_core::telemetry::otel: Metrics exporter otlp failed with the grpc server returns error (Operation is not implemented or not supported): , detailed error message: fault filter abort
```

Reactions: üëÄ 1

</details>

<details>
<summary><strong>clintonb</strong> commented on 2025-05-28 23:56:52.000 UTC</summary>

cc @mjameswh 

</details>


---

<a id="1509"></a>

### #1509: [Bug] Worker doesn't start in arm64 docker container

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1509 |
| **State** | CLOSED |
| **Author** | gregkonush (Greg Konush) |
| **Created** | 2024-09-07 07:42:15.000 UTC (1y 4m ago) |
| **Updated** | 2024-09-12 18:47:40.000 UTC |
| **Closed** | 2024-09-12 18:47:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to start temporal worker inside arm64 docker image

### Describe the bug

Getting exception likes this during the start of a worker:

```
/app/node_modules/.pnpm/@temporalio+core-bridge@1.11.1/node_modules/@temporalio/core-bridge/index.js:30
  throw err;
  ^

Error: Error relocating /app/node_modules/.pnpm/@temporalio+core-bridge@1.11.1/node_modules/@temporalio/core-bridge/releases/aarch64-unknown-linux-gnu/index.node: __register_atfork: symbol not found
    at Module._extensions..node (node:internal/modules/cjs/loader:1586:18)
    at Module.load (node:internal/modules/cjs/loader:1288:32)
    at Module._load (node:internal/modules/cjs/loader:1104:12)
    at Module.require (node:internal/modules/cjs/loader:1311:19)
    at require (node:internal/modules/helpers:179:18)
    at Object.<anonymous> (/app/node_modules/.pnpm/@temporalio+core-bridge@1.11.1/node_modules/@temporalio/core-bridge/index.js:26:20)
    at Module._compile (node:internal/modules/cjs/loader:1469:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1548:10)
    at Module.load (node:internal/modules/cjs/loader:1288:32)
    at Module._load (node:internal/modules/cjs/loader:1104:12) {
  code: 'ERR_DLOPEN_FAILED'
}

Node.js v20.17.0
```

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (4)

<details>
<summary><strong>arthberman</strong> commented on 2024-09-09 12:54:23.000 UTC</summary>

same here

</details>

<details>
<summary><strong>arthberman</strong> commented on 2024-09-09 12:59:58.000 UTC</summary>

@gregkonush did you found any workaround ?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-09 13:11:11.000 UTC</summary>

Is your Docker image based on Alpine, or another muslc distro? That is [not supported](https://docs.temporal.io/develop/typescript/core-application#run-a-worker-on-docker).

</details>

<details>
<summary><strong>arthberman</strong> commented on 2024-09-09 13:44:41.000 UTC</summary>

Thanks! it was the issue :) just moved to bullseye and it works

Reactions: üëç 1

</details>


---

<a id="1390"></a>

### #1390: [Bug] crypto.getRandomValues not supported

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1390 |
| **State** | CLOSED |
| **Author** | acheong08 (Antonio Cheong) |
| **Created** | 2024-04-08 08:33:14.000 UTC (1y 9m ago) |
| **Updated** | 2024-04-09 07:27:59.000 UTC |
| **Closed** | 2024-04-09 07:24:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Use [uuid](https://www.npmjs.com/package/uuid)

### Describe the bug

```ts
2024-04-08T08:27:14.376Z [WARN] Workflow failed {
  namespace: 'default',
  taskQueue: 'hello-world',
  workflowId: 'my-workflow',
  runId: 'b769edf1-a169-4eaa-9a8b-ab3a397dc162',
  workflowType: 'engine',
  error: Error: crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported
      at rng (/home/acheong/Projects/skand/v2/engine/node_modules/uuid/dist/esm-browser/rng.js:13:0)
      at v4 (/home/acheong/Projects/skand/v2/engine/node_modules/uuid/dist/esm-browser/v4.js:11:52)
      at v4 (/home/acheong/Projects/skand/v2/engine/src/lib/engine.ts:128:19)
      at nanoid (/home/acheong/Projects/skand/v2/engine/src/lib/engine.ts:227:33)
      at executeNodes (/home/acheong/Projects/skand/v2/engine/src/lib/engine.ts:88:32)
      at run (/home/acheong/Projects/skand/v2/engine/src/workflows.ts:28:24)
      at Activator.startWorkflowNextHandler (/home/acheong/Projects/skand/v2/engine/node_modules/@temporalio/workflow/src/internals.ts:410:16)
      at /home/acheong/Projects/skand/v2/engine/node_modules/@temporalio/workflow/src/internals.ts:428:8
      at executeWithLifecycleLogging (/home/acheong/Projects/skand/v2/engine/node_modules/@temporalio/workflow/src/logs.ts:80:12)
      at Activator.startWorkflow (/home/acheong/Projects/skand/v2/engine/node_modules/@temporalio/workflow/src/internals.ts:427:34)
}
```

### Minimal Reproduction

https://github.com/acheong08/temporal-crypto-error/

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: 1.9.3
- Are you using Docker or Kubernetes or building Temporal from source? No

#### Comments (4)

<details>
<summary><strong>mjameswh</strong> commented on 2024-04-09 04:13:26.000 UTC</summary>

By design, UUIDv4 requires a random number generator, and the NPM `uuid` package uses the built-in `crypto` module's `getRandomValues` function for that purpose. But the built-in `crypto` module can't be imported from workflow code because it has non-deterministic behavior.

Workflow code [must be deterministic](https://docs.temporal.io/workflows#deterministic-constraints).

You have two easy options to resolves this:
1. If only care about generating some UUID, uses the `uuid4` function exported by the `@temporalio/workflow` package. That implementation internally uses a replay-safe random number generator.
2. As a more general solution, non-deterministic logic should usually be moved to Activities instead. Activities have no need to be deterministic.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-04-09 04:39:05.000 UTC</summary>

On a side note, I'm a bit puzzled by the fact that the dependency to the `crypto` module didn't get caught by the Workflow Bundler, which would have provided a more suitable error message.

I noticed the presence of a `bun.lockb` file in your repro code. Have you tried running this with Bun? Unfortunately, Node.js is the only supported JS runtime at this moment, and I honestly don't think that compatibility layers provided by alternate JS offerings will be able to reliably execute the Workflow Sandboxing engine at this time.

But if you got some success with this, I'd be interested to know more.

</details>

<details>
<summary><strong>acheong08</strong> commented on 2024-04-09 07:24:28.000 UTC</summary>

> If only care about generating some UUID, uses the uuid4 function exported by the @temporalio/workflow package. That implementation internally uses a replay-safe random number generator.

Makes sense. Thanks

> I noticed the presence of a bun.lockb file in your repro code. Have you tried running this with Bun? Unfortunately, Node.js is the only supported JS runtime at this moment, and I honestly don't think that compatibility layers provided by alternate JS offerings will be able to reliably execute the Workflow Sandboxing engine at this time.

I tend to run bun locally out of habit and it works perfectly fine. I still run node on CI and/or servers.

</details>

<details>
<summary><strong>acheong08</strong> commented on 2024-04-09 07:27:57.000 UTC</summary>

> On a side note, I'm a bit puzzled by the fact that the dependency to the crypto module didn't get caught by the Workflow Bundler, which would have provided a more suitable error message.

That would be helpful indeed.

</details>


---

<a id="1202"></a>

### #1202: [Bug] Type Definition Improvement for `ActivityFunction` Interface

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1202 |
| **State** | CLOSED |
| **Author** | JaredRohe (Jared Rohe) |
| **Created** | 2023-08-13 16:06:09.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-23 14:29:31.000 UTC |
| **Closed** | 2023-08-18 15:43:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I want to use an activity function that does NOT return a promise.   Currently, if I pass the type of a function that is NOT `async` as a type parameter into `proxyActivities` i.e `const {mySyncFunc} =  proxyActivities<typeof mySyncFunc>`, the resulting type of `mySyncFunc` is type `symbol` instead of it's actual function signature type. 

I would like to use `mySyncFunc` as the output of `proxyActivities` without having to type cast, despite the function being synchronous. 

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

When attempting to wrap an activity function with `proxyActivities` the resulting function has type `symbol` if the input function to `proxyActivities` does NOT return a Promise. Typescript warns that `mySyncFunc` is of type `symbol` and therefore may not be callable.  `mySyncFunc` must be type casted before it can be used. 

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction
Simply modify the hello world `greet` function to be synchronous i.e: 
![Screenshot 2023-08-13 at 8 59 39 AM](https://github.com/temporalio/sdk-typescript/assets/8333835/b7dc0088-1d3b-4a17-9550-09005407a8b1)

With this change, you will see the Typescript errors when trying to use the `greet` function after passing it into `proxyActivities`.

![Screenshot 2023-08-13 at 8 59 25 AM](https://github.com/temporalio/sdk-typescript/assets/8333835/abd508a6-9268-4412-b448-6e88befdf10c)


<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->
- OS and processor: M2 Macbook Pro
- Temporal Version: 1.7.0
- Are you using Docker or Kubernetes or building Temporal from source?: Building from source

### Additional context

It is entirely possible that this is not a bug and it is actually desired that all activity functions be asynchronous.  If that is the case, we can happily close this issue! 

However, if it is indeed the case that activity functions can be both asynchronous and synchronous then this change solves the issue:
![Screenshot 2023-08-13 at 8 57 30 AM](https://github.com/temporalio/sdk-typescript/assets/8333835/89c30671-386e-47b0-9fde-f3620f4c8ede)

The change there is just adding `| R` on line 69 of this file:   https://github.com/temporalio/sdk-typescript/blob/main/packages/common/src/interfaces.ts#L69



#### Comments (4)

<details>
<summary><strong>JaredRohe</strong> commented on 2023-08-16 17:54:16.000 UTC</summary>

@mjameswh I think this issue will be very quick to address.  Would you mind taking a look?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-16 22:46:12.000 UTC</summary>

Thanks @JaredRohe!

This is actually by design, thought that's something that we could reconsider if there's a strong use case for explicitly non-async activities.

May I ask why you are bringing this up?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-18 15:43:43.000 UTC</summary>

Closing this ticket since this is not planned.

@JaredRohe I'm still interested to know about your use case for this. We may certainly reconsider if there is a reasonable justification.

</details>

<details>
<summary><strong>JaredRohe</strong> commented on 2023-08-23 14:29:31.000 UTC</summary>

@mjameswh Sorry for the late response!  I do not have a legit use case here. I ran into this in the process of exploring Temporal and building some toy examples.   I think the design as it is is what we want! =) Thanks for looking into this.

Reactions: üëç 1

</details>


---

<a id="1197"></a>

### #1197: [Feature Request] Workflow rollback

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1197 |
| **State** | CLOSED |
| **Author** | burakakca (Burak Ak√ßa) |
| **Created** | 2023-08-10 11:52:35.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-17 04:23:43.000 UTC |
| **Closed** | 2023-08-17 04:23:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

We can persist the workflow events and also there an event history, How about rollback the history of a given step?

When we do that, the workflow gonna act like undo event

#### Comments (4)

<details>
<summary><strong>lorensr</strong> commented on 2023-08-10 14:22:20.000 UTC</summary>

Normally rollback is done via try/catch in your workflow code. Does that meet your use case? 

```ts
const { doFoo, rollbackFoo } = proxyActivities...

try {
  doFoo()
} catch (e) {
  rollbackFoo()
}
```

If you're talking about [reset](https://docs.temporal.io/workflows#reset), you can do that via the CLI:

https://docs.temporal.io/cli/workflow#reset

Are you wanting a programmatic way to do it, like `workflowHandle.reset(eventId)`?

</details>

<details>
<summary><strong>burakakca</strong> commented on 2023-08-13 07:30:01.000 UTC</summary>

It could be good use a programmatic way but I'm not sure what you're talking about, this is like start from beginning right? all you do is erased and you go back to the beginning.

What I'm talking about is getting back to the previous history state so that history can be reverted step by step.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-08-17 04:22:26.000 UTC</summary>

@burakakca from our docs:

> A Reset terminates a [Workflow Execution](https://docs.temporal.io/workflows#workflow-execution), removes the progress in the [Event History](https://docs.temporal.io/workflows#event-history) up to the reset point, and then creates a new Workflow Execution with the same [Workflow Type](https://docs.temporal.io/workflows#workflow-type) and [Id](https://docs.temporal.io/workflows#workflow-id) to continue.

We generally recommend using it as a last resort to recover from specific situations.
It is much more preferable coding and handling rollback in workflow code where you have access to the full execution context.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-08-17 04:23:43.000 UTC</summary>

Closing as there are a couple of existing suggested approaches. Please reopen if you feel like this is unresolved.

</details>


---

<a id="1177"></a>

### #1177: [Feature Request] Forward Core's metrics to TypeScript-land

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1177 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-07-19 19:08:46.000 UTC (2y 5m ago) |
| **Updated** | 2025-02-11 20:41:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Describe the solution you'd like
Core is adding support for exporting metrics to lang (see [Core PR](https://github.com/temporalio/sdk-core/pull/544)). This will allow various customizations to metrics handling, including:

* Exporting additional/custom metrics;
* Filtering out some metrics (to reduce cost, since commercial metrics collectors generally charge per metric);
* Export to metrics collectors that are not supported by Core itself.

This ticket is tracking effort at adding support in TS SDK for accepting and handling metrics from Core SDK. The scope of this ticket does not extend to the development of a metric exporter for any specific metrics collector.

Also see the corresponding .Net feature request [here](https://github.com/temporalio/sdk-dotnet/issues/126).



#### Comments (4)

<details>
<summary><strong>cretz</strong> commented on 2023-07-19 19:10:49.000 UTC</summary>

Until this is also in at least one other core language, I would like to see it marked experimental. I have some ideas about how I think we should expose this lang side (i.e. expose both the ability to impl a custom collector _and_ to emit metrics on the existing one as separate unrelated things), so would like to implement it.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-20 14:32:03.000 UTC</summary>

> Until this is also in at least one other core language, I would like to see it marked experimental.

Yes, definitely

> I have some ideas about how I think we should expose this lang side (i.e. expose both the ability to impl a custom collector and to emit metrics on the existing one as separate unrelated things), so would like to implement it.

No problem, will wait til you're back, so we can discuss details on this.

</details>

<details>
<summary><strong>antmendoza</strong> commented on 2024-02-23 12:32:38.000 UTC</summary>

@mjameswh will this feature, once implemented, allow adding custom tags to Temporal metrics (like workflow id, activity id...) 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-03-04 21:26:36.000 UTC</summary>

> will this feature, once implemented, allow adding custom tags to Temporal metrics (like workflow id, activity id...)

Yes, to some extent. It may not be possible to attach metadata to things that happens inside Core itself.

</details>


---

<a id="1087"></a>

### #1087: [Bug] 'too many filter conditions specified' on reasonable query

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1087 |
| **State** | CLOSED |
| **Author** | jwaaang (Jack Wang) |
| **Created** | 2023-03-30 20:15:31.000 UTC (2y 9m ago) |
| **Updated** | 2023-03-31 04:16:20.000 UTC |
| **Closed** | 2023-03-30 22:38:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to get a list of active workflowIds using temporal client.

### Describe the bug

I am trying to query all executions that are running and have some workflow name, when i run it i get:

```
/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call.ts:81
  const error = new Error(message);
                ^
Error: 2 UNKNOWN: too many filter conditions specified
    at Object.callErrorFromStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call.ts:81:17)
    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client.ts:358:36)
    at /Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call-stream.ts:210:27
    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@temporalio-client-npm-1.6.0-8d36687867-ed8c23c572.zip/node_modules/@temporalio/client/src/grpc-retry.ts:176:17)
    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client-interceptors.ts:462:34)
    at Object.onReceiveStatus (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client-interceptors.ts:424:48)
    at /Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/call-stream.ts:334:24
    at processTicksAndRejections (node:internal/process/task_queues:78:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/jackwang/scaleapi/.yarn/cache/@grpc-grpc-js-npm-1.7.3-367eafd856-cb05aae459.zip/node_modules/@grpc/grpc-js/src/client.ts:328:30)
    at callMethod (/Users/jackwang/scaleapi/.yarn/unplugged/dd-trace-patch-1a35c08d8a/node_modules/dd-trace/packages/datadog-instrumentations/src/grpc/client.js:144:51)
    at ServiceClientImpl.makeUnaryRequest (/Users/jackwang/scaleapi/.yarn/unplugged/dd-trace-patch-1a35c08d8a/node_modules/dd-trace/packages/datadog-instrumentations/src/grpc/client.js:19:14)
    at Service.rpcImpl (/Users/jackwang/scaleapi/.yarn/cache/@temporalio-client-npm-1.6.0-8d36687867-ed8c23c572.zip/node_modules/@temporalio/client/src/connection.ts:341:21)
    at Service.rpcCall (/Users/jackwang/scaleapi/.yarn/unplugged/protobufjs-npm-7.0.0-caea7a2a3b/node_modules/protobufjs/src/rpc/service.js:94:21)
    at executor (/Users/jackwang/scaleapi/.yarn/cache/@protobufjs-aspromise-npm-1.1.2-71d00b938f-011fe7ef08.zip/node_modules/@protobufjs/aspromise/index.js:44:16)
    at new Promise (<anonymous>)
    at Object.asPromise (/Users/jackwang/scaleapi/.yarn/cache/@protobufjs-aspromise-npm-1.1.2-71d00b938f-011fe7ef08.zip/node_modules/@protobufjs/aspromise/index.js:28:12)
    at Service.rpcCall (/Users/jackwang/scaleapi/.yarn/unplugged/protobufjs-npm-7.0.0-caea7a2a3b/node_modules/protobufjs/src/rpc/service.js:86:21)
    at Service.listWorkflowExecutions (eval at Codegen (/Users/jackwang/scaleapi/.yarn/cache/@protobufjs-codegen-npm-2.0.4-36e188bbe6-59240c850b.zip/node_modules/@protobufjs/codegen/index.js:50:33), <anonymous>:4:15)
    at WorkflowClient._list (/Users/jackwang/scaleapi/.yarn/cache/@temporalio-client-npm-1.6.0-8d36687867-ed8c23c572.zip/node_modules/@temporalio/client/src/workflow-client.ts:926:51)
    at _list.next (<anonymous>)
    at /Users/jackwang/scaleapi/packages/task-pipeline/src/scripts/query-open-workflows.ts:23:5
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at async bootstrap (/Users/jackwang/scaleapi/packages/task-pipeline/src/scripts/main.ts:10:5) {
  code: 2,
  details: 'too many filter conditions specified',
  metadata: Metadata {
    internalRepr: Map(1) { 'content-type' => [Array] },
    options: {}
  }
}
```

### Minimal Reproduction
```
  const connection = await Connection.connect({address: TEMPORAL_ADDRESS});
  const count = await connection.workflowService.countWorkflowExecutions({namespace: 'default', query: `WorkflowType="orchestratePipeline" and ExecutionStatus="Running"`});
  console.log(JSON.stringify(count.count));
  let execs;
  const activeExecIds: string[] = [];

  const counter = 0;
  const client = app.get<WorkflowClient>(TEMPORAL_QUEUE_TOKEN);
  for await (const workflow of client.list({
    query: `WorkflowType="orchestratePipeline" and ExecutionStatus="Running"`,
    pageSize: 5,
  })) {
    console.log(workflow);
  }
```
### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version: 1.6.0
- Are you using Docker or Kubernetes or building Temporal from source? Temporal is on kubernetes

### Additional context

Weirdly enough this script (with the same query string) works for me:
```
  const connection = await Connection.connect({address: TEMPORAL_ADDRESS});
  const count = await connection.workflowService.countWorkflowExecutions({namespace: 'default', query: `WorkflowType="orchestratePipeline" and ExecutionStatus="Running"`});
  console.log(JSON.stringify(count.count));
  let execs;
  const activeExecIds: string[] = [];

  const counter = 0;
  do {
    if (counter % 50 === 0) {
      console.log(activeExecIds[activeExecIds.length - 1]);
      console.log(activeExecIds.length);
    }
    execs = await connection.workflowService.listWorkflowExecutions({
      namespace: 'default',
      pageSize: 5,
      query: `WorkflowType="orchestratePipeline" and ExecutionStatus="Running"`,
      nextPageToken: execs ? execs.nextPageToken : null,
    });
    execs.executions.map(exec => {
      if (exec.execution?.workflowId) {
        activeExecIds.push(exec.execution?.workflowId);
      }
    });
  } while(execs && execs.nextPageToken)
  const csvStr = activeExecIds.join("\n");
  fs.writeFileSync(FILE_TO_WRITE_TO, csvStr);
```
but i think i am not using `nextPageToken` correctly since this infinite loops and i get back duplicate workflows. Am also curious to what i am doing wrong here.

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2023-03-30 20:27:42.000 UTC</summary>

Which temporal server version are you using with which persistence option?
It's not an SDK bug, it's a server limitation.

</details>

<details>
<summary><strong>jwaaang</strong> commented on 2023-03-30 22:27:43.000 UTC</summary>

Temporal server version is: 1.17.0
We are using scyllaDB as persistence but it should be functionally the same as cassandra

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-30 22:38:06.000 UTC</summary>

Are you using ElasticSearch for the visibility database?
Cassandra doesn't support enhanced visibility.

Closing because this isn't an SDK issue.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-03-31 04:16:20.000 UTC</summary>

Jack‚Äîthese docs pages might help:

https://docs.temporal.io/visibility

https://docs.temporal.io/cluster-deployment-guide

And feel free to post questions to https://community.temporal.io/c/support/5

On Thu, Mar 30, 2023 at 6:38‚ÄØPM Roey Berman ***@***.***>
wrote:

> Closed #1087 <https://github.com/temporalio/sdk-typescript/issues/1087>
> as not planned.
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/1087#event-8892437222>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AAB5LGADLGXGEQSSUXAMSODW6YDNVANCNFSM6AAAAAAWNYWKJE>
> .
> You are receiving this because you are subscribed to this thread.Message
> ID: ***@***.***
> com>
>


</details>


---

<a id="1076"></a>

### #1076: temporal-client-0.1.0: 1 vulnerabilities (highest severity is: 9.1)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1076 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-03-08 01:06:19.000 UTC (2y 10m ago) |
| **Updated** | 2025-01-28 17:31:04.000 UTC |
| **Closed** | 2025-01-28 17:31:03.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | security vulnerability |
| **Assignees** | Sushisource |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>temporal-client-0.1.0</b></p></summary>

<p></p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (temporal-client version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [WS-2023-0045](https://github.com/XAMPPRocky/remove_dir_all/commit/7247a8b6ee59fc99bbb69ca6b3ca4bfd8c809ead) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.1 | remove_dir_all-0.5.3.crate | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> WS-2023-0045</summary>


###  Vulnerable Library - <b>remove_dir_all-0.5.3.crate</b></p>

<p>A safe, reliable implementation of remove_dir_all for Windows</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/remove_dir_all/0.5.3/download">https://crates.io/api/v1/crates/remove_dir_all/0.5.3/download</a></p>
<p>

Dependency Hierarchy:
  - temporal-client-0.1.0 (Root Library)
    - temporal-sdk-core-protos-0.1.0
      - prost-wkt-types-0.4.0.crate
        - prost-build-0.11.6.crate
          - tempfile-3.3.0.crate
            - :x: **remove_dir_all-0.5.3.crate** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The remove_dir_all crate is a Rust library that offers additional features over the Rust standard library fs::remove_dir_all function. It suffers the same class of failure as the code it was layering over: TOCTOU race conditions, with the ability to cause arbitrary paths to be deleted by substituting a symlink for a path after the type of the path was checked.

<p>Publish Date: 2023-02-24
<p>URL: <a href=https://github.com/XAMPPRocky/remove_dir_all/commit/7247a8b6ee59fc99bbb69ca6b3ca4bfd8c809ead>WS-2023-0045</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.1</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-mc8h-8q98-g5hr">https://github.com/advisories/GHSA-mc8h-8q98-g5hr</a></p>
<p>Release Date: 2023-02-24</p>
<p>Fix Resolution: remove_dir_all - 0.8.0</p>

</p>

<p></p>

</details>

#### Comments (2)

<details>
<summary><strong>krn0x2</strong> commented on 2023-03-09 11:33:44.000 UTC</summary>

Hi Temporal team,

This issue is being flagged in our CI pipeline as a blocker. Would love to get a patch for this. Thanks!

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 17:31:03.000 UTC</summary>

Dependency has been updated a very long time ago.

</details>


---

<a id="1061"></a>

### #1061: [Feature Request] Allow setting default activity options on worker creation 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1061 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-02-20 02:20:18.000 UTC (2y 10m ago) |
| **Updated** | 2025-02-04 18:18:43.000 UTC |
| **Closed** | 2025-02-04 18:18:41.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

Provide a similar mechanism to Java‚Äôs WorkflowImplementationOptions.activityOptions so activities options can be read from config file.

Requires discussion to see how and if at all to add this.

#### Comments (2)

<details>
<summary><strong>silasdavis</strong> commented on 2023-04-28 07:02:46.000 UTC</summary>

I was hoping to find something to do this in the Typescript SDK. It looks like currently the only option for setting `ActivityOptions` is by hard-coding them since there is no way to pass in options by reading environment variables or config files. This makes configuring workflows across different environments irksome.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-02-04 18:18:41.000 UTC</summary>

Closing. Use case is not clear enough. If there's really a need for something like this, it should also includes other types of commands.

</details>


---

<a id="1046"></a>

### #1046: [Bug] `sleep('1 month')` results in UnhandledCommand WFT failure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1046 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-02-01 16:10:07.000 UTC (2y 11m ago) |
| **Updated** | 2023-06-07 21:31:57.000 UTC |
| **Closed** | 2023-06-07 21:31:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Start and cancel a workflow that just calls an activity that sleeps.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

WorkflowTaskFailed with message `UnhandledCommand`

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

https://github.com/lorensr/workflow-statuses/blob/3b1d476fca708a8e1e98a711c9caa94e3da064cc/src/client.ts#L29-L35

![image](https://user-images.githubusercontent.com/251288/216097924-7fc2cb89-5d3b-4c39-a173-bd3f0637ec12.png)


#### Comments (4)

<details>
<summary><strong>lorensr</strong> commented on 2023-02-01 16:30:44.000 UTC</summary>

Issue was `ms('1 month')` returns `undefined`. Maybe we guard at runtime against undefined any place we support `ms` strings?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-02-01 17:22:47.000 UTC</summary>

Can you provide more info?
How do we reproduce this step by step?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-02-01 19:59:11.000 UTC</summary>

```
git clone https://github.com/lorensr/workflow-statuses.git
git checkout 3b1d476fca708a8e1e98a711c9caa94e3da064cc
npm i
npm start
npm run workflow
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-02-01 20:34:54.000 UTC</summary>

> Maybe we guard at runtime against undefined any place we support ms strings?

I'm very surprised that `ms` doesn't throw exception on strings that don't match expected pattern.

We can certainly ensure on our side that if someone actually passes a value, and we then pass that value to `ms`, and `ms` return `undefined`, then we explicitly throw an error on this. We can also be more defensive in places where a value is mandatory, such as `sleep(x)`.

However, in most places where we expect `ms`-like values, that value is optional, so it is impossible for us to catch cases where a user did something like `condition(fn, ms('2 months'))`.

Reactions: üëç 1

</details>


---

<a id="876"></a>

### #876: [Bug] Unable to run tests using Temporal SDK using vitest

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/876 |
| **State** | CLOSED |
| **Author** | danielrearden (Daniel Rearden) |
| **Created** | 2022-09-20 19:27:33.000 UTC (3y 3m ago) |
| **Updated** | 2022-12-13 19:08:01.000 UTC |
| **Closed** | 2022-12-08 22:37:54.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

We are migrating from jest to [vitest](https://vitest.dev/) and hitting a memory error whenever running multiple test files and using multi-threading.

### Describe the bug

* A memory error that causes all subsequent tests to fail
```
RangeError [Error]: WebAssembly.instantiate(): Out of memory: wasm memory
    at node:internal/deps/cjs-module-lexer/dist/lexer:1:33593
Emitted 'error' event on Tinypool instance at:
    at EventEmitterReferencingAsyncResource.runInAsyncScope (node:async_hooks:202:9)
    at Tinypool.emit (file://***Projects/vitest-temporal-issue/node_modules/tinypool/dist/esm/index.js:60:31)
    at Worker.<anonymous> (file://***Projects/vitest-temporal-issue/node_modules/tinypool/dist/esm/index.js:566:30)
    at Worker.emit (node:events:527:28)
    at Worker.[kOnErrorMessage] (node:internal/worker:289:10)
    at Worker.[kOnMessage] (node:internal/worker:300:37)
    at MessagePort.<anonymous> (node:internal/worker:201:57)
    at MessagePort.[nodejs.internal.kHybridDispatch] (node:internal/event_target:643:20)
    at MessagePort.exports.emitMessage (node:internal/per_context/messageport:23:28)
```
* Multiple unhandled rejections returned even when tests seemingly pass
```
Error: A panic occurred while executing a `neon::event::Channel::send` callback
```
* This error that pops up when we drop the number of tests per suite but keep multi-threading on
```
thread '<unnamed>' panicked at 'Attempted to dereference a `neon::handle::Root` from the wrong module ', /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/neon-0.10.1/src/handle/root.rs:168:13
FATAL ERROR: /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/neon-runtime-0.10.1/src/napi/tsfn.rs:191:18 Failed to set an object property
 1: 0x1044742dc node::Abort() [***.nvm/versions/node/v16.15.1/bin/node]
 2: 0x104474464 node::errors::TryCatchScope::~TryCatchScope() [***.nvm/versions/node/v16.15.1/bin/node]
 3: 0x1044742f4 node::OnFatalError(char const*, char const*) [***.nvm/versions/node/v16.15.1/bin/node]
 4: 0x104448cdc napi_open_callback_scope [***.nvm/versions/node/v16.15.1/bin/node]
 5: 0x11601987c neon_runtime::napi::error::fatal_error::h36bb70038ef82b4d [***Projects/vitest-temporal-issue/node_modules/@temporalio/core-bridge/releases/aarch64-apple-darwin/index.node]
 6: 0x116019f6c neon_runtime::napi::no_panic::create_error::h5fc2dfded95b7565 [***Projects/vitest-temporal-issue/node_modules/@temporalio/core-bridge/releases/aarch64-apple-darwin/index.node]
 7: 0x116483670 neon_runtime::napi::tsfn::ThreadsafeFunction$LT$T$GT$::callback::h93e803bb4ad8e14a [***Projects/vitest-temporal-issue/node_modules/@temporalio/core-bridge/releases/aarch64-apple-darwin/index.node]
 8: 0x10444b744 v8impl::(anonymous namespace)::ThreadSafeFunction::AsyncCb(uv_async_s*) [***.nvm/versions/node/v16.15.1/bin/node]
 9: 0x104ce5f00 uv__async_io [***.nvm/versions/node/v16.15.1/bin/node]
10: 0x104cf7c78 uv__io_poll [***.nvm/versions/node/v16.15.1/bin/node]
11: 0x104ce6390 uv_run [***.nvm/versions/node/v16.15.1/bin/node]
12: 0x1043c2ccc node::SpinEventLoop(node::Environment*) [***.nvm/versions/node/v16.15.1/bin/node]
13: 0x1045069e8 node::worker::Worker::Run() [***.nvm/versions/node/v16.15.1/bin/node]
14: 0x104509c10 node::worker::Worker::StartThread(v8::FunctionCallbackInfo<v8::Value> const&)::$_3::__invoke(void*) [***.nvm/versions/node/v16.15.1/bin/node]
15: 0x1a03d426c _pthread_start [/usr/lib/system/libsystem_pthread.dylib]
16: 0x1a03cf08c thread_start [/usr/lib/system/libsystem_pthread.dylib]
```

### Minimal Reproduction

https://github.com/danielrearden/vitest-temporal-issue

### Environment/Versions

- OS and processor: M1 macOS 12.6
- Temporal Version: SDK 1.2.0
- Are you using Docker or Kubernetes or building Temporal from source? Docker

### Additional context

- The same tests run just fine in jest, even with workers enabled (i.e. no --runInBand)
- Disabling multi-threading fixes the issue (but obviously slows down tests to a painful pace)
- Running vitest against tests that do NOT attempt to spin up a Temporal worker causes no issues


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2022-12-08 22:37:54.000 UTC</summary>

Apparently resolved as of 1.5.0 (presumably by #983).

I can no longer reproduce any of the reported errors (there were still present in 1.4.4).

</details>

<details>
<summary><strong>john-griffin</strong> commented on 2022-12-13 19:08:01.000 UTC</summary>

Thanks, can confirm this is fixed! I was able to switch back to vitest.

Reactions: üëç 2

</details>


---

<a id="874"></a>

### #874: [Bug] `test-npm-init` hangs sometimes on Mac

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/874 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-20 02:54:11.000 UTC (3y 3m ago) |
| **Updated** | 2023-12-28 23:22:11.000 UTC |
| **Closed** | 2023-12-28 23:22:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

[test-npm-init (macos-latest, x86_64-apple-darwin, 16, cloud, hello-world-mtls)](https://github.com/temporalio/sdk-typescript/actions/runs/3086473404/jobs/4992010285#logs)

Sometimes the step `Test run a workflow` gets to here and stays running for > 2 hours. Here I manually cancelled:

<img width="1603" alt="image" src="https://user-images.githubusercontent.com/251288/191156913-0ddb1203-6daf-4ea5-81b1-60f1332a76cd.png">

Sometimes the Action succeeds in 9 seconds.

#### Comments (4)

<details>
<summary><strong>josh-berry</strong> commented on 2023-12-26 22:03:23.000 UTC</summary>

Have we seen this recently or should this just be closed?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-12-27 17:59:16.000 UTC</summary>

I haven't been following closely, @mjameswh?

</details>

<details>
<summary><strong>josh-berry</strong> commented on 2023-12-27 19:01:37.000 UTC</summary>

d'oh, was able to answer my own question. I do still see intermittent failures in GHA so we should keep this open.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-28 23:22:11.000 UTC</summary>

>d'oh, was able to answer my own question. I do still see intermittent failures in GHA so we should keep this open.

We are still observing flakes in GHA, but I'm pretty sure we haven't seen this specific one in a very long time. We recently started tracking CI flakes in a private document, to help identify and triage recurring CI issues, and there's no trace of anything similar to this one.

I'm closing it.

</details>


---

<a id="872"></a>

### #872: istanbul-instrumenter-loader-3.0.1.tgz: 1 vulnerabilities (highest severity is: 5.6)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/872 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-09-17 22:20:00.000 UTC (3y 3m ago) |
| **Updated** | 2022-12-16 22:39:27.000 UTC |
| **Closed** | 2022-12-16 22:39:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>istanbul-instrumenter-loader-3.0.1.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /packages/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json,/node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (istanbul-instrumenter-loader version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2020-15366](https://www.mend.io/vulnerability-database/CVE-2020-15366) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.6 | ajv-5.5.2.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2020-15366</summary>


###  Vulnerable Library - <b>ajv-5.5.2.tgz</b></p>

<p>Another JSON Schema Validator</p>
<p>Library home page: <a href="https://registry.npmjs.org/ajv/-/ajv-5.5.2.tgz">https://registry.npmjs.org/ajv/-/ajv-5.5.2.tgz</a></p>
<p>Path to dependency file: /packages/nyc-test-coverage/package.json</p>
<p>Path to vulnerable library: /packages/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json,/node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json</p>
<p>

Dependency Hierarchy:
  - istanbul-instrumenter-loader-3.0.1.tgz (Root Library)
    - schema-utils-0.3.0.tgz
      - :x: **ajv-5.5.2.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
An issue was discovered in ajv.validate() in Ajv (aka Another JSON Schema Validator) 6.12.2. A carefully crafted JSON schema could be provided that allows execution of other code by prototype pollution. (While untrusted schemas are recommended against, the worst case of an untrusted schema should be a denial of service, not execution of code.)

<p>Publish Date: 2020-07-15
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2020-15366>CVE-2020-15366</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.6</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: High
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-07-15</p>
<p>Fix Resolution: ajv - 6.12.3</p>

</p>

<p></p>

</details>

#### Comments (4)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-09-29 03:13:21.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-06 20:34:05.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-19 02:51:32.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-29 00:36:36.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>


---

<a id="806"></a>

### #806: [Bug] Stress test exits

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/806 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-05 18:44:04.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-15 05:38:21.000 UTC |
| **Closed** | 2022-08-15 05:38:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

`Error: Process completed with exit code 124.`

[stress-tests / stress-test](https://github.com/temporalio/sdk-typescript/runs/7696694375?check_suite_focus=true#logs)

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-05 20:18:59.000 UTC</summary>

Did you inspect the logs @lorensr?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-05 20:20:56.000 UTC</summary>

124 looks due to timeout.
I think this is related to #804 where for some reason the worker isn't picking up new tasks.
I'm pretty sure this has to do with the docker compose setup and not with the SDK but haven't had time to look into it.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-08-05 20:29:31.000 UTC</summary>

No. Looks like we lose artifacts when we rerun

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-15 05:38:21.000 UTC</summary>

Looks like this was fixed somehow 

</details>


---

<a id="753"></a>

### #753: [Bug] Flaky test framework segfaults when used with Jest runner

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/753 |
| **State** | CLOSED |
| **Author** | Irvenae (Irven Aelbrecht) |
| **Created** | 2022-07-12 08:05:38.000 UTC (3y 6m ago) |
| **Updated** | 2022-09-09 00:51:55.000 UTC |
| **Closed** | 2022-09-09 00:51:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Run a test in vscode (ideally with breakpoints) using the test framework.

### Describe the bug

The test framework is behaving flaky, sometimes it works (haven't tested the breakpoints), sometimes I get a segfault. This is the trace

PID 79075 received SIGSEGV for address: 0x0
0   segfault-handler.node               0x000000010d15d458 _ZL16segfault_handleriP9__siginfoPv + 272
1   libsystem_platform.dylib            0x00000001b63384e4 _sigtramp + 56
2   node                                0x0000000100611a88 _ZN4node6loaderL23ImportModuleDynamicallyEN2v85LocalINS1_7ContextEEENS2_INS1_14ScriptOrModuleEEENS2_INS1_6StringEEENS2_INS1_10FixedArrayEEE + 236
3   node                                0x00000001008bb67c _ZN2v88internal7Isolate38RunHostImportModuleDynamicallyCallbackENS0_6HandleINS0_6ScriptEEENS2_INS0_6ObjectEEENS0_11MaybeHandleIS5_EE + 248
4   node                                0x0000000100c30e14 _ZN2v88internal25Runtime_DynamicImportCallEiPmPNS0_7IsolateE + 396
5   node                                0x0000000100f40a04 Builtins_CEntry_Return1_DontSaveFPRegs_ArgvInRegister_NoBuiltinExit + 100
6   node                                0x0000000100fcedd8 Builtins_CallRuntimeHandler + 88
7   node                                0x0000000100ed4418 Builtins_InterpreterEntryTrampoline + 248
8   node                                0x0000000100ed4418 Builtins_InterpreterEntryTrampoline + 248
9   node                                0x0000000100ed4418 Builtins_InterpreterEntryTrampoline + 248
10  node                                0x0000000100ed4418 Builtins_InterpreterEntryTrampoline + 248
11  node                                0x0000000100f86e00 Builtins_PromiseConstructor + 2176
12  node                                0x0000000100ed1650 Builtins_JSBuiltinsConstructStub + 368
13  node                                0x0000000100fcf770 Builtins_ConstructHandler + 656
14  node                                0x0000000100ed4418 Builtins_InterpreterEntryTrampoline + 248
15  node                                0x0000000100ed4418 Builtins_InterpreterEntryTrampoline + 248
16  node                                0x0000000100f03a14 Builtins_AsyncFunctionAwaitResolveClosure + 84
17  node                                0x0000000100f888b8 Builtins_PromiseFulfillReactionJob + 56
18  node                                0x0000000100ef5df4 Builtins_RunMicrotasks + 596
19  node                                0x0000000100ed20e4 Builtins_JSRunMicrotasksEntry + 164
20  node                                0x00000001008a3a1c _ZN2v88internal12_GLOBAL__N_16InvokeEPNS0_7IsolateERKNS1_12InvokeParamsE + 2332
21  node                                0x00000001008a3e50 _ZN2v88internal12_GLOBAL__N_118InvokeWithTryCatchEPNS0_7IsolateERKNS1_12InvokeParamsE + 88
22  node                                0x00000001008a3f3c _ZN2v88internal9Execution16TryRunMicrotasksEPNS0_7IsolateEPNS0_14MicrotaskQueueEPNS0_11MaybeHandleINS0_6ObjectEEE + 64
23  node                                0x00000001008c6b78 _ZN2v88internal14MicrotaskQueue13RunMicrotasksEPNS0_7IsolateE + 336
24  node                                0x00000001008c740c _ZN2v88internal14MicrotaskQueue17PerformCheckpointEPNS_7IsolateE + 124
25  node                                0x0000000100591db4 _ZN4node21InternalCallbackScope5CloseEv + 388
26  node                                0x000000010059248c _ZN4node20InternalMakeCallbackEPNS_11EnvironmentEN2v85LocalINS2_6ObjectEEES5_NS3_INS2_8FunctionEEEiPNS3_INS2_5ValueEEENS_13async_contextE + 548
27  node                                0x00000001005a74c8 _ZN4node9AsyncWrap12MakeCallbackEN2v85LocalINS1_8FunctionEEEiPNS2_INS1_5ValueEEE + 204
28  node                                0x00000001006485c4 _ZN4node2fs13FSReqCallback7ResolveEN2v85LocalINS2_5ValueEEE + 220
29  node                                0x0000000100648d88 _ZN4node2fs9AfterStatEP7uv_fs_s + 72
30  node                                0x0000000100eb2794 uv__work_done + 192
31  node                                0x0000000100eb5f30 uv__async_io + 320
[1]    79075 segmentation fault  /usr/bin/env   /Users/irvenaelbrecht/.nvm/versions/node/v16.15.0/bin/node

### Minimal Reproduction

Run "yarn test" in https://github.com/Irvenae/ts-temporal. (You don't need to start the cluster as the test is using the test framework). You might need to rerun a couple of times to get the issue. 

The test is found under src/__tests__/helloTestFramework.test.ts. It runs the greet example using Jest. I also needed to add `--experimental-vm-modules` to the node command to be able to run the test with the framework.

### Environment/Versions

I encountered this on a Mac M1. But I tested it before (on an older version of the temporal SDK) on Ubuntu 18.04 with the same results.
I am using typescript SDK v1.0.0-rc.1



#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-12 11:29:21.000 UTC</summary>

Thanks for reporting.
According to the trace this doesn't look like an issue with the test server itself, it looks like some issue with jest with the SDK.
This is probably the 4th jest related issue we've gotten.

Can you try to run the tests with a different runner and see if this still happens?
I'm also wondering if it's related to `replay.test.ts` which starts a worker in debug mode which creates vm contexts in the main nodejs thread.


</details>

<details>
<summary><strong>Irvenae</strong> commented on 2022-07-12 11:40:24.000 UTC</summary>

All tests should be disabled outside of `helloTestFramework.test.ts` (by doing xdescribe).

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2022-07-12 11:58:30.000 UTC</summary>

I have checked with Mocha and this does indeed work consistently.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-09 00:51:55.000 UTC</summary>

This should be fixed since we downgraded get-port to the non ESM version.
Please open if you think otherwise.

</details>


---

<a id="729"></a>

### #729: [Bug] Missing code coverage in TestWorkflowEnvironment

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/729 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2022-06-27 20:52:08.000 UTC (3y 6m ago) |
| **Updated** | 2022-09-16 21:56:30.000 UTC |
| **Closed** | 2022-09-16 21:56:29.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 üëÄ 1 |

#### Description

### What are you really trying to do?

Observe code coverage of workflow unit tests.

### Describe the bug

All of the workflow lines are reported as being Uncovered even though many are covered by tests.

### Minimal Reproduction

```bash
git checkout https://github.com/temporalio/temporal-pendulum
cd position-node
nvm use
npm i
npm t
```

Note: Because of #728 you may need to run tests twice.

Observe that all of the workflow lines (29-56) are reported as Uncovered even though two signals and a query are tested.

![pass](https://user-images.githubusercontent.com/28679/176032829-d7e1d7be-1f56-4547-9aca-d7cc6312db32.png)

### Environment/Versions

M1 Mac
@temporal/testing 1.0.0-rc.0
Node 16.15.1

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-28 01:17:17.000 UTC</summary>

Thanks for reporting.
This is probably going to be tricky with the way workflow code executes in the sandbox

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-16 21:56:29.000 UTC</summary>

Closing since we now have the `@temporalio/nyc-test-coverage` package.

</details>


---

<a id="649"></a>

### #649: Memory leak on the temporal worker side

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/649 |
| **State** | CLOSED |
| **Author** | viavdeyenk-mts |
| **Created** | 2022-05-11 09:15:57.000 UTC (3y 8m ago) |
| **Updated** | 2024-10-07 20:35:19.000 UTC |
| **Closed** | 2022-05-16 23:28:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Description

Some times ago we began using the temporal SDK in our microservice product, but after some times we detected that temporal-worker containers are killed by "out of memory" reason. Then we started our investigation and found the potential leak problem: a lot of 'OperatorSubscriber' objects create on temporal-worker side,  but it never clean, and it make memory leak problem. Right now it's  just a theory, but we hope that you can help us with checking it.


## Expected Behavior

We are not detecting memory leak

## Actual Behavior

We are detecting memory leak

## Steps to Reproduce the Problem

1. Run and inspect the temporal worker (e.g. `node --inspect src/worker.js`)
2. Start expect the worker process via chrome devtools
3. Execute the temporal client in infinity loop (for generate persistent loading for worker)
4. A little while later intervals via chrome devtools take memory snapshots from the worker process
5. Compare last memory snapshot with preview: there are a lot of `OperatorSubscriber` objects between the snapshots, so we can make the conclusion, that temporal typescript SDK has a memory leak
  ![memory-leak-detection.png](https://raw.githubusercontent.com/viavdeyenk-mts/temporal-tssdk-demo-memory-leak/main/img/08-memory-leak-detection.png)

## Specifications

  - Version: 0.22.0
  - Platform: x86_64 GNU/Linux (distr: Ubuntu:20.04, core: 5.14)

-------------------------------------

## Help with reproduce

For comfort reproduce, we created [the separate repository](https://github.com/viavdeyenk-mts/temporal-tssdk-demo-memory-leak) for help and  describe the steps for representation the leak problem. 

 

#### Comments (4)

<details>
<summary><strong>HalfdanJ</strong> commented on 2024-06-13 12:33:09.000 UTC</summary>

Stumbled into this issue since i've been hunting a memory leak in our temporal worker, and ran into an identical situation as the screenshot above (with the latest version of temporal sdk installed). 

<img width="1251" alt="image" src="https://github.com/temporalio/sdk-typescript/assets/227529/9a0a1527-80b0-4133-932a-6af5fbcddf17">


</details>

<details>
<summary><strong>jainshivsagar</strong> commented on 2024-10-07 06:27:04.000 UTC</summary>

I am also facing the same memory leak issue. 
@bergundy Please help here & assist your help.

![image](https://github.com/user-attachments/assets/a460cac9-816b-4eff-a62a-ddba6309c7b5)


</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-10-07 20:21:59.000 UTC</summary>

I'll defer to @mjameswh, the current SDK maintainer.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-10-07 20:32:40.000 UTC</summary>

@jainshivsagar Please open a new ticket.

Even though the symptoms might be the same, this is very unlikely to be the same case:
- The issue from May 2022 was an actual bug in the SDK, which was resolved back then.
- The message from June 2024 was due to incorrect cleanup of an `AsyncLocalStorage` in user code; that resulted in [this ticket](https://github.com/temporalio/sdk-typescript/issues/1432).

</details>


---

<a id="637"></a>

### #637: [Bug] Fix non-TemporalFailure type

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/637 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-05 22:56:41.000 UTC (3y 8m ago) |
| **Updated** | 2022-06-16 20:50:20.000 UTC |
| **Closed** | 2022-06-16 20:50:20.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |
| **Reactions** | üëç 1 |

#### Description



### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

We say that we set a failure's `type` [to the exception full type name when it doesn't extend TemporalFailure](https://typescript.temporal.io/api/classes/common.applicationfailure). However, `throw new MyFailure()`, where `MyFailure extends Error`, results in `type: 'Error'`:

<img width="523" alt="image" src="https://user-images.githubusercontent.com/251288/167039331-7adb7af3-b32c-4a6e-8391-2a3661b81867.png">

It should be `type: 'MyFailure'`


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 23:19:26.000 UTC</summary>

We could take `err.__proto__.constructor.name`

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 23:25:50.000 UTC</summary>

Here:
https://github.com/temporalio/sdk-typescript/blob/f03d2aa595a5a6bbc5e8e46d0eb9ef1f32349ce8/packages/common/src/failure.ts#L360

</details>


---

<a id="586"></a>

### #586: [Bug] Parent workflow doesn't fail when child workflow encounters WorkflowExecutionAlreadyStartedError

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/586 |
| **State** | CLOSED |
| **Author** | dutabado (benjamin bradley) |
| **Created** | 2022-04-13 19:09:15.000 UTC (3y 9m ago) |
| **Updated** | 2023-03-02 16:23:19.000 UTC |
| **Closed** | 2023-03-02 16:23:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Ensure workflows properly exit and don't stay in the Running state indefinitely.

### Describe the bug

If a workflow, `ParentWorkflow` attempts to execute a `ChildWorkflow`, but uses the same workflow ID as an already executing instance of `ChildWorkflow`, the 2nd instance will fail as expected with `WorkflowExecutionAlreadyStartedError`. However, the `ParentWorkflow` instance that attempted to spawn the 2nd child workflow remains in the `Running` state indefinitely and never exits. Even if the first instance of `ChildWorkflow` completes, and the workflow is restarted, it remains stuck in Running.

### Minimal Reproduction

```typescript
import { sleep, executeChild } from '@temporalio/workflow';

export async function parentWorkflow(): Promise<string> {
  return await executeChild('childWorkflow', { 
    workflowId: 'childWorkflowId', // <-- intentionally static
  }
}

export async function childWorkflow(): Promise<void> {
  sleep(60000);
}
```

Launch two workflows concurrently
```bash
tctl workflow start --workflow_type parentWorkflow
tctl workflow start --workflow_type parentWorkflow
```

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac running Monterray 12.2.1
- Temporal Version: Typescript SDK 0.19.2
- Are you using Docker or Kubernetes or building Temporal from source? Docker



#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-04-13 19:31:00.000 UTC</summary>

Thanks @dutabado we'll fix this soon

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-04-13 20:18:08.000 UTC</summary>

## Failing Task vs Execution

Normally when errors are thrown from Workflows, they fail the Task, so that the dev can either:

1. notice a logic bug and update the code, and existing Workflows will advance
2. figure out that they want the Execution to fail, and update the code to instead throw a `TemporalFailure`

We could make `WorkflowExecutionAlreadyStartedError` fail the Execution by extending `TemporalFailure` instead of `Error`, but I'm inclined to leave it as `Error`, so that they can go through the normal flow, as it might be a fixable logic bug.

## When should Worker give up on starting tasks

Normally core stops starting tasks after the first task failure, like:

```ts
export async function parentWorkflow(): Promise<string> {
  throw new Error('This is an error');
}
```

<img width="1228" alt="image" src="https://user-images.githubusercontent.com/251288/163261433-97caa7fc-998c-46df-a9d1-4608aec8552d.png">

But in this case (error thrown from `executeChild`), it stops after two:

<img width="1687" alt="image" src="https://user-images.githubusercontent.com/251288/163260893-23f1c5fa-880f-4f29-a79c-d9ca4964d0a8.png">

Why is that?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-13 21:52:15.000 UTC</summary>

@lorensr according to @mfateev `WorkflowExecutionAlreadyStartedError` should extend `TemporalFailure` and fail the workflow.
That's why this issue was created in the first place.

</details>

<details>
<summary><strong>tsurdilo</strong> commented on 2023-03-01 15:41:54.000 UTC</summary>

Agreed, it should fail the workflow and not the workflow task.

</details>


---

<a id="582"></a>

### #582: [Feature Request] Add more detailed error/stack to TransportError errors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/582 |
| **State** | CLOSED |
| **Author** | rcarton (R√©mi Carton) |
| **Created** | 2022-04-11 21:13:25.000 UTC (3y 9m ago) |
| **Updated** | 2022-07-14 22:16:03.000 UTC |
| **Closed** | 2022-07-14 22:16:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

It's hard to troubleshoot `TransportError`s because they can be associated with any kind of problems when establishing a connection to a Temporal cluster. 

Would it be possible to surface lower level information? To help the user troubleshoot what may have caused the error.

Eventually this was my problem: https://docs.temporal.io/docs/typescript/production-deploy/#install-ca-certificates-for-tls-transport


#### Comments (4)

<details>
<summary><strong>lorensr</strong> commented on 2022-04-12 05:02:22.000 UTC</summary>

Great idea, thanks!

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-04-12 05:32:58.000 UTC</summary>

Hah, look what I just ran into üòÜ

<img width="583" alt="image" src="https://user-images.githubusercontent.com/251288/162887533-a1b4c5b7-6a4d-48b6-a32a-dda071acc65b.png">


</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-04-14 05:19:38.000 UTC</summary>

Error object wasn't very helpful!

<img width="431" alt="image" src="https://user-images.githubusercontent.com/251288/162888882-977c11ad-ed7d-4aec-b484-3b9a7257cdab.png">

<img width="584" alt="image" src="https://user-images.githubusercontent.com/251288/162888893-92b5a1a1-114b-4950-a1ff-f234b40686f7.png">

In addition to the slim ca-certificates issue linked in OP, I got TransportError in other circumstances. I think when I had the wrong remote Server address, wrong long Server address (default `localhost:7233` doesn't work‚Äîneed `host.docker.internal:7233`) or when I had wrong or absent certs.

Reactions: üòÑ 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 22:16:02.000 UTC</summary>

This was done already

</details>


---

<a id="564"></a>

### #564: [Bug] Heartbeat details should be array?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/564 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-28 16:30:09.000 UTC (3y 9m ago) |
| **Updated** | 2022-03-29 20:33:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

In an Activity, `Context.heartbeat()` takes a single param:

https://typescript.temporal.io/api/classes/activity.Context#heartbeat

which is converted to a single Payload:

![image](https://user-images.githubusercontent.com/251288/160444135-a2d8f519-5632-4145-aa6f-c3d3070f2482.png)

But it looks like it should be an array of Payloads:

![image](https://user-images.githubusercontent.com/251288/160444171-799f67e3-ac9b-4ebe-a749-607470b5d48a.png)

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-28 16:52:52.000 UTC</summary>

I think this is the same as in Java / Go:
- https://www.javadoc.io/doc/io.temporal/temporal-sdk/latest/io/temporal/activity/ActivityExecutionContext.html
- https://pkg.go.dev/go.temporal.io/sdk@v1.14.0/activity

@cretz I saw that you made this a list in Python, I think that's the only SDK where we do that. Maybe we should stick to single arg.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-03-28 16:56:24.000 UTC</summary>

@bergundy - Go does support varargs for this which is an array. Also, Core explicitly makes `coresdk.ActivityHeartbeat.details` a `repeated`. I think if we do want to limit to just one, we should do it in Core too. But I am not convinced we do want that. Also note how `coresdk.activity_task.Start.heartbeat_details` has multiple as well.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-29 20:33:00.000 UTC</summary>

This is where a spec for our SDKs would shine.
I copied the Java implementation when working on TS and I'm assuming @cretz copied Go which is why we ended up with different APIs.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-29 20:33:40.000 UTC</summary>

I'd be fine with either approach but I prefer consistency across the SDKs.

</details>


---

<a id="561"></a>

### #561: [Docs] Versionize documentation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/561 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-25 19:00:52.000 UTC (3y 9m ago) |
| **Updated** | 2022-11-23 22:39:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | documentation |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Relevant both for docs and API reference. And latest version of API ref could be deployed from `release` branch instead of `main` so that it's not ahead of what's published on npm.

![image](https://user-images.githubusercontent.com/251288/160184861-b07a65e7-6147-4142-b201-6dd9f08dd4ce.png)



#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-03-25 19:44:53.000 UTC</summary>

Yes please

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-03-28 15:08:37.000 UTC</summary>

Tangentially related (feel free to ignore) - a high-level set of release notes may also be reasonable (I know there's a lower-level `CHANGELOG.md`). Or if we start using GH "releases" instead of just tags, that is a place they could be stored too.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-28 16:19:32.000 UTC</summary>

We add high level release notes to `CHANGLOG.md`.
We might want to do GH releases, I know lerna support that.

Reactions: üëç 1

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-09-07 17:55:51.000 UTC</summary>

Current alternative is to build and view locally:

```
git clone https://github.com/temporalio/sdk-typescript.git
cd sdk-typescript
git checkout v0.16.4
git submodule update --init --recursive
npm ci
npm run build
cd packages/docs
npm start
```

</details>


---

<a id="552"></a>

### #552: [Bug] Windows test exists with code 1 without failures

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/552 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-21 16:11:17.000 UTC (3y 9m ago) |
| **Updated** | 2022-10-12 04:48:04.000 UTC |
| **Closed** | 2022-10-12 04:48:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Sometimes on Windows this happens, where no tests fail, but exit code is 1:

[build-and-test (16, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5630121517?check_suite_focus=true#logs)

The only thing in the output that looks bad is this error, but it's intentional, and the test that causes it succeeds.

![image](https://user-images.githubusercontent.com/251288/159302964-781d3699-a27b-4442-b7fe-4d9cd803e5be.png)


#### Comments (4)

<details>
<summary><strong>lorensr</strong> commented on 2022-03-21 17:57:25.000 UTC</summary>

The next time it ran, it succeeded:

[build-and-test (16, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5630419601?check_suite_focus=true#logs)

but with 111 tests (vs the failing one had 110 tests). I sorted lines & diffed and the failing one is missing the line:

```
@temporalio/test:   ‚àö replay ¬ª cancel-fake-progress-replay (3s)
```

![image](https://user-images.githubusercontent.com/251288/159334751-b08aa7b4-50cf-45bc-bb53-00594711d970.png)

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-21 19:15:33.000 UTC</summary>

passing output:

```
@temporalio/test:   ‚úî replay ‚Ä∫ cancel-fake-progress-replay-nondeterministic (2.2s)
@temporalio/test: 2022-03-21T18:47:44.678Z [WARN] [temporal_sdk_core::worker] Failing workflow activation run_id="a7e68cfc-0287-48dd-b86a-866caf5c9a73" failure=Failure { failure: Some(Failure { message: "WorkflowUpdateError { source: Nondeterminism(\"No command scheduled for event HistoryEvent(id: 10, Some(ActivityTaskCancelRequested))\"), run_id: \"a7e68cfc-0287-48dd-b86a-866caf5c9a73\" }", source: "", stack_trace: "", cause: None, failure_info: Some(ApplicationFailureInfo(ApplicationFailureInfo { r#type: "", non_retryable: false, details: None })) }) }
```

failing output:

```
@temporalio/test:   √ó Timed out while running tests
@temporalio/test:   1 tests were pending in lib\test-replay.js
@temporalio/test:   ( ) replay ¬ª cancel-fake-progress-replay-nondeterministic
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:37:44.000 UTC</summary>

I haven't see this in a long time, I think it's fixed.
@lorensr?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-10-12 04:48:04.000 UTC</summary>

Haven't seen either

</details>


---

<a id="482"></a>

### #482: [Feature Request] Wrap `WorkflowHandle.describe` output in a JS friendly object

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/482 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2022-02-16 12:50:16.000 UTC (3y 10m ago) |
| **Updated** | 2022-03-12 17:13:06.000 UTC |
| **Closed** | 2022-03-12 17:13:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

![image](https://user-images.githubusercontent.com/6764957/154268047-326d3ca7-6afa-4975-84e2-aa3292c3605b.png)

![image](https://user-images.githubusercontent.com/6764957/154268147-37913d37-826e-4705-959c-4738f1ea4339.png)

![image](https://user-images.githubusercontent.com/6764957/154268222-1fe252f3-f37e-4b3f-acd0-dea6c9fb6e9f.png)

https://github.com/protobufjs/protobuf.js/pull/1258


### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (4)

<details>
<summary><strong>lorensr</strong> commented on 2022-02-16 16:36:00.000 UTC</summary>

The toObject at bottom looks promising: https://github.com/protobufjs/protobuf.js/pull/1258#issuecomment-953476331

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-16 17:20:52.000 UTC</summary>

We're going to wrap the output of `describe` in a JS friendly object instead of returning the raw grpc response.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-16 17:21:43.000 UTC</summary>

We've recently done this in Java and Python.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-02-16 19:13:55.000 UTC</summary>

Related: https://github.com/temporalio/sdk-features/issues/17

</details>


---

<a id="472"></a>

### #472: [Feature Request] eslint plugin

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/472 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-09 16:40:07.000 UTC (3y 11m ago) |
| **Updated** | 2023-02-17 23:06:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Mainly for catching some determinism things at compile time in workflow code, but perhaps there are other things we can do as well.

> [Shawn Wang](https://app.slack.com/team/U01BN84PSAH)  [2 hours ago](https://temporalio.slack.com/archives/C01DKSMU94L/p1644417307277569?thread_ts=1644257836.129169&cid=C01DKSMU94L)
we will probably make an eslint rule eventually but ultimately we are limited by what we can do with static analysis - cant query a module to see if it uses one of the banned Node globals. better to throw a helpful error.

`src/workflows/.eslintrc.json`

```json
{
    "plugins": [
        "@temporalio",   // @temporalio/eslint-plugin
    ],
    "extends": [
        "plugin:@temporalio/recommended"
    ],
}
```

#### Comments (4)

<details>
<summary><strong>Sushisource</strong> commented on 2022-02-09 17:52:36.000 UTC</summary>

Another option is to use https://semgrep.dev/ which would allows us to centralize on one tool for many langauges rather than something specific per language.

That said I can see an argument for avoiding having users install something else. But, if it's automated/reliable then we might go that direction to reduce the maintenance load.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-23 21:24:24.000 UTC</summary>

Currently we recommend `no-restricted-imports`: https://github.com/temporalio/samples-typescript/blob/b3a106c27086b8db7612016ba681939de221fa3f/hello-world/.eslintrc.js#L41

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-08-15 14:39:34.000 UTC</summary>

An eslint plugin could also check for async code inside signal handlers. They are risky.

One thing though... A single project generally contains both workflow code and activity code. A temporal eslint plugin would need some way to determine what is workflow code and what isn't. The example eslint config does it by explicitly naming workflow files, but that strategy might be more difficult to apply to user projects.

</details>

<details>
<summary><strong>tommyk</strong> commented on 2023-02-17 23:06:30.000 UTC</summary>

catching `throw Error('...');` in workflows would be an awesome add as well.  i was about to start writing a custom rule for that and figured i would check the issues if this was created already and found this.   



Reactions: üëç 1

</details>


---

<a id="469"></a>

### #469: [Bug] Allow registerErrors to be called multiple times

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/469 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-07 21:44:28.000 UTC (3y 11m ago) |
| **Updated** | 2022-02-11 22:36:23.000 UTC |
| **Closed** | 2022-02-11 22:36:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Support users who run TS SDK worker code multiple times.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

When `native.registerErrors(errors)` is run a second time, you get this error:

```
thread '<unnamed>' panicked at 'Must call `into_inner` or `drop` on `Root` https://docs.rs/neon/latest/neon/sync/index.html#drop-safety', /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/neon-0.8.3/src/handle/root.rs:182:13
stack backtrace:
   0:        0x113d2bd14 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h8483effd3e9ec544
   1:        0x113d45c0c - core::fmt::write::ha34752bcd39bca36
   2:        0x113d26304 - std::io::Write::write_fmt::hfc57a6e48a9ddae2
   3:        0x113d2d474 - std::panicking::default_hook::{{closure}}::he9aaba83dd453f35
   4:        0x113d2d054 - std::panicking::default_hook::hc87ff103cfd8260f
   5:        0x113d2dab4 - std::panicking::rust_panic_with_hook::hf890018b6cf19ef5
   6:        0x1135eb4bc - std::panicking::begin_panic::{{closure}}::hc28ceab4bf363482
   7:        0x1135eae34 - std::sys_common::backtrace::__rust_end_short_backtrace::h28965f507c5b3b3b
   8:        0x113d4df90 - std::panicking::begin_panic::hd003aa45410d163b
   9:        0x113666e88 - <neon::handle::root::Root<T> as core::ops::drop::Drop>::drop::h24d3c7b78d11aee1
  10:        0x11363f788 - temporal_sdk_typescript_bridge::errors::register_errors::h43400655bb40e232
  11:        0x1136d237c - neon::context::internal::Scope<R>::with::hf709c02593da6b84
  12:        0x11360845c - <neon::types::internal::FunctionCallback<T> as neon::types::internal::Callback<*mut neon_runtime::napi::bindings::types::Value__>>::invoke::he86aaaa185b14e07
Warning: neon::sync::Root leaked during a panic
 FAIL  tests/sequential/queues/addCronJob/producer.test.ts
  ‚óè Test suite failed to run

    internal error in Neon module: Must call `into_inner` or `drop` on `Root` https://docs.rs/neon/latest/neon/sync/index.html#drop-safety

      at Object.<anonymous> (../../node_modules/@temporalio/worker/src/worker.ts:64:8)
      at Object.<anonymous> (../../node_modules/@temporalio/worker/src/index.ts:11:1)
```

Coming from: https://github.com/temporalio/sdk-typescript/blob/2232465a4f9b0cade28f0c21c2d7856053678728/packages/worker/src/worker.ts#L64

### Minimal Reproduction

Can make, lmk if helpful.

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

`@temporalio/worker@0.17.2`


### Additional context

<!-- Add any other context about the problem here. -->

Reported by user: https://temporalio.slack.com/archives/C01DKSMU94L/p1644200062345539

#### Comments (4)

<details>
<summary><strong>Sushisource</strong> commented on 2022-02-07 21:46:47.000 UTC</summary>

Moved to TS SDK - this is a bug in the bridge (or higher, depending on your opinion), but not Core.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-07 22:00:56.000 UTC</summary>

Ah, I see, thanks. 

https://github.com/temporalio/sdk-typescript/blob/2232465a4f9b0cade28f0c21c2d7856053678728/packages/core-bridge/src/errors.rs#L64-L92


</details>

<details>
<summary><strong>Sushisource</strong> commented on 2022-02-07 23:57:09.000 UTC</summary>

@lorensr Yup. That function should probably just use a `OnceCell<bool>` to lift the restriction it imposes on callers, and just do nothing if initialization has already occurred.

</details>

<details>
<summary><strong>SamSokolin</strong> commented on 2022-02-08 00:52:15.000 UTC</summary>

Just want to leave a bit more detail on the specific use case triggering this issue. We have a "Module A" which depends on "@temporalio/worker" and a "Module B" which depends on "Module A". We have integration tests for "Module A" written using the Jest framework. In these integration tests, we would like to mock some (but not all) of the functions implemented in "Module B". Jest allows you to do this using the `requireActual` function:
https://jestjs.io/docs/jest-object#jestrequireactualmodulename

This function resolves the original module, and then also implements mocks for any specified functions. Since we want to mock "Module B"  differently for each suite of tests defined across our multiple Jest test files, we need to call `jest.mock` and `requireActual` multiple times.

</details>


---

<a id="462"></a>

### #462: [Bug] Put more info into workflow activation failures

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/462 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-02 19:20:20.000 UTC (3y 11m ago) |
| **Updated** | 2022-07-29 21:24:14.000 UTC |
| **Closed** | 2022-07-29 21:24:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Problem

Currently, an Error thrown from a workflow results in this Worker output (& Web history):

```ts
throw new Error('error in workflow');
// Failing workflow activation...
// { message: "Error: error in workflow", source: "TypeScriptSDK", stack_trace: "", cause: None, failure_info: None }
```

And throwing an object results in:

```ts
throw { field: 'data' };
// Failing workflow activation...
// { message: "[object Object]", source: "TypeScriptSDK", stack_trace: "", cause: None, failure_info: None }
```

## Solution

### Correct

- `failure_info`: Should be None in Error case. Use [subclass of `TemporalFailure`](https://docs.temporal.io/docs/typescript/handling-failure/#failure-classes-reference) to get this filled in.

### Change

- `message`: If thrown object isn't an Error, set `message = JSON.stringify(object)`. 
- `stack_trace`: Fill it in when Error is thrown (currently only filled in when `instanceof TemporalFailure`). When non-Error is thrown, log warning saying "we recommend throwing Errors so that you can see the stack trace".
- `cause`: When thrown error has a `cause` property, put a `Failure` here (currently only works when provided to constructor of `TemporalFailure` etc)
- `source`: Maybe be more specific, like `TypeScriptSDK > Worker > myWorkflowName`

## Related

@Sushisource We can't do anything about `throw new Error(object)`, since Node calls `toString()` on it before we get it:

![image](https://user-images.githubusercontent.com/251288/152221258-deac6db5-9ecf-4052-bf48-05a20b18ebba.png)

![image](https://user-images.githubusercontent.com/251288/152221306-24afdf58-b090-4100-a928-74d422eb3ac6.png)


#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-09 00:37:26.000 UTC</summary>

@lorensr is this still relevant?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-07-11 17:37:23.000 UTC</summary>

Yes. The first 3 bullets are fixed, but not the fourth:

- `source`: Maybe be more specific, like `TypeScriptSDK > Worker > myWorkflowName`

I guess if source is never Client, we can take out `Worker`. But could still differentiate between source being a Workflow, Activity, or other categories? Data converters?

--- 

Fixed: 

Now throwing an Error results in:

```
{
  "message": "error in workflow",
  "source": "TypeScriptSDK",
  "stackTrace": "Error: error in workflow\n    at example (/Users/me/gh/samples-typescript/hello-world/src/workflows.ts:12:8)\n    at Activator.startWorkflowNextHandler (/Users/me/gh/samples-typescript/src/internals.ts:88:16)\n    at Activator.startWorkflow (/Users/me/gh/samples-typescript/src/internals.ts:113:6)\n    at /Users/me/gh/samples-typescript/src/worker-interface.ts:219:35\n    at Object.activate (/Users/me/gh/samples-typescript/src/worker-interface.ts:223:2)\n    at evalmachine.<anonymous>:1:18",
  "cause": null
}
```

and throwing an object results in:

```
{
  "message": "{\"field\":\"data\"} [A non-Error value was thrown from your code. We recommend throwing Error objects so that we can provide a stack trace]",
  "source": "TypeScriptSDK",
  "stackTrace": "",
  "cause": null
}
```

and an Error with an Error `.cause`:

```
{
  "message": "error in workflow",
  "source": "TypeScriptSDK",
  "stackTrace": "Error: error in workflow\n    at example (/Users/me/gh/samples-typescript/hello-world/src/workflows.ts:12:17)\n    at Activator.startWorkflowNextHandler (/Users/me/gh/samples-typescript/src/internals.ts:88:16)\n    at Activator.startWorkflow (/Users/me/gh/samples-typescript/src/internals.ts:113:6)\n    at /Users/me/gh/samples-typescript/src/worker-interface.ts:219:35\n    at Object.activate (/Users/me/gh/samples-typescript/src/worker-interface.ts:223:2)\n    at evalmachine.<anonymous>:1:18",
  "cause": {
    "message": "cause error",
    "source": "TypeScriptSDK",
    "stackTrace": "Error: cause error\n    at example (/Users/me/gh/samples-typescript/hello-world/src/workflows.ts:13:12)\n    at Activator.startWorkflowNextHandler (/Users/me/gh/samples-typescript/src/internals.ts:88:16)\n    at Activator.startWorkflow (/Users/me/gh/samples-typescript/src/internals.ts:113:6)\n    at /Users/me/gh/samples-typescript/src/worker-interface.ts:219:35\n    at Object.activate (/Users/me/gh/samples-typescript/src/worker-interface.ts:223:2)\n    at evalmachine.<anonymous>:1:18",
    "cause": null
  }
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-11 19:31:08.000 UTC</summary>

Hmm.. we could add more info in the source field, I didn't put too much thought into it and just copied from Java.
Nothing in the system looks into the source field AFAIK.
I would say it isn't worth the complication though.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-29 21:24:14.000 UTC</summary>

@lorensr I prefer closing this, at this point changing the source field would be a breaking change, since this field is checked when parsing stack traces, and I don't the proposed enhancement is significant.

</details>


---

<a id="445"></a>

### #445: Add parent workflow information in `WorkflowInfo`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/445 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-01-12 18:29:28.000 UTC (3y 12m ago) |
| **Updated** | 2022-06-01 17:58:40.000 UTC |
| **Closed** | 2022-06-01 17:58:40.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 0 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

*No description provided.*


---

<a id="441"></a>

### #441: [Bug] Retry policy intervals get rounded down to the second

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/441 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-01-03 17:14:37.000 UTC (4 years ago) |
| **Updated** | 2023-05-25 16:27:25.000 UTC |
| **Closed** | 2023-05-25 16:27:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Passing the following activity options:
```js
{
  retry: { initialInterval: "500ms" },
}
```

Produces the following result on the server:
```json
{
  "retryPolicy": {
    "nonRetryableErrorTypes": [],
    "initialInterval": {
      "duration": 0
    },
    "backoffCoefficient": 2,
    "maximumInterval": {
      "duration": 10
    },
    "maximumAttempts": 0
},
}
```

The SDK should probably round up the durations (first check what the other SDKs do here).

#### Comments (4)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-23 21:20:09.000 UTC</summary>

@bergundy I think this has been [resolved](https://github.com/temporalio/temporal/pull/1681) on server. Can we close?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-11-24 04:22:48.000 UTC</summary>

Not sure, can you please test?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 17:23:22.000 UTC</summary>

Need to verify that this is resolved

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-25 16:27:25.000 UTC</summary>

Validated in #1121.

</details>


---

<a id="438"></a>

### #438: [Feature Request] Header support for signals and queries

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/438 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2021-12-28 19:37:43.000 UTC (4 years ago) |
| **Updated** | 2022-04-22 23:51:51.000 UTC |
| **Closed** | 2022-04-22 23:51:51.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 0 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

### Is your feature request related to a problem? Please describe.

Headers were added to signals and queries in https://github.com/temporalio/temporal/pull/2149. 

### Describe the solution you'd like

Add to SDK

### Additional context

* Go SDK: https://github.com/temporalio/sdk-go/pull/631
* Java SDK: https://github.com/temporalio/sdk-java/issues/940


---

<a id="383"></a>

### #383: [Bug] package initalizer errors on node 14

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/383 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-11-11 22:18:55.000 UTC (4y 1m ago) |
| **Updated** | 2022-10-12 04:41:41.000 UTC |
| **Closed** | 2022-10-12 04:41:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

as spoken with @lorensr https://temporaltechnologies.slack.com/archives/C01FT8U10GK/p1636621124237100

![image](https://user-images.githubusercontent.com/6764957/141377012-a4671ddd-94d4-43a4-902a-25b82416996c.png)


### To Reproduce

1. use node 14
2. `npx @temporalio/create@latest fooobar --sample nextjs-ecommerce-oneclick


#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-11 22:26:22.000 UTC</summary>

It's the tool replacing tsconfig in package json based on node version [here](https://github.com/temporalio/sdk-typescript/blob/409d015f6b674e84a5c0b8ee6ece151570afd8c3/packages/create-project/src/helpers/install.ts#L45).
We could just set the value to `^1.0.0`.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-11-11 22:28:53.000 UTC</summary>

Yeah, we could either make sure all the samples have `^1.0.0` in `package.json` or have `create` overwrite whatever's there with `[version]@^1.0.0`. latter more foolproof

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:25:02.000 UTC</summary>

@lorensr I think this was fixed a while back, can you confirm?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-10-12 04:41:41.000 UTC</summary>

It works now. (samples have `^1.0.0` in `package.json`)

</details>


---

<a id="368"></a>

### #368: [Feature Request] Provide docker image(s) for compiling/running workers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/368 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-11-10 18:42:04.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-23 01:58:41.000 UTC |
| **Closed** | 2021-11-23 01:58:41.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

Users are unsure about how to build & run our workers in containers

### Describe the solution you'd like

On our docker account we should provide a build image and a runtime image. We should update docs to include some info on how to properly use the images


#### Comments (2)

<details>
<summary><strong>swyxio</strong> commented on 2021-11-10 20:22:29.000 UTC</summary>

ping me when you want me to come in but i'll assume youve got this

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 01:58:41.000 UTC</summary>

Now that we have `vm` support and pre-built binaries for all major architectures and os targets, I don't see a good reason to do this.
@Sushisource feel free to re-open if you disagree.

</details>


---

<a id="330"></a>

### #330: [Bug] Opentelemetry bugs/findings

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/330 |
| **State** | CLOSED |
| **Author** | schickling (Johannes Schickling) |
| **Created** | 2021-10-22 15:54:04.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-28 17:06:51.000 UTC |
| **Closed** | 2021-10-28 17:06:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

While trying to setup Opentelemetry support for my app (by following the [example project](https://github.com/temporalio/samples-typescript/tree/main/interceptors-opentelemetry)) I was facing the following bugs:

- [x] The timing seems off (see `18922d 10h`) üòÇ 

![image](https://user-images.githubusercontent.com/1567498/138485085-f079fe96-e110-40bd-9b68-152f90cb8477.png)

- [x] Some spans don't use the configured `serviceName` (e.g. here should be `temporal-app` instead of `OTLPResourceNoServiceName `)

![CleanShot 2021-10-22 at 17 50 45](https://user-images.githubusercontent.com/1567498/138485449-1c0ab007-8004-4f70-9b83-3a8da1f63a56.png)

- [x] Non-app/SDK-internal traces should be disabled/hidden by default

![image](https://user-images.githubusercontent.com/1567498/138485191-cc58eb88-b49b-4a06-8152-72c132a3b034.png)

- [x] Child workflows are not connected to root workflows (i.e. the child workflow span `workflow.execute` should be a child span of the root `workflow.schedule`)

![image](https://user-images.githubusercontent.com/1567498/138485664-ab994577-2d3f-4e2f-b331-4684f09d2ded.png)


#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-22 15:55:27.000 UTC</summary>

Also ContinueAsNew should be traced and the package should be compatible with the Java / Golang opentracing implementation.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-26 05:04:15.000 UTC</summary>

@schickling this is one of the next items on my list.

Reactions: üöÄ 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-26 15:28:20.000 UTC</summary>

`OLTPResourceNoServiceName` is caused by not passing the created otel resource to `makeWorkflowExporter`.
I'll make it required.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-26 19:20:18.000 UTC</summary>

I'm marking things I solved locally as done, will make a PR when it's all done.

Reactions: üëç 1

</details>


---

<a id="325"></a>

### #325: Guidance on connection and client instantiation pattern when long-lived connections will frequently drop

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/325 |
| **State** | CLOSED |
| **Author** | davidtheclark (David Clark) |
| **Created** | 2021-10-21 22:09:47.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-03 15:01:32.000 UTC |
| **Closed** | 2021-11-03 15:01:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | Sushisource |
| **Milestone** | beta |

#### Description

To use a client, we create a `Connection`, pass that into the `WorkflowClient` constructor to create a client instance, then use the client instance's methods to make requests.

In a situation where the server app may be redeployed at any moment ‚Äî so clients will have outstanding connections dropped and they'll need to establish new connections ‚Äî should we only need to create one `Connection` and `WorkflowClient` for the life of the client application? And we can trust that it will re-connect to the server whenever its TCP connection is dropped? Or should we instead create a new `Connection` and `WorkflowClient` for every request, so we don't have to worry about long-lasting connections getting dropped between requests?

We have been receiving some "connection dropped" errors, so before we proceed too far with debugging we wanted to make sure we're using the Temporal client as recommended. Thanks!

cc @mengyazhu96

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-26 05:02:09.000 UTC</summary>

The client connection supports retries via gRPC interceptors.
AFAIR we did not implement retries in case of connection lost.
@Sushisource can you confirm?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-30 02:34:02.000 UTC</summary>

Will look into this first thing next week

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-11-02 22:11:33.000 UTC</summary>

@davidtheclark Can you post the exact errors you're getting here? There's multiple ways a lost connection can surface.

For example:
```
Error {
    code: 14,
    details: 'No connection established',
    metadata: Metadata {
      internalRepr: Map {},
      options: {},
    },
    message: '14 UNAVAILABLE: No connection established',
  }
```

It'd be useful to know if you see that or something different. 

I was able to confirm that if the connection is lost, an individual call might fail after it hits the retry limit, but the connection itself still will work fine if you try to use the client again. So, yes, you can trust the `Connection` and `WorkflowClient` instance may be re-used (though, depending on your retry policy, in-progress calls may eventually fail if the connection is lost for long enough)

Also note https://github.com/temporalio/sdk-core/pull/213 which fixes an issue with workers possibly giving up if the server is down for a while

</details>

<details>
<summary><strong>davidtheclark</strong> commented on 2021-11-03 15:01:32.000 UTC</summary>

> It'd be useful to know if you see that or something different.

Yes, I was seeing errors with code 14, and the same message, `14 UNAVAILABLE: No connection established`.

Thanks for confirming that we should be able to re-use the client indefinitely, even as server instances are swapped. There shouldn't be a long period during which no server is ready to receive connections: the new server should be live before the old server starts shutting down, so one retry should be enough.

Thanks for that fix. We'll open a new issue if we have more problems with connection failures after upgrading.


</details>


---

<a id="290"></a>

### #290: [Feature Request] Reconnecting to the server instead of crashing

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/290 |
| **State** | CLOSED |
| **Author** | emmanuelvlad (evlad) |
| **Created** | 2021-10-08 11:48:02.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-13 01:42:56.000 UTC |
| **Closed** | 2021-10-12 19:00:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | Sushisource |
| **Milestone** | beta |

#### Description

### Is your feature request related to a problem? Please describe.

When the temporal server is or goes down, `Worker.Create()` / `worker.run()` throws and can't reconnect

### Describe the solution you'd like

I wish that it'll work like the Golang sdk, being able to create a worker even if the temporal server is down so I could have my other services running on parallel (an express app)

Automatically reconnecting to the temporal server when it goes back up

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-08 14:17:17.000 UTC</summary>

I'm not sure about `create` but `run` should not throw in case the server goes down AFAICT.

@Sushisource can you please take a look?

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-08 23:53:13.000 UTC</summary>

Yeah, looks like this can happen:

```
2021-10-08T23:51:16.302Z [INFO] Worker state changed { state: 'RUNNING' }
2021-10-08T23:51:27.971Z [ERROR] Worker failed {
  error: [TransportError: Unhandled grpc error when workflow polling: Status { code: Unknown, message: "transport error", source: None }]
}
2021-10-08T23:51:27.971Z [INFO] Worker state changed { state: 'FAILED' }
```

Will fix. @emmanuelvlad If you would post the output, that'd help. I assume it was something like the above?

</details>

<details>
<summary><strong>emmanuelvlad</strong> commented on 2021-10-09 08:53:03.000 UTC</summary>

Yep, I have the same as you

```
2021-10-09T08:49:53.470Z [INFO] Worker state changed { state: 'RUNNING' }
2021-10-09T08:49:53.474Z [INFO] [temporal_sdk_core] Registering worker task_queue="api" 
2021-10-09T08:50:10.283Z [ERROR] Worker failed {
  error: [TransportError: Unhandled grpc error when activity polling: Status { code: Unknown, message: "transport error", source: None }]
}
2021-10-09T08:50:10.284Z [INFO] Worker state changed { state: 'FAILED' }
[TransportError: Unhandled grpc error when activity polling: Status { code: Unknown, message: "transport error", source: None }]
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-13 01:42:56.000 UTC</summary>

I‚Äôm leaving it closed but we still need to advance core for this to be resolved

</details>


---

<a id="284"></a>

### #284: [Feature Request] Return Promise from Worker.shutdown()

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/284 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-10-07 00:32:12.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-12 15:31:16.000 UTC |
| **Closed** | 2021-10-12 15:31:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Currently `shutdown` returns `void`:

https://nodejs.temporal.io/api/classes/worker.Worker#shutdown

I think it would be nice if it returns a `Promise<void>` that resolves when the Worker finishes shutting down.

### Additional context

It would change this:

```js
  let runPromise = null;
  let worker = null;

  before(async function() {
    worker = ...  
    runPromise = worker.run();
  });

  after(async function() {
    worker.shutdown();
    await runPromise;
  });
```

to:

```js
  let worker = null;

  before(async function() {
    worker = ...
    worker.run();
  });

  after(async function() {
    await worker.shutdown();
  });
```




#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 00:55:29.000 UTC</summary>

Maybe shutdown can return the run promise.
I wouldn't remove the run promise because in actual production code you never shutdown the worker, it shuts itself down if it gets a signal.
Then the new version for testing would be:
```ts
  let worker = null;

  before(async function() {
    worker = ...
    worker.run().catch(() => undefined); // ignore errors here and catch them in `after`
  });

  after(async function() {
    await worker.shutdown();
  });
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 00:56:25.000 UTC</summary>

To clarify catching is for avoiding unhandled rejection.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 00:57:41.000 UTC</summary>

I'm not convinced this is desired though.
Shutdown ATM is a synchronous operation that only requests shutdown, making it return the run promise is a bit confusing especially because the stack trace would be weird.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 15:31:16.000 UTC</summary>

As discussed in slack I'm closing this issue.

</details>


---

<a id="272"></a>

### #272: [Feature Request] Assist with use-before-define bugs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/272 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-27 21:33:47.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-12 15:34:13.000 UTC |
| **Closed** | 2021-10-12 15:34:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

If we move to the new imperative dynamic API for defining signals and queries, then they may be defined after start time, which means the running Workflow may receive signals or queries before they're defined, which will often be unintentional‚Äîa bug in our user's code. I think it would be helpful if we logged a warning when that happens in development.

#### Comments (4)

<details>
<summary><strong>swyxio</strong> commented on 2021-09-27 21:56:27.000 UTC</summary>

good point. although i think in Go the signals is just processed as per normal, because of the signalchannel semantic


</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-09-27 21:58:53.000 UTC</summary>

Like on receipt of a signal, we could queue it, even if a matching handler doesn't exist? And deliver the contents of the queue when it's defined?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 05:48:12.000 UTC</summary>

Yes @lorensr that is an option

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 15:34:13.000 UTC</summary>

We're buffering signals until a listener is registered.
Queries must be registered before invoked or the caller will get an error.

</details>


---

<a id="266"></a>

### #266: [Feature Request] continueAsNew with a taskQueue

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/266 |
| **State** | CLOSED |
| **Author** | alex-dixon (Alex Dixon) |
| **Created** | 2021-09-24 14:38:35.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-01 08:02:32.000 UTC |
| **Closed** | 2021-10-01 08:02:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

I'm looking for a way to continue a workflow as a new workflow but on a different task queue than the workflow started on.

If there's a way to do this with the current API I just don't know what it is. It seems continue as new performs this functionality but does not currently allow specifying a task queue.


#### Comments (4)

<details>
<summary><strong>lorensr</strong> commented on 2021-09-24 15:03:30.000 UTC</summary>

Here's the version of the function that takes options: https://nodejs.temporal.io/api/namespaces/workflow#makecontinueasnewfunc

I'm not finding the definition of `ContinueAsNewOptions` though.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-09-24 18:23:49.000 UTC</summary>

`ContinueAsNewOptions` already does in fact allow setting a task queue, so this should work already.

We'll need to make sure it shows up in the docs properly.

@alex-dixon Try using the function @lorensr posted and set the task queue in the passed in options.

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-09-27 16:24:00.000 UTC</summary>

@bergundy for some reason `ContinueAsNewOptions` are not exposed at all in  `https://nodejs.temporal.io/api/namespaces/workflow/#makecontinueasnewfunc`

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 13:50:30.000 UTC</summary>

Probably forgot to export it, I'll take care of it

</details>


---

<a id="241"></a>

### #241: [Bug] Worker crashes occasionally during load tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/241 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-14 12:16:22.000 UTC (4y 3m ago) |
| **Updated** | 2021-11-09 17:12:16.000 UTC |
| **Closed** | 2021-11-09 17:12:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

### Describe the bug

https://buildkite.com/temporal/node-sdk/builds/111#a955fc9f-5ac0-4823-aa31-7517f1efdccf

```
node: ../workflow-isolate-extension.cc:47: void custom_promise_hook(v8::PromiseHookType, v8::Local<v8::Promise>, v8::Local<v8::Value>): Assertion `!result.IsEmpty()' failed.
```

### To Reproduce

Not sure how to reproduce this locally

### Expected behavior

Worker should not crash

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-23 14:59:28.000 UTC</summary>

This should become irrelevant if we decide to merge #264 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 06:48:16.000 UTC</summary>

This hasn't happened in a while, I'll add more information to the assertion for next time we see this.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 13:26:05.000 UTC</summary>

Added it here: https://github.com/temporalio/sdk-node/pull/268

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-29 06:05:42.000 UTC</summary>

Removing from beta milestone but leaving open for the record.

</details>


---

<a id="214"></a>

### #214: [Feature Request] Provide a method for getting a client instance on `activity.Context`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/214 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-08-27 19:44:18.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-23 20:01:14.000 UTC |
| **Closed** | 2021-09-23 20:01:14.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

Currently there's no easy way to get the *same* client that the worker/workflows use from inside an activity. This surfaced as a problem where worker was using the right URL for the server, but an activity sending a signal was not.

### Describe the solution you'd like

In title


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-19 12:37:49.000 UTC</summary>

Apparently this isn't required because we can just pass class instances as activities.
I'm submitting a PR that makes this simpler and adds snippets for the docs.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-23 20:01:11.000 UTC</summary>

This is already supported as demonstrated here: https://github.com/temporalio/samples-node/pull/18

I'll add to the docs.

</details>


---

<a id="176"></a>

### #176: [Bug] Cannot find temporal modules during build

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/176 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-08-07 20:58:47.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-09 18:22:13.000 UTC |
| **Closed** | 2021-08-09 18:22:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

When I run `npm run build` or `npx lerna run build --scope @temporalio/test`, I get `tsc` errors like `Cannot find module '@temporalio/activity'`, from lines like:

```
import { Context as ActivityContext } from '@temporalio/activity';
```

### To Reproduce

```
npx lerna run build --scope @temporalio/test
```

### Screenshots/Terminal output

Output:

<details>

```
$ npx lerna run build --scope @temporalio/test
lerna notice cli v4.0.0
lerna info versioning independent
lerna notice filter including "@temporalio/test"
lerna info filter [ '@temporalio/test' ]
lerna info Executing command in 1 package: "npm run build"
lerna ERR! npm run build exited 1 in '@temporalio/test'
lerna ERR! npm run build stdout:

> @temporalio/test@0.6.0 build /Users/me/gh/sdk-node/packages/test
> tsc --build

../worker/src/interceptors.ts(10,44): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
../worker/src/activity.ts(4,35): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
../worker/src/activity.ts(5,47): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
../worker/src/server-options.ts(4,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
../worker/src/core.ts(11,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
../worker/src/core.ts(12,39): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
../worker/src/worker.ts(34,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
../worker/src/worker.ts(37,38): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
../worker/src/worker.ts(401,5): error TS2322: Type 'any' is not assignable to type 'never'.
../worker/src/worker.ts(402,5): error TS2322: Type 'any' is not assignable to type 'never'.
../worker/src/worker.ts(403,5): error TS2322: Type 'any' is not assignable to type 'never'.
../worker/src/worker.ts(404,5): error TS2322: Type 'any' is not assignable to type 'never'.
../worker/src/worker.ts(406,5): error TS2322: Type 'any' is not assignable to type 'never'.
../worker/src/worker.ts(563,23): error TS2349: This expression is not callable.
  Type 'never' has no call signatures.
../worker/src/worker.ts(706,24): error TS7006: Parameter 'details' implicitly has an 'any' type.
../worker/src/worker.ts(971,51): error TS2345: Argument of type 'ArrayBuffer' is not assignable to parameter of type 'never'.
../worker/src/worker.ts(984,50): error TS2349: This expression is not callable.
  Type 'never' has no call signatures.
../worker/src/worker.ts(1031,35): error TS2349: This expression is not callable.
  Type 'never' has no call signatures.
../worker/src/worker.ts(1062,50): error TS2349: This expression is not callable.
  Type 'never' has no call signatures.
../worker/src/worker.ts(1087,31): error TS2349: This expression is not callable.
  Type 'never' has no call signatures.
lerna ERR! npm run build stderr:
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! @temporalio/test@0.6.0 build: `tsc --build`
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the @temporalio/test@0.6.0 build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/me/.npm/_logs/2021-08-07T20_42_09_389Z-debug.log
lerna ERR! npm run build exited 1 in '@temporalio/test'
```

</details>


### Versions

 - OS: Mac 11.4 Intel
- Node: 14.16.0
- typescript: 4.3.5

### Additional context

I've gone through these steps: 
- https://github.com/temporalio/sdk-node/blob/main/CONTRIBUTING.md#environment-set-up
- https://github.com/temporalio/sdk-node/blob/main/docs/building.md

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-08 11:30:18.000 UTC</summary>

Can you try and run `npx lerna clean -f && npm ci && npm run build` from the project root directory?
Does it yield the same results?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-08-08 15:12:33.000 UTC</summary>

There was no `-f` option, but yes, similar build output after `npx lerna clean && npm ci`

<details>

```
$ npm run build

> typescript-sdk@ build /Users/me/gh/sdk-node
> lerna run --stream build

lerna notice cli v4.0.0
lerna info versioning independent
lerna info Executing command in 6 packages: "npm run build"
@temporalio/core-bridge: > @temporalio/core-bridge@0.2.0 build /Users/me/gh/sdk-node/packages/core-bridge
@temporalio/core-bridge: > npm run build-rust
@temporalio/create: > @temporalio/create@0.3.3 build /Users/me/gh/sdk-node/packages/create-project
@temporalio/create: > tsc --build
@temporalio/core-bridge: > @temporalio/core-bridge@0.2.0 build-rust /Users/me/gh/sdk-node/packages/core-bridge
@temporalio/core-bridge: > TEMPORAL_WORKER_FORCE_BUILD=true node ./scripts/build.js
@temporalio/core-bridge: Force build via TEMPORAL_WORKER_FORCE_BUILD env var
@temporalio/core-bridge: Compiling bridge { target: undefined }
@temporalio/core-bridge:     Finished release [optimized] target(s) in 0.84s
@temporalio/proto: > @temporalio/proto@0.2.4 build /Users/me/gh/sdk-node/packages/proto
@temporalio/proto: > node ./scripts/compile-proto.js
@temporalio/proto: installing jsdoc@^3.6.3
@temporalio/proto: Asuming protos are up to date
@temporalio/worker: > @temporalio/worker@0.6.0 build /Users/me/gh/sdk-node/packages/worker
@temporalio/worker: > node-gyp rebuild --release
@temporalio/worker:   CXX(target) Release/obj.target/temporalio-workflow-isolate-extension/workflow-isolate-extension.o
@temporalio/worker:   SOLINK_MODULE(target) Release/temporalio-workflow-isolate-extension.node
@temporalio/worker: ld: warning: directory not found for option '-L/Developer/SDKs/MacOSX10.7.sdk/usr/lib'
@temporalio/test: > @temporalio/test@0.6.0 build /Users/me/gh/sdk-node/packages/test
@temporalio/test: > tsc --build
@temporalio/interceptors-opentelemetry: > @temporalio/interceptors-opentelemetry@0.1.0 build /Users/me/gh/sdk-node/packages/interceptors-opentelemetry
@temporalio/interceptors-opentelemetry: > tsc --build
@temporalio/test: ../worker/src/interceptors.ts(10,44): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/test: ../worker/src/activity.ts(4,35): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/test: ../worker/src/activity.ts(5,47): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/test: ../worker/src/server-options.ts(4,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/test: ../worker/src/core.ts(11,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/test: ../worker/src/core.ts(12,39): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/test: ../worker/src/worker.ts(34,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/test: ../worker/src/worker.ts(37,38): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/test: ../worker/src/worker.ts(401,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/test: ../worker/src/worker.ts(402,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/test: ../worker/src/worker.ts(403,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/test: ../worker/src/worker.ts(404,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/test: ../worker/src/worker.ts(406,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/test: ../worker/src/worker.ts(563,23): error TS2349: This expression is not callable.
@temporalio/test:   Type 'never' has no call signatures.
@temporalio/test: ../worker/src/worker.ts(706,24): error TS7006: Parameter 'details' implicitly has an 'any' type.
@temporalio/test: ../worker/src/worker.ts(971,51): error TS2345: Argument of type 'ArrayBuffer' is not assignable to parameter of type 'never'.
@temporalio/test: ../worker/src/worker.ts(984,50): error TS2349: This expression is not callable.
@temporalio/test:   Type 'never' has no call signatures.
@temporalio/test: ../worker/src/worker.ts(1031,35): error TS2349: This expression is not callable.
@temporalio/test:   Type 'never' has no call signatures.
@temporalio/test: ../worker/src/worker.ts(1062,50): error TS2349: This expression is not callable.
@temporalio/test:   Type 'never' has no call signatures.
@temporalio/test: ../worker/src/worker.ts(1087,31): error TS2349: This expression is not callable.
@temporalio/test:   Type 'never' has no call signatures.
@temporalio/interceptors-opentelemetry: ../worker/src/interceptors.ts(10,44): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/activity.ts(4,35): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/activity.ts(5,47): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/server-options.ts(4,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/core.ts(11,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/core.ts(12,39): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(34,25): error TS2307: Cannot find module '@temporalio/core-bridge' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(37,38): error TS2307: Cannot find module '@temporalio/activity' or its corresponding type declarations.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(401,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(402,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(403,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(404,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(406,5): error TS2322: Type 'any' is not assignable to type 'never'.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(563,23): error TS2349: This expression is not callable.
@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(706,24): error TS7006: Parameter 'details' implicitly has an 'any' type.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(971,51): error TS2345: Argument of type 'ArrayBuffer' is not assignable to parameter of type 'never'.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(984,50): error TS2349: This expression is not callable.
@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(1031,35): error TS2349: This expression is not callable.
@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(1062,50): error TS2349: This expression is not callable.
@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.
@temporalio/interceptors-opentelemetry: ../worker/src/worker.ts(1087,31): error TS2349: This expression is not callable.
@temporalio/interceptors-opentelemetry:   Type 'never' has no call signatures.
@temporalio/test: npm ERR! code ELIFECYCLE
@temporalio/test: npm ERR! errno 1
@temporalio/test: npm ERR! @temporalio/test@0.6.0 build: `tsc --build`
@temporalio/test: npm ERR! Exit status 1
@temporalio/test: npm ERR! 
@temporalio/test: npm ERR! Failed at the @temporalio/test@0.6.0 build script.
@temporalio/test: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
@temporalio/interceptors-opentelemetry: npm ERR! code ELIFECYCLE
@temporalio/interceptors-opentelemetry: npm ERR! errno 1
@temporalio/interceptors-opentelemetry: npm ERR! @temporalio/interceptors-opentelemetry@0.1.0 build: `tsc --build`
@temporalio/interceptors-opentelemetry: npm ERR! Exit status 1
@temporalio/interceptors-opentelemetry: npm ERR! 
@temporalio/interceptors-opentelemetry: npm ERR! Failed at the @temporalio/interceptors-opentelemetry@0.1.0 build script.
@temporalio/interceptors-opentelemetry: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
@temporalio/test: npm ERR! A complete log of this run can be found in:
@temporalio/test: npm ERR!     /Users/me/.npm/_logs/2021-08-08T15_08_57_675Z-debug.log
lerna ERR! npm run build exited 1 in '@temporalio/test'
lerna WARN complete Waiting for 1 child process to exit. CTRL-C to exit immediately.
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! typescript-sdk@ build: `lerna run --stream build`
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the typescript-sdk@ build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/me/.npm/_logs/2021-08-08T15_08_57_720Z-debug.log
```

</details>

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 12:57:35.000 UTC</summary>

For `-f` you have to use `-- -f` so `npm` doesn't try to parse the flag.

I'm not sure what the problem is, those are the steps we run on each build in CI for node 14 and 16 on mac and linux.
Let me try to help you on our call later today.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-08-09 18:22:13.000 UTC</summary>

Thank you, that worked! 

```
npx lerna clean -- -f && npm ci && npm run build
```

</details>


---

<a id="125"></a>

### #125: [Bug] Getting a "TypeError: otel.setSpan is not a function" error when running hello world sample app

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/125 |
| **State** | CLOSED |
| **Author** | denjalonso (Denis Juan Alonso Glez) |
| **Created** | 2021-06-15 08:48:10.000 UTC (4y 6m ago) |
| **Updated** | 2021-06-16 00:43:26.000 UTC |
| **Closed** | 2021-06-16 00:43:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**
Error when running getting started (hello world sample app), step 3 "Run your Workflow"

**To Reproduce**
Steps to reproduce the behavior:
1. Go to https://docs.temporal.io/docs/node/getting-started/
2. Follow steps
3. Get below error when running ```node lib/worker```:
```
Worker state changed { state: 'RUNNING' }
2021-06-15T08:30:38.727Z [ERROR] Worker failed {
  error: TypeError: otel.setSpan is not a function
      at Object.instrument (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/@temporalio/worker/lib/tracing.js:45:26)
      at /Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/@temporalio/worker/lib/worker.js:488:40
      at MergeMapSubscriber.project (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/@temporalio/worker/lib/worker.js:258:28)
      at MergeMapSubscriber._tryNext (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/operators/mergeMap.js:67:27)
      at MergeMapSubscriber._next (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/operators/mergeMap.js:57:18)
      at MergeMapSubscriber.Subscriber.next (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/Subscriber.js:66:18)
      at MapSubscriber._next (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/operators/map.js:55:26)
      at MapSubscriber.Subscriber.next (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/Subscriber.js:66:18)
      at Observable._subscribe (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/util/subscribeToArray.js:5:20)
      at Observable._trySubscribe (/Users/dalogon/Projects/12-technoactivity-projects/22-core-services/10-mymoidapis-campaigns/temporal-test/example/node_modules/rxjs/internal/Observable.js:44:25)
}
2021-06-15T08:30:38.729Z [INFO] Worker state changed { state: 'FAILED' }
```

**Expected behavior**
Starts the worker

**Screenshots/Terminal ouput**
<img width="1838" alt="Screenshot 2021-06-15 at 09 32 07" src="https://user-images.githubusercontent.com/3237551/122022010-1d0fff00-cdbe-11eb-86e0-ebd21a595c73.png">

**Versions (please complete the following information where relevant):**
 - OS: macOs Big Sur 11.4 Apple M1
 - Node v16.3.0 (tj/n)
 - ```"temporalio": "0.2.1"```
 - Temporal server with docker compose

**Additional context**
I have tried with different versions of node> = 15 also with nvm


#### Comments (4)

<details>
<summary><strong>juanchojbarroso</strong> commented on 2021-06-15 08:55:58.000 UTC</summary>

+1 here!

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-15 12:58:55.000 UTC</summary>

This has already been fixed in the main branch.
Looks like opentelemetry broke semver.
I'm traveling right now but I'll cut out a patch release as soon as I'm available.


</details>

<details>
<summary><strong>denjalonso</strong> commented on 2021-06-15 14:43:34.000 UTC</summary>

Ok, thanks.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-16 00:43:26.000 UTC</summary>

Just released `temporalio@0.2.2` and `@temporalio/worker@0.4.0` which fix the issue.
We should probably monitor the installation to prevent this type of breakage in the future.

</details>


---

<a id="115"></a>

### #115: [Feature Request] Searchable SDK docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/115 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-06-01 19:22:55.000 UTC (4y 7m ago) |
| **Updated** | 2021-09-13 06:49:05.000 UTC |
| **Closed** | 2021-09-13 06:49:05.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |
| **Reactions** | üëç 1 |

#### Description

**Is your feature request related to a problem? Please describe.**

hard to find things in the SDK docs, search would be nice!

**Describe the solution you'd like**

lets see if there's ways to do this without algolia so that we dont rely too much on them, but if we have to then its ok.

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2021-08-08 23:12:45.000 UTC</summary>

might also be nice if searching in the docs.temporal.io search box sourced SDK results

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-02 12:55:26.000 UTC</summary>

@lorensr interesting but I'd leave that for future work.

</details>


---

<a id="102"></a>

### #102: [Feature Request] Add ability to debug Workflow code in isolates

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/102 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-18 11:45:49.000 UTC (4y 7m ago) |
| **Updated** | 2021-11-23 02:04:28.000 UTC |
| **Closed** | 2021-11-23 02:04:28.000 UTC |
| **Upvotes** | 2 |
| **Comments** | 0 |
| **Priority Score** | 4 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 2 |

#### Description

**Is your feature request related to a problem? Please describe.**

Currently it is not possible to set up a debugger for Workflow code, this is an important feature which must be easy to use and well documented.

**Describe the solution you'd like**

Debugging Workflows should be as seamless as possible (considering the limitations when working with multiple v8 contexts).

**Additional context**

[This](https://github.com/laverdet/isolated-vm/blob/main/inspector-example.js) should be a good starting point


---

<a id="98"></a>

### #98: [Bug] Intermediate certificates sample does not work on MacOS

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/98 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-18 11:06:50.000 UTC (4y 7m ago) |
| **Updated** | 2023-01-10 17:11:59.000 UTC |
| **Closed** | 2023-01-10 17:11:59.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 2 |
| **Priority Score** | 4 |
| **Labels** | bug, good first issue |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

**Describe the bug**
When trying to connect the Worker to a server using the `tls-full` [sample](https://github.com/temporalio/customization-samples/tree/master/tls/tls-full), connection fails with `[TransportError: transport error: error trying to connect: invalid certificate: UnknownIssuer]`

**To Reproduce**
Steps to reproduce the behavior:
1. Follow the [mTLS tutorial](https://docs.temporal.io/docs/node/tls/#mtls-tutorial) but use `tls-full` instead of simple
1. Run the Worker
```shell
TEMPORAL_ADDRESS=localhost \
TEMPORAL_NAMESPACE=accounting \
TEMPORAL_CLIENT_CERT_PATH=certs/client/accounting/client-accounting-namespace-chain.pem \
TEMPORAL_CLIENT_KEY_PATH=certs/client/accounting/client-accounting-namespace.key \
TEMPORAL_SERVER_NAME_OVERRIDE=accounting.cluster-x.contoso.com \
TEMPORAL_SERVER_ROOT_CA_CERT_PATH=certs/cluster/ca/server-intermediate-ca.pem \
npm start
```

**Expected behavior**
Worker should connect to server

**Versions (please complete the following information where relevant):**
 - OS: Mac
 - Temporal Version: `temporalio/auto-setup@sha256:004f4440664f13c3b049eaad5c019c9f780082d8752655d01ef91e322b482097`

**Additional context**
Tried using different certificates without success, seems like this is a MacOS issue, @Sushisource got it working on Linux.

#### Comments (2)

<details>
<summary><strong>liammurray</strong> commented on 2021-12-19 19:44:46.000 UTC</summary>

I believe I am running into this, although I only see "[TransportError: transport error]". I can connect with tctl but not from my typescript SDK worker using the same certificates and client key. I also get the same error when I run the worker in a docker container (local and on a Linux node). 

</details>

<details>
<summary><strong>liammurray</strong> commented on 2021-12-20 19:06:22.000 UTC</summary>

I got it to work with just a root CA (no intermediate) by adding `-sha256` to the openssl commands generating the certs (it was defaulting to sha1, possibly due to something else I had going on). Once that was fixed I switched back to an end entity cert signed with an intermediate CA and I started getting "Failed to connect before the deadline" (due to "unable to get issuer certificate" as observed in grpc-js logs). I believe that is this issue: https://github.com/grpc/grpc-node/issues/1784.

</details>


---

<a id="39"></a>

### #39: Include a roadmap in readme

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/39 |
| **State** | CLOSED |
| **Author** | pikaciu22x |
| **Created** | 2021-03-18 16:05:33.000 UTC (4y 9m ago) |
| **Updated** | 2021-03-24 14:53:54.000 UTC |
| **Closed** | 2021-03-24 14:53:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Hey everyone,

I'm excited to see, that you are willing to create a node client! Sorry for creating this as an issue in case i did it in the wrong place. I just wanted to ask whether adding a roadmap would be possible? For example, https://github.com/firdaus/cadence-python lists supported features, etc. This would really help to grasp in what state is the current project.

My companies development team wants to start using temporal, but currently, the vast majority of our codebase consists of typescript or python, thus creating a barrier. I would love to contribute to help this project.

#### Comments (4)

<details>
<summary><strong>swyxio</strong> commented on 2021-03-18 19:38:27.000 UTC</summary>

hi, thanks for filing this, we aren't soliciting contributions yet as this project is still in very early stages, however you can try it out now per the README and give feedback if anything doesn't work. thank you!

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-03-23 11:54:55.000 UTC</summary>

We're working on having a functional alpha release in the upcoming weeks, hopefully in a week or 2 from now.
The release will include running activities and workflows and a basic service client.
We won't have advanced features like local activities, side effects, and interceptors yet but it should be enough to start working with the client.

We're currently missing:
- Ease of installation (the package relies on 3 different native modules written in c++ and rust). 
- Documentation
- Integration tests for running activities

Reactions: üëç 2

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-03-24 14:46:42.000 UTC</summary>

Added an alpha milestone

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-03-24 14:53:54.000 UTC</summary>

@pikaciu22x I'm closing this, feel free to re-open if you want to continue the discussion.

</details>


---

<a id="19"></a>

### #19: Drain any remaining activations from `poll_task` until it returns `CoreError::ShuttingDown`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/19 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-01 19:06:18.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-09 10:43:07.000 UTC |
| **Closed** | 2021-03-09 10:43:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 4 |
| **Priority Score** | 4 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Doesn't need to be this PR but you'll probably want to have some mechanism to drain any remaining activations from `poll_task` until it returns `CoreError::ShuttingDown`. Remaining activations may exist due to replaying a workflow to catch up to the end of history which was already fetched from the server

_Originally posted by @Sushisource in https://github.com/temporalio/sdk-node/pull/18#discussion_r584953075_

#### Comments (4)

<details>
<summary><strong>bergundy</strong> commented on 2021-03-03 08:30:34.000 UTC</summary>

@Sushisource I tried to implement draining but never got `CoreError:ShuttingDown`, in fact the promise returned from `run` was never resolved or rejected.
See the worker code here: https://github.com/temporalio/sdk-node/blob/aff47fddc0f2de53f52677fc97084139ea268e06/packages/worker/src/worker.ts#L142

Example worker to reproduce:
```ts
import { Worker } from '@temporalio/worker';
import { sleep } from '@temporalio/worker/lib/utils';

const shutdownGraceTimeSecs = 5;

async function run() {
  const worker = new Worker(__dirname);
  process.on('SIGINT', async () => {
    console.log('Shutting down worker');
    worker.shutdown();
    await sleep(shutdownGraceTimeSecs * 1000);
    console.error('Timed out while waiting for worker to shutdown gracefully');
    process.exit(0);
  });
  await worker.run('test');
  console.log('Worker gracefully shutdown');
}

run().then(
  () => void process.exit(0),
  (err) => {
    console.error(err);
    process.exit(1);
  }
);

```

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-03-03 17:42:01.000 UTC</summary>

@bergundy I'll fix this - it's immediately clear to me what the problem is... `poll_task` is stuck blocked on the long poll and never gets a chance to see that the shutdown flag is set. I need some way to interrupt the long poll when that happens. Should be easy.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-03-03 22:58:09.000 UTC</summary>

Should be fixed by https://github.com/temporalio/sdk-core/pull/59

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-03-04 12:56:37.000 UTC</summary>

After the above is merged, we should update the submodule and create a PR for https://github.com/temporalio/sdk-node/tree/graceful-shutdown

</details>


---

<a id="1864"></a>

### #1864: [Feature Request] Update AI SDK integration to v6

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1864 |
| **State** | CLOSED |
| **Author** | tconley1428 |
| **Created** | 2025-12-22 18:27:09.000 UTC (17 days ago) |
| **Updated** | 2026-01-08 19:48:34.000 UTC |
| **Closed** | 2026-01-08 19:48:34.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 üéâ 1 |

#### Description

### Is your feature request related to a problem? Please describe.

https://vercel.com/blog/ai-sdk-6

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (1)

<details>
<summary><strong>chris-olszewski</strong> commented on 2026-01-08 19:48:34.000 UTC</summary>

Closed with #1865 

</details>


---

<a id="1772"></a>

### #1772: extractSourceMap takes a huge amount of RAM on boot

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1772 |
| **State** | OPEN |
| **Author** | NikhilVerma (Nikhil Verma) |
| **Created** | 2025-08-22 17:09:02.000 UTC (4 months ago) |
| **Updated** | 2025-08-25 17:35:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

I run a series of workers on my Temporal pod bootup. They sometimes take up over 2GB of RAM simply from parsing the source maps. I've confirmed this using clinic.js.

<img width="1800" height="251" alt="Image" src="https://github.com/user-attachments/assets/66606c1a-5d9e-4c11-bf92-958990222cd7" />

https://github.com/temporalio/sdk-typescript/blob/5473ebd3442d00624fb0ed20fa82f8d5bd78e8fd/packages/worker/src/worker.ts#L1868

I am curious if there is a way to optionally allow turning off source maps? I can do so via the builder

```
	const { code } = await bundleWorkflowCode({
		workflowsPath: worker.workflowsPath,
		// Remove source maps
		webpackConfigHook: config => {
			config.devtool = false;
			return config;
		}
	});
```

But then the extractSourceMap throws, and if I patch it I see further failures down the line in `addWorkflowBundle > SourceMapConsumer`

I managed to patch it (in a dirty way)

```js
    return [code, JSON.stringify({
            version: 3,
            file: '',
            sources: [],
            mappings: '',
    })];
    // throw new Error("Can't extract inlined source map from the provided Workflow Bundle");
```

Which results in significantly lower bootup + IDLE ram usage


## Before
<img width="898" height="229" alt="Image" src="https://github.com/user-attachments/assets/f70c720e-a2fa-4de1-be23-96d17dfca737" />


## After
<img width="905" height="241" alt="Image" src="https://github.com/user-attachments/assets/1ff2a405-5c93-41f9-9e5a-88e90c8b595a" />

#### Comments (3)

<details>
<summary><strong>SamuelMS</strong> commented on 2025-08-23 04:06:34.000 UTC</summary>

Have you considered using `workflowBundle` over `workflowsPath` for production use?  e.g. compile the bundle in CI/CD ahead of time with Temporal's helper, then use that bundle with `workflowBundle: { codePath: '/app/worker/dist/workflows.cjs' }`.

```typescript
import { bundleWorkflowCode } from '@temporalio/worker';
import { writeFile } from 'fs/promises';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function bundle() {
  const { code } = await bundleWorkflowCode({
    workflowsPath: path.resolve(__dirname, './src/tasks/workflows.ts'),
  });
  const codePath = path.resolve(__dirname, './dist/workflows.cjs');

  await writeFile(codePath, code);
  console.log(`Bundle written to ${codePath}`);
}

bundle().catch((error) => {
  console.error('Bundle compilation failed:', error);
  process.exit(1);
});
```

Frankly, I'm not sure if this'll help your RAM usage with sourcemaps, but we haven't noticed any spikes in RAM with the above approach (for a fairly massive app, at that).

</details>

<details>
<summary><strong>NikhilVerma</strong> commented on 2025-08-24 01:27:49.000 UTC</summary>

@SamuelMS Actually I've tested this exclusively on the workflow bundle (because the source maps parsing happens on the bundle as well)

https://github.com/temporalio/sdk-typescript/blob/5473ebd3442d00624fb0ed20fa82f8d5bd78e8fd/packages/worker/src/worker.ts#L729C1-L736C8

You would primarily see this issue if you run multiple workers in the same machine, this the default strategy before we can start having worker specific pods. My workaround has been to load workers synchronously with a `global.gc` call in between them, it has kept the memory pressure under 1.8GB for now which works for us for the time being.

</details>

<details>
<summary><strong>SamuelMS</strong> commented on 2025-08-25 17:35:48.000 UTC</summary>

> [@SamuelMS](https://github.com/SamuelMS) Actually I've tested this exclusively on the workflow bundle (because the source maps parsing happens on the bundle as well)
> 
> https://github.com/temporalio/sdk-typescript/blob/5473ebd3442d00624fb0ed20fa82f8d5bd78e8fd/packages/worker/src/worker.ts#L729C1-L736C8
> 
> You would primarily see this issue if you run multiple workers in the same machine, this the default strategy before we can start having worker specific pods. My workaround has been to load workers synchronously with a `global.gc` call in between them, it has kept the memory pressure under 1.8GB for now which works for us for the time being.

We run multiple workers on our nodes, but use PM2 in cluster mode to manage them: https://pm2.keymetrics.io/docs/usage/cluster-mode/

</details>


---

<a id="1748"></a>

### #1748: Cannot suppress worker state logs in test environment

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1748 |
| **State** | CLOSED |
| **Author** | jtomaszewski (Jacek Tomaszewski) |
| **Created** | 2025-07-22 11:49:46.000 UTC (5 months ago) |
| **Updated** | 2025-07-23 15:33:09.000 UTC |
| **Closed** | 2025-07-23 15:33:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Issue Description

When running Temporal workers in test environments, the SDK outputs verbose worker state logs that cannot be suppressed, cluttering test output:

```
2025-07-22T11:47:49.603Z [INFO] Workflow bundle created { sdkComponent: 'worker', taskQueue: 'default', size: '1.15MB' }
2025-07-22T11:47:50.708Z [INFO] Worker state changed { sdkComponent: 'worker', taskQueue: 'default', state: 'RUNNING' }
2025-07-22T11:47:52.180Z [INFO] Worker state changed { sdkComponent: 'worker', taskQueue: 'default', state: 'STOPPING' }
2025-07-22T11:47:52.181Z [INFO] Worker state changed { sdkComponent: 'worker', taskQueue: 'default', state: 'DRAINING' }
2025-07-22T11:47:52.185Z [INFO] Worker state changed { sdkComponent: 'worker', taskQueue: 'default', state: 'DRAINED' }
2025-07-22T11:47:52.185Z [INFO] Worker state changed { sdkComponent: 'worker', taskQueue: 'default', state: 'STOPPED' }
```

## Current Behavior
- Setting `TEMPORAL_LOG_LEVEL=FATAL` doesn't suppress these logs
- Worker `runtimeOptions.logger` configuration doesn't affect these logs
- These logs appear to use an internal logging system that bypasses user configuration

## Expected Behavior
In test environments, there should be a way to suppress worker lifecycle logs while preserving error logs for debugging.

## Use Case
Running unit tests with workflows executing synchronously in-process. The verbose logs make it difficult to see actual test results and assertions.

## Attempted Solutions
```typescript
// None of these suppress the worker state logs:
workerOptions: {
  runtimeOptions: {
    logger: {
      info: () => {}, // Doesn't work
      log: () => {},  // Doesn't work
    },
  },
}

// Environment variables also don't work:
process.env.TEMPORAL_LOG_LEVEL = 'FATAL';
```


#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-22 15:14:47.000 UTC</summary>

This is what you are looking for:

```
import { DefaultLogger, Runtime } from '@temporalio/worker';

Runtime.install({
  logger: new DefaultLogger('WARN')
})
```

See [this doc page](https://docs.temporal.io/develop/typescript/observability#what-is-the-runtimes-logger) or [this sample](https://github.com/temporalio/samples-typescript/tree/ffdd555728fe7baf341553b8b99daa2a46408e25/custom-logger) for more advanced use cases, including controlling or capturing log messages emitted by the native Core SDK library, emitting log messages from Workflows and Activities, or piping log messages into a different logging system.

> # Current Behavior
> - Setting `TEMPORAL_LOG_LEVEL=FATAL` doesn't suppress these logs
> - Worker `runtimeOptions.logger` configuration doesn't affect these logs
> - These logs appear to use an internal logging system that bypasses user configuration

To clarify, are you saying you found those suggestions somewhere, e.g. our documentation? If so, can you please provide links to those? Those are definitely wrong and need to be fixed.

Also, which user configuration is being bypassed?

</details>

<details>
<summary><strong>jtomaszewski</strong> commented on 2025-07-23 07:00:19.000 UTC</summary>

1. The `Runtime.install({  logger: new DefaultLogger('WARN') })` does the thing for me. Thank you a lot.

2. I've read the doc page, but it is very extensive. I was somehow missing simple information on what is the quickest way to increase/decrease the amount of logs. Perhaps we could add that small tip in here?

https://docs.temporal.io/develop/typescript/observability#logging

For example, just under the _"The Temporal SDK core normally uses WARN as its default logging level."_ .

<img width="1119" height="783" alt="Image" src="https://github.com/user-attachments/assets/76e0d2ed-64f9-4a8b-ba32-4dbb571e7577" />

3. Furthermore, as I've just quoted, the docs say that WARN is the default logging level.

Is it?

I'm using `1.12.1` version of temporal libs (I've just installed them yesterday). Yet, I get info-level logs.

I have to explicitly specify `runtimeOptions: { logger: new DefaultLogger("WARN") }` to hide the info logs.

So perhaps the docs are not up-to-date?

FYI, I'm registering the temporal workers through https://github.com/KurtzL/nestjs-temporal , but I've just browsed through its' source code, I don't think that library is changing the default logger anyhow.

4. > To clarify, are you saying you found those suggestions somewhere, e.g. our documentation? If so, can you please provide links to those? Those are definitely wrong and need to be fixed.

That actually was Claude vibe-coding, so it might have come from nowhere - sorry.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-23 15:33:09.000 UTC</summary>

> The Runtime.install({  logger: new DefaultLogger('WARN') }) does the thing for me.

Great!

> The docs say that WARN is the default logging level. Is it?

No, the doc is wrong; that line was probably copied over from another language at some point, and not properly updated. The TS SDK prints out at `INFO` by default.

That level was set as the default in the early days of the SDK because that ensures logs would contain some of the key information we would need most of the time to diagnose basic issues that users would face in production. I have to admit that, these days, we almost never need to look at those log entries, so we could maybe consider upping the default to `WARN`, but that would be a breaking change for some users that might expect to see `INFO` level messages (e.g. from their Workflows and Activities) to appear in their logs. I'll discuss that with the rest of the team. Alternatively, we may reduce the log level on those specific messages.

> Perhaps we could add that small tip in here?

Definitely. We have tons of samples that reconfigure the logger, yet looking for a reference in docs, I found nothing "simple" and "direct" on this.

I'll definitely push that suggestion to our docs team.

> That actually was Claude vibe-coding, so it might have come from nowhere.

No problem. Yeah, that's one thing we're seeing quite a lot these days.

</details>


---

<a id="1740"></a>

### #1740: [Bug] webpackConfigHook doesn't seem to suppress all webpack output

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1740 |
| **State** | OPEN |
| **Author** | DatGuyJonathan (Jonathan Widjaja) |
| **Created** | 2025-07-10 20:50:40.000 UTC (6 months ago) |
| **Updated** | 2025-07-14 18:26:51.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

I'm trying to minimize logs and show important ones. I'm using `Worker.create` with this `bundlerOptions`:

```
bundlerOptions: {
  webpackConfigHook: (config) => {
    config.stats = "none";
    return config;
  },
},
```

I'm still seeing some webpack output like this:

```
      Workflow modules by path ../../../moose/node_modules/.pnpm/ 287 KiB
      Workflow   modules by path ../../../moose/node_modules/.pnpm/@temporalio+common@1.11.8/node_modules/@tempor...(truncated) 95.3 KiB 23 modules
      Workflow   modules by path ../../../moose/node_modules/.pnpm/@temporalio+workflow@1.11.8/node_modules/@temp...(truncated) 139 KiB
      Workflow     ../../../moose/node_modules/.pnpm/@temporalio+workflow@1.11.8/node_modules/@temp...(truncated) 8.38 KiB [built] [code generated]
      Workflow     ../../../moose/node_modules/.pnpm/@temporalio+workflow@1.11.8/node_modules/@temp...(truncated) 4.09 KiB [built] [code generated]
      Workflow     + 17 modules
      Workflow   ../../../moose/node_modules/.pnpm/long@5.3.2/node_modules/long/umd/index.js 49.8 KiB [built] [code generated]
      Workflow   ../../../moose/node_modules/.pnpm/ms@3.0.0-canary.1/node_modules/ms/...(truncated) 3.41 KiB [built] [code generated]
      Workflow modules by path ../../../moose/packages/ts-moose-lib/dist/scripts/ 8.01 KiB
      Workflow   ../../../moose/packages/ts-moose-lib/dist/scripts/workflow-autogenerated-...(truncated) 458 bytes [built] [code generated]
      Workflow   ../../../moose/packages/ts-moose-lib/dist/scripts/workflow.js 7.56 KiB [built] [code generated]
      Workflow __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
      Workflow __temporal_custom_failure_converter (ignored) 15 bytes [built] [code generated]
      Workflow webpack 5.99.9 compiled successfully in 238 ms
```

I found that commenting out this line from [bundler.ts](https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/workflow/bundler.ts#L270C13-L270C69) does the trick:

```
this.logger[hasError ? 'error' : 'info'](webpackOutput);
```

Is there another way, preferably through `bundlerOptions.webpackConfigHook` to not show those webpack logs?


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-07-14 18:26:51.000 UTC</summary>

`Worker.create()` invokes the workflow bundler with its own `Logger`.

You may instead call `bundleWorkflowCode()` directly, which allows passing in a different `Logger`. Prebundling is recommended for production usage.

</details>


---

<a id="1601"></a>

### #1601: result of env.run is not inferring type, returning `unknown`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1601 |
| **State** | OPEN |
| **Author** | chadxz (Chad McElligott) |
| **Created** | 2025-01-17 00:04:00.000 UTC (11 months ago) |
| **Updated** | 2025-01-25 05:22:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to test my activities using env.run and assert against the result.

### Describe the bug

The return type of env.run is `unknown` when I would expect that it would be inferred from the activity.

### Minimal Reproduction

https://codesandbox.io/p/devbox/l363c8

### Environment/Versions

Macbook M2 Pro Sequoia 15.2
`@temporal/testing` 1.11.6

#### Comments (3)

<details>
<summary><strong>chadxz</strong> commented on 2025-01-17 00:05:25.000 UTC</summary>

I can work around the issue by passing explicit types to env.run, i.e.

```ts
        const result = await env.run<
          [UpdateCustomerRelationshipActivityInput],
          Nullable<UpdateCustomerRelationshipActivityResult>,
          typeof updateCustomerRelationship
        >(updateCustomerRelationship, {
          ...
        });
```

</details>

<details>
<summary><strong>chadxz</strong> commented on 2025-01-17 21:11:15.000 UTC</summary>

@mjameswh here's a possible fix for this issue: https://github.com/chadxz/sdk-typescript/commit/5884ef51392a5482f32f1c29908935cf619cfc7f

Main thing i'm not sure about is whether this would be considered a breaking change or not. I imagine if you were previously explicitly specifying the generic type parameters, a change like this may break you.

With the fix, you can see in the test suite that the return type is improved:

<img width="806" alt="Image" src="https://github.com/user-attachments/assets/864157fd-834f-4f95-bcd2-812b3418da56" />

</details>

<details>
<summary><strong>chadxz</strong> commented on 2025-01-25 05:22:16.000 UTC</summary>

Any thoughts on this? I'm happy to submit a PR, just want to make sure I take an appropriate approach.

</details>


---

<a id="1589"></a>

### #1589: [Bug] Tests `Retry on "RST_STREAM with code 0/2` failing since Node 22.12.0 on Windows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1589 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-12-16 13:04:37.000 UTC (1 years ago) |
| **Updated** | 2024-12-18 20:26:18.000 UTC |
| **Closed** | 2024-12-18 20:26:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Description

Integration tests `Retry on "RST_STREAM with code 0"` and `Retry on "RST_STREAM with code 2"` have started failing on Windows since Node v22.12.0.

I don't see anything obvious that would explain this in Node's release notes, and upgrading to latest release of `@grpc/grpc-js` didn't helped (I observed this issue with 1.10.10, 1.11.3 and 1.12.4).

Forcing CI to use Node v22.11.0 resolves the failure.

#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-16 13:25:58.000 UTC</summary>

For now, I'm just disabling these two tests on Windows, for Node releases `22.12.x`...`22.14.x`. We'll revisit once we reach Node v23.15.0.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-16 21:43:41.000 UTC</summary>

This is very likely related due https://github.com/nodejs/node/issues/56137.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-18 20:26:18.000 UTC</summary>

Fixed by #1586.

</details>


---

<a id="1558"></a>

### #1558: [Bug] Payload Converter doesn't work when running as ESM

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1558 |
| **State** | CLOSED |
| **Author** | freshollie (Oliver Bell) |
| **Created** | 2024-11-07 12:22:46.000 UTC (1y 2m ago) |
| **Updated** | 2024-11-19 18:42:14.000 UTC |
| **Closed** | 2024-11-19 18:42:14.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Provide a payload converter when my workers are running as ESM

### Describe the bug

https://github.com/temporalio/sdk-typescript/blob/5c3955fea45599d56312490f9a9957b6e70c6825/packages/common/src/internal-non-workflow/data-converter-helpers.ts#L40

The main code path which to import the data converter always uses `require` which means the format has to be CJS to be imported. Our current workaround is to write our `payload-converter` as `.cjs`.

### Minimal Reproduction

- Just use `payloadConverterPath` in an ESM application which uses the temporal worker.

### Environment/Versions

N/A

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-19 18:42:14.000 UTC</summary>

Thanks for reporting.

This issue is already tracked in #1292. Closing as duplicate.

Reactions: üëç 1

</details>


---

<a id="1555"></a>

### #1555: patched always true inside Signal

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1555 |
| **State** | CLOSED |
| **Author** | ianmateusES (Ian Mateus) |
| **Created** | 2024-09-30 19:03:40.000 UTC (1y 3m ago) |
| **Updated** | 2025-01-21 22:48:47.000 UTC |
| **Closed** | 2025-01-21 22:48:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Required

**What is the issue?**

**How can we reproduce the issue?**

Create a long-running workflow with a signal and start it. Then, make some changes to that signal and use `patched` to point to the new version.

**What is the expected behavior?**



## Example



## Additional context (optional‚Äîthe more we know, the faster it goes)

**Screenshots:**
N/A

**Browser and version:**
N/A

**Device and screen size:**
N/A



## Expected Behavior
Existing workflows are expected to use the previous signal flow, while new ones are redirected by `patched`. However, what happens is that they all end up going to the new flow, since `patched` always returns true.

## Actual Behavior
How patched works inside the setHandler of a Signal. For every patchId set, wf.patched(patchId) returns true

## Steps to Reproduce the Problem

- Workflow v1:

```js
import { sleep, defineSignal, defineQuery, setHandler, log, patched } from '@temporalio/workflow';

export const updateMessage = defineSignal<[string]>('updateMessage');
export const query = defineQuery('query');

export async function longRunningWorkflow(): Promise<void> {
  let message = 'Initial message';

  setHandler(updateMessage, (newMessage: string) => {
    message = newMessage;
  });

  setHandler(query, () => message);

  await sleep(10 * 60 * 1000);
}
```

- Workflow v2:

```js
import { sleep, defineSignal, defineQuery, setHandler, log, patched } from '@temporalio/workflow';

export const updateMessage = defineSignal<[string]>('updateMessage');
export const query = defineQuery('query');

export async function longRunningWorkflow(): Promise<void> {
  let message = 'Initial message';

  setHandler(updateMessage, (newMessage: string) => {
    if (patched('v2')) {
      log.info('Workflow was patched');
      message = newMessage + ' v2';
    } else {
      message = newMessage;
    }
  });

  setHandler(query, () => message);

  await sleep(10 * 60 * 1000);
}
```

## Specifications

  - Version: 1.8.0
  - Platform: Docker v27.3.1


#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-06 00:18:04.000 UTC</summary>

I can't reproduce an incorrect behavior with the code you provided.

Your report indicates you are using TS SDK 1.8.0. I think you are most likely hitting a bug that was fixed in 1.8.5 (see #1234).

Can you please try this with TS SDK v1.11.3? Or if you want to remain on 1.8.x, please update to 1.8.6.

</details>

<details>
<summary><strong>josh-berry</strong> commented on 2024-12-17 21:34:33.000 UTC</summary>

Hi @ianmateusES, did upgrading the SDK resolve this for you?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-21 22:48:46.000 UTC</summary>

Closing as we believe this was fixed in v1.8.6.

</details>


---

<a id="1550"></a>

### #1550: [Feature Request] Expose classes `TextEncoder` and `TextDecoder` in Workflow sandbox

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1550 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-10-22 21:25:27.000 UTC (1y 2m ago) |
| **Updated** | 2024-11-15 23:29:26.000 UTC |
| **Closed** | 2024-11-15 23:29:26.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

## Proposition

Expose [WHATWG's `TextEncode` and `TextDecode` classes](https://nodejs.org/api/util.html#class-utiltextdecoder) in workflow context. 


## Why

- This API includes no feature that could break workflow determinism (e.g. no file IO).
- Users have mentioned the need to use this API from a workflow context.
- At the moment, this requires either delegating this usage to a local activity (or a regular activity) or having users load an appropriate polyfill.

#### Comments (1)

<details>
<summary><strong>lukeramsden</strong> commented on 2024-11-14 17:48:11.000 UTC</summary>

This was useful for my usecase (using typeid-js to generate IDs in workflows, the Math.random stub in the isolate is sufficient as these don't need to be cryptographically secure) so I've opened a PR based on a patch I have locally.

</details>


---

<a id="1510"></a>

### #1510: [Bug] RangeError: "length" is outside of buffer bounds

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1510 |
| **State** | CLOSED |
| **Author** | dandavison (Dan Davison) |
| **Created** | 2024-09-08 13:01:59.000 UTC (1y 4m ago) |
| **Updated** | 2024-10-02 12:14:36.000 UTC |
| **Closed** | 2024-09-09 16:30:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

With node `v22.7.0` the workflow interaction below crashes the worker with the error below in protobufjs. This appears to be the same problem as discussed in https://github.com/protobufjs/protobuf.js/issues/2025, and is fixed by upgrading node to `v22.8.0`.

```
  error: RangeError: "length" is outside of buffer bounds
      at Buffer.proto.utf8Write (node:internal/buffer:1066:13)
      at Op.writeStringBuffer [as fn] (/Users/dan/src/temporalio/sdk-typescript/node_modules/protobufjs/src/writer_buffer.js:61:13)
      at BufferWriter.finish (/Users/dan/src/temporalio/sdk-typescript/node_modules/protobufjs/src/writer.js:453:14)
      at Worker.handleActivation (/Users/dan/src/temporalio/sdk-typescript/packages/worker/src/worker.ts:1166:30) {
    code: 'ERR_BUFFER_OUT_OF_BOUNDS'
```


<details>
<summary>repro</summary>

```typescript
import * as wf from '@temporalio/workflow';
import * as cl from '@temporalio/client';
import * as wo from '@temporalio/worker';

const workflowId = 'wid';
const taskQueue = 'tq';
export const fetchAndAdd = wf.defineUpdate<number, [number]>('fetchAndAdd');

export async function workflow(): Promise<void> {
  var count = 0;

  const handler = (arg: number) => {
    const prevCount = count;
    count += arg;
    return prevCount;
  };

  const validator = (arg: number) => {
    if (arg < 0) {
      throw new Error('Argument must not be negative');
    }
  };

  wf.setHandler(fetchAndAdd, handler, { validator });

  await wf.condition(() => count != 0);
}

async function starter(client: cl.Client): Promise<void> {
  const wfHandle = await client.workflow.start(workflow, {
    taskQueue,
    workflowId,
    workflowIdReusePolicy: cl.WorkflowIdReusePolicy.WORKFLOW_ID_REUSE_POLICY_TERMINATE_IF_RUNNING,
  });
  await wfHandle.executeUpdate(fetchAndAdd, { args: [-1] });
}

async function main(): Promise<void> {
  const worker = await wo.Worker.create({
    workflowsPath: __filename,
    taskQueue,
    bundlerOptions: {
      ignoreModules: ['@temporalio/client', '@temporalio/worker'],
    },
  });
  const connection = await cl.Connection.connect();
  const client = new cl.Client({ connection });
  await worker.runUntil(starter(client));
}

if (!wf.inWorkflowContext()) {
  wo.Runtime.install({ logger: new wo.DefaultLogger('WARN') });
  main().catch((err) => {
    console.error(err);
    process.exit(1);
  });
}
```

</details>


<details>
<summary>Full worker error log </summary>

```
2024-09-08T12:55:58.594Z [ERROR] Worker failed {
  sdkComponent: 'worker',
  taskQueue: 'tq',
  error: RangeError: "length" is outside of buffer bounds
      at Buffer.proto.utf8Write (node:internal/buffer:1066:13)
      at Op.writeStringBuffer [as fn] (/Users/dan/src/temporalio/sdk-typescript/node_modules/protobufjs/src/writer_buffer.js:61:13)
      at BufferWriter.finish (/Users/dan/src/temporalio/sdk-typescript/node_modules/protobufjs/src/writer.js:453:14)
      at Worker.handleActivation (/Users/dan/src/temporalio/sdk-typescript/packages/worker/src/worker.ts:1166:30) {
    code: 'ERR_BUFFER_OUT_OF_BOUNDS'
  }
}
CombinedWorkerRunError: Worker terminated with fatal error in `runUntil`
    at Worker.runUntil (/Users/dan/src/temporalio/sdk-typescript/packages/worker/src/worker.ts:1608:15)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async main (/Users/dan/src/temporalio/samples-typescript/scratchpad/scratchpad.ts:48:3) {
  cause: {
    workerError: RangeError: "length" is outside of buffer bounds
        at Buffer.proto.utf8Write (node:internal/buffer:1066:13)
        at Op.writeStringBuffer [as fn] (/Users/dan/src/temporalio/sdk-typescript/node_modules/protobufjs/src/writer_buffer.js:61:13)
        at BufferWriter.finish (/Users/dan/src/temporalio/sdk-typescript/node_modules/protobufjs/src/writer.js:453:14)
        at Worker.handleActivation (/Users/dan/src/temporalio/sdk-typescript/packages/worker/src/worker.ts:1166:30) {
      code: 'ERR_BUFFER_OUT_OF_BOUNDS'
    },
    innerError: ServiceError: Workflow Update failed
        at WorkflowClient.rethrowGrpcError (/Users/dan/src/temporalio/sdk-typescript/packages/client/src/workflow-client.ts:754:13)
        at WorkflowClient.rethrowUpdateGrpcError (/Users/dan/src/temporalio/sdk-typescript/packages/client/src/workflow-client.ts:739:10)
        at WorkflowClient._startUpdateHandler (/Users/dan/src/temporalio/sdk-typescript/packages/client/src/workflow-client.ts:841:12)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at async _startUpdate (/Users/dan/src/temporalio/sdk-typescript/packages/client/src/workflow-client.ts:1113:22)
        at async Object.executeUpdate (/Users/dan/src/temporalio/sdk-typescript/packages/client/src/workflow-client.ts:1190:24)
        at async starter (/Users/dan/src/temporalio/samples-typescript/scratchpad/scratchpad.ts:35:3)
        at async /Users/dan/src/temporalio/sdk-typescript/packages/worker/src/worker.ts:1597:16
        at async Promise.allSettled (index 0)
        at async Worker.runUntil (/Users/dan/src/temporalio/sdk-typescript/packages/worker/src/worker.ts:1604:44) {
      cause: [Error]
    }
  }
}
```

</details>

#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-09 13:32:32.000 UTC</summary>

What are you suggesting? Looks like that's a bug in Node itself, and there's really nothing we can do on our side‚Ä¶

</details>

<details>
<summary><strong>dandavison</strong> commented on 2024-09-09 16:30:20.000 UTC</summary>

We're keeping this issue in the `sdk-typescript` repo so that anyone who hits the problem while using the Typescript SDK will find it, and learn that it's a node issue that can be resolved by using a different node version (we've already seen reports from users who've hit it and assumed it was a problem with `sdk-typescript`).

Beyond that, it looks like this affects node v22.7.0 only. I'm not sure what proportion of our users will be likely to attempt to use that node version in the future. If this is going to be a common problem for users, one thing that might be possible is to catch the error and output a helpful error message.

Reactions: üëç 1

</details>

<details>
<summary><strong>hejbiLLLLL</strong> commented on 2024-10-02 11:58:20.000 UTC</summary>

Hi! 

I am experiencing this problem whilst using node LTS (v20.17.0) _and/or_ v22.9.0 and temporal v1.1.0 on a Mac (M1). My colleague running the same versions on Linux can't replicate the issue running the exact same code. 

Any advice?  


**EDIT:** Solved! We had mismatching versions of the temporal packages:
```
"@temporalio/activity": "^1.11.2",
"@temporalio/common": "^1.11.2",
"@temporalio/worker": "^1.11.2",
"@temporalio/workflow": "^1.11.2"
```
Some were 1.11.1 while some were 1.11.2, so bumping them all to the same version solved the issue. 

</details>


---

<a id="1489"></a>

### #1489: [Bug] Critical dependency: the request of a dependency is an expression

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1489 |
| **State** | OPEN |
| **Author** | shadiramadan (Shadi Ramadan) |
| **Created** | 2024-08-07 23:43:36.000 UTC (1y 5m ago) |
| **Updated** | 2024-09-13 16:33:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to build / run a Next.js application without any warnings or errors.  I am only using the @temporalio/client to be able to Signal workflows.

### Describe the bug

I have a `server-only` file that imports the client:
```typescript
import { Client, Connection } from "@temporalio/client";
```

The client is used in some server side logic. When running next as a build or in dev mode (and loading a page that references the import).  I get the following error:
```
./node_modules/.pnpm/@temporalio+common@1.10.3/node_modules/@temporalio/common/lib/internal-non-workflow/data-converter-helpers.js
Critical dependency: the request of a dependency is an expression

Import trace for requested module:
./node_modules/.pnpm/@temporalio+common@1.10.3/node_modules/@temporalio/common/lib/internal-non-workflow/data-converter-helpers.js
./node_modules/.pnpm/@temporalio+common@1.10.3/node_modules/@temporalio/common/lib/internal-non-workflow/index.js
./node_modules/.pnpm/@temporalio+client@1.10.3/node_modules/@temporalio/client/lib/async-completion-client.js
./node_modules/.pnpm/@temporalio+client@1.10.3/node_modules/@temporalio/client/lib/index.js
./src/lib/temporal.ts
./src/lib/auth/index.ts
./src/app/[locale]/layout.tsx
```

### Minimal Reproduction

Load the temporal client on the server side.

### Environment/Versions

```
OS: MacOS Sonoma 14.5 (23F79)
Package: "@temporalio/client": "^1.10.3",
Node: v20.16.0
```

### Additional context

My signal workflow logic works fine.  The error also occurs in a linux based docker image.

#### Comments (3)

<details>
<summary><strong>shadiramadan</strong> commented on 2024-08-08 01:57:57.000 UTC</summary>

Possibly related #1292

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-10 17:19:19.000 UTC</summary>

> Possibly related 1292

That touches the same part of the code, but the use case is very different.

Implementing #1458 is certainly part of the solution, but I'm afraid that will not be enough to avoid the build error people are seeing when bundling the client.

</details>

<details>
<summary><strong>shadiramadan</strong> commented on 2024-09-13 16:33:27.000 UTC</summary>

@mjameswh Do you know how to work around this error in the temporal client or is it unavoidable at this time?

</details>


---

<a id="1468"></a>

### #1468: [Bug] Interceptors Don't Seem to Support Module Alias

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1468 |
| **State** | CLOSED |
| **Author** | ccravens (Chad Cravens) |
| **Created** | 2024-07-21 15:21:05.000 UTC (1y 5m ago) |
| **Updated** | 2024-07-25 19:16:08.000 UTC |
| **Closed** | 2024-07-25 19:16:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
I'm trying to be able to use my module-alias imports with worker interceptors.

### Describe the bug

I use `"module-alias": "2.2.2"` in my project to create a root path for all of my imports. So instead of doing:

```typescript
import { X } from '../../../../../very/long/path';
```

I can just do:

```typescript
import { X } from '~/very/long/path';
```

However when creating a worker with interceptors:

```typescript
const worker = await Worker.create({
      connection: await NativeConnection.connect({
        address: `${process.env.TEMPORAL_HOST}:${process.env.TEMPORAL_PORT}`,
      }),
      namespace: 'ns',
      taskQueue: 'queue',
      identity: `worker-${Utils.node._id}`,
      ...(Utils.production && {
        workflowBundle: {
          codePath: require.resolve('../temporal/workflow-bundle.js'),
        },
      }),
      ...(!Utils.production && { workflowsPath: require.resolve('../temporal/workflows') }),
      activities,
      interceptors: {
        workflowModules: [require.resolve('../temporal/interceptors/temporal.interceptor')], // <<< Import Interceptor here <<<
      },
    });
```

and my Interceptor:
```typescript
import { TemporalWorkflowsService } from '~/services/models/temporal-workflows.service'; // <<< THIS BREAKS

class InboundInterceptor implements WorkflowInboundCallsInterceptor {
  constructor(
    public readonly workflowId: string,
    public readonly workflowType: string,
    temporalWorkflowsService: TemporalWorkflowsService
  ) {}

  async execute(
    input: WorkflowExecuteInput,
    next: Next<WorkflowInboundCallsInterceptor, 'execute'>
  ): Promise<unknown> {
    console.log(`>>> INBOUND: execute(): ${this.workflowType}[${this.workflowId}]`);
    try {
      return await next(input);
    } finally {
      console.log(`>>> INBOUND: Finished execute(): ${this.workflowType}[${this.workflowId}]`);
    }
  }
  ...
  }
```
It does not seem to recognize the module alias.

What's worse is not only do I now have to convert my imports from `~` to `../../../..` for the import in the interceptor but also recursively ALL other dependencies. Is there a better way to address this?

### Environment/Versions
Apple M2 Max Sonoma 14.5
```
    "@temporalio/activity": "1.10.1",
    "@temporalio/client": "1.10.1",
    "@temporalio/worker": "1.10.1",
    "@temporalio/workflow": "1.10.1",
    ```
Using the docker-compose on my local dev machine



#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2024-07-25 18:39:55.000 UTC</summary>

> It does not seem to recognize the module alias.

What's the symptom. Do you get an error message, or is this silently failing?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-07-25 18:59:45.000 UTC</summary>

Two things:

1. Your worker uses prebundled Workflows in production environment. Workflow Interceptors passed directly through `WorkerOptions` will be silently ignored in that case. You need to pass the list of Workflow Interceptors, together with your Workflow Code, to the `bundleWorkflowCode()` function. See [`BundleOptions.workflowInterceptorModules`](https://typescript.temporal.io/api/interfaces/worker.BundleOptions#workflowinterceptormodules).

2. `module-alias`'s magic doesn't automatically extend to bundlers. You will therefore need to provide specific configuration to the Workflow Bundler to apply your aliases. Based on [module-alias example for Webpack](https://github.com/ilearnio/module-alias?tab=readme-ov-file#usage-with-webpack), that should look something like:

```
const npm_package = require('./package.json');
const myAliases = npm_package._moduleAliases;

webpackConfigHook: (config) => {
  if (config.resolve) {
    config.resolve.alias = {
      ...config.resolve.alias,
      ...myAliases,
    };
  }
  return config;
}
```

Make sure to include this `webpackConfigHook` function in both your Worker's options (for dev usage) and `bundleWorkflowCode()`'s options (for production builds).

</details>

<details>
<summary><strong>ccravens</strong> commented on 2024-07-25 19:16:08.000 UTC</summary>

Hello @mjameswh!

Thank you very much for getting back to me on this. I've really been working on this the past couple of days and I was able to find a reference to the webpackConfigHook in another issue and was able to update to this:

```typescript
const { code } = await bundleWorkflowCode({
      workflowsPath: require.resolve('~/temporal/workflows'),
      workflowInterceptorModules: [require.resolve('~/temporal/interceptors/temporal.interceptor')],
      logger: new TemporalLogger(),
      webpackConfigHook: (config: Configuration) => {
        if (config.resolve) {
          config.resolve.plugins = [
            ...(config.resolve.plugins ?? []),
            new TsconfigPathsPlugin({
              configFile: path.resolve(__dirname, '../../tsconfig.json'),
            }),
          ];
        }

        return config;
      },
      ignoreModules: [],
    });
```

I learned more about webpack the past couple of days than I have ever wanted to lol

I meant to update this issue, I appreciate your response on this and it is the correct solution. I'll close now, thanks again!

Reactions: üëç 1

</details>


---

<a id="1464"></a>

### #1464: [Feature Request] Allow dev server version to be explicitly provided and mark some options as unstable

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1464 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-07-15 19:22:35.000 UTC (1y 5m ago) |
| **Updated** | 2024-07-26 13:37:27.000 UTC |
| **Closed** | 2024-07-25 21:36:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Users should be able to put a specific version in for downloading dev server. Also, we should make it clear (as we do in Python) that besides the obvious arguments, other arguments may not be stable and could change when the underlying implementation is swapped out. This is especially true for "extra args".

#### Comments (3)

<details>
<summary><strong>josh-berry</strong> commented on 2024-07-16 16:12:04.000 UTC</summary>

@cretz Should we not do this in all languages? Or is it just missing in TypeScript?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-07-25 20:14:19.000 UTC</summary>

> Users should be able to put a specific version in for downloading dev server.

That's already supported:

```
TestWorkflowEnvironment.createLocal({
  server: {
    executable: {
      type: 'cached-download',
      version: 'v0.13.2',
    },
  },
}
```
‚Ä¶ and similar for time skipping server.

> Also, we should make it clear that besides the obvious arguments, other arguments may not be stable and could change when the underlying implementation is swapped out. This is especially true for "extra args".

Good point. I'll review the docstrings.

</details>

<details>
<summary><strong>cretz</strong> commented on 2024-07-26 13:37:25.000 UTC</summary>

> @cretz Should we not do this in all languages? Or is it just missing in TypeScript?

Sorry, missed this (I get notified for every TS thing and ignore usually and GH notifications doesn't differentiate mentions from every other notification). It is in other languages already (though the statement on instability of advanced arguments only in Python and .NET, not Go that I see).

</details>


---

<a id="1457"></a>

### #1457: [Feature Request] Support "query" when listing schedules

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1457 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-07-08 14:23:49.000 UTC (1y 6m ago) |
| **Updated** | 2024-10-08 05:24:18.000 UTC |
| **Closed** | 2024-10-08 05:24:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Need to support the query option when listing schedules same as we do when listing workflows.


#### Comments (3)

<details>
<summary><strong>nikhilbhatia08</strong> commented on 2024-09-20 17:16:03.000 UTC</summary>

@cretz I would like to work on this issue.
What I would be doing: As we have ListOptions for workflows which gives us the number of results based on the query similarly, I would do it to list schedules with query which will match with the existsing schedules and order the results, pageSize which would set max number of results to fetch per page. Please can I work on it.

</details>

<details>
<summary><strong>antlai-temporal</strong> commented on 2024-09-23 20:08:27.000 UTC</summary>

Hi Nikhil, I was about to start on this, but if you are interested, give it a try, and I'll help with the reviews instead...

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-10-08 05:24:18.000 UTC</summary>

Fix by #1535.

</details>


---

<a id="1425"></a>

### #1425: [Feature Request] Add OTEL tracing information as attribute on log messages emitted using Workflow Logger

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1425 |
| **State** | CLOSED |
| **Author** | lucaskatayama (Lucas Katayama) |
| **Created** | 2024-05-21 22:23:16.000 UTC (1y 7m ago) |
| **Updated** | 2025-03-02 12:22:35.000 UTC |
| **Closed** | 2024-11-19 17:52:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Get OpenTelemetry `trace_id` and `span_id` fields on Workflow **logs**.

### Describe the bug

The tracing fields from OpenTelemetry (`trace_id` and `span_id`) is not appearing on Workflow logs specifically.

It works on Client and Activities.

Calling `worflow.log.error`:
```json
{"label":"workflow","level":"error","message":"hello","namespace":"default","runId":"add5d842-ca36-4fee-8e51-624d7b2bb58c","sdkComponent":"workflow","taskQueue":"interceptors-opentelemetry-example","timestamp":1716328238734,"workflowId":"otel-example-0","workflowType":"example"}
```

Calling `activity.log.error`
```json
{"activityId":"1","activityType":"greet","attempt":1,"isLocal":false,"label":"activity","level":"error","message":"alskjdbnkajsdbnkjandsjk","namespace":"default","sdkComponent":"activity","span_id":"10036d093b04a315","taskQueue":"interceptors-opentelemetry-example","taskToken":"CiRjYmI4ODI1My0wOWMyLTRiMzMtOWI3YS05MTQ5ODFhMzdjM2USDm90ZWwtZXhhbXBsZS0wGiRhZGQ1ZDg0Mi1jYTM2LTRmZWUtOGU1MS02MjRkN2IyYmI1OGMgBSgBMgExQgVncmVldEoICAEQxo5AGAE=","timestamp":1716328238737,"trace_flags":"01","trace_id":"f2731bb716c062624923e55b29f8fcec","workflowId":"otel-example-0","workflowRunId":"add5d842-ca36-4fee-8e51-624d7b2bb58c","workflowType":"example"}
```

Which gives `"span_id":"10036d093b04a315"` and `"trace_id":"f2731bb716c062624923e55b29f8fcec"`.

### Minimal Reproduction

1. From  `interceptors-opentelemetry` sample: https://github.com/temporalio/samples-typescript/tree/main/interceptors-opentelemetry
2. Enable OpenTelemetry Auto Instrumentation for JS for `winston` (https://opentelemetry.io/docs/languages/js/automatic/)

```
export OTEL_NODE_RESOURCE_DETECTORS="env,host,os,serviceinstance"
export OTEL_SERVICE_NAME="client"
export NODE_OPTIONS="--require @opentelemetry/auto-instrumentations-node/register"
export OTEL_NODE_ENABLED_INSTRUMENTATIONS="winston,http"
```
4. Enable `custom-logger` using https://github.com/temporalio/samples-typescript/tree/main/custom-logger
5. Log on Workflow

```typescript
import * as workflow from "@temporalio/workflow"

// A workflow that simply calls an activity
export async function example(name: string): Promise<string> {
  workflow.log.error("hello");
  return await greet(name);
}
```

6. Log on Activity
```typescript
import * as activity from "@temporalio/activity"

export async function greet(name: string): Promise<string> {
  activity.log.error("alskjdbnkajsdbnkjandsjk")
  return `Hello, ${name}!`;
}
```

7. Call client to execute workflow (`npm run workflow`)

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M2 Mac
- Temporal Version: 
```
‚ùØ temporal --version
temporal version 0.12.0 (server 1.23.0) (ui 2.26.2)
```
- Are you using Docker or Kubernetes or building Temporal from source? No

### Additional context

- The trace_id and span_id are generated but they doesn't appear on logs and are being reported to newrelic correctly, because they appear on distributed tracing.

From `ConsoleSpanExporter`
```
{
  resource: { attributes: { 'service.name': 'interceptors-sample-worker' } },
  traceId: 'd498bbf00762a58fc78c022804644789', <<<<<<<<<<
  parentId: '38b7d260146c73e6', <<<<<<<<
  traceState: undefined,
  name: 'RunWorkflow:example',
  id: 'aaa81665fd7d1198',
  kind: 0,
  timestamp: 1716328235467000,
  duration: 46000,
  attributes: {
...
{
  resource: { attributes: { 'service.name': 'interceptors-sample-worker' } },
  traceId: 'd498bbf00762a58fc78c022804644789',
  parentId: 'aaa81665fd7d1198',
  traceState: undefined,
  name: 'StartActivity:greet',
  id: 'aec76af986522d29',
  kind: 0,

```

- I think is a problem with `winston` + `opentelemetry` on workflow context only, because it only occurs on Workflows... everywhere else is working.
- I put the code here https://github.com/lucaskatayama/temporal-otel

#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-27 19:56:28.000 UTC</summary>

This is not a bug. It just can't work that way.

In the TS SDK, Workflows execute [in a sandboxed environment](https://docs.temporal.io/dev-guide/typescript/foundations#workflow-logic-requirements). Among other things, that implies that Workflow Code can't do any I/O, and therefore, [can't interact with a regular Node.js logger](https://docs.temporal.io/dev-guide/typescript/observability#logging-from-workflows).

Instead, log messages emitted using the Workflow context logger are funneled through a [Workflow Sink](https://docs.temporal.io/dev-guide/typescript/observability#implementing-custom-logging-like-features-based-on-workflow-sinks) to the Runtime logger. Now, Sinks are an advanced feature of the TS SDK, but essentially, that means that messages are queued internally in the Workflow context for the duration of a Workflow Activation; at the end of an Activation, queued Sink Calls are passed from the Workflow Worker Thread, through a [V8 MessagePort](https://nodejs.org/docs/latest/api/worker_threads.html#class-messageport), back to the main SDK thread, where they get processed (in this case, passing them to the Runtime logger, which in your case would be an instance of Winston's Logger class).

Note that, at the time that the call is actually passed to the Winston's Logger, execution is no longer contained by the OpenTelemetry call scope, and therefore, the OpenTelemetry Auto Instrumentation can't attach these calls to the parent context.

Note also that the `@opentelemetry/auto-instrumentations-node` plugin can't reach into the Workflow sandbox, or get loaded there, as that plugin would bring in dependencies on various non-deterministic-safe modules.

**The solution**

What you can do instead is to register a `WorkflowOutboundInterceptor` on your Workflow Worker that intercepts the `getLogAttributes` function and injects the `trace_id` and `span_id` attributes from there. I think the following should work (untested):

```
export class OpenTelemetryTraceInLogsWorkflowOutboundInterceptor implements WorkflowOutboundCallsInterceptor {
  public getLogAttributes(
    input: GetLogAttributesInput,
    next: Next<WorkflowOutboundCallsInterceptor, 'getLogAttributes'>
  ): Record<string, unknown> {
    const span = otel.trace.getSpan(otel.context.active());
    const spanContext = span?.spanContext();
    if (spanContext && otel.isSpanContextValid(spanContext)) {
      return next({
        trace_id: spanContext.traceId,
        span_id: spanContext.spanId,
        trace_flags: `0${spanContext.traceFlags.toString(16)}`,
        ...input,
      });
    } else {
      return next(input);
    }
  }
}
```

I certainly agree that it would make sense to be done out of the box by our `@temporalio/interceptors-opentelemetry` Workflow Interceptor. I'll therefore keep this ticket open as a feature request.

Reactions: üëç 1 üéâ 1 üëÄ 1

</details>

<details>
<summary><strong>lucaskatayama</strong> commented on 2024-05-28 03:42:25.000 UTC</summary>

> This is not a bug. It just can't work that way.
> 
> In the TS SDK, Workflows execute [in a sandboxed environment](https://docs.temporal.io/dev-guide/typescript/foundations#workflow-logic-requirements). Among other things, that implies that Workflow Code can't do any I/O, and therefore, [can't interact with a regular Node.js logger](https://docs.temporal.io/dev-guide/typescript/observability#logging-from-workflows).
> 
> Instead, log messages emitted using the Workflow context logger are funneled through a [Workflow Sink](https://docs.temporal.io/dev-guide/typescript/observability#implementing-custom-logging-like-features-based-on-workflow-sinks) to the Runtime logger. Now, Sinks are an advanced feature of the TS SDK, but essentially, that means that messages are queued internally in the Workflow context for the duration of a Workflow Activation; at the end of an Activation, queued Sink Calls are passed from the Workflow Worker Thread, through a [V8 MessagePort](https://nodejs.org/docs/latest/api/worker_threads.html#class-messageport), back to the main SDK thread, where they get processed (in this case, passing them to the Runtime logger, which in your case would be an instance of Winston's Logger class).
> 
> Note that, at the time that the call is actually passed to the Winston's Logger, execution is no longer contained by the OpenTelemetry call scope, and therefore, the OpenTelemetry Auto Instrumentation can't attach these calls to the parent context.
> 
> Note also that the `@opentelemetry/auto-instrumentations-node` plugin can't reach into the Workflow sandbox, or get loaded there, as that plugin would bring in dependencies on various non-deterministic-safe modules.
> 
> **The solution**
> 
> What you can do instead is to register a `WorkflowOutboundInterceptor` on your Workflow Worker that intercepts the `getLogAttributes` function and injects the `trace_id` and `span_id` attributes from there. I think the following should work (untested):
> 
> ```
> export class OpenTelemetryTraceInLogsWorkflowOutboundInterceptor implements WorkflowOutboundCallsInterceptor {
>   public getLogAttributes(
>     input: GetLogAttributesInput,
>     next: Next<WorkflowOutboundCallsInterceptor, 'getLogAttributes'>
>   ): Record<string, unknown> {
>     const span = otel.trace.getSpan(otel.context.active());
>     const spanContext = span?.spanContext();
>     if (spanContext && otel.isSpanContextValid(spanContext)) {
>       return next({
>         input,
>         trace_id: spanContext.traceId,
>         span_id: spanContext.spanId,
>         trace_flags: `0${spanContext.traceFlags.toString(16)}`,
>       });
>     } else {
>       return next(input);
>     }
>   }
> }
> ```
> 
> I certainly agree that it would make sense to be done out of the box by our `@temporalio/interceptors-opentelemetry` Workflow Interceptor. I'll therefore keep this ticket open as a feature request.

Yep... That WORKED @mjameswh !

I think that piece of code could be in `@temporalio/interceptors-opentelemetry` ... Or at least documented ...

Thanks!



</details>

<details>
<summary><strong>safareli</strong> commented on 2025-02-28 18:17:43.000 UTC</summary>

I followed https://github.com/temporalio/samples-typescript/blob/main/interceptors-opentelemetry/src/worker.ts#L20
and I do get traces but I do not get trace id's on logs emmited from workflows. did anyone made that part work?

UPDATE:

issue was that even tho we have trace and span id in logger, the node instrumentation  libs don't quite respect it I had to do this:


```ts
function timestampNanosToHrTime(timestampNanos: bigint): [number, number] {
  // Calculate seconds by dividing nanoseconds by 1e9 and getting the whole number
  const seconds = Number(timestampNanos / BigInt(1e9));

  // Calculate remaining nanoseconds using modulo
  const nanos = Number(timestampNanos % BigInt(1e9));

  return [seconds, nanos];
}

const logLevelToSeverityNumber = {
  TRACE: SeverityNumber.TRACE,
  DEBUG: SeverityNumber.DEBUG,
  INFO: SeverityNumber.INFO,
  WARN: SeverityNumber.WARN,
  ERROR: SeverityNumber.ERROR,
} as const;




Runtime.install({
  logger: new DefaultLogger("ERROR", ({ message, ...entry_ }) => {
      logs.getLogger("temporal-workflow").emit({
        severityNumber: logLevelToSeverityNumber[entry_.level],
        body: message,
        severityText: entry_.level.toLowerCase(),
        timestamp: timestampNanosToHrTime(entry_.timestampNanos),
        observedTimestamp: timestampNanosToHrTime(entry_.timestampNanos),
        attributes: entry_.meta,
      });
    }),
  ...
```


PR for reference https://github.com/temporalio/samples-typescript/pull/415

Reactions: üöÄ 1

</details>


---

<a id="1392"></a>

### #1392: Support for WorkflowIdConflictPolicy

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1392 |
| **State** | CLOSED |
| **Author** | josh-berry (Josh Berry) |
| **Created** | 2024-04-11 00:40:11.000 UTC (1y 9m ago) |
| **Updated** | 2024-11-15 22:58:40.000 UTC |
| **Closed** | 2024-11-15 22:58:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/features/issues/437

#### Comments (3)

<details>
<summary><strong>stephanos</strong> commented on 2024-07-24 17:41:07.000 UTC</summary>

NOTE: Please don't forget SignalWithStart API.

</details>

<details>
<summary><strong>hugo082</strong> commented on 2024-10-30 14:41:40.000 UTC</summary>

Hi there, any updates on this feature? I see the PR is inactive since several month.
AFAIK TS sdk is the only one missing this feature

</details>

<details>
<summary><strong>stephanos</strong> commented on 2024-10-30 15:53:44.000 UTC</summary>

Good question; the [PR seems to still be blocked](https://github.com/temporalio/sdk-typescript/pull/1490); I'll ask again.

Reactions: üëç 1

</details>


---

<a id="1342"></a>

### #1342: [Bug] Runtime fails to start with OtelCollectorExporter configured

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1342 |
| **State** | CLOSED |
| **Author** | ksapchuk (Kirill) |
| **Created** | 2024-01-17 21:13:14.000 UTC (1y 11m ago) |
| **Updated** | 2024-01-25 14:49:32.000 UTC |
| **Closed** | 2024-01-25 14:49:31.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?
I updated to the latest typescript SDK 1.9.0 and the worker is failing to start with the `OtelCollectorExporter` settings enabled. 

### Describe the bug
When calling `Runtime.install` the worker crashes with the following error. Passing in an empty `headers` map seems to work but the parameter is labeled optional and was not required in the previous SDK version. 
```
Failed to build otlp exporter options: UninitializedField("headers")
TypeError: Failed to build otlp exporter options: UninitializedField("headers")
     at /Users/kirill/src/sparta/node_modules/@temporalio/core-bridge/index.js:16:14
     at Function.create (/Users/kirill/src/sparta/node_modules/@temporalio/worker/src/runtime.ts:206:31)
     at Function.install (/Users/kirill/src/sparta/node_modules/@temporalio/worker/src/runtime.ts:179:17)
     at runWorker (/Users/kirill/src/sparta/packages/api/src/entrypoints/TemporalWorker.ts:305:11)
     at start (/Users/kirill/src/sparta/packages/api/src/entrypoints/TemporalWorker.ts:517:9)
     at processTicksAndRejections (node:internal/process/task_queues:95:5)
```

### Minimal Reproduction
This fails
```
  Runtime.install({
    telemetryOptions: {
      metrics: {
        otel: {
          metricsExportInterval: '60s',
          url: 'grpc://0.0.0.0:4316',
        },
      },
    },
  });
```
This works
```
  Runtime.install({
    telemetryOptions: {
      metrics: {
        otel: {
          metricsExportInterval: '60s',
          url: 'grpc://0.0.0.0:4316',
          headers: {}
        },
      },
    },
  });
```

### Environment/Versions
- OS and processor: M1 Mac
- Temporal Version: typescript 1.9.0


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2024-01-18 23:12:06.000 UTC</summary>

Thanks for reporting, this is an easy fix. We should take this on soon @mjameswh.

</details>


---

<a id="1332"></a>

### #1332: [Feature Request] `TestWorkflowEnvironment` should support non-spawned servers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1332 |
| **State** | OPEN |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2024-01-05 19:02:48.000 UTC (2 years ago) |
| **Updated** | 2024-01-05 19:24:08.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

Right now there's not an easy way to run integration tests against an already-extant server. The tests always spawn one for you. It's nice to be able to use UI, maintain some history of runs, etc, while working through something.

An env var where you specify the addr/port of an already-on server would be great.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2024-01-05 19:24:07.000 UTC</summary>

In Python you can start a test env from a client.

We should support instantiation from a `Connection`.
I would rather also have the worker be powered by the same connection to avoid translating between the objects, the pure JS `Connection` class has some options that can't be translated to `NativeConnection`.

</details>


---

<a id="1309"></a>

### #1309: [Bug] Comment unclear on when activities are cancelled after calling `Worker.shutdown`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1309 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-12-05 22:00:56.000 UTC (2y 1m ago) |
| **Updated** | 2024-09-27 17:52:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

It should mention that the activities are cancelled after `shutdownGraceTime`.

https://github.com/temporalio/sdk-typescript/blob/28d4de33a2697c949b863d1c541063384c4fcc7c/packages/worker/src/worker.ts#L733

#### Comments (3)

<details>
<summary><strong>gaurava05</strong> commented on 2023-12-20 10:07:03.000 UTC</summary>

Can I pick this up? I am new to this repo, let me know where I should start.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-12-22 04:31:18.000 UTC</summary>

@gaurav7019 sure, thanks‚Äîyou can submit a PR that edits the comment linked to above

</details>

<details>
<summary><strong>nikhilbhatia08</strong> commented on 2024-09-20 16:40:07.000 UTC</summary>

@lorensr I would like to submit a PR that edits the comment

</details>


---

<a id="1248"></a>

### #1248: [Bug] Unable to provide Authorization header for a client Connection - CallCredentials does not appear to work

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1248 |
| **State** | CLOSED |
| **Author** | atomicleopard (Atomic Leopard) |
| **Created** | 2023-09-14 11:56:22.000 UTC (2y 3m ago) |
| **Updated** | 2023-10-17 21:18:24.000 UTC |
| **Closed** | 2023-10-17 21:18:24.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

I have a typescript server that is both a worker and client of a temporal cluster deployed into an Azure Kubernetes cluster.
The temporal cluster uses Azure AD for authorised access, and I'm required to send a JWT for access `Authorization: Bearer <access-token>`
I have been unable to get the Workflow client to successfully connect

### Describe the bug

I believe that the ChannelCredentials, and hence the CallCredentials are just not applied to the Connection the way I am using the typescript library.

I have tried multiple different approaches, but have found it hard to debug. I have also not found many good examples, but I believe the below approaches are all valid methods that are expected to work.

Method 1 - createFromGoogleCredential

```typescript
const client: CurrentOAuth2Client = {
  getRequestHeaders: async () => {
    const { access_token } = await auth.getAccessToken()
    return { authorization: `Bearer ${access_token}` }
  },
}
const creds: ChannelCredentials = credentials.combineChannelCredentials(
  credentials.createSsl(),
  CallCredentials.createFromGoogleCredential(client),
)
const connection = await Connection.connect({ address: temporalHost, credentials: creds })
```

Method 2 - createFromMetadataGenerator

```typescript
const callCredentials: CallMetadataGenerator = async (options: CallMetadataOptions, cb: (err: Error | null, metadata?: any) => void) => {
  try {
    const { access_token } = await auth.getAccessToken()
    const meta = new Metadata()
    meta.set('authorization', `Bearer ${access_token}`)
    cb(null, meta)
  } catch (e) {
    TemporalClientModule.logger.error(`Failed Setting authorization header from access token: ${e.message}`)
    cb(e, null)
  }
}
const creds: ChannelCredentials = ChannelCredentials
                                 .createSsl()
                                 .compose(CallCredentials.createFromMetadataGenerator(callCredentials as any))
const connection = await Connection.connect({ address: temporalHost, credentials: creds })
```

### Minimal Reproduction

Unfortunately I am unable to reproduce or create a reproduction locally - it is documented as far as i can tell that when not using TLS, no metadata headers will be sent.

What I can see both locally and remotely, if I add an interceptor and log the channel and call credentials on a request there is nothing there.
```typescript
 const authorizationInterceptor: Interceptor = (
  options: InterceptorOptions,
  nextCall: NextCall,
): InterceptingCall => {
  TemporalClientModule.logger.log({
    msg: 'Temporal interceptor',
    options,
    credentialSupplier: options.credentials,
  })
  return new InterceptingCall(nextCall(options))
}
```
Which logs 
```json
{
"options": {
    "credentials": {},
    "interceptors": [null, null ],
    "deadline": 1694685239159,
    "method_definition": {
      "path": "/temporal.api.workflowservice.v1.WorkflowService/GetSystemInfo",
      "requestStream": false,
      "responseStream": false
    },
  }
}
```

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

@temporalio/client - 1.8.4

### Additional context

I believe the issue comes from [this line](https://github.com/temporalio/sdk-typescript/blob/e769006fca5dc2817be79b3250b2757f46454bce/packages/client/src/connection.ts#L117). In essence I believe that this removes credentials from the resolved options.

```typescript
const { tls: tlsFromConfig, credentials, ...rest } = options || {};
// ...
if (tls) {
// ...
} else {
  return rest;
}
```

<!-- Add any other context about the problem here. -->


#### Comments (1)

<details>
<summary><strong>atomicleopard</strong> commented on 2023-09-19 01:09:24.000 UTC</summary>

Just an update, I have only been able to produce one viable workaround:

1. Create the connection with static metadata with a valid Authorization header - this obviously is only valid for a limited duration
2. Exclude credentials from the initial connection creation
3. Use an interceptor to add a header on call start to override the initial access_token after expiry

```typescript
const connection = Connection.connect({
   address,
   interceptors: [makeGrpcRetryInterceptor(defaultGrpcRetryOptions()), authorizationInterceptor],
   metadata: {
      authorization: `Bearer ${access_token}`,
   },
})
```

```typescript
const authorizationInterceptor: Interceptor = (options: InterceptorOptions, nextCall: NextCall): InterceptingCall => {
   return new InterceptingCall(nextCall(options), {
      start: (metadata: Metadata, listener: InterceptingListener, next: (metadata: MetadataImpl, listener: InterceptingListener | Listener) => void) => {
         auth.getAccessToken().then(({ access_token }) => {
            metadata.set('authorization', `Bearer ${access_token}`)
            next(metadata, listener)
         })
      },
   })
}
```

I tried using patch-package on the above destructuring, but that wasn't enough to get the provided credentials to work, so I think there are some nuanced problems here. I also don't know what proportion is down to how authorisation is implemented in our temporal cluster, but hopefully this report is helpful in improving the library or for someone who needs a similar workaround.


</details>


---

<a id="1224"></a>

### #1224: [Bug] `RangeError: Maximum call stack size exceeded` on Worker shutdown

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1224 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-08-25 17:20:15.000 UTC (2y 4m ago) |
| **Updated** | 2023-09-12 17:10:27.000 UTC |
| **Closed** | 2023-09-12 17:10:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Two slack users reported seeing Worker crashes at shutdown time (after reaching the 'STOPPED' state), with the following error message:

```
RangeError: Maximum call stack size exceeded
    at OperatorSubscriber.<anonymous> (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/util/lift.ts:26:16)
    at <appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Observable.ts:226:22
    at Object.errorContext (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/util/errorContext.ts:29:5)
    at Observable.subscribe (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Observable.ts:220:5)
    at subscribeToSource (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/repeat.ts:151:30)
    at resubscribe (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/repeat.ts:145:13)
    at subscribeToSource (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/repeat.ts:166:13)
( ... 6438 lines removed, jumping between repeat.ts:166:13 and repeat.ts:145:13 )
    at resubscribe (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/repeat.ts:145:13)
    at <appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/repeat.ts:155:19
    at OperatorSubscriber._this._complete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:92:13)
    at OperatorSubscriber.Subscriber.complete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Subscriber.ts:106:12)
    at checkComplete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/mergeInternals.ts:48:18)
    at OperatorSubscriber.onFinalize (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/mergeInternals.ts:125:15)
    at OperatorSubscriber.unsubscribe (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:109:33)
    at OperatorSubscriber._this._complete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:98:18)
    at OperatorSubscriber.Subscriber.complete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Subscriber.ts:106:12)
    at OperatorSubscriber.Subscriber._complete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Subscriber.ts:132:24)
    at OperatorSubscriber.Subscriber.complete (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Subscriber.ts:106:12)
    at <appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/take.ts:65:28
    at OperatorSubscriber._this._next (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
    at OperatorSubscriber.Subscriber.next (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/Subscriber.ts:75:12)
    at AsyncAction.<anonymous> (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/observable/timer.ts:173:20)
    at AsyncAction._execute (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/scheduler/AsyncAction.ts:120:12)
    at AsyncAction.execute (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/scheduler/AsyncAction.ts:95:24)
    at AsyncScheduler.flush (<appFolder>/node_modules/@temporalio/worker/node_modules/rxjs/src/internal/scheduler/AsyncScheduler.ts:40:27)
    at listOnTimeout (node:internal/timers:564:17)
    at processTimers (node:internal/timers:507:7)
```

This only happens if using log forwarding:

```
Runtime.install({ 
  telemetryOptions: { logging: { forward: { level: 'INFO' } } },
  // ... other options
});
```

No error is thrown if logging options are changed to the following:

```
Runtime.install({ 
  telemetryOptions: { logging: { filter: makeTelemetryFilterString({ core: 'INFO', other: 'INFO' }) } },
  // ... other options
});
```

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2023-08-25 17:24:21.000 UTC</summary>

Note that I attempted to fix this and reverted it here: https://github.com/temporalio/sdk-typescript/pull/1152/commits/5b1f83dfa936e3c75baa3625a810daf5aef86a21.

It caused a memory leak, probably due to TS being unable to keep up with the rate of log emission.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-25 21:25:58.000 UTC</summary>

> Note that I attempted to fix this and reverted it here.

Oh, really? That's exactly what I had in mind a little bit earlier.

> It caused a memory leak, probably due to TS being unable to keep up with the rate of log emission.

That's strange... Why would rxjs be able to keep up, but pure TS code wouldn't? rxjs isn't magically making nodejs faster.

Can you give some details on what you mean exactly by memory leak here? I suppose that wouldn't be on rust side, as the message buffer gets emptied every time we poll from it. Was it simply that you went out of heap at some point, or were you observing a progressive increase in heap usage?

I get the feeling that this might be due to the fact that, in the refactored code, the `logs` array is being retained a bit too long (ie. it remains in scope while we sleep) and that's making it difficult for GC to collect back that memory. If that's the case, simply moving the "poll and process log entries" part out to a different function would fix it.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-25 21:54:21.000 UTC</summary>

I restored your original attempt (as is) [here](https://github.com/temporalio/sdk-typescript/pull/1225).

</details>


---

<a id="1201"></a>

### #1201: Cron job getting scheduled after deployment and Terminated automatically after 1 minute or so  

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1201 |
| **State** | CLOSED |
| **Author** | Naik1994 (Harish Naik B S) |
| **Created** | 2023-08-11 10:55:51.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-25 20:18:12.000 UTC |
| **Closed** | 2023-08-25 20:18:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

@mjameswh Request you to check and suggest on below issue.

We have written a cron job using temporal workflow which executes half an hour once. We have not written a separate worker for this job workflow instead using the one namespace and one task queue to perform API calls and this JOB. Also, our application is running on AWS ECS with 4 default tasks (not sure if this will have any impact on scheduled job).

As in when we deploy our code on ECS container, cron is getting scheduled properly however getting terminated automatically after some time before execution. We tried to enable `workflowRunTimeout` and `workflowTaskTimeout` settings however sometime cron executed and terminated inbetween and sometimes it terminated immediatly after scheduling.

schedular settings used =>
`await client.start("cronJob", {
      taskQueue: 'test',
      workflowId: uuid(),
      cronSchedule: '*/30 * * * *',
      workflowRunTimeout: '86400000',
      workflowTaskTimeout: '300000',
      args: [uuid4()]
})`

Failure events captured in UI =>
1] terminated within 1 minute of scheduling job with below event object:
{
  "eventId": "2",
  "eventTime": "2023-08-11T08:47:13.012448068Z",
  "eventType": "WorkflowExecutionTerminated",
  "version": "0",
  "taskId": "10560924366",
  "workerMayIgnore": false,
  "workflowExecutionTerminatedEventAttributes": {
    "reason": "",
    "details": {
      "payloads": []
    },
    "identity": "1@7c97cc146289"
  },
  "name": "WorkflowExecutionTerminated",
  "id": "2",
  "timestamp": "2023-08-11 UTC 08:47:13.01",
  "classification": "Terminated",
  "category": "workflow",
  "attributes": {
    "type": "workflowExecutionTerminatedEventAttributes",
    "reason": "",
    "details": {
      "payloads": []
    },
    "identity": "1@7c97cc146289"
  }
}

2] terminated in between while executing the job:
{
  "eventId": "2278",
  "eventTime": "2023-08-11T07:02:56.007332938Z",
  "eventType": "WorkflowTaskFailed",
  "version": "0",
  "taskId": "10560921210",
  "workerMayIgnore": false,
  "workflowTaskFailedEventAttributes": {
    "scheduledEventId": "2276",
    "startedEventId": "2277",
    "cause": "ForceCloseCommand",
    "failure": null,
    "identity": "history-service",
    "baseRunId": "",
    "newRunId": "",
    "forkEventVersion": "0",
    "binaryChecksum": "",
    "workerVersion": null
  },
  "name": "WorkflowTaskFailed",
  "id": "2278",
  "timestamp": "2023-08-11 UTC 07:02:56.00",
  "classification": "Failed",
  "category": "workflow",
  "attributes": {
    "type": "workflowTaskFailedEventAttributes",
    "scheduledEventId": "2276",
    "startedEventId": "2277",
    "cause": "ForceCloseCommand",
    "failure": null,
    "identity": "history-service",
    "baseRunId": "",
    "newRunId": "",
    "forkEventVersion": "0",
    "binaryChecksum": "",
    "workerVersion": null
  }
}

Please let us know if we need to enable any other settings or should we have a separate task queue created for this crons ?

#### Comments (3)

<details>
<summary><strong>Naik1994</strong> commented on 2023-08-14 03:58:37.000 UTC</summary>

@mjameswh any update on this ?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-18 18:50:46.000 UTC</summary>

Hey! Sorry for the delay, I was at a company event for the week. By the way, for support questions, you should consider asking on either [our community forum](https://community.temporal.io/) or [our community Slack workspace](https://t.mp/slack).

I'm afraid I can't entirely explain what's wrong in the two cases you describe, given the information you provide. Still, let's see what we can extract from there.

In the first sample, the `identity: "1@7c97cc146289"` field suggests that the workflow execution was terminated by a client, before a workflow task ever got scheduled (ie. since the termination `eventId` is 2). I would try to compare that `identity` with the one from `WorkflowExecutionStarted` event, as this might help figuring out what happened.

In the second sample, this `WorkflowTaskFailed` event is artificially introduced by the Temporal History server node, with the `ForceCloseCommand` code. This happens when a workflow somehow exceeds some operational limit, for example if there are too many buffered events for that workflow, or if buffered events exceeds the maximum gRPC message size. To help figure what's happening, examine that workflow's history events between the previous `WorkflowTaskStarted` event (ie. the last one before event id 2276) and up to the `WorkflowTaskScheduled` event at id 2276. Do you have thousands of events in-between? Or do you have a few events in large payloads?

One last thing... I suggest you get a look at [Schedules](https://docs.temporal.io/workflows#schedule), which are much more powerful and easier to work with compared to legacy cron workflows.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-25 20:18:12.000 UTC</summary>

@Naik1994 I'm closing this ticket, as there is nothing to do on our side.

Feel free to continue the discussion if you still need help. You may also get help through our [Slack community](https://t.mp/slack) or our [community forum](https://community.temporal.io/).

</details>


---

<a id="1200"></a>

### #1200: [Bug] Metric `workflow_task_execution_failed` doesn't have correct tags

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1200 |
| **State** | CLOSED |
| **Author** | rupalivohra (Rupali Vohra) |
| **Created** | 2023-08-10 18:51:23.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-10 21:46:59.000 UTC |
| **Closed** | 2023-08-10 21:46:58.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

I want to monitor workflow task execution failures on a per-workflow level.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

Around the time we upgraded our SDK version from 1.4.2 -> 1.6.0, the metric for `workflow_task_execution_failed` stopped being emitted. When we upgraded from 1.6.0 -> 1.8.2, the metric came back. This was probably due to [this change](https://github.com/temporalio/sdk-core/pull/481).

The problem is that we used to get some tags on the metric for the `workflow_type`, but that's no longer coming through. The `task_queue` tag seems to be working fine. This makes it difficult for us to write well-formed monitors that alert the correct teams.

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

I'm happy to DM screenshots of what the metrics looked like before and after if that would be helpful. Ping me on Slack.



#### Comments (1)

<details>
<summary><strong>rupalivohra</strong> commented on 2023-08-10 21:46:58.000 UTC</summary>

Closing issue - while data from workflow task failures that occurred initially (not including retries) is not emitting the correct tag for `workflow_type`, metrics from post-upgrade to 1.8.2 seem to be tagged correctly.

[Related (private) Slack thread](https://convoy.slack.com/archives/C01PM0HS63D/p1691703866456369?thread_ts=1691693519.616469&cid=C01PM0HS63D).

</details>


---

<a id="1175"></a>

### #1175: [Support] Activating a workflow causes "Automatic publicPath is not supported in this browser" (error when using node but not node-ts)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1175 |
| **State** | CLOSED |
| **Author** | doodledood |
| **Created** | 2023-07-17 09:53:52.000 UTC (2y 5m ago) |
| **Updated** | 2024-07-07 03:06:36.000 UTC |
| **Closed** | 2023-08-04 20:30:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Trying to execute a workflow from a client (worked in the past).

### Describe the bug

The worker is set up this way:
`
    const worker = await Worker.create({
        connection,
        workflowsPath: require.resolve('./workflows'),
        activities: createActivities(someDep),
        taskQueue: 'test-queue',
        bundlerOptions: {
            ignoreModules: ['./logger'],
        },
        // Inject sinks
        sinks: defaultSinks(workflowLogger)
    });
`

The client launches the workflow. The worker picks it up, but then immediately fails with this error: 

`
[ERROR] Failed to activate workflow {
[worker]   runId: 'e0a7da3f-dde2-4d20-9b79-0d5eefbfc137',
[worker]   error: /usr/src/app/workflow-bundle-e081d7d12c0bb7760cad.js:27106
[worker]   /******/             if (!scriptUrl) throw new Error("Automatic publicPath is not supported in this browser");
[worker]                                        ^
[worker]
[worker]   Error: Automatic publicPath is not supported in this browser
[worker]       at webpack/runtime/publicPath:17:0
[worker]       at null:null:null
[worker]       at null:null:null
[worker]       at Script.runInContext (node:vm:141:12)
[worker]       at VMWorkflowCreator.getContext (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/vm.js:63:21)
[worker]       at VMWorkflowCreator.createWorkflow (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/vm.js:32:36)
[worker]       at handleRequest (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:35)
[worker]       at MessagePort.<anonymous> (/usr/src/app/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:83:38)
[worker]       at [nodejs.internal.kHybridDispatch] (node:internal/event_target:737:20)
[worker]       at exports.emitMessage (node:internal/per_context/messageport:23:28),
[worker]   workflowExists: false
[worker] }
`

I noticed this happens when I try to run the `worker.js` using `node dist/worker.js` after building the typescript files. However, it does work correctly when using `ts-node` like `ts-node src/worker.ts`


### Minimal Reproduction

Launch a Kubernetes cluster with Temporal set up and a worker.
Start a workflow with `await client.workflow.start(` from a client.
Watch the worker; it raises the previous error.

### Environment/Versions

- Windows 10 x86
- Docker Desktop + Minikube (Kubernetes setup)
- Temporal version 1.21.1 (auto-setup) docker image


#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-18 16:34:02.000 UTC</summary>

Your Workflow code is somehow importing an NPM package that uses Webpack's automatic `publicPath` feature. That feature only makes sense in a web app (ie. that package should be imported from web UI code, not from backend code). The error message is produced by the imported library itself, not by the Temporal SDK.

Review your Workflow's imports for anything that should not be there. You may also try to inspect your generated workflow bundle (`/usr/src/app/workflow-bundle-e081d7d12c0bb7760cad.js`, at line 27106) to find out exactly which package is causing that error, then try to figure out why is that library getting imported from your workflow code.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-04 20:30:27.000 UTC</summary>

@doodledood I'm closing this ticket, as there is nothing to do on our side.

Feel free to continue the discussion if you still need help. You may also get help through our [Slack community](https://t.mp/slack) or our [community forum](https://community.temporal.io/).

</details>

<details>
<summary><strong>0xBigBoss</strong> commented on 2024-07-07 03:06:36.000 UTC</summary>

Just came to say for others encountering this. I am running my workers using `ts-node` for now, this was due to `@supabase/supabase-js` importing `@supabase/node-fetch/browser`. The fix for me at least was to pass a custom bundle option to ignore the troublesome package. YMMV

```ts
  const worker = await Worker.create({
    workflowsPath: fileURLToPath(workflowsPathUrl),
    activities,
    taskQueue: 'dev',
    bundlerOptions: {
      ignoreModules: ['@supabase/supabase-js'],
    },
  })
```

</details>


---

<a id="1127"></a>

### #1127: Temporal SDK Changes how javascript is being executed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1127 |
| **State** | CLOSED |
| **Author** | tareksalem (tarek salem) |
| **Created** | 2023-05-30 12:14:48.000 UTC (2y 7m ago) |
| **Updated** | 2023-06-01 03:59:11.000 UTC |
| **Closed** | 2023-05-30 15:16:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
This is not an actual bug

I am using a simple activity like this:

```typescript
export async function greet(name: string): Promise<string> {
  return Promise.reject('www')
}
```

and this is the workflow

```typescript

/** A workflow that simply calls an activity */
export async function example(name: string): Promise<string> {
  try {
    console.log("============= entered try")
    return await greet(name);
  } catch (err) {
    console.log('============= entered the failure catch');
    throw ApplicationFailure.nonRetryable("====================== failed to get name");
  }
}
```
I want to throw the application failure from the workflow itself if the activity failed, not from the activity function

### Describe the bug
In normal javascript code, when I return a rejection from a promise function and call that function in a try-catch block, its expected to catch the error and do whatever logic should be done inside that catch block, but this is not the case with temporal SDK, if I return a rejection from the promise and call it inside try-catch block inside the workflow it doesn't call the catch block and it causes the workflow to be retried which is not the wanted behavior.


#### Why do I want to do that?
for me activities are functions and I want  to make them pure functions for testability and extendability, so I don't want the activities function to know anything about the temporal application failure and not take the decision regarding to which error should be thrown
I think the workflow itself should have that logic so I want to put the activities that might return a failure to put them inside a try catch block inside the workflow and in the catch block decide which type of failure should be thrown

Is something like this doable?

Also, I didn't find something in the documentation explaining this, is there a resource that explains this in detail?

Thanks.

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2023-05-30 15:16:17.000 UTC</summary>

Activities are retired indefinitely by default unless they throw an error that's specified in the non retryable types in the retry policy or they throw a non retryable application failure.
This is typically what you want because activities interact with unreliable systems and Temporal ensures they run to completion.
Retrying from the workflow is far more expensive in terms of compute and storage operations so we generally do not recommend that approach.

This page covers what you need to know about activities conceptually: https://docs.temporal.io/activities



</details>

<details>
<summary><strong>tareksalem</strong> commented on 2023-05-31 17:29:39.000 UTC</summary>

@bergundy why throwing errors from the workflow is more expensive?

what If I want to make the decision of retrying or not from outside the activity?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-06-01 03:59:10.000 UTC</summary>

If you need to decide whether to retry from the workflow, you can throw a
non-retryable error from the Activity:

`throw ApplicationFailure.create({ message: 'foo', nonRetryable: true })`

More info:

https://docs.temporal.io/kb/failures

On Wed, May 31, 2023 at 1:29‚ÄØPM tarek salem ***@***.***>
wrote:

> @bergundy <https://github.com/bergundy> why throwing errors from the
> workflow is more expensive?
>
> what If I want to make the decision of retrying or not from outside the
> activity?
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/1127#issuecomment-1570630633>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AAB5LGEW72GVBB43DAZ5QVTXI55Y5ANCNFSM6AAAAAAYT5NWJI>
> .
> You are receiving this because you are subscribed to this thread.Message
> ID: ***@***.***>
>


</details>


---

<a id="1125"></a>

### #1125: [Bug] tsc in a project created with `npx @temporalio/create` fails on Node 20

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1125 |
| **State** | CLOSED |
| **Author** | josh-berry (Josh Berry) |
| **Created** | 2023-05-26 17:25:37.000 UTC (2y 7m ago) |
| **Updated** | 2023-05-30 18:53:25.000 UTC |
| **Closed** | 2023-05-30 18:53:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Trying to create a new project based on the `child-workflow` sample, following the directions at: https://docs.temporal.io/dev-guide/typescript/foundations#install-a-temporal-sdk

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

TypeScript compilation fails in an unmodified new project, based on the `child-workflow` sample, because the `es2023` library definitions are not included with the version of TypeScript used in the sample project:

```
‚ùØ npm run start.watch
...
TSError: ‚®Ø Unable to compile TypeScript:
node_modules/@tsconfig/node20/tsconfig.json:6:13 - error TS6046: Argument for '--lib' option must be: 'es5', 'es6', 'es2015', 'es7', [...]

6     "lib": ["es2023"],
              ~~~~~~~~
...
[nodemon] app crashed - waiting for file changes before starting...
```

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

1. `npx @temporalio/create@latest sample-tsc-fail-repro`
2. Choose the `child-workflows` sample and accept the defaults for the rest of the prompts
3. In a new terminal, `temporal server start-dev`
4. `cd sample-tsc-fail-repro`
5. `npm run start.watch`
6. Observe the crash above

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac, macOS 13.4
- Temporal Version: `temporal version 0.9.0 (server 1.20.2) (ui 2.15.0)`
- Are you using Docker or Kubernetes or building Temporal from source? No
- Node Version: `v20.2.0`

### Additional context

<!-- Add any other context about the problem here. -->

I doubt this is specific to the `child-workflows` sample; I suspect the others suffer from the same issue (though I haven't tried).

I notice the `es2023` lib reference comes from the `tsconfig.json` included in `@tsconfig/node20`. If I look at the sample itself, I see that its `package.json` uses `@tsconfig/node16` (which presumably does not have the `es2023` lib reference). So it seems `@temporalio/create` is tweaking the `package.json` to use `node20` (which is the version I have installed). And indeed I can see this in the code: https://github.com/temporalio/sdk-typescript/blob/1709d45c5e649fd6b233243b7a80c49be5e706bd/packages/create-project/src/helpers/install.ts#L33

Also, the sample's `package.json` pins TypeScript to a 4.x release, and I don't think `es2023` is defined until 5.0.

I think there might be two ways of fixing this:
1. Bump the TypeScript version (and related dependencies) to TypeScript 5.x in all the samples
2. Stop messing with the `@tsconfig/nodeXX` version when creating the new package

It might be a good idea to do both, in any case. Staying up to date (i.e. (1)) is always good, and my thinking re. (2) is that people may be developing on the latest version of Node (currently, v20), but may want to use an LTS release (currently, v18) when deploying. So it may not necessarily make sense to depend on the current Node version in a new project.

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2023-05-26 17:37:09.000 UTC</summary>

Thanks @josh-berry for the report.
This was already reported but your issue contains more info so I'll close the original.

</details>

<details>
<summary><strong>josh-berry</strong> commented on 2023-05-26 18:16:47.000 UTC</summary>

Ack, my bad, I filed this without checking for duplicates, because I was initially gonna open it in the samples repo, but realized it was actually an SDK bug at the last minute and moved it over. Will pay more attention next time!

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-26 20:04:51.000 UTC</summary>

Lol! I already have a fix for this on my local branch, together with a few other minor fixes üòÑ Pushing in a few minutes.

Reactions: ‚ù§Ô∏è 1

</details>


---

<a id="1122"></a>

### #1122: [Bug] Temporal worker fails to start if I am using class transformer

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1122 |
| **State** | CLOSED |
| **Author** | tareksalem (tarek salem) |
| **Created** | 2023-05-25 09:43:53.000 UTC (2y 7m ago) |
| **Updated** | 2023-05-26 13:56:12.000 UTC |
| **Closed** | 2023-05-26 13:56:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am using temporal typescript sdk, I have a dto as the following:

```typescript
export class CheckoutDTO {
  voucherCode: string;
  promoCode: string;
  mdn?: string;
  balanceAmount?: number;
  reewardsAmoun?: number;
}
```
I am using class transformer library `plainToClass` function to build the dto inside the workflow as the following:

```typescript
const workflow = async (payload: PlaceOrderRequestPayloadDTO) => {
  const customer = await getCustomerInfo({
    brand: payload.brand,
    customerId: payload.customerId,
  });
  // check if customer is not exist then terminate the workflow
  if (!customer) {
    throw ApplicationFailure.create({
      message: 'customer does not exist',
      details: [{ customerId: payload.customerId }],
      nonRetryable: true,
    });
  }
  const cart = await getCart({ brand: payload.brand, userId: customer.id });
  await checkCartIsLocked(cart);
  await setCartLock({
    brand: payload.brand,
    userId: customer.id,
    lock: false,
  });
  const checkoutDTO = plainToClass(CheckoutDTO, { cart, ...payload });
  return checkoutDTO;
};
```

### Describe the bug

It fails to start the worker, the worker fails to build the workflow file with webpack

![Screenshot from 2023-05-25 12-38-19](https://github.com/temporalio/sdk-typescript/assets/26143873/513c8287-4033-4db0-a54e-66a72eda005f)

Here the worker configuration:

```typescript
Runtime.install({});
        const temporalHost =
          configService.get<string>('app.temporalHost') || 'localhost:7233';
        const connection = await NativeConnection.connect({
          address: temporalHost,
        });
        const workflowsPath = require.resolve(
          './use-cases/placeOrder/workflows',
        );
        const workflowBundle = await bundleWorkflowCode({
          workflowsPath,
        });
        process.once('SIGUSR2', function () {
          connection.close();
        });
        process.on('SIGINT', function () {
          // this is only called on ctrl+c, not restart
          connection.close();
        });
        return {
          connection,
          taskQueue: 'default',
          workflowBundle,
          activities,
        };
```

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux
- Temporal Version: Typescript SDK 1.7.4

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (3)

<details>
<summary><strong>tareksalem</strong> commented on 2023-05-25 09:57:53.000 UTC</summary>

### Update

The Error is not related to class transformer exactly, after some tries, I found that I can't even create a class inside the workflow from another file

suppose I have the following directory structure

- dtos
  - checkouDTO.ts
- workflow.ts

If I import checkoutDTO and create a new insance inside the workflow it will fail as the following:

```typescript
import { CheckoutDTO } from './dtos'

function placeOrder() {

  // activites here
  const checkoutInstance = new CheckoutDTO() // will fail
}
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-25 16:52:07.000 UTC</summary>

In the screenshot above, we can see the following chain of imports:

`workflows.ts` -> `placeOrder.ts` -> `dtos/index.ts` -> `@nestjs/swagger` -....-> `@nestjs/core`

That means that, as it is defined now, `workflows.ts` transitively imports the `@nestjs/core` package. That's not possible, as the Workflow sandbox disallow any module that have non-deterministic behavior. NestJS itself use a lot of non-deterministic stuff, including file IOs, network IO, use of environment variables, etc. That doesn't mean you can't use NestJS in your project, but simply that your Workflow code may not pull anything that relates to NestJS, not even _transitively_.

Here are a few possible solutions to this:
1. First of all, is it really appropriate that you instantiate a `CheckoutDTO` object from the Workflow? What will you do with that object? If you later pass that object to an activity, the object will get serialized to JSON, and the activity will get a plain object, without methods. Same if a workflow or an activity _returns_ an instance of a class; the caller (either a client or a workflow) will get a plain object.
2. If `CheckoutDTO` itself doesn't need a dependency on `@nestjs/swagger`, consider making `workflow.ts` import `dtos/checkout-dto` (or whatever else), so that you avoid the problematic import.
3. In some cases, you may be able to get away with simply doing `import type ... from ...` (mind the `type` keyword). That would give you the type definition, but won't allow you to _instantiate_ a class.
4. If you are really sure that some module will not get executed at runtime, you may add that module to the `WorkflowBundlingOptions.ignoredModules`. For example, add `@nestjs/swagger` to that list would break the transitive dependency mentioned previously. But beware that this might cause errors at runtime if the code actually use that dependency.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-26 13:56:12.000 UTC</summary>

@tareksalem Did that help?

I will close this ticket, as I believe there is nothing more to be done on our side, but you can still add answer or ask more questions in relation in the present case. You may also ask questions on our Slack Workspace, on the #typescript-sdk channel.

</details>


---

<a id="1108"></a>

### #1108: [Feature Request] Permit imports of Node `buffer` module in workflows 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1108 |
| **State** | CLOSED |
| **Author** | silasdavis (Silas Davis) |
| **Created** | 2023-04-25 14:46:19.000 UTC (2y 8m ago) |
| **Updated** | 2023-07-18 20:04:19.000 UTC |
| **Closed** | 2023-07-18 20:04:19.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

It would be useful to permit uses of the builtin `buffer` on the import tree for workflows. 

In my particular case I have parsing logic to convert workflow input types into richer domain types that relies on `buffer`.

### Describe the solution you'd like

I note that all `builtinModules` are included in `disallowedModules`, I'm not sure if this is because you would need to shim them in the v8 isolate explicitly or if it is down to non-determinism issues with `Buffer`. `unsafeAlloc` and friends perhaps?

I would assume otherwise that buffer would be safe to us (I have `BigNumber` implementations depending on it).

The solution I would like is for an exemption to be made similar to that which exists for `assert`.

### Additional context

Incidentally it would be really handy to emit some additional context when reporting problematic modules. The error message lists the modules but not their source, however `data.context` in the callback here:

https://github.com/temporalio/sdk-typescript/blob/2073c5385f92b0927cf745a1fec2845f19a70b10/packages/worker/src/workflow/bundler.ts#L193

Does have access to the module which actually made the call which helps a lot in narrowing down the source of the bad module import.


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-18 20:04:02.000 UTC</summary>

After discussion, our team has determined that it's preferable not to provide out-of-the-box support for Node's `Buffer` API, since that goes against some of our mid-term and long-term objectives, notably regarding the possibly of supporting other JavaScript runtimes (eg. Deno, browser, etc).

Instead, we encourage users to load appropriate polyfills from their Webpack bundler. [A sample](https://github.com/temporalio/samples-typescript/issues/280) will soon be added demonstrating how to do so.

</details>


---

<a id="1102"></a>

### #1102: [Bug] Hang on starting workflow worker on NodeJS 18.14.2

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1102 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-04-18 16:40:15.000 UTC (2y 8m ago) |
| **Updated** | 2023-05-26 22:38:33.000 UTC |
| **Closed** | 2023-05-26 22:38:33.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Description

A user reports that her workflow worker is hanging in production environment, right after printing `Workflow bundle created`. Execution is ok when run locally (including when running locally in a docker container).

Problematic environment was:
- NodeJS 18.14.2
- Linux container AMD64

Investigation points out to an issue with creation of worker threads. Worker runs correctly after downgrading the container image to NodeJS 16.17.0.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-26 22:38:26.000 UTC</summary>

Investigation revealed that issue was caused by incorrectly configured Node heap options

</details>


---

<a id="1066"></a>

### #1066: [Feature Request] add string types for `ms` package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1066 |
| **State** | CLOSED |
| **Author** | akamos (Alwin) |
| **Created** | 2023-02-28 07:12:19.000 UTC (2y 10m ago) |
| **Updated** | 2023-06-14 21:32:43.000 UTC |
| **Closed** | 2023-06-14 21:32:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

When for example using the `sleep` method, it's possible to describe the time as a string, because of the built-in `ms` package. It would be great to use the string types from `ms` instead of a simple `string` type, to have typechecking on the given time argument.

### Describe the solution you'd like

The solution would be to use the typing provided by `ms`: https://github.com/vercel/ms/blob/78ce59eab01c197b9133bf9752ae01fbc11f4976/src/index.ts#L44



#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-01 19:03:11.000 UTC</summary>

@bergundy This is what I have in mind for this.

It maintains backward compatibility, at the cost of complaining about deprecation rather than entirely refusing incorrect syntaxes. We could encourage people to progressively switch to `Duration` instead of `number | string` in their own code, and schedule removal of the deprecated `number | string` form in a few months.

```
type Duration = number | MsFormatedValue;

export function sleep(ms: Duration): Promise<void>;

/** @deprecated */
export function sleep(ms: string): Promise<void>;

export function sleep(ms: number | Duration | string): Promise<void> {
  // ...
}
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-01 19:10:44.000 UTC</summary>

Hmm.. the only thing I'm worried about here is users reading these values from external configurations so we'll have to figure out what we want to do there but I think your suggestion makes total sense @mjameswh.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-14 21:32:42.000 UTC</summary>

Fixed by #1136.

Reactions: ‚ù§Ô∏è 2

</details>


---

<a id="1042"></a>

### #1042: core-2.3.0.tgz: 9 vulnerabilities (highest severity is: 8.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1042 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-01-30 17:15:00.000 UTC (2y 11m ago) |
| **Updated** | 2024-01-10 15:35:47.000 UTC |
| **Closed** | 2024-01-10 15:35:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>core-2.3.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (core version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25967](https://www.mend.io/vulnerability-database/CVE-2022-25967) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 8.8 | eta-1.12.3.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-45133](https://www.mend.io/vulnerability-database/CVE-2023-45133) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 8.8 | traverse-7.20.5.tgz | Transitive | N/A* | &#10060; |
| [CVE-2020-7753](https://www.mend.io/vulnerability-database/CVE-2020-7753) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | trim-0.0.1.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25881](https://www.mend.io/vulnerability-database/CVE-2022-25881) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | http-cache-semantics-4.1.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-25166](https://www.mend.io/vulnerability-database/CVE-2023-25166) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 6.5 | formula-3.0.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-45857](https://www.mend.io/vulnerability-database/CVE-2023-45857) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 6.5 | axios-0.25.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-23630](https://www.mend.io/vulnerability-database/CVE-2023-23630) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 6.1 | eta-1.12.3.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-33987](https://www.mend.io/vulnerability-database/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.3 | got-9.6.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-44270](https://www.mend.io/vulnerability-database/CVE-2023-44270) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.3 | postcss-8.4.20.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25967</summary>


###  Vulnerable Library - <b>eta-1.12.3.tgz</b></p>

<p>Lightweight, fast, and powerful embedded JS template engine</p>
<p>Library home page: <a href="https://registry.npmjs.org/eta/-/eta-1.12.3.tgz">https://registry.npmjs.org/eta/-/eta-1.12.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - :x: **eta-1.12.3.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package eta before 2.0.0 are vulnerable to Remote Code Execution (RCE) by overwriting template engine configuration variables with view options received from The Express render API. **Note:** This is exploitable only for users who are rendering templates with user-defined data.

<p>Publish Date: 2023-01-30
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25967>CVE-2022-25967</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-01-30</p>
<p>Fix Resolution: eta - 2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2023-45133</summary>


###  Vulnerable Library - <b>traverse-7.20.5.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/@babel/traverse/-/traverse-7.20.5.tgz">https://registry.npmjs.org/@babel/traverse/-/traverse-7.20.5.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - :x: **traverse-7.20.5.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Babel is a compiler for writingJavaScript. In `@babel/traverse` prior to versions 7.23.2 and 8.0.0-alpha.4 and all versions of `babel-traverse`, using Babel to compile code that was specifically crafted by an attacker can lead to arbitrary code execution during compilation, when using plugins that rely on the `path.evaluate()`or `path.evaluateTruthy()` internal Babel methods. Known affected plugins are `@babel/plugin-transform-runtime`; `@babel/preset-env` when using its `useBuiltIns` option; and any "polyfill provider" plugin that depends on `@babel/helper-define-polyfill-provider`, such as `babel-plugin-polyfill-corejs3`, `babel-plugin-polyfill-corejs2`, `babel-plugin-polyfill-es-shims`, `babel-plugin-polyfill-regenerator`. No other plugins under the `@babel/` namespace are impacted, but third-party plugins might be. Users that only compile trusted code are not impacted. The vulnerability has been fixed in `@babel/traverse@7.23.2` and `@babel/traverse@8.0.0-alpha.4`. Those who cannot upgrade `@babel/traverse` and are using one of the affected packages mentioned above should upgrade them to their latest version to avoid triggering the vulnerable code path in affected `@babel/traverse` versions: `@babel/plugin-transform-runtime` v7.23.2, `@babel/preset-env` v7.23.2, `@babel/helper-define-polyfill-provider` v0.4.3, `babel-plugin-polyfill-corejs2` v0.4.6, `babel-plugin-polyfill-corejs3` v0.8.5, `babel-plugin-polyfill-es-shims` v0.10.0, `babel-plugin-polyfill-regenerator` v0.5.3.

<p>Publish Date: 2023-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-45133>CVE-2023-45133</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Changed
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92">https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92</a></p>
<p>Release Date: 2023-10-12</p>
<p>Fix Resolution: @babel/traverse - 7.23.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2020-7753</summary>


###  Vulnerable Library - <b>trim-0.0.1.tgz</b></p>

<p>Trim string whitespace</p>
<p>Library home page: <a href="https://registry.npmjs.org/trim/-/trim-0.0.1.tgz">https://registry.npmjs.org/trim/-/trim-0.0.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - mdx-loader-2.3.0.tgz
      - mdx-1.6.22.tgz
        - remark-parse-8.0.3.tgz
          - :x: **trim-0.0.1.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().

<p>Publish Date: 2020-10-27
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2020-7753>CVE-2020-7753</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-10-27</p>
<p>Fix Resolution: trim - 0.0.3</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25881</summary>


###  Vulnerable Library - <b>http-cache-semantics-4.1.0.tgz</b></p>

<p>Parses Cache-Control and other headers. Helps building correct HTTP caches and proxies</p>
<p>Library home page: <a href="https://registry.npmjs.org/http-cache-semantics/-/http-cache-semantics-4.1.0.tgz">https://registry.npmjs.org/http-cache-semantics/-/http-cache-semantics-4.1.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - got-9.6.0.tgz
            - cacheable-request-6.1.0.tgz
              - :x: **http-cache-semantics-4.1.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
This affects versions of the package http-cache-semantics before 4.1.1. The issue can be exploited via malicious request header values sent to a server, when that server reads the cache policy from the request using this library.

<p>Publish Date: 2023-01-31
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25881>CVE-2022-25881</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-rc47-6667-2j5j">https://github.com/advisories/GHSA-rc47-6667-2j5j</a></p>
<p>Release Date: 2023-01-31</p>
<p>Fix Resolution: http-cache-semantics - 4.1.1;org.webjars.npm:http-cache-semantics:4.1.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2023-25166</summary>


###  Vulnerable Library - <b>formula-3.0.0.tgz</b></p>

<p>Math and string formula parser.</p>
<p>Library home page: <a href="https://registry.npmjs.org/@sideway/formula/-/formula-3.0.0.tgz">https://registry.npmjs.org/@sideway/formula/-/formula-3.0.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - utils-validation-2.3.0.tgz
      - joi-17.7.0.tgz
        - :x: **formula-3.0.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
formula is a math and string formula parser. In versions prior to 3.0.1 crafted user-provided strings to formula's parser might lead to polynomial execution time and a denial of service. Users should upgrade to 3.0.1+. There are no known workarounds for this vulnerability.

<p>Publish Date: 2023-02-08
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-25166>CVE-2023-25166</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>6.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.cve.org/CVERecord?id=CVE-2023-25166">https://www.cve.org/CVERecord?id=CVE-2023-25166</a></p>
<p>Release Date: 2023-02-08</p>
<p>Fix Resolution: @sideway/formula - 3.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2023-45857</summary>


###  Vulnerable Library - <b>axios-0.25.0.tgz</b></p>

<p>Promise based HTTP client for the browser and node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/axios/-/axios-0.25.0.tgz">https://registry.npmjs.org/axios/-/axios-0.25.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - wait-on-6.0.1.tgz
      - :x: **axios-0.25.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
An issue discovered in Axios 1.5.1 inadvertently reveals the confidential XSRF-TOKEN stored in cookies by including it in the HTTP header X-XSRF-TOKEN for every request made to any host allowing attackers to view sensitive information.

<p>Publish Date: 2023-11-08
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-45857>CVE-2023-45857</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>6.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: None
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-11-08</p>
<p>Fix Resolution: axios - 1.6.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2023-23630</summary>


###  Vulnerable Library - <b>eta-1.12.3.tgz</b></p>

<p>Lightweight, fast, and powerful embedded JS template engine</p>
<p>Library home page: <a href="https://registry.npmjs.org/eta/-/eta-1.12.3.tgz">https://registry.npmjs.org/eta/-/eta-1.12.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - :x: **eta-1.12.3.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Eta is an embedded JS templating engine that works inside Node, Deno, and the browser. XSS attack - anyone using the Express API is impacted. The problem has been resolved. Users should upgrade to version 2.0.0. As a workaround, don't pass user supplied things directly to `res.render`.

<p>Publish Date: 2023-02-01
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-23630>CVE-2023-23630</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>6.1</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Changed
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/eta-dev/eta/security/advisories/GHSA-xrh7-m5pp-39r6">https://github.com/eta-dev/eta/security/advisories/GHSA-xrh7-m5pp-39r6</a></p>
<p>Release Date: 2023-02-01</p>
<p>Fix Resolution: eta - 2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-9.6.0.tgz</b></p>

<p>Simplified HTTP requests</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-9.6.0.tgz">https://registry.npmjs.org/got/-/got-9.6.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - :x: **got-9.6.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: got - 11.8.5,12.1.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2023-44270</summary>


###  Vulnerable Library - <b>postcss-8.4.20.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/postcss/-/postcss-8.4.20.tgz">https://registry.npmjs.org/postcss/-/postcss-8.4.20.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - :x: **postcss-8.4.20.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
An issue was discovered in PostCSS before 8.4.31. The vulnerability affects linters using PostCSS to parse external untrusted CSS. An attacker can prepare CSS in such a way that it will contains parts parsed by PostCSS as a CSS comment. After processing by PostCSS, it will be included in the PostCSS output in CSS nodes (rules, properties) despite being included in a comment.

<p>Publish Date: 2023-09-29
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-44270>CVE-2023-44270</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.cve.org/CVERecord?id=CVE-2023-44270">https://www.cve.org/CVERecord?id=CVE-2023-44270</a></p>
<p>Release Date: 2023-09-29</p>
<p>Fix Resolution: postcss - 8.4.31</p>

</p>

<p></p>

</details>

#### Comments (3)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-16 18:33:40.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-22 19:31:08.000 UTC</summary>

:information_source: This issue was automatically re-opened by Mend because the vulnerable library in the specific branch(es) has been detected in the Mend inventory.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2024-01-10 15:35:46.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1024"></a>

### #1024: [Bug] cannot spawn test-server

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1024 |
| **State** | CLOSED |
| **Author** | MrMaximus (Max) |
| **Created** | 2023-01-12 10:25:54.000 UTC (2y 12m ago) |
| **Updated** | 2023-01-12 17:35:18.000 UTC |
| **Closed** | 2023-01-12 17:35:17.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the bug

I'm trying to execute workflow tests using @temporalio/testing with jest in docker.  Creating a TestWorkflowEnvironment with `TestWorkflowEnvironment.create()` fails with the below error

```bash
  ‚óè Console
    console.error
      2023-01-11T13:27:32.036Z [ERROR] Failed to kill test server child process {
        error: Error: kill ESRCH
            at process.kill (node:internal/process/per_thread:220:13)
            at kill (/builds/my-service/node_modules/@temporalio/testing/src/child-process.ts:33:11)
            at Function.create (/builds/my-service/node_modules/@temporalio/testing/src/index.ts:226:19)
            at processTicksAndRejections (node:internal/process/task_queues:96:5)
            at /builds/my-service/src/worker/workflows/my-workflow.test.ts:28:13 {
          errno: -3,
          code: 'ESRCH',
          syscall: 'kill'
        }
      }
      26 |
      27 | beforeAll(async () => {
    > 28 |   testEnv = await TestWorkflowEnvironment.create();
         |             ^
      29 | });
      30 |
      at DefaultLogger.defaultLogFunction [as logFunction] (node_modules/@temporalio/worker/src/logger.ts:41:13)
      at DefaultLogger.log (node_modules/@temporalio/worker/src/logger.ts:67:12)
      at DefaultLogger.error (node_modules/@temporalio/worker/src/logger.ts:93:10)
      at Function.create (node_modules/@temporalio/testing/src/index.ts:228:16)
      at src/worker/workflows/my-workflow.test.ts:28:13
```

The error is because its trying to kill a child process that didn't start. The child process being referenced is from spawning the `test-server`.

I tried to start the `test-server` myself and the error is
```bash
./test-server: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by ./test-server)
./test-server: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by ./test-server)
```

There is a npm install script in the `@temporalio/testing@v1.1.0` library which pulls the latest release of the test server from `https://api.github.com/repos/temporalio/sdk-java/releases/latest`, and a new release was published two days ago. I expect this new release is causing the bug

### Minimal Reproduction

Temporal testing library: `@temporalio/testing@v1.1.0`
Docker image: `node:16-slim`

```javascript
import { TestWorkflowEnvironment } from '@temporalio/testing';

let testEnv;

beforeAll(async () => {
  testEnv = await TestWorkflowEnvironment.create();
});

afterAll(async () => {
  await testEnv.teardown();
});

describe('Test workflow', () => {
  test('test', async () => {
    expect(testEnv).toBeInstanceOf(TestWorkflowEnvironment);
  });
});

```

### Additional context
Works on macOS

### EDIT

This setup did work previously so I believe the issue stems from the fact there have been a new test-server release and it is not pinned in the testing lib

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-12 17:35:17.000 UTC</summary>

Looks like you're using an old version of the SDK, this shouldn't happen since 1.3.0: https://github.com/temporalio/sdk-typescript/blob/main/CHANGELOG.md#130---2022-09-20.

I'm closing this issue.
If you encounter it after upgrading, please reopen.

</details>


---

<a id="1015"></a>

### #1015: [Feature Request] Support dynamic workflows, activities, signals, queries, and updates

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1015 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2023-01-05 13:46:46.000 UTC (3 years ago) |
| **Updated** | 2025-05-30 06:47:40.000 UTC |
| **Closed** | 2025-05-03 03:50:59.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

Need opt-in catch-alls for workflows, activities, signals, queries, and updates.

### Describe the solution you'd like

Should be able to register only one workflow as "dynamic" and it is given the name as a string as the first arg, then args as an array as the second arg. In other SDKs we give the second arg as still-serialized payloads because they need the type to deserialize, but since JS doesn't, can already be deserialized.

Need to do the same for activity.

For signal handler, should allow user to register only one catch-all that not only drains all unhandled-yet-buffered when registered, but then gets each unhandled signal after that. The function should get the signal name and the args.

Need to do the same for query and update.

Seems an early proposal on this is already at #973. Incorporate as needed.


### Checklist

- [x] Workflows: #1038
- [x] Signals: #1038 
- [x] Queries: #1639
- [x] Updates: not implemented yet
- [x] Activities: not implemented yet


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-16 23:44:12.000 UTC</summary>

Also related: #846

</details>


---

<a id="998"></a>

### #998: [Feature Request] Add built-in support for context propagators

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/998 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-12-13 00:03:07.000 UTC (3 years ago) |
| **Updated** | 2024-09-27 16:43:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Currently we recommend implementing those with interceptors but seems like there's enough demand for a simpler context propagation specific API (see Java and Go SDKs for reference).

Internally we may choose to implement context propagation with interceptors or expose a context propagation interceptor for users.

#### Comments (3)

<details>
<summary><strong>cretz</strong> commented on 2022-12-13 00:25:08.000 UTC</summary>

If this gets implemented before Python or .NET, can we make it experimental until one other SDK gets it? I think it's worth seeing how it could be best done in a modern way in multiple languages.

</details>

<details>
<summary><strong>Prashansa-K</strong> commented on 2023-01-21 17:37:20.000 UTC</summary>

@bergundy @cretz Is there any ETA for this?
I am using interceptors right now. When a request comes to my service (which does a bunch of ops before starting a temporal workflow) that starts a temporal workflow it leads to one trace (trace A) and another trace comes from the entire workflow execution (trace B). How can I connect these two traces?
I tried the context propagation method in this doc but that doesn't work. https://docs.temporal.io/application-development/observability?lang=typescript#tracing
Is there any other way to achieve a complete trace? Is there any working example that can be followed for the same?

When this feature request is done and a context propagator is provided, will it be possible to connect the traces?
I see that the golang SDK already provides this option via [ClientOptions](https://pkg.go.dev/go.temporal.io/sdk/internal#ClientOptions). 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-02-16 01:42:00.000 UTC</summary>

I'll prioritize, no ETA at the moment.

</details>


---

<a id="981"></a>

### #981: [Feature Request] Support usage of class `URL` inside workflow sandbox

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/981 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2022-11-30 16:17:05.000 UTC (3y 1m ago) |
| **Updated** | 2024-10-22 21:25:14.000 UTC |
| **Closed** | 2023-07-18 20:06:48.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

## Proposition

Expose the [WHATWG URL API](https://nodejs.org/api/url.html#the-whatwg-url-api) in workflow context. 


## Description

The [WHATWG URL API](https://nodejs.org/api/url.html#the-whatwg-url-api) class makes it easy to validate, parse and build URLs, including support for query args, percent encoding, international domain names (aka punnycode) and some more.

- This API includes no feature that could break workflow determinism (no DNS resolution, no "make a request from this URL" function, etc).
- Users have mentioned the need to use this API from a workflow context.
- At the moment, this requires either delegating this usage to a local activity (or a regular activity) or having users load an appropriate polyfill.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-18 20:06:48.000 UTC</summary>

Fixed by #1173 

</details>


---

<a id="913"></a>

### #913: [Bug] `stress-tests` may time out

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/913 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-10-10 22:34:10.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-13 11:49:29.000 UTC |
| **Closed** | 2022-10-13 11:49:29.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug, duplicate |
| **Assignees** | None |
| **Milestone** | None |

#### Description

[stress-tests / stress-test](https://github.com/temporalio/sdk-typescript/actions/runs/3222639386/jobs/5271917118#logs)

seemed stuck on 

```
WFs complete (9940/10000)
```

#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2022-10-10 23:26:12.000 UTC</summary>

second run seemed stuck on:

```
WFs complete (63/100)
```

[stress-tests / stress-test](https://github.com/temporalio/sdk-typescript/actions/runs/3222639386/jobs/5272202180#logs)

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-10 23:28:14.000 UTC</summary>

It's a known issue, we need to fix the stress test to recycle the instance every once in a while.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-10-13 11:49:29.000 UTC</summary>

Duplicate of #853

</details>


---

<a id="885"></a>

### #885: [Bug] Duplicate identifier 'Long'

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/885 |
| **State** | CLOSED |
| **Author** | marcoboucas (Marco Boucas) |
| **Created** | 2022-09-23 09:09:41.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-03 07:39:17.000 UTC |
| **Closed** | 2022-10-03 07:39:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We were deploying a new version of our API and our CI worker failed with an error that seems to be linked to temporalio last version 1.3.0

### Describe the bug

It seems like the version 1.3.0 of @temporalio/protos has a duplicated const declaration on top of the file

Our package.json contains the following packages:
```
"@temporalio/client": "^1.1.0"
```

Complete version of the dependencies of our app
```
    "@google-cloud/speech": "^4.4.0",
    "@google-cloud/storage": "^6.1.0",
    "@google-cloud/text-to-speech": "^3.4.0",
    "@nestjs/axios": "^0.0.7",
    "@nestjs/common": "^8.4.2",
    "@nestjs/config": "^2.0.0",
    "@nestjs/core": "^8.4.2",
    "@nestjs/platform-express": "^8.4.2",
    "@nestjs/platform-socket.io": "^8.4.3",
    "@nestjs/schedule": "^1.0.2",
    "@nestjs/swagger": "^5.2.0",
    "@nestjs/terminus": "^8.0.6",
    "@nestjs/typeorm": "^8.0.3",
    "@nestjs/websockets": "^8.4.2",
    "@temporalio/client": "1.1.0",
    "@types/lodash": "^4.14.170",
    "@types/uuid": "^8.3.0",
    "class-transformer": "^0.4.0",
    "class-validator": "^0.13.2",
    "dotenv": "^8.2.0",
    "joi": "^17.4.0",
    "joi-to-swagger": "^6.0.1",
    "js-yaml": "^4.1.0",
    "lodash": "^4.17.21",
    "pg": "^8.5.1",
    "pumpify": "^2.0.1",
    "reflect-metadata": "^0.1.13",
    "rimraf": "^3.0.2",
    "rxjs": "^7.5.5",
    "socket.io": "^4.4.1",
    "swagger-ui-express": "^4.1.6",
    "tmp": "^0.2.1",
    "typeorm": "^0.2.31",
    "uuid": "^8.3.2"
```

We started having problems after the release of the 1.3.0 version of @temporalio/proto, and a switch back to the 1.1.0 version fixed the problem

![Capture d‚ÄôeÃÅcran 2022-09-21 aÃÄ 11 09 13](https://user-images.githubusercontent.com/45031690/191925740-025d20da-4b46-458c-87bf-d987e8387f50.png)


### Minimal Reproduction

Build an app with nest, and in your package.json use the latest version of the temporalio/client seems to trigger an error for us

### Environment/Versions


- OS and processor: M1 Mac, Gitlab CI runner (node:16)
- Temporal Version: 1.3.0
- Are you using Docker or Kubernetes or building Temporal from source? no need to launch the temporal stack to trigger the error

### Additional context

We have fixed this problem temporary by overriding all the versions of @temporalio libraries to 1.1.0


#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2022-09-23 16:03:04.000 UTC</summary>

I see it, we'll issue a fix soon.
Thanks for reporting.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-23 16:07:35.000 UTC</summary>

Found the issue.
We were compensating for the fact that `pbts` didn't add the `long` import in our proto generation script and just recently this was fixed: https://github.com/protobufjs/protobuf.js/blame/d0268490cb08d2f88e0aafd1d0eb673bd2d3c714/cli/pbts.js#L173.

Reactions: üéâ 1

</details>

<details>
<summary><strong>marcoboucas</strong> commented on 2022-10-03 07:39:17.000 UTC</summary>

This has been fixed in `1.4.0`, thanks a lot !

</details>


---

<a id="850"></a>

### #850: [Bug] Error running Temporal SDK inside linux docker container (might need musl target?)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/850 |
| **State** | CLOSED |
| **Author** | noxasaxon (Saxon) |
| **Created** | 2022-08-25 08:20:39.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-30 09:04:20.000 UTC |
| **Closed** | 2022-08-30 04:39:37.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

build & run a Docker container that runs `Worker.create()` using the Temporal Typescript SDK.

### Describe the bug

Failure when running javascript that uses the Temporal SDK from a linux based docker container without `gcc` installed.

I looked at other rust-based node libraries such as SWC and it looks like their node_modules package in my container includes both `linux-gnu` & `linux-musl` binaries while the temporal core-bridge only shows a `-gnu` binary, if that helps at all.

Error output :
```
/app/node_modules/@temporalio/core-bridge/index.js:10
    throw err;
    ^

Error: Error loading shared library ld-linux-x86-64.so.2: No such file or directory (needed by /app/node_modules/@temporalio/core-bridge/releases/x86_64-unknown-linux-gnu/index.node)
    at Module._extensions..node (node:internal/modules/cjs/loader:1196:18)
    at Module.load (node:internal/modules/cjs/loader:988:32)
    at Module._load (node:internal/modules/cjs/loader:834:12)
    at Module.require (node:internal/modules/cjs/loader:1012:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at Object.<anonymous> (/app/node_modules/@temporalio/core-bridge/index.js:5:20)
    at Module._compile (node:internal/modules/cjs/loader:1112:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1166:10)
    at Module.load (node:internal/modules/cjs/loader:988:32)
    at Module._load (node:internal/modules/cjs/loader:834:12) {
  code: 'ERR_DLOPEN_FAILED'
}

Node.js v18.5.0
```

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- intel mac pro 16 2020
- SDK version 1.1.0 (issue also appears in previous version)
- MacOS compiling linux docker container (container does not have gcc installed)

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2022-08-25 12:27:27.000 UTC</summary>

Using `musl` based images (such as Alpine) [is not supported](https://docs.temporal.io/typescript/production-deploy#do-not-use-alpine).

Can you try with a glibc based image, such as `node`? In any case, you _don't_ need to have gcc installed.

If you want a lightweight image, you can consider using the `node-slim` base image, with the `ca-certificates` package added.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-30 04:39:37.000 UTC</summary>

Closing this, it‚Äôs a documented limitation https://docs.temporal.io/typescript/production-deploy#do-not-use-alpine.
We might support this in the future though.

Reactions: üëç 1

</details>

<details>
<summary><strong>noxasaxon</strong> commented on 2022-08-30 09:04:20.000 UTC</summary>

Hey sorry for the delayed response, I had read those docs before and completely forgot about them while debugging other docker issues ü§¶ .

Sorry for the pings, musl support would be cool but its not a huge blocker for me.

</details>


---

<a id="822"></a>

### #822: [Bug] nodeModulesPath is still used in the docs, it seems to have been removed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/822 |
| **State** | CLOSED |
| **Author** | ErlanBelekov (erlanbelekov) |
| **Created** | 2022-08-17 11:16:22.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-18 05:23:18.000 UTC |
| **Closed** | 2022-08-18 05:23:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### What are you really trying to do?

It would be great if the SDK docs highlighted most up to date info.
Currently, the SDK throws an error

`Object literal may only specify known properties, and 'nodeModulesPaths' does not exist in type 'WorkerOptions'`

```
  const worker = await Worker.create({
    workflowsPath: require.resolve('./workflows'),
    connection,
    namespace: process.env.TEMPORAL_NAMESPACE ?? 'default',

    // use Dependency Injection
    activities: createActivities({
      prisma,
    }), // directly imported in Node.js
    taskQueue,
    nodeModulesPaths: [`${__dirname}/../node_modules/`],
  })
```

### Describe the bug

<!-- A clear and concise description of what the bug is. -->
Here it is used and shown
https://docs.temporal.io/typescript/troubleshooting/
https://docs.temporal.io/typescript/workers/#how-to-develop-a-worker

<!-- Please complete the following information where relevant. -->

- OS and processor: Mac intel
- Are you using Docker or Kubernetes or building Temporal from source? Docker, also K8s in prod

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-17 22:45:17.000 UTC</summary>

Thanks for reporting! We removed it, as we should now always detect it correctly. If you remove the option, does it work?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-08-17 22:50:50.000 UTC</summary>

Updated the docs in: https://github.com/temporalio/documentation/pull/1425

</details>

<details>
<summary><strong>ErlanBelekov</strong> commented on 2022-08-18 05:23:12.000 UTC</summary>

great, thanks!

</details>


---

<a id="797"></a>

### #797: [Bug] Node.js fatal error on signalWithStart

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/797 |
| **State** | CLOSED |
| **Author** | jhecking (Jan Hecking) |
| **Created** | 2022-07-31 13:21:52.000 UTC (3y 5m ago) |
| **Updated** | 2022-07-31 15:33:24.000 UTC |
| **Closed** | 2022-07-31 13:46:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to send a signal to a workflow that might, or might not yet, exist using the client's signalWithStart function. The workflow maintains a list of subscribers and the signal is intended to add a new subscriber to the list.

### Describe the bug

When the workflow does not yet exist, and gets started through the client's signalWithStart function, the workflow worker crashes with a fatal Node.js error:

```
$ ts-node test/broker
2022-07-31T13:12:46.918Z [INFO] asset main.js 230 KiB [emitted] (name: main) 1 related asset
2022-07-31T13:12:46.919Z [INFO] runtime modules 937 bytes 4 modules
2022-07-31T13:12:46.919Z [INFO] modules by path ./node_modules/@temporalio/ 158 KiB
2022-07-31T13:12:46.919Z [INFO]   modules by path ./node_modules/@temporalio/workflow/lib/*.js 93.1 KiB 11 modules
2022-07-31T13:12:46.920Z [INFO]   modules by path ./node_modules/@temporalio/common/lib/ 48.1 KiB 10 modules
2022-07-31T13:12:46.920Z [INFO]   modules by path ./node_modules/@temporalio/internal-workflow-common/lib/*.js 14.4 KiB
2022-07-31T13:12:46.920Z [INFO]     ./node_modules/@temporalio/internal-workflow-common/lib/index.js 1.3 KiB [built] [code generated]
2022-07-31T13:12:46.920Z [INFO]     + 9 modules
2022-07-31T13:12:46.920Z [INFO]   ./node_modules/@temporalio/worker/lib/workflow-log-interceptor.js 2.25 KiB [built] [code generated]
2022-07-31T13:12:46.920Z [INFO] modules by path ./src/broker/ 1.79 KiB
2022-07-31T13:12:46.920Z [INFO]   ./src/broker/workflows-entrypoint-61e328ef909dd85f.js 561 bytes [built] [code generated]
2022-07-31T13:12:46.920Z [INFO]   ./src/broker/workflows.ts 1.24 KiB [built] [code generated]
2022-07-31T13:12:46.920Z [INFO] __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
2022-07-31T13:12:46.920Z [INFO] ./node_modules/long/umd/index.js 43.1 KiB [built] [code generated]
2022-07-31T13:12:46.920Z [INFO] ./node_modules/ms/index.js 2.95 KiB [built] [code generated]
2022-07-31T13:12:46.920Z [INFO] webpack 5.74.0 compiled successfully in 684 ms
2022-07-31T13:12:46.922Z [INFO] Workflow bundle created { size: '0.22MB' }
2022-07-31T13:12:47.111Z [INFO] Worker state changed { state: 'RUNNING' }
[topic(ps:hello)] Creating new topic ps:hello


#
# Fatal error in , line 0
# Check failed: !holder_map.has_named_interceptor().
#
#
#
#FailureMessage Object: 0x70001207a690
 1: 0x10cf1c312 node::NodePlatform::GetStackTracePrinter()::$_3::__invoke() [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 2: 0x10def1722 V8_Fatal(char const*, ...) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 3: 0x10d42ed14 v8::internal::ConcurrentLookupIterator::TryGetPropertyCell(v8::internal::Isolate*, v8::internal::LocalIsolate*, v8::internal::Handle<v8::internal::JSGlobalObject>, v8::internal::Handle<v8::internal::Name>) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 4: 0x10dfe8967 v8::internal::compiler::(anonymous namespace)::GetPropertyCellFromHeap(v8::internal::compiler::JSHeapBroker*, v8::internal::Handle<v8::internal::Name>) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 5: 0x10e00b0e2 v8::internal::compiler::JSGlobalObjectRef::GetPropertyCell(v8::internal::compiler::NameRef const&, v8::internal::compiler::SerializationPolicy) const [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 6: 0x10e07d15e v8::internal::compiler::JSNativeContextSpecialization::ReduceNamedAccess(v8::internal::compiler::Node*, v8::internal::compiler::Node*, v8::internal::compiler::NamedAccessFeedback const&, v8::internal::compiler::AccessMode, v8::internal::compiler::Node*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 7: 0x10e079637 v8::internal::compiler::JSNativeContextSpecialization::ReduceJSLoadNamed(v8::internal::compiler::Node*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 8: 0x10dfd554a v8::internal::compiler::Reducer::Reduce(v8::internal::compiler::Node*, v8::internal::compiler::ObserveNodeManager*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
 9: 0x10e1095cd v8::internal::compiler::(anonymous namespace)::SourcePositionWrapper::Reduce(v8::internal::compiler::Node*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
10: 0x10dfd649d v8::internal::compiler::GraphReducer::Reduce(v8::internal::compiler::Node*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
11: 0x10dfd5ee0 v8::internal::compiler::GraphReducer::ReduceTop() [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
12: 0x10dfd5b38 v8::internal::compiler::GraphReducer::ReduceNode(v8::internal::compiler::Node*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
13: 0x10e109334 v8::internal::compiler::InliningPhase::Run(v8::internal::compiler::PipelineData*, v8::internal::Zone*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
14: 0x10e0fc0ab void v8::internal::compiler::PipelineImpl::Run<v8::internal::compiler::InliningPhase>() [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
15: 0x10e0f89be v8::internal::compiler::PipelineImpl::CreateGraph() [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
16: 0x10e0f8323 v8::internal::compiler::PipelineCompilationJob::PrepareJobImpl(v8::internal::Isolate*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
17: 0x10d0e24b6 v8::internal::OptimizedCompilationJob::PrepareJob(v8::internal::Isolate*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
18: 0x10d0e79ca v8::internal::(anonymous namespace)::GetOptimizedCode(v8::internal::Isolate*, v8::internal::Handle<v8::internal::JSFunction>, v8::internal::ConcurrencyMode, v8::internal::CodeKind, v8::internal::BytecodeOffset, v8::internal::JavaScriptFrame*, v8::internal::(anonymous namespace)::GetOptimizedCodeResultHandling) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
19: 0x10d0e8cb6 v8::internal::Compiler::CompileOptimized(v8::internal::Isolate*, v8::internal::Handle<v8::internal::JSFunction>, v8::internal::ConcurrencyMode, v8::internal::CodeKind) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
20: 0x10d56b903 v8::internal::Runtime_CompileOptimized_Concurrent(int, unsigned long*, v8::internal::Isolate*) [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
21: 0x10d913319 Builtins_CEntry_Return1_DontSaveFPRegs_ArgvOnStack_NoBuiltinExit [/Users/jhecking/.nvm/versions/node/v16.9.0/bin/node]
error Command failed with signal "SIGTRAP".
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
```

### Minimal Reproduction

The issue can be reproduced using the code at https://github.com/Securezapp/temporal-pubsub.

The relevant parts are in `src/broker/workflow.ts`:

```typescript
export type SubscribeInput = [string]
const subscribeSignal = defineSignal<SubscribeInput>('subscribe')

export async function topic (): Promise<void> {
  const topicName = workflowInfo().workflowId
  const subscribers = new Set<string>()

  console.log(`Creating new topic ${topicName}`)

  setHandler(subscribeSignal, (taskQueue) => {
    console.log(`Adding subsciber: "${taskQueue}"`)
    subscribers.add(taskQueue)
    return Promise.resolve(undefined)
  })

  while (true) {
    sleep('1 year')
  }
}
```

And in `src/subscriber/index.ts`:

```typescript
    const client = new WorkflowClient({
      ...options,
      connection: options.brokerConnection
    })
    for (const topic in subscriptions) {
      if (subscriptions.hasOwnProperty(topic)) {
        console.log(`Subscribing to ${topic}`)
        await client.signalWithStart<typeof TopicWorkflow, SubscribeInput>('topic', {
          signal: 'subscribe',
          signalArgs: [taskQueue],
          taskQueue: options.brokerTaskQueue,
          workflowId: workflowIdForTopic(topic)
        })
      }
    }
```

To run the code:
1. Check out the repository above.
2. Run `yarn` to install the dependencies.
3. Run `yarn broker` to run the broker workflow worker.
4. Run `yarn subscriber` to run the subscriber worker in a separate terminal.5. 

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: macOS on x86
- Temporal Version: TypeScript SDK 1.0.1
- Are you using Docker or Kubernetes or building Temporal from source? Using  `docker compose up`

#### Comments (3)

<details>
<summary><strong>jhecking</strong> commented on 2022-07-31 13:46:00.000 UTC</summary>

Turns out, the issue was just a missing `await` in the workflow's `while(true) { sleep('1 year') }` loop. ü§¶‚Äç‚ôÇÔ∏è 

Btw, is there a better way to make a workflow sleep indefinitely?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-31 15:10:08.000 UTC</summary>

I‚Äôm glad you worked it out.
You can add an eslint rule to verify that promises are awaited and save yourself some trouble.
To make the workflow block indefinitely, use:


```ts
await CancellationScope.current().cancelRequested
// or
await condition(() => false)
```

</details>

<details>
<summary><strong>jhecking</strong> commented on 2022-07-31 15:30:31.000 UTC</summary>

> You can add an eslint rule to verify that promises are awaited and save yourself some trouble.

That‚Äôs th worst part: I usually do. But this is (so far) a toy project, and I hadn‚Äôt added our usually eslint rules yet‚Ä¶ üòû 

> await CancellationScope.current().cancelRequested

Thanks! This is exactly what I was looking for.

</details>


---

<a id="740"></a>

### #740: [Feature Request] Add `ChildWorkflowHandle.cancel()`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/740 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-01 22:25:21.000 UTC (3y 6m ago) |
| **Updated** | 2025-10-06 15:12:16.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Currently can only cancel a child by canceling a scope.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Would be convenient to be able to do `childHandle.cancel()`

Current handle API: https://typescript.temporal.io/api/interfaces/workflow.childworkflowhandle/



#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-02 19:57:55.000 UTC</summary>

Related [Slack](https://temporalio.slack.com/archives/C01DKSMU94L/p1683053747688419) discussion.

Two possible work arounds:
- Use `getExternalWorkflowHandle` to get a regular `WorkflowHandle` on the child workflow. Then use that handle to send the cancel command.
- Start the child in a cancellation scope, then cancel the scope.

</details>


---

<a id="695"></a>

### #695: [Feature Request] Add `WorkflowInfo.historySizeInBytes`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/695 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-13 18:26:17.000 UTC (3y 7m ago) |
| **Updated** | 2023-09-06 19:13:18.000 UTC |
| **Closed** | 2023-09-06 19:13:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement, good first issue |
| **Assignees** | antlai-temporal |
| **Milestone** | None |

#### Description

Blocked by: server adding history size

#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2023-06-07 06:56:16.000 UTC</summary>

Waiting on: https://github.com/temporalio/sdk-core/issues/564

</details>

<details>
<summary><strong>lorensr</strong> commented on 2023-06-15 20:34:23.000 UTC</summary>

Ready¬†‚ò∫Ô∏è

</details>

<details>
<summary><strong>cretz</strong> commented on 2023-08-02 17:59:47.000 UTC</summary>

Don't forget `isContinueAsNewSuggested`

</details>


---

<a id="691"></a>

### #691: [Feature Request] Cache Rust deps in CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/691 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-10 15:20:33.000 UTC (3y 7m ago) |
| **Updated** | 2022-09-12 23:46:51.000 UTC |
| **Closed** | 2022-09-12 23:46:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Use https://github.com/Swatinem/rust-cache to improve build times. 

> Seems it caches dependencies (PRs can't share cache w/ each other, but can from the main build which is plenty helpful for our use case since we also run on main push). It only caches deps not local crates of course. I predict it might save 2.5 mins on dev builds and 4 mins on release builds on slower targets. GH projects/actions are given cache space to use, so this uses it. Ref https://www.reillywood.com/blog/rust-faster-ci/

#### Comments (3)

<details>
<summary><strong>cretz</strong> commented on 2022-06-13 13:25:09.000 UTC</summary>

I have added this to the Python SDK, and it is currently broken. Ref issue 52 on https://github.com/Swatinem/rust-cache.

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-06-15 13:13:12.000 UTC</summary>

I fixed this by setting `working-directory` in the options. See https://github.com/temporalio/sdk-python/pull/50.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-12 23:46:51.000 UTC</summary>

I just merged a PR (#864) that uses the action, save a few minutes.
Wish we'd done this a while ago..

</details>


---

<a id="661"></a>

### #661: [Bug] Cannot create a new workflow with same workflowId of a completed one

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/661 |
| **State** | CLOSED |
| **Author** | ThePinger (Omar Emad) |
| **Created** | 2022-05-21 22:15:33.000 UTC (3y 7m ago) |
| **Updated** | 2022-05-21 23:18:16.000 UTC |
| **Closed** | 2022-05-21 23:18:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Well I'm trying to create a new workflow with the same `workflowId` of a Completed one. 

### Describe the bug

I keep on receiving `WorkflowNotFoundError: workflow execution already completed` despite specifying the `workflowIdReusePolicy` as `ALLOW_DUPLICATE`

Here's the code: 

```ts
export async function runWorkflow(
  id: string,
  startDate: Date
) {
  try {
    const handle = await client.start(workflowExample, {
      args: [id, startDate],
      taskQueue: 'examples',
      workflowId: `workflow-${id}`,
      workflowIdReusePolicy:
        WorkflowIdReusePolicy.WORKFLOW_ID_REUSE_POLICY_ALLOW_DUPLICATE,
    })
    console.log(`Started workflow ${handle.workflowId}`)
  } catch (e: any) {
    console.error(e)
  }
}
```

and here's the error:

```shell
WorkflowNotFoundError: workflow execution already completed
    at WorkflowClient.rethrowGrpcError (/PATH_TO_NODE_MODULES/node_modules/@temporalio/client/src/workflow-client.ts:521:15)
    at WorkflowClient._signalWorkflowHandler (/PATH_TO_NODE_MODULES/node_modules/@temporalio/client/src/workflow-client.ts:584:12)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at Object.signal (/PATH_TO_NODE_MODULES/node_modules/@temporalio/client/src/workflow-client.ts:811:9) {
  workflowId: 'workflow-cl3gea8x40340ukooxl1jyrkl',
  runId: undefined
}
```

### Minimal Reproduction

Tried using the hello-world template with the same id and it surprisingly worked so not sure what's the problem here

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world


### Environment/Versions

- OS and processor: Intel macOS Monterey 12.1
- Temporal Version: 1.16.2 
- Temporal TypeScript SDK Version: 0.22.0
- Using Docker to run Temporal



#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2022-05-21 22:37:04.000 UTC</summary>

I was also unable to reproduce:

https://github.com/temporalio/samples-typescript/blob/repro-allow-duplicate/hello-world/src/client.ts#L22-L23

From `at Object.signal` in the trace, it looks like the error is actually coming from calling `handle.signal()`?

</details>

<details>
<summary><strong>ThePinger</strong> commented on 2022-05-21 23:02:53.000 UTC</summary>

Hey @lorensr thanks for the fast reply. My bad really sorry for this issue as u said it was a result from `handle.signal()` but for some reason I thought that was not the issue. Again thanks for your help.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-05-21 23:18:15.000 UTC</summary>

No problem, welcome! ‚ò∫Ô∏è

Reactions: ‚ù§Ô∏è 1

</details>


---

<a id="639"></a>

### #639: [Feature Request] Disable up-to-date PRs requirement

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/639 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-05 23:39:36.000 UTC (3y 8m ago) |
| **Updated** | 2022-05-05 23:43:09.000 UTC |
| **Closed** | 2022-05-05 23:43:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Whenever a PR is merged, all other PRs are blocked with this message:

<img width="1205" alt="image" src="https://user-images.githubusercontent.com/251288/167043418-0b2ad017-4f18-4258-b428-643e09351179.png">

Hitting `Update branch` restarts actions, which can take a while to complete. While I can then do `Enable auto-merge`:

<img width="888" alt="image" src="https://user-images.githubusercontent.com/251288/167043517-c24d70f6-516a-49f0-88cf-8ca657acb748.png">

it not infrequently requires "Rerun failed checks" to be manually hit, and won't work if another PR is merged in the meantime.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

We uncheck this box:

<img width="969" alt="image" src="https://user-images.githubusercontent.com/251288/167043347-786dfb6b-50cb-40f1-9922-e5d093d7c661.png">

Pro: takes much less time to merge PRs
Con: slightly less safe: delayed knowledge of failure. In the event that the PR is green but wouldn't be if updated, and we merge without updating, we'll get notified of the failing test on `main` of the merge commit.

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 23:42:11.000 UTC</summary>

I vote for this

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 23:42:22.000 UTC</summary>

Let me disable it now

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-05-05 23:43:09.000 UTC</summary>

Done

</details>


---

<a id="629"></a>

### #629: [Feature Request] Support loading history from tctl / web JSON exports in replayer

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/629 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-05-02 21:37:03.000 UTC (3y 8m ago) |
| **Updated** | 2022-08-17 18:37:50.000 UTC |
| **Closed** | 2022-07-14 22:18:48.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

Now that we're compiling our protos using `json-module` output we should be able to use proper proto json serialization.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 22:18:48.000 UTC</summary>

Done

</details>


---

<a id="612"></a>

### #612: [Bug] Heap out of memory on `setHandler(signal, undefined)`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/612 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2022-04-25 22:35:20.000 UTC (3y 8m ago) |
| **Updated** | 2022-04-26 19:57:39.000 UTC |
| **Closed** | 2022-04-26 19:57:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | 1.0 |

#### Description

### What are you really trying to do?

In many of our workflows, we need to wait for a single occurrence of a given signal before execution before we continue with following steps, similar to the `workflow.GetSignalChannel(ctx, signalName).Receive(ctx, &args)` pattern in Go.

The TypeScript SDK does not yet offer an exact replacement for this idiom. It is obviously possible to register a signal handler, which sets a boolean value, and then `await condition(...that boolean variable...)`. However, this pattern results in consuming _all_ occurrences of the signal, where we would expect it to consume _only the first_ occurence of the signal.

For this reason, we constructed the function shown below. It has the particularity that, after receiving the expected signal, it clears up the signal handler, by calling `setHandler(signal, undefined)`. This is done from _inside_ the signal handler in order to ensure that only one "occurence" of the signal is consumed by the handler. It works great, except for the problem described in this ticket.

Here is the code:

```
export async function waitForSignal<T extends SignalDefinition>(
    signal: T,
    timeout?: number | string,
): Promise<ExtractSignalArgs<T> | false> {
    let signalReceived = false;
    let returnArgs: ExtractSignalArgs<T> | false = false;

    setHandler(signal, ((...inputArgs: ExtractSignalArgs<T>): void => {
        signalReceived = true;
        returnArgs = inputArgs;
        clearHandler(signal); // This one is required to ensure that we consume only one occurence of the signal
    }) as Handler<void, ExtractSignalArgs<T>, T>);

    await condition(() => signalReceived, timeout as number);
    clearHandler(signal); // This one is required in case we timed out

    return returnArgs;
}

export function clearHandler<T extends SignalDefinition>(signal: T) {
    setHandler(signal as SignalDefinition<[]>, undefined as unknown as Handler<void, [], T>);
}
```


### Describe the bug

Calling `setHandler(signal, undefined)` while there are buffered signals occurrences for that name results in heap out of memory.

The problem 

### Minimal Reproduction

```
workflow() {
    await sleep('30s');  // During this pause, send this workflow the given signal a few times
    setHandler(signal, () => {
        setHandler(signal, undefined);
    })
}
```

This results in a Node crash with the following message: `FATAL ERROR: invalid array length Allocation failed - JavaScript heap out of memory`.

### Analysis

Our analysis demonstrated that the problem is due to a subtile interaction between `setHandler` and `signalWorkflow`. After changing the handler, `setHandler` iterates over buffered signals and try to process each one. To do so, it calls `signalWorkflow`, which checks if a handler for that signal is actually defined. Now, since our handler is undefined, `signalWorkflow` instead push the signal occurence to the corresponding signal buffer. Turns out that this is the very same array over which `setHandler` is iterating at that very same time.

```
// in workflow.ts
export function setHandler<Ret, Args extends any[], T extends SignalDefinition<Args> | QueryDefinition<Ret, Args>>(
  def: T,
  handler: Handler<Ret, Args, T>
): void {
  if (def.type === 'signal') {
    state.signalHandlers.set(def.name, handler as any);
    const bufferedSignals = state.bufferedSignals.get(def.name);
    if (bufferedSignals !== undefined) {
      for (const signal of bufferedSignals) {
        state.activator.signalWorkflow(signal);
      }
      state.bufferedSignals.delete(def.name);
    }

// in internals.ts
  public signalWorkflow(activation: coresdk.workflow_activation.ISignalWorkflow): void {
    ...

    const fn = state.signalHandlers.get(signalName);
    if (fn === undefined) {
      let buffer = state.bufferedSignals.get(signalName);
      if (buffer === undefined) {
        buffer = [];
        state.bufferedSignals.set(signalName, buffer);
      }
      buffer.push(activation);  // <-- PUSH
      return;
    }

    ...
  }
```

### Proposed solutions

I propose moving the `state.bufferedSignals.delete(def.name)` line before the `for` loop. As an optimization, it would also be useful not to process buffered signals if the new handler is `undefined`.

```
    if (bufferedSignals !== undefined && handler !== undefined) {
      state.bufferedSignals.delete(def.name);
      for (const signal of bufferedSignals) {
        state.activator.signalWorkflow(signal);
      }
    }
```

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2022-04-25 22:40:24.000 UTC</summary>

Interesting, thanks for the report.
Do you want to fix this or should I? The proposed fix should work.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-04-25 23:28:51.000 UTC</summary>

@bergundy Sure, I can submit a PR for this tomorrow.

If you don't mind, I would also modify the `setHandler` function signature to make it clears that the `handler` can be set to `undefined`. We are certainly not the only ones thats sees use cases for this.

> bergundy added this to the 1.0 milestone

So we're moving toward 1.0? Great to hear! Congrats to the team! üéâ üéâ üéâ 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-25 23:31:43.000 UTC</summary>

Thanks again @mjameswh!

Feel free to update the signature for `setHandler` too.

</details>


---

<a id="587"></a>

### #587: [Feature Request] Change nonRetryable constructor param

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/587 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-04-14 03:23:30.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-18 20:21:01.000 UTC |
| **Closed** | 2022-04-18 20:21:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | 1.0 |

#### Description

I really dislike negated boolean variable names, as I find them much more difficult to think about than the unnegated form. In the below constructors, I'd like to change `nonRetryable` (default false) to `retryable` (default true). Thoughts?

<img width="849" alt="image" src="https://user-images.githubusercontent.com/251288/163307289-62215c98-cd6a-4cdf-8367-89c754a6395b.png">

<img width="618" alt="image" src="https://user-images.githubusercontent.com/251288/163307319-78aa2deb-061b-4c6d-adb1-c90e14c71f4b.png">


#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2022-04-14 03:31:49.000 UTC</summary>

If we change this now it'd be a critical backwards incompatible change.
I think it's too late at this point.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-04-14 03:39:00.000 UTC</summary>

Like you feel it's too much to ask current users to find all the instances and flip the boolean when they upgrade the SDK?

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-04-14 13:47:12.000 UTC</summary>

> Like you feel it's too much to ask current users to find all the instances and flip the boolean when they upgrade the SDK?

I kinda feel that way. If it was a property on an object, the name change would be obvious, but since it's an unnamed parameter it can be hard to know. FWIW, "non-retryable" is common Temporal nomenclature, so while the double negative may be personally annoying, it does fit with the rest of the Temporal ecosystem.

</details>


---

<a id="580"></a>

### #580: [Bug] Process exits when calling client.start or client.execute

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/580 |
| **State** | CLOSED |
| **Author** | danielrearden (Daniel Rearden) |
| **Created** | 2022-04-08 16:10:31.000 UTC (3y 9m ago) |
| **Updated** | 2022-06-03 22:30:38.000 UTC |
| **Closed** | 2022-06-03 22:30:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We're dealing with some DNS errors in our K8s cluster and wanted to understand how the client would behave if it couldn't resolve the provided address. From what we were seeing in our traces, it looked like errors encountered when calling `start` weren't actually causing the Promise to reject. So I went to test the behavior locally and encountered this issue.

### Describe the bug

Setting the `Connection` address to an address that won't resolve (for example `does-not-exist` or `does-not-exist:7233`) causes subsequent `start` and `execute` calls from the client to exit the process. The exit processes with a 0 status code.

In the reproduction below, you can see that no errors are thrown and no additional logs are generated after the initial "Starting workflow..." one. The process literally just exits.

### Minimal Reproduction

https://github.com/danielrearden/samples-typescript/blob/client-bug/hello-world/src/client.ts

### Environment/Versions

- OS and processor: macOS 12.3
- Temporal Version: @temporalio/client@0.20.0
- Are you using Docker or Kubernetes or building Temporal from source? Docker

### Additional context

If the host _can_ be resolved but a connection can't be established, eventually the call rejects with a `ServiceError`, which is the same behavior I would expect.


#### Comments (3)

<details>
<summary><strong>danielrearden</strong> commented on 2022-04-08 17:06:31.000 UTC</summary>

Update: settings `interceptors` to an empty array causes the call to immediately fail with a `ServiceError` as expected, so the issue appears to be specific to something inside `makeGrpcRetryInterceptor`.

Update 2: [This line](https://github.com/temporalio/sdk-typescript/blob/5214cbe829ee901eddb5dfcefc41b677036d0643/packages/client/src/grpc-retry.ts#L103) appears to be the culprit.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-09 00:46:23.000 UTC</summary>

I see the problem and the fix is pretty trivial.
We‚Äôre changing the connection constructor to an async factory soon so this will be a non issue when that change lands.

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-06-03 22:30:38.000 UTC</summary>

Looks like this doesn't happen anymore, probably solved by upgrading grpc-js

</details>


---

<a id="465"></a>

### #465: [Bug] describeTaskQueue returns empty array of pollers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/465 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-03 19:39:08.000 UTC (3y 11m ago) |
| **Updated** | 2022-02-03 20:36:01.000 UTC |
| **Closed** | 2022-02-03 20:36:01.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

```ts
const response = await client.client.service.describeTaskQueue()
// response.pollers === []
```

https://temporaltechnologies.slack.com/archives/C02KKC7MWHZ/p1643915987747109

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-02-03 20:35:56.000 UTC</summary>

You need to specify the task queue type to get the poller array back:

```
import { Connection } from "@temporalio/client";
import { temporal } from "@temporalio/proto";

async function run() {
  const conn = new Connection();
  const res = await conn.service.describeTaskQueue({
    namespace: "default",
    taskQueue: { name: "my-task-queue" },
    taskQueueType: temporal.api.enums.v1.TaskQueueType.TASK_QUEUE_TYPE_WORKFLOW,
  });
  console.log(res);
}

run();
```

</details>


---

<a id="454"></a>

### #454: [Feature Request] Add default value to workflowId

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/454 |
| **State** | CLOSED |
| **Author** | emmanuelvlad (evlad) |
| **Created** | 2022-01-27 13:54:53.000 UTC (3y 11m ago) |
| **Updated** | 2022-02-01 04:02:05.000 UTC |
| **Closed** | 2022-02-01 04:02:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

The problem is that I import the package `crypto` in every file where I start a workflow, it creates redundant code where I need to set the parameter `workflowId` to `crypto.randomUUID()`

### Describe the solution you'd like

It will be nice to have `workflowId` default's value to `crypto.randomUUID()`. Removes some redundant code

### Additional context

There probably was a reason to remove the default value of `workflowId` but I don't know why (#387)


#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2022-01-28 06:54:42.000 UTC</summary>

Pro of having a default is, as you say, that it makes random ID code shorter/simpler. 

We used to have a default. I think it was removed in an effort to guide users toward using business-meaningful IDs instead of random IDs. Would that make sense to do in your use case? The benefits are:

- Can reduce risk of duplicate Workflows. For instance, if I want to make one Workflow per order, I'd use the `orderId`. Then, if it's still running and I try to create it again, it will fail.
- Removes the need to (and possible problems around) storing the generated `workflowId`.
- Easier to look up Workflow.

I'm personally inclined toward:

- Having a default uuidv4
- Using a business meaningful ID in all or most of the docs and samples

Then we both guide people toward using business IDs **and** allow users for whom UUIDs make sense to write simple/non-redundant code.

Reactions: üëç 1

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-01-29 13:31:42.000 UTC</summary>

we had considered offering a default random id function but also rejected the idea given its not that useful. see internal slack

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-02-01 04:02:02.000 UTC</summary>

I don't see us reverting back to providing a default `workflowId`, the rationale is in the PR linked above.
You should always use meaningful business IDs for workflow IDs in real world scenarios and the API should lead users in that direction.

</details>


---

<a id="393"></a>

### #393: Fix broken init-from-verdaccio in node 14 and enable jobs in CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/393 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-19 15:58:38.000 UTC (4y 1m ago) |
| **Updated** | 2024-05-10 22:45:44.000 UTC |
| **Closed** | 2024-05-10 22:45:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Disabled by @cretz in #385 

#### Comments (3)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-23 21:41:11.000 UTC</summary>

Need to add node 14 and 18 to [the matrix for test-npm-init](https://github.com/temporalio/sdk-typescript/blob/main/.github/workflows/ci.yml#L196-L215).

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-10 17:45:31.000 UTC</summary>

WIP in #1003 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-10 22:45:44.000 UTC</summary>

Completed in #1003

</details>


---

<a id="376"></a>

### #376: Improve error message: context deadline exceeded

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/376 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-11 01:21:34.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-23 20:07:09.000 UTC |
| **Closed** | 2021-11-23 20:07:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Problem

In various scenarios including [this](https://github.com/temporalio/samples-typescript/issues/56), the client throws:

```
Error: 4 DEADLINE_EXCEEDED: context deadline exceeded
    at Object.callErrorFromStatus (/Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/call.ts:81:24)
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/client.ts:343:36)
    at /Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/call-stream.ts:182:27
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/timer-progress/node_modules/@temporalio/client/src/grpc-retry.ts:106:15)
    at InterceptingListenerImpl.onReceiveStatus (/Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/call-stream.ts:178:19)
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/client-interceptors.ts:430:34)
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/client-interceptors.ts:392:48)
    at /Users/me/gh/samples-typescript/timer-progress/node_modules/@grpc/grpc-js/src/call-stream.ts:299:24
    at processTicksAndRejections (node:internal/process/task_queues:78:11) {
  code: 4,
  details: 'context deadline exceeded',
  metadata: Metadata {
    internalRepr: Map(1) { 'content-type' => [Array] },
    options: {}
  }
}
```

### Solution

Log something like:

```
Error: gRPC call timeout. This can happen for a number of reasons. Please see:

https://docs.temporal.io/docs/typescript/troubleshooting/#grpc-call-timeouts-context-deadline-exceeded
```

Migrated from #359 

#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2021-11-11 01:29:21.000 UTC</summary>

Related: #365 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-11 02:15:55.000 UTC</summary>

I like this suggestion, let's merge the 2 issues.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-11-23 20:07:09.000 UTC</summary>

Closing in favor of #365 

</details>


---

<a id="367"></a>

### #367: [Feature Request] Provide better errors when user passes a nameless function to infer workflow name

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/367 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-10 15:19:41.000 UTC (4y 2m ago) |
| **Updated** | 2023-05-30 18:53:24.000 UTC |
| **Closed** | 2023-05-30 18:53:24.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

See related discussion here: https://temporalio.slack.com/archives/C01DKSMU94L/p1636493017132500

#### Comments (3)

<details>
<summary><strong>swyxio</strong> commented on 2021-11-10 20:21:50.000 UTC</summary>

more generally, i'd like to do an "error message review" after beta launch where we go thru stuff like this and add validation/nice errors on all user input stuff

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-03-16 23:03:19.000 UTC</summary>

Related: when workflow Foo is not exported from `workflowsPath`:
```
Child Workflow execution failed
Caused By: ReferenceError: 'Foo' is not a function 
ApplicationFailure: 'Foo' is not a function
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-16 23:36:43.000 UTC</summary>

As for nameless function, I think the client should easily be able to check that at runtime.
We could also wrap the ReferenceError in a more informative error.

</details>


---

<a id="365"></a>

### #365: [Feature Request] Better context for grpc errors in client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/365 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-09 17:31:29.000 UTC (4y 2m ago) |
| **Updated** | 2024-05-14 21:27:46.000 UTC |
| **Closed** | 2022-02-09 20:25:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

Right now client errors are thrown by grpc-js asynchronously and the stack trace is meaningless.
We should catch errors from WorkflowClient methods and rethrow to provide better context.

#### Comments (3)

<details>
<summary><strong>lorensr</strong> commented on 2021-11-23 20:06:54.000 UTC</summary>

A couple of examples:

- `DEADLINE_EXCEEDED` in #376
- `NOT_FOUND`: calling methods on a nonexistent-workflowID handle:

```js
  const handle = client.getHandle('nonexistent');
  await handle.result();
```

```
Error: 5 NOT_FOUND: sql: no rows in result set
    at Object.callErrorFromStatus (/Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/call.ts:81:24)
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/client.ts:343:36)
    at /Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/call-stream.ts:182:27
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/hello-world/node_modules/@temporalio/client/src/grpc-retry.ts:106:15)
    at InterceptingListenerImpl.onReceiveStatus (/Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/call-stream.ts:178:19)
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/client-interceptors.ts:430:34)
    at Object.onReceiveStatus (/Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/client-interceptors.ts:392:48)
    at /Users/me/gh/samples-typescript/hello-world/node_modules/@grpc/grpc-js/src/call-stream.ts:299:24
    at processTicksAndRejections (node:internal/process/task_queues:78:11) {
  code: 5,
  details: 'sql: no rows in result set',
  metadata: Metadata {
    internalRepr: Map(2) {
      'content-type' => [Array],
      'grpc-status-details-bin' => [Array]
    },
    options: {}
  }
}
```

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-11-23 20:49:43.000 UTC</summary>

The not found one needs to be fixed server side - but both calls should have a more meaningful callstack.

</details>

<details>
<summary><strong>iamnafets</strong> commented on 2024-05-14 21:27:45.000 UTC</summary>

I'm still getting "sql: no rows in result set" in error messages. Unfortunately it gives me no leads to debug.

</details>


---

<a id="362"></a>

### #362: [Bug] Patches should be applied to workflow before workflow code is required

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/362 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-09 17:08:48.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-10 22:14:40.000 UTC |
| **Closed** | 2021-11-10 22:14:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

We should support patches at the top level of user code as shown here:
```ts
let runActivity = false;
if (patched('p1')) {
  runActivity = true;
}

export async function myWorkflow() {
  if (runActivity) {
    await myActivity();
  }
}
```

#### Comments (3)

<details>
<summary><strong>Sushisource</strong> commented on 2021-11-09 17:12:17.000 UTC</summary>

@bergundy Keep in mind this will only find patches in the 1st/2nd workflow task

Which I suppose is fine since during non-replay they should be recorded in 1st WFT

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-09 17:39:25.000 UTC</summary>

yup @Sushisource 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-10 21:30:03.000 UTC</summary>

We decided to disallow this because patches at top level apply to all workflows and the experience is too confusing.

</details>


---

<a id="339"></a>

### #339: Speed up GitHub Action

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/339 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-10-26 21:57:54.000 UTC (4y 2m ago) |
| **Updated** | 2024-05-10 22:46:15.000 UTC |
| **Closed** | 2024-05-10 22:46:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

It would be nice if this workflow ran faster (with several PRs I've found myself waiting and checking back on the status and it's usually still in progress):

[.github/workflows/ci.yml](https://github.com/temporalio/sdk-typescript/blob/main/.github/workflows/ci.yml)

Not high priority, and I don't have much experience/ideas around this‚Äîfrom a brief search: maybe more things in parallel, more caching, prebuilt docker images?

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-30 00:17:22.000 UTC</summary>

I have some ideas on how to speed this up.
I talked to the Temporal infra team about getting dedicated runners.
Apart from that I have some other ideas.
This is getting annoying to me too.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-10 17:45:44.000 UTC</summary>

Covered in #1003

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-10 22:46:15.000 UTC</summary>

Completed in #1003

</details>


---

<a id="293"></a>

### #293: Automated release to `next` tag on merge to `main`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/293 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-11 13:03:59.000 UTC (4y 3m ago) |
| **Updated** | 2023-01-10 17:13:47.000 UTC |
| **Closed** | 2023-01-10 17:13:46.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

Updates to the SDK are hard to test without a release.
We'd like to be able to sample some of the new features and fixes for improving the samples and docs.

### Describe the solution you'd like

Automatically publish to npm with the `next` tag (`npm install temporalio@next`) on merge to `main`.

### Additional context

This is a common practice in the node ecosystem.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-10 17:13:46.000 UTC</summary>

Merged into this issue: https://github.com/temporalio/sdk-typescript/issues/170

</details>


---

<a id="291"></a>

### #291: Consider strict boolean check in `condition` function return value

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/291 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-08 20:34:28.000 UTC (4y 3m ago) |
| **Updated** | 2022-10-12 22:20:50.000 UTC |
| **Closed** | 2022-10-11 23:27:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

should we make sure this is `true`, not just truthy?

```ts
      if (cond.fn() === true) {
```

_Originally posted by @sw-yx in https://github.com/temporalio/sdk-node/pull/289#discussion_r725224409_

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:27:34.000 UTC</summary>

Probably too late at this point.

</details>

<details>
<summary><strong>swyxio</strong> commented on 2022-10-12 15:22:59.000 UTC</summary>

sad day for footguns :)

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-12 22:20:50.000 UTC</summary>

I think a lot of users would expect that condition behaves like an `if` statement.
For example, one might expect `condition(() => array.length)` to resolve when there are new elements added to the array.

Reactions: üëç 1

</details>


---

<a id="280"></a>

### #280: SDK version might not be properly set

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/280 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-05 08:10:22.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 16:39:55.000 UTC |
| **Closed** | 2021-10-07 16:39:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | beta |

#### Description

We already read package.json in `pkg`, we should probably just use that.
Shouldn't the SDK version also include the SDK name?

_Originally posted by @bergundy in https://github.com/temporalio/sdk-node/pull/275#r721992896_

#### Comments (3)

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-05 19:17:37.000 UTC</summary>

The sdk name is it's own field. Version should be just the version string.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-06 17:41:35.000 UTC</summary>

Oh, I missed it, it's hardcoded here: https://github.com/temporalio/sdk-node/blob/ec12088a06622a0801c3f8ebd35d198ee4caa923/packages/core-bridge/src/conversions.rs#L165.

I'd still change to use the `pkg` module instead of reading package.json again.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 16:39:55.000 UTC</summary>

I'm closing this, removed the redundant access to package.json in #288 

</details>


---

<a id="233"></a>

### #233: [Feature Request] Match dev and CI linting

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/233 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-11 03:17:39.000 UTC (4y 4m ago) |
| **Updated** | 2021-11-23 02:16:18.000 UTC |
| **Closed** | 2021-11-23 02:16:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

I'd like if these types of linting errors:

![image](https://user-images.githubusercontent.com/251288/132934447-807640e3-d6a0-492f-a01d-202f26ddec9b.png)

showed up when I lint or commit locally:

```
$ npm run lint

> lint
> eslint packages/*/src --ext .ts --no-error-on-unmatched-pattern && prettier --check .

Checking formatting...
All matched files use Prettier code style!
```

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 10:15:25.000 UTC</summary>

You can run commitlint yourself with: `npx commitlint --from origin/main`.
Let's add that to `CONTRIBUTING.md`.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 10:16:41.000 UTC</summary>

I kind of like that commitlint is a separate GH workflow but I'm open to merging it with the `lint` command.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:16:17.000 UTC</summary>

We removed commitlint from CI

</details>


---

<a id="232"></a>

### #232: [Feature Request] Document external calling convention for activities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/232 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-09-10 00:04:58.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-28 13:31:52.000 UTC |
| **Closed** | 2021-09-15 05:54:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Is your feature request related to a problem? Please describe.

When we changed activity registration the way activities are called from outside of the SDK was broken/different. How that works should be documented and we should maintain compatibility going forward.

### Describe the solution you'd like

* Document how calling activities by type-string works
* When the worker fails to find a matching activity type for a given activity task, it should report what activities are available in the error message so user can see that in workflow history

### Additional context

See https://temporalio.slack.com/archives/C01DKSMU94L/p1631223937036500


#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-12 09:50:08.000 UTC</summary>

> ### Is your feature request related to a problem? Please describe.
> When we changed activity registration the way activities are called from outside of the SDK was broken/different. How that works should be documented and we should maintain compatibility going forward.
Yes, that's why I changed it before beta so we'd be forwards compatible and consistent with the other SDKs.
> 
> ### Describe the solution you'd like
> * Document how calling activities by type-string works
https://nodejs.temporal.io/api/classes/workflow.ContextImpl#configureactivities
> * When the worker fails to find a matching activity type for a given activity task, it should report what activities are available in the error message so user can see that in workflow history
Sounds good, it should be easy to add that.

To summarize, we should add the list of available activities to the "activity not found" error.



</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-09-27 20:57:35.000 UTC</summary>

@bergundy did we document this though?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-28 13:31:52.000 UTC</summary>

@sw-yx it's documented here: https://nodejs.temporal.io/api/namespaces/workflow#createactivityhandle

</details>


---

<a id="169"></a>

### #169: [Feature Request] Discuss project structure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/169 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-26 08:28:02.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-31 10:30:19.000 UTC |
| **Closed** | 2021-08-31 10:30:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

From the Temporal community slack channel:

Now that we bundle Workflow code with Webpack we can have Typescript output a commonjs module instead of ES module.
This opens the door to simplifying the project structure, instead of 4 tsconfig files we can now have a single config file.
Doing this means sacrificing some type safety, for example, node types, WeakMap and WeakRef are not defined in the Workflow tsconfig file which should help newcomers avoid some easy to make mistakes.

Specifically these customizations have been made to the workflows `tsconfig.json`
```
      "lib": [
        "es5",
        "es2015.core",
        "es2015.generator",
        "es2015.iterable",
        "es2015.promise",
        "es2015.proxy",
        "es2015.reflect",
        "es2015.symbol",
        "es2015.symbol.wellknown",
        "es2016.array.include",
        "es2017.object",
        "es2017.intl",
        "es2017.sharedmemory",
        "es2017.string",
        "es2017.typedarrays"
      ],
      "typeRoots": [
        "."
      ],
```
(`Weak*` types and node types omitted)

When modifying the project to use a single TS config file, some noticeable differences are:
1.
```
import fs from 'fs';
```
In the composite project you get an error:
Cannot find module 'fs' or its corresponding type declarations
Not a compile time error in the modified project.

2.
```
new WeakMap();
```
In the composite project you get this error:
```
'WeakMap' only refers to a type, but is being used as a value here. Do you need to change your target library? Try changing the `lib` compiler option to es2015 or later.
```
No compile time error in the modified project.

When trying to use fs in the modified example the worker fails to start with:
```
2021-05-20T07:09:18.493Z [INFO]           using description file: /private/tmp/example/package.json (relative path: ./node_modules/fs)
2021-05-20T07:09:18.493Z [INFO]             no extension
2021-05-20T07:09:18.493Z [INFO]               Field 'browser' doesn't contain a valid alias configuration
2021-05-20T07:09:18.493Z [INFO]               /private/tmp/example/node_modules/fs doesn't exist
When instantiating a new WeakMap the user will get an error on Worker startup:
Error [DeterminismViolationError]: WeakMap cannot be used in workflows because v8 GC is non-deterministic
```

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-07-26 08:28:31.000 UTC</summary>

https://temporalio.slack.com/archives/C01DKSMU94L/p1621337921005400

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-07-28 05:47:45.000 UTC</summary>

better developer experience for slightly weaker type safety sounds fine to me. lets make an effort to have nice errors when people do stuff they are not supposed to do

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-24 13:47:42.000 UTC</summary>

As discussed, let's drop the complex project structure.
We should update our samples and documentation accordingly.


</details>


---

<a id="162"></a>

### #162: [Bug] Worker significantly slows down over time

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/162 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-22 14:30:12.000 UTC (4y 5m ago) |
| **Updated** | 2021-07-27 08:50:18.000 UTC |
| **Closed** | 2021-07-27 08:50:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | beta |

#### Description

**To Reproduce**
Steps to reproduce the behavior:
1. Run `node packages/test/lib/perf/all-in-one.js --iterations 20000 --workflow sync --concurrent-wf-clients 500`
2. Observe the printed number of WFs per second over time

**Expected behavior**
Worker should not slow down

**Additional context**
- CPU usage increases over time indicating that it's not a problem with poll throughput
- Using a pool of 8 isolates (compared to 1) makes the slow down less dramatic

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-07-22 15:05:24.000 UTC</summary>

Looks like disposing of the workflow isolate context after activation slows down the degradation, results are inconsistent though.

Sampled output from running `perf` with 16 isolates:

With no dispose:
```
WFs complete (4946/20000), WFs/s 83.0 (81.0), heap used / total MB: 28.03 / 63.39)
WFs complete (7372/20000), WFs/s 72.0 (71.5), heap used / total MB: 24.57 / 60.39)
WFs complete (12844/20000), WFs/s 10.0 (54.6), heap used / total MB: 23.95 / 40.56)
WFs complete (13831/20000), WFs/s 38.0 (52.7), heap used / total MB: 31.28 / 60.53)
```
With dispose:
```
WFs complete (7922/20000), WFs/s 80.9 (75.4), heap used / total MB: 24.85 / 60.64)
WFs complete (11589/20000), WFs/s 41.9 (67.7), heap used / total MB: 35.96 / 62.56)
WFs complete (13100/20000), WFs/s 62.9 (67.1), heap used / total MB: 30.72 / 62.81)
WFs complete (15246/20000), WFs/s 24.0 (66.5), heap used / total MB: 26.14 / 57.27)
WFs complete (17932/20000), WFs/s 53.9 (65.1), heap used / total MB: 29.07 / 61.23)
WFs complete (19800/20000), WFs/s 44.8 (64.2), heap used / total MB: 20.49 / 29.22)
WFs complete (20000/20000), WFs/s 2.5 (61.5), heap used / total MB: 20.64 / 22.72)
```

A second time:
```
WFs complete (3921/30000), WFs/s 87.0 (75.4), heap used / total MB: 27.17 / 60.72)
WFs complete (11277/30000), WFs/s 62.0 (66.3), heap used / total MB: 28.42 / 61.47)
WFs complete (15164/30000), WFs/s 50.0 (63.9), heap used / total MB: 34.02 / 61.41)
WFs complete (19258/30000), WFs/s 60.0 (58.6), heap used / total MB: 30.55 / 63.36)
WFs complete (21249/30000), WFs/s 12.9 (55.7), heap used / total MB: 18.73 / 61.33)
WFs complete (24167/30000), WFs/s 48.0 (50.7), heap used / total MB: 20.58 / 40.55)
WFs complete (25793/30000), WFs/s 15.0 (49.5), heap used / total MB: 32.16 / 61.03)
WFs complete (29955/30000), WFs/s 9.9 (42.1), heap used / total MB: 32.53 / 61.47)
WFs complete (30000/30000), WFs/s 10.4 (41.9), heap used / total MB: 24.44 / 33.47)
```

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-22 15:24:58.000 UTC</summary>

Made this final check to verify this is all isolate related:
Removed all isolate related code and replaced `workflowOperator.mergeMapWithState` with:
```ts
const completion = coresdk.workflow_completion.WFActivationCompletion.encodeDelimited({
  runId: activation.runId,
  successful: {
    commands: [{ completeWorkflowExecution: { result: await defaultDataConverter.toPayload(undefined) } }],
  },
}).finish();
return { state: undefined, output: { close: true, completion, span, parentSpan: root } };
```

No slow down was observed for a while, CPU was stable at around 13%.
```
WFs complete (2359/50000), WFs/s 121.0 (102.5), heap used / total MB: 25.41 / 62.61)
WFs complete (4236/50000), WFs/s 120.0 (108.5), heap used / total MB: 31.95 / 63.36)
WFs complete (6254/50000), WFs/s 121.8 (111.6), heap used / total MB: 27.81 / 63.61)
WFs complete (9868/50000), WFs/s 104.0 (113.4), heap used / total MB: 27.53 / 64.36)
WFs complete (13508/50000), WFs/s 102.0 (112.5), heap used / total MB: 25.47 / 64.61)
WFs complete (19382/50000), WFs/s 124.1 (113.9), heap used / total MB: 26.17 / 64.36)
WFs complete (23214/50000), WFs/s 109.0 (113.7), heap used / total MB: 20.61 / 65.11)
```

After some point CPU dropped to 5% and processing rate dropped with it, htop reveals docker VM is working hard and my fanless M1 MBP is getting too hot for me to keep typing.
Looks like it got better after a while:
```
WFs complete (30006/50000), WFs/s 31.0 (87.4), heap used / total MB: 31.44 / 57.50)
WFs complete (33950/50000), WFs/s 47.9 (76.1), heap used / total MB: 29.12 / 60.69)
WFs complete (44305/50000), WFs/s 101.0 (75.3), heap used / total MB: 26.38 / 63.03)
WFs complete (46865/50000), WFs/s 94.0 (75.8), heap used / total MB: 26.62 / 60.25)
```

Next steps would be to reproduce this in an environment where the Temporal server with DB is not overloaded.



</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-07-26 07:03:52.000 UTC</summary>

After further investigation, seems like the cause was the SDK leaking isolate references.
Fix is pending.

</details>


---

<a id="62"></a>

### #62: [Feature Request] Warn about API instability

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/62 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-04-11 11:27:18.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-20 13:28:40.000 UTC |
| **Closed** | 2021-04-20 13:28:40.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 1 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | alpha |
| **Reactions** | üëç 1 |

#### Description

The project's APIs are unstable until we have enough feedback and the project's more feature complete.

#### Comments (1)

<details>
<summary><strong>swyxio</strong> commented on 2021-04-12 16:50:03.000 UTC</summary>

good idea. what are you seeking feedback on?

</details>


---

<a id="59"></a>

### #59: [Feature Request] Use `@grpc/grpc-js` instead of the deprecated `grpc` package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/59 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-04-07 12:00:52.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-22 23:23:01.000 UTC |
| **Closed** | 2021-04-11 11:40:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

It's implemented in pure JS which should make installations on node 15 faster. 
See:
https://www.npmjs.com/package/@grpc/grpc-js
https://www.npmjs.com/package/grpc

#### Comments (3)

<details>
<summary><strong>swyxio</strong> commented on 2021-04-09 10:45:13.000 UTC</summary>

just so you know we recently had to go the other way in Temporal web bc of a TLS Issue @feedmeapples 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-04-11 11:40:26.000 UTC</summary>

That's unfortunate, I hope this is solved soon.
Can you please link the issue here @sw-yx?

</details>

<details>
<summary><strong>feedmeapples</strong> commented on 2021-04-22 23:21:30.000 UTC</summary>

@bergundy  there is a node GRPC_SSL_CIPHER_SUITES env variable that may help address mTLS issues https://github.com/grpc/grpc-node/issues/804

I couldn't repro the same issue locally (mtls worked fine with simple tls setup), though did see a repro with few other reported servers https://github.com/temporalio/web/pull/301

cc @sw-yx 

</details>


---

<a id="22"></a>

### #22: Run E2E test for `npm init @temporalio`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/22 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-02 12:57:48.000 UTC (4y 10m ago) |
| **Updated** | 2021-11-23 02:19:27.000 UTC |
| **Closed** | 2021-11-23 02:19:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

For each pull request we should verify that this important functionality is not broken.

Steps:
- Run a temporary npm registry (e.g. [verdaccio](https://verdaccio.org/))
- Publish packages to temporary registry
- Run `npm init @temporalio /tmp/example`
- Run the Temporal server (via docker-compose)
- Build the example
- Run the worker
- Run the test
- Stop the worker

Platforms and architectures:
- [x] Windows
- [x] MacOS - Intel chip
- [ ] MacOS - Apple chip
- [x] Linux

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-04-08 06:21:02.000 UTC</summary>

There might be a way to run Temporal docker-compose on Mac in GH actions: https://github.community/t/is-it-possible-to-install-and-configure-docker-on-macos-runner/16981/8

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-05-18 12:00:33.000 UTC</summary>

Currently we test init on an Intel Mac against Temporal Cloud only.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:19:27.000 UTC</summary>

Closing for good enough coverage, the risk is not as high now that we precompile everything and don't have the node-gyp dependency.

</details>


---

<a id="16"></a>

### #16: Distribute pre-built binaries for native code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/16 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-01 14:44:01.000 UTC (4y 10m ago) |
| **Updated** | 2021-06-28 23:15:26.000 UTC |
| **Closed** | 2021-06-28 23:15:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 3 |
| **Priority Score** | 3 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

For [native worker code](https://github.com/temporalio/sdk-node/blob/f7074cd8932cd089702898bbba90b6012cd0c639/packages/worker/native/build.rs) and [workflow-isolate-extension](https://github.com/temporalio/sdk-node/blob/f7074cd8932cd089702898bbba90b6012cd0c639/packages/worker/native/workflow-isolate-extension.cc).

Consider requesting this from [isolated-vm](https://github.com/laverdet/isolated-vm)'s maintainer as well.
References:
https://neon-bindings.com/docs/publishing/

#### Comments (3)

<details>
<summary><strong>bergundy</strong> commented on 2021-04-08 06:36:58.000 UTC</summary>

See issue in isolated-vm repo: https://github.com/laverdet/isolated-vm/issues/201.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-04-08 07:51:43.000 UTC</summary>

Removed from alpha milestone, now that we're [precompiling rust](#58) it's not that big of an issue.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-06-28 23:15:26.000 UTC</summary>

Won't do, only system dependency to install the SDK is node-gyp which is quite common and simple to install.

</details>


---

<a id="1869"></a>

### #1869: Environment Configuration does not read the correct file path on macOS

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1869 |
| **State** | CLOSED |
| **Author** | pvsone (Peter Sullivan) |
| **Created** | 2026-01-04 20:30:22.000 UTC (4 days ago) |
| **Updated** | 2026-01-06 16:46:59.000 UTC |
| **Closed** | 2026-01-06 16:46:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Run a worker application on macOS and load the default Environment Configuration toml file

### Describe the bug

Per [the documentation](https://docs.temporal.io/develop/environment-configuration), the SDKs should read the toml config file on a mac from $HOME/Library/Application Support/temporal/temporal.toml. However this path is not being read

### Minimal Reproduction

Create a Profile TOML file on a Mac using the CLI, which writes a file to: $HOME/Library/Application Support/temporal/temporal.toml
Create a Typescript program that attempts to read the Profile using the Env Config APIs. An error will be thrown that the profile cannot be found

### Environment/Versions

- OS and processor: macOS
- Temporal Typescript SDK Version: 1.14.0


#### Comments (2)

<details>
<summary><strong>THardy98</strong> commented on 2026-01-05 15:19:08.000 UTC</summary>

Hi @pvsone 

This is a typo in the docs, the path should be `temporalio/temporal.toml` not `temporal/temporal.toml`

</details>

<details>
<summary><strong>pvsone</strong> commented on 2026-01-05 15:39:45.000 UTC</summary>

Good catch.  I do have a toml file (created by the CLI) at the `$HOME/Library/Application Support/temporalio/temporal.toml` path, however it is still not being read by the typescript sdk

</details>


---

<a id="1859"></a>

### #1859: [Bug] High CPU usage with OTel instrumentation when updating to v1.13.x

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1859 |
| **State** | OPEN |
| **Author** | daniellockyer (Daniel Lockyer) |
| **Created** | 2025-12-08 10:39:51.000 UTC (1 months ago) |
| **Updated** | 2025-12-10 09:38:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Hi! üëãüèª 

We have a project using the Temporal TS SDK, and previously the code was running `v1.11.8` of all Temporal packages. We had OTel instrumentation enabled (and working!) via the `@temporalio/interceptors-opentelemetry` package.

Upon updating from v1.11.8 to v1.13.2, we started to see excessive CPU usage, sometimes up to 100%.

We have a different project that we bumped to v1.13.2 and didn't see excess CPU usage. The only key difference between these projects is that one has OTel enabled, and the other doesn't.

Removing all uses of `@temporalio/interceptors-opentelemetry` resolves the CPU issue, and it's back down to the level we were previously at. This implies to me what it's either a bug in `@temporalio/interceptors-opentelemetry`, or a bug in our implementation/use of it.

I did a CPU profile via node inspector on one of the production instances, and couldn't see anything in the trace. I don't know if this means it's in one of the native dependencies, or V8 contexts or what.

I looked at most commits between the two releases. There are some referencing OTel, but none that I'd expect to bump CPU usage up to 100%. I do not see any Temporal SDK errors in our logs.

Obviously, we'd like to keep instrumentation, so it'd be great to find the cause of this.

### Describe the bug

<img width="1006" height="382" alt="Image" src="https://github.com/user-attachments/assets/cb0650af-88fb-4cff-b55a-eef16553480f" />

We updated the packages on the 26th (the rise) and disabled OTel on the 2nd (the drop).

### Minimal Reproduction

I'm currently unable to find a minimal reproduction, but here is the diff I have that would re-enable OTel instrumentation on our worker, and thus re-introduce the CPU increase. (I've had to trim out our code around it)

```
diff --git a/xxx/index.ts b/xxx/index.ts
index 326f62c921..bdd1a99893 100644
--- a/xxx/index.ts
+++ b/xxx/index.ts
@@ -1,4 +1,9 @@
 import path from 'path';
+import {
+  makeWorkflowExporter,
+  OpenTelemetryActivityInboundInterceptor,
+  OpenTelemetryActivityOutboundInterceptor,
+} from '@temporalio/interceptors-opentelemetry/lib/worker';
 import {
   NativeConnection,
   NativeConnectionOptions,
@@ -12,7 +17,7 @@ import { env } from '@/lib/env';
...
-import { otelSdk } from './lib/instrumentation';
+import { otelSdk, resource, traceExporter } from './lib/instrumentation';
 
 const getConnection = async (): Promise<NativeConnection> => {
   const connectionOptions: NativeConnectionOptions = {
@@ -76,6 +81,9 @@ const getWorker = async (connection: NativeConnection): Promise<Worker> => {
...
+    sinks: {
+      exporter: makeWorkflowExporter(traceExporter, resource),
+    },
   };
   if (env.NODE_ENV !== 'development') {
     options.workflowBundle = {
@@ -93,6 +101,15 @@ const getWorker = async (connection: NativeConnection): Promise<Worker> => {
         return config;
       },
     };
+    options.interceptors = {
+      workflowModules: [require.resolve('./workflows')],
+      activity: [
+        (ctx) => ({
+          inbound: new OpenTelemetryActivityInboundInterceptor(ctx),
+          outbound: new OpenTelemetryActivityOutboundInterceptor(ctx),
+        }),
+      ],
+    };
   }
   return Worker.create(options);
 };
diff --git a/xxx/build-workflow-bundle.ts b/xxx/build-workflow-bundle.ts
index 212e8113b2..2a53bf8c1a 100644
--- a/xxx/build-workflow-bundle.ts
+++ b/xxx/build-workflow-bundle.ts
@@ -6,6 +6,7 @@ import { bundleWorkflowCode } from '@temporalio/worker';
 async function bundle() {
   const { code } = await bundleWorkflowCode({
     workflowsPath: require.resolve('../workflows'),
+    workflowInterceptorModules: [require.resolve('../workflows/flow.ts')],
     webpackConfigHook: (config) => {
       config.resolve = config.resolve || {};
       config.resolve.alias = {

diff --git a/xxx/flow.ts b/xxx/flow.ts
index bb17ceb9db..fd366e2d88 100644
--- a/xxx/flow.ts
+++ b/xxx/flow.ts
@@ -1,4 +1,9 @@
...
+import {
+  OpenTelemetryInboundInterceptor,
+  OpenTelemetryInternalsInterceptor,
+  OpenTelemetryOutboundInterceptor,
+} from '@temporalio/interceptors-opentelemetry/lib/workflow';
 import * as workflow from '@temporalio/workflow';
 
@@ -40,6 +45,12 @@ ...
...
 
+export const interceptors: workflow.WorkflowInterceptorsFactory = () => ({
+  inbound: [new OpenTelemetryInboundInterceptor()],
+  outbound: [new OpenTelemetryOutboundInterceptor()],
+  internals: [new OpenTelemetryInternalsInterceptor()],
+});
+
...
```

### Environment/Versions

- OS and processor: Linux
- Temporal Version: v1.13.2
- We're using the Temporal TS/JS packages for the projects, but also Temporal cloud


#### Comments (2)

<details>
<summary><strong>mnahkies</strong> commented on 2025-12-10 09:16:52.000 UTC</summary>

I submitted a (as yet unreleased) patch in https://github.com/temporalio/sdk-typescript/pull/1834#issuecomment-3595493095 that solved similar problems for us.

We're running with this patch applied to our workloads using SDK `1.13.1` and seeing good results. **However** with the same patch against `1.13.2` we see performance regression, which I'm yet to understand.

</details>

<details>
<summary><strong>mnahkies</strong> commented on 2025-12-10 09:38:08.000 UTC</summary>

Also note: You could try turning off [reusev8context](https://typescript.temporal.io/api/interfaces/worker.CompiledWorkerOptions#reusev8context) - my patch is only needed when this is enabled, as the [alternative VM](https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/workflow/workflow-worker-thread.ts#L33-L48) does not have the same bug.

(though interestingly your previous SDK version already defaulted `reusev8context` to `true`, so unclear to me why you weren't already seeing issues prior to upgrading)

I've opened an issue specifically for issues I'm seeing between `1.13.1` -> `1.13.2` here: https://github.com/temporalio/sdk-typescript/issues/1860

</details>


---

<a id="1796"></a>

### #1796: [Bug] Changes in type inference of activity return type in SDK 1.12.2

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1796 |
| **State** | OPEN |
| **Author** | rd-akind (Richard Danninger) |
| **Created** | 2025-10-08 07:29:37.000 UTC (3 months ago) |
| **Updated** | 2025-10-08 07:29:37.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

Call an activity from a workflow, through `proxyActivities`, and use TypeScript's type inference to determine the activity return type.

### Describe the bug

When using TypeScript SDK 1.12.1, calling an activity and storing its return value in a variable always successfully compiles.

In TypeScript SDK 1.12.2 and above, some instances of code that previously successfully compiled, now emits the error:

```
error TS7022: '...' implicitly has type 'any' because it does not have a type annotation and is referenced directly or indirectly in its own initializer.
```

### Minimal Reproduction

An example repo with nonsensical code but minimal TypeScript configuration can be found here: https://github.com/akindgroup/temporal-repro-1657

One of the circumstances where TypeScript is not able to infer the type correctly when upgrading past TypeScript SDK 1.12.2:

```typescript
// activities.ts
export const sampleActivity = async (input: { pointer: number }) => {
  return { pointer: 7 }
}

// workflow.ts
import { proxyActivities } from "@temporalio/workflow";
import type * as activities from "./activities.js";

const { sampleActivity } = proxyActivities<typeof activities>({})

export const workflow = async () => {
  let pointer: null | number = 0

  do {
    const result = await sampleActivity({ pointer })
    pointer = result.pointer
  } while (pointer !== null)
}
```

This issue might be caused by changes to the typing of the `proxyActivites` function introduced in https://github.com/temporalio/sdk-typescript/pull/1657

```typescript
// Before PR 1657
export type ActivityInterfaceFor<T> = {
  [K in keyof T]: T[K] extends ActivityFunction ? T[K] : typeof NotAnActivityMethod;
};

// After PR 1657
export type ActivityInterfaceFor<T> = {
  [K in keyof T]: T[K] extends ActivityFunction ? ActivityFunctionWithOptions<T[K]> : typeof NotAnActivityMethod;
};
```

### Environment/Versions

- Temporal Version: SDK version 1.12.2+

### Workaround

The simplest workaround is to explicitly type the variable storing the return value, e.g:

```typescript
const result: { pointer: number } = await sampleActivity({ pointer })
```

Another is to rearrange the code, which works well in some cases:

```typescript
let { pointer } = await sampleActivity({ pointer: 0 })

while (pointer !== null) {
  const result = await sampleActivity({ pointer })
  pointer = result.pointer
}
```


---

<a id="1787"></a>

### #1787: [Feature Request] Allow querying the port/address via TestWorkflowEnvironment

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1787 |
| **State** | CLOSED |
| **Author** | hanikesn (Steffen Hanikel) |
| **Created** | 2025-09-19 10:40:11.000 UTC (3 months ago) |
| **Updated** | 2025-11-03 16:59:26.000 UTC |
| **Closed** | 2025-11-03 16:59:26.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

We're currently spawning a global TestWorkflowEnvironment for our integration tests. As we can't pass the connection/nativeConnection directly onwards we have to pass the address to the application itself. Unfortunately it's not possible to query the actual address string including the port, when spawning the TestWorkflowEnvironment via [createLocal](https://typescript.temporal.io/api/classes/testing.TestWorkflowEnvironment#createlocal) when using a [random free port](https://typescript.temporal.io/api/interfaces/testing.DevServerConfig#port).

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

### Describe the solution you'd like

Allow querying the port/address so it's possible to use a random free port when creating clients manually.
<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Workaround
```typescript
const env = await TestWorkflowEnvironment.createLocal()
const address = native.ephemeralServerGetTarget(env["server"])
``` 



---

<a id="1744"></a>

### #1744: [Bug] NDE replaying nested promises

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1744 |
| **State** | OPEN |
| **Author** | antmendoza (Antonio Mendoza P√©rez) |
| **Created** | 2025-07-15 09:51:57.000 UTC (5 months ago) |
| **Updated** | 2025-07-15 09:52:02.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 ‚ù§Ô∏è 2 |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

### Describe the bug


The following code throws an NDE during replay 



```


    await Promise.all(
        [1, 3].map(async (offset) => {
            await Promise.all(
                ["a", "b", "c", "d", "e"].map(async (c) => {

                    console.log(`sleepRandomLocal start ${offset} ${c}`);


                    printActivities();
                    //schedule local activity
                    await sleepRandomLocal(1, 100, `${offset} ${c}`);
                    

                    console.log(`sleepRandom start ${offset} ${c}`);
                    printActivities();
                    //schedule activity
                    await sleepRandom(offset * 1000, offset * 1000, `${offset} ${c}`);
                })
            );

            console.log(`greet start ${offset}`);
            printActivities();
            //schedule activity
            await greet(offset.toString());
        })
    );


    printActivities();

    // Throw an error to force replay
    throw new Error("Something went wrong");

```


```
2025-07-15T08:54:54.526968Z  WARN temporal_sdk_core::worker::workflow: Failing workflow task run_id=01980d4b-3cd8-7271-abfb-0c98f28d3e91 failure=Failure { failure: Some(Failure { message: "[TMPRL1100] Nondeterminism error: No command scheduled for event HistoryEvent(id: 38, ActivityTaskScheduled)", source: "", stack_trace: "", encoded_attributes: None, cause: None, failure_info: 
Some(ApplicationFailureInfo(ApplicationFailureInfo { r#type: "", non_retryable: false, details: None, next_retry_delay: None, category: Unspecified })) }), force_cause: NonDeterministicError }

```

I added a log to the interceptor and activities seems to be scheduled in the same order (considering only activity type) 

**Runtime**

`sleepRandomLocal-1 a, sleepRandomLocal-1 b, sleepRandomLocal-1 c, sleepRandomLocal-1 d, sleepRandomLocal-1 e, sleepRandomLocal-3 a, sleepRandomLocal-3 b, sleepRandomLocal-3 c, sleepRandomLocal-3 d, sleepRandomLocal-3 e, sleepRandom-1 c, sleepRandom-1 a, sleepRandom-3 e, sleepRandom-3 d, sleepRandom-1 b, sleepRandom-3 a, sleepRandom-1 e, sleepRandom-3 c, sleepRandom-3 b, sleepRandom-1 d, greet-undefined, greet-undefined`

**Replay**

`sleepRandomLocal-1 a, sleepRandomLocal-1 b, sleepRandomLocal-1 c, sleepRandomLocal-1 d, sleepRandomLocal-1 e, sleepRandomLocal-3 a, sleepRandomLocal-3 b, sleepRandomLocal-3 c, sleepRandomLocal-3 d, sleepRandomLocal-3 e, sleepRandom-1 a, sleepRandom-1 b, sleepRandom-1 c, sleepRandom-1 d, sleepRandom-1 e, sleepRandom-3 a, sleepRandom-3 b, sleepRandom-3 c, sleepRandom-3 d`




### Minimal Reproduction

here is the code shared by the customer to reproduce the issue: 

[Archive.zip](https://github.com/user-attachments/files/21229315/Archive.zip)


### Environment/Versions

version 1.12.1



---

<a id="1736"></a>

### #1736: [Feature Request] Mask/sanitize client sensitive data references

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1736 |
| **State** | OPEN |
| **Author** | ssukienn (Szymon Sukiennik) |
| **Created** | 2025-07-01 15:11:48.000 UTC (6 months ago) |
| **Updated** | 2025-07-01 15:11:48.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

**Security Risk**: When a `handle` object is accidentally passed to serialization layers (e.g., JSON.stringify, logging frameworks, or HTTP responses), it exposes the internal `client` reference which contains:
- Unmasked API keys
- Authentication credentials
- Other sensitive configuration data

There might be more objects with references to the client or other objects with sensitive fields.

This creates a critical security vulnerability where sensitive information can be leaked through:
- Application logs
- HTTP response bodies
- Error messages
- Debug outputs

While `handle` objects are not intended to be serialized or returned in responses, human errors are inevitable, and this risk could be mitigated at the SDK level.

**Example scenario:**
```javascript
// Accidental exposure risk
app.get('/status', (req, res) => {
 res.json({ 
   workflowStatus: 'running',
   handle: workflowHandle // ops, this could expose API keys if serialized with something like superjson
 });
});
```

### Describe the solution you'd like

1. **Implement custom serialization behavior** for objects containing sensitive data:
  - Override `toJSON()` methods to exclude or mask sensitive fields
  - Add serialization guards that prevent accidental exposure

2. **Redesign the data model** for sensitive information:
  - Consider using structures that prevent the serialization of its content

3. **Handle advanced serialization libraries**:
  - Account for libraries like `superjson` that to some extent bypass standard JS serialization
  - Implement deeper protection mechanisms that work across different serialization methods

### Additional context

**Current behavior problems:**

**Version**: @temporalio/client - 1.11.2




---

<a id="1733"></a>

### #1733: [Bug] `RetryPolicy.maximumAttempt === 0` throws, while it is documented as a valid value for "unlimited"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1733 |
| **State** | OPEN |
| **Author** | jsamr (Jules Sam. Randolph) |
| **Created** | 2025-06-27 13:26:53.000 UTC (6 months ago) |
| **Updated** | 2025-07-01 11:17:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Setting retry policy to "unlimited". 

### Describe the bug

In a workflow, call `proxyActivities` with the below retry policy object:
```ts
const retryPolicy = {
  maximumAttempts: 0
}
```

### Minimal Reproduction

Not needed. The code below is at odds with the documentation:

https://github.com/temporalio/sdk-typescript/blob/9b3ec220416a80f5ad222c7f27817ee0405f1716/packages/common/src/retry-policy.ts#L53-L63

It throws when `maximumAttempts` is 0.

[The documentation states the following](https://docs.temporal.io/encyclopedia/retry-policies#maximum-attempts):

> Setting the [Maximum Attempts] value to 0 also means unlimited.


### Environment/Versions

Not needed.

### Additional context

The workaround is to set the value to `Number.POSITIVE_INFINITY` or `undefined`. 


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-30 20:56:41.000 UTC</summary>

Thanks for pointing this out. It indeed looks like the code and docs are contradicting each others.

That specific doc is not TS specific, so the error probably resulted from incorrect generalization of doc originally written for another SDK. I'll have to double-check what we do in other SDKs, and from there, we'll decide internally if we should either align all SDKs on the docs, or to fix the docs.

In any case, I'd strongly recommend using `undefined` or `Number.POSITIVE_INFINITY`. Both better express the meaning of "no limit to the number of attempts" than giving a special meaning to the value `0`.

</details>

<details>
<summary><strong>jsamr</strong> commented on 2025-07-01 11:17:02.000 UTC</summary>

> In any case, I'd strongly recommend using `undefined` or `Number.POSITIVE_INFINITY`. Both better express the meaning of "no limit to the number of attempts" than giving a special meaning to the value `0`.

I totally agree! We have an internal temporal SDK wrapper where we use the `"unlimited"` string literal to mean unlimited. But we need to map these wrapper types to vanilla temporal types at some point, and since we needed JSON-serializable values, we opted for `0` in this case. Replaced with `undefined` and it works fine! 


</details>


---

<a id="1700"></a>

### #1700: [Feature Request] executeChild to use passed headers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1700 |
| **State** | OPEN |
| **Author** | notusertelken (Manuel H.) |
| **Created** | 2025-04-30 02:47:40.000 UTC (8 months ago) |
| **Updated** | 2025-04-30 02:47:40.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.
we use headers to propagate context to workflows and activities using interceptors. We start some workflows via code client and others via other workflows using executeChild. For the latter, we cant pass headers as 
https://github.com/temporalio/sdk-typescript/blob/main/packages/workflow/src/workflow.ts#L844 just sets them to `{}`. We need to pass headers in order for our workflow started workflows to also have the same context as our code client started workflows.

### Describe the solution you'd like
executeChild to take headers in the `opts` argument
https://github.com/temporalio/sdk-typescript/blob/main/packages/workflow/src/workflow.ts#L844

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1695"></a>

### #1695: [Feature Request] Ability to record markers from workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1695 |
| **State** | CLOSED |
| **Author** | Inviz (Yaroslaff Fedin) |
| **Created** | 2025-04-24 11:37:53.000 UTC (8 months ago) |
| **Updated** | 2025-04-29 17:49:13.000 UTC |
| **Closed** | 2025-04-29 17:49:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

I'd like to be able to record markers from workflow. This is so i can later read them from history later. There's RecordMarker command, but no way to invoke it. I want to use it to side-channel some things from workflow, without causing activation. 

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-04-24 21:07:30.000 UTC</summary>

Hey @Inviz!

Can you please provide more details on your specific use case? What information you would like to channel out of workflows? From where would you want to consume that information? Would these be security sensitive? How large? How often? Why exactly do you want to avoid workflow activations? etc.

There may already be appropriate methods to expose the information you need, without the need for new features. Depending on your use case, you may want to look for Memo, Search Attributes, User Data, Local Activity, Updates, and more. With some details, I can guide you in the right direction. Or if there's a need for something that really can't be done today, let's clarify what that is.

As for Markers ‚Äî I think the name might be a bit deceptive ‚Äî they are a low level primitive meant to support the construction of higher level features by the SDKs themselves, without requiring server side logic. Despite their apparent simplicity, Markers really involve complex replay logic, that is _distinct for every single type of marker_. This is particularly true in the case of Core-based SDKs, as the state machines that handle "workflow task to activation" conversion and "command-to-history reconciliation" are internal to the Core SDK. That means that from the lang SDK's perspective (i.e. in Workflow Activations), there are "patch" and "local activities" commands/events, but there are no "markers".

In short though we're likely to introduce new features in the future based on Markers, Markers themselves are not meant for direct usage, and a general "Record a Marker" API is simply not on the road map.

</details>

<details>
<summary><strong>Inviz</strong> commented on 2025-04-25 01:11:23.000 UTC</summary>

My use case is unorthodox. Please dont freak out :)

I am building a framework that combines databases and temporal tightly. I'm using temporal as a way to create lifecycle scripts for "rows" in database. So that creating new row in table creates a lifecycle workflow, and then workflow advancements updates that table in return. I'm making some sort of a framework, where temporal acts as a flexible "scenario". Something akin to SQL triggers, but async and on steroids. 

 i'm lisetning to temporal events as they arrive into the database, and immedaitely interpreting them to side-channel the information to other table(s). This is done inside trigger over `history_node` table.

So i.e. i'm turning state of the workflow, its input and output, and some other things into well presented db table. So that i can work with that able outside of temporal and use it as a source of truth for outside system, as it essentially works within same PG transaction as temporal itself. I use it in place of visibility api. So it allows workflows (and other parts of the system) to query each other's state without delay.  This way workflows able to do introspection via activity for low-stakes scenarios (what are my running children, and what are they doing)

So far so good, however i also want workflows to be able to also make their intermediate state (essentially local varibles) to be visible to outside. Because i'm lisetning to event log, i need an event that can store that state, that i can later interprete or side channel.  I could use signalling, but that causes workflow activations needlessly.  Marker seems ideal, as it is a part of event history,  subject to replay, ignored by the system, doesnt make visibility api heavier. 

Reason to avoid activations is - i dont want for state to become visible to outside world ASAP. I dont want to replay workflow without a great reason.

Thank you for good list of questions:

> What information you would like to channel out of workflows? 

Essentially, local variables and stats sets currently. But i'm looking for a cheap mechanism to do even more. This state needs to be visible progressively, during execution of long workflows. 

> From where would you want to consume that information? 

Directly in SQL trigger that works event log, later from dedicated tables (i.e. `workflows { type, id, output, input, locals }`) 

> Would these be security sensitive? 

Great question - i'd think they could be encoded with the same codec mechanism. But right now i'm not using codecs, which allows me to keep everything inside SQL 

> How large? 

Local variables: 0-10kb total, essentially i want local variables to be turned into SQL table columns
Stats: 0-100kb, these are some KPI metrics that are computed during workflow runtime, which i want to be able to surface immediately as they are computed before workflow is complete. 

> How often? 

On every activation if it changes any local state

> Why exactly do you want to avoid workflow activations? etc.

Because i want workflow to be able to log things into event log, without causing round-trip re-evaluation of code. I dont want replay to happen, and i dont want workflow to make itself slower.

Why current mechanisms dont do it for me:

> Memo

Memo seems to be very close to what i want, but it's seen in visibility api and such. Maybe that's alright. I initially discounted it, before your suggestion. But after i tried, it seems that it matches the closest what I wanted to do. The downsides is: Merging is shallow, so either i take over whole memo with my properties as fields (which is acceptable), or if i use like `memo.state` proeprty, i'd need to overwrite it each time. 

So far this is what i decided to go with. Thank you.

> Search Attributes

I dont need visibility api to see it, and i dont want to make indexing/filtering slower because of large amount of data

> User Data

You mean inputs? It needs to be work with long living workflows. 

> Local Activity

This can work, actually, but it still goes through queueing and has needless roundtrips between workflow and worker.

> Updates

Updates are quite heavy mechanism, do a lot of work (your docs about it say it all).

> and more

 Signal is simplier, but also causes activation of workflow. Not sure what are other options.

> As for Markers ‚Äî I think the name might be a bit deceptive ‚Äî they are a low level primitive meant to support the construction of higher level features by the SDKs themselves, without requiring server side logic. 

I think that's about what i want to do too. Create new sdk feature, without requiring server side logic.

> Despite their apparent simplicity, Markers really involve complex replay logic, that is distinct for every single type of marker. This is particularly true in the case of Core-based SDKs, as the state machines that handle "workflow task to activation" conversion and "command-to-history reconciliation" are internal to the Core SDK. 

I did notice it has a hodge-podge of attributes and use cases. A bit of escape hatch. However as long as i can correlated it to some workflow (via tree_id being run_id), and i can name it (via markerName), and have data payload - i'm good

> In short though we're likely to introduce new features in the future based on Markers

Sure, i dont insist on marker being the thing. I just thought it'd make it easy to expose it. It could be `recordEvent(type, data)` feature that uses marker. But that would probably not happen too quickly. You guys have a huge surface area of apis and languages, i understand the hesitation of changing or adding things.


So far I tried to use pushCommand feature of activator (wich i can read on globalThis.__TEMPORAL_ACTIVATOR__) to record marker myself. The issue there was that it has some stricter validation for markers, was getting "at least one command has empty variant" error).

### Summary

So thanks to your suggestion, i'll go with upsertMemo. I'll structure my memo data so that i export my local variables on top level of the object, so i can update just one instead of whole object.

</details>


---

<a id="1693"></a>

### #1693: [typescript] SDK support for activity reset

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1693 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2025-04-23 19:08:06.000 UTC (8 months ago) |
| **Updated** | 2025-09-03 00:20:30.000 UTC |
| **Closed** | 2025-09-03 00:20:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/features/issues/620

#### Comments (2)

<details>
<summary><strong>jdunck</strong> commented on 2025-05-12 20:36:31.000 UTC</summary>

Hey @drewhoskins-temporal - we have this problem at [Finch](https://github.com/Finch-API).  Let me know how we can be helpful in setting requirements or testing pilot support.  

</details>

<details>
<summary><strong>THardy98</strong> commented on 2025-06-19 11:54:38.000 UTC</summary>

Hey @jdunck , PR is up but blocked on another PR waiting to merge as well as a server release. I can ping you here once this is merged if you like

Reactions: üëç 1

</details>


---

<a id="1682"></a>

### #1682: [Feature Request] Allow cancel polling of `client.result()` (via timeout / AbortSignal) to stop leak

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1682 |
| **State** | CLOSED |
| **Author** | alex-statsig (Alex Coleman) |
| **Created** | 2025-04-18 19:05:14.000 UTC (8 months ago) |
| **Updated** | 2025-05-15 22:32:23.000 UTC |
| **Closed** | 2025-05-15 05:40:31.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Currently if you create a run and want to observe the result, the most straightforward approach is to call `await handle.result()` which uses `await client.result(...)`. Sometimes you may want to attempt to get the result but not wait forever for the run to finish (the run may have a large timeout, and you just want to attempt to wait for it briefly). However, the current implementation of `handle.result()` / `client.result()` provides no mechanism to cancel the awaiting. The function seems to trigger an infinite loop [here](https://github.com/temporalio/sdk-typescript/blob/0097ccf14fb754ba5e1197d5dbc4ff48d80c1cba/packages/client/src/workflow-client.ts#L785), which will continue polling until the job is completed. This is a leak that can't be cleaned up by the caller (and likely the caller's scope will leak in any promise handlers, even with use of something like `Promise.race`).

### Describe the solution you'd like

The `result()` functions should accept an `AbortSignal` (or a timeout, but `AbortSignal` is maybe a better generalization) to allow for cancellation of the polling. Then the caller may do something like `await handle.result({signal: AbortSignal.timeout(10000)})` to wait up to 10s for the job completion (even if the job has a much longer timeout like 1 hour)

### Additional context
I believe a manual polling of the run status could work around this, but the `.result()` function provides much more convenience around following dependent runs. I think it would be valuable and fairly straightforward to just build this support in natively.

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-15 05:40:31.000 UTC</summary>

This is already possible!

You can apply a timeout or an abort signal over _any_ client request (including raw gRPC requests) by using the `client.withTimeout(...)` and `client.withAbortSignal(...)` methods.

</details>

<details>
<summary><strong>alex-statsig</strong> commented on 2025-05-15 22:32:21.000 UTC</summary>

Thanks so much for sharing this @mjameswh, this is exactly what I was looking for! I was on an old version and failed to find this in my issues search

Reactions: üëç 1

</details>


---

<a id="1678"></a>

### #1678: [Feature Request] Add missing hooks on OTel interceptors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1678 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-04-15 15:40:17.000 UTC (8 months ago) |
| **Updated** | 2025-12-03 21:00:24.000 UTC |
| **Closed** | 2025-12-03 21:00:24.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Description

The OTel interceptor currently does not support tracing propagation on inbound update requests. We need to implement it.

We should also review the interceptor for any other missing hooks.


---

<a id="1677"></a>

### #1677: [Bug] Upgrading OTel Interceptor to 1.11.5+ breaks signal-with-start and may cause NDE

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1677 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-04-15 15:37:28.000 UTC (8 months ago) |
| **Updated** | 2025-11-10 18:45:15.000 UTC |
| **Closed** | 2025-11-10 18:45:15.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 üöÄ 3 |

#### Description

### Describe the bug

Assuming a workflow is launched with `signalWithStart`, the following workflow code in TS SDK 1.11.3 or earlier would result in sequence A-B-C. Same in later releases if not using the OTel workflow interceptor. However, in 1.11.5+ with OTel, we‚Äôd get A-C-B (i.e. equivalent of signal coming in a later WFT).

```
export async function myWorkflow(name: string): Promise<void> {
  log('A');
  setHandler(defineSignal('mySignal'), async () => {
    log('B');
  });
  log('C');
}
```

This change is due to addition of tracing propagation on inbound signals in 1.11.5 (#1449). Order of promise completion on outbound `scheduleLocalActivity` has similarly been modified in 1.11.6 (#1577). Both of these changes may result in Non-Determinism errors when older workflows are replayed on newer release of the SDK with the OTel interceptor installed. 

For context, the changes mentioned previously added a certain number of `await` statements to the corresponding code paths, so the actual code is now executed as a microtask rather than synchronously, hence the change in execution order. As a general rule, interceptors provided by the SDK itself should as much as possible avoid adding yield points. We should also document this risk on the Workflow Interceptor types, as user-implemented interceptors may face similar issues.


---

<a id="1675"></a>

### #1675: [Feature Request] support AggregateError

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1675 |
| **State** | OPEN |
| **Author** | safareli (Irakli Safareli) |
| **Created** | 2025-04-10 18:10:34.000 UTC (9 months ago) |
| **Updated** | 2025-04-10 18:10:34.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

In node.js as well as in web browsers one can declare errors like:

```js
new AggregateError(
  [
    new Error("test error 1"),
    new Error("test error 2", { cause: new Error("test error 3") }),
    new Error("test error 4"),
  ],
  "test error"
);
```

this is what that error looks like if you console.log it in node

```js
Welcome to Node.js v20.11.1.
Type ".help" for more information.
> console.log(new AggregateError([ new Error("test error 1"), new Error("test error 2", { cause: new Error("test error 3") }), new Error("test error 4") ], "test error"))
AggregateError: test error
    at REPL1:1:5
    at ContextifyScript.runInThisContext (node:vm:121:12)
    at REPLServer.defaultEval (node:repl:599:22)
    at bound (node:domain:432:15)
    at REPLServer.runBound [as eval] (node:domain:443:12)
    at REPLServer.onLine (node:repl:929:10)
    at REPLServer.emit (node:events:530:35)
    at REPLServer.emit (node:domain:488:12)
    at [_onLine] [as _onLine] (node:internal/readline/interface:416:12)
    at [_line] [as _line] (node:internal/readline/interface:887:18) {
  [errors]: [
    Error: test error 1
        at REPL1:1:31
        at ContextifyScript.runInThisContext (node:vm:121:12)
        at REPLServer.defaultEval (node:repl:599:22)
        at bound (node:domain:432:15)
        at REPLServer.runBound [as eval] (node:domain:443:12)
        at REPLServer.onLine (node:repl:929:10)
        at REPLServer.emit (node:events:530:35)
        at REPLServer.emit (node:domain:488:12)
        at [_onLine] [as _onLine] (node:internal/readline/interface:416:12)
        at [_line] [as _line] (node:internal/readline/interface:887:18),
    Error: test error 2
        at REPL1:1:61
        at ContextifyScript.runInThisContext (node:vm:121:12)
        ... 7 lines matching cause stack trace ...
        at [_line] [as _line] (node:internal/readline/interface:887:18) {
      [cause]: Error: test error 3
          at REPL1:1:96
          at ContextifyScript.runInThisContext (node:vm:121:12)
          at REPLServer.defaultEval (node:repl:599:22)
          at bound (node:domain:432:15)
          at REPLServer.runBound [as eval] (node:domain:443:12)
          at REPLServer.onLine (node:repl:929:10)
          at REPLServer.emit (node:events:530:35)
          at REPLServer.emit (node:domain:488:12)
          at [_onLine] [as _onLine] (node:internal/readline/interface:416:12)
          at [_line] [as _line] (node:internal/readline/interface:887:18)
    },
    Error: test error 4
        at REPL1:1:129
        at ContextifyScript.runInThisContext (node:vm:121:12)
        at REPLServer.defaultEval (node:repl:599:22)
        at bound (node:domain:432:15)
        at REPLServer.runBound [as eval] (node:domain:443:12)
        at REPLServer.onLine (node:repl:929:10)
        at REPLServer.emit (node:events:530:35)
        at REPLServer.emit (node:domain:488:12)
        at [_onLine] [as _onLine] (node:internal/readline/interface:416:12)
        at [_line] [as _line] (node:internal/readline/interface:887:18)
  ]
}
```


### Describe the solution you'd like

Would be amazing if temporal extracted and stored child errors of the AggregateError, right now it supports only single child in cause.

or at least include stack traces of children in the stack trace of the top error using something like `require("util").inspect(exception, { showHidden: false, depth: null, colors: false })` (note the stack tracing fixing function that cuts off internal calls from trace should be adopted to not cut things off in this format)



---

<a id="1655"></a>

### #1655: Dependency Vulnerability: Zip library

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1655 |
| **State** | CLOSED |
| **Author** | jmiralles (Joan Miralles) |
| **Created** | 2025-03-18 08:54:50.000 UTC (9 months ago) |
| **Updated** | 2025-05-16 04:03:07.000 UTC |
| **Closed** | 2025-05-16 04:03:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Hi,

We were recently alerted that one of your Rust modules depends on the zip library, which contains a high-severity vulnerability:

Vulnerability Details:

Package: zip
CVE: [CVE-2025-29787](https://avd.aquasec.com/nvd/cve-2025-29787)
Severity: High
Fixed in Version: 2.3.0
Current Version Used: 2.2.2
Since this vulnerability has been addressed in zip version 2.3.0, we would greatly appreciate it if you could update the dependency at your earliest convenience.

Thank you for your time, and please let us know if you need any further details.

Best regards,
Sanity team

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-03-24 21:02:21.000 UTC</summary>

Thanks for reporting.

For what it's worth, I have very high confidence that this vulnerability does not represent an actual menace in the specific context of the Temporal TS SDK. I have included some details of my rationale below.

Nonetheless, we understand that the mere presence of such a dependency might trigger alerts by audit engines and therefore pose challenges to various compliance requirements. An update will therefore be included in the next patch release.

**Details**

- The Temporal SDK only uses the `zip` library to extract downloaded ephemeral server binaries (i.e. when using the `TestWorkflowEnvironment.createXxx()`, with `server.executable.type = 'cached-download'`). This API is only meant to be used in test environment.
- The Ephemeral Server archive file is always downloaded from a trusted source (i.e. an HTTP service under our control, using TLS). We only use ZIP archives for Windows binaries.
- The ZIP archive already contains an executable file.

Given the above facts, it appears that:

1. An attacker would need to exploit a much more significant vulnerability (e.g. at the DNS and/or TLS layer; by hacking our hosting service; etc) in order to compromise the downloaded ZIP archive.
2. An attacker that would be able to compromise the downloaded ZIP archive would anyway be able to simply replace the server's binary contained in that archive, without any further advantage resulting from CVE-2025-29787.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-16 04:03:06.000 UTC</summary>

This was fixed in 1.11.8.

</details>


---

<a id="1608"></a>

### #1608: Vulnerability GHSA-wwq9-3cpr-mm53 - hashbrown

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1608 |
| **State** | CLOSED |
| **Author** | moyara-allgood (Byeongung Ahn) |
| **Created** | 2025-01-21 00:31:20.000 UTC (11 months ago) |
| **Updated** | 2025-01-30 23:44:14.000 UTC |
| **Closed** | 2025-01-30 23:44:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Hi team, I received high vulnerability issue with one of the Cargo packages.

https://github.com/advisories/GHSA-wwq9-3cpr-mm53

@temporalio/core-bridge/Cargo.lock

![Image](https://github.com/user-attachments/assets/84270dfc-71db-455c-a15d-bc2b443ed31c)


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-21 17:26:34.000 UTC</summary>

Thanks for reporting. We will make a release updating Rust dependencies in the next few days.

Note that as far as I can see, this specific issue wouldn't represent a vulnerability in the context of Temporal's TS SDK, as 1) we never use object comparison in any security sensitive context (either using hashbrown or other) and 2) hashbrown is never used in a context where its input could controlled by an end user.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-30 23:44:13.000 UTC</summary>

1.11.7 has been released earlier today, including the updated `hashbrown` dependency.

</details>


---

<a id="1594"></a>

### #1594: [Bug] First schedule action started using triggerImmediately flag does not honor the schedule's overlap policy

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1594 |
| **State** | OPEN |
| **Author** | jhecking (Jan Hecking) |
| **Created** | 2025-01-08 03:19:11.000 UTC (1 years ago) |
| **Updated** | 2025-01-08 03:38:46.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### What are you really trying to do?

I'm creating a new schedule and I want to trigger it immediately. I don't want any overlapping schedule runs.

### Describe the bug

I'm creating a new schedule using a combination of `ScheduleOverlapPolicy.BUFFER_ONE` and `triggerImmediately: true`, i.e.

```typescript
export async function schedulePeriodicWorkflowExecution(
  action: ScheduleOptionsStartWorkflowAction<Workflow>,
  scheduleId: string,
  cronExpression: string,
) {
  const client = await getScheduleClient()
  const spec = { cronExpressions: [cronExpression] }
  return client.create({
    action,
    spec,
    scheduleId,
    policies: {
      overlap: ScheduleOverlapPolicy.BUFFER_ONE,
    },
    state: {
      triggerImmediately: true,
    },
  })
}
```

If the initial schedule run, started via `triggerImmediately: true` takes long enough that the next run gets triggered as per the provided cron schedule, that second schedule run does not get buffered but gets executed immediately.

I believe this is because the initial schedule run always gets executed with a default "AllowAll" overlap policy: https://github.com/temporalio/sdk-typescript/blob/4cf092d6e503603bc559d67c7ec8b3c0235a8cff/packages/client/src/schedule-client.ts#L246-L249

A possible work-around is to create the schedule and then immediately trigger it ourselves using the correct overlap policy, i.e.

```typescript
export async function schedulePeriodicWorkflowExecution(
  action: ScheduleOptionsStartWorkflowAction<Workflow>,
  scheduleId: string,
  cronExpression: string,
) {
  const client = await getScheduleClient()
  const spec = { cronExpressions: [cronExpression] }
  const handle = client.create({
    action,
    spec,
    scheduleId,
    policies: {
      overlap: ScheduleOverlapPolicy.BUFFER_ONE,
    },
  })
  await handle.trigger(ScheduleOverlapPolicy.BUFFER_ONE)
  return handle
}
```

But I think `triggerImmediately: true` should honor the schedule's overlap policy instead of defaulting to the "AllowAll" policy.

### Minimal Reproduction

https://github.com/jhecking/samples-typescript/tree/schedules-trigger-immediately-overlapping/schedules-trigger-immediately-overlapping

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- Temporal Version: 1.11.2

### Additional context

n/a


---

<a id="1584"></a>

### #1584: [Bug] mTLS NativeConnectionOptions tonic::transport::Error(Transport, NativeCertsNotFound)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1584 |
| **State** | CLOSED |
| **Author** | cawalch (Caleb Walch) |
| **Created** | 2024-12-11 16:34:06.000 UTC (1 years ago) |
| **Updated** | 2025-11-06 11:57:40.000 UTC |
| **Closed** | 2024-12-17 18:45:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Use mTLS within `NativeConnectionOptions` to connect to a cluster

### Describe the bug

Moving from 1.11.3 to 1.11.5 broke the `NativeConnectionOptions` / connect call with a TransportError

```
/app/node_modules/@temporalio/worker/lib/connection.js:58
                throw new core_bridge_1.TransportError(err.message);
                      ^
TransportError: tonic::transport::Error(Transport, NativeCertsNotFound)
    at NativeConnection.connect (/app/node_modules/@temporalio/worker/lib/connection.js:58:23)
```

Able to confirm it's an issue with 1.11.5 after reverting back to 1.11.3

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

**tlsConfig option**

```
connectionOptions.tls = {
      serverNameOverride: config.TEMPORAL_TLS_SERVER_NAME,
      serverRootCACertificate: fs.readFileSync(config.TEMPORAL_TLS_CA),
      clientCertPair: {
        crt: fs.readFileSync(config.TEMPORAL_TLS_CERT),
        key: fs.readFileSync(config.TEMPORAL_TLS_KEY),
      },
    }
```

### Environment/Versions

The application is built and deployed as a docker image

- Docker / `node:22.11.0-bookworm-slim`
- Hosting environment / Ubuntu 22

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-17 18:45:43.000 UTC</summary>

The docker image you use, `node:*-slim`, doesn't include root TLS CA certificates. You need to include them, as demonstrated [here](https://docs.temporal.io/develop/typescript/core-application#using-nodeslim-images).

The reason that was working until TS SDK 1.11.3 is that we were previously relying on `rustls`'s built-in CAs rather than the system-native ones, but that was incorrect. This was [fixed in v1.11.5](https://github.com/temporalio/sdk-core/pull/824), which means that the OS is now responsible for managing root CAs, as it should be.

Reactions: üëç 2

</details>

<details>
<summary><strong>dafanasiev</strong> commented on 2025-11-06 11:57:40.000 UTC</summary>

@mjameswh client must use CA from `serverRootCACertificate` as root-of-trust (when parameter set explicitly), not a system CA list.
I think that the current behavior of the client is a bug.

workaround for this issue:

```sh
# remove system CA list
rm -f /etc/ssl/certs/ca-certificates.crt

# use own CA
cp my-root-ca.pem /etc/ssl/certs/ca-certificates.crt
```

</details>


---

<a id="1580"></a>

### #1580: [Bug] Workflows getting stuck after cancellation (spurious WorkflowTaskFailed errors)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1580 |
| **State** | OPEN |
| **Author** | tetrakatech (Karla) |
| **Created** | 2024-12-04 04:58:26.000 UTC (1y 1m ago) |
| **Updated** | 2025-08-20 15:44:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We have workflows that are routinely cancelled by other (orchestrator) workflows. Usually this works perfectly, and allows our system to implement preemption in line with our business requirements.

Sporadically - a few times a day, out of at least thousands of workflows - the child workflow is failing to cancel correctly, and is instead stalling in a running state, leading to ~infinite retries and blocking of the orchestrator workflow.

### Describe the bug

Typically, when cancellation occurs we see a WorkflowTaskCompleted event in the Temporal UI, followed by a WorkflowExecutionCanceledEvent.

![image](https://github.com/user-attachments/assets/ae57764d-496a-46f9-a39f-6a9cc0e0fe6f)

In the buggy cases, we instead see two instances of WorkflowTaskFailed, with the call stack being a `CancelledFailure` inside the Temporal SDK, and the workflow left stuck in a Running state:
<img width="1697" alt="image" src="https://github.com/user-attachments/assets/71ed68b6-5dc3-4438-bd33-5fe25f3ecbcd">

Logs for a buggy case run ID:

```
2024-11-28 00:54:22.293 Workflow started
2024-11-28 00:54:22.351 Activity started
2024-11-28 00:54:23.030 Activity completed
2024-11-28 00:54:23.700 Workflow completed as cancelled
2024-11-28 00:54:23.700 Failing workflow task
2024-11-28 00:54:24.105 Workflow completed as cancelled
2024-11-28 00:54:24.108 Failing workflow task
2024-11-28 00:54:24.193 {"component":"matching-engine", "error":"Workflow task not found.", "level":"info", "logging-call-at":"matching_engine.go:613", "msg":"Workflow task not found", "queue-task-id":-137, "queue-task-visibility-timestamp":"2024-11-27T13:54:24.180Z", "ts":"2024-11-27T13:54:24.193Z", "wf-history-event-id":16, "wf-id":"9ee39789-3ca2-4fc3-af5c-8bd24a7bbe28-1-378bf7e7-bc20-4b26-b459-c9e7633aa5c6", "wf-namespace-id":"5e9a725c-d677-4281-8b07-9cd4097060bd", "wf-run-id":"dd593d4f-3f24-4177-b376-ba022ebb5d10", "wf-task-queue-name":"chatExecutor"}
2024-11-28 00:54:24.290999889 Workflow completed as cancelled
2024-11-28 00:54:34.270999908 Workflow completed as cancelled
2024-11-28 00:54:44.298000097 Workflow completed as cancelled
2024-11-28 00:54:59.002000093 Workflow completed as cancelled
2024-11-28 00:55:18.104000091 Workflow completed as cancelled
2024-11-28 00:55:46.848999977 Workflow completed as cancelled
2024-11-28 00:56:30.530999898 Workflow completed as cancelled
2024-11-28 00:57:55.980000019 Workflow completed as cancelled
2024-11-28 01:00:26.433630347 {"address":"10.20.12.44:7234", "attempt":10, "level":"warn", "logging-call-at":"workflow_task_state_machine.go:1061", "msg":"Critical attempts processing workflow task", "service":"history", "shard-id":130, "ts":"2024-11-27T14:00:26.433Z", "wf-id":"9ee39789-3ca2-4fc3-af5c-8bd24a7bbe28-1-378bf7e7-bc20-4b26-b459-c9e7633aa5c6", "wf-namespace":"default", "wf-run-id":"dd593d4f-3f24-4177-b376-ba022ebb5d10"}
2024-11-28 01:00:26.480000019 Workflow completed as cancelled
2024-11-28 01:05:07.210610845 {"address":"10.20.12.44:7234", "attempt":11, "level":"warn", "logging-call-at":"workflow_task_state_machine.go:1061", "msg":"Critical attempts processing workflow task", "service":"history", "shard-id":130, "ts":"2024-11-27T14:05:07.209Z", "wf-id":"9ee39789-3ca2-4fc3-af5c-8bd24a7bbe28-1-378bf7e7-bc20-4b26-b459-c9e7633aa5c6", "wf-namespace":"default", "wf-run-id":"dd593d4f-3f24-4177-b376-ba022ebb5d10"}
```

and then progressively more retries that are backed off.

### Minimal Reproduction

I've attached a (redacted) copy of the JSON events for one of the buggy cases. I'm hoping this is sufficient to repro, since the issue repeats on workflow re-attempts, and the example history is quite short (< 20 events).
[dd593d4f-3f24-4177-b376-ba022ebb5d10_events.json](https://github.com/user-attachments/files/18001967/dd593d4f-3f24-4177-b376-ba022ebb5d10_events.json)

The workflow implementation to hit this case is trivially simple:

```typescript
const { handleCustomerMessage } =
  proxyActivities<IHandleCustomerMessageActivity>({
  startToCloseTimeout: '1 minute',
  retry: {
    maximumAttempts: 3,
  },
  cancellationType: ActivityCancellationType.TRY_CANCEL,
})

export async function processChatTicket({
  data,
}: {
  data: ProcessTicketInput
}): Promise<ProcessTicketOutput> {
  try {
    const temporalWorkflowId = workflowInfo().workflowId

    const handleCustomerMessageOutput = await handleCustomerMessage({
      temporalWorkflowId,
      data,
    })

    // More logic below...
   } catch (error) {
    // If the error is just a cancellation, or a termination, just re-throw
    // immediately. The former is expected (e.g. a parent will cancel this
    // workflow if a new message is received; the latter is triggered manually
    // in the UI by a human in very limited circumstances)
    if (isCancellation(error) || error instanceof TerminatedFailure) {
      throw error
    }

    // Otherwise, kick off a "cleanup" workflow
    await startChild(cleanup, {
      // Other arguments
      parentClosePolicy: ParentClosePolicy.PARENT_CLOSE_POLICY_ABANDON,
    })

    throw error
  }
}
```

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Kubernetes running `node:lts-bookworm-slim` (workers)
- Temporal Version: Kubernetes running `temporalio/server:1.24.1` (server), Typescript SDK `1.11.3` (workers)
- Are you using Docker or Kubernetes or building Temporal from source? Kubernetes

### Additional context

Based on the log lines, it looks to me like something is getting confused between the Typescript and Core SDKs as to whether the cancellation error thrown represents a WorkflowTask failure or not.

Notably, the logs around the task cancellation in Typescript are run in both buggy/working cases: https://github.com/temporalio/sdk-typescript/blob/be37851670c5c43ae4dc2ea1929797fbbcbffc26/packages/workflow/src/logs.ts#L99

But the log around the workflow task failing is over here, https://github.com/temporalio/sdk-core/blob/4a2368d19f57e971ca9b2465f1dbeede7a861c34/core/src/worker/workflow/mod.rs#L423, and is only called in the buggy case.

With my limited knowledge of how this code works, is it possible that `this.cancelled` (https://github.com/temporalio/sdk-typescript/blob/main/packages/workflow/src/internals.ts#L945) isn't being set correctly in all cases, especially when an Activity runs and successfully completes in parallel with a ActivityTaskCancelRequested event being generated? If that were the case, the Typescript SDK would I think indicate a workflow failure on cancellation, rather than cancelling cleanly, but would still emit the logs we're seeing.

Happy to provide any other details if they'd be useful :)


#### Comments (2)

<details>
<summary><strong>tetrakatech</strong> commented on 2025-01-09 03:31:01.000 UTC</summary>

@mjameswh any chance you've had a chance to look at this? (tagging because you're the person who's been looking at other bugs filed around the same time)

I'm fine to be told that we need to work harder to get a repro case, but if you could validate whether the last event in [the attached JSON history file](https://github.com/user-attachments/files/18001967/dd593d4f-3f24-4177-b376-ba022ebb5d10_events.json) looks valid, that would be super helpful for me to at least know where to focus my efforts.

Is it correct that throwing a `CancelledFailure` error should lead to an event type of `EVENT_TYPE_WORKFLOW_TASK_FAILED`, rather than a pair of `EVENT_TYPE_WORKFLOW_TASK_COMPLETED` and `EVENT_TYPE_WORKFLOW_EXECUTION_CANCELED` events?

</details>

<details>
<summary><strong>bkanzariya-abstract</strong> commented on 2025-08-20 15:44:57.000 UTC</summary>

@tetrakatech Did you get any solution/workaround to this? we kind of having bit similar warn logs `Critical attempts processing workflow task`

</details>


---

<a id="1578"></a>

### #1578: [Bug] Worker fails to start if Node option --abort-on-uncaught-exception is set

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1578 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-12-02 19:19:16.000 UTC (1y 1m ago) |
| **Updated** | 2024-12-02 19:19:16.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the bug

Starting a Worker with Node option `--abort-on-uncaught-exception` results in the following error message:

```
Uncaught TypeError: Cannot read properties of undefined (reading './node_modules/@temporalio/workflow/lib/worker-interface.js')

FROM
__webpack_require__ (/srv/workflows.js:7523:55)
/srv/workflows.js:7591:13
/srv/workflows.js:7607:3
/srv/workflows.js:7610:12
Script.runInContext (node:vm:149:12)
parseWorkflowCode (/srv/node_modules/@temporalio/worker/lib/worker.js:1335:16)
Worker.getOrCreateBundle (/srv/node_modules/@temporalio/worker/lib/worker.js:331:24)
async Worker.create (/srv/node_modules/@temporalio/worker/lib/worker.js:139:24)
```


### How to reproduce

Start the Hello World sample's Worker with:

```
NODE_OPTIONS=--abort-on-uncaught-exception npm run start
```

### Details

The stack trace points out to the following code locations:

- https://github.com/mjameswh/sdk-typescript/blob/4dcc82aa48fc285119978bd2a93acc3a0e9fd231/packages/worker/src/worker.ts#L1791-L1798

- https://github.com/mjameswh/sdk-typescript/blob/4dcc82aa48fc285119978bd2a93acc3a0e9fd231/packages/worker/src/workflow/bundler.ts#L117

That is, while preloading the bundle code for the benefit of debuggers, the execution context isn't configured properly, so that `globalThis.__webpack_module_cache__` is undefined. That causes a type error while running the bundled code, which should presumably get caught by the try-catch block in worker.ts. However, the `abort-on-uncaught-exception` operates at V8's level (rather than Node's event loop level) and V8's is not aware of the cross-execution-context call involved by `script.runInContext()`, so it can't figure out that the error happening in the child context will get properly handled by the parent context, resulting in aborting execution.

Some quick fixes are possible, e.g. adding a `?? {}` suffix to the problematic line in bundler, but I'm afraid the problem may reappear at a later time as other global variables get added; we should therefore consider moving the preload to the VM.

More over, this preload somewhat expensive and only pertinent if there's an attached inspector, which is rarely the case. We should therefore make it conditional to the presence of a debugger.



---

<a id="1540"></a>

### #1540: Remove workflowsPath in favor or imports (like activities)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1540 |
| **State** | CLOSED |
| **Author** | marc-wilson (Marc) |
| **Created** | 2024-10-08 00:10:33.000 UTC (1y 3m ago) |
| **Updated** | 2024-11-06 00:19:32.000 UTC |
| **Closed** | 2024-11-06 00:19:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

We use an nx monorepo for our code base and we are trying to create our first workflows. Since most of our libraries/packages are written in Nestjs, we want our workers to be nestjs so that we can leverage them without having to re-write a bunch of dependencies.

However, since NestJs uses webpack by default, you end up with a single main.js file after build and your `workflowsPath` won't resolve.

### Describe the solution you'd like

Instead of providing a file path where your workflows exist, we should be able to use native imports and register our workflows that way. Much like we do with activities.

ie:
```
import * as activities from './app/activities';
const worker = await Worker.create({
    connection,
    namespace: 'default',
    taskQueue: 'hello-world',
    // Workflows are registered using a path as they run in a separate JS context.
    workflowsPath: require.resolve('./app/workflows'),
    activities, // <-- from the imports
  });
```

The ideal solution would be something like this:
```
import * as activities from './app/activities';
import * as workflows from './app/workflows';
const worker = await Worker.create({
    connection,
    namespace: 'default',
    taskQueue: 'hello-world',
    workflows,
    activities,
  });
```

### Additional context

It seems many others have hit this and all of the workarounds are pretty unfavorable as it comes down to getting off webpack (which comes with other issues) or hacking webpack with hard-coded outputs and entry points.

According to the temporal docs, there is another applicable property called workflowBundleConfig but it's not clear how it's used.

I am sure this question has been asked multiple times since there are plenty of hits in temporal community threads. However, there isn't any great solution out there. Obviously, there's a finger-pointing game to play since a valid question may be, "why are you using webpack for backend code?" Well, the answer is we don't have much of a choice with NX and Nest. If you remove NX/Nest from the equation, webpack goes with it and problem is solved. But, we are left with a bunch of work to re-write packages.

Before throwing in the towel on NX/Nest, I would like to understand why things are setup like this instead of following the same pattern as the activities import.

If there is a non-hacky example of NX and Temporal being used to together that supposrts importing dependencies and the usage of decorators, I would love to see it. The ones that are currently out there leverage a hacked-together esbuild or some other heavy-config based implementation.


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2024-10-08 08:29:11.000 UTC</summary>

That's indeed a recurring question. Believe me, we would definitely prefer passing Workflow functions or objects directly to the Worker; that would be much easier for everyone, including us.

But that's simply not possible.

Why? The short answer is already in your code snippet: "Workflows are registered using a path as they run in a separate JS context". That "separate JS context" is [a Node.js VM](https://nodejs.org/docs/latest/api/vm.html#vm-executing-javascript), itself running in a [Node.js Worker Thread](https://nodejs.org/docs/latest/api/worker_threads.html#worker-threads).

Both of these layers (VM and Worker Thread) have their own requirements that point toward the necessity of having a distinct Workflow Bundle.

- Communication between the main Node.js thread and Worker Threads go through the [V8 Serialization protocol](https://nodejs.org/docs/latest/api/v8.html#serialization-api), which doesn't support serialization of functions. That means that it would not be possible to pass "Workflow Functions" from the main thread to the Workflow Worker Thread. In fact, if you look at [Node's Worker Thread API](https://nodejs.org/docs/latest/api/worker_threads.html#new-workerfilename-options), you can see that starting a new Worker Thread actually requires pointing at a _file name_! No live object.

- We use Node's VM API as part of our Workflow sandboxing mechanism. For that mechanism to actually provide "isolation" between Workflows, we need each Workflow VM to get initialized with its own private copy of user-defined modules (i.e. your Workflow source code and files that are imported from there).

But then‚Ä¶ Why do we even need these two isolation layers? Because Workflow code needs to be deterministic. Among other things, the Sandbox allows us to mock various global functions to ensure that they behave deterministically (e.g. Date.now(), Math.random(), setTimeout()), and to control execution order of microtasks (Promise and await). These are intrusive changes to the JS execution environment, which would be unsafe to do on the main Node.js thread.

Activities don't need to go through that type of bundling because they don't have determinism requirement.

> Note that I'm intentionally cutting down on details here. There would be much more to say, but time simply doesn't permit.

Reactions: üëç 2

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-06 00:19:32.000 UTC</summary>

Closing because can't fix.

</details>


---

<a id="1537"></a>

### #1537: [Bug] Workflow lifecycle logging is misleading

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1537 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-09-27 15:43:58.000 UTC (1y 3m ago) |
| **Updated** | 2024-11-06 00:32:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug, visibility |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe what you are trying to do

(From a user) We are trying to get good logs to do alerts on following usecases:
- When a workflow task fails for more than 3 times (possibly becasue of implementation issue)
- Workflow fails (because of ApplicationFailure or ActivityFailure etc)

### Describe the bug

- On Workflow Task failure, the lifecycle logger prints out a message indicating that `Workflow failed`; that's exactly the same error message as on actual `Workflow Failure`, making it impossible to differentiate these cases.

- Similarly, one may see `Workflow started` printed multiple time for a same Workflow Execution, i.e. every single time that the a Worker needs to rebuild (aka ‚Äúreplay‚Äù) the runtime state of that Workflow Execution from the very beginning.

### Additional context

- The thing is that this lifecycle handler is logging things from the perspective of "the Cached Workflow Instance‚Äù (i.e. the specific instance of that workflow execution in the cache of that specific Workflow Worker), rather than from the perspective of the actual Workflow Execution‚Äôs lifecycle.

- We need to think of a more precise way of formulating those messages. For various reasons, no mention of ‚ÄúWorkflow‚Äù or ‚ÄúWorkflow Task‚Äù (starting, failing, completing‚Ä¶) would be 100% reliable at that precise place. For example, Workflow code may attempt to ‚ÄúComplete Workflow‚Äù, but the completion command times out or get rejected by the server because of new incoming events, and so what appears to be ‚ÄúWorkflow completed‚Äù actually ends up being a Workflow Task Failure or Timeout.

- Community Slack conversation: https://temporalio.slack.com/archives/C01DKSMU94L/p1727436127246899

#### Comments (2)

<details>
<summary><strong>ilijaNL</strong> commented on 2024-10-03 04:20:21.000 UTC</summary>

Since temporal sdk has metric counters, why wouldnt it be possible to do logging in the same place when the counter increases?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-06 00:32:02.000 UTC</summary>

> Since temporal sdk has metric counters, why wouldnt it be possible to do logging in the same place when the counter increases?

It's unfortunately not that simple. Metrics bookkeeping is handled by Core SDK, whereas logging is handled on the TypeScript side.

</details>


---

<a id="1522"></a>

### #1522: UpdateWithStart SDK API

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1522 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-09-12 21:47:45.000 UTC (1y 3m ago) |
| **Updated** | 2025-01-07 17:36:09.000 UTC |
| **Closed** | 2025-01-07 17:36:09.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

Expose update-with-start operations via the SDK


---

<a id="1483"></a>

### #1483: Workflow-init support docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1483 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-08-02 04:06:06.000 UTC (1y 5m ago) |
| **Updated** | 2024-10-22 05:49:21.000 UTC |
| **Closed** | 2024-10-22 05:49:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We should have a method that's guaranteed to initialize before signals and updates come in so handlers can use initialized values.

#### Comments (2)

<details>
<summary><strong>drewhoskins-temporal</strong> commented on 2024-08-07 19:04:06.000 UTC</summary>

For typescript, this appears to be a question of documenting that signals can happen before the workflow method runs and proposing the workaround in the docs here: https://docs.temporal.io/develop/typescript/message-passing


</details>

<details>
<summary><strong>antlai-temporal</strong> commented on 2024-09-23 21:50:46.000 UTC</summary>

This will be resolved when PR https://github.com/temporalio/documentation/pull/3107/files merges

</details>


---

<a id="1469"></a>

### #1469: [Feature Request] Allow passing `pageSize` to `WorkflowHandle.fetchHistory`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1469 |
| **State** | CLOSED |
| **Author** | CiaranMn (Ciaran Morinan) |
| **Created** | 2024-07-22 13:57:53.000 UTC (1y 5m ago) |
| **Updated** | 2024-07-25 18:30:34.000 UTC |
| **Closed** | 2024-07-25 18:30:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Event histories larger than the gRPC limit of 4MB are not fetchable via `handle.fetchHistory()`.

As a workaround, they can be retrieved by using `getWorkflowExecutionHistory` directly on `workflowService` and paginating manually.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

### Describe the solution you'd like

The ability to pass `pageSize` to `fetchHistory` and receiving an iterable, similar to how `workflow.list` works.

An alternative solution to the problem described would be to allow configuration of the message size limit, but I understand this is not desired ‚Äì¬†https://github.com/temporalio/temporal/issues/2786

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

In implementing the workaround of paginating through `getWorkflowExecutionHistory` I noticed that the docs on the returned `nextPageToken` are arguably inaccurate in that they describe it as "set if there are more history events than were included in this response", but it is always set (it is an empty `Array` if there are no more events).



#### Comments (2)

<details>
<summary><strong>cretz</strong> commented on 2024-07-22 14:23:33.000 UTC</summary>

> Event histories larger than the gRPC limit of 4MB are not fetchable via `handle.fetchHistory()`.

This is a bug, I have opened #1470.

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-07-25 18:30:34.000 UTC</summary>

Closing this ticket in favor of #1470.

</details>


---

<a id="1416"></a>

### #1416: [Feature Request] Cloud Operations API Client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1416 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-05-09 15:11:52.000 UTC (1y 8m ago) |
| **Updated** | 2024-10-15 16:52:08.000 UTC |
| **Closed** | 2024-10-15 16:52:08.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/440 and https://github.com/temporalio/sdk-go/pull/1426. We need a separate cloud client using the cloud protos (they are separate today). The client should be marked experimental.



---

<a id="1400"></a>

### #1400: [Bug] `Workflow referenced an unregistered external sink` when using `@temporalio/interceptors-opentelemetry`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1400 |
| **State** | CLOSED |
| **Author** | HalfdanJ (Jonas Jongejan) |
| **Created** | 2024-04-23 17:51:19.000 UTC (1y 8m ago) |
| **Updated** | 2024-04-25 15:25:46.000 UTC |
| **Closed** | 2024-04-25 15:25:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm using the @temporalio/interceptors-opentelemetry package in combination with the `bundleWorkflowCode` feature from `@temporalio/worker`.

### Describe the bug
The interceptors work as expected, but I also get a lot of errors in the logs that so far seem harmless but very noisy. 

```
   severity: "ERROR"
   message: "Workflow referenced an unregistered external sink"
   metadata: {
      "ifaceName": "exporter",
      "fnName": "export"
   }
```

If I take out the interceptor from the `workflowInterceptorModules` configuration, the errors disappear. I can further narrow it down to the inclusion of `OpenTelemetryOutboundInterceptor` in outbound interceptors like this: 

```
export const interceptors: WorkflowInterceptorsFactory = () => ({
  outbound: [new OpenTelemetryOutboundInterceptor()],
});
```

### Minimal Reproduction
I can create one if needed, but havent done so yet. 

### Environment/Versions


- OS and processor:  Mac
- Temporal Version: 1.9.3


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2024-04-24 21:01:53.000 UTC</summary>

I think you are missing the `sinks` configuration on your `Worker`:

```
  const worker = await Worker.create({
    workflowsBundle: ...,
    interceptors: {
      activityInbound: [(ctx) => new OpenTelemetryActivityInboundInterceptor(ctx)],
    },

    // Make sure to include this block; `exporter` and `resource` 
    sinks: {
      exporter: makeWorkflowExporter(exporter, resource),
    },
  });
```

Please our Open Telemetry tracing interceptors sample [here](https://github.com/temporalio/samples-typescript/blob/022d78f4b303ca7c48f577f6f2a497d3688d1b0e/interceptors-opentelemetry/src/worker.ts#L25-L38).

</details>

<details>
<summary><strong>HalfdanJ</strong> commented on 2024-04-25 15:25:41.000 UTC</summary>

Ah you are right. I actually already had the sinks, but i was conditionally disabling them not realizing that was were the error stemmed from. 

One piece of feedback, it would be useful to make note of them in the [readme](https://github.com/temporalio/samples-typescript/tree/022d78f4b303ca7c48f577f6f2a497d3688d1b0e/interceptors-opentelemetry), or make more explicit note of them in the sample since its easy to miss the need for it. 

Reactions: üëç 1

</details>


---

<a id="1389"></a>

### #1389: [Bug] Inconsistent Type Definition of Workflow Arguments

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1389 |
| **State** | OPEN |
| **Author** | hiramhuang (Hiram) |
| **Created** | 2024-04-08 08:15:00.000 UTC (1y 9m ago) |
| **Updated** | 2024-04-11 06:29:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm working on creating a reusable generic type that extends from the `Workflow` type.

### Describe the bug

The type definition of arguments on the `Workflow` type is inconsistent with the condition expression on `WithWorkflowArgs` type.
This inconsistency could become problematic when attempting to create a generic type that extends the `Workflow` type.

- [Workflow](https://github.com/temporalio/sdk-typescript/blob/c92a2a13072a48f3d6820ea2bc30cfcd42af6254/packages/common/src/interfaces.ts#L25)
- [WithWorkflowArgs](https://github.com/temporalio/sdk-typescript/blob/c92a2a13072a48f3d6820ea2bc30cfcd42af6254/packages/common/src/workflow-options.ts#L94)

### Minimal Reproduction

Not applicable.

### Environment/Versions

Not applicable.

### Additional context

Not applicable.


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2024-04-10 19:24:24.000 UTC</summary>

Can you please clarify in which case this is posing problems?

</details>

<details>
<summary><strong>hiramhuang</strong> commented on 2024-04-11 06:29:21.000 UTC</summary>

> Can you please clarify in which case this is posing problems?

Due to `any[]` ([on `Workflow` type](https://github.com/temporalio/sdk-typescript/blob/c92a2a13072a48f3d6820ea2bc30cfcd42af6254/packages/common/src/interfaces.ts#L25)) not being equal to `[any, ...any[]]` ([on `WithWorkflowArgs` type](https://github.com/temporalio/sdk-typescript/blob/c92a2a13072a48f3d6820ea2bc30cfcd42af6254/packages/common/src/workflow-options.ts#L94)), the following example function will not pass type checking. This is because it cannot satisfy `WorkflowStartOptions<WT>` when arguments are passed from `Parameters<WT>`:

```typescript
const getWorkflowStartOptions = <WT extends Workflow>(...args: Parameters<WT>) => ({
  ...defaultOptions,
  ...args,
} satisfies WorkflowStartOptions<WT>)
```

It will work if we don't extend from the `Workflow` type. Instead, we define a version of `Workflow` type that is compatible with `WithWorkflowArgs` type:

```typescript
const getWorkflowStartOptions = <WT extends (...args: [any, ...any[]]) => Promise<any>>(...args: Parameters<WT>) => ({
  ...defaultOptions,
  ...args,
} satisfies WorkflowStartOptions<WT>)
```

</details>


---

<a id="1375"></a>

### #1375: [Feature Request] Queueing a workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1375 |
| **State** | OPEN |
| **Author** | baileywickham (Bailey Wickham) |
| **Created** | 2024-03-15 21:49:32.000 UTC (1y 9m ago) |
| **Updated** | 2024-09-18 21:30:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

A pain point we have in using Temporal is in queuing workflows. We would like the ability to queue/buffer a workflow directly from that workflow, similar to the `executeChild` functionality, and without creating a schedule . Currently we are using schedules for this behavior. The schedules do not trigger independently, they are only used with the `BUFFER_ONE` schedule overlap policy. This has three main disadvantages: the first is we need to generate schedules for workflows which don't really need a schedule, they only need the buffering functionality, the second is we need to create a new client inside each workflow when we queueing the next schedule. Third, you can't pass arguments to the schedule, so you can't have a workflow like `RefetchUser(userId)`.

### Describe the solution you'd like

1. The ability to queue a workflow after the completion of a currently running workflow, similar to the `BUFFER_ONE` schedule overlap policy.
2. The ability to do this from inside a workflow without creating a client, similar to `executeChild`. It would also be nice to be able to interact with the schedules directly from a workflow without creating a client.

### Additional context

Let me know if this is something Temporal would consider implementing and if there is anything I can do to help. 



#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2024-03-18 17:15:44.000 UTC</summary>

You could use this pattern to use the workflow itself as a buffer:

```ts
// Make sure Request is serializable to JSON (ie. no function, no promises, etc)
type Request = { ... }

// Entity workflow pattern with serialization of request
// (ie. only one request is processed at a time)
export async function myWorkflow(requests: Request[] = []): Promise<void> {
  setHandler(mySignal, (input: Request) => {
    requests.push(input);
    // Don't await here. Otherwise, the Workflow may complete before the promise completes.
  });

  while (!workflowInfo().continueAsNewSuggested) {
		const timeSinceStart = Date.now() - workflowInfo().runStartTime.getTime();
    const shouldProcessMore = await condition(() => requests.length > 0, ms('24h') - timeSinceStart);
    if (!shouldProcessMore) return;

    const request = requests.shift();

    // Process request as appropriate
    await handleSingleRequest(request);
  }

  // Huge histories are bad for performance, so we switch to a new workflow execution whenever
  // history grows over 2000 events. When that happens, we forward any outstanding requests to the
  // next execution.
  await continueAsNew(requests);
}

function handleSingleRequest(request: Request): Promise<void> {
  // It's ok to await here
}
```

You would then `signalWithStart` the workflow to add an item to its queue.

</details>

<details>
<summary><strong>baileywickham</strong> commented on 2024-05-02 22:43:51.000 UTC</summary>

Thanks for the quick response. This removes the need to create a dedicated schedule and allows us to trigger the next request without an additional client. It does add a fair amount of boilerplate to each of our buffered workflows though, native support would still be ideal. Feel free to close this issue if native support isn't going to be implemented. 

Thanks again for the response. 

</details>


---

<a id="1366"></a>

### #1366: [Feature Request] Support weighted random polling multiple task queues

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1366 |
| **State** | CLOSED |
| **Author** | knpwrs (Ken Powers) |
| **Created** | 2024-02-27 02:43:44.000 UTC (1y 10m ago) |
| **Updated** | 2024-03-01 21:31:54.000 UTC |
| **Closed** | 2024-03-01 21:31:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Temporal does not have any mechanism to implement priority queues.

### Describe the solution you'd like

https://github.com/contribsys/faktory implements priority-like functionality on the worker side by implementing the ability to poll multiple queues for tasks, either in strict order, or by weighted random (to prevent starvation).

Consider the official https://github.com/contribsys/faktory_worker_go library:

```go
// pull jobs from these queues, in this order of precedence
mgr.ProcessStrictPriorityQueues("critical", "default", "bulk")

// alternatively you can use weights to avoid starvation
mgr.ProcessWeightedPriorityQueues(map[string]int{"critical":3, "default":2, "bulk":1})
```

The unofficial https://github.com/jbielick/faktory_worker_node likewise implements this:

```ts
faktory.work({ queues: ["immediately", "afterwards"] });
faktory.work({ queues: { critical: 10, default: 1 } });
```

### Additional context

I would imagine the API would look like this in the Temporal TypeScript SDK:

```ts
const worker = await Worker.create({
  // ...
  taskQueue: 'hello-world',
  // or...
  taskQueue: ['immediately', 'afterwards'],
  // or...
  taskQueue: { critical: 10, default: 1 },
});
```

The `taskQueue` property could also be named `taskQueues` and then something like https://github.com/sindresorhus/type-fest/blob/3ef12b0bdc7c29321daa304abf7a70ed49b9aa7d/source/require-one-or-none.d.ts can ensure that only one of either `taskQueue` or `taskQueues` can be passed to `Worker.create`.

#### Comments (2)

<details>
<summary><strong>knpwrs</strong> commented on 2024-02-27 02:54:39.000 UTC</summary>

I just thought of something, but I haven't tried it yet. Would the following work, or does `Worker` cache the value of `taskQueue` being passed in?

```ts
await Worker.create({
  // ...
  get taskQueue() {
    // return weighted random queue name
  },
});
```

An alternative API to what I proposed above could also be to pass a function as the value of `taskQueue`, or to accept a function called `getNextTaskQueue` or similar.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2024-03-01 21:31:54.000 UTC</summary>

Priority queues is a platform level feature that is not currently supported.

Once Temporal server adds support for this, we can add it to the SDK.

Making a task queue a getter won't work, it's only evaluated once on creation, not on every poll request.

You can create multiple workers in the meantime with different options such as https://typescript.temporal.io/api/interfaces/worker.WorkerOptions#maxconcurrentactivitytaskpolls

Follow this issue for platform level support:
https://github.com/temporalio/temporal/issues/1507

</details>


---

<a id="1361"></a>

### #1361: [Feature Request] Custom Workflow/Activity Resolver

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1361 |
| **State** | CLOSED |
| **Author** | tim37021 (Tim Hsu) |
| **Created** | 2024-02-17 04:51:08.000 UTC (1y 10m ago) |
| **Updated** | 2024-04-04 18:44:04.000 UTC |
| **Closed** | 2024-04-04 18:44:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

We created a Slack bot for automation. Those automation are backed by Temporal. Many teams may contribute to this bot. I would like to add a prefix to each activity and workflow. like `slack.postMessage`. so when people look at temporal web ui, they can clearly know what each activity is doing.

For activities, It is possible to maintain a map.
```typescript
import * as slack from "./slack/activities"
const activities = {
  "slack.postMessage": slack.postMessage
}
```

however, it is not possible to do it for workflows in worker. 

### Describe the solution you'd like
```typescript
const worker = await Worker.create({
    connection: conn,
    namespace: config.temporal.namespaces.default,
    workflowsPath: require.resolve("./workflows/workflows.generated"),
    // workflowNameResolver: myCustomResolver,
    activities: flattenPackageActivities(packageInfos),
    taskQueue: config.temporal.queues.default,

  })
```

myCustomResolver.ts
```typescript
function myCustomResolver(workflowName: string): string {
  return workflowName.split(".").join()...
}
```

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2024-02-20 16:12:07.000 UTC</summary>

You can build this yourself by leveraging the `default` export.

```ts
// workflows.generated.ts
export default async function (...args: unknown[]): Promise<unknown> {
  const { workflowType } = workflowInfo();
  // ...
}
```

Note that if you want to use the typed client interface, you won't be able to use `client.workflow.start(someFunction, ...)`, you'll need to specify both the workflow name and the function type via generics to match the name you want to expose on the workflow side.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-04-04 18:44:04.000 UTC</summary>

Closing: feature is already supported.

</details>


---

<a id="1350"></a>

### #1350: [Bug] Dependency issue when installing @temporalio/interceptors-opentelemetry v1.9.0

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1350 |
| **State** | CLOSED |
| **Author** | domarp-j (Pramod Jacob) |
| **Created** | 2024-02-05 19:52:04.000 UTC (1y 11m ago) |
| **Updated** | 2024-02-06 21:42:03.000 UTC |
| **Closed** | 2024-02-06 21:38:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am attempting to update the following packages from 1.8.6 to 1.9.0:

```
"@temporalio/activity": "1.8.6",
"@temporalio/client": "1.8.6",
"@temporalio/interceptors-opentelemetry": "1.8.6",
"@temporalio/testing": "1.8.6",
"@temporalio/worker": "1.8.6",
"@temporalio/workflow": "1.8.6",
```

### Describe the bug

I can update every package except interceptors-opentelemetry without issue. When I try to bump I-OT, I see:

```
npm ERR! code ERESOLVE
npm ERR! ERESOLVE unable to resolve dependency tree
npm ERR!
npm ERR! While resolving: temporal-hello-world@0.1.0
npm ERR! Found: @temporalio/activity@1.9.0
npm ERR! node_modules/@temporalio/activity
npm ERR!   @temporalio/activity@"1.9.0" from the root project
npm ERR!
npm ERR! Could not resolve dependency:
npm ERR! peer @temporalio/activity@"file:../activity" from @temporalio/interceptors-opentelemetry@1.9.0
npm ERR! node_modules/@temporalio/interceptors-opentelemetry
npm ERR!   @temporalio/interceptors-opentelemetry@"*" from the root project
npm ERR!
npm ERR! Fix the upstream dependency conflict, or retry
npm ERR! this command with --force or --legacy-peer-deps
npm ERR! to accept an incorrect (and potentially broken) dependency resolution.
npm ERR!
npm ERR!
npm ERR! For a full report see:
npm ERR! /home/domarp/.npm/_logs/2024-02-05T19_44_29_102Z-eresolve-report.txt

npm ERR! A complete log of this run can be found in: /home/domarp/.npm/_logs/2024-02-05T19_44_29_102Z-debug-0.log
```

### Minimal Reproduction

1. Pull down or fork https://github.com/domarp-j/temporaltest
2. `npm i`
3. `npm i @temporalio/interceptors-opentelemetry`

### Environment/Versions

- OS and processor: x86 Windows, WLS2
- Temporal Version: Temporal 1.9.0
- Node v20.10.0
- npm v10.2.3
- Are you using Docker or Kubernetes or building Temporal from source?: No

### Additional context

Related to https://github.com/temporalio/sdk-typescript/pull/1330.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2024-02-06 19:27:38.000 UTC</summary>

I published 1.9.1 a couple of hours ago, it should be fixed now.
Please confirm that it's fixed and close this issue.

Reactions: üëç 1

</details>

<details>
<summary><strong>domarp-j</strong> commented on 2024-02-06 21:38:46.000 UTC</summary>

@bergundy Confirmed that installing 1.9.1 of the following packages does indeed work:

```
"@temporalio/activity": "1.9.1",
"@temporalio/client": "1.9.1",
"@temporalio/interceptors-opentelemetry": "1.9.1",
"@temporalio/testing": "1.9.1",
"@temporalio/worker": "1.9.1",
"@temporalio/workflow": "1.9.1",
```

Specifically, I was able to install `interceptors-opentelemetry@1.9.1` without running into those dependency issues.

Thank you for resolving this quickly!

</details>


---

<a id="1297"></a>

### #1297: this can be undefined in async context

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1297 |
| **State** | CLOSED |
| **Author** | giuliohome (Giulio) |
| **Created** | 2023-11-19 19:45:10.000 UTC (2y 1m ago) |
| **Updated** | 2023-11-20 01:24:26.000 UTC |
| **Closed** | 2023-11-20 01:17:37.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

https://github.com/temporalio/sdk-typescript/blob/81f0b14209f603ded31748c2b54e9cf5e81661a8/packages/activity/src/index.ts#L324
See https://github.com/temporalio/samples-typescript/pull/311

#### Comments (2)

<details>
<summary><strong>giuliohome</strong> commented on 2023-11-19 20:32:30.000 UTC</summary>

In your samples you can use the sleep as

```ts
const context = Context.current();
await context.sleep(3000);
```

but you can't import it before 

```ts
const { sleep } = Context.current();
// ...
await sleep(3000);
```

and then call it from a new async context.

Full [explanation here](https://github.com/temporalio/samples-typescript/pull/311#issuecomment-1817973070).
 


</details>

<details>
<summary><strong>giuliohome</strong> commented on 2023-11-20 01:17:37.000 UTC</summary>

Solved in main by making those as arrow functions

https://github.com/temporalio/sdk-typescript/pull/1249

Waiting for next release

</details>


---

<a id="1287"></a>

### #1287: [Feature Request] Eliminate glue code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1287 |
| **State** | CLOSED |
| **Author** | vwkd |
| **Created** | 2023-11-10 19:00:43.000 UTC (2y 2m ago) |
| **Updated** | 2023-12-22 20:57:03.000 UTC |
| **Closed** | 2023-12-22 20:57:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

The TypeScript SDK does a great job hiding the magic that's going on under the hood to let us write colocated code in a single language that runs in different execution contexts in different places. For example, Activities run in a normal environment while Workflows run in a custom deterministic environment, Workers run server-side while Clients run client-side.

But we still need to write a fair bit of glue code to hook up the different parts, like proxy functions and type annotations. Maybe the TypeScript SDK does a better job than the other SDKs, but it still would be nice to eliminate the remaining glue code.

With all the underlying magic that's already happening, the glue code shouldn't be technically necessary. Also, the glue code doesn't really help in explaining the underlying magic, which is much better fit for English documentation.

### Describe the solution you'd like

#### Workflows and Activities

Import and call Workflows and Activities like regular functions instead of proxying them through glue code. The config could be passed as mandatory first argument at function call without specifying it at declaration. A bit like the `self` parameter at method declaration in Rust that's not passed at function call, but the other way around.

```ts
// workflows.ts
import { greet } from './activities';

export async function hello(name: string): Promise<string> {
 const greeting = await greet({
    startToCloseTimeout: '1 minute'
  }, name);

  return greeting;
}
```

```ts
// client.ts
import { hello } from './workflows';

const result = await hello({
  taskQueue: 'greetings-1',
  workflowId: 'hello-1',
}, 'Temporal');
```

#### Workers

Import and pass Workflows as arguments instead of specifying a path like already done for Activities.

```ts
// worker.ts
import { Worker } from "@temporalio/worker";
import * as workflows from "./workflows";
import * as activities from "./activities";

const worker = await Worker.create({
  identity: "worker-1",
  taskQueue: "greetings-1",
  workflows,
  activities,
});
```

### Additional context

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-11-27 18:11:49.000 UTC</summary>

Thanks for sharing your observations regarding how the developer experience of the Temporal TypeScript SDK could be improved. We recognize that some of the indirections required when making calls across different execution contexts may make your code feel a bit less natural.

I disagree however with your claim that _"with all the underlying magic that's already happening, the glue code shouldn't be technically necessary"_. It might be possible to bring different forms of glue code, with different compromises, but given that we have to compose with how the language itself is designed, I honestly don't see how it would be possible to "magically" avoid any form of glue code.

Would you mind provide more details on what you are suggesting, and how this would satisfy the following concerns?

> Import and call Workflows and Activities like regular functions instead of proxying them through glue code. The config could be passed as mandatory first argument at function call without specifying it at declaration.

- Your workflow/activity functions don't expect workflow/activity options as their first argument. How can `import` (i.e. the JavaScript/TypeScript construct) inserts these arguments into the signature of workflow/activity functions you import?

- When calling a workflow/activity function, how does code execution get diverted to a Temporal action (i.e. starting a workflow or scheduling an activity), rather than simply calling the workflow/activity function directly?

- How would this magic mechanism differentiate between importing a workflow/activity function (which needs to execute in a different execution context) and importing some utility functions (which needs to execute in the same execution context as the caller)?

> Import and pass Workflows as arguments instead of specifying a path like already done for Activities

- In TS SDK, Workflow code is delegated to a different thread (Worker Thread). Due to the fact that V8 itself is single threaded, anything that is exchanged across threads needs to be serialized. V8's serialization protocol can't serialize functions. Therefore, starting a worker thread necessarily implies loading files by their file path. If user is specifying workflows as actual function objects, how can we "transfer" that function to the worker thread execution context?

- The TS SDK also execute workflow code inside a deterministic sandbox, which prevents reading files from disk, not even to `import()` or `require()` a source file from workflow code. For that reason, we need all the code that might be loaded/executed from the workflow context to be preloaded and transformed so that it effectively become a single source file. That is the reason for the "workflow bundling" process. If user is specifying workflows as actual function objects, how can we "bundle" that function for use from the sandbox execution context?

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-12-22 20:57:03.000 UTC</summary>

Closing this for now, as it is not actionable as is. I'm open to discuss further improvements, but would need more concrete suggestions.

</details>


---

<a id="1282"></a>

### #1282: [Bug] Activity logger does not serialize Error objects

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1282 |
| **State** | CLOSED |
| **Author** | shawnjones253 (Shawn Jones) |
| **Created** | 2023-11-08 02:28:20.000 UTC (2y 2m ago) |
| **Updated** | 2023-11-10 15:44:34.000 UTC |
| **Closed** | 2023-11-10 15:35:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

From an activity:
```
Context.current().log.error('Kablamo!', new Error('THIS IS AN ERROR!!!'))
```

### Describe the bug

```
Context.current().log.error('Kablamo!', new Error('THIS IS AN ERROR!!!'))
```
produces:
```
2023-11-08T02:17:00.169Z [ERROR] Kablamo! {
  isLocal: false,
  attempt: 10,
  namespace: 'default',
  taskToken: '...',
  workflowId: 'do-stuff',
  workflowRunId: '...,
  workflowType: 'doStuffWorkflow',
  activityId: '1',
  activityType: 'doStuffActivity',
  taskQueue: 'my-queue'
}
```

The log should contain an error object with at least the stack trace. This works for uncaught errors like:
```
throw new Error('THIS IS AN ERROR!!!')
```

produces:
```
2023-11-08T02:17:00.170Z [WARN] Activity failed {
  isLocal: false,
  attempt: 10,
  namespace: 'default',
  taskToken: '...',
  workflowId: 'do-stuff',
  workflowRunId: '...',
  workflowType: 'doStuffWorkflow',
  activityId: '1',
  activityType: 'doStuffActivity',
  taskQueue: 'my-queue',
  error: Error: THIS IS AN ERROR!!!
      at ...stackTrace...,
  durationMs: 2
}
```

### Environment/Versions

- OS and processor: M1 Mac
- Temporal Version: "1.8.1"
- Are you using Docker or Kubernetes or building Temporal from source? Docker temporalio/auto-setup



#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-11-10 15:35:32.000 UTC</summary>

The second argument of `log.error` is a metadata object, not an error.

This works correctly:
```
Context.current().log.error('Kablamo!', { error: new Error('THIS IS AN ERROR!!!') })
```

Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-11-10 15:44:33.000 UTC</summary>

> **Environment/Versions**
> - Temporal Version: "1.8.1"

By the way, some significant bugs were fixed since TS SDK 1.8.1. You should really upgrade to 1.8.6.

Reactions: üëç 1

</details>


---

<a id="1275"></a>

### #1275: [Feature Request] Add NativeClient keep alive support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1275 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-10-30 18:08:57.000 UTC (2y 2m ago) |
| **Updated** | 2024-01-09 18:45:30.000 UTC |
| **Closed** | 2024-01-09 18:45:29.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Already enabled by default in latest SDK core, just need to expose the options from https://github.com/temporalio/sdk-core/issues/585


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-10-31 03:12:04.000 UTC</summary>

This doesn‚Äôt apply to the worker imho as the long polls are a replacement for keep alive.

I would close and not implement this for NativeConnection.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 18:45:29.000 UTC</summary>

> I would close and not implement this for NativeConnection.

Closing.

</details>


---

<a id="1273"></a>

### #1273: TransportError: tonic::transport::Error(Transport, hyper::Error(Connect, ConnectError("tcp connect error", Os { code: 99, kind: AddrNotAvailable, message: "Cannot assign requested address" })))

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1273 |
| **State** | CLOSED |
| **Author** | mxvsh (Monawwar Abdullah) |
| **Created** | 2023-10-25 21:23:00.000 UTC (2y 2m ago) |
| **Updated** | 2024-01-08 17:16:42.000 UTC |
| **Closed** | 2024-01-08 17:16:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Expected Behavior
It should be able to run the worker within a docker container.

## Actual Behavior
It's always throwing the following error when I try to start workers within a Docker container. It works when I manually shell into the container and manually run `node worker.js`.

```js
‚ùØ docker run my-app
TransportError: tonic::transport::Error(Transport, hyper::Error(Connect, ConnectError("tcp connect error", Os { code: 99, kind: AddrNotAvailable, message: "Cannot assign requested address" })))
    at NativeConnection.connect (/app/node_modules/.pnpm/@temporalio+worker@1.8.4_esbuild@0.19.5/node_modules/@temporalio/worker/lib/connection.js:55:23)
```

## Steps to Reproduce the Problem

  1. Create a worker
  2. Start the worker

## Specifications

  - Version: Latest
  - Platform: Mac M1 Pro


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-11-02 22:03:03.000 UTC</summary>

@xencodes Can you please share all of the following:
- Your `NativeConnection`'s options;
- Your `Worker`'s options;
- The Dockerfile of that container.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-08 17:16:42.000 UTC</summary>

Closing due to OP inactivity. Please reopen if this is still pertinent, or consider other support channel, such as [our community forum](https://community.temporal.io/) or [Slack workspace](https://t.mp/slack).

</details>


---

<a id="1208"></a>

### #1208: [Bug] `workflow.log` fails when using `nyc-test-coverage`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1208 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-08-18 15:47:48.000 UTC (2y 4m ago) |
| **Updated** | 2024-01-09 18:48:17.000 UTC |
| **Closed** | 2024-01-09 18:48:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug
The `defaultWorkerLogger` sink doesn't get automatically registered if `WorkerOptions.sinks` is not explicitly set before passing the `WorkerOptions` through `@temporalio/nyc-test-coverage`'s `augmentWorkerOptions`.

Current work around is for user to explicitly specify `sinks: defaultSinks()` in `WorkerOptions` before calling `augmentWorkerOptions`.



#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-18 18:07:02.000 UTC</summary>

I think this should be working correctly since 1.8.2. Waiting for user feedback.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 18:48:17.000 UTC</summary>

Definitely fixed by #1283.

</details>


---

<a id="1195"></a>

### #1195: Forwarded logs from the core do not include metadata

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1195 |
| **State** | CLOSED |
| **Author** | neelance (Richard Musiol) |
| **Created** | 2023-08-09 18:53:52.000 UTC (2y 5m ago) |
| **Updated** | 2023-10-12 15:53:33.000 UTC |
| **Closed** | 2023-10-12 15:53:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We're using the following configuration:
```
  Runtime.install({
    logger: new DefaultLogger("INFO", (logEntry): void => {
      // process log entry
    }),
    telemetryOptions: {
      logging: {
        forward: {},
      },
    },
  });
```

Unfortunately it seems like logs from the core do not include any metadata. The `logEntry.meta` field is `undefined`. Especially log entries like `Failing workflow task` need to include the workflow id and run id for them to be actionable.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-08-09 22:10:19.000 UTC</summary>

@Sushisource we discussed this in the past.
There should be a way to emit the log attributes from Core to the lang logger.
Currently we ship pre-formatted logs.
We'll also want a way to match the casing between Rust and TS, e.g. `workflow_type` and `workflowType`.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2023-08-09 22:16:45.000 UTC</summary>

The fields are available [here](https://github.com/temporalio/sdk-core/blob/64774d67793694d432ebfd64638c4a806785124c/core-api/src/telemetry.rs#L140) for TS to extract

Reactions: üëç 1

</details>


---

<a id="1183"></a>

### #1183: [Bug] worker.Shutdown() results into a Shutdown exception

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1183 |
| **State** | CLOSED |
| **Author** | attriaayush (Aayush Attri) |
| **Created** | 2023-07-30 08:49:53.000 UTC (2y 5m ago) |
| **Updated** | 2023-07-31 18:36:13.000 UTC |
| **Closed** | 2023-07-31 18:36:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I have a couple of tests running against temporal container locally and on the CI. However, as part of the test cleanup when performing `worker.shutdown()` Jest exists with `Exit Code 1` and it fails the whole test suite with an exception.

`[ERROR] Worker failed { error: [Error [ShutdownError]: ShutDown] }` 

### Describe the bug

Was running `1.8.1` for the packages mentioned below, 

```json
    "@temporalio/activity": "^1.8.1",
    "@temporalio/client": "^1.8.1",
    "@temporalio/common": "^1.8.1",
    "@temporalio/worker": "^1.8.1",
    "@temporalio/workflow": "^1.8.1"
```

However downgrading it to `1.7.4` fixes the issue. Is this a known bug?

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux & MacOS
- Temporal Version: 1.21.0
- Are you using Docker or Kubernetes or building Temporal from source? Yes using docker.



#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-07-31 15:09:33.000 UTC</summary>

https://github.com/temporalio/sdk-typescript/pull/1166 fixes the issue and will be included in the upcoming 1.8.2 release.

Reactions: üëç 1

</details>

<details>
<summary><strong>attriaayush</strong> commented on 2023-07-31 18:36:13.000 UTC</summary>

Thanks @bergundy. I am happy to close this issue then.

</details>


---

<a id="1144"></a>

### #1144: [Feature Request] Add support for capturing Workflow test coverage data using Jest

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1144 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-06-22 16:55:49.000 UTC (2y 6m ago) |
| **Updated** | 2025-05-08 13:53:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Description
At present, we provide the `@temporalio/nyc-test-coverage` package, which add interceptor that make it possible to capture workflow test coverage data while using mocha or ava. It however doesn't support tests run using Jest.

We need to provide instructions and tooling for capturing Workflow test coverage data while using Jest.

### Additional context
It is common for testing frameworks to perform some transformations of source code. For example, the test framework may allow working directly with TypeScript files, because these files get transpiled at load time to pure JavaScript. Similarly, nyc/istanbul transform source code at load time to add instrumentation instructions that register which lines and code blocks have been executed.

While these transformations are happening, each transformer produces a source map; these source maps are essential to map runtime code locations back to their original source code locations (eg. when printing out a stack trace), and the other way around (eg. when setting up a breakpoint from a code editor). istanbul/nyc rely on these source maps while instrumenting source code to determine where execution counters need to be inserted.

When running Workflow tests, both the Test engine when the Workflow bundler need to transform source code. If the transformation pipeline used by these two differ (eg. if the test engine load TS files using `ts-node` while the bundler load TS files using SWC), then files that are loaded in both contexts will produce different runtime code, which will result in different code map, and therefore, instanbul will add instrumentation counters in different locations (eg. a same source function processed by `ts-node` may need 10 execution counters, while the same function procesed by `swc` may need only 7 counters; or line numbers may not match, because `ts-node` injected some glue/polyfill code at the begining of the output JS file, while `swc` didn't).

nyc expects that all coverage data mapping back to a same source file will have the same structure (ie. same functions, same execution counters, same line numbers, etc). It doesn't know how to combine coverage data for a same source file, but using different capture data structures. nyc therefore fails (either throwing errors at runtime or by producing invalid reports, depending on various conditions) when a single source file gets loaded from both the test execution context and the Workflow execution context, unless both engines use the very source code transformation pipeline.

Our `nyc-test-coverage` module try to detect the presence of some specific code transformers and adjust the bundler's transformation pipeline to match that of the test engine accordingly. However, Jest heavily hooks into Node's internals, making it very difficult to detect these code transformers at runtime; more over, Jest itself sometime add source code transformers, which can't be injected into our webpack-based Workflow bundler. A different approach therefore need to be designed to correctly support the capture of test coverage data in Workflow context.



#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-06-22 18:23:44.000 UTC</summary>

Here are some things that one may try to make this work on their side. They have worked for some people, and yet, not for others, so your millage may vary.

- Run Jest on your JS files rather than TS files (ie. run tsc yourself prior to running Jest and don‚Äôt use ts-jest or similar).
- If you need to apply other transformations to the code (ie. to collect coverage data), use a CLI command to transform the code before starting tests; don‚Äôt let either Jest nor the Workflow Bundler do these transform for you.
- Make sure that your workflows.js and other Workflow files don‚Äôt get imported from your test.js file. Using import type is correct if you are running Jest on your JS files, as suggested previously; otherwise, specify workflow types and signals as string rather than passing in the function to executeWorkflow and others.
- If you don‚Äôt succeed by transforming Jest‚Äôs transformation pipeline, you may try customizing the Workflow bundler‚Äôs Webpack configuration so that it matches the transformation pipeline of Jest. [See](https://github.com/temporalio/sdk-typescript/blob/main/packages/nyc-test-coverage/src/index.ts#L150) for example how we add support for ts-node in nyc-test-coverage.

</details>

<details>
<summary><strong>mrsimonemms</strong> commented on 2025-05-08 13:52:59.000 UTC</summary>

Adding to the weight of evidence to this, @NavaraKoen has created https://github.com/NavaraKoen/temporal-jest-coverage-example to demonstrate the difference between Jest and Mocha coverage. This could act as a proof of concept to ensure that Jest is equal to Mocha when done.

Reactions: üöÄ 1

</details>


---

<a id="1116"></a>

### #1116: [Bug] @temporalio/create produces unbuildable hello-world project

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1116 |
| **State** | CLOSED |
| **Author** | cameronpickham (Cameron Pickham) |
| **Created** | 2023-05-11 00:34:02.000 UTC (2y 8m ago) |
| **Updated** | 2023-05-26 17:37:20.000 UTC |
| **Closed** | 2023-05-26 17:37:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I would like to set up a hello-world application following the instructions [here](https://learn.temporal.io/getting_started/typescript/dev_environment/)

### Describe the bug

Project fails to build. The created hello-world project is configured to use TypeScript `^4.4.2` but this is incompatible with the supplied version of `tsconfig/node20` due to its usage of `es2023` in the `lib` configuration. I believe this requires TypeScript >= 5.

### Minimal Reproduction

Create the hello-world application with `npx @temporalio/create@latest ./my-app` and then attempt to run using `npm run start.watch`

### Environment/Versions

- OS and processor: M1 Mac
- Temporal Version: temporal version 0.8.0 (server 1.20.1) (ui 2.13.3)
- Are you using Docker or Kubernetes or building Temporal from source? Temporal installed via Homebrew

- Node: v20.0.0

### Additional context


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 00:35:11.000 UTC</summary>

Thanks for reporting, we're still working on officially supporting node 20.
CC @mjameswh 

Reactions: ‚ù§Ô∏è 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-26 17:37:19.000 UTC</summary>

Closing in favor of https://github.com/temporalio/sdk-typescript/issues/1125

</details>


---

<a id="1113"></a>

### #1113: [Feature Request] Create a `npx @temporalio/doctor` command

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1113 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-05-02 19:27:43.000 UTC (2y 8m ago) |
| **Updated** | 2025-02-07 03:49:31.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Problem Description
Users regularly face issues that are due to configuration issues in their project structures, such as:

* Version mismatches on `@temporalio/*` packages
* Unexpected hoisting of `@temporalio/*` packages
* Use of deprecated `@temporalio/*` packages
* Using a version of the TS SDK that is known to have some noteworthy bugs

Due to a certain number of factors, diagnostic of these errors sometime turns out to be non-trivial.

### Proposed solution
We could develop a `@temporalio/doctor` CLI program, meant to be executed using `npx` or similar, that provides various commands to diagnose and fix some common configuration issues in Temporal TS SDK-based projects.

Concretely, this program would be able to scan all package.json/lock files/node_modules directories for the above issues (and possibly more). This program would also make it easy to update/set version number on all `@temporalio/*` dependencies in the project.




---

<a id="1112"></a>

### #1112: [Bug] Workflow Bundler does not deny usage of the `process` global variable

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1112 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-05-01 17:16:56.000 UTC (2y 8m ago) |
| **Updated** | 2025-02-07 03:49:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug
The Workflow Bundler does not forbid uses of the `process` global variable inside Workflow code, resulting in `ReferenceError: process is not defined` at Workflow execution.

### Minimal Reproduction
1. Add something like `process.getuid()` to any existing workflow (note that no `import` statement is added as `process` is a global variable exposed by Node).
1. Start the worker, and confirm the workflow code compiles without error:

```
[INFO] asset workflow-bundle-09308af9a4bcd2033177.js 726 KiB [emitted] [immutable] (name: main)
[INFO] runtime modules 937 bytes 4 modules
[INFO] modules by path ./node_modules/@temporalio/ 168 KiB
[INFO]   modules by path ./node_modules/@temporalio/common/lib/ 69.1 KiB 18 modules
[INFO]   modules by path ./node_modules/@temporalio/workflow/ 97.1 KiB
[INFO]     ./node_modules/@temporalio/workflow/lib/worker-interface.js 11 KiB [built] [code generated]
[INFO]     + 13 modules
[INFO]   ./node_modules/@temporalio/worker/lib/workflow-log-interceptor.js 2.27 KiB [built] [code generated]
[INFO] modules by path ./src/ 3.73 KiB
[INFO]   ./src/workflows-autogenerated-entrypoint.cjs 575 bytes [built] [code generated]
[INFO]   ./src/workflows.ts 2.9 KiB [built] [code generated]
[INFO]   ./src/shared.ts 270 bytes [built] [code generated]
[INFO] __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
[INFO] __temporal_custom_failure_converter (ignored) 15 bytes [built] [code generated]
[INFO] ./node_modules/long/umd/index.js 43.1 KiB [built] [code generated]
[INFO] ./node_modules/ms/index.js 2.95 KiB [built] [code generated]
[INFO] webpack 5.77.0 compiled successfully in 223 ms
[INFO] Workflow bundle created { size: '0.71MB' }
[INFO] Worker state changed { state: 'RUNNING' }
```

1. Start a Workflow excution, then observe an error message similar to this one in Worker's log:

```
[ERROR] Failed to activate workflow {
  runId: '6898d7d0-6622-4cca-928f-2aa2577e6221',
  error: /Users/.../samples-typescript/mutex/workflow-bundle-09308af9a4bcd2033177.js:4594
  const C = process.env.SOMETHING;
            ^
  
  ReferenceError: process is not defined
      at process (/Users/.../samples-typescript/mutex/src/workflows.ts:26:10)
      at __webpack_require__ (webpack/bootstrap:19:0)
      at importWorkflows (/Users/.../samples-typescript/mutex/src/workflows-autogenerated-entrypoint.cjs:9:9)
      at Object.initRuntime (/Users/.../samples-typescript/mutex/node_modules/@temporalio/workflow/src/worker-interface.ts:138:14)
      at evalmachine.<anonymous>:1:18
      at Script.runInContext (node:vm:134:12)
      at Object.runInContext (node:vm:284:6)
      at Proxy.<anonymous> (/Users/.../samples-typescript/mutex/node_modules/@temporalio/worker/lib/workflow/vm.js:36:46)
      at VMWorkflowCreator.createWorkflow (/Users/.../samples-typescript/mutex/node_modules/@temporalio/worker/lib/workflow/vm.js:43:24)
      at async handleRequest (/Users/.../samples-typescript/mutex/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:13),
  workflowExists: false
}
```



#### Comments (2)

<details>
<summary><strong>nubunto</strong> commented on 2023-07-07 18:26:40.000 UTC</summary>

is this a good first issue? I'm inclined to tackle this.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-07-07 19:24:57.000 UTC</summary>

> is this a good first issue? I'm inclined to tackle this.

Thanks for offering! I expect this might actually be a little bit tricky to fix, but not that bad if you are comfortable digging into Webpack. Plus it's possible that I may have missed some straight forward solution.

So let me give some context on this.

The thing is that webpack has a built-in knowledge of which globals (such as `process`, `require` or `JSON`) exist based on the build `target` (see [here](https://webpack.js.org/configuration/target/)). As out bundler is not explicitly setting this parameter at the moment, Webpack defaults to `web`, which is obviously wrong, yet reasonably close from the sandbox environment. The `node` target would be worst, as it would suppose that the `require` global function exists, which we definitely don't want.

Setting target to `false` would actually be the closest we can get of what the sandbox environment really is, but that brings up other issues because of libraries using ["conditional package.json exports"](https://nodejs.org/api/packages.html#conditional-exports). These libraries (including some that we ourselves depends on) very often expose a `node` and a `browser` variant, making them impossible to use when target is set to anything else than `node` or `web`. By the way, what I just described here is also the reason behind [this other issue](https://github.com/temporalio/sdk-typescript/issues/958).

There's certainly more than one way to fix this, but I think the most appropriate solution would be to define a new, custom Webpack target that closely match the workflow sandbox environment. That custom target would also need to enable the "browser" conditional, to ensure that we don't break external libraries that depends on it.

</details>


---

<a id="1111"></a>

### #1111: [Bug] unable to do npm install in a docker to build a container with a worker app since 1.7.3 temporal TS SDK was published

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1111 |
| **State** | CLOSED |
| **Author** | kutovoy (kutovoy) |
| **Created** | 2023-04-28 03:28:50.000 UTC (2y 8m ago) |
| **Updated** | 2023-04-28 04:41:18.000 UTC |
| **Closed** | 2023-04-28 04:41:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

building a docker container based on node:16-bullseye with temporal  worker code in it


### Describe the bug

I was able to make docker container until literally an hour ago when "RUN npm install" step started to fail for no obvious reasons (I didn't change anything but unrelated small JS code fixes), here is how it fails:

 => ERROR [16/18] RUN npm install                                                                                                                                                                     27.9s

------                                                                                                                                                                                                      

 > [16/18] RUN npm install:                                                                                                                                                                                 

#26 27.60 npm ERR! code 1                                                                                                                                                                                   

#26 27.61 npm ERR! path /app/node_modules/@temporalio/core-bridge                                                                                                                                           

#26 27.61 npm ERR! command failed                                                                                                                                                                           

#26 27.61 npm ERR! command sh -c -- node ./scripts/build.js                                                                                                                                                 

#26 27.61 npm ERR! Compiling bridge { target: 'x86_64-unknown-linux-gnu', buildRelease: false }

#26 27.61 npm ERR! Running /app/node_modules/.bin/cargo-cp-artifact [

#26 27.61 npm ERR!   '--artifact',

#26 27.61 npm ERR!   'cdylib',

#26 27.61 npm ERR!   'temporal_sdk_typescript_bridge',

#26 27.61 npm ERR!   'releases/x86_64-unknown-linux-gnu/index.node',

#26 27.61 npm ERR!   '--',

#26 27.61 npm ERR!   'cargo',

#26 27.61 npm ERR!   'build',

#26 27.61 npm ERR!   '--message-format=json-render-diagnostics',

#26 27.61 npm ERR!   '--target',

#26 27.61 npm ERR!   'x86_64-unknown-linux-gnu'

#26 27.61 npm ERR! ]

#26 27.61 npm ERR! No prebuilt module found at /app/node_modules/@temporalio/core-bridge/releases/x86_64-unknown-linux-gnu/index.node

#26 27.61 npm ERR! Error: could not find the `cargo` executable.

#26 27.61 npm ERR! 

#26 27.61 npm ERR! You can find instructions for installing Rust and Cargo at:

#26 27.61 npm ERR! 

#26 27.61 npm ERR!     https://www.rust-lang.org/tools/install

#26 27.61 npm ERR! 

#26 27.61 npm ERR! 

#26 27.62 npm ERR! Did not copy "cdylib:temporal_sdk_typescript_bridge"

#26 27.62 npm ERR! /app/node_modules/@temporalio/core-bridge/scripts/build.js:89

#26 27.62 npm ERR!     throw new Error(`Failed to build${target ? ' for ' + target : ''}`);

#26 27.62 npm ERR!     ^

#26 27.62 npm ERR! 

#26 27.62 npm ERR! Error: Failed to build for x86_64-unknown-linux-gnu

#26 27.62 npm ERR!     at compile (/app/node_modules/@temporalio/core-bridge/scripts/build.js:89:11)

#26 27.62 npm ERR!     at Object.<anonymous> (/app/node_modules/@temporalio/core-bridge/scripts/build.js:106:9)

#26 27.62 npm ERR!     at Module._compile (node:internal/modules/cjs/loader:1196:14)

#26 27.62 npm ERR!     at Object.Module._extensions..js (node:internal/modules/cjs/loader:1250:10)

#26 27.62 npm ERR!     at Module.load (node:internal/modules/cjs/loader:1074:32)

#26 27.62 npm ERR!     at Function.Module._load (node:internal/modules/cjs/loader:909:12)

#26 27.62 npm ERR!     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)

#26 27.62 npm ERR!     at node:internal/main/run_main_module:22:47

#26 27.62 

#26 27.62 npm ERR! A complete log of this run can be found in:

#26 27.62 npm ERR!     /root/.npm/_logs/2023-04-28T03_15_33_215Z-debug-0.log

------

executor failed running [/bin/sh -c npm install]: exit code: 1

I noticed there was a recent push 2hrs ago to the temporal npm sdk with 1.7.3 version of SDK

### Minimal Reproduction

include npm dependencies:

@temporalio/activity ^1.0.0
@temporalio/client ^1.0.0
@temporalio/worker ^1.0.0
@temporalio/workflow ^1.0.0

### Environment/Versions

- Temporal Version: ^1.0.0 (I guess it pulls 1.7.3?)
- Just building docker image with temporal worker code only in it

### Additional context



#### Comments (2)

<details>
<summary><strong>kutovoy</strong> commented on 2023-04-28 03:32:41.000 UTC</summary>

Locking to 1.7.2 using package.json fixed the problem for me. Docker container can be built... its something with 1.7.3 

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-04-28 04:41:17.000 UTC</summary>

I just published 1.7.4 that includes the prebuilt binaries.

Sorry for the inconvenience.

Reactions: üëç 1

</details>


---

<a id="1100"></a>

### #1100: [Bug] Duplicate name error when @temporalio/worker and @temporalio/testing both installed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1100 |
| **State** | CLOSED |
| **Author** | solastley (Solomon Astley) |
| **Created** | 2023-04-17 04:50:56.000 UTC (2y 8m ago) |
| **Updated** | 2023-04-17 16:09:14.000 UTC |
| **Closed** | 2023-04-17 16:09:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
Trying to add unit tests for my Temporal code by installing `@temporalio/testing`, writing unit tests which depend on it, and building/running the tests.

### Describe the bug
When I install both packages and attempt to run the tests (or run a worker locally), I get a namespace error:

```
/<redacted>/node_modules/protobufjs/src/namespace.js:239
                throw Error("duplicate name '" + object.name + "' in " + this);
                      ^
Error: duplicate name 'ActivityHeartbeat' in Namespace coresdk
    at Namespace.add (/<redacted>/node_modules/protobufjs/src/namespace.js:239:23)
    at Root.add (/<redacted>/node_modules/protobufjs/src/namespace.js:232:28)
    at Root.addJSON (/<redacted>/node_modules/protobufjs/src/namespace.js:172:16)
    at Object.<anonymous> (/<redacted>/node_modules/@temporalio/worker/node_modules/@temporalio/proto/protos/json-module.js:7:2)
    at Module._compile (node:internal/modules/cjs/loader:1126:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1180:10)
    at Object.require.extensions.<computed> [as .js] (/<redacted>/node_modules/ts-node/src/index.ts:1608:43)
    at Module.load (node:internal/modules/cjs/loader:1004:32)
    at Function.Module._load (node:internal/modules/cjs/loader:839:12)
    at Module.require (node:internal/modules/cjs/loader:1028:19)
```

### Minimal Reproduction
Install `@temporalio/worker` and `@temporalio/testing`, try to run tests with jest.

### Environment/Versions
Development environment

deps:
```
"@temporalio/activity": "^1.7.0",
"@temporalio/client": "^1.7.0",
"@temporalio/worker": "^1.7.0",
"@temporalio/workflow": "^1.7.0",
```

dev deps:
```
"@temporalio/testing": "^1.7.2",
```


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-04-17 15:56:13.000 UTC</summary>

Please use the same version of of the `@temporalio/*` packages, it should prevent this from happening.

Reactions: üéâ 1

</details>

<details>
<summary><strong>solastley</strong> commented on 2023-04-17 16:09:13.000 UTC</summary>

That fixed it, thanks for the quick reply! <3

</details>


---

<a id="1065"></a>

### #1065: [Feature Request] Expose enum for ExecutionStatus

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1065 |
| **State** | CLOSED |
| **Author** | rupalivohra (Rupali Vohra) |
| **Created** | 2023-02-24 18:03:15.000 UTC (2y 10m ago) |
| **Updated** | 2025-01-21 18:44:40.000 UTC |
| **Closed** | 2025-01-21 18:44:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->
Today, we query for workflow executions like this:
`WorkflowType = '${workflowType}' and ExecutionStatus = 'Running' ORDER BY StartTime ASC`.

Rather than typing in a string for `Running`, I'd like to leverage an enum provided by Temporal. While I don't expect this particular status to change, it feels safer to rely on an enum than a string.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Goal query:
`WorkflowType = '${workflowType}' and ExecutionStatus = '${ExecutionStatus.Running}' ORDER BY StartTime ASC`


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-02-24 21:21:31.000 UTC</summary>

I eventually want to have a query builder as I mentioned in this unmerged proposal.

https://github.com/temporalio/proposals/blob/8061d0cd5d893993af118b3ed476c6d53066664e/typescript/search-attributes.md

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-21 18:44:36.000 UTC</summary>

Not sure this would actually add value. Closing.

</details>


---

<a id="1063"></a>

### #1063: [Bug] Temporal does not use standard AbortController/AbortSignal typings

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1063 |
| **State** | CLOSED |
| **Author** | knpwrs (Ken Powers) |
| **Created** | 2023-02-22 15:41:51.000 UTC (2y 10m ago) |
| **Updated** | 2023-03-07 20:22:34.000 UTC |
| **Closed** | 2023-03-07 20:22:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to pass `Context.current().cancellationSignal` to [`execa`](https://github.com/sindresorhus/execa) so child processes can be automatically killed when a workflow is cancelled.

### Describe the bug

TypeScript is not happy:

```
Argument of type 'import("/.../node_modules/abort-controller/dist/abort-controller").AbortSignal' is not assignable to parameter of type 'AbortSignal'.
Type 'AbortSignal' is missing the following properties from type 'AbortSignal': reason, throwIfAborted
```

Execa expects a standard library `AbortSignal` and Temporal is using a third-party `AbortSignal`.

### Additional context

I saw that ceab74d9d608a0f808cd2a9f63012064800f5044 introduced the `abort-controller` dependency for compatibility with Node 14 as `AbortController` was introduced in Node 15. Does the SDK have any official support policy? There have been two LTS releases since Node 14 (Node 16 and Node 18), both of which support AbortController. Can we just drop the `abort-controller` dependency and use the standard library?


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2023-02-22 16:34:53.000 UTC</summary>

Thanks for reporting, I wasn't aware of the type incompatibility.

I'd have to think about this a bit more and test it out, but my current inclination is to keep the dependency as a polyfill for Node 14 and rely on the Node 16 types when exporting. We may have to manually add the `throwIfAborted` method to the objects we create.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-02-22 16:38:54.000 UTC</summary>

It seems like we can import `abort-controller/polyfill` instead, which will return the native implementation if there is one. I'll do some experiment with this.

</details>


---

<a id="1057"></a>

### #1057: [Feature Request] Propagate opentelemetry context to local activities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1057 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-02-16 00:41:00.000 UTC (2y 10m ago) |
| **Updated** | 2024-12-18 20:25:14.000 UTC |
| **Closed** | 2024-12-18 20:25:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement, good first issue |
| **Assignees** | THardy98 |
| **Milestone** | None |

#### Description

Currently missing, only non-local activities and child workflows traces are attached to the workflow's span.

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-10-24 20:12:59.000 UTC</summary>

This is no longer pertinent, since SDK tracing support is being removed.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-10-29 21:12:58.000 UTC</summary>

> This is no longer pertinent, since SDK tracing support is being removed.

Note this is true for internal SDK traces, not user traces. I reopened this issue.


Reactions: üëç 1

</details>


---

<a id="1006"></a>

### #1006: [Bug] Some logs not being done with our custom logger

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1006 |
| **State** | CLOSED |
| **Author** | jcm300 (Jos√© Carlos Lima Martins) |
| **Created** | 2022-12-26 10:44:45.000 UTC (3 years ago) |
| **Updated** | 2022-12-26 17:09:47.000 UTC |
| **Closed** | 2022-12-26 16:57:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We want all Temporal logs to be done with our custom logger.

### Describe the bug

We are using a custom logger with Temporal. It works great, however there are some logs that don't seem to be done with our custom logger.
These logs happen at the start and shutdown of a worker. For example, while running tests (our logger doesn't log while running tests, so these that show up is because they were not done with our logger):

<img width="809" alt="Screenshot 2022-12-26 at 10 08 31" src="https://user-images.githubusercontent.com/23564120/209536473-9a280244-4168-4023-b4de-ecc585d511dc.png">

### Minimal Reproduction

```
import { Runtime, Worker } from '@temporalio/worker';
import type { Logger, LogLevel, LogMetadata } from '@temporalio/worker';

// Logger that doesn't log, only to show the logs not used by it
class DebugLogger implements Logger {

    log(level: LogLevel, message: string, meta?: LogMetadata | undefined) {
      return
    }

    trace(message: string, meta?: LogMetadata | undefined) {
      return
    }

    info(message: string, meta?: LogMetadata | undefined) {
      return
    }

    debug(message: string, meta?: LogMetadata | undefined) {
      return
    }

    error(message: string, meta?: LogMetadata | undefined) {
      return
    }

    warn(message: string, meta?: LogMetadata | undefined) {
      return
    }
}

const logger = new DebugLogger();

Runtime.install({ logger });

async function run() {
  const worker = await Worker.create({
    taskQueue: 'pull-deposits',
  });

  await worker.run();
}

run().catch((err) => {
  logger.error(err);
  process.exit(1);
});
```

Then you should run this worker and see the following logs for it:
<img width="878" alt="Screenshot 2022-12-26 at 10 20 13" src="https://user-images.githubusercontent.com/23564120/209537619-d696aa3d-803a-4c6b-bdec-7a7601eaea35.png">

And without this logger,
```
import { Worker } from '@temporalio/worker';

async function run() {
  const worker = await Worker.create({
    taskQueue: 'pull-deposits',
  });

  await worker.run();
}

run().catch((err) => {
  process.exit(1);
});
```

We see the following at the terminal:
<img width="878" alt="Screenshot 2022-12-26 at 10 25 20" src="https://user-images.githubusercontent.com/23564120/209538140-34d47a28-4225-4b82-8e5f-18ee0bfb1509.png">

Is this suppose to happen? Are we missing something from the logging steps in the guides?

### Environment/Versions

- OS and processor: M1 Mac
- Temporal Version: Temporal Server -> 1.19.0, Temporal Typescript SDK -> 1.5.2
- Are you using Docker or Kubernetes or building Temporal from source? Docker

### Additional context
N/A

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-12-26 16:57:53.000 UTC</summary>

Those logs are emitted from Rust core.
You'll need to set up log forwarding in the runtime options:

```ts
Runtime.install({
  logger,
  telemetryOptions: {
    logging: {
      filter: makeTelemetryFilterString({ core: logLevel, other: logLevel }),
      forward: {},
    },
  },
})
```

Reactions: üëç 1

</details>

<details>
<summary><strong>jcm300</strong> commented on 2022-12-26 17:09:47.000 UTC</summary>

Yup, we were missing that part.
Thank you!

</details>


---

<a id="1004"></a>

### #1004: [Bug] Installing "@temporalio/testing:1.4.0" along with 1.5.2 libs (activity/client/worker/workflow) breaks Temporal

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1004 |
| **State** | CLOSED |
| **Author** | Andrei199991 |
| **Created** | 2022-12-20 11:11:36.000 UTC (3 years ago) |
| **Updated** | 2022-12-20 12:00:26.000 UTC |
| **Closed** | 2022-12-20 11:16:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Upgrading 4 Temporal packages from 1.4.0 to 1.5.2, ie:

```
    "@temporalio/activity": "1.4.0",
    "@temporalio/client": "1.4.0",
    "@temporalio/worker": "1.4.0",
    "@temporalio/workflow": "1.4.0",
```

to

```
    "@temporalio/activity": "1.5.2",
    "@temporalio/client": "1.5.2",
    "@temporalio/worker": "1.5.2",
    "@temporalio/workflow": "1.5.2"
```

but I forgot to remove `@temporalio/testing:1.4.0` from my project, crashing it entirely. _(perhaps upgrading would've worked, too?)_

### Describe the bug

Keeping `@temporalio/testing:1.4.0` w/ `"@temporalio/activity": "1.5.2"` & `"@temporalio/client": "1.5.2"` & `"@temporalio/worker": "1.5.2"` & `"@temporalio/workflow": "1.5.2"` in package.json will prevent a Temporal Worker from running - it results in a `protobuf` error.

![image](https://user-images.githubusercontent.com/16700631/208650275-87d3db88-fe44-4b2f-b5ff-ed343c8ed333.png)

### Minimal Reproduction

`npm i @temporalio/testing@1.4.0 @temporalio/activity@1.5.2 @temporalio/client@1.5.2 @temporalio/worker@1.5.2 @temporalio/workflow@1.5.2`

then start your Temporal Worker.

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: x86 Windows
- Temporal Version: SDK 1.5.2, except for `@temporalio/testing@1.4.0`
- Are you using Docker or Kubernetes or building Temporal from source? - Docker

### Additional context

- **@temporalio/testing@1.4.0** forces **package-lock.json** to install `@temporalio/proto:1.4.3` in its root (`dependencies`). I believe this is the error. Uninstalling **@temporalio/testing@1.4.0** fixed it.
- I know, installing both **1.4.0** and **1.5.2** packages is dumb. But it shouldn't crash Temporal, should it? 

I'm not very good at manipulating `package-lock.json`, but I venture to guess this is fixable by ensuring `@temporalio/proto` is listed as a `"child" dependency` rather than `"root" dependency`, eg:

**correct result?**
```
package-lock.json
{
    "dependencies": {
        "@temporalio/activity": {
            "dependencies": {
                "@temporalio/proto@1.4.3": { ... }
                // ...
            }
        }
        // ...
    }
    // ...
}
```

instead of

```
package-lock.json
{
    "dependencies": {
        "@temporalio/proto@1.4.3": { ... }
        "@temporalio/activity": {
            "dependencies": {
                // ...
            }
        }
        // ...
    }
    // ...
}
```

#### Comments (2)

<details>
<summary><strong>Andrei199991</strong> commented on 2022-12-20 11:16:38.000 UTC</summary>

hold on, this info isn't entirely accurate. i might reopen / fix this bug report

</details>

<details>
<summary><strong>Andrei199991</strong> commented on 2022-12-20 11:59:12.000 UTC</summary>

just in case you're curious - my `package-json.lock` file was broken on multiple levels. the "**correct result**" listed above is what fixed it (first I manually fixed/unnested the subdependency array, then I deleted the lockfile and ran `npm i`).

I don't know if this is **my** or **Temporal SDK**'s fault (although all i did was `npm i`... I think I'm clean), so I won't bother you with this... üòÖ

</details>


---

<a id="997"></a>

### #997: [Feature Request] Add worker option to delay sending cancellation to activities on shutdown

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/997 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-12-12 20:13:56.000 UTC (3 years ago) |
| **Updated** | 2025-02-10 17:31:42.000 UTC |
| **Closed** | 2025-02-07 15:50:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

In Go / Python SDKs shutdown grace period refers to the time between shutdown being requested and sending cancellation to running activities. In TS this option has a different meaning: time until giving up on waiting for activities to complete after they've been cancelled.

We need to support both options.

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2025-02-04 22:35:37.000 UTC</summary>

@bergundy This was completed in #1072, no?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2025-02-10 17:31:40.000 UTC</summary>

Yes, this was completed in #1072.

</details>


---

<a id="996"></a>

### #996: [Bug] replay workflow with log interceptor not showing logs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/996 |
| **State** | CLOSED |
| **Author** | Irvenae (Irven Aelbrecht) |
| **Created** | 2022-12-09 12:48:54.000 UTC (3y 1m ago) |
| **Updated** | 2022-12-13 10:55:44.000 UTC |
| **Closed** | 2022-12-13 10:55:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to get logs in my output when I am replaying a workflow. I am using my own logger, which is based on https://github.com/temporalio/samples-typescript/tree/main/instrumentation before it had the default helper functions.

### Describe the bug

No log output when replaying a workflow that uses interceptors.

Screenshot when running the workflow (mind that in my example I changed the winston logger with a console logger, in my non-public code I am using a winston logger though):
<img width="589" alt="Screenshot 2022-12-09 at 13 41 46" src="https://user-images.githubusercontent.com/28068977/206704986-cd59a6fe-3ddf-423e-a576-929ee4e94a55.png">

Screenshot when replaying the workflow:

<img width="913" alt="Screenshot 2022-12-09 at 13 42 11" src="https://user-images.githubusercontent.com/28068977/206705064-a3c6c659-b68a-4659-9b3d-bb1aebb88979.png">

(Mind that the sink is known, otherwise you get `Workflow referenced an unregistered external sink` (which is not seen now))
I am running the test with Jest.

### Minimal Reproduction

I think you can reproduce by running https://github.com/temporalio/samples-typescript/tree/main/instrumentation
combined with https://github.com/temporalio/samples-typescript/tree/main/replay-history.

I can make a branch if necessary, but this feels as quite basic functionality.

### Environment/Versions

Mac M1
Temporal SDK 1.5.2
Temporal in docker.
Node version: v16.15.0


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-12-12 20:11:00.000 UTC</summary>

Hey,
Thanks for reporting.
I agree that we should allow logs to be emitted during replays, we just got a [contribution for Go SDK](https://github.com/temporalio/sdk-go/pull/979) to make this configurable.

We should add the same in TS.

</details>

<details>
<summary><strong>Irvenae</strong> commented on 2022-12-13 10:55:44.000 UTC</summary>

Seems like you can set it on a more general level: https://github.com/temporalio/sdk-typescript/blob/a661d16473774efb965a41fd3104a54da7c3a69f/packages/worker/src/sinks.ts#L26

thanks @mjameswh for the suggestion.

Reactions: üëç 1

</details>


---

<a id="982"></a>

### #982: Incompatible with allowSyntheticDefaultImports set to false

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/982 |
| **State** | OPEN |
| **Author** | neelance (Richard Musiol) |
| **Created** | 2022-11-30 22:15:37.000 UTC (3y 1m ago) |
| **Updated** | 2023-08-11 09:45:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Your tsconfig.json seems to have `allowSyntheticDefaultImports` and `esModuleInterop` set to true. This makes TypeScript throw errors when using the SDK in a project that has decided to not use these legacy support flags any more.

We were able to work around this with very small patches to your code, e.g. use `import * as webpack from 'webpack';` instead of `import webpack from 'webpack';`, so I believe it would be easy and helpful if you would disable these flags in the SDK as well.

#### Comments (2)

<details>
<summary><strong>neelance</strong> commented on 2023-01-02 10:03:01.000 UTC</summary>

Seems like this got resolved. Thanks!

</details>

<details>
<summary><strong>neelance</strong> commented on 2023-08-11 09:45:26.000 UTC</summary>

This is again broken in the `@temporalio/testing` package:
```
node_modules/@temporalio/testing/lib/index.d.ts:12:8 - error TS1259: Module '"node:events"' can only be default-imported using the 'allowSyntheticDefaultImports' flag

12 import events from 'node:events';
          ~~~~~~

  node_modules/@types/node/events.d.ts:752:5
    752     export = events;
            ~~~~~~~~~~~~~~~~
    This module is declared with 'export =', and can only be used with a default import when using the 'allowSyntheticDefaultImports' flag.
```

</details>


---

<a id="978"></a>

### #978: [Doc] Document how to bundle with esbuild

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/978 |
| **State** | CLOSED |
| **Author** | wenerme (ÈôàÊù®Êñá) |
| **Created** | 2022-11-25 07:59:31.000 UTC (3y 1m ago) |
| **Updated** | 2023-01-13 03:29:09.000 UTC |
| **Closed** | 2023-01-13 03:29:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëÄ 1 |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

<details>

<summary>First try</summary>


> ReferenceError: __TEMPORAL__ is not defined

```bash
pnpm esbuild --external:./dist/* --external:__* --bundle --outdir=dist/ --keep-names --format=cjs --sourcemap=inline --charset=utf8 --target=node16 --platform=node \
  --banner:js="module = typeof module === 'undefined'? {exports:{}}:module" \
  ./src/entrypoint.ts
```

</details>

**Second try**

> Error: Dynamic require of "__temporal_custom_payload_converter" is not supported

```bash
pnpm esbuild --external:__* --bundle --outdir=dist/ --keep-names --format=iife --sourcemap=inline --charset=utf8 -- 
 target=chrome100 \
  --global-name=__TEMPORAL__ \
  ./src/server/workflows/entrypoint.ts
```


esbuild to not support the alias

https://github.com/temporalio/sdk-typescript/blob/a5eedca5d4cfb5a7b04f9bd65df5dc8547b2f27f/packages/worker/src/workflow/bundler.ts#L193-L241


**Final HACK**

```bash
sed -i -r 's#__importStar[(]__require[(]"__temporal_custom.*?"[)][)]#({})#g' ./dist/entrypoint.js
```

> **Note**
> webpack load+bundled in 0m2.032s (ignore tsc)
> esbuild bundled in 40ms, worker started by tsx (without tsc), a lot faster

**entrypoint.ts**

```ts
import * as api from '@temporalio/workflow/lib/worker-interface.js';

// Bundle all Workflows and interceptor modules for lazy evaluation
api.overrideGlobals();
api.setImportFuncs({
  importWorkflows: () => {
    return import('./workflows');
  },
  importInterceptors: () => {
    return Promise.all([]);
  },
});

export { api };
```

**workflows.ts**

```ts
import { proxyActivities } from '@temporalio/workflow';
import type * as activities from './activities';

const { greet } = proxyActivities<typeof activities>({
  startToCloseTimeout: '1 minute',
});

/** A workflow that simply calls an activity */
export async function example(name: string): Promise<string> {
  return await greet(name);
}
```


### Describe the bug

### Minimal Reproduction


<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->



#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-25 16:55:12.000 UTC</summary>

Thanks for sharing the learning you acquired on this subject. It might help others trying to do similar things.

The time required to bundle workflows is indeed a frequently expressed concern of our developers. Using esbuild is often proposed as a solution to this, and we might consider supporting it officially, as an alternative to Webpack, at some point in the future.

We can't however recommend using a custom workflow bundler at this point in time. The bundling process is an integral part of the workflow sandboxing mechanisms provided by the TypeScript SDK. Bug fixes and development of new features regularly require us to modify various aspect of the bundler. That includes notably the content of the entrypoint.js file, usage of `__temporal_*` variables and pseudo files, the way source maps are encoded, the way modules are stored, and other details.

Custom bundling processes are therefore very fragile and might require maintenance effort on each SDK release (possibly even some patch level releases). Possible, but definitely not something that we want to encourage broadly.

For this reason, I don't think we should include this subject in our official documentation at this point. You are however welcome to keep this ticket updated with any further learning you may acquire on this subject.

</details>

<details>
<summary><strong>wenerme</strong> commented on 2022-11-25 17:44:28.000 UTC</summary>

I tried using webpack bundle in the nextjs project, but the build process failed with `Module parse failed: 'import' and 'export' may appear only with 'sourceType: module'`, the embedded bundling process depends on the env, that's harder to control.

I hope the sdk can use global inject to replace the `__temporal_*` hack, I will keep using external esbuild bundling, until I need the function that provided by `__temporal_*`, then may add more hacks.

About the `__temporal_*`, I think sdk can use a stub module like `export const {x: 'MAGIC_NUMBER'}`, the just replace the code before running will be better than the `require('__temporal_*')`.

</details>


---

<a id="972"></a>

### #972: [Bug] Activity schedule to start metric incorrect during retries 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/972 |
| **State** | CLOSED |
| **Author** | ksapchuk (Kirill) |
| **Created** | 2022-11-18 02:40:32.000 UTC (3y 1m ago) |
| **Updated** | 2022-11-21 16:28:51.000 UTC |
| **Closed** | 2022-11-21 16:28:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
We are trying to use the `temporal_activity_schedule_to_start_latency` metric to measure how behind our workers are in picking up activities.

### Describe the bug
If the activities are failing with retries the `temporal_activity_schedule_to_start_latency` metric reports high schedule to start latency despite there being no scheduling delays. Is the SDK using the activity's first run start time for calculating the activity retries' schedule to start latency? 

### Minimal Reproduction
A failing workflow with activity retries
```
const { fail } = proxyActivities<typeof activities>({
  startToCloseTimeout: '5 minutes',
  retry:{
    maximumAttempts: 5,
    initialInterval: '10 seconds',
    backoffCoefficient: 1,
  }
});

export async function logSampleWorkflow(): Promise<void> {
  await fail();
}
```

An activity that always fails 
```
export async function greet(): Promise<void> {
  throw Error('failing');
}
```

The worker runtime is setup with prometheus telemetry.
```
  Runtime.install({
    telemetryOptions: {
      metrics: {
        prometheus: { bindAddress: '0.0.0.0:9464' },
      },
    },
  });
```

After running the workflow `curl localhost:9464/metrics` to see the metric values. A bunch of retries land in the last activity bucket and the total activity latency is 60 seconds despite the activities starting immediately after their retry window. 
```# TYPE temporal_activity_schedule_to_start_latency histogram
temporal_activity_schedule_to_start_latency_bucket{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation",le="100"} 1
temporal_activity_schedule_to_start_latency_bucket{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation",le="500"} 1
temporal_activity_schedule_to_start_latency_bucket{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation",le="1000"} 1
temporal_activity_schedule_to_start_latency_bucket{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation",le="5000"} 1
temporal_activity_schedule_to_start_latency_bucket{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation",le="10000"} 1
temporal_activity_schedule_to_start_latency_bucket{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation",le="+Inf"} 4
temporal_activity_schedule_to_start_latency_sum{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation"} 60251
temporal_activity_schedule_to_start_latency_count{namespace="default",service_name="temporal-core-sdk",task_queue="instrumentation"} 4
```

### Environment/Versions

- OS and processor: M1 Mac
- Temporal Version: 1.18.1 
- Typescript SDK 1.4.4


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-11-18 17:27:41.000 UTC</summary>

The SDK is using the time the activity was first scheduled:

https://github.com/temporalio/api/blob/9645a99d585b426ebb7555b8f61f5b1ed1aa42af/temporal/api/workflowservice/v1/request_response.proto#L365-L366

There's also this which might be more useful to you.

```
    // When was this task attempt scheduled
    google.protobuf.Timestamp current_attempt_scheduled_time = 11 [(gogoproto.stdtime) = true];
```

I don't think this is a bug, it should be by design, I'll double check what we do in other SDKs.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-11-18 18:22:29.000 UTC</summary>

Update: after checking other SDKs, looks like they're using the `current_attempt_scheduled_time`.
See linked Core PR which corrects this behavior.

</details>


---

<a id="959"></a>

### #959: [Bug] Broken links and hierarchy

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/959 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-11-10 02:54:30.000 UTC (3y 2m ago) |
| **Updated** | 2022-11-10 03:38:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | documentation |
| **Assignees** | None |
| **Milestone** | None |

#### Description


## Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Links and hierarchy section work/don't work depending on which package page you're looking at.

### Links

works in common:

https://typescript.temporal.io/api/interfaces/common.DataConverter

<img width="604" alt="image" src="https://user-images.githubusercontent.com/251288/200988916-e647f8e7-6f17-4515-ad1e-5e9898ee3e0a.png">

don't work in worker:

https://typescript.temporal.io/api/interfaces/worker.DataConverter

<img width="645" alt="image" src="https://user-images.githubusercontent.com/251288/200988882-464cd762-b3b4-455e-85d0-7fbf4455ff72.png">

### Hierarchy

works in client:

https://typescript.temporal.io/api/classes/client.TemporalFailure

<img width="784" alt="image" src="https://user-images.githubusercontent.com/251288/200988979-8a19e1f4-997b-49b1-999a-7fa321d6da0d.png">

doesn't work in common:

https://typescript.temporal.io/api/classes/common.TemporalFailure

<img width="355" alt="image" src="https://user-images.githubusercontent.com/251288/200989119-f93452e3-e887-4fde-9221-8ffa4c48e393.png">



#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-11-10 03:27:41.000 UTC</summary>

It can also be confusing to have duplicate pages in search results (one for each package):

<img width="561" alt="image" src="https://user-images.githubusercontent.com/251288/200993652-0fd08605-a058-4426-acca-2047158f602f.png">

Perhaps a solution is not generating docs pages for anything that's re-exported.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-11-10 03:38:26.000 UTC</summary>

Maybe we can mark the re-exports as @hidden, this is probably an issue with the docusaurus typedoc plugin so worth investigating the source of the issue or see if there‚Äôs a workaround.

</details>


---

<a id="916"></a>

### #916: [Bug] CI flake: `failed to fill whole buffer`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/916 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-10-12 04:57:18.000 UTC (3y 3m ago) |
| **Updated** | 2023-03-09 00:17:30.000 UTC |
| **Closed** | 2023-03-09 00:17:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

```
@temporalio/test:   ephemeral-server ¬ª TestEnvironment sets up temporalite and is able to run a single workflow
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test:   UnexpectedError {
@temporalio/test:     message: 'Failed to start ephemeral server: failed to fill whole buffer',
@temporalio/test:   }
```

[build-and-test (16, windows-latest)](https://github.com/temporalio/sdk-typescript/actions/runs/3232053346/jobs/5292242745#logs)

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-12 21:39:09.000 UTC</summary>

Seems like an issue in Core somewhere.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-03-09 00:17:30.000 UTC</summary>

I haven't seen this in a while.
Closing.

</details>


---

<a id="905"></a>

### #905: [Bug] `npx @temporalio/create@latest` fails in node 18.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/905 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-10-06 18:12:30.000 UTC (3y 3m ago) |
| **Updated** | 2022-12-28 03:38:09.000 UTC |
| **Closed** | 2022-12-28 03:38:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

Getting `DownloadError: Premature close`.

Likely related to https://github.com/npm/node-tar/issues/321.

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-12-28 02:25:10.000 UTC</summary>

I thought this was fixed, but get:

```
$ fnm use 18
Using Node v18.12.1
$ npm cache clean --force
$ npx @temporalio/create@latest ./my-app
Using GITHUB_TOKEN env var for downloading from GitHub
‚úî Which sample would you like to use? ‚Ä∫ hello-world
Creating a new Temporal project in /Users/me/test/my-app/

Downloading files for sample hello-world. This might take a moment.


Aborting installation.
Unexpected error. Please report it as a bug:
DownloadError: Premature close
    at createApp (file:///Users/me/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/create-project.js:136:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async start (file:///Users/me/.npm/_npx/84edb3507a773a27/node_modules/@temporalio/create/lib/index.js:121:5)
```

from this line:

<img width="1253" alt="image" src="https://user-images.githubusercontent.com/251288/209747494-6ee20fff-1d5d-4623-9991-736c4ddab851.png">


</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-12-28 03:38:08.000 UTC</summary>

Fixed by `npx clear-npx-cache` (npx has a separate cache). Thanks @mjameswh üòä

<img width="935" alt="image" src="https://user-images.githubusercontent.com/251288/209753375-e6147082-bf79-48a0-a2c4-fd52ad222214.png">


</details>


---

<a id="886"></a>

### #886: [Bug] workflowClient 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/886 |
| **State** | CLOSED |
| **Author** | rachfop (Patrick Rachford) |
| **Created** | 2022-09-23 18:24:09.000 UTC (3y 3m ago) |
| **Updated** | 2022-09-23 23:31:00.000 UTC |
| **Closed** | 2022-09-23 23:31:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Look up `workflowClient` or similar function.

### Describe the bug

I can see `workflowClient` in the search results.

<img width="565" alt="Screen Shot 2022-09-23 at 11 22 01 AM" src="https://user-images.githubusercontent.com/64233065/192032480-21c40e85-82cd-4726-9b33-c3f710e6d123.png">

However the page is not found:
https://typescript.temporal.io/api/interfaces/testing.workflowclientoptions/

If this is deprecated, perhaps it shouldn't continue to be indexed or a redirect could take place.

### Minimal Reproduction

Click here: https://typescript.temporal.io/api/interfaces/testing.workflowclientoptions/

Is this what was replaced with: https://typescript.temporal.io/api/classes/testing.testworkflowenvironment/#workflowclient

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-09-23 20:27:27.000 UTC</summary>

Might just be indexing delay

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-09-23 23:31:00.000 UTC</summary>

Thanks Patrick, I was getting annoyed by that too üòÑ Indexing is once/week or manual. Last one was 3h ago, and this issue was fixed.

</details>


---

<a id="877"></a>

### #877: [Bug] Error on Render: `TypeError: failed to downcast any`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/877 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-20 21:59:08.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-03 12:55:47.000 UTC |
| **Closed** | 2022-10-03 12:55:47.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Use `env: node` on Render:

https://github.com/anthonywong555/temporal-render-simple/blob/0dd74e4628c87e7663002cb93f8f64c0c328d4be/render.yaml#L107-L120

or `env: docker` with our recommended Dockerfile:

https://github.com/anthonywong555/temporalio-hello-world-js-app-worker-docker/blob/master/Dockerfile

With this simple sample:

https://github.com/anthonywong555/temporalio-hello-world-js

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

```
Sep 20 11:40:44 AM  ==> Detected Node version 16.17.0
Sep 20 11:40:44 AM  ==> Starting service with 'npm run start.watch'
Sep 20 11:40:45 AM  
Sep 20 11:40:45 AM  > hello-world-js@0.1.0 start.watch
Sep 20 11:40:45 AM  > nodemon src/worker.js
Sep 20 11:40:45 AM  
Sep 20 11:40:45 AM  [nodemon] 2.0.20
Sep 20 11:40:45 AM  [nodemon] to restart at any time, enter `rs`
Sep 20 11:40:45 AM  [nodemon] watching path(s): src/**/*
Sep 20 11:40:45 AM  [nodemon] watching extensions: js,mjs,json
Sep 20 11:40:45 AM  [nodemon] starting `node src/worker.js`
Sep 20 11:40:47 AM  2022-09-20T15:40:47.201Z [INFO] Creating worker {
Sep 20 11:40:47 AM    options: {
Sep 20 11:40:47 AM      namespace: 'default',
Sep 20 11:40:47 AM      shutdownGraceTime: '10s',
Sep 20 11:40:47 AM      maxConcurrentActivityTaskExecutions: 100,
Sep 20 11:40:47 AM      maxConcurrentLocalActivityExecutions: 100,
Sep 20 11:40:47 AM      enableNonLocalActivities: true,
Sep 20 11:40:47 AM      maxConcurrentWorkflowTaskExecutions: 100,
Sep 20 11:40:47 AM      stickyQueueScheduleToStartTimeout: '10s',
Sep 20 11:40:47 AM      maxHeartbeatThrottleInterval: '60s',
Sep 20 11:40:47 AM      defaultHeartbeatThrottleInterval: '30s',
Sep 20 11:40:47 AM      isolateExecutionTimeout: '5s',
Sep 20 11:40:47 AM      workflowThreadPoolSize: 8,
Sep 20 11:40:47 AM      maxCachedWorkflows: 250,
Sep 20 11:40:47 AM      enableSDKTracing: false,
Sep 20 11:40:47 AM      showStackTraceSources: false,
Sep 20 11:40:47 AM      debugMode: false,
Sep 20 11:40:47 AM      interceptors: { activityInbound: [Array], workflowModules: [Array] },
Sep 20 11:40:47 AM      sinks: { defaultWorkerLogger: [Object] },
Sep 20 11:40:47 AM      workflowsPath: '/opt/render/project/src/src/workflows.js',
Sep 20 11:40:47 AM      activities: [Module: null prototype] { greet: [AsyncFunction: greet] },
Sep 20 11:40:47 AM      taskQueue: 'hello-javascript',
Sep 20 11:40:47 AM      shutdownGraceTimeMs: 10000,
Sep 20 11:40:47 AM      stickyQueueScheduleToStartTimeoutMs: 10000,
Sep 20 11:40:47 AM      isolateExecutionTimeoutMs: 5000,
Sep 20 11:40:47 AM      maxHeartbeatThrottleIntervalMs: 60000,
Sep 20 11:40:47 AM      defaultHeartbeatThrottleIntervalMs: 30000,
Sep 20 11:40:47 AM      loadedDataConverter: { payloadConverter: [DefaultPayloadConverter], payloadCodecs: [] }
Sep 20 11:40:47 AM    }
Sep 20 11:40:47 AM  }
Sep 20 11:40:52 AM  2022-09-20T15:40:52.685Z [INFO] asset workflow-bundle-291cb9f0d373c32fd94c.js 683 KiB [emitted] [immutable] (name: main)
Sep 20 11:40:52 AM  2022-09-20T15:40:52.689Z [INFO] runtime modules 1.77 KiB 4 modules
Sep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO] modules by path ./node_modules/@temporalio/ 162 KiB
Sep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]   modules by path ./node_modules/@temporalio/workflow/ 96.5 KiB 13 modules
Sep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]   modules by path ./node_modules/@temporalio/common/lib/ 48.7 KiB 10 modules
Sep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]   modules by path ./node_modules/@temporalio/internal-workflow-common/lib/*.js 14.4 KiB
Sep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]     ./node_modules/@temporalio/internal-workflow-common/lib/index.js 1.3 KiB [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.690Z [INFO]     + 9 modules
Sep 20 11:40:52 AM  2022-09-20T15:40:52.691Z [INFO]   ./node_modules/@temporalio/worker/lib/workflow-log-interceptor.js 2.25 KiB [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.691Z [INFO] modules by path ./src/*.js 773 bytes
Sep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO]   ./src/workflows-autogenerated-entrypoint.js 524 bytes [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO]   ./src/workflows.js 249 bytes [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO] __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO] ./node_modules/long/umd/index.js 43.1 KiB [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.692Z [INFO] ./node_modules/ms/index.js 2.95 KiB [built] [code generated]
Sep 20 11:40:52 AM  2022-09-20T15:40:52.693Z [INFO] webpack 5.74.0 compiled successfully in 4264 ms
Sep 20 11:40:52 AM  2022-09-20T15:40:52.699Z [INFO] Workflow bundle created { size: '0.67MB' }
Sep 20 11:41:00 AM  TypeError: failed to downcast any to neon::types::boxed::JsBox<core::cell::RefCell<core::option::Option<temporal_sdk_typescript_bridge::Client>>>
Sep 20 11:41:00 AM      at node:internal/util:361:7
Sep 20 11:41:00 AM      at new Promise (<anonymous>)
Sep 20 11:41:00 AM      at temporal_sdk_typescript_bridge::worker_new (node:internal/util:347:12)
Sep 20 11:41:00 AM      at Runtime.registerWorker (/opt/render/project/src/node_modules/@temporalio/worker/lib/runtime.js:274:73)
Sep 20 11:41:00 AM      at Function.create (/opt/render/project/src/node_modules/@temporalio/worker/lib/worker.js:88:44)
Sep 20 11:41:00 AM      at Function.create (/opt/render/project/src/node_modules/@temporalio/worker/lib/worker.js:178:51)
Sep 20 11:41:00 AM      at async run (file:///opt/render/project/src/src/worker.js:9:18)
Sep 20 11:41:01 AM  [nodemon] app crashed - waiting for file changes before starting...
```

### Environment/Versions

https://render.com/docs/native-environments

### Additional context

<!-- Add any other context about the problem here. -->

> It‚Äôs an error in the bridge, but the output isn‚Äôt great. We should upgrade the places these downcasts happen to include more context.
‚ÄîSpencer

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-09-22 06:22:33.000 UTC</summary>

Issue was lack of `NativeConnection` passed to Worker.create:

https://github.com/anthonywong555/temporalio-hello-world-js-app-worker-docker/blob/b3ae3a7c8b6498915896f4b049049a7feb6633cf/src/worker.js#L13

Action items:

- We should upgrade the places these downcasts happen to include more context.
- Add input validation to `Worker.create` (and everywhere else üòÑ)

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-03 12:55:47.000 UTC</summary>

Failed to downcast is input validation, it‚Äôs a type error.
We can add more input validation at worker creation time but I think that‚Äôs overkill, an IDE should catch this.

</details>


---

<a id="851"></a>

### #851: Jest does not exit due to open handle in temporal

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/851 |
| **State** | CLOSED |
| **Author** | bennidhamma (Ben Joldersma) |
| **Created** | 2022-08-29 02:01:16.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-29 02:26:42.000 UTC |
| **Closed** | 2022-08-29 02:26:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Jest is not exiting correctly due to an open handle in temporal. In and of itself not necessarily the worst thing in the world. but... I'm trying to collect code coverage with nyc, and it [seems](https://github.com/istanbuljs/nyc/issues/762) like nyc prefers to have processes exit cleanly before it attempts to collect coverage information.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

I don't really understand what's going on. here's a stack trace though:

```
Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ‚óè  neon threadsafe function

      93 | export { DataConverter, defaultPayloadConverter, errors };
      94 |
    > 95 | native.registerErrors(errors);
         |        ^
      96 | /**
      97 |  * The worker's possible states
      98 |  * * `INITIALIZED` - The initial state of the Worker after calling {@link Worker.create} and successful connection to the server

      at Object.<anonymous> (../../sdk-typescript/packages/worker/src/worker.ts:95:8)
      at Object.<anonymous> (../../sdk-typescript/packages/worker/src/index.ts:29:1)
      at Object.<anonymous> (../../sdk-typescript/packages/testing/src/index.ts:20:1)
      at Object.<anonymous> (test/unit/scheduling/v2/core/operations/restrict_appt_operating_hours_v2.test.ts:2:1)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:317:13)
      at runJest (node_modules/@jest/core/build/runJest.js:407:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:339:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:190:3)
```

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

If you add `--detectOpenHandles` to the jest script in the activies-examples sample you can see the same error there.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux
- Temporal Version: 1.1.0
- using temporal test server

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-29 02:12:23.000 UTC</summary>

We're not sure yet either, tracking here: https://github.com/temporalio/samples-typescript/issues/189

</details>

<details>
<summary><strong>bennidhamma</strong> commented on 2022-08-29 02:26:42.000 UTC</summary>

oops. i'm sorry I didn't search first.

</details>


---

<a id="844"></a>

### #844: [Bug] Remove `@types/long` stub types definition from `@temporalio/client`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/844 |
| **State** | CLOSED |
| **Author** | mcmxcdev (MCMXC) |
| **Created** | 2022-08-23 12:51:23.000 UTC (3y 4m ago) |
| **Updated** | 2022-09-16 21:54:49.000 UTC |
| **Closed** | 2022-09-16 21:54:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

## Describe the bug

Deprecated `@types/long` is listed in https://github.com/temporalio/sdk-typescript/blob/main/packages/client/package.json#L21

Apart from the fact that `@types/*` packages generally should be moved to `devDependencies` to not end up being installed for the consumer, it can be removed since v5 of `long`.

This issue started popping up when upgrading `@temporalio/client` from 1.0.1 to 1.1.0

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Manjaro Linux
- Temporal Version: 1.1.0

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-23 15:39:42.000 UTC</summary>

We plan to remove this soon.
Because Long is in one of the exported types, if we didn‚Äôt include the types in the package dependencies TS would complain that it can‚Äôt get the type definition for it.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-23 15:40:25.000 UTC</summary>

I generally agree about type packages being devDependencies as we‚Äôve done for all other type packages in the sdk

</details>


---

<a id="839"></a>

### #839: [Bug] @temporalio/nyc-test-coverage npm module doesn't contain lib

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/839 |
| **State** | CLOSED |
| **Author** | vkarpov15 (Valeri Karpov) |
| **Created** | 2022-08-22 20:24:48.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-23 04:56:18.000 UTC |
| **Closed** | 2022-08-23 04:56:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Run `npm install @temporalio/nyc-test-coverage@1.1.0 && ls node_modules/@temporalio/nyc-test-coverage`. You'll see that there's only an `src` directory, no `lib`. Here's a screenshot:

![image](https://user-images.githubusercontent.com/1620265/186012176-9151317b-a090-46d1-b59f-ad6f5d6f20dc.png)


### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

See above

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

See above

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux
- Temporal Version: TypeScript SDK 1.1.0
- Are you using Docker or Kubernetes or building Temporal from source? No

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-22 22:45:54.000 UTC</summary>

@vkarpov15 you probably know this but all it takes is to add `lib` to `package.json`.

</details>

<details>
<summary><strong>vkarpov15</strong> commented on 2022-08-23 01:25:06.000 UTC</summary>

Where? It looks like `lib` is already in the `files` field: https://github.com/temporalio/sdk-typescript/blob/8f27f7c1e065b8effea84bcea93dfc496efc1dbc/packages/nyc-test-coverage/package.json#L28

</details>


---

<a id="824"></a>

### #824: [Bug] CI flake: ERR_SCRIPT_EXECUTION_TIMEOUT

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/824 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-19 03:19:35.000 UTC (3y 4m ago) |
| **Updated** | 2024-01-09 22:00:15.000 UTC |
| **Closed** | 2024-01-09 22:00:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

```
@temporalio/test:   ‚úî workflows ‚Ä∫ signalHandlersCanBeCleared (880ms)
@temporalio/test:   ‚îÄ
@temporalio/test:   workflows ‚Ä∫ partialShield
@temporalio/test:   Rejected promise returned by test. Reason:
lerna ERR! npm run test exited 1 in '@temporalio/test'
@temporalio/test:   Error {
@temporalio/test:     code: 'ERR_SCRIPT_EXECUTION_TIMEOUT',
@temporalio/test:     message: 'Script execution timed out after 100ms',
@temporalio/test:   }
@temporalio/test:   ‚îÄ
@temporalio/test:   1 test failed
Error: Process completed with exit code 1.
```

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-19 04:59:55.000 UTC</summary>

There‚Äôs only so much we can do, the script has 5 seconds to run which is already too much imo. Only way to fix this is reduce test concurrency or get stronger machines.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 22:00:15.000 UTC</summary>

This was partially resolved by increasing `isolateExecutionTimeout` in our test suite to 400ms (it was 100ms when this issue was opened). We still observe some rare flake of this issue (got one in the last two months), there's very likely nothing we can really do to avoid this completely. Closing.

</details>


---

<a id="813"></a>

### #813: [Feature Request] Less boiler plate.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/813 |
| **State** | OPEN |
| **Author** | izakfilmalter (Izak Filmalter) |
| **Created** | 2022-08-12 19:43:34.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-18 21:29:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

I've been using temporal in production for about 3 months now. We have 11 workers, so still small, but moving more of our system over to it. In many ways I love it, it really is like React for the Backend. I'm primarily a FE dev, but now that I run my own startup, I have evolved to be full stack. 

The main thing that puts me off from moving more of my stack over to Temporal is the boiler plate. Right now it feels like React Classes, I want React Functions.

Below is my current flow to get to the point of being able to write a worker:

1. Make file for worker:
	  ```ts
	  type activities = {
	    deleteUser: typeOf deleteUserActivity
	  }
	  
	  const {
	    deleteUser
	  } = proxyActivities<activities>({
	    startToCloseTimeout: '30s', // recommended
	    scheduleToCloseTimeout: '5m', // useful
	    // The below is a Retry Policy. It is used to retry the Activity if it fails.
	    retry: {
	      // These are the values of the Default Retry Policy
	      initialInterval: '1s',
	      backoffCoefficient: 2,
	      nonRetryableErrorTypes: [],
	    },
	  })
	  
	  export async function deleteUser(params: DeleteUserRequest): Promise<void> {
	    await deleteUser(params)
	  }
	  ```

1. Make new activity
	  ```ts
	  export const deleteUser = async (params: {
	    userId: string
	    orgId: string
	  }) => {
	    await Promise.all([
	      deleteFromDB(`users/${userId}`),
	      removeUserFromOrganization(params),
	    ])
	  }
	  ```

1. Update `worker.ts`
	  ```ts
	  const deleteUserActivities = {
	    deleteUser
	  }
	  
	  async function run() {
	    const workers = await Promise.all([
	      // deleteUser
	      Worker.create({
	        ...workflowOption('workflows/users/deleteUser.workflow.ts'),
	        namespace: env.NAMESPACE,
	        connection,
	        interceptors: {
	          activityInbound: [
	            (ctx) => new ActivityInboundLogInterceptor(ctx, activityLogger),
	          ],
	          workflowModules: [require.resolve('workflows/workflowsInterceptor')],
	        },
	        activities: deleteUserActivities,
	        taskQueue: TaskQueue.DeleteUser,
	        sinks,
	        maxCachedWorkflows: 4,
	        maxConcurrentWorkflowTaskExecutions: 4,
	      }),
	    ])
	  }
	  ```

This is a lot to start making a single workflow. If you mess anything up along the way, everything breaks. It feels like Temporal needs JSX. What I mean by that is some kind of preprocessor that will spit all this out for you.

In a perfect world:
1. Workflow definition and options should be colocated.
	1. Workflow options can be overridden when they are called.
1. Activities should just work with default settings. 
    1. Activities should be anything that is a promise or anything that leads to a promise. I have lots of code that prepares a promise, eg `() => async () => unknown`.
1. Type checking of input and output with `zod` should be standard, and enforced. Use the good work that tRPC is doing in making typesafe api's.
1. Autoworkflow wrapper. I have a bunch of non temporal node code that I wish I didn't have to rewrite from the ground up. Having something that could wrap it as one giant activity, a la `dangerouslySetInnerHtml`. You know the risk going it, but it can jump start your switch to Temporal.

Pseudo Example:
```ts
export const deleteUser = Worker
  .create<
    'deleteUser',
    DeleteUserRequest,
    DeleteUserResponse,
  >('deleteUser',
  {
    /* workflow options */
    input: DeleteUserRequest,
    output: DeleteUserResponse,
    async resolve(request) {
      const { userId, orgId } = request
      
      await deleteUser({ userId, orgId })
    }
  })
```

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-12 20:12:51.000 UTC</summary>

Thanks for the feedback and ideas!

1 & 2. I think Temporal is planning for Workflows & Activities to be able to define their own default options. It'll be system-wide, and will work across SDKs.

2i. Here's where we call Activity functions:

![image](https://user-images.githubusercontent.com/251288/184434944-2d7be609-7790-4c38-92a7-41216cd15c0a.png)

So you're suggesting that if `await this.fn()` is a Promise, await again? What's your use case? Does it fit this sample:

https://github.com/temporalio/samples-typescript/blob/main/activities-dependency-injection/src/worker.ts

3. It looks like you're already using compile-time type checking calling Activities. You're looking for runtime checking as well? The default Payload Converter has to be backward compatible and match all other SDKs, but a couple options are using protobufs or creating your own zod-based Payload Converter. 

Some simplification ideas:

- Have a single Worker that has all your workflows and activities. Then adding a workflow and activity is just adding two files in the right directories.
- Your Activity functions can call your existing non-temporal node code
- In future, we plan to allow calling Activities directly from the Client


</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-12 21:04:17.000 UTC</summary>

I want to add a way to colocate workflow implementations with activities, currently it's possible if you're willing to sacrifice runtime failures when referencing unresolved dependencies.
We actually use this feature in the sdk-features repo: https://github.com/temporalio/sdk-features/blob/main/features/activity/retry_on_error/feature.ts.
I agree that some of the boilerplate can be removed but I still believe the SDK should be left as flexible as possible at its core.
For example `zod` is your personal preference, lots of devs would disagree with the decision to enforce this.
For registering activities and workflows, if you set up your project correctly, all it would take is adding exports in the right files (or public methods on activity classes).

Having an ability to invoke any function as an activity was possible in the original version of the SDK, we ended up changing the way it worked because it the approach was too rigid.
I do want to consider a way to provide default activity options (not sure where they'd be specified) so you don't have to pass the options to each proxy call (or even be able to get rid of proxies altogether) but we'd have to think about this some more to find the right way to do it.

</details>


---

<a id="811"></a>

### #811: Improve test server download resilience

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/811 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-10 15:03:23.000 UTC (3y 5m ago) |
| **Updated** | 2022-09-09 00:54:12.000 UTC |
| **Closed** | 2022-09-09 00:54:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Currently:

- When there's a broken java test server release, it breaks users' automated testing.
- When the latest released version doesn't have the test server asset at all, it breaks our user's `npm install`.

![image](https://user-images.githubusercontent.com/251288/183937593-a3d725e5-95e6-4874-9e96-b27bef0b55ba.png)

Solution:

Either:
- We depend on latest test server to work (will be added to CI https://github.com/temporalio/sdk-java/issues/1358) and latest release to have the test server, or
- We add logic to the download script that tries previous versions if latest assets aren't present (helps with 2nd issue but not first)
- We decouple, and put the latest known working version on a CDN (helps with both issues, but feels like duplicate effort if sdk-java has CI). Related: #782 

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-10 15:51:15.000 UTC</summary>

Suggested fix after discussing with @Spikhalskiy is to point the `@temporalio/testing` package to a fixed test server version, that way there are no surprises.
Another option discussed was bundling the test server into the npm package but that'd increase the download size to 45 MB instead of 15 (and 60 or 75 MB when we have aarach64 releases).

#782 will help avoid rate limit exceeded errors.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-09-09 00:54:12.000 UTC</summary>

We can now rely on temporal.download to cache requests to GH so users don't get rate limited and we can control which version is served in the handler for that URL.

</details>


---

<a id="810"></a>

### #810: [Bug] Issue with Long dependency being listed as devDependency

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/810 |
| **State** | CLOSED |
| **Author** | brianlu-scale (Brian Lu) |
| **Created** | 2022-08-09 21:24:21.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-12 23:29:35.000 UTC |
| **Closed** | 2022-08-12 23:29:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Trying to get worker deployments to work correctly in a container that uses yarn to only install dependencies, not devDependencies.

### Describe the bug

Running the workers in Docker containers that are built with `yarn workspaces focus --production @packages/temporal-workflows` results in workers that won't execute with the following stack trace:
```
2022-08-04T03:32:56.766Z [ERROR] Failed to activate workflow {
  runId: 'b2fd073b-42a6-40ce-b719-1468474d7f2c',
  error: TypeError: (seconds || long_1.default.UZERO).mul is not a function
      at tsToMs (/opt/app-root/src/.yarn/cache/@temporalio-internal-workflow-common-npm-1.0.0-rc.1-b66f54d7d6-4272b669aa.zip/node_modules/@temporalio/internal-workflow-common/lib/time.js:30:10)
      at /opt/app-root/src/.yarn/cache/@temporalio-worker-npm-1.0.0-rc.1-2998f0d7a7-147819cf17.zip/node_modules/@temporalio/worker/lib/worker.js:664:90
      at async /opt/app-root/src/.yarn/cache/@temporalio-worker-npm-1.0.0-rc.1-2998f0d7a7-147819cf17.zip/node_modules/@temporalio/worker/lib/tracing.js:65:20
      at async /opt/app-root/src/.yarn/cache/@temporalio-worker-npm-1.0.0-rc.1-2998f0d7a7-147819cf17.zip/node_modules/@temporalio/worker/lib/worker.js:593:28,
  workflowExists: false
}
```

However, if we build this instead with `yarn workspaces focus --all @packages/temporal-workflows`, the worker/container works, which implies that some devDependency needs to be listed as a dependency (likely the `long` package).

### Minimal Reproduction

I'm having issues figuring out how to reproduce this or test this to be honest. I tried testing this solution by forking this repository to see if making the suggested changes would fix it but run into errors trying to use the forked repository as my `temporalio` version. I get the following error (https://community.temporal.io/t/fork-temporal-sdk-typescript/5630).
<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->
Containers have been built on both M1Macs and Linux machines, using the latest Temporal SDK version. We're using yarn pnp and 3.2.0.

### Additional context

Related to [this forum post](https://community.temporal.io/t/worker-error-with-mul-is-not-a-function/5573)

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-10 03:01:04.000 UTC</summary>

In your stack trace, it's being used inside `internal-workflow-common`, where it's a dependency, not a devDependency, so it should be installed.

https://github.com/temporalio/sdk-typescript/blob/723de0fbc7a04e68084ec99453578e7027eb3803/packages/internal-workflow-common/package.json#L16

When you run without `--production` in the production Docker containers, there's no error? 

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-08-12 20:31:16.000 UTC</summary>

The problem is that `protobufjs/light` delegates loading of `long` to the `@protobufjs/inquire` package. Now, the `@protobufjs/inquire` itself does not declare a dependency on `long` in its package.json.

This pattern works in most environment, thanks to the way traditional package managers lay out their node_modules directory, but is forbidden by Yarn 3 and PNPM, though the extend to which they goes in applying that restriction depend on various configuration item... Yarn 3's PnP is essentially the strictest of all.

This should be fixed in our next release.

In the mean time, it is possible to fix this locally by adding the following to your .yarnrc.yml file:
```
packageExtensions:
  "@protobufjs/inquire@*":
    dependencies:
      long: "5.2.0"
```


</details>


---

<a id="807"></a>

### #807: [Bug] Stress test: namespace not found

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/807 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-05 19:16:41.000 UTC (3y 5m ago) |
| **Updated** | 2024-01-09 21:49:46.000 UTC |
| **Closed** | 2024-01-09 21:49:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

```
Status server listening on { address: '::', family: 'IPv6', port: 6666 }
WFs complete (0/100) -- WFs/s curr 0.0 (acc 0.0) -- CPU 208%, MEM 231.52MB  [TransportError: TonicError(Status { code: NotFound, message: "Namespace ce58a569-bb6c-4fa3-b0bd-cd22a005f935 is not found.", details: b"\x08\x05\x12<Namespace ce58a569-bb6c-4fa3-b0bd-cd22a005f935 is not found.\x1as\nItype.googleapis.com/temporal.api.errordetails.v1.NamespaceNotFoundFailure\x12&\n$ce58a569-bb6c-4fa3-b0bd-cd22a005f935", metadata: MetadataMap { headers: {"content-type": "application/grpc"} }, source: None })]
Load all-in-one caught error Error: ChildProcessError: Process failed
    at main (/home/runner/_work/sdk-typescript/sdk-typescript/packages/test/lib/load/all-in-one.js:70:15)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
/home/runner/_work/sdk-typescript/sdk-typescript/packages/test/lib/load/all-scenarios.js:107
            throw new Error(`Test failed with status: ${status}, signal: ${signal}, error: ${error?.message}`);
            ^

Error: Test failed with status: 1, signal: null, error: undefined
    at runScenarios (/home/runner/_work/sdk-typescript/sdk-typescript/packages/test/lib/load/all-scenarios.js:107:19)
    at Object.<anonymous> (/home/runner/_work/sdk-typescript/sdk-typescript/packages/test/lib/load/run-all-stress-ci-scenarios.js:28:34)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Function.Module._load (node:internal/modules/cjs/loader:822:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
Error: Process completed with exit code 1.
```

[stress-tests / stress-test](https://github.com/temporalio/sdk-typescript/runs/7696954237?check_suite_focus=true#logs)

[stress-tests / stress-test](https://github.com/temporalio/sdk-typescript/runs/7697122126?check_suite_focus=true#logs)

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-05 20:15:29.000 UTC</summary>

Thanks for tracking @lorensr I've seen this before.
Not sure if there's a better solution on the server side for this or if we need to work around this (by sleeping?).
Temporalite might be another good option to mitigate these issues.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 21:49:46.000 UTC</summary>

No recent occurrence of this one, and I believe this has been resolved a long time ago by adding a "wait for namespace ready" function before running tests.

</details>


---

<a id="804"></a>

### #804: [Bug] Nightly tests are broken

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/804 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-08-04 23:50:16.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-15 05:36:27.000 UTC |
| **Closed** | 2022-08-15 05:36:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

According to the logs no workflow tasks are returned to the worker, the log is full of these messages:

```
[DEBUG] [temporal_sdk_core::worker::workflow::wft_poller] Poll wft timeout
```

AFAICT Nothing of note changed in the repo in the last couple of days, wondering if it's docker-compose environment related.

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-15 04:47:45.000 UTC</summary>

They've been green since this post

https://github.com/temporalio/sdk-typescript/actions/workflows/nightly.yml

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-08-15 05:36:27.000 UTC</summary>

Hmmm.. bot sure what changed

</details>


---

<a id="796"></a>

### #796: Add WorkflowInfo.unsafe.now()

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/796 |
| **State** | CLOSED |
| **Author** | albertyfwu (Albert) |
| **Created** | 2022-07-30 18:07:41.000 UTC (3y 5m ago) |
| **Updated** | 2022-09-28 04:15:11.000 UTC |
| **Closed** | 2022-09-28 04:15:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to write a query that will return the time left on a timer.

### Describe the bug

If a query depends on `Date.now()`, it will calculate `Date.now()` once and not update it it again on successive queries.

For example:
```
setHandler(timeLeftMsQuery, () => timer.getDeadline() - Date.now());
```

If I query this, I keep getting the same number back even though I would expect to keep getting smaller numbers.

### Minimal Reproduction

```
async function wf() {
  setHandler(timeLeftMsQuery, () => Date.now());
  await sleep('5 hours');
}

const timeLeftMsQuery = defineQuery<number>('timeLeftMs');
```

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (2)

<details>
<summary><strong>albertyfwu</strong> commented on 2022-07-30 18:08:16.000 UTC</summary>

I believe I discussed this with @bergundy a while back on Slack, but I could not relocate the issue on github.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-30 21:32:17.000 UTC</summary>

https://github.com/temporalio/sdk-features/issues/31#issuecomment-1138616879

This is trivial to add.
I‚Äôll make sure we include in the next release 

</details>


---

<a id="783"></a>

### #783: [Feature Request] Better Nx support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/783 |
| **State** | OPEN |
| **Author** | badyan (Alex Badyan) |
| **Created** | 2022-07-27 08:07:42.000 UTC (3y 5m ago) |
| **Updated** | 2024-11-19 22:04:51.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement, ecosystem-and-integrations |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

It's currently very hard to use temporal inside an Nx monorepo. Check out this thread for details of my journey and (eventual) success: https://community.temporal.io/t/using-temporal-with-nx-monorepo/5228

### Describe the solution you'd like

I would appreciate a better support for the Nx use case, ideally a dedicated temporal executor that can wrap all of the bundling and specialized running of commands.
At the very least, a working sample in your repo would go a long way.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="781"></a>

### #781: [Bug] Span ended twice in TypeScript SDK

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/781 |
| **State** | CLOSED |
| **Author** | thegedge (Jason Gedge) |
| **Created** | 2022-07-26 19:23:39.000 UTC (3y 5m ago) |
| **Updated** | 2022-07-28 21:18:58.000 UTC |
| **Closed** | 2022-07-28 21:18:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We're seeing a lot of these messages in our logs:

```
Can not execute the operation on ended Span {traceId: ‚Ä¶, spanId: ‚Ä¶}
You can only call end() on a span once.
```

Ignoring the double error message for a single error source (that's an issue in the otel SDK), this is the source of the error message:

https://github.com/temporalio/sdk-typescript/blob/ea100209b1f62561d69ab230258dbc4f07565c34/packages/worker/src/tracing.ts#L54

It's clear it can be double ended in the worker:

https://github.com/temporalio/sdk-typescript/blob/ea100209b1f62561d69ab230258dbc4f07565c34/packages/worker/src/worker.ts#L1129

Easy fix, should just require dropping the `.end()` on ‚òùÔ∏è since `instrument` takes care of it üôå 

### Environment/Versions

- OS and processor: macOS (intel)
- Temporal Version: TypeScript SDK 1.0.0 (and 0.22.0).

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-26 19:42:34.000 UTC</summary>

Thanks for reporting, would you mind submitting a pr with the fix?

</details>

<details>
<summary><strong>thegedge</strong> commented on 2022-07-26 19:45:22.000 UTC</summary>

Yep, not a problem. I'll try to get to it later today or tomorrow. Was busy and wanted to make sure it got logged :)

</details>


---

<a id="777"></a>

### #777: [Feature Request] Include string enums in failure objects

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/777 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-26 00:09:47.000 UTC (3y 5m ago) |
| **Updated** | 2022-10-03 13:02:34.000 UTC |
| **Closed** | 2022-10-03 13:02:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description


### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

User is developing and logging an error, and see numerical values for enums. For example `retryState`:

![image](https://user-images.githubusercontent.com/251288/180895218-a0f6cdf2-b01a-467c-b919-dec68fae4fa0.png)

- user A: i want to understand what‚Äôs happening, so i‚Äôm going to read my error object and figure out what each thing means
- user B: `retryState: 4`? oh, my activity is in a retry state. does that mean it‚Äôs retrying? but the workflow is Failed. i don‚Äôt understand. what does 4 mean?
- user C, with string version: ‚Äúwait why is my workflow failing on activity timeout? i thought it‚Äôs supposed to retry activities forever‚Äù ‚Äúoh `MAXIMUM_ATTEMPTS_REACHED`? looks like someone must have set `maximumAttempts`‚Äù

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->
I like `retryState: 'MAXIMUM_ATTEMPTS_REACHED'`, but that's back-incompat. So maybe adding: `retryStateString: 'MAXIMUM_ATTEMPTS_REACHED'`.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

Internal slack discussion

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-07-28 17:26:32.000 UTC</summary>

> Is there another way to customize output without altering fields for everyone even those that never dump this object? Is there an accepted way to ask users to use a separate call to get a dump-friendly form of the object?

There's no standard node pattern I'm aware of. We certainly could have a `logFriendly(failure)` helper, or `console.log(failure.pretty())`, and try to teach people it exists via API ref and docs.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-03 13:02:22.000 UTC</summary>

I don‚Äôt think we‚Äôre going to do this. Users can easily look up the enum names and implement this function. Let‚Äôs close for now and revisit if there‚Äôs demand.

</details>


---

<a id="773"></a>

### #773: [Bug] payloadToJSON from from @temporalio/common/lib/proto-utils does not generate vaild proto JSON

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/773 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-07-23 00:54:13.000 UTC (3y 5m ago) |
| **Updated** | 2024-09-27 16:39:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Metadata fields are not turned into base64 encoded strings

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-09-01 12:58:43.000 UTC</summary>

Note to self, this works:

```ts
function payloadToJSON({ metadata, data }: Payload): JSONPayload {
  return {
    metadata:
      metadata &&
      Object.fromEntries(
        Object.entries(metadata).map(([k, v]): [string, string] => [k, Buffer.from(v).toString('base64')])
      ),
    data: data ? Buffer.from(data).toString('base64') : undefined,
  };
}
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-27 16:39:45.000 UTC</summary>

The problem is that proto3-json-serializer does not properly handle maps of bytes (and probably array of bytes too).

I opened an issue on their side: https://github.com/googleapis/google-cloud-node-core/issues/108

</details>


---

<a id="758"></a>

### #758: [Bug] workflowBundle with code/sourceMap breaks with obscure error, while using codePath/sourceMapPath works

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/758 |
| **State** | CLOSED |
| **Author** | davidtheclark (David Clark) |
| **Created** | 2022-07-16 17:26:17.000 UTC (3y 5m ago) |
| **Updated** | 2022-07-17 03:52:28.000 UTC |
| **Closed** | 2022-07-17 03:52:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Upgrade to 1.0.0-rc.1 and run a worker.

### Describe the bug

If I build a bundle and then start the worker with a `workflowBundle` object with `code` and `sourceMap` properties, the worker crashes with this error (which unhelpfully has no stack trace):

```
ERROR : Invalid regular expression flags {}
```

If I just change my `workflowBundle` bundle to use the `codePath` and `sourceMapPath` properties, the worker does not crash.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version: 1.0.0-rc.1
- Are you using Docker or Kubernetes or building Temporal from source? The server is on Ducker.



#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-16 21:06:42.000 UTC</summary>

Sounds like you‚Äôre passing a path instead of the actual code, can you verify?

</details>

<details>
<summary><strong>davidtheclark</strong> commented on 2022-07-17 03:52:16.000 UTC</summary>

Ah yes, thank you. I misunderstood some of the documentation.

</details>


---

<a id="746"></a>

### #746: core-2.0.0-beta.21.tgz: 8 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/746 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-07-07 19:53:27.000 UTC (3y 6m ago) |
| **Updated** | 2022-12-16 21:58:13.000 UTC |
| **Closed** | 2022-12-16 21:58:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>core-2.0.0-beta.21.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (core version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2021-44906](https://www.mend.io/vulnerability-database/CVE-2021-44906) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | minimist-1.2.5.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25858](https://www.mend.io/vulnerability-database/CVE-2022-25858) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | terser-5.11.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-37603](https://www.mend.io/vulnerability-database/CVE-2022-37603) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | detected in multiple dependencies | Transitive | N/A* | &#10060; |
| [CVE-2022-3517](https://www.mend.io/vulnerability-database/CVE-2022-3517) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | minimatch-3.0.4.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-37599](https://www.mend.io/vulnerability-database/CVE-2022-37599) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | loader-utils-2.0.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2020-7753](https://www.mend.io/vulnerability-database/CVE-2020-7753) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | trim-0.0.1.tgz | Transitive | N/A* | &#10060; |
| [CVE-2021-3803](https://www.mend.io/vulnerability-database/CVE-2021-3803) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | nth-check-1.0.2.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-33987](https://www.mend.io/vulnerability-database/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-9.6.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-44906</summary>


###  Vulnerable Library - <b>minimist-1.2.5.tgz</b></p>

<p>parse argument options</p>
<p>Library home page: <a href="https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz">https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/minimist/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - wait-on-6.0.1.tgz
      - :x: **minimist-1.2.5.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Minimist <=1.2.5 is vulnerable to Prototype Pollution via file index.js, function setKey() (lines 69-95).

<p>Publish Date: 2022-03-17
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2021-44906>CVE-2021-44906</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-03-17</p>
<p>Fix Resolution: minimist - 1.2.6</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25858</summary>


###  Vulnerable Library - <b>terser-5.11.0.tgz</b></p>

<p>JavaScript parser, mangler/compressor and beautifier toolkit for ES6+</p>
<p>Library home page: <a href="https://registry.npmjs.org/terser/-/terser-5.11.0.tgz">https://registry.npmjs.org/terser/-/terser-5.11.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/terser/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - html-minifier-terser-6.1.0.tgz
      - :x: **terser-5.11.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The package terser before 4.8.1, from 5.0.0 and before 5.14.2 are vulnerable to Regular Expression Denial of Service (ReDoS) due to insecure usage of regular expressions.

<p>Publish Date: 2022-07-15
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25858>CVE-2022-25858</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25858">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25858</a></p>
<p>Release Date: 2022-07-15</p>
<p>Fix Resolution: terser - 4.8.1,5.14.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37603</summary>


###  Vulnerable Libraries - <b>loader-utils-3.2.0.tgz</b>, <b>loader-utils-2.0.0.tgz</b></p>
<p>


### <b>loader-utils-3.2.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-3.2.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-3.2.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/react-dev-utils/node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - react-dev-utils-12.0.1.tgz
      - :x: **loader-utils-3.2.0.tgz** (Vulnerable Library)


### <b>loader-utils-2.0.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-2.0.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-2.0.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - file-loader-6.2.0.tgz
      - :x: **loader-utils-2.0.0.tgz** (Vulnerable Library)


<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Regular expression denial of service (ReDoS) flaw was found in Function interpolateName in interpolateName.js in webpack loader-utils 2.0.0 via the url variable in interpolateName.js.

<p>Publish Date: 2022-10-14
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37603>CVE-2022-37603</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-3rfm-jhwj-7488">https://github.com/advisories/GHSA-3rfm-jhwj-7488</a></p>
<p>Release Date: 2022-10-14</p>
<p>Fix Resolution: loader-utils - 1.4.2,2.0.4,3.2.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-3517</summary>


###  Vulnerable Library - <b>minimatch-3.0.4.tgz</b></p>

<p>a glob matcher in javascript</p>
<p>Library home page: <a href="https://registry.npmjs.org/minimatch/-/minimatch-3.0.4.tgz">https://registry.npmjs.org/minimatch/-/minimatch-3.0.4.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/minimatch/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - serve-handler-6.1.3.tgz
      - :x: **minimatch-3.0.4.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A vulnerability was found in the minimatch package. This flaw allows a Regular Expression Denial of Service (ReDoS) when calling the braceExpand function with specific arguments, resulting in a Denial of Service.

<p>Publish Date: 2022-10-17
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-3517>CVE-2022-3517</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-10-17</p>
<p>Fix Resolution: minimatch - 3.0.5</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37599</summary>


###  Vulnerable Library - <b>loader-utils-2.0.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-2.0.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-2.0.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - file-loader-6.2.0.tgz
      - :x: **loader-utils-2.0.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Regular expression denial of service (ReDoS) flaw was found in Function interpolateName in interpolateName.js in webpack loader-utils 2.0.0 via the resourcePath variable in interpolateName.js.

<p>Publish Date: 2022-10-11
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37599>CVE-2022-37599</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-hhq3-ff78-jv3g">https://github.com/advisories/GHSA-hhq3-ff78-jv3g</a></p>
<p>Release Date: 2022-10-11</p>
<p>Fix Resolution: loader-utils - 1.4.2,2.0.4,3.2.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2020-7753</summary>


###  Vulnerable Library - <b>trim-0.0.1.tgz</b></p>

<p>Trim string whitespace</p>
<p>Library home page: <a href="https://registry.npmjs.org/trim/-/trim-0.0.1.tgz">https://registry.npmjs.org/trim/-/trim-0.0.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/trim/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - mdx-loader-2.0.0-beta.21.tgz
      - mdx-1.6.22.tgz
        - remark-parse-8.0.3.tgz
          - :x: **trim-0.0.1.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().

<p>Publish Date: 2020-10-27
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2020-7753>CVE-2020-7753</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-10-27</p>
<p>Fix Resolution: trim - 0.0.3</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-3803</summary>


###  Vulnerable Library - <b>nth-check-1.0.2.tgz</b></p>

<p>performant nth-check parser & compiler</p>
<p>Library home page: <a href="https://registry.npmjs.org/nth-check/-/nth-check-1.0.2.tgz">https://registry.npmjs.org/nth-check/-/nth-check-1.0.2.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/@slorber/static-site-generator-webpack-plugin/node_modules/nth-check/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - static-site-generator-webpack-plugin-4.0.4.tgz
      - cheerio-0.22.0.tgz
        - css-select-1.2.0.tgz
          - :x: **nth-check-1.0.2.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
nth-check is vulnerable to Inefficient Regular Expression Complexity

<p>Publish Date: 2021-09-17
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2021-3803>CVE-2021-3803</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2021-09-17</p>
<p>Fix Resolution: nth-check - v2.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-9.6.0.tgz</b></p>

<p>Simplified HTTP requests</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-9.6.0.tgz">https://registry.npmjs.org/got/-/got-9.6.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.21.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - :x: **got-9.6.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: got - 11.8.5,12.1.0</p>

</p>

<p></p>

</details>

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-07-19 16:17:20.000 UTC</summary>

This report is coming from the docs package, not the SDK itself, and it does not affect our deployed docs site, https://typescript.temporal.io/. 

The vulnerabilities are in a nested dep of `@docusaurus/core`. We'll update our version of docusaurus when they update their dep.

</details>

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-12-16 21:58:12.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="607"></a>

### #607: [Feature Request] Eager Connection with `getSystemInfo`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/607 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-04-22 00:48:33.000 UTC (3y 8m ago) |
| **Updated** | 2022-06-06 21:17:04.000 UTC |
| **Closed** | 2022-06-06 21:17:04.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | 1.0 |
| **Reactions** | üëç 1 |

#### Description

To complete the transition to using `getSystemInfo` in all of our SDKs, we'll need to update `Connection` to eagerly connect and make that RPC call.
`Connection` constructor will become private and instead we'll expose an async factory: `Connection.create()`.

This also affects the `WorkflowClient` class which defaults to instantiating its own connection if one is not provided.
The constructor will remain public but will require a `Connection` instance.
We'll add an `async WorkflowClient.forLocalHost()` helper to easily create one for samples.

In addition `WorkflowClient` should have access to the connection directly to simplify using the connection's `withMetadata` and `withTimeout` methods, e.g: `client.connection.withTimeout(...)`.

Some other ideas that we might incorporate in the future include unifying `WorkflowClient` and `AsyncCompletionClient` into a single `Client` class or creating a wrapper `Client` class with both more specific clients: `client.workflow.start()` and `client.asyncCompletion.complete()`.


---

<a id="541"></a>

### #541: [Feature Request] After `create`, give customized setup instructions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/541 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-16 00:06:29.000 UTC (3y 10m ago) |
| **Updated** | 2023-05-29 17:13:01.000 UTC |
| **Closed** | 2023-05-29 17:13:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

With https://github.com/temporalio/samples-typescript/pull/107, the beginning of each `.post-install` message has:

![image](https://user-images.githubusercontent.com/251288/158491613-99a71a3a-56c9-43d2-b520-a4ffe112880a.png)

It would be nicer if we:

- Checked which platform, so we know which command to run to install
- Don't output part of the instructions if we:
  - See that `docker-compose` is already installed and docker daemon is running
  - See that Temporal Server is already running, or
  - See that Node version is already >= 14

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-29 17:01:48.000 UTC</summary>

@lorensr Do you had something specific in mind on how to achieve this?

I have quite a few ideas on how this could be done, but I'm hesitant on the level of flexibility we may want, and I definitely don't want to make `create` package itself too smart regarding what messages could need to be displayed or not.

Would either of these options make sense to you:
- Make `.post-create` a handlebar or ejs template (not mentioning mustache as that would require exposing variables for each and every possible condition)
- Replace `.post-create` by `.post-create.js`, which would be a script to be _executed_ after installation. That would technically allow much greater customizations, but would probably make maintenance of these message files a little bit more complicated.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2023-05-29 17:13:01.000 UTC</summary>

I think our package initializer is complex enough as is.
The custom template is more than enough imho.
Let‚Äôs close this.

Reactions: üëç 1

</details>


---

<a id="539"></a>

### #539: [Feature Request] Reduce size of aarch64-unknown-linux-gnu

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/539 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-15 16:12:55.000 UTC (3y 10m ago) |
| **Updated** | 2022-07-14 22:08:14.000 UTC |
| **Closed** | 2022-07-14 22:08:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

228 MB is too large:

```
cd packages/core-bridge/releases/
du -sh *
4.0K	__fig_post_prompt
 14M	aarch64-apple-darwin
228M	aarch64-unknown-linux-gnu
 15M	x86_64-apple-darwin
 13M	x86_64-pc-windows-msvc
 17M	x86_64-unknown-linux-gnu
```

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Fix publish script

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-03 22:36:56.000 UTC</summary>

Increased size was due to us building for this target on MacOS.
Need to automate this build.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 22:08:14.000 UTC</summary>

This was done already since we build for this target in GHA

</details>


---

<a id="538"></a>

### #538: Test last heartbeat details shows up on Activity retry

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/538 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-14 22:28:55.000 UTC (3y 10m ago) |
| **Updated** | 2022-04-21 21:58:36.000 UTC |
| **Closed** | 2022-04-21 21:58:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

A heartbeat-then-immediately fail test that checks heartbeat details on activity retry

#### Comments (2)

<details>
<summary><strong>cretz</strong> commented on 2022-03-15 16:09:31.000 UTC</summary>

@lorensr - Here's the Python test:

```python
async def test_activity_heartbeat_details(
    client: temporalio.client.Client, worker: Worker
):
    async def some_activity() -> str:
        info = temporalio.activity.info()
        count = int(next(iter(info.heartbeat_details))) if info.heartbeat_details else 0
        temporalio.activity.logger.debug(
            "Changing count from %s to %s", count, count + 9
        )
        count += 9
        temporalio.activity.heartbeat(count)
        if count < 30:
            raise RuntimeError("Try again!")
        return f"final count: {count}"

    result = await _execute_workflow_with_activity(
        client,
        worker,
        some_activity,
        retry_max_attempts=4,
    )
    assert result.result == "final count: 36"
```

Basically, I just set the details and add 9 each time and have an expected count. I think the test is important to do this way for a couple of reasons: It specifically tests multiple retries and it makes sure that it does the _exact_ number of retries so a heartbeat isn't missed.

This test is, rarely, giving me errors right now in a racy way, so I am curious if it happens to yours too and if Core is the culprit. Obviously the numbers can be changed to whatever, but it's important to test exact number of retries and have each value build on the previous.

You'll also want to make sure that retry is fast (very low backoff), it's not shown in my code here.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-04-21 21:58:35.000 UTC</summary>

Addressed in #523 

</details>


---

<a id="529"></a>

### #529: [Bug] test-worker-no-workflows intermittent failure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/529 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-12 00:02:59.000 UTC (3y 10m ago) |
| **Updated** | 2024-01-09 21:27:36.000 UTC |
| **Closed** | 2024-01-09 21:27:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

This happens some of the time:

`RUN_INTEGRATION_TESTS=1 npx ava packages/test/lib/test-worker-no-workflows.js`

```
2022-03-12T00:00:24.360Z [INFO] [temporal_sdk_core::worker::dispatcher] Shutting down worker on queue only-activities
2022-03-12T00:00:24.360Z [INFO] [temporal_sdk_core::worker::dispatcher] Shutting down worker on queue also-workflows
2022-03-12T00:00:24.362Z [INFO] Worker state changed { state: 'DRAINED' }
2022-03-12T00:00:24.362Z [INFO] Worker state changed { state: 'STOPPED' }
2022-03-12T00:00:29.360Z [ERROR] Worker failed {
  error: GracefulShutdownPeriodExpiredError: Timed out while waiting for worker to shutdown gracefully
      at /Users/me/gh/sdk-typescript/packages/worker/src/worker.ts:399:17
      at /Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/map.ts:58:33
      at OperatorSubscriber._this._next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
      at OperatorSubscriber.Subscriber.next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/Subscriber.ts:75:12)
      at /Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/mergeInternals.ts:85:24
      at OperatorSubscriber._this._next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
      at OperatorSubscriber.Subscriber.next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/Subscriber.ts:75:12)
      at /Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/map.ts:58:20
      at OperatorSubscriber._this._next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
      at OperatorSubscriber.Subscriber.next (/Users/me/gh/sdk-typescript/node_modules/rxjs/src/internal/Subscriber.ts:75:12)
}
2022-03-12T00:00:29.360Z [INFO] Worker state changed { state: 'FAILED' }
  Worker functions when asked not to run Workflows

  Rejected promise returned by test. Reason:

  GracefulShutdownPeriodExpiredError {
    message: 'Timed out while waiting for worker to shutdown gracefully',
  }

  ‚Ä∫ packages/worker/src/worker.ts:399:17
  ‚Ä∫ node_modules/rxjs/src/internal/operators/map.ts:58:33
  ‚Ä∫ OperatorSubscriber._this._next (node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
  ‚Ä∫ OperatorSubscriber.Subscriber.next (node_modules/rxjs/src/internal/Subscriber.ts:75:12)
  ‚Ä∫ node_modules/rxjs/src/internal/operators/mergeInternals.ts:85:24
  ‚Ä∫ OperatorSubscriber._this._next (node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
  ‚Ä∫ OperatorSubscriber.Subscriber.next (node_modules/rxjs/src/internal/Subscriber.ts:75:12)
  ‚Ä∫ node_modules/rxjs/src/internal/operators/map.ts:58:20
  ‚Ä∫ OperatorSubscriber._this._next (node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:70:13)
  ‚Ä∫ OperatorSubscriber.Subscriber.next (node_modules/rxjs/src/internal/Subscriber.ts:75:12)

  ‚îÄ

  1 test failed
  ```
  
  on latest `main` and `0.18.0`

#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-29 20:39:07.000 UTC</summary>

Two recent occurrences:
- https://github.com/temporalio/sdk-typescript/actions/runs/3576905911/jobs/6016717992#step:13:9918
- One around 2022-11-07

<img width="1203" alt="Capture d‚ÄôeÃÅcran, le 2022-11-07 aÃÄ 15 42 42" src="https://user-images.githubusercontent.com/6412169/204641761-5e8d422d-7c0e-4608-a954-d4464abaef90.png">


</details>

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 21:27:35.000 UTC</summary>

Haven't seen this error recently. Also, the Worker shutdown process has changed a lot since this was initially reported, so it seems very reasonable to think that this has already been fixed.

</details>


---

<a id="478"></a>

### #478: [Feature Request] Add equivalent to setFailWorkflowExceptionTypes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/478 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-14 18:21:21.000 UTC (3y 10m ago) |
| **Updated** | 2022-02-14 22:57:03.000 UTC |
| **Closed** | 2022-02-14 22:57:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

In Java, we have:

```java
   /**
     * Optional: Sets how workflow worker deals with exceptions thrown from the workflow code which
     * include non-deterministic history events (presumably arising from non-deterministic workflow
     * definitions or non-backward compatible workflow definition changes).
     *
     * <p>The default behavior is to fail workflow on {@link io.temporal.failure.TemporalFailure} or
     * any of its subclasses. Any other exceptions thrown from the workflow code are treated as bugs
     * that can be fixed by a new deployment. So workflow is not failed, but it stuck in a retry
     * loop trying to execute the code that led to the unexpected exception.
     *
     * <p>This option allows to specify specific exception types which should lead to workflow
     * failure instead of blockage. Any exception that extends the configured type considered
     * matched. For example to fail workflow on any exception pass {@link Throwable} class to this
     * method.
     */
    @SafeVarargs
    public final Builder setFailWorkflowExceptionTypes(
```

https://github.com/temporalio/sdk-java/blob/657a392333e6d623fda91b1d7a0ea1f152f2eb9b/temporal-sdk/src/main/java/io/temporal/worker/WorkflowImplementationOptions.java#L68

For a TS equivalent, we could add `WorkerOptions.failWorkflowErrorTypes: Function[]`? So this would fail WE whenever `err instanceof Error`:

```ts
Worker.create({
  failWorkflowErrorTypes: [Error]
})
```

or any instances of `ExpectedErrorA` and `ExpectedErrorB` or their descendants:

```ts
Worker.create({
  failWorkflowErrorTypes: [ExpectedErrorA, ExpectedErrorB]
})
```

The one issue with `[Error]` is: If a user in Java wants to fail on anything thrown, they can pass `[Throwable]`. That can't be done with `[Error]`, because they might throw a non-Error (they might not even know they might throw a non-Error‚Äîeg they're using a library that throws a string). We could cover that case with something like:

```ts
// failWorkflowErrorTypes: Function[] | 'ALWAYS_FAIL'
Worker.create({ failWorkflowErrorTypes: 'ALWAYS_FAIL' })
```

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-02-14 18:25:41.000 UTC</summary>

Ah, we have it in retry policy: `nonRetryableErrorTypes: ['Error']`

https://typescript.temporal.io/api/classes/proto.temporal.api.common.v1.RetryPolicy#nonretryableerrortypes

which we can set when proxying an Activity or starting a Workflow. Wondering whether we'd like something more global, like per Worker (the easiest / most global, and perhaps best satisfying [this user's request](https://temporaltechnologies.slack.com/archives/C02KYBDUCQZ/p1644784493007749)) or per Workflow implementation. Java's `setFailWorkflowExceptionTypes` looks like per Workflow Implementation. 

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-14 22:57:02.000 UTC</summary>

Update: talked with Roey‚Äîdecided against an equivalent, instead providing interceptors as the more powerful/flexible (albeit more LoC) alternative: https://docs.temporal.io/docs/typescript/handling-failure#pattern-wrapping-errors-with-interceptors

</details>


---

<a id="470"></a>

### #470: [Feature Request] TerminatedFailure missing "details"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/470 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2022-02-08 18:47:25.000 UTC (3y 11m ago) |
| **Updated** | 2024-12-17 21:30:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

`terminate` accepts "details", which are present on `WorkflowExecutionTerminatedEventAttributes` even though they aren't present on `TerminatedFailureInfo`.

### Describe the solution you'd like

We should make the details available.

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-02-08 19:11:27.000 UTC</summary>

For client, can update here, like canceled above: https://github.com/temporalio/sdk-typescript/blob/67526d3a9effaea51d9aac3573ba2f8c9d3e1bab/packages/client/src/workflow-client.ts#L400-L410 

For proto serialization, we generate code based on protos from core, which come from `/api`, which is missing details: 

https://github.com/temporalio/api/blob/5c7111f395324103bf630d6a211279adbfb5e418/temporal/api/failure/v1/message.proto#L52-L53

PR to add it: 

https://github.com/temporalio/api/pull/150

</details>

<details>
<summary><strong>cretz</strong> commented on 2022-02-09 17:26:36.000 UTC</summary>

Note, we should probably also accept arguments as part of `WorkflowHandle.terminate`

</details>


---

<a id="459"></a>

### #459: [Bug] Fix & document which errors cause Workflow Execution failure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/459 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-02 18:10:09.000 UTC (3y 11m ago) |
| **Updated** | 2022-02-02 18:21:08.000 UTC |
| **Closed** | 2022-02-02 18:15:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Errors list: https://docs.temporal.io/docs/typescript/handling-failure#failure-classes-reference

Currently, throwing `TemporalFailure` or `ApplicationFailure` with `nonRetryable: true or false` inside a Workflow results in a `WorkflowExecutionFailed` event. I imagine at least in the `nonRetryable: false` case, and perhaps `TemporalFailure` and others, it should just be a `WorkflowTaskFailed` event. It's a `WorkflowTaskFailed` event when a plain object or `Error` instance is thrown.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-02-02 18:15:25.000 UTC</summary>

Throwing a TemporalFailure from workflow code should fail the workflow.
This is by design.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-02-02 18:21:08.000 UTC</summary>

Oh, retry policy is for `WorkflowExecutionFailed`s, not for `WorkflowTaskFailed`, got it. I misread TS docs.

</details>


---

<a id="450"></a>

### #450: [Bug] workflows wont launch on Windows if project folder starts with 'n'

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/450 |
| **State** | CLOSED |
| **Author** | yoDon (Don Alvarez) |
| **Created** | 2022-01-24 20:48:34.000 UTC (3y 11m ago) |
| **Updated** | 2022-04-28 21:32:53.000 UTC |
| **Closed** | 2022-04-28 21:32:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Renaming a project folder on Windows causes `npm run dev` to succeed or fail in the temporal worker launcher depending on whether the first letter of the directory name is an `n`. This issue prevents the nextjs-ecommerce-oneclick sample from running on Windows, but if you rename the folder to (for example) ecommerce-nextjs-oneclick the sample runs correctly under Windows.

### Describe the bug

When a project directory starts with an n, (like nextjs-ecommerce-oneclick in the samples-typescript repo), the code in [start:worker] on Windows incorrectly constructs the absolute path to workflows.js leaving out the slash between the project directory (nextjs-ecommerce-oneclick) and the parent of the project directory (samples-typescript) because it's treating the \ windows directory separator character and the n at the start of the project directory name as an offending \n to be stripped out (both the \ and the n are stripped from the constructed path).

### Minimal Reproduction

You can see this issue for example on a fresh clone of the samples-typescript repo when trying to run the nextjs-ecommerce-oneclick sample on Win11 running under Windows rather than under WSL. Renaming the nextjs-ecommerce-oneclick folder to ecommerce-nextjs-oneclick works around the issue and allows `npm run dev` to run without issue.

The error message is of the form:
```
[start:worker] 2022-01-24T00:52:35.620Z [ERROR] ERROR in ../../../../src/main.js
[start:worker] 2022-01-24T00:52:35.620Z [ERROR] Module not found: Error: Can't resolve 'C:\Path1\Path2\samples-typescriptextjs-ecommerce-oneclick\temporal\lib\workflows.js' in '/src'
```

If you look at the mangled path in the error message, you'll see something has incorrectly stripped the two characters `\n` from the desired `samples-typescript\nextjs-ecommerce-oneclick` leaving the malformed `samplestypescriptextjs-ecommerce-oneclick`.

### Environment/Versions

I'm seeing this issue under Windows 11 but I suspect it impacts all versions of Windows. WSL does not exhibit this issue because it does not use `\` as a path separator.

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (2)

<details>
<summary><strong>yoDon</strong> commented on 2022-01-25 00:16:41.000 UTC</summary>

As an additional, possibly related path-mangling issue, when I try to run under Windows a WIP sample from @lorensr at https://github.com/lorensr/next.js in the branch update-temporal and folder examples/with-temporal, I see an error message that looks like something is prepending a `/` in front of a path that starts with `C:`, resulting in an invalid `/C:` drive specifier.

For that repo, you need to `npm i` and then launch three terminals running

- `npm run dev`
- `npm run build:worker.watch` (there's a typo in the project readme, this is the correct command)
- `npm run start:worker` (again there's a typo in the project readme, the readme suggests `-`'s where there should be `:`'s)

The error message with the problematic path in the first line is:
```
Error: ENOENT: no such file or directory, stat '/C:/path1/path2/lorensr-nextjs/next.js/examples/with-temporal/temporal/src/workflows.ts'
    at Object.statSync (node:fs:1536:3)
    at resolveNodeModulesPaths (C:\path1\path2\lorensr-nextjs\next.js\examples\with-temporal\node_modules\@temporalio\worker\src\worker-options.ts:269:27)
    at addDefaultWorkerOptions (C:\path1\path2\lorensr-nextjs\next.js\examples\with-temporal\node_modules\@temporalio\worker\src\worker-options.ts:295:32)
    at Function.create (C:\path1\path2\lorensr-nextjs\next.js\examples\with-temporal\node_modules\@temporalio\worker\src\worker.ts:187:73)
    at file:///C:/path1/path2/lorensr-nextjs/next.js/examples/with-temporal/temporal/src/worker.ts:12:29
```

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-04-27 20:59:07.000 UTC</summary>

This is an issue in [dedent](https://github.com/dmnd/dedent/issues/34). And according to [dedent's code](https://github.com/dmnd/dedent/blob/77673fef42c0374e744df868ba1b2829a5aa4781/dedent.js#L45-L49), the author sees this as a feature, not a bug.

I think the correct solution would be to replace `dedent` by some alternative (eg. [ts-dedent](https://www.npmjs.com/package/ts-dedent)).

</details>


---

<a id="440"></a>

### #440: [Feature Request] Provide/use default retry policy 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/440 |
| **State** | CLOSED |
| **Author** | zomble (Paul Croker) |
| **Created** | 2021-12-30 07:44:10.000 UTC (4 years ago) |
| **Updated** | 2021-12-31 01:44:38.000 UTC |
| **Closed** | 2021-12-31 01:44:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

When omitting a retry policy on an activity and the activity fails the workflow will fail with:

Activity task timed out and retryState: RetryPolicyNotSet

Which is correct if there isn't a retry policy. However ActivityOptions.retry comments talks about using server-defined default. Which is mentioned a lot through temporal docs, and other temporal SDK's.

### Describe the solution you'd like

Use the same default values the golang sdk does? Or what is described here: https://docs.temporal.io/docs/content/what-is-a-retry-policy/

#### Comments (2)

<details>
<summary><strong>swyxio</strong> commented on 2021-12-30 12:37:38.000 UTC</summary>

this is either a temporary bug, or you are writing some funky code which you should add to your issue. many of our code samples, including hello world, do not specify retry policy, therefore relying on default retry policy. this is a very basic thing so if you found a bug we need a repro here. can you share some code, or a minimal repro (take our hello world and modify it to repro)?

</details>

<details>
<summary><strong>zomble</strong> commented on 2021-12-31 01:44:38.000 UTC</summary>

Hey, after a sleep, and rereading the history, and playing around. A default policy is indeed being set, and it does match the default policy.



</details>


---

<a id="435"></a>

### #435: [Feature Request] Make binary the default protobuf data converter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/435 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-12-25 02:40:02.000 UTC (4 years ago) |
| **Updated** | 2023-01-10 17:50:52.000 UTC |
| **Closed** | 2023-01-10 17:50:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Currently, we follow the Go SDK's default data converter encoding order, which puts JSON first.

https://github.com/temporalio/sdk-go/blob/5e5645f0c550dcf717c095ae32c76a7087d2e985/converter/default_data_converter.go#L28

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Putting binary first would be more efficient.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

Change should be made in all SDKs at the ~same time, so that users who use multiple SDKs and depend on the ordering matching can update all SDKs at the same time.

### Blocked by:

- Java SDK hasn't yet implemented a binary protobuf payload converter. https://github.com/temporalio/sdk-java/blob/0da3149c8eb16454c30fb7bda32d28f2539f3f3c/temporal-sdk/src/main/java/io/temporal/common/converter/DefaultDataConverter.java#L44-L49
- Temporal UI doesn't yet decode binary protobuf messages


#### Comments (2)

<details>
<summary><strong>cretz</strong> commented on 2022-01-03 15:01:49.000 UTC</summary>

I disagree with this change as I find that the clarity of JSON outweighs the slight efficiency of it. UI is not the only place payload bytes may be viewed. Is this solving an efficiency problem that is really a problem or is it predicting one? And by "efficiency" are you referring to storage size only or serialization speed as well? If storage size is the only concern, there are other potential options too.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-01-08 04:53:09.000 UTC</summary>

This is a suggestion from @bergundy. I know of no users with such an issue. I imagine it's not about a *problem* and more an impulse toward reducing resources used/load in the system‚ÄîI think mainly lower storage space, but there might also be small improvements in network transfer time and serialization speed. 

I'm not familiar with the other places users view payloads, but if it's a common occurrence, I like JSON. My personal preference is usually DX over efficiency.

</details>


---

<a id="406"></a>

### #406: [Bug] Poor error message running sleep() in a Node script

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/406 |
| **State** | CLOSED |
| **Author** | JoshuaKGoldberg (Josh Goldberg ‚ú®) |
| **Created** | 2021-11-28 10:36:54.000 UTC (4y 1m ago) |
| **Updated** | 2022-11-23 22:17:01.000 UTC |
| **Closed** | 2022-11-23 22:17:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

### To Reproduce

Run `node` on a file with these contents:

```
import { sleep } from "@temporalio/workflow";

await sleep("100 ms");
```

### Expected behavior

An error message something like:

```
Workflow commands may only be run from within a workflow.
```

### Screenshots/Terminal output

```
/mnt/c/Code/temporal-slack-adventure-bot-2/node_modules/@temporalio/workflow/lib/cancellation-scope.js:117
        return exports.storage.getStore() ?? exports.ROOT_SCOPE;
                               ^

TypeError: exports.storage.getStore is not a function
    at Function.current (/mnt/c/Code/temporal-slack-adventure-bot-2/node_modules/@temporalio/workflow/lib/cancellation-scope.js:117:32)
    at /mnt/c/Code/temporal-slack-adventure-bot-2/node_modules/@temporalio/workflow/lib/workflow.js:28:62
    at new Promise (<anonymous>)
    at timerNextHandler (/mnt/c/Code/temporal-slack-adventure-bot-2/node_modules/@temporalio/workflow/lib/workflow.js:27:12)
    at sleep (/mnt/c/Code/temporal-slack-adventure-bot-2/node_modules/@temporalio/workflow/lib/workflow.js:70:12)
    at file:///mnt/c/Code/temporal-slack-adventure-bot-2/src/repro.mjs:3:7
    at ModuleJob.run (node:internal/modules/esm/module_job:185:25)
    at async Promise.all (index 0)
    at async ESMLoader.import (node:internal/modules/esm/loader:281:24)
    at async loadESM (node:internal/process/esm_loader:88:5)
```

### Versions

<!-- Please complete the following information where relevant. -->

- OS: [e.g. Mac, Windows, Linux]: WSL 2.0 Ubuntu
- Temporal Version 0.16.x of the TypeScript SDK
- Are you using Docker or Kubernetes or building Temporal from source?: Docker



#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2021-11-28 22:31:59.000 UTC</summary>

> Workflow commands may only be run from within a workflow.

I like it‚Äîsounds like a helpful message to see for all `@temporal/workflow` exports used outside of an isolate. Maybe:

Error: This function is meant to be used inside Workflow code. Workflow code should only be run by the Worker (and is provided to the Worker via either the `workflowsPath` or `workflowBundle` option).


Reactions: üëç 1

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-23 22:17:01.000 UTC</summary>

Closing in favor of #553.

</details>


---

<a id="390"></a>

### #390: WorkerOptions.interceptors.workflowModules might not be available if workflows are pre-bundled

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/390 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-16 15:35:28.000 UTC (4y 1m ago) |
| **Updated** | 2021-12-09 21:01:58.000 UTC |
| **Closed** | 2021-12-09 21:01:58.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Describe the bug

At the moment workflow interceptors are passed into the bundler in order for webpack to include them (using webpack magic import comments).
They're also required to be provided in WorkerOptions to be actually loaded the workflow runtime.
This double requirement is not optimal since the worker might not have the workflows available in the file system on startup (in case it is using a workflows bundle).

To clarify, the issue is that `require.resolve` might not work in the pre-bundled worker process.

### Expected behavior

One way to get around this is to store the list of workflow interceptor modules at bundling time and load those too.
Another is to automatically load anything in the workflow bundle, this option feels cleaner since the paths only need to be specified once.


---

<a id="379"></a>

### #379: [Bug] "npm install" fails on windows, msvc 2017, ...

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/379 |
| **State** | CLOSED |
| **Author** | cons0l3 (Carsten Steckel) |
| **Created** | 2021-11-11 15:04:14.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-17 15:25:11.000 UTC |
| **Closed** | 2021-11-17 15:25:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Hi all,

I am coming from trying out the temporial samples for typescript and have filed a [bug](https://github.com/temporalio/samples-typescript/issues/61#issue-1050816961) over there.

After installing all dependencies as described in the readme of this project, running of `npm install` fails on windows 10, msvc 2017, node 16, rust 1.56.

I could identify three issues:
1) packages/core-bridge package.json build-rust script is not cross OS
2) core-bridge scripts/build.js calls a cargo-cp-artifact via OS spawn, which is not cross OS
3) packages/worker compile throws:
```
npm ERR! Die Projekte in dieser Projektmappe werden nacheinander erstellt. Um eine parallele Erstellung zu erm√∂glichen, m√ºssen Sie den Schalter "-m" hinzuf√ºgen.
npm ERR!   workflow-isolate-extension.cc
npm ERR! ~\my-project-name\node_modules\isolated-vm\src\lib\thread_pool.h(17,55): warning C4003: Nicht gen√ºgend Argumente f√ºr den Aufruf des funktions√§hnlichen Makros "max". [~\my-project-name\node_modules\@temporalio\worker\build\temporalio-workflow-isolate-extension.vcxproj]       
npm ERR! ~\my-project-name\node_modules\isolated-vm\src\lib\thread_pool.h(17,55): error C2589: "(": Ung√ºltiges Token auf der rechten Seite von "::" [~\my-project-name\node_modules\@temporalio\worker\build\temporalio-workflow-isolate-extension.vcxproj]
npm ERR! ~\my-project-name\node_modules\isolated-vm\src\lib\thread_pool.h(17): error C2062: "unknown-type"-Typ unerwartet [~\my-project-name\node_modules\@temporalio\worker\build\temporalio-workflow-isolate-extension.vcxproj]
npm ERR! ~\my-project-name\node_modules\isolated-vm\src\lib\thread_pool.h(17,22): error C2059: Syntaxfehler: ")" [~\my-project-name\node_modules\@temporalio\worker\build\temporalio-workflow-isolate-extension.vcxproj]
```

### To Reproduce

setup Windows 10 (21H1), 
node 16 (via nvm install 16 && nvm use 16), 
rustup (cargo 1.56, rustc 1.56.1), 
vs 2017 (via choco visualstudio2017-workload-vctools visualstudio2017buildtools)

### Expected behavior

`npm install` and `npm test` run on Windows environment successfully (with the appropriate dependencies)


#### Comments (2)

<details>
<summary><strong>cons0l3</strong> commented on 2021-11-11 15:50:20.000 UTC</summary>

I have the required changes in [my fork](https://github.com/cons0l3/sdk-typescript) ready for a PR. Please advice, how to proceed.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-11 16:25:42.000 UTC</summary>

This is great, we've had an outstanding issue to support windows build for a while now #12.
PR will be very welcome.

</details>


---

<a id="375"></a>

### #375: Improve error message: 'foo' is not a function

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/375 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-10 23:04:29.000 UTC (4y 2m ago) |
| **Updated** | 2023-01-23 23:46:08.000 UTC |
| **Closed** | 2023-01-23 23:46:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Problem

When a Worker doesn't have the right Workflow code, it returns a result with an error message that says eg [`'progress' is not a function`](https://user-images.githubusercontent.com/251288/140634770-d4c6d5bc-adc2-4d5e-bdaa-9214231e3836.png) from https://github.com/temporalio/samples-typescript/issues/56.

### Solution

Instead, say something like:

```
The Worker process that picked up this task doesn't have a Workflow function named 'progress' in its bundle. For more information and possible causes, see: 

[docs URL]
```

so that in the future we can easily update the wiki page, and users of old versions of the SDK will see the updated page.

The docs page could say:

```
The Worker process that picked up this task doesn't have a Workflow function named 'foo' in its bundle. 
The issue might be:

- There's a typo in the Workflow function name.
- The Workflow function isn't exported.
- The entry point (`workflowsPath`) is incorrect.
- You have more Worker processes than you realize polling on the 'tutorial' queue. For instance, a process in another shell or in the background that has an old version of the Workflow code bundle or that's from a different Temporal project. You can check with `ps` or `tctl tq desc --tq tutorial`.
```

Migrated from #359


#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-03-29 15:46:48.000 UTC</summary>

Can also list the functions that are exported

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-07-14 22:12:05.000 UTC</summary>

Let's just list the functions that are exported

</details>


---

<a id="374"></a>

### #374: [Feature Request] Add aarch64-unkown-linux-gnu to list of build targets for Rust Core

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/374 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-10 22:46:57.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-11 03:23:04.000 UTC |
| **Closed** | 2021-11-11 03:23:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Mostly to support building containers on M1 macs

#### Comments (2)

<details>
<summary><strong>cretz</strong> commented on 2021-11-10 23:00:28.000 UTC</summary>

Depending on what system pieces these use, the `aarch64-apple-darwin` triple might be preferred for direct execution (i.e. not in containers). I am unsure though.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-11 02:24:01.000 UTC</summary>

We already target that triple, this is coming from a user that wants to build a docker container on an M1 mac.

</details>


---

<a id="359"></a>

### #359: [Feature Request] Improve error messages when the wrong worker is polling the queue

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/359 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-07 20:34:38.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-11 01:27:52.000 UTC |
| **Closed** | 2021-11-11 01:27:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Problem: in the below issue, I didn't know from the error messages what was wrong

https://github.com/temporalio/samples-typescript/issues/56

### Describe the solution you'd like

While this issue should help with this type of bug: https://github.com/temporalio/sdk-typescript/issues/305

I think it would still be helpful to improve the errors:

1. Error from the Worker that had the correct code (`Task not found when completing: status: NotFound, message: "Workflow executionsRow not found.`): Say what's going wrong in the Worker at a higher level and suggest possible reasons.
2. Client error (`Error: 4 DEADLINE_EXCEEDED: context deadline exceeded`: In lieu of logging it, we can log what we say here: 

https://docs.temporal.io/docs/typescript/troubleshooting/#grpc-call-timeouts-context-deadline-exceeded

Something like:

```
Error: gRPC timeout. 

This happens for a number of reasons: Network hiccups, timeouts that are too short, server overloaded.

This is not your fault and is likely indicative of an SDK bug. Please try to produce a minimal repro and we'll be glad to help:

https://github.com/temporalio/sdk-typescript/issues/new?assignees=&labels=bug&template=bug_report.md
```

3. Result message error from the Worker that didn't have the right code (`'progress' is not a function`): Instead say something like 

```
The Worker process that picked up this task doesn't have a Workflow function named 'progress' in its bundle. 
The issue might be:

- There's a typo in the Workflow function name.
- The Workflow function isn't exported.
- The entry point (`workflowsPath`) is incorrect.
- You have more Worker processes than you realize polling on the 'tutorial' queue. For instance, a process in another shell or in the background that has an old version of the Workflow code bundle or that's from a different Temporal project. You can check with `ps` or `tctl tq desc --tq tutorial`.
```

If we think the list of reasons might change in the future, we could alternatively do:

```
The Worker process that picked up this task doesn't have a Workflow function named 'progress' in its bundle. For more information and possible causes, see: 

[sdk-typescript wiki page URL]
```

so that in the future we can easily update the wiki page, and users of old versions of the SDK will see the updated page.

#### Comments (2)

<details>
<summary><strong>Sushisource</strong> commented on 2021-11-08 18:47:46.000 UTC</summary>

We might want to break up this issue into more actionable sub-pieces.

> `'progress' is not a function`

This error is totally improvable in the way you suggest.

-----


> `Error: 4 DEADLINE_EXCEEDED: context deadline exceeded`

This one can be better, the first sentence of the suggestion is at least a few of the reasons. However (and we should probably update the docs page on this too, I'll go make a PR) this piece:

> This is not your fault and is likely indicative of an SDK bug.

Is definitely not correct most of the time. Too short timeouts are not an SDK bug, they're a configuration issue. Your network being down is not an SDK bug, etc. You might see a timeout when making a query where the worker handling the query crashes, which can be b/c of a mistake in the user's query handler. 

All that to say producing a minimal repro is definitely a great way to go but "likely an SDK bug" is typically not the case, and we should probably give some other basic troubleshooting advice first.

----

I think making most of these sorts of things be links to docs pages is a good idea. No sense repeating ourselves.

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-11-11 01:27:51.000 UTC</summary>

> We might want to break up this issue into more actionable sub-pieces.

Good idea, thanks! Done.

</details>


---

<a id="344"></a>

### #344: [Bug] Retry worker connection when temporal server is down

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/344 |
| **State** | CLOSED |
| **Author** | emmanuelvlad (evlad) |
| **Created** | 2021-10-29 12:52:50.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-23 02:02:24.000 UTC |
| **Closed** | 2021-11-23 02:02:24.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

When running a worker while the temporal server is down, the worker throws a transport error and stops retrying to reconnect.
(#290 retries only if the temporal server was already up when running the worker)

### To Reproduce

Stop the temporal server
Run a worker

### Expected behavior

The worker should retry the connection to the temporal server without crashing

### Versions

- OS: Windows
- Temporal Version: 1.12.1
- Temporal SDK: 0.12.0
- Docker

### Additional context

Is there a way to disable the WARNs while the worker is retrying?
![](https://i.imgur.com/B8zhATq.png)



#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-11 15:08:58.000 UTC</summary>

We chose not to attempt to reconnect when worker starts to avoid a situation where workers are left idle in case of misconfiguration.

@Sushisource let's open this up and see if we want to change that.

@emmanuelvlad for now you can implement your own retry by wrapping `Worker.create` or `Core.install`.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:02:24.000 UTC</summary>

I'm closing for now because I feel like the current behavior is fine.
@emmanuelvlad we can keep discussing here if you'd like a different solution and can convince us.

</details>


---

<a id="318"></a>

### #318: [Feature Request] Improve workflow id documentation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/318 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2021-10-20 17:35:46.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-23 04:06:26.000 UTC |
| **Closed** | 2021-11-23 04:06:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

I noticed that the node-sdk docs seem to encourage letting temporal generate the workflow id, but there are lots of cases where that leads to trouble. The Concepts docs recommends providing a business-meaningful workflow id, which I think is better advice.

https://docs.temporal.io/docs/node/client/#workflow-handle-options

> Most users should do just fine with the autogenerated workflowId.

The problem with that statement is that while it is statistically true, there are a class of use cases where it is not suitable (e.g., the cases where signalWithStart is useful).

### Describe the solution you'd like

@sw-yx I suggest hinting that there is more to workflow id than meets the eye, and linking to the full description:
[Workflows | Temporal documentation](https://docs.temporal.io/docs/concepts/workflows#workflow-id)

### Additional context

I also think the node-sdk docs blur the distinction between createHandle and creating a new workflow - which is once again an important one when dealing with signalWithStart.


#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:07:10.000 UTC</summary>

@joebowbeer Is this addressed now in your opinion?
`workflowId` is now required in all `WorkflowClient` methods.

</details>

<details>
<summary><strong>joebowbeer</strong> commented on 2021-11-23 04:06:26.000 UTC</summary>

Addressed.

</details>


---

<a id="314"></a>

### #314: [Feature Request] Add missing continuedAsNewExecutionRunId to WorkflowInfo interface

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/314 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-19 18:17:00.000 UTC (4y 2m ago) |
| **Updated** | 2022-06-01 17:58:39.000 UTC |
| **Closed** | 2022-06-01 17:58:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

*No description provided.*

#### Comments (2)

<details>
<summary><strong>swyxio</strong> commented on 2021-10-19 20:40:45.000 UTC</summary>

from: Tiho: 
Tihomir Surdilovic  3 minutes ago
@Roey Berman @Shawn Wang i think you can  add parentId and parentRunId as well which is useful for child workflows if its possible

</details>

<details>
<summary><strong>swyxio</strong> commented on 2021-10-20 17:17:33.000 UTC</summary>

to document https://github.com/temporalio/documentation/pull/696 on close

</details>


---

<a id="309"></a>

### #309: [Request] split `createWorkflowHandle` into `getExistingWorkflowHandle`?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/309 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-19 10:02:24.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-30 00:11:42.000 UTC |
| **Closed** | 2021-10-30 00:11:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Describe the bug

currently createWorkflowHandle has overloaded behavior:

```ts
// create new workflow
client.createWorkflowHandle(workflowDef, wfOptions)

// retrieve existing workflow
client.createWorkflowHandle({ workflowId })
```

but when I pass in `client.createWorkflowHandle(workflowId)` by accident (instead of `client.createWorkflowHandle({workflowId})`, it gives confusing error `MissingWorkflowOptions.taskQueue` rather than guiding me towards the right answer.

suggest to 

1. split the second behavior to another function, `getExistingWorkflowHandle` 
2. in dev, run validation against the `workflowDef` and warn if it looks like a workflowId

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-19 15:43:47.000 UTC</summary>

Let's split this into a new function.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-30 00:11:41.000 UTC</summary>

Closed by #324 

</details>


---

<a id="294"></a>

### #294: [Feature Request] Support connecting to multiple server addresses from Core and optionally the Node gRPC client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/294 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-12 16:11:57.000 UTC (4y 3m ago) |
| **Updated** | 2023-05-11 17:13:35.000 UTC |
| **Closed** | 2023-05-11 17:13:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See original issue here: https://github.com/temporalio/sdk-go/issues/577

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:26:45.000 UTC</summary>

Noting that custom gRPC resolvers can be used to achieve this.
Those are marked as experimental in grpc-js and not exposed in the Core API.

</details>

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-11 17:13:18.000 UTC</summary>

Closing. Lack of demand.

</details>


---

<a id="282"></a>

### #282: [Bug] Unknown failure during querying complete workflow.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/282 |
| **State** | CLOSED |
| **Author** | siliconprime-hoanguyen |
| **Created** | 2021-10-06 08:35:05.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-12 15:32:56.000 UTC |
| **Closed** | 2021-10-12 15:32:56.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

```
    const { Connection, WorkflowClient } = require('@temporalio/client');
    const connection = new Connection({
      address: '54.193.125.26:7233', // this server is currently running at the moment of reporting
    });
    const client = new WorkflowClient(connection.service);
    const wf = client.createWorkflowHandle({ workflowId: '7b8c9ba1-0e33-4b87-93e7-eab949c57a6e-onboarding' });
    // Workflow is complete.
    const user1 = await wf.query.user();  // this is OK
    console.log(user1);
    const user2 = await wf.query.user();  // this returns error
    console.log(user2);
```
The error is

```
temporal-worker | 2021-10-06T08:13:39.689Z [WARNING] Poll resulted in WorkflowError, converting to a removeFromCache job { runId: 'cf4a8919-0403-42db-ba36-e3dc069aa513' }
temporal-worker | 2021-10-06T08:13:39.694Z [WARNING] [temporal_sdk_core::workflow::workflow_tasks] Attempted to complete activation for nonexistent run run_id="cf4a8919-0403-42db-ba36-e3dc069aa513"
```
### To Reproduce

Please refer to the above

### Expected behavior

The second query should be successful otherwise better error message is expected.

### Screenshots/Terminal output
<img width="718" alt="image" src="https://user-images.githubusercontent.com/12854955/136165974-ab0d6eda-52fe-4e5a-ad83-418c680bed91.png">

### Versions

```
    "@temporalio/client": "^0.8.0",
    "@temporalio/workflow": "^0.9.0",
   "@temporalio/worker": "^0.10.0",
```

- OS: Mac OS Catalina
- Temporal server is running on docker compose: https://github.com/temporalio/docker-compose
- Are you using Docker or Kubernetes or building Temporal from source? Docker

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (2)

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-06 16:39:52.000 UTC</summary>

@siliconprime-hoanguyen I believe this has already been fixed in core via https://github.com/temporalio/sdk-core/pull/199

The next release of the Node SDK will include the fix. Please let us know if you still have the issue then, or if you'd like to try against master sooner.

Reactions: üëç 1

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 15:32:56.000 UTC</summary>

Closing as this should be fixed in `main`, please verify after the next release.

</details>


---

<a id="263"></a>

### #263: [Feature Request] Dynamic Workflow signal and query handler registration

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/263 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-23 08:25:55.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-12 16:12:53.000 UTC |
| **Closed** | 2021-10-12 16:12:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

In the other SDKs there's a way to dynamically add signal handlers during Workflow execution.
This is useful for building DSLs on top of Temporal and can enable high level abstractions such as an awaitable Signal object (see @sw-yx's API [proposal](https://gist.github.com/sw-yx/333f14872482f6190bda482a275b1f48#file-3-signals-receiving-data-ts-L34)).

```ts
export const unblockWithSignal = async () => {
  let isBlocked = new QueryVariable('isBlocked', true /* initial value */);
  await new Signal('unblock');
  isBlocked.value = false;
};
```

### Describe the solution you'd like

expose 2 new functions in the `@temporalio/workflow` module:

`registerSignalHandler` and `registerQueryHandler`.

### Additional context

Note that using dynamic handlers implies loosing type safety when interacting with the Workflow via a handle.
This feature does not go into type safety or an alternative Workflow API, it is only mentioned here to explain the possibilities that open up.

#### Comments (2)

<details>
<summary><strong>swyxio</strong> commented on 2021-09-23 21:25:16.000 UTC</summary>

i think we are more agreed on the query stuff than the signals api but yes!

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 16:12:53.000 UTC</summary>

Not relevant anymore, we only have dynamic registration now.

</details>


---

<a id="261"></a>

### #261: Post-release: Update server version-feature mapping

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/261 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-09-22 18:37:47.000 UTC (4y 3m ago) |
| **Updated** | 2022-10-11 23:36:07.000 UTC |
| **Closed** | 2022-10-11 23:36:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

The fix we made to follow execution chains under the new model won't be used until we add node to the version mapping here:

https://github.com/temporalio/temporal/pull/1949/files#diff-b3797d690c398677a5a20c26925f78157dc5da1bf96316215d93ac26ecd7bd2bR59

Do that after our next release. We should also verify we are properly sending the SDK version info.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:12:04.000 UTC</summary>

@Sushisource I think we can update the mapping, right?

Also, as I've pointed out to @dnr [here](https://github.com/temporalio/temporal/pull/1949/files#r754761218) maybe we should send capabilities from the client instead.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:36:06.000 UTC</summary>

Closing this for now.

Opened this sdk-features issue to track SDKs sending client capabilities:
https://github.com/temporalio/sdk-features/issues/142

</details>


---

<a id="255"></a>

### #255: [Feature Request] Support history replay as exported from tctl and Temporal web

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/255 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-20 19:40:07.000 UTC (4y 3m ago) |
| **Updated** | 2022-01-24 22:40:53.000 UTC |
| **Closed** | 2022-01-24 22:40:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Other SDKs have the ability to replay exported Workflow history, this is a critical feature for Workflow debuggability.

### Describe the solution you'd like

Add an easy way to replay Workflow history against a given Worker.

### Additional context

Related: https://github.com/temporalio/sdk-java/pull/729

#### Comments (2)

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-07 23:30:01.000 UTC</summary>

We should probably do this in core, so we don't need to do it over and over. It should fit naturally into how I already do a lot of testing.

We'll just need to expose the mock poller API or something simpler that just constructs a core instance with a provided history, and uses the mock pollers under the hood.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-11 01:25:13.000 UTC</summary>

Agree, node should only expose a convenient API to use the replay.

</details>


---

<a id="242"></a>

### #242: [Feature Request] Change parameter order for injected functions?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/242 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-15 04:29:13.000 UTC (4y 3m ago) |
| **Updated** | 2022-11-23 22:35:52.000 UTC |
| **Closed** | 2022-11-23 22:35:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

It feels weird to me that `workflowInfo` is the first parameter, followed by the parameters defined in the interface. Anyone else agree? 

A. `workflowInfo` reminds me of context/options/info args that I'm used to being passed as the last optional parameter.
B. Having it first clashes more in my mind with the interface than if it were last. In both cases, the signature doesn't match, but if it's last, at least my assumption that the first arg will be `message` holds.

![image](https://user-images.githubusercontent.com/251288/133369912-78bdf8c8-5638-4a6b-b94b-b71685a2ba54.png)

![image](https://user-images.githubusercontent.com/251288/133369827-f967a525-98bd-41e2-9e97-c2ed65cba1ab.png)


#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-23 20:55:57.000 UTC</summary>

@lorensr It is probably too late for this change... WDYT?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2022-11-23 22:35:51.000 UTC</summary>

Yep

</details>


---

<a id="237"></a>

### #237: [Feature Request] Protobuf payload converter support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/237 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-14 08:47:12.000 UTC (4y 3m ago) |
| **Updated** | 2022-03-02 19:57:51.000 UTC |
| **Closed** | 2022-03-02 19:57:51.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

### Is your feature request related to a problem? Please describe.

To fully support cross language calls we need to support the json and binary protobuf payload types.

### Describe the solution you'd like

Implement a payload converter that supports reading and writing protobuf payloads and add that to the default data converter.

### Additional context

https://github.com/temporalio/sdk-java/blob/7ee9034bcfc8d56f6f5dad86ce211209f18f2697/temporal-sdk/src/main/java/io/temporal/common/converter/ProtobufPayloadConverter.java
https://github.com/temporalio/sdk-java/blob/7ee9034bcfc8d56f6f5dad86ce211209f18f2697/temporal-sdk/src/main/java/io/temporal/common/converter/ProtobufJsonPayloadConverter.java


---

<a id="197"></a>

### #197: [Bug] Cannot find module 'ms'

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/197 |
| **State** | CLOSED |
| **Author** | alex-dixon (Alex Dixon) |
| **Created** | 2021-08-22 17:19:23.000 UTC (4y 4m ago) |
| **Updated** | 2021-08-23 06:43:13.000 UTC |
| **Closed** | 2021-08-23 06:43:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Appears to happen when using @temporal/client and no other temporal libraries.

### To Reproduce
I don't have an example I can share. I'd expect a minimal example with @temporal/client only would trigger the same error.

### Screenshots/Terminal output
```
2021-08-22T15:57:32.140Z	undefined	ERROR	Uncaught Exception 	{
    "errorType": "Runtime.ImportModuleError",
    "errorMessage": "Error: Cannot find module 'ms'\nRequire stack:\n- /var/task/node_modules/@temporalio/workflow/lib/time.js\n- /var/task/node_modules/@temporalio/workflow/lib/internals.js\n- /var/task/node_modules/@temporalio/workflow/lib/workflow.js\n- /var/task/node_modules/@temporalio/workflow/lib/index.js\n- /var/task/node_modules/@temporalio/client/lib/workflow-client.js\n- /var/task/node_modules/@temporalio/client/lib/index.js\n- /var/task/lambdas/foo.js\n- /var/runtime/UserFunction.js\n- /var/runtime/index.js",
    "stack": [
        "Runtime.ImportModuleError: Error: Cannot find module 'ms'",
        "Require stack:",
        "- /var/task/node_modules/@temporalio/workflow/lib/time.js",
        "- /var/task/node_modules/@temporalio/workflow/lib/internals.js",
        "- /var/task/node_modules/@temporalio/workflow/lib/workflow.js",
        "- /var/task/node_modules/@temporalio/workflow/lib/index.js",
        "- /var/task/node_modules/@temporalio/client/lib/workflow-client.js",
        "- /var/task/node_modules/@temporalio/client/lib/index.js",
        "- /var/task/lambdas/foo.js",
        "- /var/runtime/UserFunction.js",
        "- /var/runtime/index.js",
        "    at _loadUserApp (/var/runtime/UserFunction.js:100:13)",
        "    at Object.module.exports.load (/var/runtime/UserFunction.js:140:17)",
        "    at Object.<anonymous> (/var/runtime/index.js:43:30)",
        "    at Module._compile (internal/modules/cjs/loader.js:1085:14)",
        "    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)",
        "    at Module.load (internal/modules/cjs/loader.js:950:32)",
        "    at Function.Module._load (internal/modules/cjs/loader.js:790:14)",
        "    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:76:12)",
        "    at internal/main/run_main_module.js:17:47"
    ]
}
```



### Versions
0.5.0




#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-23 06:38:34.000 UTC</summary>

That's odd, I see it in the package.json for that release: https://github.com/temporalio/sdk-node/blob/fe468fc338bd4863117489547e8f7a602bb08d35/packages/client/package.json#L19

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-23 06:43:13.000 UTC</summary>

I failed to reproduce this:
```shellsession
$ npm init -y
...
$ npm i @temporalio/client@0.5.0

added 33 packages, and audited 34 packages in 10s

1 package is looking for funding
  run `npm fund` for details

found 0 vulnerabilities
$ node
Welcome to Node.js v16.6.0.
Type ".help" for more information.
> require('@temporalio/client')
{
  defaultDataConverter: [Getter],
  defaultWorkflowClientOptions: [Getter],
  WorkflowClient: [Getter],
  QueryRejectedError: [Getter],
  WorkflowService: [Getter],
  LOCAL_DOCKER_TARGET: [Getter],
  defaultConnectionOpts: [Getter],
  Connection: [Getter],
  WorkflowExecutionTerminatedError: [Getter],
  WorkflowExecutionTimedOutError: [Getter],
  WorkflowExecutionFailedError: [Getter],
  WorkflowExecutionCancelledError: [Getter],
  WorkflowExecutionContinuedAsNewError: [Getter],
  addDefaults: [Getter],
  compileWorkflowOptions: [Getter]
}
```

Please reopen if you manage to reproduce this

</details>


---

<a id="184"></a>

### #184: Clarify Mac contributing set up instructions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/184 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-08-10 03:44:27.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-17 14:45:00.000 UTC |
| **Closed** | 2021-08-17 14:45:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

![image](https://user-images.githubusercontent.com/251288/128804711-65a74d0d-f4c5-4e07-b84d-70ace76979d7.png)

I followed the `Environment set up` instructions through `npm ci` and then tried `npm run build` and got `Error: could not find the `cargo` executable.`

<details>

```
npm run build

> typescript-sdk@ build /Users/me/gh/sdk-node
> lerna run --stream build

lerna notice cli v4.0.0
lerna info versioning independent
lerna info Executing command in 6 packages: "npm run build"
@temporalio/core-bridge: > @temporalio/core-bridge@0.2.0 build /Users/me/gh/sdk-node/packages/core-bridge
@temporalio/core-bridge: > npm run build-rust
@temporalio/create: > @temporalio/create@0.3.3 build /Users/me/gh/sdk-node/packages/create-project
@temporalio/create: > tsc --build
@temporalio/core-bridge: > @temporalio/core-bridge@0.2.0 build-rust /Users/me/gh/sdk-node/packages/core-bridge
@temporalio/core-bridge: > TEMPORAL_WORKER_FORCE_BUILD=true node ./scripts/build.js
@temporalio/core-bridge: Force build via TEMPORAL_WORKER_FORCE_BUILD env var
@temporalio/core-bridge: Compiling bridge { target: undefined }
@temporalio/core-bridge: Error: could not find the `cargo` executable.
@temporalio/core-bridge: You can find instructions for installing Rust and Cargo at:
@temporalio/core-bridge:     https://www.rust-lang.org/tools/install
@temporalio/core-bridge: Did not copy "cdylib:temporal_sdk_node_bridge"
@temporalio/core-bridge: /Users/me/gh/sdk-node/packages/core-bridge/scripts/build.js:56
@temporalio/core-bridge:     throw new Error(`Failed to build${target ? ' for ' + target : ''}`);
@temporalio/core-bridge:     ^
@temporalio/core-bridge: Error: Failed to build
@temporalio/core-bridge:     at compile (/Users/me/gh/sdk-node/packages/core-bridge/scripts/build.js:56:11)
@temporalio/core-bridge:     at Object.<anonymous> (/Users/me/gh/sdk-node/packages/core-bridge/scripts/build.js:107:5)
@temporalio/core-bridge:     at Module._compile (internal/modules/cjs/loader.js:1063:30)
@temporalio/core-bridge:     at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)
@temporalio/core-bridge:     at Module.load (internal/modules/cjs/loader.js:928:32)
@temporalio/core-bridge:     at Function.Module._load (internal/modules/cjs/loader.js:769:14)
@temporalio/core-bridge:     at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:72:12)
@temporalio/core-bridge:     at internal/main/run_main_module.js:17:47
@temporalio/core-bridge: npm ERR! code ELIFECYCLE
@temporalio/core-bridge: npm ERR! errno 1
@temporalio/core-bridge: npm ERR! @temporalio/core-bridge@0.2.0 build-rust: `TEMPORAL_WORKER_FORCE_BUILD=true node ./scripts/build.js`
@temporalio/core-bridge: npm ERR! Exit status 1
@temporalio/core-bridge: npm ERR! 
@temporalio/core-bridge: npm ERR! Failed at the @temporalio/core-bridge@0.2.0 build-rust script.
@temporalio/core-bridge: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
@temporalio/core-bridge: npm WARN Local package.json exists, but node_modules missing, did you mean to install?
@temporalio/core-bridge: npm ERR! A complete log of this run can be found in:
@temporalio/core-bridge: npm ERR!     /Users/me/.npm/_logs/2021-08-07T15_21_04_953Z-debug.log
@temporalio/core-bridge: npm ERR! code ELIFECYCLE
@temporalio/core-bridge: npm ERR! errno 1
@temporalio/core-bridge: npm ERR! @temporalio/core-bridge@0.2.0 build: `npm run build-rust`
@temporalio/core-bridge: npm ERR! Exit status 1
@temporalio/core-bridge: npm ERR! 
@temporalio/core-bridge: npm ERR! Failed at the @temporalio/core-bridge@0.2.0 build script.
@temporalio/core-bridge: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
@temporalio/core-bridge: npm WARN Local package.json exists, but node_modules missing, did you mean to install?
@temporalio/core-bridge: npm ERR! A complete log of this run can be found in:
@temporalio/core-bridge: npm ERR!     /Users/me/.npm/_logs/2021-08-07T15_21_05_005Z-debug.log
lerna ERR! npm run build exited 1 in '@temporalio/core-bridge'
lerna WARN complete Waiting for 1 child process to exit. CTRL-C to exit immediately.
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! typescript-sdk@ build: `lerna run --stream build`
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the typescript-sdk@ build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/me/.npm/_logs/2021-08-07T15_21_05_054Z-debug.log
```

</details>

After following [building.md instructions](https://github.com/temporalio/sdk-node/blob/main/docs/building.md) (and doing [lerna clean -f](https://github.com/temporalio/sdk-node/issues/176)), I'm now able to build.

Do all Macs need to do building.md instructions in order to `npm run build`, or just a subset of them? 

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-10 07:20:07.000 UTC</summary>

The fact that you needed to run `lerna clean -f` means that you probably missed a step on your first attempt.
Cross compilation is not required for contributing, it's only required for publishing the packages.
You should have had cargo installed if you'd finished the env setup.
Maybe we should conclude the setup part with a check `which cargo` to verify that everything was set up properly?
I'd also add a `Something isn't working, how do I reset my env` section where we mention `npx lerna clean -- -f && npm ci`.

Does that clarify things?

</details>

<details>
<summary><strong>lorensr</strong> commented on 2021-08-10 19:40:22.000 UTC</summary>

Yes, thanks!

</details>


---

<a id="172"></a>

### #172: [Bug] proto package depends on core-bridge

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/172 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-01 07:36:18.000 UTC (4y 5m ago) |
| **Updated** | 2021-10-13 02:08:50.000 UTC |
| **Closed** | 2021-10-13 02:08:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

`@temporalio/proto` consists solely of generated code from protobuf definitions in the `sdk-core` submodule that resides in the `@temporalio/core-bridge` package.
The dependency was added because lerna doesn't increment a package's version unless something changes in git.

Some possible solutions include moving the proto definitions into the proto package or add another package just for the `sdk-core` submodule.



#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-01 07:37:50.000 UTC</summary>

To be clear, we don't want this dependency because the client relies on the proto package while it shouldn't rely on core because of the Rust compilation dependency.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-10-12 19:46:01.000 UTC</summary>

Now using a single version for all SDK packages, the dependency can be safely removed.


</details>


---

<a id="170"></a>

### #170: Automate release process

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/170 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-27 09:12:44.000 UTC (4y 5m ago) |
| **Updated** | 2025-07-14 22:41:22.000 UTC |
| **Closed** | 2025-07-14 22:41:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See discussion here: [https://temporalio.slack.com/archives/C01DKSMU94L/p1624022063024000](https://temporalio.slack.com/archives/C01DKSMU94L/p1624022063024000)

- [ ] Automated release to `next` tag on merge to `main`



#### Comments (2)

<details>
<summary><strong>mjameswh</strong> commented on 2023-01-10 17:45:54.000 UTC</summary>

WIP in #1003

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2025-07-14 22:41:22.000 UTC</summary>

Looks like this should've been closed a while ago

</details>


---

<a id="168"></a>

### #168: [Feature Request] Discuss activity registration and imports

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/168 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-26 07:41:21.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-31 10:30:19.000 UTC |
| **Closed** | 2021-08-31 10:30:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Currently we use the following to import Activity functions as stubs in a Workflow.
```ts
import { myActivity } from '@activities/something';
// NOTE: `../activities` is not supported but that can be fixed
```

This is pretty convenient since provides implicit type safety

Another approach would be to use something like `ExternalDependencies`
`workflows/example.ts`
```ts
const { myActivity } = Context.activities<ActivityInterface>();
```
`worker/index.ts`
```ts
import * as activities from '../activities';
const worker = await Worker.create<{ activities: ActivityInterface }>({ activities });
```

Here we rely on an interface definition for type safety but it allows more flexibility in registration and it seems like there's less "magic" going on.

One other option that comes to mind is to have a single `@activities` file (e.g. `src/activities/index.ts` and disallow imports from `@activities/something`, this way we'd have unique activity registration without worrying about duplicates.

#### Comments (2)

<details>
<summary><strong>joebowbeer</strong> commented on 2021-08-17 09:43:07.000 UTC</summary>

The `@activities` idiom still strikes me as odd. I interpret this as a scoped import, declared as a dependency in package.json. I'd prefer if this were changed to something unambiguous and preferably explicit.

I'm also not keen about the automatic imports from the working directory. This seems concise and convenient for starter apps, but I want to see a more verbose and flexible layer provided for advanced users. Ideally, the simple style would be built on the complex layer.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-08-17 12:50:46.000 UTC</summary>

@joebowbeer I agree, this will change in the very near future.

</details>


---

<a id="167"></a>

### #167: [Feature Request] Implement stack trace query

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/167 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-26 07:30:27.000 UTC (4y 5m ago) |
| **Updated** | 2022-06-14 20:03:07.000 UTC |
| **Closed** | 2022-06-14 20:03:07.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | 1.0 |
| **Reactions** | üëç 1 |

#### Description

Need to figure out how to get all of the stack traces from the Workflow isolate


---

<a id="150"></a>

### #150: [Bug] CI fails when installing from verdaccio without any logs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/150 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-06 21:00:28.000 UTC (4y 6m ago) |
| **Updated** | 2022-10-11 23:23:01.000 UTC |
| **Closed** | 2022-10-11 23:22:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

As seen here: https://github.com/temporalio/sdk-node/runs/3001556342?check_suite_focus=true

Add logging for more information the next time this happens.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:22:50.000 UTC</summary>

This was fixed a while back.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:23:01.000 UTC</summary>

By @mjameswh 

</details>


---

<a id="130"></a>

### #130: [Feature Request] Custom data converters

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/130 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-18 19:54:27.000 UTC (4y 6m ago) |
| **Updated** | 2022-03-02 19:57:50.000 UTC |
| **Closed** | 2022-03-02 19:57:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

At the moment there is no way of customizing the Workflow data converter.
This is a complex problem because of Workflows run in isolation and do not have access to node libraries.

While we're tacking this problem we might want to make the data converter interface asynchronous to facilitate network requests and non-blocking compression.

Solution requires a proper proposal in the proposals repo.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-07-14 15:18:02.000 UTC</summary>

#158 changes the data converter interface to be async.
Only thing left in this issue is to figure out how to pass a custom data converter to the Workflow isolate, all other places (worker / client) support custom data converters.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-09-23 18:05:15.000 UTC</summary>

Removed from beta, we'll handle this soon after the release

</details>


---

<a id="101"></a>

### #101: [Feature Request] Use source maps for better stack traces in WF isolate code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/101 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-18 11:31:32.000 UTC (4y 7m ago) |
| **Updated** | 2022-03-02 05:41:14.000 UTC |
| **Closed** | 2021-08-31 14:03:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Is your feature request related to a problem? Please describe.**

Workflow stack traces show the compiled JS as sources instead of the TypeScript sources, this makes WF code hard to debug.

**Describe the solution you'd like**

Stack traces should include the source code the way they do in [ts-node](https://www.npmjs.com/package/ts-node).

**Additional context**

Currently we build the Workflow Isolate using Webpack from compiled JS files (`./lib`) instead of the TypeScript source (`./src`), this might need to change in order to provide proper sourcemaps.

#### Comments (2)

<details>
<summary><strong>lorensr</strong> commented on 2022-03-02 01:53:45.000 UTC</summary>

Is it possible to get workflow error stack traces with `src/*.ts` line numbers? I'm seeing `lib/*.js` in worker output:

@temporalio/test: 2022-03-02T01:47:43.406Z [WARN] [temporal_sdk_core::worker] Failing workflow activation run_id="453a299c-2334-4e7b-b581-8c3bbd216eac" failure=Failure { failure: Some(Failure { message: "Failed to convert value: str1", source: "TypeScriptSDK", stack_trace: "PayloadConverterError: Failed to convert value: str1\n    at toPayload (webpack-internal:///../common/lib/converter/payload-converter.js:60:15)\n    at eval (webpack-internal:///../common/lib/converter/payload-converter.js:78:34)\n    at Array.map (<anonymous>)\n    at toPayloads (webpack-internal:///../common/lib/converter/payload-converter.js:78:19)\n    at eval (webpack-internal:///../workflow/lib/workflow.js:118:52)\n    at new Promise (<anonymous>)\n    at scheduleActivityNextHandler (webpack-internal:///../workflow/lib/workflow.js:91:12)\n    at scheduleActivity (webpack-internal:///../workflow/lib/workflow.js:142:12)\n    at eval (webpack-internal:///../workflow/lib/workflow.js:314:24)\n    at twoStringsActivity (webpack-internal:///./lib/workflows/two-strings.js:13:26)", cause: None, failure_info: None }) }


</details>

<details>
<summary><strong>bergundy</strong> commented on 2022-03-02 05:41:14.000 UTC</summary>

You should get the sourcemaps if you use ts-node, I think there's another way though, I'd need to check.

Reactions: üëç 1

</details>


---

<a id="96"></a>

### #96: [Feature Request] Automated load testing

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/96 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-13 13:41:43.000 UTC (4y 8m ago) |
| **Updated** | 2021-09-28 23:48:21.000 UTC |
| **Closed** | 2021-09-28 23:48:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | enhancement |
| **Assignees** | Sushisource |
| **Milestone** | beta |

#### Description

The simple bench test stresses the system uncovering bugs that integration tests tend to miss.
Bench test should run on every PR, running against cloud will also test that passing an address and TLS options work.

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-06-28 23:27:47.000 UTC</summary>

@vkoby I just noticed we have this issue, please close once you're finished working on it.

</details>

<details>
<summary><strong>Sushisource</strong> commented on 2021-06-30 22:29:40.000 UTC</summary>

Include additional scenarios 

</details>


---

<a id="35"></a>

### #35: Set up logger for worker package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/35 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-11 09:39:57.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-24 08:38:09.000 UTC |
| **Closed** | 2021-03-24 08:38:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Consider using one of the popular nodejs loggers by default or allow injecting a custom logger with fallback to `console.error` .

#### Comments (2)

<details>
<summary><strong>swyxio</strong> commented on 2021-03-11 16:57:40.000 UTC</summary>

interesting. whats the benefit of allowing custom logger?

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-03-11 17:57:33.000 UTC</summary>

I feel like usually developers have their own logging stack and I'd like to have the option to plug into any logger. 

Reactions: üëç 1

</details>


---

<a id="6"></a>

### #6: Revisit cancellation and scopes design

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/6 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-02-24 14:47:05.000 UTC (4y 10m ago) |
| **Updated** | 2021-06-16 21:29:05.000 UTC |
| **Closed** | 2021-06-16 21:29:05.000 UTC |
| **Upvotes** | 1 |
| **Comments** | 0 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëç 1 |

#### Description

The design in https://github.com/temporalio/sdk-node/pull/5 was not agreed upon, we should revisit after the project restructuring.


---

<a id="1"></a>

### #1: Scheduler code style nit

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2020-12-16 20:19:44.000 UTC (5 years ago) |
| **Updated** | 2021-01-05 16:06:55.000 UTC |
| **Closed** | 2021-01-05 16:06:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 2 |
| **Priority Score** | 2 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

these are all nits - just a super minor suggestion, so minor i almost felt like i shouldnt open this but :shrug:

## nit 1

this line

https://github.com/temporalio/sdk-node/blob/c6be15507c245c831d19d81ec280e19f1b2ed5b9/src/scheduler.ts#L78

is doing a lot of logic - just a small piece of feedback that i historically have found these hard to debug and regretted writing such clever code - recommend breaking them up and assigning variables. 

## nit 2

https://github.com/temporalio/sdk-node/blob/c6be15507c245c831d19d81ec280e19f1b2ed5b9/src/scheduler.ts#L104 why 

i dont think understand why while(true) is here? are you trying to get around some weird bug with `eventIndex` that I cant see?

#### Comments (2)

<details>
<summary><strong>bergundy</strong> commented on 2021-01-05 14:39:15.000 UTC</summary>

@sw-yx I've greatly simplified the scheduler now that we don't have to mock out `Promise`.
Addressed the first nit.
As for the second one:
The scheduler might run out of events in case it's waiting for completions in which case it falls off the for loop and awaits the first completion.

</details>

<details>
<summary><strong>bergundy</strong> commented on 2021-01-05 14:40:17.000 UTC</summary>

Please close if you're satisfied with the changes and my answer.

Reactions: üëç 1

</details>


---

<a id="1811"></a>

### #1811: [Feature Request] Sticky Sessions Support in TypeScript SDK

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1811 |
| **State** | CLOSED |
| **Author** | jinvillaz (Jhonatan Villanueva) |
| **Created** | 2025-10-28 04:37:17.000 UTC (2 months ago) |
| **Updated** | 2025-12-01 19:32:07.000 UTC |
| **Closed** | 2025-12-01 19:32:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

# Proposal: Sticky Sessions Support in TypeScript SDK

Hi Temporal team,

First, thank you for all your work maintaining the Temporal SDKs ‚Äî they‚Äôve been incredibly helpful.

## Context

In the Go SDK, Temporal supports **sticky sessions** (sticky execution), which ensures that all tasks of a workflow are executed on the same worker.  This is especially important for workflows that maintain **local state** or process resources incrementally, such as downloading and processing a large file piece by piece.

Currently, the TypeScript SDK **does not have this feature**. If multiple workers are running, Temporal may distribute tasks of the same workflow across different workers, breaking workflows that depend on local state.  
Even in the official documentation, it is mentioned that sticky sessions are the recommended way to handle this type of workflow, but the feature is only implemented in Go.

## Proposed Solution

I have implemented a manual sticky execution mechanism in a NestJS project using the `nestjs-temporal-core` library and the TypeScript SDK.  

The key components are:

1. **WorkerRegistrationService** ‚Äì Registers workers, tracks workflow IDs, and manages worker availability.
2. **HeartbeatService** ‚Äì Sends periodic heartbeats, detects dead workers, and cleans up workflows that are no longer running.
3. **WorkflowBalancerService** ‚Äì Assigns workflows to available workers to ensure a workflow runs entirely on a single worker.

This approach currently runs in my own projects using a manual implementation in TypeScript, and it effectively ensures sticky execution for workflows that require it.  

This implementation introduces the concept of **worker capacity (`maxCapacity`)** to limit the number of workflows a worker can handle simultaneously.  In production environments, each worker runs on a host with finite CPU and memory. By tracking capacity manually, we ensure that workflows are only assigned
to workers with available resources, preventing overloading and maintaining predictable performance.  
This complements sticky execution: even if all tasks of a workflow remain on a single worker, we still need to respect its capacity limits. My implementation checks if a workflow with the same `workflowId` is already running, 
whether triggered manually or via a schedule, to prevent duplicate executions and ensure workflow consistency.


I propose to implement **native sticky sessions in the TypeScript SDK**, using this approach as a reference, so that it becomes an official feature that other developers can use easily without needing to implement it themselves.

## Benefits

- Provides workflow consistency for workflows that rely on local state and makes sticky execution available as a native feature.
- Eliminates the need for users to manually track workers and workflow assignments.
- Brings the TypeScript SDK closer to feature parity with the Go SDK.
- Ensures predictable performance by respecting worker capacity limits.

I would love for this feature to be implemented, ideally based on the approach I have already implemented in my own project.  If possible, I would be happy to create a PR to contribute this solution to the SDK.


Thank you for considering this proposal! Looking forward to your thoughts.

Regards
Jhonatan
jinvillaz@gmail.com


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-12-01 19:31:07.000 UTC</summary>

Thanks for offering your help on this. I greatly appreciate your thorough explanations of how you envision implementing this. I will, however, have to decline.

Adding Sessions support to other SDKs is something our team has discussed many times. We do recognize the practical value of that mechanism. To some extent, it is possible to achieve almost the same behavior with the [Worker Specific Task Queue](https://github.com/temporalio/samples-typescript/tree/main/worker-specific-task-queues) pattern, but it is quite daring to properly implement by users. User-land implementations of this pattern also have limited ability for controlling execution concurrency at the worker level, though things have significantly improved in that regard with the recent addition of Custom Slot Providers and Poller Behaviors.

So yes, we do intend to add Sessions support at some point. And when we do, we'll add it to _all_ of our official SDKs, not only TypeScript. That will, however, be a complete redesign of the feature. The experience acquired over time from usage of the Go implementation of Sessions demonstrates that the current design can't actually offer the kind of DX and operational guarantees that Temporal users expect, notably when it come to error-handling scenarios. These shortcomings are deeply rooted into the original design of Go's Sessions, and can only be fixed by holistically rethinking the whole feature.

For the moment, we can't provide intel regarding the prioritization or ETA of that feature.

By the way, this feature request is already tracked under temporalio/features#562. I'll close this one as a duplicate to make it easier for tracking. I'll copy/paste your description to the other thread. You are welcome to discuss over there.

</details>


---

<a id="1785"></a>

### #1785: [Bug] Remove peer dependencies from @temporalio/interceptors-opentelemetry

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1785 |
| **State** | CLOSED |
| **Author** | TastyPi (Graham Rogers) |
| **Created** | 2025-09-17 14:34:50.000 UTC (3 months ago) |
| **Updated** | 2025-10-29 17:15:28.000 UTC |
| **Closed** | 2025-10-29 17:15:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Depend on `@temporalio/interceptors-opentelemetry` in my app that uses `@temporalio/client`.


### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

When I run `yarn install` I get the following messages:

```
‚û§ YN0002: ‚îÇ my-package doesn't provide @temporalio/activity (p98051a), requested by @temporalio/interceptors-opentelemetry.
‚û§ YN0002: ‚îÇ my-package doesn't provide @temporalio/common (pd7eebd), requested by @temporalio/interceptors-opentelemetry.
‚û§ YN0002: ‚îÇ my-package doesn't provide @temporalio/worker (p41c8fb), requested by @temporalio/interceptors-opentelemetry.
‚û§ YN0002: ‚îÇ my-package doesn't provide @temporalio/workflow (pd62775), requested by @temporalio/interceptors-opentelemetry.
```

[`YN0002` is caused by missing peer dependencies](https://yarnpkg.com/advanced/error-codes#yn0002---missing_peer_dependency). To clear these messages, I would have to add dependencies on those other libraries. Except it does not make sense for my app that only uses `@temporalio/client` to depend on those other libraries (except maybe `@temporalio/common`).

The proper fix would be to not have these peer dependencies, or split `@temporalio/interceptors-opentelemetry` into separate packages for clients/workflows/activities.

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

Create an app that depends on `@temporalio/interceptors-opentelemetry` with Yarn.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux
- Temporal SDK Version: 1.13.0
- Yarn version: 4.9.4

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-09-29 21:40:59.000 UTC</summary>

No, those dependencies should not get removed, or users would get other kind of errors. And splitting each of these to different packages would make proper configuration of this much more difficult on users.

The correct thing to do would be to add a `peerDependenciesMeta.*.optional: true` entry for all `@temporalio/*` dependencies. That should be pretty easy. The tricky thing, however, is that we'll need to make sure that the code is prepared to detect missing packages at run time, and handle these gracefully.

</details>


---

<a id="1783"></a>

### #1783: `WorkflowIdReusePolicy.TERMINATE_IF_RUNNING` deprecated or not?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1783 |
| **State** | CLOSED |
| **Author** | cliaer (Claire Lee) |
| **Created** | 2025-09-11 20:30:00.000 UTC (3 months ago) |
| **Updated** | 2025-12-18 20:41:05.000 UTC |
| **Closed** | 2025-12-18 20:41:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

`WorkflowIdReusePolicy.TERMINATE_IF_RUNNING` is listed as a valid option in the [Temporal.io docs](https://docs.temporal.io/workflow-execution/workflowid-runid#workflow-id-reuse-policy), but [in-line code docs](https://github.com/temporalio/sdk-typescript/blob/9089bc682b4334287e52cd0bdb4547836f63e335/packages/common/src/workflow-options.ts#L38-L46) show that it is deprecated and recommends to use a combination of `WorkflowIdReusePolicy` and `WorkflowIdConflictPolicy`.

I would like clarification on this discrepancy, and whether or not I can continue using the `TERMINATE_IF_RUNNING` ReusePolicy.

My intention is to use it for a child workflow whose parent workflow is reset (I would like the child to also stop upon reset and re-execute with the parent, and keep the same workflowIds). Similar discussion found in [this thread](https://github.com/temporalio/sdk-typescript/issues/1628#issuecomment-2672959241), where it is clarified that the server does not support conflict policies for child workflows.

Currently, it looks like the only way I can configure this behaviour is with `WorkflowIdReusePolicy.TERMINATE_IF_RUNNING`. Do I have any other options when it comes to child workflows?

(moved from the [temporalio/temporal repo](https://github.com/temporalio/temporal/issues/8314))

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-12-18 20:41:05.000 UTC</summary>

Thanks for pointing out this discrepancy.

`WorkflowIdReusePolicy.TERMINATE_IF_RUNNING` is indeed deprecated, even though some references to it still haven't been updated. We [just fixed](https://github.com/temporalio/api/pull/681) the upstream API to clarify this. Any doc or sample that still refers to that option will be pruned soon.

Now, you're right that child workflows do not accept the conflict policy option. Even though that option has been deprecated, the server still accepts terminate as a reuse policy. I don't think you really have an alternative at this time, unfortunately, but I also don't think that the "parent workflow reset" use case provides a justification that is strong enough to revert the deprecation of the terminate WID reuse policy.

In any case, we have no intent of actually removing that option support in the server at any time. The deprecation of that API simply communicates the message that usage of this API is strongly discouraged, because a better alternative exists for normal use case. But in the rare use case for which there is no blessed, exact equivalent of the legacy API, using there is no risk in keeping your existing code as is.

</details>


---

<a id="1756"></a>

### #1756: [Bug] Hostname is overly restrictive

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1756 |
| **State** | OPEN |
| **Author** | Dispersia (Aaron Housh) |
| **Created** | 2025-08-05 20:21:45.000 UTC (5 months ago) |
| **Updated** | 2025-08-05 20:56:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

My temporal instance is hosted behind a reverse proxy at a subpath /temporal

### Describe the bug

Temporal and Temporal UI allows this just fine and it works as expected, but the typescript SDK attempts to normalize it and only allows hostname or hostname:port, which prevents being able to connect to an instance.

### Minimal Reproduction

Host temporal grpc frontend behind a subpath, try to connect


#### Comments (1)

<details>
<summary><strong>Dispersia</strong> commented on 2025-08-05 20:56:54.000 UTC</summary>

 I just noticed it doesn't seem to work with a reverse proxy at all. Using Caddy, even at a DQN i get it can't create a native client.

</details>


---

<a id="1726"></a>

### #1726: Condition callback function is not support Promise return in type

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1726 |
| **State** | CLOSED |
| **Author** | liho00 (LiHo) |
| **Created** | 2025-06-13 07:47:20.000 UTC (7 months ago) |
| **Updated** | 2025-06-30 21:00:22.000 UTC |
| **Closed** | 2025-06-30 21:00:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Actual behavior
condition(fn, timeout): Promise<boolean>
fn | () =>¬†boolean

```
  const success = await condition(
    async () => {         <---------------- why this line not support typescript?
    },
    {
      timeout: `1s`,
      interval: `1s`,
    }
  );
```

https://typescript.temporal.io/api/namespaces/workflow#condition


Expected behavior
condition(fn, timeout): Promise<boolean>
fn | () =>¬†Promise<boolean>

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-13 16:13:05.000 UTC</summary>

The function argument passed to `condition` can't be asynchronous, and must return a boolean. Typical usage is that `fn` is an inline function that returns the value of a local boolean variable, or to return either some array is empty/not empty. See [this sample](https://github.com/temporalio/samples-typescript/blob/main/mutex/src/workflows.ts), at lines 33 and 55.

Also, the second argument to `condition`, i.e. `timeout`, is a single string value, not an object. So you would have something like `await condition(fn, '1s')`.

</details>


---

<a id="1701"></a>

### #1701: [Bug] @temporalio/worker: NativeConnection fails with NativeCertsNotFound on Temporal Cloud connection using API Key

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1701 |
| **State** | CLOSED |
| **Author** | harukitosa (Haruki Tosa) |
| **Created** | 2025-04-30 04:03:03.000 UTC (8 months ago) |
| **Updated** | 2025-04-30 05:57:45.000 UTC |
| **Closed** | 2025-04-30 05:57:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to connect a Temporal Worker (using the TypeScript SDK) running in my local environment to a namespace on Temporal Cloud using **only** API key authentication. My understanding, based on the documentation, is that only an API key should be required for authentication credentials on the client-side.

### Describe the bug

When attempting to connect to Temporal Cloud (which requires TLS) using `NativeConnection` from `@temporalio/worker`, the connection fails with the following `TransportError: tonic::transport::Error(Transport, NativeCertsNotFound)`:

```
Connecting to Temporal server... TransportError: tonic::transport::Error(Transport, NativeCertsNotFound)     at NativeConnection.connect (/usr/src/app/systems/journey/node_modules/@temporalio/worker/lib/connection.js:58:23)     at async run (/usr/src/app/systems/journey/packages/jobworker/lib/worker.js:44:24)
```

This error occurs during the **TLS handshake phase**, before the API key is likely used for authentication. Specifically, it indicates that the root CA certificates required to validate the Temporal Cloud server's TLS certificate cannot be found by the Worker's execution environment.

In contrast, using `Connection` from `@temporalio/client` with the same connection details (endpoint, namespace, API key) successfully connects to Temporal Cloud. This suggests that `Connection` is able to properly utilize the system's certificate store.

```typescript
import { NativeConnection } from '@temporalio/worker';
// NativeConnection fails during TLS handshake with NativeCertsNotFound

import { Connection } from '@temporalio/client';
// Connection succeeds with both TLS connection and API key authentication
```

The connection configuration is based on the Temporal Cloud documentation regarding API keys:
[https://docs.temporal.io/cloud/api-keys#typescript-sdk-v-1100](https://docs.temporal.io/cloud/api-keys#typescript-sdk-v-1100)

### Minimal Reproduction

(The following code should reproduce the issue)

1.  Create a simple Worker project using the Temporal TypeScript SDK (`@temporalio/worker` v1.11.6).
2.  Configure the `NativeConnection` options with your Temporal Cloud details (namespace.tmprl.cloud:7233), namespace, and a generated API key. Include `tls: true` or `tls: {}` in the options.
    ```typescript
        console.log('Connecting to Temporal server...');
        const connection = await NativeConnection.connect({
          address: process.env.TEMPORAL_ADDRESS || 'localhost:7233',
          tls: true,
          // TLS and gRPC metadata configuration goes here.
          apiKey: "xxx",
          metadata: {
            'temporal-namespace': "xxx",
          },
        });
        console.log('Connected to Temporal server');
    ```
3.  Run this Worker in an environment where root certificates might not be readily accessible

### Environment/Versions

-   **OS and processor:** [Please fill in, e.g., M1 Mac, x86 Windows, Linux (Distro/Version)]
-   **Temporal SDK Version:**
    -   `@temporalio/activity`: `^1.11.6`
    -   `@temporalio/client`: `^1.11.6`
    -   `@temporalio/worker`: `^1.11.6`
    -   `@temporalio/workflow`: `^1.11.6`
-   **Are you using Docker or Kubernetes or building Temporal from source?** [Please fill in: Docker / Kubernetes / Source / Other, and provide details like Docker image name/version if applicable]

### Additional context

-   Connecting to Temporal Cloud requires TLS. While the API key is used for *authentication*, a secure TLS connection must be established first, which involves validating the server's certificate.
-   The `NativeCertsNotFound` error indicates a problem during this TLS connection setup phase (failure to find root CA certificates), not an issue with the API key authentication itself.
-   Since `Connection` from `@temporalio/client` works successfully, it suggests that the API key, network path, and basic TLS configuration (`tls: true`) are likely correct.
-   The problem is likely specific to how `NativeConnection` interacts with the TLS certificate store in the environment where it's running.


#### Comments (1)

<details>
<summary><strong>harukitosa</strong> commented on 2025-04-30 05:56:08.000 UTC</summary>

üôèhttps://github.com/temporalio/sdk-typescript/issues/1584

</details>


---

<a id="1688"></a>

### #1688: [Feature Request] Warn when the server-provided task start time is fairly different than time SDK begins processing the task

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1688 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-04-22 12:21:32.000 UTC (8 months ago) |
| **Updated** | 2025-09-23 20:07:55.000 UTC |
| **Closed** | 2025-09-23 20:07:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/616

#### Comments (1)

<details>
<summary><strong>Sushisource</strong> commented on 2025-09-23 20:07:55.000 UTC</summary>

We're not gonna do this. Too niche.

</details>


---

<a id="1676"></a>

### #1676: Vulnerability GHSA-4p46-pwfr-66x6 - ring, GHSA-2gh3-rmm4-6rq5 - protobuf

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1676 |
| **State** | CLOSED |
| **Author** | msaffitz (Mike Saffitz) |
| **Created** | 2025-04-10 23:32:18.000 UTC (9 months ago) |
| **Updated** | 2025-05-16 04:04:18.000 UTC |
| **Closed** | 2025-05-16 04:04:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Hello, we're seeing a medium severity issue with two of the Cargo packages

https://github.com/advisories/GHSA-4p46-pwfr-66x6

https://github.com/advisories/GHSA-2gh3-rmm4-6rq5

@temporalio/core-bridge/Cargo.lock

<img width="1009" alt="Image" src="https://github.com/user-attachments/assets/cbcc6af9-282e-47e3-9226-986626b81aad" />

<img width="1017" alt="Image" src="https://github.com/user-attachments/assets/d3dbd23c-a5dc-46b1-96d5-ecdf346e8c3c" />

Thank you!!

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-05-16 04:04:16.000 UTC</summary>

This has been fixed in 1.11.8, and also on the main branch.

</details>


---

<a id="1661"></a>

### #1661: [Feature Request] Serialization context for codecs and converters

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1661 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-03-25 15:02:54.000 UTC (9 months ago) |
| **Updated** | 2025-10-07 17:23:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/434

#### Comments (1)

<details>
<summary><strong>Sushisource</strong> commented on 2025-10-07 17:23:36.000 UTC</summary>

Make sure to include nexus per https://github.com/temporalio/features/issues/678

</details>


---

<a id="1660"></a>

### #1660: [Bug] RESOURCE_EXHAUSTED error while describing workflow schedule

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1660 |
| **State** | OPEN |
| **Author** | jhecking (Jan Hecking) |
| **Created** | 2025-03-25 12:20:01.000 UTC (9 months ago) |
| **Updated** | 2025-06-02 16:21:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We try to describe a workflow schedule to see if it exists already.

### Describe the bug

Trying to describe a workflow schedule causes the following error:

```
ServiceError: Failed to describe schedule
    at ScheduleClient.rethrowGrpcError (/var/workspace/node_modules/@temporalio/client/lib/schedule-client.js:347:19)
    at ScheduleClient._describeSchedule (/var/workspace/node_modules/@temporalio/client/lib/schedule-client.js:137:18)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Object.describe (/var/workspace/node_modules/@temporalio/client/lib/schedule-client.js:261:29)
    at async ListConnectionStatus (/var/workspace/main.js:204227:26)
    at async Authorization (/var/workspace/main.js:200642:12)
    at async /var/workspace/main.js:201108:28
    at async HandleServerErrors (/var/workspace/main.js:201020:16)
    at async handle (/var/workspace/main.js:165050:22)
caused by: Error: 8 RESOURCE_EXHAUSTED: consistent query buffer is full, this may be caused by too many queries and workflow not able to process query fast enough
    at callErrorFromStatus (/var/workspace/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/var/workspace/node_modules/@grpc/grpc-js/build/src/client.js:193:76)
    at /var/workspace/node_modules/@grpc/grpc-js/build/src/call-interface.js:78:35
    at Object.onReceiveStatus (/var/workspace/node_modules/@temporalio/client/lib/grpc-retry.js:165:25)
    at Object.onReceiveStatus (/var/workspace/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/var/workspace/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /var/workspace/node_modules/@grpc/grpc-js/build/src/resolving-call.js:129:78
    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/var/workspace/node_modules/@grpc/grpc-js/build/src/client.js:161:32)
    at Service.rpcImpl (/var/workspace/node_modules/@temporalio/client/lib/connection.js:239:33)
    at Service.rpcCall (/var/workspace/node_modules/protobufjs/src/rpc/service.js:94:21)
    at executor (/var/workspace/node_modules/@protobufjs/aspromise/index.js:44:16)
    at new Promise (<anonymous>)
    at Object.asPromise (/var/workspace/node_modules/@protobufjs/aspromise/index.js:28:12)
    at Service.rpcCall (/var/workspace/node_modules/protobufjs/src/rpc/service.js:86:21)
    at Service.describeSchedule (eval at Codegen (/var/workspace/node_modules/@protobufjs/codegen/index.js:50:33), <anonymous>:4:15)
    at ScheduleClient._describeSchedule (/var/workspace/node_modules/@temporalio/client/lib/schedule-client.js:131:47)
    at Object.describe (/var/workspace/node_modules/@temporalio/client/lib/schedule-client.js:261:47)
```

We only see this happening for one specific schedule, which triggers every half hour. It doesn't happen immediately, but only after the schedule has been running for a while. If we delete the schedule, and recreate it, the problem goes away for some time. This same problem happens on multiple identical deployments, but only for this one schedule. Once the schedule is in this state, we are getting this error when trying to describe the schedule using the TypeScript SDK but also when using the Temporal CLI and also using the Temporal web console.

Describe schedule output, before the issue occurs:

```
temporal-admintools-6468b84b77-2pf6g:/etc/temporal$ temporal schedule describe -s monitoring_schedule -o json
{
  "schedule": {
    "spec": {
      "structuredCalendar": [
        {
          "second": [
            {
              "step": 1
            }
          ],
          "minute": [
            {
              "end": 59,
              "step": 30
            }
          ],
          "hour": [
            {
              "end": 23,
              "step": 1
            }
          ],
          "dayOfMonth": [
            {
              "start": 1,
              "end": 31,
              "step": 1
            }
          ],
          "month": [
            {
              "start": 1,
              "end": 12,
              "step": 1
            }
          ],
          "dayOfWeek": [
            {
              "end": 6,
              "step": 1
            }
          ]
        }
      ]
    },
    "action": {
      "startWorkflow": {
        "workflowId": "monitoring_schedule",
        "workflowType": {
          "name": "monitoringSchedule"
        },
        "taskQueue": {
          "name": "borneo-workers",
          "kind": "TASK_QUEUE_KIND_NORMAL"
        },
        "input": {},
        "workflowExecutionTimeout": "1500s",
        "header": {
          "fields": {
            "orgInfo": {
              "metadata": {
                "encoding": "anNvbi9wbGFpbg=="
              },
              "data": "eyJ0ZW5hbnRJZCI6IjZiYTBmODU3LWZkYzgtOWFmNC02ZWI3LWJlZDM0NjEyMDBlNSIsIm9yZ2FuaXNhdGlvbklkIjoxfQ=="
            }
          }
        }
      }
    },
    "policies": {
      "overlapPolicy": "SCHEDULE_OVERLAP_POLICY_SKIP",
      "catchupWindow": "31536000s"
    },
    "state": {}
  },
  "info": {
    "actionCount": "4",
    "recentActions": [
      {
        "scheduleTime": "2025-03-25T10:41:17.794180870Z",
        "actualTime": "2025-03-25T10:41:17.869016655Z",
        "startWorkflowResult": {
          "workflowId": "monitoring_schedule-2025-03-25T10:41:17Z",
          "runId": "3f9bb004-4f31-4600-9e45-23bf195cd572"
        }
      },
      {
        "scheduleTime": "2025-03-25T11:00:00Z",
        "actualTime": "2025-03-25T11:00:00.198352012Z",
        "startWorkflowResult": {
          "workflowId": "monitoring_schedule-2025-03-25T11:00:00Z",
          "runId": "bf151d94-c8f7-4346-95cb-bd90cddfab72"
        }
      },
      {
        "scheduleTime": "2025-03-25T11:30:00Z",
        "actualTime": "2025-03-25T11:30:00.410055532Z",
        "startWorkflowResult": {
          "workflowId": "monitoring_schedule-2025-03-25T11:30:00Z",
          "runId": "d690f96a-048f-4be4-b4cf-1313bd61b1fb"
        }
      },
      {
        "scheduleTime": "2025-03-25T12:00:00Z",
        "actualTime": "2025-03-25T12:00:00.332018132Z",
        "startWorkflowResult": {
          "workflowId": "monitoring_schedule-2025-03-25T12:00:00Z",
          "runId": "2320d2c0-5bf1-41ef-bfad-0d549329b910"
        }
      }
    ],
    "futureActionTimes": [
      "2025-03-25T12:30:00Z",
      "2025-03-25T13:00:00Z",
      "2025-03-25T13:30:00Z",
      "2025-03-25T14:00:00Z",
      "2025-03-25T14:30:00Z",
      "2025-03-25T15:00:00Z",
      "2025-03-25T15:30:00Z",
      "2025-03-25T16:00:00Z",
      "2025-03-25T16:30:00Z",
      "2025-03-25T17:00:00Z"
    ],
    "createTime": "2025-03-25T10:41:17.745377738Z"
  },
  "conflictToken": "AAAAAAAAAAE="
}
```

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: 1.25.1
- Are you using Docker or Kubernetes or building Temporal from source? Kubernetes

### Additional context

<!-- Add any other context about the problem here. -->

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-06-02 16:21:48.000 UTC</summary>

Hello @jhecking!

Are you still seeing this error? If so, can you please confirm that you are operating the Temporal Cluster yourself, on Kubernetes, running Temporal server v1.25.1? Have you tried upgrading the Temporal server to latest release?

That error most probably indicates an issue with your Temporal Cluster configuration, or a bug in the Temporal Server. In any case, this is not a TS SDK side bug.

I think you may be able to get some more useful details by looking at your Temporal server-side logs.

Let me give just a little bit of context here. Internal to the Temporal server, schedules are actually implemented themselves as Workflow executions. To be clear, that's a Workflow type defined by the server itself, not your own Workflow; the code of that Workflow is in Go, and they execute on the Temporal Cluster's _Worker nodes_.

When you call `DescribeSchedule`, the server frontend node sends a query for each Schedule workflow to obtain fresh status. That is the query that is failing in the error message you're seeing. The server only allows up to a certain number of pending queries to a given Workflow execution - by default, I believe that maximum is one. The error message you are getting indicates that queries are being made in excess to that limit for a single workflow execution.

This may indicate that the Worker nodes of your cluster are underpowered, though I don't see why that would affect only that specific schedule. That and the fact that "Once the schedule is in this state, we are getting this error when trying to describe the schedule" makes it sound like there might be something wrong in that specific schedule definition that triggers a bug when the Schedule Workflow is replayed in the context of those queries.

</details>


---

<a id="1656"></a>

### #1656: [Bug] Workflow type is incorrectly deduced when using `bind` on workflow function

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1656 |
| **State** | OPEN |
| **Author** | jean-pruliere (Jean Pruliere) |
| **Created** | 2025-03-20 17:10:26.000 UTC (9 months ago) |
| **Updated** | 2025-03-20 17:13:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I have created an abstract class `Workflow`, all my workflow classes extend it and each one has a method containing the actual workflow definition. The workflow bundle is created by instantiating each class then rebinding the method it contains (=the actual workflow function) to its instance.
```typescript
// workflows/example.workflow.ts
export ExampleWorkflow extends Workflow {
  public async example(input: { name: string }) {
    // workflow definition goes here
  }
}

// workflows/index.ts
import { ExampleWorkflow } from "./example.workflow.ts";

const exampleClass = new ExampleWorkflow();
export example = exampleClass.example.bind(exampleClass);
```
I'd like to use these exported workflow functions with a WorkflowClient to start new executions.
```typescript
this.workflowClient.start(
  example,
  {
    args: [{ name }],
    taskQueue,
    workflowId: randomUUID(),
  },
),
```

### Describe the bug

Because the function is bound, its `name` property became `bound example`, so the workflow type ends up also being `bound example`. But because the workers get a bundle with the name of each exported function (i.e. `example`), they cannot execute a `bound example` workflow.

### Minimal Reproduction

Here is an [example of this behavior](https://github.com/jean-pruliere/samples-typescript/blob/demo/bound-workflows/hello-world/src/workflows.ts).

The mocha tests fail and the worker logs the following error:
```
2025-03-20T16:38:13.045Z [ERROR] Failed to process Worklow Activation {
  sdkComponent: 'worker',
  taskQueue: 'test',
  runId: '0195b46b-6928-74b7-87aa-301e9c2cfe1d',
  error: /Users/jean.pruliere/code/perso/samples-typescript/hello-world/workflow-bundle-7deb71318020c96355f1.js:4654
          throw new TypeError(`Failed to initialize workflow of type '${activator.info.workflowType}': ${details}`);
          ^
  
  TypeError: Failed to initialize workflow of type 'bound example': no such function is exported by the workflow bundle
      at Object.initRuntime (/Users/jean.pruliere/code/perso/samples-typescript/hello-world/node_modules/@temporalio/workflow/src/worker-interface.ts:87:10)
      at evalmachine.<anonymous>:1:18
      at Script.runInContext (node:vm:149:12)
      at Object.runInContext (node:vm:301:6)
      at Proxy.<anonymous> (/Users/jean.pruliere/code/perso/samples-typescript/hello-world/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js:104:50)
      at ReusableVMWorkflowCreator.createWorkflow (/Users/jean.pruliere/code/perso/samples-typescript/hello-world/node_modules/@temporalio/worker/lib/workflow/reusable-vm.js:131:24)
      at handleRequest (/Users/jean.pruliere/code/perso/samples-typescript/hello-world/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:35)
      at MessagePort.<anonymous> (/Users/jean.pruliere/code/perso/samples-typescript/hello-world/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:38)
      at [nodejs.internal.kHybridDispatch] (node:internal/event_target:816:20)
      at MessagePort.<anonymous> (node:internal/per_context/messageport:23:28),
  workflowExists: false
}
```

### Environment/Versions

- OS and processor: M2 Mac
- Temporal Version: sdk 1.11.7, server 1.27.1
- I'm using Docker and our production use Kubernetes


#### Comments (1)

<details>
<summary><strong>jean-pruliere</strong> commented on 2025-03-20 17:12:58.000 UTC</summary>

I forgot to mention it but I can work on a fix, I have already identified [which function](https://github.com/temporalio/sdk-typescript/blob/main/packages/common/src/workflow-options.ts#L240) should be modified.

Let me know, cheers

</details>


---

<a id="1652"></a>

### #1652: [Bug] Throw on usage of Workflow APIs that modify state from non-replayable context

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1652 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-03-17 15:19:21.000 UTC (9 months ago) |
| **Updated** | 2025-03-17 15:28:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

The following APIs should throw if invoked from a query handler, an update validation handler, or other "read only" execution context:

- Any API that may result in adding a command (except for the `RespondToQuery`, `UpdateResponse.accepted` or `UpdateResponse.rejected` commands);
- `Math.random()` and `uuid4()`;
- `setHandler()`, `setDefaultSignalHandler(), and similar;
- `condition()`
- `CancellableScope()`

At the moment, usage of these APIs may result in either failure on completion (from Core) or NDE on subsequent workflow tasks.

#### Comments (1)

<details>
<summary><strong>Quinn-With-Two-Ns</strong> commented on 2025-03-17 15:28:36.000 UTC</summary>

Doesn't this apply to all SDK's not just TS? Maybe we should open a feature issue

</details>


---

<a id="1628"></a>

### #1628: Child Workflows not Respecting WorkflowIdConflictPolicy.USE_EXISTING

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1628 |
| **State** | CLOSED |
| **Author** | blorgon1 |
| **Created** | 2025-02-04 00:07:56.000 UTC (11 months ago) |
| **Updated** | 2025-03-14 16:03:58.000 UTC |
| **Closed** | 2025-03-14 16:03:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Expected Behavior
When spawning a child workflow that has `WorkflowIdConflictPolicy.USE_EXISTING` and a workflow ID that is currently running, the running workflow's handle should be returned.

## Actual Behavior
```
{
  "type": "workflowExecutionFailedEventAttributes",
  "failure": {
    "message": "Workflow execution already started",
    "source": "TypeScriptSDK",
    "stackTrace": "WorkflowExecutionAlreadyStartedError: Workflow execution already started ..."
  },
  ...
}
```

## Steps to Reproduce the Problem
Using typescript-sdk:
```
import * as wf from '@temporalio/workflow';
```

  1. Workflow A runs and starts a child workflow using `wf.startChild` with workflow ID `abc` and `workflowIdConflictPolicy: WorkflowIdConflictPolicy.USE_EXISTING`
  2. Workflow A runs again and uses the same parameters on `wf.startChild` for workflow ID `abc`
  3. Observe `WorkflowExecutionAlreadyStartedError`

## Specifications

  - Version:
    - Temporal server 1.26.2
    - `@temporalio/*` 1.11.5
  - Platform:


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2025-02-20 23:43:16.000 UTC</summary>

The server doesn't support conflict policies for child workflows, the TypeScript SDK shouldn't have exposed this option.

Reactions: üëç 3

</details>


---

<a id="1618"></a>

### #1618: [Bug] on using bun not able to connect temporal

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1618 |
| **State** | CLOSED |
| **Author** | satya-nected |
| **Created** | 2025-01-31 12:32:47.000 UTC (11 months ago) |
| **Updated** | 2025-02-07 15:54:58.000 UTC |
| **Closed** | 2025-02-07 15:54:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying create worker on the top of bun runtime, but not able to connect to temporal.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

on running this function program stucks and not responsing...
```
async function runWorker() {
  const connection = await NativeConnection.connect({
    address: 'localhost:7233',
  });
  const worker = await Worker.create({
    connection: connection,
    workflowsPath: require.resolve('./workflows'),
    activities: require('./activities'),
    taskQueue: 'my-task-queue',
  });

  console.log('Worker started...');
  await worker.run();
}
```



### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Ubuntu
- Temporal Version: sdk version 1.11.7

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-31 23:50:18.000 UTC</summary>

We don't support Bun at this time. We certainly hope that we'll reach that objective at some point in the future, but we are not actively working in that direction just now. It is simply too early for that.

For example, the specific issue you describe is due to a difference in [how bun checks the `error` argument on `napi_throw`](https://github.com/oven-sh/bun/blob/1fa42d81af0806cf06ca9dc050bf06046c3a4b41/src/bun.js/bindings/napi.cpp#L1644-L1659) vs [what's done in Node](https://github.com/nodejs/node/blob/5fad0b93667ffc6e4def52996b9529ac99b26319/src/js_native_api_v8.cc#L1924-L1934). That breaks the method that [Neon Binding](https://github.com/neon-bindings/neon/blob/7f4feb10631cfd3e654112d42a3b5ed472f851e8/crates/neon/src/sys/no_panic.rs#L135-L137) uses to check either it is safe to call back into the JS environment at that time.

It is not worth fixing that issue in upstream projects just yet. Bun's team is already doing some awesome bug hunting work on their NAPI implementation. See for example [this PR](https://github.com/oven-sh/bun/pull/14501) and [this one](https://github.com/oven-sh/bun/pull/16230). I'd expect a few rounds like these, so let's give them time to complete their efforts first, and then for other key dependencies to stabilize.

Reactions: üëç 2

</details>


---

<a id="1617"></a>

### #1617: [Feature Request] Custom Activity Function Name in UI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1617 |
| **State** | CLOSED |
| **Author** | semics-tech (SEMICS) |
| **Created** | 2025-01-30 08:55:47.000 UTC (11 months ago) |
| **Updated** | 2025-01-30 19:24:14.000 UTC |
| **Closed** | 2025-01-30 19:24:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

I want to be able to differentiate between activities in the temporal UI.

Currently, each activity takes the name of the function i.e. `someActivity` but I am regularly looping functions but with different parameters.

### Describe the solution you'd like

I would like the ability to name the activity, so that it's easy to differentiate from the same function being executed with different params. Potentially by passing a `activityName` parameter or similar to show in the UI.

### Additional context

I know you can see the parameters by clicking on the activity, but I would like to see the name of the activity at a glance in the timeline (without having to click on each one individually)

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-30 19:24:04.000 UTC</summary>

Sure! This is part of a new _User Metadata_ feature that's being worked on at the moment. The TS SDK don't yet support that API, but [that's coming up soon](#1544). UI support is also coming up very soon.

Reactions: ‚ù§Ô∏è 1

</details>


---

<a id="1570"></a>

### #1570: [Feature Request] Simplify API on interceptors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1570 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-11-19 20:47:21.000 UTC (1y 1m ago) |
| **Updated** | 2025-10-06 18:25:52.000 UTC |
| **Closed** | 2025-10-06 18:25:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üòÑ 1 |

#### Description

TBD

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-10-06 18:25:51.000 UTC</summary>

The intent behind this feature request will be covered by #1764.

</details>


---

<a id="1569"></a>

### #1569: [Feature Request] Complete conversion of old style integration tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1569 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-11-19 20:45:45.000 UTC (1y 1m ago) |
| **Updated** | 2025-01-14 16:59:57.000 UTC |
| **Closed** | 2025-01-14 16:59:56.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

TBD

#### Comments (1)

<details>
<summary><strong>THardy98</strong> commented on 2025-01-14 16:59:56.000 UTC</summary>

Closed by https://github.com/temporalio/sdk-typescript/pull/1597

</details>


---

<a id="1568"></a>

### #1568: [Feature Request] Update supported Node versions to 18.x to 22.x

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1568 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-11-19 20:45:01.000 UTC (1y 1m ago) |
| **Updated** | 2024-12-18 20:27:27.000 UTC |
| **Closed** | 2024-12-18 20:27:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Description

- Update both SDK and samples repos to Node v18..v22, and TypeScript 5.x.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-12-18 20:27:26.000 UTC</summary>

Resolved by #1586.

</details>


---

<a id="1556"></a>

### #1556: [Bug] All log related to the same trace_id 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1556 |
| **State** | CLOSED |
| **Author** | baptou12 (Baptiste Maurel) |
| **Created** | 2024-11-01 14:34:01.000 UTC (1y 2m ago) |
| **Updated** | 2024-11-06 00:41:15.000 UTC |
| **Closed** | 2024-11-06 00:41:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | duplicate |
| **Assignees** | None |
| **Milestone** | None |

#### Description

(This is probably more of a question than a bug)

### What are you really trying to do?

I am using temporal with Opentelemetry, and all logs in activities (using log from "@temporalio/acitivity") are related to the same trace_id which is the one of the startup of my app

### Describe the bug

I configured opentelemetry with temporal, using the 4 interceptors, but when I see logs they are all related to the same traceId. I don't know if my config is wrong or if there is a bug which do not create root span for my workflows.



#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-11-06 00:41:15.000 UTC</summary>

See https://github.com/temporalio/sdk-typescript/issues/1425#issuecomment-2133992183.

Closing as duplicate.

</details>


---

<a id="1544"></a>

### #1544: [Feature Request] Support user metadata

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1544 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-10-15 12:26:44.000 UTC (1y 2m ago) |
| **Updated** | 2025-08-11 23:49:59.000 UTC |
| **Closed** | 2025-08-11 23:49:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/486. Specifically, after https://github.com/temporalio/sdk-core/issues/830:

* Accept optional "static summary " and "static details" on all ways to start a workflow (start, signal with start, schedule, and child workflow) and populate user metadata with them
* Accept optional "summary" when creating timers and populate user metadata with it
* Accept optional "summary" when creating activities and populate user metadata with it
* Handle `__temporal_workflow_metadata` query (see features issue and https://github.com/temporalio/sdk-go/pull/1597)
* Mark experimental

#### Comments (1)

<details>
<summary><strong>aluksidadi</strong> commented on 2025-05-07 20:55:45.000 UTC</summary>

Hey folks, excited about the PR, any update on when that'll be merged? Thanks!

</details>


---

<a id="1506"></a>

### #1506: [Feature Request] Allow passing live `payloadConverter` object on Client and Activity-Worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1506 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-08-30 22:18:32.000 UTC (1y 4m ago) |
| **Updated** | 2024-09-09 13:17:09.000 UTC |
| **Closed** | 2024-09-09 13:17:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Problem

At this time, `payloadConverter` must always be provided as a path to a TS/JS file. That requirement comes from the Workflow execution context, as payload converters execute inside the Workflow sandbox. And from there, it was originally decided to extend that requirement to all places that would receive payload converters, in the interest of having consistent APIs. There‚Äôs no dispute on the fact that having consistent APIs is generally a good thing.

However, in this specific case, experience clearly demonstrates that these other APIs are often used in contexts that go through different deployment logic than Workflow Workers, and therefore, the burden of having to adapt those other deployment logic to that artificial requirement is not reasonable.

### Describe the solution you'd like

- For Client and Activity-only workers, support passing pre-instantiated Payload Converters, just the same as we currently pass `payloadCodecs`.
- For Workflow workers, consider the possibility of extracting payload converter from the same bundle as workflow bundles (e.g. look for the presence of a `payloadConverter` named export on the file at `workflowsPath` or inside the prebuilt workflow bundle); a naming conflict (i.e. with a workflow named `payloadConverter` seems very unlikely).
- Same for failure converters.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-09 13:17:08.000 UTC</summary>

Duplicate of #1458 

</details>


---

<a id="1502"></a>

### #1502: [Bug] @temporalio/worker with subdependency @opentelemetry/api version higher than 1.6.0 breaks

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1502 |
| **State** | CLOSED |
| **Author** | bert-bae (Elbert (Sangyoup) Bae) |
| **Created** | 2024-08-21 21:36:22.000 UTC (1y 4m ago) |
| **Updated** | 2024-09-09 13:47:09.000 UTC |
| **Closed** | 2024-09-09 13:43:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Package update for latest on @temporalio/worker has an issue with a sub-dependency update for @opentelemetry/api. The version restriction listed for temporalio/worker is for opentelemetry/api to be ^1.3.0. We previously had 1.6.0 which does not have this issue, but updating our packages to have the latest 1.9.0 causes this problem.

### Describe the bug

Cannot run when `@temporalio/worker` uses `@opentelemetry/api` version `1.9.0` with the following error encountered:

```sh
Error: Package subpath './build/src/trace/NoopTracer' is not defined by "exports" in /opt/atlassian/pipelines/agent/build/node_modules/.pnpm/@temporalio+worker@1.8.6/node_modules/@opentelemetry/api/package.json
 ‚ùØ Object.<anonymous> ../../node_modules/.pnpm/@temporalio+worker@1.8.6/node_modules/@temporalio/worker/src/tracing.ts:2:1

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
Serialized Error: { code: 'ERR_PACKAGE_PATH_NOT_EXPORTED' }
```

Locking @opentelemetry/api version between 1.3.0 to 1.6.0 is a workaround.

### Minimal Reproduction

Installing `@temporalio/worker` which currently has a minimum version marked for `@opentelemetry/api^1.3.0` downloads the latest of version 1.9.0 which breaks the import. It appears since temporalio/worker package is doing a deep import directly from the build directory, it is not an issue that opentelemetry will fix.

### Environment/Versions

Node Version 18.17.1
MacOS Sonoma

### Additional context

[Opentelemetry's github issue related to this problem](https://github.com/open-telemetry/opentelemetry-js/issues/4518)


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-09 13:47:08.000 UTC</summary>

The import on `NoopTracer` was removed in #1269. Please update all @temporalio to >1.9.0.

</details>


---

<a id="1501"></a>

### #1501: Expose activity retry options via activity Info interface

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1501 |
| **State** | CLOSED |
| **Author** | tsurdilo (Tihomir Surdilovic) |
| **Created** | 2024-08-20 17:36:40.000 UTC (1y 4m ago) |
| **Updated** | 2024-09-09 15:13:06.000 UTC |
| **Closed** | 2024-09-09 15:13:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Currently seems not possible to expose activity retry options from activity Info interface https://github.com/temporalio/sdk-typescript/blob/main/packages/activity/src/index.ts#L116

Feature request is to add this ability like its possible to do for example in Java sdk. Thanks.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-09 15:13:05.000 UTC</summary>

Duplicate #1210.

</details>


---

<a id="1491"></a>

### #1491: [Bug] log.error doesn't log the error

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1491 |
| **State** | CLOSED |
| **Author** | shawnjones253 (Shawn Jones) |
| **Created** | 2024-08-13 17:56:14.000 UTC (1y 4m ago) |
| **Updated** | 2024-09-09 15:16:12.000 UTC |
| **Closed** | 2024-09-09 15:16:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I want to use the '@temporalio/workflow' `log.error(message: string, attrs?: Record<string, unknown>): void` method within an interceptor to log `Error` objects.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

Create a `WorkflowStatusInterceptor`. Run a workflow that uses `continueAsNew` to generate an error for the interceptor:

```
import { log, Next, WorkflowExecuteInput, WorkflowInboundCallsInterceptor } from '@temporalio/workflow'

export class WorkflowStatusInterceptor
  implements WorkflowInboundCallsInterceptor
{
  constructor() {}

  public async execute(
    input: WorkflowExecuteInput,
    next: Next<WorkflowInboundCallsInterceptor, 'execute'>
  ): Promise<unknown> {
    try {
        const ret = await next(input)
        return ret
    } catch (e) { // upon catching ContinueAsNew error
            log.error('shouldLogContinueAsNewError', e) // all properties of `e` are missing from this log!
            log.error(e.name) // prints ContinueAsNew
            log.error((e instanceof Error).toString()) // prints true
    }
  }
}
```

```
// note this first log is missing all properties of the actual error!
2024-08-06T20:43:23.561Z [ERROR] shouldLogContinueAsNewError {
  sdkComponent: 'workflow',
  taskQueue: 'my-queue',
  namespace: 'default',
  workflowId: my-wf-id',
  runId: '1b4076e7-a5a7-4ac0-9e8c-1acedb9401a3',
  workflowType: 'my-wf-type',
  command: {
    workflowType: 'my-wf-type',
    arguments: [ [Object] ],
    headers: {},
    taskQueue: 'my-queue',
    memo: undefined,
    searchAttributes: undefined,
    workflowRunTimeout: undefined,
    workflowTaskTimeout: undefined,
    versioningIntent: 0
  }
}

2024-08-06T20:43:23.561Z [ERROR] ContinueAsNew {
  sdkComponent: 'workflow',
  taskQueue: 'my-queue',
  namespace: 'default',
  workflowId: my-wf-id',
  runId: '1b4076e7-a5a7-4ac0-9e8c-1acedb9401a3',
  workflowType: 'my-wf-type'
}

2024-08-06T20:43:23.561Z [ERROR] true {
  sdkComponent: 'workflow',
  taskQueue: 'my-queue',
  namespace: 'default',
  workflowId: my-wf-id',
  runId: '1b4076e7-a5a7-4ac0-9e8c-1acedb9401a3',
  workflowType: 'my-wf-type'
}
```

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 mac
- Temporal Version: 1.10.1 (sdk)
- Are you using Docker or Kubernetes or building Temporal from source? `temporalio/auto-setup:1.23.1` via docker

### Additional context

Why it matters, this makes it hard to figure out what errors I need to catch in my interceptor without creating support threads:
https://community.temporal.io/t/any-way-to-get-notified-or-execute-callback-for-change-in-workflowexecutionstatus/12297/11?u=shawn_jones

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-09 15:16:12.000 UTC</summary>

Duplicate of #1274.

</details>


---

<a id="1481"></a>

### #1481: [Feature Request] Reduce TS parsing/evaluation times

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1481 |
| **State** | CLOSED |
| **Author** | milesj (Miles Johnson) |
| **Created** | 2024-07-30 22:13:56.000 UTC (1y 5m ago) |
| **Updated** | 2025-02-07 16:03:10.000 UTC |
| **Closed** | 2025-02-07 16:03:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

We're profiling our TS monorepo and the `@temporalio` packages have popped up as a hot path. I've noticed a few issues that can probably be optimized:

1. Importing the `@temporalio/client` package takes 1 second. In the flame chart below, you'll notice that our `temporalclient.ts` file, which imports `@temporalio/client` takes most of the compilation time.

<img width="1490" alt="Screenshot 2024-07-30 at 3 05 25‚ÄØPM" src="https://github.com/user-attachments/assets/9156eeb9-6525-4068-b2b6-c280a0d19455">

This can _maybe_ be optimized by removing barrel imports (giant index exports), and moving things into deep path imports. Additionally, this may be caused by #2. 

2. The `@temporario/proto` TS declaration file is 49k lines long and is 2.67 MB in size. The generated file at `@temporalio/proto/protos/root.d.ts` is massive and is most likely consuming most of the parsing/checking time.

This can _maybe_ be optimized by splitting `root.d.ts` into multiple files so they can be checked in parallel. Probably split into `coresdk.d.ts`, `temporal.d.ts`, `google.d.ts`, `grpc.d.ts`, etc.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->


Improved TS compiler speeds. I listed some possible solutions above.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

This is using project references and was tested simply using `tsc --build`.


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-08-05 18:29:36.000 UTC</summary>

> Importing the @temporalio/client package takes 1 second. In the flame chart below, you'll notice that our temporalclient.ts file, which imports @temporalio/client takes most of the compilation time.

This is not how I read your flame chart. Locating, reading and parsing source files to memory appears to be taking ~250ms. That's for all sources files used by that TS project, including loading the `@temporalio/client` and `@types/node` modules, and many more. You see these in your flame chart as the pink `findSourceFile`, green `createSourceFile` bars (and more).

The `checkSourceFile` step, which is taking 1.1 seconds in your flame graph, is for type checking of a _single_ source file (i.e. your `temporalclient.ts` file); `checkSourceFile` is not recursive. That's indeed huge, especially given that this time corresponds to essentially two expressions.

If you look the details on these `checkExpression`, you should see the exact location of those expressions in your source file. What exactly are you doing there? My intuition is that you might be passing `Client` or `Connection` objects across subpackages of your mono repo, which are compiled against different copies of `@temporalio/*` packages. That forces TSC to assert that both type definitions are compatible, which can indeed be very long on complex types.

Also make sure you are using a recent version of TSC. They have been working hard recently on build-time performance.

> The @temporario/proto TS declaration file is 49k lines long and is 2.67 MB in size. The generated file at @temporalio/proto/protos/root.d.ts is massive and is most likely consuming most of the parsing/checking time.
>
> This can maybe be optimized by splitting root.d.ts into multiple files so they can be checked in parallel. Probably split into coresdk.d.ts, temporal.d.ts, google.d.ts, grpc.d.ts, etc.

On my local machine, `findSourceFile` on `@temporalio/proto/protos/root.d.ts` takes 124ms. That's indeed larger than most other modules, but not unusually large. For comparision, `findSourceFile` on `@types/node/index.d.ts` gives me 94ms. And unless `skipLibCheck` is sets to `false` in tsconfig.json (it is generally recommended to leave it to its default value, which is `true`), those large imports should not incur any time for type checking.

Splitting `root.d.ts` to multiple subfiles would therefore not make a significant difference (no more than a few tens of ms). TSC can't do parallel parsing/checking, and those namespaces depends on each others, so you'd end up loading most of them anyway. The only gain we may get would be from skipping the `coresdk` and `temporalio.test` namespaces, which are not used in the context of `@temporalio/client`, but these are rather small packages, and that gain might be offset by having to open and load more files.

If you still think this is an issue, would you mind providing more details on exactly how you measured this? And if possible, please include a sample repo so we know that we are measuring the same thing.

Reactions: üëç 1

</details>


---

<a id="1460"></a>

### #1460: [Feature Request] Support default/dynamic update handlers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1460 |
| **State** | CLOSED |
| **Author** | dandavison (Dan Davison) |
| **Created** | 2024-07-09 16:17:27.000 UTC (1y 6m ago) |
| **Updated** | 2025-01-21 22:50:42.000 UTC |
| **Closed** | 2025-01-21 22:50:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

`workflow.setDefaultSignalHandler` exists. The equivalent functionality for update should exist also.

#### Comments (1)

<details>
<summary><strong>cretz</strong> commented on 2024-07-09 16:27:17.000 UTC</summary>

I think this is a duplicate (albeit a subset) of #1015 as part of https://github.com/temporalio/features/issues/201. Also, I think we should call this "dynamic" as it is in every other SDK in all other situations.

</details>


---

<a id="1435"></a>

### #1435: Provide methods to wait for all handlers to finish

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1435 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-06-04 04:39:21.000 UTC (1y 7m ago) |
| **Updated** | 2024-08-07 11:38:32.000 UTC |
| **Closed** | 2024-08-07 11:38:31.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Users want to easily await (or ignore) all their remaining handlers when they continue as new or exit the workflow.  Since we can't tell what they want, they should specify.

#### Comments (1)

<details>
<summary><strong>dandavison</strong> commented on 2024-08-07 11:38:31.000 UTC</summary>

Closed by https://github.com/temporalio/sdk-typescript/pull/1459

</details>


---

<a id="1434"></a>

### #1434: Warn or error when update handlers dangle across CAN or workflow exit

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1434 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-06-04 04:22:00.000 UTC (1y 7m ago) |
| **Updated** | 2024-08-07 11:34:24.000 UTC |
| **Closed** | 2024-08-07 11:34:24.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We can recommend the await-all-handlers or drop-all-handlers methods. TBD whether error or warning.


#### Comments (1)

<details>
<summary><strong>dandavison</strong> commented on 2024-06-28 12:21:10.000 UTC</summary>

I've merged the first PR, for Python: https://github.com/temporalio/sdk-python/pull/556

The basic spec that that PR's proposing for other SDKs is

- Workflow code can wait on a method named similarly to `workflow.all_handlers_finished()`

- By default, the worker will emit `workflow.UnfinishedUpdateHandlersWarning` and `workflow.UnfinishedSignalHandlersWarning` if any handlers of those types are unfinished when the workflow completes (cancellation, failure, success). See PR for wording of message.

- These warnings are controlled by a policy whose default value is `workflow.HandlerUnfinishedPolicy.WARN_AND_ABANDON`

- Users can silence the warning on a per-handler basis by setting unfinished_policy to `workflow.HandlerUnfinishedPolicy.ABANDON`

- Tests should verify the above for worker-side workflow exit via cancellation, failure, and success

</details>


---

<a id="1431"></a>

### #1431: [Feature Request] Make it easier to diagnose failures to connect to Temporal Cloud due to incorrect `serverRootCACertificate`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1431 |
| **State** | OPEN |
| **Author** | maxramqvist (Max Ramqvist) |
| **Created** | 2024-05-29 14:12:28.000 UTC (1y 7m ago) |
| **Updated** | 2024-05-29 22:41:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to connect to Temporal Cloud with this SDK client. But failed in my troubleshooting when the error message threw me in another direction.

### Describe the bug

I'm trying to connect to a namespace in Temporal Cloud. The worker and the client is using the exact same TLS-configuration (i use the same function to generate the TLS config in my actual code).
The worker connects successfully to Temporal Cloud, but the client fails with the message `Failed to connect before the deadline`.

It turns out that it was a misconfiguration on my part on the `serverRootCACertificate`, I had set a CA certificate that wasn't valid in this case.

The error message through me off in the troubleshooting. I had expected the message to be something related to TLS validation or similar, not a failed connection before the deadline... 

It would be great with a error message explaining the actual problem if that is possible.

### Minimal Reproduction

```javascript
        const crt = Buffer.from(config.temporal.clientCertB64, "base64")
        const key = Buffer.from(config.temporal.clientKeyB64, "base64")

        clientConnection = await Connection.connect({
            address: config.temporal.address,
            tls: {
              clientCertPair: {
                  crt,
                  key,
              },
              // just set an invalid CA cert here 
              serverRootCACertificate: process.env["NODE_EXTRA_CA_CERTS"] 
                  ? fs.readFileSync(process.env["NODE_EXTRA_CA_CERTS"])
                  : undefined,
          }
        })
```

### Environment/Versions

Typescript SDK 1.9.3 and 1.10.1, NodeJS 22.0 and 22.2





#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-29 22:40:17.000 UTC</summary>

I fully agree. This is a common friction point, and we want to improve on this.

Unfortunately, and a bit counter-intuitively, gRPC's robustness against transport level failures makes it very difficult to identify such errors. Essentially, _by design_, the gRPC layer treats connection level errors as transient, and will simply retry transparently as long as it is authorized to do so (hence the "before deadline" part in that error message). There are also difficulties related to the fact that the underlying TLS libraries, on both client-side and server-side, will often close a connection eagerly, with very little details, if any, when they fail to complete an mTLS handshake sequence, which is the specific case you faced.

I think [this comment](https://github.com/grpc/grpc-node/issues/733#issuecomment-463307760) from the `@grpc/grpc-js` project maintainer clearly expose this:

> The current behavior is intentional. Fundamentally, the gRPC library assumes that users are inputting their correct information, and that failures to establish connections are the result of the inherently asynchronous nature of networks. A DNS resolution failure can mean that the DNS config hasn't been updated yet. A TCP connection failure can mean that the server process happens to be restarting at the moment. And a certificate validation error can mean that the server is rotating its certs and the client picked up the new roots a little early.
>
> This is also not something that can be conclusively checked beforehand. The root certificates file does not contain information about every host you might connect to. The default file contains certificate information for certificate authorities. So, you can check whether a particular certificate is signed by a CA that you recognize, but you can't check locally whether or not you will be able to connect to a particular host.

Still, we are looking internally at ways to improve the user experience in this regard. I'll therefore keep this ticket open to track this as a feature request.

Reactions: üëç 1

</details>


---

<a id="1422"></a>

### #1422: Wrap GRPC::CANCELED and DEADLINE_EXCEEDED in an SDK Timeout exception for Update

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1422 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-05-18 00:43:05.000 UTC (1y 7m ago) |
| **Updated** | 2024-06-28 13:29:27.000 UTC |
| **Closed** | 2024-06-28 13:29:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

So that users only have to catch one predictable exception

#### Comments (1)

<details>
<summary><strong>cretz</strong> commented on 2024-06-05 20:01:26.000 UTC</summary>

See https://github.com/temporalio/features/issues/483#issuecomment-2150832036 for implementation details

</details>


---

<a id="1421"></a>

### #1421: [Feature Request] Do not set workflow completion until after all coroutines have settled in the task

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1421 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-05-17 19:30:48.000 UTC (1y 7m ago) |
| **Updated** | 2024-08-14 21:59:23.000 UTC |
| **Closed** | 2024-08-14 21:59:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/481

#### Comments (1)

<details>
<summary><strong>dandavison</strong> commented on 2024-07-23 19:16:47.000 UTC</summary>

https://github.com/temporalio/sdk-core/pull/776 has been merged, and so this is unblocked. In `sdk-python` and `sdk-dotnet` that PR allows the https://github.com/temporalio/features/issues/481 requirement to be solved relatively easily, by changing lang so that they no longer drop post-terminal commands, as they had been doing.

</details>


---

<a id="1415"></a>

### #1415: [chore] Update repo to NPM 7 workspaces

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1415 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-05-08 20:09:28.000 UTC (1y 8m ago) |
| **Updated** | 2026-01-08 20:05:46.000 UTC |
| **Closed** | 2026-01-08 20:05:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Description

Now that we dropped support for Node 14, we can update our repo to use native NPM support for workspaces. Can also update to [lerna 7](https://github.com/lerna/lerna/releases/tag/7.0.0).

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2026-01-08 20:05:45.000 UTC</summary>

This is no longer applicable, as the repository has been transitioned to PNPM.

</details>


---

<a id="1404"></a>

### #1404: [Bug] Some TS Worker errors while processing a Task may cause complete Worker failure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1404 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-04-30 14:40:05.000 UTC (1y 8m ago) |
| **Updated** | 2024-07-25 20:26:11.000 UTC |
| **Closed** | 2024-07-25 20:26:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

In a recent incident, an error in processing an Activity Task (due to `ActivityInfo.startTime` being `null`, which would result in throwing a `TypeError`) led to complete Worker failure.

This kind of unexpected errors must be caught and handled on TS side, as Core can't properly handle them.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-07-25 20:26:10.000 UTC</summary>

Fixed by #1473 / #1477.

</details>


---

<a id="1397"></a>

### #1397: [Feature Request] Await multiple signals in a workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1397 |
| **State** | CLOSED |
| **Author** | jacek-rzrz (Jacek Rz) |
| **Created** | 2024-04-22 11:18:16.000 UTC (1y 8m ago) |
| **Updated** | 2024-04-22 12:02:13.000 UTC |
| **Closed** | 2024-04-22 12:02:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.
Following [this](https://community.temporal.io/t/wait-for-signal-best-practices/1737), we are trying to implement a wait for multiple signals in a Temporal Workflow. It seems that the JVM SDK has `Workflow.await` suited exactly for this purpose, is there a similar tool in Typescript?

### Describe the solution you'd like
Expressing our workflow e.g. like this:

```typescript
Workflow.wait(() -> allSignalsReceived());
```

### Additional context
So far we have managed to implement this as a `while` loop:

```typescript
while(true) {
  if(allSignalsReceived()) {
    break;
  }
  await workflow.sleep(1000);
}
```

The above implementation is causing `OutOfMemory` issues for the workers, we understand this is because every iteration of the unbounded loop is getting cached. We understand we might be able to resolve the memory issues with `workflow.continueAsNew` or by drastically reducing the `maxCachedWorkflows` param, but neither of these options seem like a production-grade solution.


#### Comments (1)

<details>
<summary><strong>jacek-rzrz</strong> commented on 2024-04-22 12:02:13.000 UTC</summary>

Closing - turns out there is `workflow.condition` for this exact purpose already!

</details>


---

<a id="1387"></a>

### #1387: [Feature Request] HTTP CONNECT proxy support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1387 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-04-05 21:47:09.000 UTC (1y 9m ago) |
| **Updated** | 2024-05-14 23:00:08.000 UTC |
| **Closed** | 2024-05-14 23:00:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

* Support HTTP connect proxy options for workers added in https://github.com/temporalio/sdk-core/pull/714. See how Python did it at https://github.com/temporalio/sdk-python/pull/501
* Investigate and try to add HTTP connect proxy options for JS gRPC client
* Add test in features repo

#### Comments (1)

<details>
<summary><strong>brendan-myers</strong> commented on 2024-04-10 23:44:45.000 UTC</summary>

+1 

Client/grpc-js supports HTTP CONNECT through setting the `http_proxy` environment variable.

Reactions: üëç 1

</details>


---

<a id="1382"></a>

### #1382: [Bug] Page size filter in @temporalio/client list method doesn't seem to be working properly

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1382 |
| **State** | CLOSED |
| **Author** | Thexumaker (David Xu) |
| **Created** | 2024-03-26 21:16:33.000 UTC (1y 9m ago) |
| **Updated** | 2024-12-18 13:20:10.000 UTC |
| **Closed** | 2024-03-26 21:34:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
I'm trying to query for some workflow data via the temporal client list method.

### Describe the bug

I'm calling temporalClient.list({pageSize: 1, query: 'randomQuery'}) but it seems to just returns thousands of results

The result should've returned just 1 item but I get back a thousand results.

### Minimal Reproduction

```
const iterable = temporalClient.list({
      pageSize: 1,
      query: `userId = '123'`,
    });

    const results = [];
    for await (const item of iterable) {
      results.push(item);
    }

    logger.info(`length of results: ${results.length}` );
 ```
    
    It should return 1 result based on the docs, but I also couldn't find too much documentation for this

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 mac
- Temporal Version: 1.19 SDK
- Are you using Docker or Kubernetes or building Temporal from source?
Docker

### Additional context

<!-- Add any other context about the problem here. -->

I'm not too concerned by this issue but reading the docs(https://docs.temporal.io/visibility#efficient-api-usage) I'm not really able to test pagination which will become a blocker in the future

#### Comments (1)

<details>
<summary><strong>jpalof</strong> commented on 2024-12-18 13:20:07.000 UTC</summary>

@Thexumaker , I am having a similar problem (https://community.temporal.io/t/problem-limiting-results-of-workflowclient-list-pagesize-1/15725).  I noticed that you marked this bug as `completed`.  I don't see a fix associated with this bug.  Did you discover a mis-conception on your usage or a workaround that resulted you in closing this bug?

Thanks

</details>


---

<a id="1381"></a>

### #1381: [Feature Request] Use macOS M1/ARM runners for all SDK CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1381 |
| **State** | CLOSED |
| **Author** | Quinn-With-Two-Ns (Quinn Klassen) |
| **Created** | 2024-03-26 17:54:02.000 UTC (1y 9m ago) |
| **Updated** | 2024-05-10 22:45:16.000 UTC |
| **Closed** | 2024-05-10 22:45:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See: https://github.com/temporalio/features/issues/396

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-05-10 22:45:16.000 UTC</summary>

Completed in #1003 

</details>


---

<a id="1371"></a>

### #1371: [Feature Request]  SDK clients should set a UpdateID on any update request even if the user did not specify one

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1371 |
| **State** | CLOSED |
| **Author** | Quinn-With-Two-Ns (Quinn Klassen) |
| **Created** | 2024-03-06 17:34:35.000 UTC (1y 10m ago) |
| **Updated** | 2024-04-01 23:23:32.000 UTC |
| **Closed** | 2024-04-01 23:21:56.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/features/issues/431


#### Comments (1)

<details>
<summary><strong>Sushisource</strong> commented on 2024-04-01 23:21:56.000 UTC</summary>

This appears to be already working this way just fine

here: https://github.com/temporalio/sdk-typescript/blob/4a2af0229c2bba222ff62b81bc7ee7c2ee6fa590/packages/client/src/workflow-client.ts#L762

</details>


---

<a id="1369"></a>

### #1369: [Bug] FailureConverters should not be reported as PayloadConverters in error messages

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1369 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2024-02-27 18:45:20.000 UTC (1y 10m ago) |
| **Updated** | 2024-03-26 17:46:29.000 UTC |
| **Closed** | 2024-03-26 17:46:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

The errors thrown by data converters should be made more generic by using ${type} instead of hardcoding payloadConverter, and also 
these error messages should use methods that are failure converter specific when needed.


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-03-26 17:46:28.000 UTC</summary>

Resolved by #1373 

</details>


---

<a id="1347"></a>

### #1347: [Bug] listWorkflowExecutions without namespace throws an exception.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1347 |
| **State** | CLOSED |
| **Author** | kakopappa (Aruna Tennakoon) |
| **Created** | 2024-01-25 01:57:15.000 UTC (1y 11m ago) |
| **Updated** | 2024-01-29 15:10:21.000 UTC |
| **Closed** | 2024-01-29 15:10:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

List workflows

```
const response = await connection.workflowService.listWorkflowExecutions({
        query: `WorkflowId = "${history.workflowId}"`, 
});

```
### Describe the bug

List workflows without namespace throw an exception. It needs to be marked as mandatory

```
Error: 3 INVALID_ARGUMENT: Namespace is empty.
    at Object.callErrorFromStatus (\@temporalio\client\node_modules\@grpc\grpc-js\build\src\call.js:31:19)
    at Object.onReceiveStatus (\@temporalio\client\node_modules\@grpc\grpc-js\build\src\client.js:195:52)
    at \@temporalio\client\node_modules\@grpc\grpc-js\build\src\call-stream.js:111:35
    at onReceiveStatus (\@temporalio\client\lib\grpc-retry.js:134:25)
    at Object.onReceiveStatus (\@temporalio\client\lib\grpc-retry.js:137:17)
    at InterceptingListenerImpl.onReceiveStatus (\@temporalio\client\node_modules\@grpc\grpc-js\build\src\call-stream.js:106:23)
    at Object.onReceiveStatus (\@temporalio\client\node_modules\@grpc\grpc-js\build\src\client-interceptors.js:365:141)
    at Object.onReceiveStatus (\@temporalio\client\node_modules\@grpc\grpc-js\build\src\client-interceptors.js:328:181)
    at \@temporalio\client\node_modules\@grpc\grpc-js\build\src\call-stream.js:188:78
    at processTicksAndRejections (node:internal/process/task_queues:78:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (\@temporalio\client\node_modules\@grpc\grpc-js\build\src\client.js:163:34)
    at Service.rpcImpl (\@temporalio\client\lib\connection.js:216:33)
    at Service.rpcCall (\@temporalio\proto\node_modules\protobufjs\src\rpc\service.js:94:21)
    at executor (\@protobufjs\aspromise\index.js:44:16)
    at new Promise (<anonymous>)
    at Object.asPromise (\@protobufjs\aspromise\index.js:28:12)
    at Service.rpcCall (\@temporalio\proto\node_modules\protobufjs\src\rpc\service.js:86:21)
    at Service.listWorkflowExecutions (eval at Codegen (\@protobufjs\codegen\index.js:50:33), <anonymous>:4:15)
    at deleteTemporal (D:\MyProjects\sinric_pro\server\server\services\automation.service.js:99:57)
    at processTicksAndRejections (node:internal/process/task_queues:96:5) {
  code: 3,
  details: 'Namespace is empty.',
  metadata: Metadata {
    internalRepr: Map(1) { 'content-type' => [Array] },
    options: {}
  }
}
```

![image](https://github.com/temporalio/sdk-typescript/assets/7474406/5503f629-e0b9-4c6d-80e5-3d6e4307b74f)

mus be

```
 const response = await connection.workflowService.listWorkflowExecutions({
        namespace: 'default',
        query: `WorkflowId = "${history.workflowId}"`, 
});
```

Using

 "@temporalio/activity": "^1.9.0",
 "@temporalio/client": "^1.9.0",
 "@temporalio/worker": "^1.9.0",
 "@temporalio/workflow": "^1.9.0",
 


#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-29 15:10:20.000 UTC</summary>

`connection.workflowService.*` is the low level gRPC API. Files there gets automatically generated from our [protobuf definitions](https://github.com/temporalio/api). Unfortunately, there is no way to have that generator mark required properties as non-optional (actually, the notion of a "required" property, as in "it must be defined by the caller", doesn't even exist in protobuf 3).

I strongly recommend you use [client.workflow.list](https://typescript.temporal.io/api/classes/client.WorkflowClient#list) instead, which is the high level API to list workflows. It provides a more intuitive API, and handle pagination internally.

</details>


---

<a id="1331"></a>

### #1331: [Feature Request] Schedule creation should create tracing span by default

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1331 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-01-03 21:12:47.000 UTC (2 years ago) |
| **Updated** | 2024-03-05 18:30:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

When the tracing interceptor is in use, by default creating a schedule should create a span for the schedule and set it on the workflow header if the action is starting a workflow. Users need to be able to opt-out in their tracing interceptor options.

#### Comments (1)

<details>
<summary><strong>cretz</strong> commented on 2024-03-05 18:30:09.000 UTC</summary>

(do not blindly implement as is, see discussion starting with comment https://github.com/temporalio/features/issues/394#issuecomment-1966551344 before proceeding)

</details>


---

<a id="1329"></a>

### #1329: nyc-test-coverage-1.9.0-rc.0.tgz: 2 vulnerabilities (highest severity is: 8.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1329 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2024-01-02 17:59:05.000 UTC (2 years ago) |
| **Updated** | 2024-01-10 15:35:45.000 UTC |
| **Closed** | 2024-01-10 15:35:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.9.0-rc.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/53aab9e975ea2924ff14d03da9e695b76f71f8bd">53aab9e975ea2924ff14d03da9e695b76f71f8bd</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-45133](https://www.mend.io/vulnerability-database/CVE-2023-45133) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 8.8 | traverse-7.21.4.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2023-45133</summary>


###  Vulnerable Library - <b>traverse-7.21.4.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/@babel/traverse/-/traverse-7.21.4.tgz">https://registry.npmjs.org/@babel/traverse/-/traverse-7.21.4.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.9.0-rc.0.tgz (Root Library)
    - istanbul-lib-instrument-5.2.1.tgz
      - core-7.21.4.tgz
        - :x: **traverse-7.21.4.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/53aab9e975ea2924ff14d03da9e695b76f71f8bd">53aab9e975ea2924ff14d03da9e695b76f71f8bd</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Babel is a compiler for writingJavaScript. In `@babel/traverse` prior to versions 7.23.2 and 8.0.0-alpha.4 and all versions of `babel-traverse`, using Babel to compile code that was specifically crafted by an attacker can lead to arbitrary code execution during compilation, when using plugins that rely on the `path.evaluate()`or `path.evaluateTruthy()` internal Babel methods. Known affected plugins are `@babel/plugin-transform-runtime`; `@babel/preset-env` when using its `useBuiltIns` option; and any "polyfill provider" plugin that depends on `@babel/helper-define-polyfill-provider`, such as `babel-plugin-polyfill-corejs3`, `babel-plugin-polyfill-corejs2`, `babel-plugin-polyfill-es-shims`, `babel-plugin-polyfill-regenerator`. No other plugins under the `@babel/` namespace are impacted, but third-party plugins might be. Users that only compile trusted code are not impacted. The vulnerability has been fixed in `@babel/traverse@7.23.2` and `@babel/traverse@8.0.0-alpha.4`. Those who cannot upgrade `@babel/traverse` and are using one of the affected packages mentioned above should upgrade them to their latest version to avoid triggering the vulnerable code path in affected `@babel/traverse` versions: `@babel/plugin-transform-runtime` v7.23.2, `@babel/preset-env` v7.23.2, `@babel/helper-define-polyfill-provider` v0.4.3, `babel-plugin-polyfill-corejs2` v0.4.6, `babel-plugin-polyfill-corejs3` v0.8.5, `babel-plugin-polyfill-es-shims` v0.10.0, `babel-plugin-polyfill-regenerator` v0.5.3.

<p>Publish Date: 2023-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-45133>CVE-2023-45133</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Changed
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92">https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92</a></p>
<p>Release Date: 2023-10-12</p>
<p>Fix Resolution: @babel/traverse - 7.23.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.9.0-rc.0.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/53aab9e975ea2924ff14d03da9e695b76f71f8bd">53aab9e975ea2924ff14d03da9e695b76f71f8bd</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2024-01-10 15:35:43.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1327"></a>

### #1327: [Feature Request] Validate input

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1327 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-12-27 06:59:49.000 UTC (2 years ago) |
| **Updated** | 2024-09-25 17:24:40.000 UTC |
| **Closed** | 2024-09-25 17:24:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

`client.workflow.start(type, { args: {} })` results in an opaque error message:

![image](https://github.com/temporalio/sdk-typescript/assets/251288/0958b186-fbf0-49d0-9c21-839c2b84a8fa)


### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Throw an error like `args must be an array`



#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-09-25 17:24:39.000 UTC</summary>

No longer pertinent.

</details>


---

<a id="1323"></a>

### #1323: Missing test coverage for Prometheus server

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1323 |
| **State** | CLOSED |
| **Author** | dandavison (Dan Davison) |
| **Created** | 2023-12-20 18:36:32.000 UTC (2 years ago) |
| **Updated** | 2024-01-09 18:44:35.000 UTC |
| **Closed** | 2024-01-09 18:44:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

A worker started with
```typescript
Runtime.install({ telemetryOptions: { metrics: { prometheus: { bindAddress: '0.0.0.0:9090' } } } });
```
should bring up a server listening for metrics requests on 9090. This works on `v1.8.6` but is broken in `v1.9.0-rc.0`.

Add tests to catch this.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 18:44:35.000 UTC</summary>

Fixed by #1324.

</details>


---

<a id="1316"></a>

### #1316: @temporalio/nyc-test-coverage-1.9.0-rc.0.tgz: 2 vulnerabilities (highest severity is: 8.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1316 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-12-08 18:15:53.000 UTC (2y 1m ago) |
| **Updated** | 2024-01-02 17:59:08.000 UTC |
| **Closed** | 2024-01-02 17:59:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.9.0-rc.0.tgz</b></p></summary>

<p></p>
<p>Path to vulnerable library: /package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/840fc3649690c6fc799e1f31ec7a8a31b334d30c">840fc3649690c6fc799e1f31ec7a8a31b334d30c</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-45133](https://www.mend.io/vulnerability-database/CVE-2023-45133) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 8.8 | traverse-7.21.4.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2023-45133</summary>


###  Vulnerable Library - <b>traverse-7.21.4.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/@babel/traverse/-/traverse-7.21.4.tgz">https://registry.npmjs.org/@babel/traverse/-/traverse-7.21.4.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.9.0-rc.0.tgz (Root Library)
    - istanbul-lib-instrument-5.2.1.tgz
      - core-7.21.4.tgz
        - :x: **traverse-7.21.4.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/840fc3649690c6fc799e1f31ec7a8a31b334d30c">840fc3649690c6fc799e1f31ec7a8a31b334d30c</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Babel is a compiler for writingJavaScript. In `@babel/traverse` prior to versions 7.23.2 and 8.0.0-alpha.4 and all versions of `babel-traverse`, using Babel to compile code that was specifically crafted by an attacker can lead to arbitrary code execution during compilation, when using plugins that rely on the `path.evaluate()`or `path.evaluateTruthy()` internal Babel methods. Known affected plugins are `@babel/plugin-transform-runtime`; `@babel/preset-env` when using its `useBuiltIns` option; and any "polyfill provider" plugin that depends on `@babel/helper-define-polyfill-provider`, such as `babel-plugin-polyfill-corejs3`, `babel-plugin-polyfill-corejs2`, `babel-plugin-polyfill-es-shims`, `babel-plugin-polyfill-regenerator`. No other plugins under the `@babel/` namespace are impacted, but third-party plugins might be. Users that only compile trusted code are not impacted. The vulnerability has been fixed in `@babel/traverse@7.23.2` and `@babel/traverse@8.0.0-alpha.4`. Those who cannot upgrade `@babel/traverse` and are using one of the affected packages mentioned above should upgrade them to their latest version to avoid triggering the vulnerable code path in affected `@babel/traverse` versions: `@babel/plugin-transform-runtime` v7.23.2, `@babel/preset-env` v7.23.2, `@babel/helper-define-polyfill-provider` v0.4.3, `babel-plugin-polyfill-corejs2` v0.4.6, `babel-plugin-polyfill-corejs3` v0.8.5, `babel-plugin-polyfill-es-shims` v0.10.0, `babel-plugin-polyfill-regenerator` v0.5.3.

<p>Publish Date: 2023-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-45133>CVE-2023-45133</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Changed
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92">https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92</a></p>
<p>Release Date: 2023-10-12</p>
<p>Fix Resolution: @babel/traverse - 7.23.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.9.0-rc.0.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/840fc3649690c6fc799e1f31ec7a8a31b334d30c">840fc3649690c6fc799e1f31ec7a8a31b334d30c</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2024-01-02 17:59:07.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1285"></a>

### #1285: [Feature Request] Support Deno

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1285 |
| **State** | CLOSED |
| **Author** | vwkd |
| **Created** | 2023-11-09 15:20:32.000 UTC (2y 2m ago) |
| **Updated** | 2023-11-10 17:10:45.000 UTC |
| **Closed** | 2023-11-10 17:10:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Add support for Deno.

It would be great if we could write code like in Deno, which offers native Web APIs like `fetch` and executes TypeScript without a build step.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-11-10 17:10:45.000 UTC</summary>

Sure, we really wish to support Deno at some point. There‚Äôs no debate on it‚Äôs advantages.

However, getting there will require considerable efforts. For context, TS SDK heavily depends on Worker Threads, VMs, async hooks, promise hooks, native libraries, and many other node-specific APIs. Yes, Deno provides compatibility or alternatives for most of these APIs, but last time I checked, Deno's implementations were not complete enough to support the kind of low level stuff that TS SDK does. But I'm very happy to see that things are progressing in the right direction (welcome `ShadowRealm`!).

In practice, I expect that we'll probably need to rewrite/redesign several key components of the TypeScript SDK to get it to run reliably and efficiently on Deno. We may also need to redesign parts of the Core SDK, notably to allow it to be usable as a WASM module rather than a NAPI library.

It seems very unlikely that we'll be able to make this a thing in the upcoming year. For now, I will close this ticket, as we use a different system to track and prioritize this kind of long-term/large-scale objectives.

Reactions: üëç 1

</details>


---

<a id="1274"></a>

### #1274: [Bug] Error not serialized fully when sent to Sinks

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1274 |
| **State** | OPEN |
| **Author** | marcoreni (Marco Reni) |
| **Created** | 2023-10-30 13:02:35.000 UTC (2y 2m ago) |
| **Updated** | 2023-10-30 19:00:24.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëÄ 1 |

#### Description

### What are you really trying to do?

Sending an error to a Sink function and preserve all the attributes.

### Describe the bug

It seems that the error that the error received from the sink function has less fields than the error which was sent.

For example: we're creating an ApplicationFailure.nonRetryable from a child workflow, and we're intercepting the error inside the parent workflow.

Error inside the parent workflow:
```js
{
  cause: {
    cause: undefined,
    type: 'my_error_type',
    nonRetryable: true,
    details: [],
    failure: {
      message: 'my_error_message',
      source: 'TypeScriptSDK',
      stackTrace: 'ApplicationFailure: my_error_message\n' +
        '    at Function.nonRetryable (/usr/app/node_modules/.pnpm/@temporalio+common@1.8.6/node_modules/@temporalio/common/src/failure.ts:149:11)\n' +
        '    at nonRetryable (/usr/app/src/workflows/index.ts:51:28)',
      applicationFailureInfo: [Object]
    },
    name: 'ApplicationFailure',
    message: 'my_error_message',
    stack: 'ApplicationFailure: my_error_message\n' +
      '    at Function.nonRetryable (/usr/app/node_modules/.pnpm/@temporalio+common@1.8.6/node_modules/@temporalio/common/src/failure.ts:149:11)\n' +
      '    at nonRetryable (/usr/app/src/workflows/index.ts:51:28)'
  },
  namespace: 'default',
  execution: {
    workflowId: '1698670214662-foobar',
    runId: 'd46839c0-2255-489b-b8ea-37b41b8501e9'
  },
  workflowType: 'my_workflow_type',
  retryState: 5,
  failure: {
    message: 'Child Workflow execution failed',
    cause: {
      message: 'my_error:message',
      source: 'TypeScriptSDK',
      stackTrace: 'ApplicationFailure: my_error_message\n' +
        '    at Function.nonRetryable (/usr/app/node_modules/.pnpm/@temporalio+common@1.8.6/node_modules/@temporalio/common/src/failure.ts:149:11)\n' +
        '    at nonRetryable (/usr/app/src/workflows/index.ts:51:28)',
      applicationFailureInfo: [Object]
    },
    childWorkflowExecutionFailureInfo: {
      namespace: 'default',
      workflowExecution: [Object],
      workflowType: [Object],
      initiatedEventId: '23',
      startedEventId: '24',
      retryState: 'RETRY_STATE_RETRY_POLICY_NOT_SET'
    }
  },
  name: 'ChildWorkflowFailure',
  message: 'Child Workflow execution failed',
  stack: ''
}

```


Error that is received from the sink:
```js
{
  name: "Error",
  message: "Child Workflow execution failed",
  stack: "",
  cause: {
    name: "Error",
    message: "my_error_message",
    stack:
      "ApplicationFailure: my_error_message\n" +
      "    at Function.nonRetryable (/usr/app/node_modules/.pnpm/@temporalio+common@1.8.6/node_modules/@temporalio/common/src/failure.ts:149:11)\n" +
      "    at nonRetryable (/usr/app/src/workflows/index.ts:51:28)",
  },
};

```

Given that, IIUC, the sink is implemented via a postMessage, would it be possible to extend the serialization format of the error so that more fields are passed through (more specifically, we're currently interested in `type` and `details` of the cause)?

### Minimal Reproduction

N/A

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version: 1.8.6
- Are you using Docker or Kubernetes or building Temporal from source? Docker

### Additional context


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-10-30 19:00:24.000 UTC</summary>

This is a known limitation of sinks. As you pointed out, the data is transferred over `postMessage` from a worker thread to the main Node.js thread which uses the structured clone algorithm.

https://nodejs.org/api/worker_threads.html#portpostmessagevalue-transferlist

Looks like our documentation doesn't call out this limitation clearly enough though. I think we should add this information on `proxySinks` and the `WorkerOptions.sinks`.

https://typescript.temporal.io/api/namespaces/workflow#sinkfunction

</details>


---

<a id="1262"></a>

### #1262: [Feature Request][TS] Expose `StartWorkflowOptions.workflowStartDelay`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1262 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-10-18 14:05:14.000 UTC (2y 2m ago) |
| **Updated** | 2023-11-30 20:26:19.000 UTC |
| **Closed** | 2023-11-30 20:26:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

- `workflowStartDelay` was introduced recently in server. Need to expose it in `StartWorkflowOptions`

#### Comments (1)

<details>
<summary><strong>cretz</strong> commented on 2023-10-18 15:51:10.000 UTC</summary>

I recommend calling this just `startDelay`

Reactions: üëç 3

</details>


---

<a id="1260"></a>

### #1260: nyc-test-coverage-1.8.6.tgz: 2 vulnerabilities (highest severity is: 8.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1260 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-10-12 15:58:12.000 UTC (2y 3m ago) |
| **Updated** | 2023-12-08 18:15:57.000 UTC |
| **Closed** | 2023-12-08 18:15:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.8.6.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/35c60051273e82bf87f25645b98b33b8b067791a">35c60051273e82bf87f25645b98b33b8b067791a</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-45133](https://www.mend.io/vulnerability-database/CVE-2023-45133) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 8.8 | traverse-7.21.4.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2023-45133</summary>


###  Vulnerable Library - <b>traverse-7.21.4.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/@babel/traverse/-/traverse-7.21.4.tgz">https://registry.npmjs.org/@babel/traverse/-/traverse-7.21.4.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.8.6.tgz (Root Library)
    - istanbul-lib-instrument-5.2.1.tgz
      - core-7.21.4.tgz
        - :x: **traverse-7.21.4.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/35c60051273e82bf87f25645b98b33b8b067791a">35c60051273e82bf87f25645b98b33b8b067791a</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Babel is a compiler for writingJavaScript. In `@babel/traverse` prior to versions 7.23.2 and 8.0.0-alpha.4 and all versions of `babel-traverse`, using Babel to compile code that was specifically crafted by an attacker can lead to arbitrary code execution during compilation, when using plugins that rely on the `path.evaluate()`or `path.evaluateTruthy()` internal Babel methods. Known affected plugins are `@babel/plugin-transform-runtime`; `@babel/preset-env` when using its `useBuiltIns` option; and any "polyfill provider" plugin that depends on `@babel/helper-define-polyfill-provider`, such as `babel-plugin-polyfill-corejs3`, `babel-plugin-polyfill-corejs2`, `babel-plugin-polyfill-es-shims`, `babel-plugin-polyfill-regenerator`. No other plugins under the `@babel/` namespace are impacted, but third-party plugins might be. Users that only compile trusted code are not impacted. The vulnerability has been fixed in `@babel/traverse@7.23.2` and `@babel/traverse@8.0.0-alpha.4`. Those who cannot upgrade `@babel/traverse` and are using one of the affected packages mentioned above should upgrade them to their latest version to avoid triggering the vulnerable code path in affected `@babel/traverse` versions: `@babel/plugin-transform-runtime` v7.23.2, `@babel/preset-env` v7.23.2, `@babel/helper-define-polyfill-provider` v0.4.3, `babel-plugin-polyfill-corejs2` v0.4.6, `babel-plugin-polyfill-corejs3` v0.8.5, `babel-plugin-polyfill-es-shims` v0.10.0, `babel-plugin-polyfill-regenerator` v0.5.3.

<p>Publish Date: 2023-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-45133>CVE-2023-45133</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Changed
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92">https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92</a></p>
<p>Release Date: 2023-10-12</p>
<p>Fix Resolution: @babel/traverse - 7.23.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.8.6.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/35c60051273e82bf87f25645b98b33b8b067791a">35c60051273e82bf87f25645b98b33b8b067791a</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-12-08 18:15:56.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1259"></a>

### #1259: [Bug] MockActivityEnvironment holds open handle prevents jest from exiting

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1259 |
| **State** | CLOSED |
| **Author** | shawnjones253 (Shawn Jones) |
| **Created** | 2023-10-12 03:15:14.000 UTC (2y 3m ago) |
| **Updated** | 2023-10-12 20:33:55.000 UTC |
| **Closed** | 2023-10-12 20:33:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Run a temporal activity within a jest test.

### Describe the bug

Jest can't exit after instantiating MockActivityEnvironment, even if I don't actually use the MockActivityEnvironment to run an activity.

### Minimal Reproduction

```
test('some test', async () => {
  const env = new MockActivityEnvironment()
  // whether or not you use env.run() doesn't seem to matter...
}
```

```
Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ‚óè  neon threadsafe function

      261 |
      262 |   test('some test', async () => {
    > 263 |     const env = new MockActivityEnvironment()
          |                 ^

 at ../../node_modules/@temporalio/core-bridge/index.js:16:14
      at Function.create (../../node_modules/@temporalio/worker/src/runtime.ts:208:31)
      at Function.instance (../../node_modules/@temporalio/worker/src/runtime.ts:196:17)
      at new MockActivityEnvironment (../../node_modules/@temporalio/testing/src/index.ts:413:15)
```
### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version: 1.8.1
- Are you using Docker or Kubernetes or building Temporal from source? No

### Additional context




#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-10-12 20:33:54.000 UTC</summary>

Duplicate of #928 

</details>


---

<a id="1256"></a>

### #1256: [Feature Request] Deprecate `appendDefaultInterceptors`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1256 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-10-04 19:50:44.000 UTC (2y 3m ago) |
| **Updated** | 2024-01-09 18:31:36.000 UTC |
| **Closed** | 2024-01-09 18:31:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Context

- `appendDefaultInterceptors()` is quite easy to miss => Bad developer experience.
- Since 1.8, prepending `defaultSink()` is no longer required => Better DX

## Description

- Make it so that Workflow life cycle logging no longer require calling `appendDefaultInterceptors()`, either by moving those log calls out of the interceptor into the activator, or by forcibly injecting that interceptor.
- In both case, `appendDefaultInterceptors()` would now be a noop, which can then be deprecated.
- Same for activity logger

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 18:31:36.000 UTC</summary>

Fixed in #1290

</details>


---

<a id="1246"></a>

### #1246: @temporalio/nyc-test-coverage-1.8.6.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1246 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-09-13 23:00:48.000 UTC (2y 3m ago) |
| **Updated** | 2023-10-12 15:58:19.000 UTC |
| **Closed** | 2023-10-12 15:58:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.8.6.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.8.6.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-10-12 15:58:18.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1241"></a>

### #1241: @temporalio/nyc-test-coverage-1.8.5.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1241 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-09-12 20:56:45.000 UTC (2y 3m ago) |
| **Updated** | 2023-09-13 23:00:51.000 UTC |
| **Closed** | 2023-09-13 23:00:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.8.5.tgz</b></p></summary>

<p></p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.8.5.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-09-13 23:00:51.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1231"></a>

### #1231: Unknown typescript syntax. 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1231 |
| **State** | CLOSED |
| **Author** | azakaryan (Armen Zakaryan) |
| **Created** | 2023-08-30 14:22:32.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-31 08:33:49.000 UTC |
| **Closed** | 2023-08-31 08:32:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

https://github.com/temporalio/sdk-typescript/blob/be98c23a9fdbdd30caa9b607f2cf44a56b4cd0a3/packages/common/src/deprecated-time.ts#L2



#### Comments (1)

<details>
<summary><strong>azakaryan</strong> commented on 2023-08-31 08:33:48.000 UTC</summary>

Using typescript > 5.1 helps to recognise this syntax.

</details>


---

<a id="1230"></a>

### #1230: [Feature Request] register custom search attribute on `TestWorkflowEnvironment`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1230 |
| **State** | CLOSED |
| **Author** | Yihao-G (Yihao Gao) |
| **Created** | 2023-08-30 05:42:13.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-30 06:14:09.000 UTC |
| **Closed** | 2023-08-30 06:14:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

One of my workflows upserts a custom search attribute which if I run it with `TestWorkflowEnvironment`, will get an error because the search attribute isn't registered.

The Java SDK has [the `registerSearchAttribute` method](https://www.javadoc.io/doc/io.temporal/temporal-testing/latest/io/temporal/testing/TestWorkflowEnvironment.html#registerSearchAttribute(java.lang.String,io.temporal.api.enums.v1.IndexedValueType)) on `TestWorkflowEnvironment`. 

I looked into the TS SDK's type declaration and documentation, it seems there is nowhere I can register a search attribute.

I also tried `temporal operator search-attribute create --name MyCustomAttr --type Int --address 127.0.0.1:7233`, but it gives me `Error: unable to get existing search attributes: Method temporal.api.operatorservice.v1.OperatorService/ListSearchAttributes is unimplemented`.

### Describe the solution you'd like

Add `registerSearchAttribute` method to `TestWorkflowEnvironment` interface

### Additional context

May need to update https://github.com/temporalio/sdk-java/tree/master/temporal-test-server so the test server can handle custom search attributes.

#### Comments (1)

<details>
<summary><strong>Yihao-G</strong> commented on 2023-08-30 06:14:09.000 UTC</summary>

Nevermind ü§¶ 

```typescript
  await temporalTestEnv.connection.operatorService
    .addSearchAttributes({
      searchAttributes: {
        MyCustomAttr1: IndexedValueType.INDEXED_VALUE_TYPE_INT,
        MyCustomAttr2: IndexedValueType.INDEXED_VALUE_TYPE_INT,
      },
    })
```

Ref: https://github.com/temporalio/sdk-typescript/pull/657#issuecomment-1563470532

It's quite hidden though. Would be good if it could be documented somewhere.

</details>


---

<a id="1228"></a>

### #1228: nyc-test-coverage-1.8.4.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1228 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-29 17:18:04.000 UTC (2y 4m ago) |
| **Updated** | 2023-09-12 20:56:51.000 UTC |
| **Closed** | 2023-09-12 20:56:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.8.4.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/be98c23a9fdbdd30caa9b607f2cf44a56b4cd0a3">be98c23a9fdbdd30caa9b607f2cf44a56b4cd0a3</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.8.4.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/be98c23a9fdbdd30caa9b607f2cf44a56b4cd0a3">be98c23a9fdbdd30caa9b607f2cf44a56b4cd0a3</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-09-12 20:56:51.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1227"></a>

### #1227: [Clarification] Behavior of `signalWithStart`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1227 |
| **State** | CLOSED |
| **Author** | samwaterbury (Sam Waterbury) |
| **Created** | 2023-08-27 19:35:43.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-28 20:07:58.000 UTC |
| **Closed** | 2023-08-28 20:07:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I was reading through the release notes while planning to upgrade our team to the latest version of the `@temporalio/*` packages and I found [this note for version 1.8.3](https://github.com/temporalio/sdk-typescript/releases/tag/v1.8.3):

> - [`client`] Throw `WorkflowExecutionAlreadyStartedError` on `signalWithStart` ([#1199](https://github.com/temporalio/sdk-typescript/pull/1199) thanks to [`@satazor`](https://github.com/satazor) üôè)

The [official documentation](https://docs.temporal.io/dev-guide/typescript/features#signal-with-start) describes the signal-with-start pattern by saying the following:

> Signal-With-Start is used from the Client. It takes a Workflow Id, Workflow arguments, a Signal name, and Signal arguments.
>
> If there's a Workflow running with the given Workflow Id, it will be signaled. If there isn't, a new Workflow will be started and immediately signaled.

This implies to me that if the workflow _is_ running, it will be signaled without error. The [API docs](https://typescript.temporal.io/api/classes/client.WorkflowClient#signalwithstart) corroborate this:

> Sends a Signal to a running Workflow or starts a new one if not already running and immediately Signals it. Useful when you're unsure whether the Workflow has been started.

I just want verify whether:

1. I am misunderstanding the release notes or they perhaps were simply worded incorrectly
2. This behavior is in fact changed and `signalWithStart` now throws an exception when the workflow is already running (which would be a pretty hard regression IMO)

Thank you! üôè 

#### Comments (1)

<details>
<summary><strong>samwaterbury</strong> commented on 2023-08-28 20:07:26.000 UTC</summary>

I forgot the Slack workspace exists ‚Äî copy/pasting the answer I got over there:

> You are mostly right. In general `signalWithStart` should not throw `WorkflowExecutionAlreadyStartedError`.

> However, if `signalWithStart` is called with the `workflowIdReusePolicy`: `WORKFLOW_ID_REUSE_POLICY_REJECT_DUPLICATE` option (or some other values), and a workflow with that workflow id already exist, but it is no longer running, then the server would indeed send back that specific error.

> That is very rare case, as common usage patterns for `signalWithStart` assume that if the workflow is no longer running, then a new execution should be started, and therefore, `workflowIdReusePolicy` will be left to `WORKFLOW_ID_REUSE_POLICY_ALLOW_DUPLICATE` (that‚Äôs the default value)

Going to close this issue!

</details>


---

<a id="1222"></a>

### #1222: [Feature Request] Expose `originalExecutionRunId` in `workflowInfo`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1222 |
| **State** | OPEN |
| **Author** | PenguinToast (William Sheu) |
| **Created** | 2023-08-22 21:33:28.000 UTC (2y 4m ago) |
| **Updated** | 2024-09-27 16:55:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.
We have a use case where we'd like to deterministically seed a PRNG in a workflow context -- for this, we'd need a value that stays stable throughout Resets but changes on Continue-As-New/Cron. From my understanding reading the [docs](https://docs.temporal.io/workflows#which-operations-lead-to-non-determinism-issues), `originalExecutionRunId` would work for this use case. 

### Describe the solution you'd like
Can we get this `originalExecutionRunId` exposed in `workflowInfo()`?

### Additional context
If i'm misunderstanding the documentation and this isn't actually the value I want, I'm certainly open to other suggestions for our use case!



#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-08-25 15:33:01.000 UTC</summary>

We need to expose it but note that `Math.random()` is a deterministic random seeded using the originalRunId and updated when the run ID changes (in workflow reset cases).

</details>


---

<a id="1220"></a>

### #1220: @temporalio/nyc-test-coverage-1.8.4.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1220 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-22 20:49:42.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-29 17:18:14.000 UTC |
| **Closed** | 2023-08-29 17:18:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.8.4.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>

<p>Found in HEAD commit: [9fb84945622c5dd5894a30af2157d4cba771d5d0](https://github.com/temporalio/sdk-typescript/commit/9fb84945622c5dd5894a30af2157d4cba771d5d0)</p></details>

## Vulnerabilities
| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Possible** |
|----|----|----|----|----|----|----|
|[CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |

<p>_For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>_*In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details
<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>

### Vulnerable Library - <b>semver-7.5.0.tgz</b></p>
<p></p>
<p>Library home page: [https://registry.npmjs.org/semver/-/semver-7.5.0.tgz](https://registry.npmjs.org/semver/-/semver-7.5.0.tgz)</p>
<p>

Dependency Hierarchy:


* @temporalio/nyc-test-coverage-1.8.4.tgz (Root Library)
  * ts-loader-9.4.2.tgz
    * :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: [9fb84945622c5dd5894a30af2157d4cba771d5d0](https://github.com/temporalio/sdk-typescript/commit/9fb84945622c5dd5894a30af2157d4cba771d5d0)</p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

### Vulnerability Details
<p>

Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883)</p>
</p>

<p></p>

### CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:


* Exploitability Metrics:
  * Attack Vector: Network
  * Attack Complexity: Low
  * Privileges Required: None
  * User Interaction: None
  * Scope: Unchanged
* Impact Metrics:
  * Confidentiality Impact: None
  * Integrity Impact: None
  * Availability Impact: High
</p>
For more information on CVSS3 Scores, click [here](https://www.first.org/cvss/calculator/3.0).
</p>

<p></p>

### Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: [https://github.com/advisories/GHSA-c2qf-rxjj-qqgw](https://github.com/advisories/GHSA-c2qf-rxjj-qqgw)</p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>



#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-29 17:18:13.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1214"></a>

### #1214: nyc-test-coverage-1.8.3.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1214 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-22 19:31:10.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-22 20:50:05.000 UTC |
| **Closed** | 2023-08-22 20:50:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.8.3.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.8.3.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-22 20:50:05.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1213"></a>

### #1213: client-1.8.3.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1213 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-22 19:31:05.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-22 20:50:02.000 UTC |
| **Closed** | 2023-08-22 20:50:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>client-1.8.3.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/interceptors-opentelemetry/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/51c513a59a8573d816a6abc3d63401460c98f138">51c513a59a8573d816a6abc3d63401460c98f138</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (client version) | Remediation Possible** |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-36665](https://www.mend.io/vulnerability-database/CVE-2023-36665) | <img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> Critical | 9.8 | protobufjs-7.2.3.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>**In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> CVE-2023-36665</summary>


###  Vulnerable Library - <b>protobufjs-7.2.3.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz</a></p>
<p>

Dependency Hierarchy:
  - client-1.8.3.tgz (Root Library)
    - :x: **protobufjs-7.2.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/51c513a59a8573d816a6abc3d63401460c98f138">51c513a59a8573d816a6abc3d63401460c98f138</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
protobuf.js (aka protobufjs) 6.10.0 through 7.x before 7.2.4 allows Prototype Pollution, a different vulnerability than CVE-2022-25878. A user-controlled protobuf message can be used by an attacker to pollute the prototype of Object.prototype by adding and overwriting its data and functions. Exploitation can involve: (1) using the function parse to parse protobuf messages on the fly, (2) loading .proto files by using load/loadSync functions, or (3) providing untrusted input to the functions ReflectionObject.setParsedOption and util.setProperty. NOTE: this CVE Record is about "Object.constructor.prototype.<new-property> = ...;" whereas CVE-2022-25878 was about "Object.__proto__.<new-property> = ...;" instead.

<p>Publish Date: 2023-07-05
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-36665>CVE-2023-36665</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665">https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665</a></p>
<p>Release Date: 2023-07-05</p>
<p>Fix Resolution: protobufjs - 7.2.4</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-22 20:50:02.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1196"></a>

### #1196: [Bug] Typo in `defaultWorflowInterceptorModules` API

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1196 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-08-09 23:38:30.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-16 22:47:27.000 UTC |
| **Closed** | 2023-08-16 22:47:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

See [here](https://typescript.temporal.io/api/namespaces/worker#defaultworflowinterceptormodules).

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-16 22:47:27.000 UTC</summary>

Fixed by #1204.

</details>


---

<a id="1194"></a>

### #1194: [Bug] Workflow bundle size increased by 1.5MB between 1.8.0 and 1.8.1

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1194 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-08-09 15:44:51.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-16 22:47:54.000 UTC |
| **Closed** | 2023-08-16 22:47:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

The workflow bundle size increased by ~1.5 MB between TS SDK 1.8.0 and 1.8.1.

This is very likely due to the addition of a dependency on the `protobuf` package in `workflow.ts` (see [here](https://github.com/temporalio/sdk-typescript/compare/v1.8.0...v1.8.1#diff-1daa17a864bbcdffc2397155620d7b4624edd1e0ffb40b2083f1dd1b65cc241bR1332-R1343)).

### Minimal Reproduction

Starting with the [production sample](https://github.com/temporalio/samples-typescript/tree/main/production), from the samples-typescript repo, set all `@temporalio/*` dependencies to `"1.8.0"`, then run `rm -rf node_modules lib ; npm i ; npm run build ; npm run build:workflow`. At this point, observe that bundle size is 0.73MB.

Doing the same steps, with all `@temporalio/*` dependencies set to `"1.8.1"`, observe that the generated bundle size is now 2.25MB.

Running `grep '!\*\*\* ' workflow-bundle.js` on both generated bundles shows that the second include lot of `protobufjs` files, while the first bundle don't.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-08-16 22:47:54.000 UTC</summary>

Fixed by #1203 

</details>


---

<a id="1191"></a>

### #1191: @temporalio/client-1.8.2.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1191 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-02 21:05:05.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-16 18:33:35.000 UTC |
| **Closed** | 2023-08-16 18:33:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/client-1.8.2.tgz</b></p></summary>

<p></p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/8525b033137bb506bc1e63886ac3ef2957ad5a53">8525b033137bb506bc1e63886ac3ef2957ad5a53</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/client version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-36665](https://www.mend.io/vulnerability-database/CVE-2023-36665) | <img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> Critical | 9.8 | protobufjs-7.2.3.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> CVE-2023-36665</summary>


###  Vulnerable Library - <b>protobufjs-7.2.3.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/client-1.8.2.tgz (Root Library)
    - :x: **protobufjs-7.2.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/8525b033137bb506bc1e63886ac3ef2957ad5a53">8525b033137bb506bc1e63886ac3ef2957ad5a53</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
protobuf.js (aka protobufjs) 6.10.0 through 7.x before 7.2.4 allows Prototype Pollution, a different vulnerability than CVE-2022-25878. A user-controlled protobuf message can be used by an attacker to pollute the prototype of Object.prototype by adding and overwriting its data and functions. Exploitation can involve: (1) using the function parse to parse protobuf messages on the fly, (2) loading .proto files by using load/loadSync functions, or (3) providing untrusted input to the functions ReflectionObject.setParsedOption and util.setProperty. NOTE: this CVE Record is about "Object.constructor.prototype.<new-property> = ...;" whereas CVE-2022-25878 was about "Object.__proto__.<new-property> = ...;" instead.

<p>Publish Date: 2023-07-05
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-36665>CVE-2023-36665</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665">https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665</a></p>
<p>Release Date: 2023-07-05</p>
<p>Fix Resolution: protobufjs - 7.2.4</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-16 18:33:34.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1190"></a>

### #1190: @temporalio/nyc-test-coverage-1.8.2.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1190 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-02 21:05:00.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-16 18:33:37.000 UTC |
| **Closed** | 2023-08-16 18:33:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.8.2.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/8525b033137bb506bc1e63886ac3ef2957ad5a53">8525b033137bb506bc1e63886ac3ef2957ad5a53</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.8.2.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/8525b033137bb506bc1e63886ac3ef2957ad5a53">8525b033137bb506bc1e63886ac3ef2957ad5a53</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-16 18:33:37.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1168"></a>

### #1168: nyc-test-coverage-1.8.1.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1168 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-07-09 00:43:09.000 UTC (2y 6m ago) |
| **Updated** | 2023-08-02 21:05:15.000 UTC |
| **Closed** | 2023-08-02 21:05:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.8.1.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> High | 7.5 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.8.1.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-c2qf-rxjj-qqgw">https://github.com/advisories/GHSA-c2qf-rxjj-qqgw</a></p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 5.7.2,6.3.1,7.5.2;org.webjars.npm:semver:7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-02 21:05:15.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1167"></a>

### #1167: client-1.8.1.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1167 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-07-09 00:43:07.000 UTC (2y 6m ago) |
| **Updated** | 2023-08-02 21:05:13.000 UTC |
| **Closed** | 2023-08-02 21:05:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>client-1.8.1.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/interceptors-opentelemetry/package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/0a792088e13930b9dd4f0fcbebf24fc0b6cc6b74">0a792088e13930b9dd4f0fcbebf24fc0b6cc6b74</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (client version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-36665](https://www.mend.io/vulnerability-database/CVE-2023-36665) | <img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> Critical | 9.8 | protobufjs-7.2.3.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> CVE-2023-36665</summary>


###  Vulnerable Library - <b>protobufjs-7.2.3.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - client-1.8.1.tgz (Root Library)
    - :x: **protobufjs-7.2.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/0a792088e13930b9dd4f0fcbebf24fc0b6cc6b74">0a792088e13930b9dd4f0fcbebf24fc0b6cc6b74</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
protobuf.js (aka protobufjs) 6.10.0 through 7.x before 7.2.4 allows Prototype Pollution, a different vulnerability than CVE-2022-25878. A user-controlled protobuf message can be used by an attacker to pollute the prototype of Object.prototype by adding and overwriting its data and functions. Exploitation can involve: (1) using the function parse to parse protobuf messages on the fly, (2) loading .proto files by using load/loadSync functions, or (3) providing untrusted input to the functions ReflectionObject.setParsedOption and util.setProperty. NOTE: this CVE Record is about "Object.constructor.prototype.<new-property> = ...;" whereas CVE-2022-25878 was about "Object.__proto__.<new-property> = ...;" instead.

<p>Publish Date: 2023-07-05
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-36665>CVE-2023-36665</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665">https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665</a></p>
<p>Release Date: 2023-07-05</p>
<p>Fix Resolution: protobufjs - 7.2.4</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-08-02 21:05:12.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1164"></a>

### #1164: client-1.8.0.tgz: 1 vulnerabilities (highest severity is: 5.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1164 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-07-07 21:43:40.000 UTC (2y 6m ago) |
| **Updated** | 2023-07-09 00:43:16.000 UTC |
| **Closed** | 2023-07-09 00:43:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>client-1.8.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (client version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-36665](https://www.mend.io/vulnerability-database/CVE-2023-36665) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.5 | protobufjs-7.2.3.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2023-36665</summary>


###  Vulnerable Library - <b>protobufjs-7.2.3.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - client-1.8.0.tgz (Root Library)
    - :x: **protobufjs-7.2.3.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
protobuf.js (aka protobufjs) 6.10.0 through 7.x before 7.2.4 allows Prototype Pollution, a different vulnerability than CVE-2022-25878. A user-controlled protobuf message can be used by an attacker to pollute the prototype of Object.prototype by adding and overwriting its data and functions. Exploitation can involve: (1) using the function parse to parse protobuf messages on the fly, (2) loading .proto files by using load/loadSync functions, or (3) providing untrusted input to the functions ReflectionObject.setParsedOption and util.setProperty. NOTE: this CVE Record is about "Object.constructor.prototype.<new-property> = ...;" whereas CVE-2022-25878 was about "Object.__proto__.<new-property> = ...;" instead.

<p>Publish Date: 2023-07-05
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-36665>CVE-2023-36665</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665">https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665</a></p>
<p>Release Date: 2023-07-05</p>
<p>Fix Resolution: protobufjs - 7.2.4</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-07-09 00:43:15.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1163"></a>

### #1163: nyc-test-coverage-1.8.0.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1163 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-07-07 21:43:36.000 UTC (2y 6m ago) |
| **Updated** | 2023-07-09 00:43:13.000 UTC |
| **Closed** | 2023-07-09 00:43:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.8.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/6ccfd51b58a061c02dd9483fa4136cda6f65c25d">6ccfd51b58a061c02dd9483fa4136cda6f65c25d</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.3 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.8.0.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/6ccfd51b58a061c02dd9483fa4136cda6f65c25d">6ccfd51b58a061c02dd9483fa4136cda6f65c25d</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-07-09 00:43:12.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1155"></a>

### #1155: @temporalio/nyc-test-coverage-1.8.0.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1155 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-06-29 19:05:25.000 UTC (2y 6m ago) |
| **Updated** | 2023-07-07 21:43:44.000 UTC |
| **Closed** | 2023-07-07 21:43:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.8.0.tgz</b></p></summary>

<p></p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/67db40511427aa945f7bde08932257605e264bb8">67db40511427aa945f7bde08932257605e264bb8</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.3 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.8.0.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/67db40511427aa945f7bde08932257605e264bb8">67db40511427aa945f7bde08932257605e264bb8</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-07-07 21:43:44.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1145"></a>

### #1145: [Bug] Client.schedule.create is giving "Schedule not found" error if namespace is incorrect

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1145 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-06-22 17:03:09.000 UTC (2y 6m ago) |
| **Updated** | 2023-06-27 22:18:08.000 UTC |
| **Closed** | 2023-06-27 22:18:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Using a schedule client configured with a namespace that doesn't exist, trying to create a new schedule results in a "Schedule not found" exception, rather than something like "Namespace not found".

Very similar errors probably exists elsewhere on ScheduleClient and WorkflowClient.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-06-23 07:44:03.000 UTC</summary>

See also https://github.com/temporalio/sdk-typescript/issues/976 and the comment suggesting how it should be fixed.

</details>


---

<a id="1141"></a>

### #1141: nyc-test-coverage-1.7.4.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1141 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-06-21 21:09:03.000 UTC (2y 6m ago) |
| **Updated** | 2023-06-29 19:05:29.000 UTC |
| **Closed** | 2023-06-29 19:05:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.7.4.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/737eb923c37fbfb23e99d7ea9f585c5090ac16f5">737eb923c37fbfb23e99d7ea9f585c5090ac16f5</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25883](https://www.mend.io/vulnerability-database/CVE-2022-25883) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> Medium | 5.3 | semver-7.5.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png?' width=19 height=20> CVE-2022-25883</summary>


###  Vulnerable Library - <b>semver-7.5.0.tgz</b></p>

<p></p>
<p>Library home page: <a href="https://registry.npmjs.org/semver/-/semver-7.5.0.tgz">https://registry.npmjs.org/semver/-/semver-7.5.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/semver/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.7.4.tgz (Root Library)
    - ts-loader-9.4.2.tgz
      - :x: **semver-7.5.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/737eb923c37fbfb23e99d7ea9f585c5090ac16f5">737eb923c37fbfb23e99d7ea9f585c5090ac16f5</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package semver before 7.5.2 are vulnerable to Regular Expression Denial of Service (ReDoS) via the function new Range, when untrusted user data is provided as a range.

<p>Publish Date: 2023-06-21
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25883>CVE-2022-25883</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-06-21</p>
<p>Fix Resolution: semver - 7.5.2</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-06-29 19:05:28.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1114"></a>

### #1114: [Bug] `.cancel()` does not exists on child workflow handles

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1114 |
| **State** | CLOSED |
| **Author** | laura-turner-divvy (Laura Turner) |
| **Created** | 2023-05-02 19:42:14.000 UTC (2y 8m ago) |
| **Updated** | 2023-05-02 19:50:25.000 UTC |
| **Closed** | 2023-05-02 19:50:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am creating a child workflow as part of my workflow. In certain situations, I need to cancel the child workflow.

### Describe the bug

Creating a child workflow using `startChild` yields a `ChildWorkflowHandle<T>`, which says in the JSDoc "can be used to signal, wait for completion, and cancel a Workflow execution." However, there is no `cancel()` method on the `ChildWorkflowHandle` like there is for a `WorkflowHandle<T>` created via `client.workflow.getHandle(workflowId)`.

<img width="386" alt="image" src="https://user-images.githubusercontent.com/114932945/235768266-ba61bb63-89f2-409b-9928-4911e12d04ae.png">

### Minimal Reproduction

Create a child workflow via `await startChild(...)`. Attempt to cancel the workflow via `.cancel()`.

### Environment/Versions

- Temporal Version: `@temporalio/workflow` `1.7.2`

### Additional context

[Relevant Slack conversation](https://temporalio.slack.com/archives/C01DKSMU94L/p1683053747688419)

#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2023-05-02 19:50:25.000 UTC</summary>

Agree that would be nice! Tracking here: #740 

</details>


---

<a id="1095"></a>

### #1095: [Feature Request] Allow Webpack stats to be configured/disabled

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1095 |
| **State** | CLOSED |
| **Author** | clintonb (Clinton Blackburn) |
| **Created** | 2023-04-09 04:55:22.000 UTC (2y 9m ago) |
| **Updated** | 2023-04-12 18:07:43.000 UTC |
| **Closed** | 2023-04-12 18:07:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Our logs are littered with Webpack stats that aren't useful under normal circumstances. The color codes (enabled by default, with no option to disable) make the logs difficult to read in third-party logging systems (GCP Logs, in my case). Printing the logs across multiple lines is wasting money (very small, but still annoying) when exporting to systems that charge by the log line.

I wasted about an hour trying to configure Webpack via `webpackConfigHook` before looking at the code and learning the SDK is doing this, not Webpack.

### Describe the solution you'd like
Allow stats to be controlled via [Webpack's existing stats configuration](https://webpack.js.org/configuration/stats/). At a minimum, document the fact that these log lines cannot be toggled.


<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Additional context

This code needs to be changed:

https://github.com/temporalio/sdk-typescript/blob/2395e369a7c83ac8de43414761fbb44362f5b1ed/packages/worker/src/workflow/bundler.ts#L259-L274


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-04-12 18:07:42.000 UTC</summary>

You can disable the logging by calling `bundleWorkflowCode` with a separate logger.

```ts
const workflowBundle = await bundleWorkflowCode({
  ...bundlerOptions,
  logger: YOUR_LOGGER,
});

const worker = await Worker.create({
  ...workerOptions,
  workflowBundle,
});
```

Reactions: üëç 1

</details>


---

<a id="1091"></a>

### #1091: [Feature Request] Expose URL and URLSearchParams to workflow sandbox

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1091 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-03-31 20:28:42.000 UTC (2y 9m ago) |
| **Updated** | 2023-03-31 20:51:41.000 UTC |
| **Closed** | 2023-03-31 20:51:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Both APIs are available in every major JS runtime and are deterministic.

https://developer.mozilla.org/en-US/docs/Web/API/URL#browser_compatibility

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-03-31 20:51:40.000 UTC</summary>

Duplicate of https://github.com/temporalio/sdk-typescript/issues/981

</details>


---

<a id="1083"></a>

### #1083: instanceof not working

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1083 |
| **State** | CLOSED |
| **Author** | leran500 |
| **Created** | 2023-03-19 13:12:44.000 UTC (2y 9m ago) |
| **Updated** | 2023-03-20 04:19:03.000 UTC |
| **Closed** | 2023-03-20 04:19:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

HI
 i am using javascript/typedscript instanceof inside a workflow, and its fail everytime.
my workflow code:

const fileEntity: FileEntity | ActivityError = await getFileData(fileId);
if (fileEntity instanceof ActivityError) {
  return fileEntity;
}

the if statment fails, but if I apply the condition  inside the activity (getFileData) before returning the result it won't fail,
I checked the type of the activity result using typeof and it returned object every time.
i cant understand what I am doing wrong.



#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-03-20 04:19:02.000 UTC</summary>

Activity errors are wrapped on the workflow side.
You should be able to catch an ActivityFailure with cause set to ApplicationFailure with the type of the original exception thrown in the activity.

See this doc for more info https://legacy-documentation-sdks.temporal.io/typescript/handling-failure#activityfailure

</details>


---

<a id="1075"></a>

### #1075: core-2.3.0.tgz: 6 vulnerabilities (highest severity is: 8.8)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1075 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-03-08 01:06:16.000 UTC (2y 10m ago) |
| **Updated** | 2025-01-28 21:19:45.000 UTC |
| **Closed** | 2025-01-28 21:19:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>core-2.3.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (core version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25967](https://www.mend.io/vulnerability-database/CVE-2022-25967) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 8.8 | eta-1.12.3.tgz | Transitive | N/A* | &#10060; |
| [CVE-2020-7753](https://www.mend.io/vulnerability-database/CVE-2020-7753) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | trim-0.0.1.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25881](https://www.mend.io/vulnerability-database/CVE-2022-25881) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | http-cache-semantics-4.1.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-25166](https://www.mend.io/vulnerability-database/CVE-2023-25166) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 6.5 | formula-3.0.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2023-23630](https://www.mend.io/vulnerability-database/CVE-2023-23630) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 6.1 | eta-1.12.3.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-33987](https://www.mend.io/vulnerability-database/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-9.6.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25967</summary>


###  Vulnerable Library - <b>eta-1.12.3.tgz</b></p>

<p>Lightweight, fast, and powerful embedded JS template engine</p>
<p>Library home page: <a href="https://registry.npmjs.org/eta/-/eta-1.12.3.tgz">https://registry.npmjs.org/eta/-/eta-1.12.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/eta/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - :x: **eta-1.12.3.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package eta before 2.0.0 are vulnerable to Remote Code Execution (RCE) by overwriting template engine configuration variables with view options received from The Express render API. **Note:** This is exploitable only for users who are rendering templates with user-defined data.

<p>Publish Date: 2023-01-30
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25967>CVE-2022-25967</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-01-30</p>
<p>Fix Resolution: eta - 2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2020-7753</summary>


###  Vulnerable Library - <b>trim-0.0.1.tgz</b></p>

<p>Trim string whitespace</p>
<p>Library home page: <a href="https://registry.npmjs.org/trim/-/trim-0.0.1.tgz">https://registry.npmjs.org/trim/-/trim-0.0.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/trim/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - mdx-loader-2.3.0.tgz
      - mdx-1.6.22.tgz
        - remark-parse-8.0.3.tgz
          - :x: **trim-0.0.1.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().

<p>Publish Date: 2020-10-27
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2020-7753>CVE-2020-7753</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-10-27</p>
<p>Fix Resolution: trim - 0.0.3</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25881</summary>


###  Vulnerable Library - <b>http-cache-semantics-4.1.0.tgz</b></p>

<p>Parses Cache-Control and other headers. Helps building correct HTTP caches and proxies</p>
<p>Library home page: <a href="https://registry.npmjs.org/http-cache-semantics/-/http-cache-semantics-4.1.0.tgz">https://registry.npmjs.org/http-cache-semantics/-/http-cache-semantics-4.1.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/http-cache-semantics/package.json,/packages/docs/node_modules/http-cache-semantics/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - got-9.6.0.tgz
            - cacheable-request-6.1.0.tgz
              - :x: **http-cache-semantics-4.1.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
This affects versions of the package http-cache-semantics before 4.1.1. The issue can be exploited via malicious request header values sent to a server, when that server reads the cache policy from the request using this library.

<p>Publish Date: 2023-01-31
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25881>CVE-2022-25881</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.cve.org/CVERecord?id=CVE-2022-25881">https://www.cve.org/CVERecord?id=CVE-2022-25881</a></p>
<p>Release Date: 2023-01-31</p>
<p>Fix Resolution: http-cache-semantics - 4.1.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2023-25166</summary>


###  Vulnerable Library - <b>formula-3.0.0.tgz</b></p>

<p>Math and string formula parser.</p>
<p>Library home page: <a href="https://registry.npmjs.org/@sideway/formula/-/formula-3.0.0.tgz">https://registry.npmjs.org/@sideway/formula/-/formula-3.0.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/@sideway/formula/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - utils-validation-2.3.0.tgz
      - joi-17.7.0.tgz
        - :x: **formula-3.0.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
formula is a math and string formula parser. In versions prior to 3.0.1 crafted user-provided strings to formula's parser might lead to polynomial execution time and a denial of service. Users should upgrade to 3.0.1+. There are no known workarounds for this vulnerability.

<p>Publish Date: 2023-02-08
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-25166>CVE-2023-25166</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>6.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.cve.org/CVERecord?id=CVE-2023-25166">https://www.cve.org/CVERecord?id=CVE-2023-25166</a></p>
<p>Release Date: 2023-02-08</p>
<p>Fix Resolution: @sideway/formula - 3.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2023-23630</summary>


###  Vulnerable Library - <b>eta-1.12.3.tgz</b></p>

<p>Lightweight, fast, and powerful embedded JS template engine</p>
<p>Library home page: <a href="https://registry.npmjs.org/eta/-/eta-1.12.3.tgz">https://registry.npmjs.org/eta/-/eta-1.12.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/eta/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - :x: **eta-1.12.3.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Eta is an embedded JS templating engine that works inside Node, Deno, and the browser. XSS attack - anyone using the Express API is impacted. The problem has been resolved. Users should upgrade to version 2.0.0. As a workaround, don't pass user supplied things directly to `res.render`.

<p>Publish Date: 2023-02-01
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-23630>CVE-2023-23630</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>6.1</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Changed
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/eta-dev/eta/security/advisories/GHSA-xrh7-m5pp-39r6">https://github.com/eta-dev/eta/security/advisories/GHSA-xrh7-m5pp-39r6</a></p>
<p>Release Date: 2023-02-01</p>
<p>Fix Resolution: eta - 2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-9.6.0.tgz</b></p>

<p>Simplified HTTP requests</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-9.6.0.tgz">https://registry.npmjs.org/got/-/got-9.6.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.3.0.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - :x: **got-9.6.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: got - 11.8.5,12.1.0</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 21:19:43.000 UTC</summary>

All of these dependencies have updated a very long time ago.

</details>


---

<a id="1074"></a>

### #1074: temporal-sdk-core-0.1.0: 1 vulnerabilities (highest severity is: 7.5)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1074 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-03-08 01:06:14.000 UTC (2y 10m ago) |
| **Updated** | 2025-01-28 17:28:21.000 UTC |
| **Closed** | 2025-01-28 17:28:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | security vulnerability |
| **Assignees** | Sushisource |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>temporal-sdk-core-0.1.0</b></p></summary>

<p></p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (temporal-sdk-core version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-22895](https://www.mend.io/vulnerability-database/CVE-2023-22895) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | bzip2-0.4.3.crate | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2023-22895</summary>


###  Vulnerable Library - <b>bzip2-0.4.3.crate</b></p>

<p>Bindings to libbzip2 for bzip2 compression and decompression exposed as
Reader/Writer streams.
</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/bzip2/0.4.3/download">https://crates.io/api/v1/crates/bzip2/0.4.3/download</a></p>
<p>

Dependency Hierarchy:
  - temporal-sdk-core-0.1.0 (Root Library)
    - zip-0.6.3.crate
      - :x: **bzip2-0.4.3.crate** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The bzip2 crate before 0.4.4 for Rust allow attackers to cause a denial of service via a large file that triggers an integer overflow in mem.rs. NOTE: this is unrelated to the https://crates.io/crates/bzip2-rs product.

<p>Publish Date: 2023-01-10
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-22895>CVE-2023-22895</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-22895">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-22895</a></p>
<p>Release Date: 2023-01-10</p>
<p>Fix Resolution: bzip2 - 0.4.4</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 17:28:19.000 UTC</summary>

Dependency has updated a very long time ago.

</details>


---

<a id="1073"></a>

### #1073: opentelemetry-0.18.0.crate: 1 vulnerabilities (highest severity is: 9.8)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1073 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-03-08 01:06:12.000 UTC (2y 10m ago) |
| **Updated** | 2025-01-28 17:27:39.000 UTC |
| **Closed** | 2025-01-28 17:27:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | security vulnerability |
| **Assignees** | Sushisource |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>opentelemetry-0.18.0.crate</b></p></summary>

<p></p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (opentelemetry version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [WS-2023-0006](https://github.com/fitzgen/bumpalo/commit/f63d7683e0fee66de4e25650f10c403f84b56adc) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | bumpalo-3.11.0.crate | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> WS-2023-0006</summary>


###  Vulnerable Library - <b>bumpalo-3.11.0.crate</b></p>

<p>A fast bump allocation arena for Rust.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/bumpalo/3.11.0/download">https://crates.io/api/v1/crates/bumpalo/3.11.0/download</a></p>
<p>

Dependency Hierarchy:
  - opentelemetry-0.18.0.crate (Root Library)
    - opentelemetry_api-0.18.0.crate
      - js-sys-0.3.60.crate
        - wasm-bindgen-0.2.83.crate
          - wasm-bindgen-macro-0.2.83.crate
            - wasm-bindgen-macro-support-0.2.83.crate
              - wasm-bindgen-backend-0.2.83.crate
                - :x: **bumpalo-3.11.0.crate** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
In bumpalo prior to 3.11.1, the lifetime of the iterator produced by Vec::into_iter() is not constrained to the lifetime of the Bump that allocated the vector's memory. Using the iterator after the Bump is dropped causes use-after-free accesses.

<p>Publish Date: 2023-01-14
<p>URL: <a href=https://github.com/fitzgen/bumpalo/commit/f63d7683e0fee66de4e25650f10c403f84b56adc>WS-2023-0006</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://rustsec.org/advisories/RUSTSEC-2022-0078.html">https://rustsec.org/advisories/RUSTSEC-2022-0078.html</a></p>
<p>Release Date: 2023-01-14</p>
<p>Fix Resolution: bumpalo - 3.11.1</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-28 17:27:38.000 UTC</summary>

Dependency has updated a very long time ago.

</details>


---

<a id="1059"></a>

### #1059: [docs] Types are missing in the left nav bar of the exported API documentation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1059 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-02-17 15:42:51.000 UTC (2y 10m ago) |
| **Updated** | 2024-01-15 21:30:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | documentation |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

In [the exported API documentation](https://typescript.temporal.io/api/namespaces/client), structures that are defined with the `type` keyword appears nowhere in the left nav bar.

For example, `ScheduleDescription`, which is defined in code as `export type ScheduleDescription = { ... }` can be navigated from [ScheduleHandle.describe](https://typescript.temporal.io/api/interfaces/client.ScheduleHandle#describe), but can't be found directly by searching it in the nav bar.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-15 21:30:14.000 UTC</summary>

Actually, the same is true of module exported functions, constants and variables. This is due to the way the sidebar is built (i.e. iterating on exported markdown files, but not looking into those files).

</details>


---

<a id="1055"></a>

### #1055: Power local test environment with Temporal CLI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1055 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-02-12 23:24:38.000 UTC (2y 11m ago) |
| **Updated** | 2023-03-22 18:03:24.000 UTC |
| **Closed** | 2023-03-22 18:03:24.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

*No description provided.*

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-02-12 23:27:52.000 UTC</summary>

Depends on https://github.com/temporalio/sdk-core/issues/485

Consider maintaining support for Temporalite for a while.

</details>


---

<a id="1053"></a>

### #1053: [Bug] First activity heartbeat not sent right away

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1053 |
| **State** | CLOSED |
| **Author** | stellarhoof (Alejandro Hernandez) |
| **Created** | 2023-02-11 15:58:38.000 UTC (2y 11m ago) |
| **Updated** | 2023-02-16 01:24:30.000 UTC |
| **Closed** | 2023-02-16 01:24:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Cancel an activity

### Describe the bug

The first activity heartbeat is throttled, so the activity only gets cancelled after the first heartbeat is sent, which depends on the `heartbeatTimeout`

### Minimal Reproduction

Change the `heartbeatTimeout` in the [activities-cancellation-heartbeating](https://github.com/temporalio/samples-typescript/blob/main/activities-cancellation-heartbeating/src/workflows.ts#L6)] sample code to `10s` and verify that the activity is cancelled only right before the full `10s`

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version: SDK version 1.6.0
- Docker temporal server

### Additional context

<!-- Add any other context about the problem here. -->


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-02-16 01:24:30.000 UTC</summary>

The first heartbeat _is_ sent right away, the activity in the sample sleeps and then heartbeats though.
Even if it did heartbeat first, you still might not get the cancellation delivered since that is timing sensitive and depends on when the cancellation is requested by the workflow.

https://github.com/temporalio/samples-typescript/blob/ba6208155bc7b547c76931b7e14e92ce4594af28/activities-cancellation-heartbeating/src/activities.ts#L13

</details>


---

<a id="1052"></a>

### #1052: [Feature Request] Retain type information regarding signal/query `name`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1052 |
| **State** | CLOSED |
| **Author** | josiah-roberts (Josiah "Rebase" Roberts) |
| **Created** | 2023-02-10 23:46:26.000 UTC (2y 11m ago) |
| **Updated** | 2023-03-22 21:30:03.000 UTC |
| **Closed** | 2023-03-22 21:30:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Everything here also applies to `QueryDefinition`, but I'll use `SignalDefinition` in these examples.

Because `SignalDefinition<Args>` does not retain the type of its `name`, it can be difficult to create broader systems that keep track of the legal signals and queries that can be sent to a workflow. 

For example:
```typescript
const signalA = defineSignal<[string]>('a');
const signalB = defineSignal<[string]>('b');

export function myWorkflow() {
  ... use these signals
}

// This doesn't work: these are just SignalDefinition<[string]>
// it matches *any* SignalDefinition<[string]>, not just 'a' and 'b'
export type SupportedSignals = typeof signalA | typeof signalB;

// This also doesn't work: SignalDefinition<_Args>['name'] is typed as string
export type SupportedSignalNames = typeof signalA.name | typeof signalB.name;
```

As a result, there is no straightforward way to define within the type system what the legal queries/signals to send to a workflow are. We can use proximity ("this signal was exported by the same module as the workflow, it probably makes sense to send it"), but we can't create structures that have `tsc` enforce this for us.

### Describe the solution you'd like

This issue can be fixed by varying the type of `name` with the type of the passed in string.

`SignalDefinition` becomes:
```typescript
export interface SignalDefinition<Args extends any[] = [], Name extends string = string> {
  type: 'signal';
  name: Name;
}
```

This presents some challenges for the definition of `defineSignal` though. You can't have partially-inferred generics in typescript, so we are forced to specify the name on both a type and a value level
```typescript
export function defineSignal<Name extends string, Args extends any[] = []>(name: Name): SignalDefinition<Args, Name> {
  return {
    type: 'signal',
    name,
  };
}

// Annoying to have to specify 'some name' twice
const stringSignal = defineSignal<'some-name', [string]>('some-name');
```

A curried alternative removes the duplication, though with a slightly unfamiliar style. This would be my preference.
```typescript
function defineNamedSignal<Name extends string>(name: Name): <Args extends any[]>() => SignalDefinition<Args, Name> {
  return () => ({
    type: 'signal',
    name,
  })
}

defineNamedSignal('some-name')<[string]>();
```

Finally, we could also make this level of specificity opt-in, so that only consumers who care to reason about names on a type-level pay the cost for it:

```typescript
export function defineSignal<Args extends any[] = [], Name extends string = string>(name: Name): SignalDefinition<Args, Name> {
  return {
    type: 'signal',
    name,
  };
}

// Retains old behavior where the resulting name is of type string
const stringSignal = defineSignal<[string]>('some-name');

// Allows being more specific
const stringSignal = defineSignal<[string], 'some-name'>('some-name');
```

Either way, after this change it becomes possible to reason about the names of signals on a type level, tell them apart, and apply logic to them.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-22 21:30:03.000 UTC</summary>

Fixed in #1056.

</details>


---

<a id="1050"></a>

### #1050: [CI flake] Schedules deadline exceeded

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1050 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-02-09 00:48:52.000 UTC (2y 11m ago) |
| **Updated** | 2023-03-31 22:55:00.000 UTC |
| **Closed** | 2023-03-31 22:55:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

[build-and-test (ubuntu-latest, 16, true)](https://github.com/temporalio/sdk-typescript/actions/runs/4120036057/jobs/7114360708#logs)

includes a few errors like:

```
@temporalio/test:   schedules ‚Ä∫ Interceptor is called on create schedule
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test:   ServiceError {
@temporalio/test:     cause: Error {
@temporalio/test:       code: 4,
@temporalio/test:       details: 'context deadline exceeded',
@temporalio/test:       metadata: Metadata {
@temporalio/test:         internalRepr: Map { ‚Ä¶ },
@temporalio/test:         options: {},
@temporalio/test:       },
@temporalio/test:       message: '4 DEADLINE_EXCEEDED: context deadline exceeded',
@temporalio/test:     },
@temporalio/test:     message: 'Failed to describe schedule',
@temporalio/test:   }
@temporalio/test:   ‚Ä∫ ServiceError: Failed to describe schedule
@temporalio/test:   ‚Ä∫ ScheduleClient.rethrowGrpcError (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:510:13)
@temporalio/test:   ‚Ä∫ ScheduleClient._describeSchedule (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:282:12)
@temporalio/test:   ‚Ä∫ Object.describe (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:415:21)
@temporalio/test:   ‚Ä∫ <anonymous> (src/test-schedules.ts:249:33)
```

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-03-31 22:55:00.000 UTC</summary>

Expected this to be fixed by #1090.

</details>


---

<a id="1034"></a>

### #1034: preset-classic-2.2.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1034 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-01-25 16:27:51.000 UTC (2y 11m ago) |
| **Updated** | 2023-01-30 17:15:04.000 UTC |
| **Closed** | 2023-01-30 17:15:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>preset-classic-2.2.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/ua-parser-js/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (preset-classic version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-25927](https://www.mend.io/vulnerability-database/CVE-2022-25927) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | ua-parser-js-0.7.32.tgz | Transitive | 2.3.0 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25927</summary>


###  Vulnerable Library - <b>ua-parser-js-0.7.32.tgz</b></p>

<p>Detect Browser, Engine, OS, CPU, and Device type/model from User-Agent data. Supports browser & node.js environment</p>
<p>Library home page: <a href="https://registry.npmjs.org/ua-parser-js/-/ua-parser-js-0.7.32.tgz">https://registry.npmjs.org/ua-parser-js/-/ua-parser-js-0.7.32.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/ua-parser-js/package.json</p>
<p>

Dependency Hierarchy:
  - preset-classic-2.2.0.tgz (Root Library)
    - plugin-debug-2.2.0.tgz
      - react-json-view-1.21.3.tgz
        - flux-4.0.3.tgz
          - fbjs-3.0.4.tgz
            - :x: **ua-parser-js-0.7.32.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package ua-parser-js from 0.7.30 and before 0.7.33, from 0.8.1 and before 1.0.33 are vulnerable to Regular Expression Denial of Service (ReDoS) via the trim() function.

<p>Publish Date: 2023-01-26
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25927>CVE-2022-25927</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-02-24</p>
<p>Fix Resolution (ua-parser-js): 1.0.33</p>
<p>Direct dependency fix Resolution (@docusaurus/preset-classic): 2.3.0</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-01-30 17:15:03.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1029"></a>

### #1029: opentelemetry-0.18.0.crate: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1029 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-01-16 01:55:40.000 UTC (2y 11m ago) |
| **Updated** | 2023-04-13 16:27:35.000 UTC |
| **Closed** | 2023-04-13 16:27:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>opentelemetry-0.18.0.crate</b></p></summary>

<p></p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/420ff33c989e4c6ead15ba92e1db7eeb58be22dc">420ff33c989e4c6ead15ba92e1db7eeb58be22dc</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (opentelemetry version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [WS-2023-0006](https://github.com/fitzgen/bumpalo/commit/f63d7683e0fee66de4e25650f10c403f84b56adc) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | bumpalo-3.11.0.crate | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> WS-2023-0006</summary>


###  Vulnerable Library - <b>bumpalo-3.11.0.crate</b></p>

<p>A fast bump allocation arena for Rust.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/bumpalo/3.11.0/download">https://crates.io/api/v1/crates/bumpalo/3.11.0/download</a></p>
<p>

Dependency Hierarchy:
  - opentelemetry-0.18.0.crate (Root Library)
    - opentelemetry_api-0.18.0.crate
      - js-sys-0.3.60.crate
        - wasm-bindgen-0.2.83.crate
          - wasm-bindgen-macro-0.2.83.crate
            - wasm-bindgen-macro-support-0.2.83.crate
              - wasm-bindgen-backend-0.2.83.crate
                - :x: **bumpalo-3.11.0.crate** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/420ff33c989e4c6ead15ba92e1db7eeb58be22dc">420ff33c989e4c6ead15ba92e1db7eeb58be22dc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
In bumpalo prior to 3.11.1, the lifetime of the iterator produced by Vec::into_iter() is not constrained to the lifetime of the Bump that allocated the vector's memory. Using the iterator after the Bump is dropped causes use-after-free accesses.

<p>Publish Date: 2023-01-14
<p>URL: <a href=https://github.com/fitzgen/bumpalo/commit/f63d7683e0fee66de4e25650f10c403f84b56adc>WS-2023-0006</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://rustsec.org/advisories/RUSTSEC-2022-0078.html">https://rustsec.org/advisories/RUSTSEC-2022-0078.html</a></p>
<p>Release Date: 2023-01-14</p>
<p>Fix Resolution: bumpalo - 3.11.1</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-04-13 16:27:35.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1027"></a>

### #1027: tokio-1.21.2.crate: 1 vulnerabilities (highest severity is: 5.4) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1027 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-01-12 20:44:19.000 UTC (2y 12m ago) |
| **Updated** | 2023-02-01 17:33:52.000 UTC |
| **Closed** | 2023-02-01 17:33:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>tokio-1.21.2.crate</b></p></summary>

<p>An event-driven, non-blocking I/O platform for writing asynchronous I/O
backed applications.
</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/tokio/1.21.2/download">https://crates.io/api/v1/crates/tokio/1.21.2/download</a></p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/420ff33c989e4c6ead15ba92e1db7eeb58be22dc">420ff33c989e4c6ead15ba92e1db7eeb58be22dc</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (tokio version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2023-22466](https://www.mend.io/vulnerability-database/CVE-2023-22466) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.4 | tokio-1.21.2.crate | Direct | tokio - 1.18.4,1.20.3,1.23.1 | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2023-22466</summary>


###  Vulnerable Library - <b>tokio-1.21.2.crate</b></p>

<p>An event-driven, non-blocking I/O platform for writing asynchronous I/O
backed applications.
</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/tokio/1.21.2/download">https://crates.io/api/v1/crates/tokio/1.21.2/download</a></p>
<p>

Dependency Hierarchy:
  - :x: **tokio-1.21.2.crate** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/420ff33c989e4c6ead15ba92e1db7eeb58be22dc">420ff33c989e4c6ead15ba92e1db7eeb58be22dc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Tokio is a runtime for writing applications with Rust. Starting with version 1.7.0 and prior to versions 1.18.4, 1.20.3, and 1.23.1, when configuring a Windows named pipe server, setting `pipe_mode` will reset `reject_remote_clients` to `false`. If the application has previously configured `reject_remote_clients` to `true`, this effectively undoes the configuration. Remote clients may only access the named pipe if the named pipe's associated path is accessible via a publicly shared folder (SMB). Versions 1.23.1, 1.20.3, and 1.18.4 have been patched. The fix will also be present in all releases starting from version 1.24.0. Named pipes were introduced to Tokio in version 1.7.0, so releases older than 1.7.0 are not affected. As a workaround, ensure that `pipe_mode` is set first after initializing a `ServerOptions`.

<p>Publish Date: 2023-01-04
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2023-22466>CVE-2023-22466</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.4</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/tokio-rs/tokio/security/advisories/GHSA-7rrj-xr53-82p7">https://github.com/tokio-rs/tokio/security/advisories/GHSA-7rrj-xr53-82p7</a></p>
<p>Release Date: 2023-01-04</p>
<p>Fix Resolution: tokio - 1.18.4,1.20.3,1.23.1</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-02-01 17:33:52.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="1026"></a>

### #1026: [Chore] Upgrade @grpc/grpc-js to 1.8+

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1026 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-01-12 19:12:50.000 UTC (2y 12m ago) |
| **Updated** | 2024-04-09 12:27:01.000 UTC |
| **Closed** | 2024-04-09 12:27:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Description

Package @grpc/grpc-js was pinned to ~1.7.3 in #1025, because of:
- 10 second delay on node shutdown (#1023)
- 1.8.0 introduced [an integrated retry mechanism](https://github.com/grpc/proposal/blob/master/A6-client-retries.md) which will duplicate our own, causing much more retries than expected

At some point, we will need to upgrade this package. This will require:

- Validating that the updated version no longer cause 10 second delay on shutdown;
- Remove our own retry mechanisms in favour of those provided by grpc-js, or otherwise disable grpc-js' retry mechanisms


#### Comments (1)

<details>
<summary><strong>shsangha</strong> commented on 2023-07-06 16:11:30.000 UTC</summary>

Hey @mjameswh! Was wondering if this could be revisited? @grpc/grpc-js < 1.8.8 has a security vulnerability.  https://github.com/advisories/GHSA-cfgp-2977-2fmm

</details>


---

<a id="1014"></a>

### #1014: [Feature Request] Opt-in to having stack trace query use custom data converter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1014 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2023-01-05 13:19:51.000 UTC (3 years ago) |
| **Updated** | 2025-01-21 18:50:26.000 UTC |
| **Closed** | 2025-01-21 18:50:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Make a new boolean worker option like `stackTraceQueryUsesConverter`. If false, the `__stack_trace` query response should not be converted/encoded/etc w/ custom converter, but if true it should be. We accept that this changes today's default behavior so we need to make it loud and clear on release notes.

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2025-01-21 18:50:24.000 UTC</summary>

Closed on the parent feature ticket.

</details>


---

<a id="1007"></a>

### #1007: [Feature Request] Expose currently configured payload converter to workflow code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1007 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-12-30 07:26:07.000 UTC (3 years ago) |
| **Updated** | 2025-02-07 03:49:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

eg for headers + interceptors



#### Comments (1)

<details>
<summary><strong>cretz</strong> commented on 2023-01-05 21:35:38.000 UTC</summary>

I think this is a general request and not TS specific. Issue can remain here, but this is the type of feature we should do in all SDKs instead of burying in one.

Reactions: üëç 1

</details>


---

<a id="1001"></a>

### #1001: core-2.2.0.tgz: 4 vulnerabilities (highest severity is: 8.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1001 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-12-16 21:58:09.000 UTC (3 years ago) |
| **Updated** | 2023-01-30 17:15:07.000 UTC |
| **Closed** | 2023-01-30 17:15:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>core-2.2.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eeb0bcce87f86cd955b95a5d65b266d8c1a8a306">eeb0bcce87f86cd955b95a5d65b266d8c1a8a306</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (core version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-46175](https://www.mend.io/vulnerability-database/CVE-2022-46175) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 8.8 | json5-2.2.1.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-25967](https://www.mend.io/vulnerability-database/CVE-2022-25967) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 8.1 | eta-1.12.3.tgz | Transitive | N/A* | &#10060; |
| [CVE-2020-7753](https://www.mend.io/vulnerability-database/CVE-2020-7753) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | trim-0.0.1.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-33987](https://www.mend.io/vulnerability-database/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-9.6.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-46175</summary>


###  Vulnerable Library - <b>json5-2.2.1.tgz</b></p>

<p>JSON for humans.</p>
<p>Library home page: <a href="https://registry.npmjs.org/json5/-/json5-2.2.1.tgz">https://registry.npmjs.org/json5/-/json5-2.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/json5/package.json,/node_modules/json5/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.2.0.tgz (Root Library)
    - core-7.20.5.tgz
      - :x: **json5-2.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eeb0bcce87f86cd955b95a5d65b266d8c1a8a306">eeb0bcce87f86cd955b95a5d65b266d8c1a8a306</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
JSON5 is an extension to the popular JSON file format that aims to be easier to write and maintain by hand (e.g. for config files). The `parse` method of the JSON5 library before and including versions 1.0.1 and 2.2.1 does not restrict parsing of keys named `__proto__`, allowing specially crafted strings to pollute the prototype of the resulting object. This vulnerability pollutes the prototype of the object returned by `JSON5.parse` and not the global Object prototype, which is the commonly understood definition of Prototype Pollution. However, polluting the prototype of a single object can have significant security impact for an application if the object is later used in trusted operations. This vulnerability could allow an attacker to set arbitrary and unexpected keys on the object returned from `JSON5.parse`. The actual impact will depend on how applications utilize the returned object and how they filter unwanted keys, but could include denial of service, cross-site scripting, elevation of privilege, and in extreme cases, remote code execution. `JSON5.parse` should restrict parsing of `__proto__` keys when parsing JSON strings to objects. As a point of reference, the `JSON.parse` method included in JavaScript ignores `__proto__` keys. Simply changing `JSON5.parse` to `JSON.parse` in the examples above mitigates this vulnerability. This vulnerability is patched in json5 versions 1.0.2, 2.2.2, and later.

<p>Publish Date: 2022-12-24
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-46175>CVE-2022-46175</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://www.cve.org/CVERecord?id=CVE-2022-46175">https://www.cve.org/CVERecord?id=CVE-2022-46175</a></p>
<p>Release Date: 2022-12-24</p>
<p>Fix Resolution: json5 - 2.2.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25967</summary>


###  Vulnerable Library - <b>eta-1.12.3.tgz</b></p>

<p>Lightweight, fast, and powerful embedded JS template engine</p>
<p>Library home page: <a href="https://registry.npmjs.org/eta/-/eta-1.12.3.tgz">https://registry.npmjs.org/eta/-/eta-1.12.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/eta/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.2.0.tgz (Root Library)
    - :x: **eta-1.12.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eeb0bcce87f86cd955b95a5d65b266d8c1a8a306">eeb0bcce87f86cd955b95a5d65b266d8c1a8a306</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Versions of the package eta before 2.0.0 are vulnerable to Remote Code Execution (RCE) by overwriting template engine configuration variables with view options received from The Express render API. **Note:** This is exploitable only for users who are rendering templates with user-defined data.

<p>Publish Date: 2023-01-30
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-25967>CVE-2022-25967</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>8.1</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: High
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2023-01-30</p>
<p>Fix Resolution: eta - 2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2020-7753</summary>


###  Vulnerable Library - <b>trim-0.0.1.tgz</b></p>

<p>Trim string whitespace</p>
<p>Library home page: <a href="https://registry.npmjs.org/trim/-/trim-0.0.1.tgz">https://registry.npmjs.org/trim/-/trim-0.0.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/trim/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.2.0.tgz (Root Library)
    - mdx-loader-2.2.0.tgz
      - mdx-1.6.22.tgz
        - remark-parse-8.0.3.tgz
          - :x: **trim-0.0.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eeb0bcce87f86cd955b95a5d65b266d8c1a8a306">eeb0bcce87f86cd955b95a5d65b266d8c1a8a306</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().

<p>Publish Date: 2020-10-27
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2020-7753>CVE-2020-7753</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-10-27</p>
<p>Fix Resolution: trim - 0.0.3</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-9.6.0.tgz</b></p>

<p>Simplified HTTP requests</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-9.6.0.tgz">https://registry.npmjs.org/got/-/got-9.6.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.2.0.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - :x: **got-9.6.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eeb0bcce87f86cd955b95a5d65b266d8c1a8a306">eeb0bcce87f86cd955b95a5d65b266d8c1a8a306</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: got - 11.8.5,12.1.0</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2023-01-30 17:15:07.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="994"></a>

### #994: nyc-test-coverage-1.5.2.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/994 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-12-08 19:28:29.000 UTC (3y 1m ago) |
| **Updated** | 2022-12-16 21:58:16.000 UTC |
| **Closed** | 2022-12-16 21:58:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.5.2.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/b4f0147db9e6dfac99a4eef2751d93898efef4b7">b4f0147db9e6dfac99a4eef2751d93898efef4b7</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-37601](https://www.mend.io/vulnerability-database/CVE-2022-37601) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | loader-utils-1.4.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-37603](https://www.mend.io/vulnerability-database/CVE-2022-37603) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | loader-utils-1.4.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37601</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.5.2.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/b4f0147db9e6dfac99a4eef2751d93898efef4b7">b4f0147db9e6dfac99a4eef2751d93898efef4b7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Prototype pollution vulnerability in function parseQuery in parseQuery.js in webpack loader-utils 2.0.0 via the name variable in parseQuery.js.

<p>Publish Date: 2022-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37601>CVE-2022-37601</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-10-12</p>
<p>Fix Resolution: loader-utils - v2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37603</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.5.2.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/b4f0147db9e6dfac99a4eef2751d93898efef4b7">b4f0147db9e6dfac99a4eef2751d93898efef4b7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Regular expression denial of service (ReDoS) flaw was found in Function interpolateName in interpolateName.js in webpack loader-utils 2.0.0 via the url variable in interpolateName.js.

<p>Publish Date: 2022-10-14
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37603>CVE-2022-37603</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-3rfm-jhwj-7488">https://github.com/advisories/GHSA-3rfm-jhwj-7488</a></p>
<p>Release Date: 2022-10-14</p>
<p>Fix Resolution: loader-utils - 1.4.2,2.0.4,3.2.1</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-12-16 21:58:15.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="992"></a>

### #992: @temporalio/nyc-test-coverage-1.5.1.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/992 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-12-07 19:43:04.000 UTC (3y 1m ago) |
| **Updated** | 2022-12-08 19:28:34.000 UTC |
| **Closed** | 2022-12-08 19:28:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.5.1.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (@temporalio/nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-37601](https://www.mend.io/vulnerability-database/CVE-2022-37601) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | loader-utils-1.4.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-37603](https://www.mend.io/vulnerability-database/CVE-2022-37603) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | loader-utils-1.4.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37601</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.5.1.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Prototype pollution vulnerability in function parseQuery in parseQuery.js in webpack loader-utils 2.0.0 via the name variable in parseQuery.js.

<p>Publish Date: 2022-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37601>CVE-2022-37601</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-10-12</p>
<p>Fix Resolution: loader-utils - v2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37603</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.5.1.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Regular expression denial of service (ReDoS) flaw was found in Function interpolateName in interpolateName.js in webpack loader-utils 2.0.0 via the url variable in interpolateName.js.

<p>Publish Date: 2022-10-14
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37603>CVE-2022-37603</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-3rfm-jhwj-7488">https://github.com/advisories/GHSA-3rfm-jhwj-7488</a></p>
<p>Release Date: 2022-10-14</p>
<p>Fix Resolution: loader-utils - 1.4.2,2.0.4,3.2.1</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-12-08 19:28:34.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="976"></a>

### #976: [Bug] `WorkflowNotFoundError` used when namespace not found

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/976 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-11-24 22:32:38.000 UTC (3y 1m ago) |
| **Updated** | 2023-06-27 22:18:08.000 UTC |
| **Closed** | 2023-06-27 22:18:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

<img width="968" alt="image" src="https://user-images.githubusercontent.com/251288/203870125-6d67f713-d81b-45e7-a084-f63151843f06.png">


### Options

In order of not breaking to most breaking:

1. Add "namespace does not exist" to the list of reasons:

<img width="806" alt="image" src="https://user-images.githubusercontent.com/251288/203870152-1dacb8f5-d71f-44aa-80a5-fbb0b5bb02af.png">

https://typescript.temporal.io/api/classes/workflow.WorkflowNotFoundError

2. Add `NamespaceNotFoundError`
3. Remove `WorkflowNotFoundError` and just throw `ServiceError`

### Meta

1. Are there other possible reasons for `grpcStatus.NOT_FOUND`?
2. For all the other gRPC status codes we check for throwing a specific error, are there cases for those codes we haven't considered? Can search for `grpcStatus.*` and `status.*`

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-11-25 03:45:15.000 UTC</summary>

I saw this coming, it came up in a team discussion. We need to extract the error details from headers like go does, possibly using this library: https://github.com/stackpath/node-grpc-error-details



</details>


---

<a id="970"></a>

### #970: Run `cargo fmt/clippy` from `npm run format/lint`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/970 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2022-11-15 16:37:07.000 UTC (3y 1m ago) |
| **Updated** | 2022-11-30 16:48:06.000 UTC |
| **Closed** | 2022-11-30 16:48:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Rust code contained in package `core-bridge` but outside the `core-sdk` submodule can benefit from `cargo fmt` and `cargo clippy`, but it is easy to forget running them after modifying `core-bridge`'s code.

Running these commands from that NPM package's `format` and `lint` scripts would help ensure that they are regularly run.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-11-15 17:57:12.000 UTC</summary>

Yes please

</details>


---

<a id="966"></a>

### #966: Go through all deprecated imports

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/966 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-11-13 21:38:15.000 UTC (3y 1m ago) |
| **Updated** | 2024-01-09 21:14:05.000 UTC |
| **Closed** | 2024-01-09 21:13:56.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

To see if we can or need to import something different. Turning on this rule will highlight them:

https://github.com/temporalio/sdk-typescript/blob/508034457ad5cd574d0f9948fd58380f5743c8ec/.eslintrc#L40-L41

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 21:13:56.000 UTC</summary>

Pruned all dependencies as part of #1330.

Also tried enabling `import/no-deprecated`, but it caused a lot of false-positives, with nothing pertinent over what `deprecation/deprecation` already provides.

</details>


---

<a id="958"></a>

### #958: [Feature Request] Improve experience of including workflow modules that have a `browser` field

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/958 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-11-10 01:02:00.000 UTC (3y 2m ago) |
| **Updated** | 2022-11-29 23:27:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Our bundler picks up the `browser` field in a module's `package.json`, and that can result in hard-to-understand errors that we've seen in support and here:

https://github.com/temporalio/samples-typescript/pull/204#issuecomment-1306408369

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Maybe automatically don't use browser field? 



#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-29 23:27:58.000 UTC</summary>

The thing is that if a package has a browser field, it most certainly means that it has both an implementation targeted at browsers and an implementation targeted at nodejs... Both will almost certainly require APIs we do not support in workflow sandboxes.

</details>


---

<a id="938"></a>

### #938: [Feature Request] Formally validate public API modification between releases

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/938 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2022-10-26 20:36:01.000 UTC (3y 2m ago) |
| **Updated** | 2022-10-26 22:12:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

At the moment, it is very difficult to identify changes to exported members signatures from our SDK packages. This leads to two negative consequences:

- Risk of unexpected breaking changes in patch or minor releases;
- Risk of exposing members that were never meant for public usage (thus increasing even more the risk of further breaking changes).

### Describe the solution you'd like

Use a tool run in CICD that:
1. Identify the exact set of publicly exported APIs
2. Reports changes in these exported APIs relative to the appropriate baseline

### Additional context

Microsoft's [API Extractor](https://api-extractor.com/) can probably be used for this.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-26 22:12:05.000 UTC</summary>

Good idea, I'd just note that we're reserving major versions for history incompatible changes, our minor releases may contain API breaking changes.

</details>


---

<a id="930"></a>

### #930: nyc-test-coverage-1.4.3.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/930 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-10-19 02:51:24.000 UTC (3y 2m ago) |
| **Updated** | 2022-12-07 19:43:08.000 UTC |
| **Closed** | 2022-12-07 19:43:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>nyc-test-coverage-1.4.3.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (nyc-test-coverage version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-37601](https://www.mend.io/vulnerability-database/CVE-2022-37601) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | loader-utils-1.4.0.tgz | Transitive | N/A* | &#10060; |
| [CVE-2022-37603](https://www.mend.io/vulnerability-database/CVE-2022-37603) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | loader-utils-1.4.0.tgz | Transitive | N/A* | &#10060; |
<p>*For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the section "Details" below to see if there is a version of transitive dependency where vulnerability is fixed.</p>

## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37601</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.4.3.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Prototype pollution vulnerability in function parseQuery in parseQuery.js in webpack loader-utils 2.0.0 via the name variable in parseQuery.js.

<p>Publish Date: 2022-10-12
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37601>CVE-2022-37601</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-10-12</p>
<p>Fix Resolution: loader-utils - v2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37603</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - nyc-test-coverage-1.4.3.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Regular expression denial of service (ReDoS) flaw was found in Function interpolateName in interpolateName.js in webpack loader-utils 2.0.0 via the url variable in interpolateName.js.

<p>Publish Date: 2022-10-14
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-37603>CVE-2022-37603</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-3rfm-jhwj-7488">https://github.com/advisories/GHSA-3rfm-jhwj-7488</a></p>
<p>Release Date: 2022-10-14</p>
<p>Fix Resolution: loader-utils - 1.4.2,2.0.4,3.2.1</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-12-07 19:43:07.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="926"></a>

### #926: @temporalio/nyc-test-coverage-1.4.3.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/926 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-10-14 23:30:56.000 UTC (3y 2m ago) |
| **Updated** | 2022-10-19 02:51:27.000 UTC |
| **Closed** | 2022-10-19 02:51:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.4.3.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-37601](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-37601) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | loader-utils-1.4.0.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37601</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.4.3.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Prototype pollution vulnerability in function parseQuery in parseQuery.js in webpack loader-utils 2.0.0 via the name variable in parseQuery.js.

<p>Publish Date: 2022-10-12
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-37601>CVE-2022-37601</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-10-12</p>
<p>Fix Resolution: loader-utils - v2.0.0</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-19 02:51:27.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="919"></a>

### #919: @temporalio/nyc-test-coverage-1.4.2.tgz: 2 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/919 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-10-13 01:10:21.000 UTC (3y 2m ago) |
| **Updated** | 2022-10-14 23:30:59.000 UTC |
| **Closed** | 2022-10-14 23:30:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.4.2.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-37601](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-37601) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | loader-utils-1.4.0.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-37599](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-37599) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.5 | loader-utils-1.4.0.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-37601</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.4.2.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Prototype pollution vulnerability in function parseQuery in parseQuery.js in webpack loader-utils 2.0.0 via the name variable in parseQuery.js.

<p>Publish Date: 2022-10-12
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-37601>CVE-2022-37601</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-10-12</p>
<p>Fix Resolution: loader-utils - v2.0.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-37599</summary>


###  Vulnerable Library - <b>loader-utils-1.4.0.tgz</b></p>

<p>utils for webpack loaders</p>
<p>Library home page: <a href="https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz">https://registry.npmjs.org/loader-utils/-/loader-utils-1.4.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/loader-utils/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.4.2.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - :x: **loader-utils-1.4.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Regular expression denial of service (ReDoS) flaw was found in Function interpolateName in interpolateName.js in webpack loader-utils 2.0.0 via the resourcePath variable in interpolateName.js.

<p>Publish Date: 2022-10-11
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-37599>CVE-2022-37599</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-14 23:30:58.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="911"></a>

### #911: [Bug] nyc-test-coverage uses unmaintained istanbul-instrumenter-loader

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/911 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2022-10-10 19:41:49.000 UTC (3y 3m ago) |
| **Updated** | 2022-12-16 22:39:26.000 UTC |
| **Closed** | 2022-12-16 22:39:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

nyc-test-coverage uses [unmaintained](https://github.com/webpack-contrib/istanbul-instrumenter-loader/issues/102) (archived) istanbul-instrumenter-loader, which results in npm audit [findings](https://snyk.io/advisor/npm-package/istanbul-instrumenter-loader)

### Describe the bug

Installing prints several deprecation warnings:

```bash
npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated
npm WARN deprecated source-map-resolve@0.5.3: See https://github.com/lydell/source-map-resolve#deprecated
npm WARN deprecated source-map-url@0.4.1: See https://github.com/lydell/source-map-url#deprecated
npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated
npm WARN deprecated querystring@0.2.0: The querystring API is considered Legacy. new code should use the URLSearchParams API instead.
npm WARN deprecated chokidar@2.1.8: Chokidar 2 does not receive security updates since 2019. Upgrade to chokidar 3 with 15x fewer dependencies
npm WARN deprecated core-js@2.6.12: core-js@<3.23.3 is no longer maintained and not recommended for usage due to the number of issues. Because of the V8 engine whims, feature detection in old core-js versions could cause a slowdown up to 100x even if nothing is polyfilled. Some versions have web compatibility issues. Please, upgrade your dependencies to the actual version of core-js.
```

```bash
# npm audit report

ajv  <6.12.3
Severity: moderate
Prototype Pollution in Ajv - https://github.com/advisories/GHSA-v88g-cgmw-v5xw
fix available via `npm audit fix --force`
Will install @temporalio/nyc-test-coverage@1.2.0, which is a breaking change
node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv
  schema-utils  <=0.4.3
  Depends on vulnerable versions of ajv
  node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils
    istanbul-instrumenter-loader  >=3.0.0-beta.0
    Depends on vulnerable versions of schema-utils
    node_modules/@temporalio/nyc-test-coverage/node_modules/istanbul-instrumenter-loader
      @temporalio/nyc-test-coverage  >=1.3.0
      Depends on vulnerable versions of istanbul-instrumenter-loader
      node_modules/@temporalio/nyc-test-coverage

glob-parent  <5.1.2
Severity: high
glob-parent before 5.1.2 vulnerable to Regular Expression Denial of Service in enclosure regex - https://github.com/advisories/GHSA-ww39-953v-wcq6
fix available via `npm audit fix`
node_modules/watchpack-chokidar2/node_modules/glob-parent
  chokidar  1.0.0-rc1 - 2.1.8
  Depends on vulnerable versions of glob-parent
  node_modules/watchpack-chokidar2/node_modules/chokidar
    watchpack-chokidar2  *
    Depends on vulnerable versions of chokidar
    node_modules/watchpack-chokidar2
      watchpack  1.7.2 - 1.7.5
      Depends on vulnerable versions of watchpack-chokidar2
      node_modules/@temporalio/nyc-test-coverage/node_modules/watchpack
        webpack  4.44.0 - 4.46.0
        Depends on vulnerable versions of watchpack
        node_modules/@temporalio/nyc-test-coverage/node_modules/webpack

9 vulnerabilities (4 moderate, 5 high)
```

### Minimal Reproduction

1. https://gitpod.io#https://github.com/joebowbeer/temporal-pendulum/tree/patch-client-workflow
2. cd position-node
3. npm ci
4. npm audit

### Additional context

See #872 

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-10 20:23:07.000 UTC</summary>

Looks like that lib is just a few lines: https://github.com/webpack-contrib/istanbul-instrumenter-loader/blob/master/src/index.js

</details>


---

<a id="904"></a>

### #904: @temporalio/nyc-test-coverage-1.4.1.tgz: 1 vulnerabilities (highest severity is: 5.6) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/904 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-10-06 13:48:36.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-06 20:34:08.000 UTC |
| **Closed** | 2022-10-06 20:34:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.4.1.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /packages/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json,/node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/f745212e0dcb23896e37d5026978bc96008b1fdd">f745212e0dcb23896e37d5026978bc96008b1fdd</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2020-15366](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-15366) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.6 | ajv-5.5.2.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2020-15366</summary>


###  Vulnerable Library - <b>ajv-5.5.2.tgz</b></p>

<p>Another JSON Schema Validator</p>
<p>Library home page: <a href="https://registry.npmjs.org/ajv/-/ajv-5.5.2.tgz">https://registry.npmjs.org/ajv/-/ajv-5.5.2.tgz</a></p>
<p>Path to dependency file: /packages/nyc-test-coverage/package.json</p>
<p>Path to vulnerable library: /packages/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json,/node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.4.1.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - schema-utils-0.3.0.tgz
        - :x: **ajv-5.5.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/f745212e0dcb23896e37d5026978bc96008b1fdd">f745212e0dcb23896e37d5026978bc96008b1fdd</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
An issue was discovered in ajv.validate() in Ajv (aka Another JSON Schema Validator) 6.12.2. A carefully crafted JSON schema could be provided that allows execution of other code by prototype pollution. (While untrusted schemas are recommended against, the worst case of an untrusted schema should be a denial of service, not execution of code.)

<p>Publish Date: 2020-07-15
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-15366>CVE-2020-15366</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.6</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: High
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-07-15</p>
<p>Fix Resolution: ajv - 6.12.3</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-06 20:34:08.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="895"></a>

### #895: @temporalio/nyc-test-coverage-1.4.0.tgz: 1 vulnerabilities (highest severity is: 5.6) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/895 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-09-29 03:13:19.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-06 13:48:39.000 UTC |
| **Closed** | 2022-10-06 13:48:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/nyc-test-coverage-1.4.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /packages/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json,/node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/4b757ebbc052f327cc37e5693f46c8127c156b0c">4b757ebbc052f327cc37e5693f46c8127c156b0c</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2020-15366](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-15366) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.6 | ajv-5.5.2.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2020-15366</summary>


###  Vulnerable Library - <b>ajv-5.5.2.tgz</b></p>

<p>Another JSON Schema Validator</p>
<p>Library home page: <a href="https://registry.npmjs.org/ajv/-/ajv-5.5.2.tgz">https://registry.npmjs.org/ajv/-/ajv-5.5.2.tgz</a></p>
<p>Path to dependency file: /packages/nyc-test-coverage/package.json</p>
<p>Path to vulnerable library: /packages/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json,/node_modules/@temporalio/nyc-test-coverage/node_modules/schema-utils/node_modules/ajv/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/nyc-test-coverage-1.4.0.tgz (Root Library)
    - istanbul-instrumenter-loader-3.0.1.tgz
      - schema-utils-0.3.0.tgz
        - :x: **ajv-5.5.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/4b757ebbc052f327cc37e5693f46c8127c156b0c">4b757ebbc052f327cc37e5693f46c8127c156b0c</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
An issue was discovered in ajv.validate() in Ajv (aka Another JSON Schema Validator) 6.12.2. A carefully crafted JSON schema could be provided that allows execution of other code by prototype pollution. (While untrusted schemas are recommended against, the worst case of an untrusted schema should be a denial of service, not execution of code.)

<p>Publish Date: 2020-07-15
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-15366>CVE-2020-15366</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.6</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: High
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-07-15</p>
<p>Fix Resolution: ajv - 6.12.3</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-10-06 13:48:39.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="894"></a>

### #894: Look into deprecated deps

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/894 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-29 03:06:55.000 UTC (3y 3m ago) |
| **Updated** | 2024-01-09 21:17:01.000 UTC |
| **Closed** | 2024-01-09 21:17:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

```
$ npm ci

npm WARN deprecated source-map-url@0.4.1: See https://github.com/lydell/source-map-url#deprecated
npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated
npm WARN deprecated har-validator@5.1.5: this library is no longer supported
npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated
npm WARN deprecated source-map-resolve@0.5.3: See https://github.com/lydell/source-map-resolve#deprecated
npm WARN deprecated fsevents@1.2.13: fsevents 1 will break on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.
npm WARN deprecated chokidar@2.1.8: Chokidar 2 does not receive security updates since 2019. Upgrade to chokidar 3 with 15x fewer dependencies
npm WARN deprecated querystring@0.2.0: The querystring API is considered Legacy. new code should use the URLSearchParams API instead.
npm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.
npm WARN deprecated request@2.88.0: request has been deprecated, see https://github.com/request/request/issues/3142
npm WARN deprecated @opentelemetry/sdk-metrics-base@0.29.2: Please use @opentelemetry/sdk-metrics
npm WARN deprecated core-js@2.6.12: core-js@<3.23.3 is no longer maintained and not recommended for usage due to the number of issues. Because of the V8 engine whims, feature detection in old core-js versions could cause a slowdown up to 100x even if nothing is polyfilled. Some versions have web compatibility issues. Please, upgrade your dependencies to the actual version of core-js.

added 1759 packages, and audited 1773 packages in 1m
```

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 21:17:00.000 UTC</summary>

Pruned all dependencies as part of #1330.

</details>


---

<a id="880"></a>

### #880: [Feature Request] Retry sticky worker unavailable

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/880 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-21 06:09:19.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-11 23:52:33.000 UTC |
| **Closed** | 2022-10-11 23:52:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

I don't think our Client currently retries this error: 

```
Error: 14 UNAVAILABLE: sticky worker unavailable, please use original task queue
```

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Retry it, as well as all other possible retryable server errors. (Do we have a list somewhere?)

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

https://temporalio.slack.com/archives/C01DKSMU94L/p1663739982172349?thread_ts=1663657363.309989&cid=C01DKSMU94L

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:52:32.000 UTC</summary>

Looks like this should be retried by the server in recent server versions.
We already retry what we consider a list of retryable server errors https://github.com/temporalio/sdk-typescript/blob/dc63e490a22655fbdfa9e7fce4fa6f6fe57f2c92/packages/client/src/grpc-retry.ts#L100.

</details>


---

<a id="863"></a>

### #863: [Bug] `instanceof WorkflowNotFoundError` not working

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/863 |
| **State** | CLOSED |
| **Author** | omar-amal |
| **Created** | 2022-09-08 13:49:55.000 UTC (3y 4m ago) |
| **Updated** | 2023-01-16 23:41:14.000 UTC |
| **Closed** | 2023-01-16 23:41:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Trying to use `if (err instanceof WorkflowNotFoundError)` to detect whether a workflow doesn't exist.

I'm running the following function to detect whether a workflow is scheduled to run:

```typescript
import { WorkflowNotFoundError } from '@temporalio/workflow'

export const getRecurringInvestment = async (wfId: string): Promise<GetRecurringInvestmentDTO | undefined> => {
  const getTemporalClient = initTemporalClient()
  const temporalClient = await getTemporalClient()

  const wfHandle = await temporalClient.getHandle(wfId)

  try {
    const [state, { status }] = await Promise.all([wfHandle.query(wfQuery), wfHandle.describe()])
    return status.name === 'CANCELLED' ? undefined : GetRecurringInvestmentDTO.parse(state)
  } catch (err: any) {
    // TODO most likely a bug in temporalio SDK.
    if (err instanceof WorkflowNotFoundError) {
      return undefined
    }
    throw err
  }
}
```

The ways a workflow wouldn't be scheduled to run, in our case, is if it's cancelled, or just wasn't created. If the workflow doesn't exist I would expect, per the documentation, for `wfHandle.describe()` or `wfHandle.query()` to throw with `WorkflowNotFoundError`

### Describe the bug

I would expect the following above block in the `catch` block to be reached:

```typescript
    // when the workflow doesn't exist, this `if` block should be entered, and the function should return `undefined`
    // however, the block is being skipped, and we're reaching the `throw err` instead.
    if (err instanceof WorkflowNotFoundError) {
      return undefined
    }
```

but it wasn't.  When I replaced the `if` block with the following, the block was successfully reached
```typescript
  } catch (err: any) {
    // Works: enters the `if` block
    if (err.name === 'WorkflowNotFoundError') {
      return undefined
    }
    throw err
  }
}
```
<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Package versions
Using version 1.1.0 of `@temporalio/workflow` and the other packages.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-09-08 19:22:42.000 UTC</summary>

This is likely due to multiple versions of `@temporalio/common` installed.
Try changing the import to: `import { WorkflowNotFoundError } from '@temporalio/client'`


</details>


---

<a id="853"></a>

### #853: [Bug] Stress tests did not complete in CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/853 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-08-29 23:31:35.000 UTC (3y 4m ago) |
| **Updated** | 2022-10-26 18:51:33.000 UTC |
| **Closed** | 2022-10-26 18:51:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

Unclear what the reason is, not much I could tell from the worker logs.
Requires more investigation.

https://github.com/temporalio/sdk-typescript/runs/8081318760?check_suite_focus=true#step:13:567

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-26 18:51:33.000 UTC</summary>

Closing this as it should not happen anymore now that we have GH hosted runner.

</details>


---

<a id="846"></a>

### #846: [Feature Request] Catch-all signal handler

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/846 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-23 21:01:38.000 UTC (3y 4m ago) |
| **Updated** | 2023-01-28 03:25:34.000 UTC |
| **Closed** | 2023-01-28 03:25:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

With multiple handlers, each handler processes its own signals in order. In order to get in-order delivery of all signals, you need to either:

- only send a single signal type (["fat handler"](https://docs.temporal.io/typescript/workflows#define-signals-and-queries-dynamically))
- have a catch-all handler that is called when any signal arrives, regardless of type

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Something like:

```ts
import { setGlobalSignalHandler } from '@temporalio/workflow'

setGlobalSignalHandler((signalType: string, arg1: Type1, arg2: Type2) => ...)
```

When both a global and individual handler is defined, do we only deliver to one of them, or to both?


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-08-23 21:04:07.000 UTC</summary>

Easy to add, has been brought up before, API TBD.

For the behavior, I'd recommend this being a catch all, meaning it doesn't get triggered if a more specific handler is set.

</details>


---

<a id="841"></a>

### #841: [Bug] CancellationScopes (AsyncLocalStorage) scope leak with node.js 18

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/841 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-08-23 00:18:40.000 UTC (3y 4m ago) |
| **Updated** | 2023-06-14 21:34:59.000 UTC |
| **Closed** | 2023-06-14 21:34:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Need to verify what the minimal repro looks like, users seem to hit this with `condition(fn, timeout)` which creates a scope and cancels it internally.

I've seen this before with one of the minor Node.js 14 releases (can't remember which one).

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-02-28 16:22:35.000 UTC</summary>

Cannot reproduce this, closing.

</details>


---

<a id="840"></a>

### #840: [Feature Request] Add meta client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/840 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-22 22:30:58.000 UTC (3y 4m ago) |
| **Updated** | 2022-10-11 00:01:18.000 UTC |
| **Closed** | 2022-10-11 00:01:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

As described in Schedules proposal: https://github.com/temporalio/proposals/blob/schedules/typescript/schedules.md#higher-level-ts-client

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 00:01:17.000 UTC</summary>

I already did this a couple weeks ago.

</details>


---

<a id="817"></a>

### #817: [Feature Request] Upsert TemporalChangeVersion on patch

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/817 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-16 03:54:03.000 UTC (3y 4m ago) |
| **Updated** | 2024-12-21 03:25:42.000 UTC |
| **Closed** | 2024-12-21 03:25:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/sdk-features/issues/117

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-03-09 00:24:00.000 UTC</summary>

This will now happen as of #1072 with latest Core.
Requires server version 1.20 to take effect.

</details>


---

<a id="801"></a>

### #801: docusaurus-plugin-snipsync-1.0.0.tgz: 1 vulnerabilities (highest severity is: 5.9) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/801 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-08-03 17:58:45.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-05 01:09:14.000 UTC |
| **Closed** | 2022-08-05 01:09:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>docusaurus-plugin-snipsync-1.0.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-fetch/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-2596](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-2596) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.9 | node-fetch-2.6.7.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-2596</summary>


###  Vulnerable Library - <b>node-fetch-2.6.7.tgz</b></p>

<p>A light-weight module that brings window.fetch to node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-fetch/-/node-fetch-2.6.7.tgz">https://registry.npmjs.org/node-fetch/-/node-fetch-2.6.7.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-fetch/package.json</p>
<p>

Dependency Hierarchy:
  - docusaurus-plugin-snipsync-1.0.0.tgz (Root Library)
    - snipsync-1.5.0.tgz
      - rest-18.9.1.tgz
        - core-3.5.1.tgz
          - request-5.6.1.tgz
            - :x: **node-fetch-2.6.7.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fde5f6b46128523f394c660def334e7717f94ac7">fde5f6b46128523f394c660def334e7717f94ac7</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Denial of Service in GitHub repository node-fetch/node-fetch prior to 3.2.10.

<p>Publish Date: 2022-08-01
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-2596>CVE-2022-2596</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.9</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: High
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-2596">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-2596</a></p>
<p>Release Date: 2022-08-01</p>
<p>Fix Resolution: node-fetch - 3.2.10</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-08-05 01:09:14.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="794"></a>

### #794: [Feature Request] ScheduleClient

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/794 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-07-29 23:43:03.000 UTC (3y 5m ago) |
| **Updated** | 2022-11-07 23:03:42.000 UTC |
| **Closed** | 2022-11-07 23:03:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/sdk-features/issues/73

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2022-11-07 23:03:42.000 UTC</summary>

Implemented in #937 

</details>


---

<a id="792"></a>

### #792: Better Documentation for bundleWorkflowCode in Typescript SDK

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/792 |
| **State** | CLOSED |
| **Author** | alex766 |
| **Created** | 2022-07-29 01:10:37.000 UTC (3y 5m ago) |
| **Updated** | 2024-07-10 14:28:15.000 UTC |
| **Closed** | 2022-08-11 02:34:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the solution you'd like**
Better documentation around `bundleWorkflowCode` here: https://typescript.temporal.io/api/namespaces/worker/#bundleworkflowcode or somewhere else in the Temporal to indicate that interceptors should be passed in through bundleWorkflowCode and is necessary if used with replaying, or non-determinism errors will be thrown. 


#### Comments (1)

<details>
<summary><strong>gajus</strong> commented on 2024-07-10 14:28:14.000 UTC</summary>

The documentation is lacking.

How do I pass `code` to `Worker.create`?

```ts
const { code } = await bundleWorkflowCode({
  webpackConfigHook: createWebpackConfigHook(),
  workflowsPath: require.resolve('../temporal-workflows/workflows/index.js'),
});
```

</details>


---

<a id="785"></a>

### #785: [Feature Request] Upgrade to protobufjs@7

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/785 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-27 20:32:44.000 UTC (3y 5m ago) |
| **Updated** | 2022-07-29 05:55:59.000 UTC |
| **Closed** | 2022-07-29 05:55:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Latest `proto3-json-serializer` depends on `protobufjs@7`, and we curently depend on 6, which means users get both versions.

### Additional context

v7 release notes include moving CLIs to a new package named `protobufjs-cli`

https://github.com/protobufjs/protobuf.js/releases/tag/protobufjs-v7.0.0




<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-27 20:35:18.000 UTC</summary>

Oh nice, I'd recently heard that they released 7.0.0, maybe they'll switch from long to bigint too soon because that's been a pain to use so far.

</details>


---

<a id="776"></a>

### #776: [Feature Request] Expose internal-non-workflow-common functionality

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/776 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-25 23:58:12.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-02 15:37:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Use case: https://temporalio.slack.com/archives/C01DKSMU94L/p1658777936734799

### Solution

Either:
- Add to API ref
- Combine internal* packages into `common`, using a separate folder & entry point for any non-workflow APIs
  - In this case, could we add `@temporalio/common/non-workflow` to API ref?



#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-08-02 15:37:16.000 UTC</summary>

Currently sending users to the relevant file, like this:

https://github.com/temporalio/sdk-typescript/blob/main/packages/internal-non-workflow-common/src/codec-helpers.ts

and giving an example import:

`import { encodeToPayload, loadDataConverter } from '@temporalio/internal-non-workflow-common'`

</details>


---

<a id="775"></a>

### #775: Allow for Batched Replays

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/775 |
| **State** | CLOSED |
| **Author** | alex766 |
| **Created** | 2022-07-25 22:50:38.000 UTC (3y 5m ago) |
| **Updated** | 2022-10-19 02:47:14.000 UTC |
| **Closed** | 2022-10-19 02:47:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Is your feature request related to a problem? Please describe.**
To ensure determinism in workflows on code changes, I am creating a test that uses `runReplayHistory` by grabbing the 3 oldest running workflow IDs of each workflow type and replaying them. However, this requires replaying around 30 workflows, and I noticed that registering and initializing the worker takes up the majority of the time. I have tried workflow bundling, and this does reduce some of the initialization time, but have run into errors known to Temporal developers that sometimes appear. 

**Describe the solution you'd like**
It would be useful to have a feature that allows you to kick off a replay that takes in a list of workflow IDs and replays all of them in parallel, and returns which, if any, fail.

**Describe alternatives you've considered**
I have tried parallelizing myself by kicking off each `runReplayHistory` in series, adding these promises to an array, and using `Promise.allSettled` at the end, but this doesn't provide much speedup, and my assumption is that Typescript and my computer are not running the register and initialize in parallel. 


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-03 13:04:05.000 UTC</summary>

We‚Äôre adding support for this in sdk-core which will enable this work.

</details>


---

<a id="774"></a>

### #774: Enable import/no-deprecated

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/774 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-23 05:18:23.000 UTC (3y 5m ago) |
| **Updated** | 2024-01-09 21:33:36.000 UTC |
| **Closed** | 2024-01-09 21:33:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

It was added in #771 to `.eslintrc` and is currently commented out. It's mostly rxjs:

<details>
```
> eslint packages/*/src --ext .ts --no-error-on-unmatched-pattern && prettier --end-of-line auto --check .


/Users/me/gh/sdk-typescript/packages/interceptors-opentelemetry/src/workflow/definitions.ts
   3:10  error  Deprecated: Use {@link InstrumentationScope} instead  import/no-deprecated
  24:36  error  Deprecated: Use {@link InstrumentationScope} instead  import/no-deprecated

/Users/me/gh/sdk-typescript/packages/test/src/load/starter.ts
    7:20  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `range(start, count).pipe(observeOn(scheduler))` instead. Details: Details: https://rxjs.dev/deprecations/scheduler-argument                          import/no-deprecated
    8:22  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
    8:27  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
    8:37  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
   91:18  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `range(start, count).pipe(observeOn(scheduler))` instead. Details: Details: https://rxjs.dev/deprecations/scheduler-argument                          import/no-deprecated
   92:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
   94:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
   95:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  114:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
  115:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  117:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
  118:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  161:5   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  163:5   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated

/Users/me/gh/sdk-typescript/packages/test/src/query-perf.ts
  24:8   error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled`. Details: https://rxjs.dev/deprecations/scheduler-argument              import/no-deprecated
  25:10  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector  import/no-deprecated
  32:10  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                             import/no-deprecated

/Users/me/gh/sdk-typescript/packages/worker/src/runtime.ts
   17:10  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector  import/no-deprecated
   17:28  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                             import/no-deprecated
  196:11  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                             import/no-deprecated
  197:11  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector  import/no-deprecated
  201:11  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                             import/no-deprecated

/Users/me/gh/sdk-typescript/packages/worker/src/rxutils.ts
   2:10  error  Deprecated: Use the options parameter instead                                                             import/no-deprecated
   2:19  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8  import/no-deprecated
  24:5   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8  import/no-deprecated
  37:5   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8  import/no-deprecated
  54:5   error  Deprecated: Use the options parameter instead                                                             import/no-deprecated
  62:5   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8  import/no-deprecated

/Users/me/gh/sdk-typescript/packages/worker/src/worker.ts
    45:3   error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                                import/no-deprecated
    47:3   error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled` and `mergeAll`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                 import/no-deprecated
    55:54  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
    55:59  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
    55:91  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
   505:9   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
   666:9   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
   684:12  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                                import/no-deprecated
   706:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
   707:16  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled` and `mergeAll`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                 import/no-deprecated
   713:13  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
   858:11  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
   917:11  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
   940:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
   941:16  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled` and `mergeAll`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                 import/no-deprecated
   942:23  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
   947:13  error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
   960:11  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1168:11  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1179:7   error  Deprecated: Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8                                                                                                               import/no-deprecated
  1241:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1245:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
  1309:11  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1316:11  error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
  1338:11  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1374:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1424:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
  1440:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1489:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1505:7   error  Deprecated: The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector                                                                    import/no-deprecated
  1517:7   error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1570:11  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled` and `mergeAll`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                 import/no-deprecated
  1574:13  error  Deprecated: The `scheduler` parameter will be removed in v8. Use `scheduled` and `mergeAll`. Details: https://rxjs.dev/deprecations/scheduler-argument                                                                 import/no-deprecated
  1575:15  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated
  1582:13  error  Deprecated: Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments  import/no-deprecated

‚úñ 65 problems (65 errors, 0 warnings)
```
</details>

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2024-01-09 21:33:35.000 UTC</summary>

Pruned all dependencies as part of #1330.

Also tried enabling import/no-deprecated, but it caused a lot of false-positives, with nothing pertinent over what deprecation/deprecation already provides.

</details>


---

<a id="762"></a>

### #762: [Bug] worker client OOM when running as a container in a k8s cluster.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/762 |
| **State** | CLOSED |
| **Author** | Vincechen611 |
| **Created** | 2022-07-20 03:04:38.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-15 15:35:43.000 UTC |
| **Closed** | 2022-08-15 15:35:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |
| **Reactions** | üöÄ 1 |

#### Description

### What are you really trying to do?
Consider calculate default maxCachedWorkflows by v8.getHeapStatistics().total_available_size instead of os.totalmem()

### Describe the bug

Recently, We have implement our temporal worker client with sdk-typescript and run as a container in a k8s cluster.
We have set `NODE_OPTIONS=--max-old-space-size=XXX` when starting up worker, but we found the worker pod always get OOM killed by k8s when processing task.
After checking the detail, we found that the default `maxCachedWorkflows` is calculated by `os.totalmem()` if we didn't set.
When running in container, the `os.totalmem()` will get the host machine memory not container resource setting (which is in [cgroup](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/))
Could we calculate default [maxCachedWorkflows](https://github.com/temporalio/sdk-typescript/blob/a261054130708744c692a50b07d3f189a43b9934/packages/worker/src/worker-options.ts#L414) with v8.getHeapStatistics().total_available_size which might reduce the chance of OOM if user didn't assign maxCachedWorkflows.


### Environment/Versions

- OS and processor: [Linux], [container](https://github.com/nodejs/docker-node) based on `node:16.14.0`
- Temporal Version: 1.17.1 , SDK version : v1.0.0-rc.1
- Are you using Docker or Kubernetes? Yes

### Additional context
Our worker k8s manifest.
![image](https://user-images.githubusercontent.com/6711819/179886299-eb43b2c7-da47-4ca6-9d3b-272183531000.png)

![image](https://user-images.githubusercontent.com/6711819/179885599-62a9d068-87bc-4cda-8d57-2343f888ee69.png)


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-20 03:36:40.000 UTC</summary>

Thanks for reporting, we'll use `total_available_size` as the default instead.

Reactions: üëç 1

</details>


---

<a id="752"></a>

### #752: [Feature Request] Add `ApplicationFailure.create`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/752 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-11 17:52:44.000 UTC (3y 6m ago) |
| **Updated** | 2022-08-11 04:39:54.000 UTC |
| **Closed** | 2022-08-11 04:39:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

#562 

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Add `create` static method to [ApplicationFailure](https://typescript.temporal.io/api/classes/common.applicationfailure/):

```ts
throw ApplicationFailure.create({
  message: 'my message',
  type: 'old-cookie', 
  nonRetryable: true, 
  cause: e
})
```

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-11 18:25:22.000 UTC</summary>

I'd be fine with this

</details>


---

<a id="739"></a>

### #739: [Docs] Rank functions higher in search

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/739 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-01 20:49:01.000 UTC (3y 6m ago) |
| **Updated** | 2024-01-12 22:33:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | documentation |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

When searching `continueAsNew`, one of the last results is:

https://typescript.temporal.io/api/namespaces/workflow/#continueasnew

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

It would be nice if it were first. It looks like the two ways to rank things higher are `recordProps.lvl*`:

<img width="570" alt="image" src="https://user-images.githubusercontent.com/251288/176965637-6fede56e-2154-46a0-93f1-6ec6797603c7.png">

https://docsearch.algolia.com/docs/templates#docusaurus-v2-template

or `pageRank`, which is by index / pathsToMatch:

https://docsearch.algolia.com/docs/record-extractor#boost-search-results-with-pagerank

with which we could have a separate rank for `/api/namespaces/*`, or put functions to their own dir, like `/api/functions/workflow`.

#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2024-01-12 22:33:12.000 UTC</summary>

Also methods. Or move to the bottom of results everything I don't care about. Like in this list, most of it is not what I'm searching for:

https://typescript.temporal.io/search?q=heartbeat

</details>


---

<a id="734"></a>

### #734: client-1.0.0-rc.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/734 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-06-29 17:51:38.000 UTC (3y 6m ago) |
| **Updated** | 2022-07-05 17:40:46.000 UTC |
| **Closed** | 2022-07-05 17:40:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>client-1.0.0-rc.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/testing/package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-25878](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | protobufjs-6.11.2.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25878</summary>


###  Vulnerable Library - <b>protobufjs-6.11.2.tgz</b></p>

<p>Protocol Buffers for JavaScript (& TypeScript).</p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - client-1.0.0-rc.0.tgz (Root Library)
    - :x: **protobufjs-6.11.2.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The package protobufjs before 6.11.3 are vulnerable to Prototype Pollution which can allow an attacker to add/modify properties of the Object.prototype. This vulnerability can occur in multiple ways: 1. by providing untrusted user input to util.setProperty or to ReflectionObject.setParsedOption functions 2. by parsing/loading .proto files

<p>Publish Date: 2022-05-27
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878>CVE-2022-25878</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878</a></p>
<p>Release Date: 2022-05-27</p>
<p>Fix Resolution: protobufjs - 6.10.3,6.11.3</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-07-05 17:40:46.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="724"></a>

### #724: [Bug] Update SDK README to match 1.0.0 capabilities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/724 |
| **State** | CLOSED |
| **Author** | yoDon (Don Alvarez) |
| **Created** | 2022-06-26 16:09:20.000 UTC (3y 6m ago) |
| **Updated** | 2022-09-16 21:56:53.000 UTC |
| **Closed** | 2022-09-16 21:56:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

The SDK README is out of date with the current capabilities of the SDK

### Minimal Reproduction

SDK indicates, for example, that Upsert on search attributes is not implemented.

### Environment/Versions

N/A

### Additional context

Congrats on getting the TypeScript SDK ready for release!

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-26 16:14:43.000 UTC</summary>

I‚Äôve been meaning to update the readme for a while and haven‚Äôt gotten around to it.
Thanks for reporting.

</details>


---

<a id="720"></a>

### #720: [Feature Request] `WorkflowNotFoundError` export is not consistent with `WorkflowExecutionAlreadyStartedError` 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/720 |
| **State** | CLOSED |
| **Author** | miroslavLalev (Miroslav) |
| **Created** | 2022-06-24 13:21:11.000 UTC (3y 6m ago) |
| **Updated** | 2022-06-29 22:13:25.000 UTC |
| **Closed** | 2022-06-29 22:13:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

I am using version 0.23.x of the SDK (from NodeJS) and when working with common errors, the imports are always looking like the following snippet:
```
const { WorkflowExecutionAlreadyStartedError } = require('@temporalio/client');
const { WorkflowNotFoundError } = require('@temporalio/internal-workflow-common');
```
From what I've seen, there is no other place to find `WorkflowNotFoundError`, other than the `@temporalio/internal-workflow-common` module. I think it would be nice to have one place that re-exports all possible errors, so there is no need to import from "internal-workflow-common" at all.

### Describe the solution you'd like

I think that being able to import the errors from a single module would be great:
```
const {
  WorkflowExecutionAlreadyStartedError,
  WorkflowNotFoundError,
} = require('@temporalio/client'); // it doesn't necessarily have to be exported from the client module directly, that's just an example
```

### Additional context
I am using the `WorkflowNotFoundError` when checking errors due to invalid commands - like sending a signal to an already finished workflow. For example:
```
const handle = this.client.getHandle(id);
try {
	await handle.signal(CANCEL_SIGNAL_NAME, {});
} catch (err) {
	if (err instanceof WorkflowNotFoundError) {
		// handle this errors in a proper manner, so that it is not retried from the outside.
	}
        // all unknown errors are retried
	throw err;
}
```


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-24 16:40:47.000 UTC</summary>

We could easily re-export it, thanks for reporting.

</details>


---

<a id="717"></a>

### #717: [Bug] @temporalio/interceptors-opentelemetry package.json refers to non-existent file

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/717 |
| **State** | CLOSED |
| **Author** | esuh-descript (Eric J. Suh) |
| **Created** | 2022-06-22 01:54:01.000 UTC (3y 6m ago) |
| **Updated** | 2022-07-05 17:36:11.000 UTC |
| **Closed** | 2022-07-05 17:36:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We were trying to import and use types and functions from `@opentelemetry/interceptors-opentelemetry`, specifically `OpenTelemetryActivityInboundInterceptor` and `makeWorkflowExporter`.

### Describe the bug

Errors were thrown because the `package.json` in `@temporalio/interceptors-opentelemetry` refers to `lib/index.js` and `lib/index.d.ts`, neither of which exist in the published package (nor do they seem to exist in the source code):

```
source/InstrumentedWorkerClient.ts(5,8): error TS2307: Cannot find module '@temporalio/interceptors-opentelemetry' or its corresponding type declarations.
```

### Minimal Reproduction

`package.json`:
```json
{
  "name": "testpkg",
  "version": "1.0.0",
  "description": "Testing",
  "main": "index.js",
  "types": "index.d.ts",
  "scripts": {
    "build": "tsc"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@temporalio/interceptors-opentelemetry": "^1.0.0-rc.0",
    "typescript": "^4.7.4"
  }
}
```

`index.ts`:
```typescript
import {
    OpenTelemetryActivityInboundInterceptor,
    makeWorkflowExporter,
} from '@temporalio/interceptors-opentelemetry';
```

Run: `npm run build`

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-22 14:17:31.000 UTC</summary>

Thanks for reporting this.
I'll fix `package.json`.

There's nothing to import at the root of this package, you should import from `lib/client`, `lib/worker` and `lib/workflow` for each part of your application.

For example:
```ts
import {
  OpenTelemetryActivityInboundInterceptor,
  makeWorkflowExporter,
} from '@temporalio/interceptors-opentelemetry/lib/worker';
```

See our sample on how to use this package: https://github.com/temporalio/samples-typescript/tree/main/interceptors-opentelemetry

</details>


---

<a id="713"></a>

### #713: got-10.7.0.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/713 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-06-19 22:15:54.000 UTC (3y 6m ago) |
| **Updated** | 2022-07-05 17:40:49.000 UTC |
| **Closed** | 2022-07-05 17:40:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>got-10.7.0.tgz</b></p></summary>

<p>Human-friendly and powerful HTTP request library for Node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-10.7.0.tgz">https://registry.npmjs.org/got/-/got-10.7.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/got/package.json,/packages/create-project/node_modules/got/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-33987](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-10.7.0.tgz | Direct | 12.0.0-beta.1 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-10.7.0.tgz</b></p>

<p>Human-friendly and powerful HTTP request library for Node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-10.7.0.tgz">https://registry.npmjs.org/got/-/got-10.7.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/got/package.json,/packages/create-project/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - :x: **got-10.7.0.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: 12.0.0-beta.1</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-07-05 17:40:49.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="712"></a>

### #712: got-12.0.3.tgz: 1 vulnerabilities (highest severity is: 5.3) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/712 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-06-19 22:15:52.000 UTC (3y 6m ago) |
| **Updated** | 2022-07-05 17:40:51.000 UTC |
| **Closed** | 2022-07-05 17:40:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>got-12.0.3.tgz</b></p></summary>

<p>Human-friendly and powerful HTTP request library for Node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-12.0.3.tgz">https://registry.npmjs.org/got/-/got-12.0.3.tgz</a></p>
<p>Path to dependency file: /packages/testing/package.json</p>
<p>Path to vulnerable library: /packages/testing/node_modules/got/package.json,/node_modules/@temporalio/testing/node_modules/got/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-33987](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-12.0.3.tgz | Direct | got - 11.8.5,12.1.0 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-12.0.3.tgz</b></p>

<p>Human-friendly and powerful HTTP request library for Node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-12.0.3.tgz">https://registry.npmjs.org/got/-/got-12.0.3.tgz</a></p>
<p>Path to dependency file: /packages/testing/package.json</p>
<p>Path to vulnerable library: /packages/testing/node_modules/got/package.json,/node_modules/@temporalio/testing/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - :x: **got-12.0.3.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: got - 11.8.5,12.1.0</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-07-05 17:40:51.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="709"></a>

### #709: @temporalio/client-1.0.0-rc.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/709 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-06-17 23:09:54.000 UTC (3y 6m ago) |
| **Updated** | 2022-06-29 17:51:46.000 UTC |
| **Closed** | 2022-06-29 17:51:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/client-1.0.0-rc.0.tgz</b></p></summary>

<p></p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/c25e91309b980f2118df4048d760306982019871">c25e91309b980f2118df4048d760306982019871</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-25878](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | protobufjs-6.11.2.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25878</summary>


###  Vulnerable Library - <b>protobufjs-6.11.2.tgz</b></p>

<p>Protocol Buffers for JavaScript (& TypeScript).</p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - @temporalio/client-1.0.0-rc.0.tgz (Root Library)
    - :x: **protobufjs-6.11.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/c25e91309b980f2118df4048d760306982019871">c25e91309b980f2118df4048d760306982019871</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The package protobufjs before 6.11.3 are vulnerable to Prototype Pollution which can allow an attacker to add/modify properties of the Object.prototype. This vulnerability can occur in multiple ways: 1. by providing untrusted user input to util.setProperty or to ReflectionObject.setParsedOption functions 2. by parsing/loading .proto files

<p>Publish Date: 2022-05-27
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878>CVE-2022-25878</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878</a></p>
<p>Release Date: 2022-05-27</p>
<p>Fix Resolution: protobufjs - 6.10.3,6.11.3</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-06-29 17:51:46.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="699"></a>

### #699: Documentation for config option `maxCachedWorkflows` references unknown option `maxIsolateMemoryMB`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/699 |
| **State** | CLOSED |
| **Author** | kheyse-werk (Karel Heyse) |
| **Created** | 2022-06-14 09:11:19.000 UTC (3y 7m ago) |
| **Updated** | 2022-06-14 17:51:44.000 UTC |
| **Closed** | 2022-06-14 17:51:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

The documentation for the config option `maxCachedWorkflows`:

https://github.com/temporalio/sdk-typescript/blob/6d071d1fe001904670f91ca42947890b7f1a443a/packages/worker/src/worker-options.ts#L150

References `maxIsolateMemoryMB` but this is not defined anywhere in this repo, which results in a "broken link" on https://typescript.temporal.io/api/interfaces/worker.workeroptions/#maxcachedworkflows.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-14 15:57:10.000 UTC</summary>

Thanks, we removed this option and forgot to update the docs.

Reactions: üëç 1

</details>


---

<a id="697"></a>

### #697: [Bug] Move native connection fields to worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/697 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-13 22:01:37.000 UTC (3y 7m ago) |
| **Updated** | 2022-06-15 20:54:34.000 UTC |
| **Closed** | 2022-06-15 20:54:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | 1.0 |

#### Description

Move these to Worker: 

```
NativeConnectionOptions.identity
NativeConnectionOptions.workerBinaryId
``` 

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-14 00:24:40.000 UTC</summary>

Requires a Core-side change @Sushisource 

</details>


---

<a id="687"></a>

### #687: [Bug] Installing v0.23 I get error "Cannot find module '@temporalio/common/lib/converter/wrapped-payload-converter'"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/687 |
| **State** | CLOSED |
| **Author** | davidtheclark (David Clark) |
| **Created** | 2022-06-06 21:50:37.000 UTC (3y 7m ago) |
| **Updated** | 2022-06-09 20:05:23.000 UTC |
| **Closed** | 2022-06-09 20:05:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Update from 0.21 to 0.23.

### Describe the bug

I get error "Cannot find module '@temporalio/common/lib/converter/wrapped-payload-converter'".

```
> @watershed/temporal-worker@0.1.0 build-webpack-bundle /.../workspaces/temporal-worker
> node ../../build/workspaces/temporal-worker/build-webpack-bundle.js
node:internal/modules/cjs/loader:936
  throw err;
  ^
Error: Cannot find module '@temporalio/common/lib/converter/wrapped-payload-converter'
Require stack:
- /.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/internals.js
- /.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/workflow.js
- /.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/index.js
- /.../node_modules/.pnpm/@temporalio+worker@0.23.2/node_modules/@temporalio/worker/lib/worker.js
- /.../node_modules/.pnpm/@temporalio+worker@0.23.2/node_modules/@temporalio/worker/lib/index.js
- /.../build/workspaces/temporal-worker/build-webpack-bundle.js
    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:933:15)
    at Function.Module._resolveFilename (/.../node_modules/.pnpm/module-alias@2.2.2/node_modules/module-alias/index.js:49:29)
    at Function.Module._load (node:internal/modules/cjs/loader:778:27)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at Object.<anonymous> (/.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/internals.js:17:37)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Function.Module._load (node:internal/modules/cjs/loader:822:12) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
undefined
    '/.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/internals.js',
    '/.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/workflow.js',
    '/.../node_modules/.pnpm/@temporalio+workflow@0.23.0/node_modules/@temporalio/workflow/lib/index.js',
    '/.../node_modules/.pnpm/@temporalio+worker@0.23.2/node_modules/@temporalio/worker/lib/worker.js',
    '/.../node_modules/.pnpm/@temporalio+worker@0.23.2/node_modules/@temporalio/worker/lib/index.js',
/.../workspaces/temporal-worker:
‚ÄâERR_PNPM_RECURSIVE_RUN_FIRST_FAIL‚Äâ @watershed/temporal-worker@0.1.0 build-webpack-bundle: `node ../../build/workspaces/temporal-worker/build-webpack-bundle.js`
Exit status 1
    '/.../build/workspaces/temporal-worker/build-webpack-bundle.js'
  ]
}
```

It looks to me like [`@temporalio/workflow/lib/internals` depends on `@temporalio/common`](https://github.com/temporalio/sdk-typescript/blob/31eb76a8849ef046b2978bc77b78248eb1ae32d6/packages/workflow/src/internals.ts), but [`@temporalio/common` is not defined as a dependency in `workflow/package.json`.](https://github.com/temporalio/sdk-typescript/blob/31eb76a8849ef046b2978bc77b78248eb1ae32d6/packages/workflow/package.json)

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Mac
- Temporal Version: 0.21 -> 0.23
- Are you using Docker or Kubernetes or building Temporal from source? Docker

I'm using pnpm to manage Node dependencies.


#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-06-06 22:46:26.000 UTC</summary>

Thanks for reporting! That particular import isn't used anymore on latest `main`, but we do have other imports to /common from /workflow, so I opened #688 to fix.

</details>


---

<a id="671"></a>

### #671: client-0.23.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/671 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-05-29 21:02:16.000 UTC (3y 7m ago) |
| **Updated** | 2022-06-17 23:09:58.000 UTC |
| **Closed** | 2022-06-17 23:09:56.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>client-0.23.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/meta/package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/2f64ab5fde2b5d5c2c1218b83963f8fa9bf1d0fd">2f64ab5fde2b5d5c2c1218b83963f8fa9bf1d0fd</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-25878](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | protobufjs-6.11.2.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-25878</summary>


###  Vulnerable Library - <b>protobufjs-6.11.2.tgz</b></p>

<p>Protocol Buffers for JavaScript (& TypeScript).</p>
<p>Library home page: <a href="https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz">https://registry.npmjs.org/protobufjs/-/protobufjs-6.11.2.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/protobufjs/package.json</p>
<p>

Dependency Hierarchy:
  - client-0.23.0.tgz (Root Library)
    - :x: **protobufjs-6.11.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/2f64ab5fde2b5d5c2c1218b83963f8fa9bf1d0fd">2f64ab5fde2b5d5c2c1218b83963f8fa9bf1d0fd</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The package protobufjs before 6.11.3 are vulnerable to Prototype Pollution which can allow an attacker to add/modify properties of the Object.prototype. This vulnerability can occur in multiple ways: 1. by providing untrusted user input to util.setProperty or to ReflectionObject.setParsedOption functions 2. by parsing/loading .proto files

<p>Publish Date: 2022-05-27
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25878>CVE-2022-25878</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25878</a></p>
<p>Release Date: 2022-05-27</p>
<p>Fix Resolution: protobufjs - 6.10.3,6.11.3</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-06-17 23:09:58.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="668"></a>

### #668: [Feature Request] Provide WorkflowInfo.initiator?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/668 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-27 15:54:30.000 UTC (3y 7m ago) |
| **Updated** | 2025-06-11 10:13:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

If this is helpful to users, we could expose `startWorkflow.continueInitiator` as `WorkflowInfo.more.initiator: Initiator`. Currently we're not, but I'm opening this issue to see if there are any user requests / use cases for it.

```ts
export enum Initiator {
  Unspecified = 0,
  ContinueAsNew = 1,
  Retry = 2,
  Cron = 3,
}
```

One possible use case is determining whether the current Execution was initiated due to retry vs continue as new.

#### Comments (1)

<details>
<summary><strong>vaibhavyadav-dev</strong> commented on 2025-06-11 10:13:38.000 UTC</summary>

@lorensr @mjameswh is this issue still relevant? If so, you can suggest me some similar issues to work on, I'll happy to make quality contributions.
Thanks

</details>


---

<a id="666"></a>

### #666: neon-0.8.3.crate: 1 vulnerabilities (highest severity is: 7.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/666 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-05-27 06:13:49.000 UTC (3y 7m ago) |
| **Updated** | 2022-05-31 17:07:23.000 UTC |
| **Closed** | 2022-05-31 17:07:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>neon-0.8.3.crate</b></p></summary>

<p>A safe abstraction layer for Node.js.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/neon/0.8.3/download">https://crates.io/api/v1/crates/neon/0.8.3/download</a></p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [WS-2022-0133](https://github.com/neon-bindings/neon/commit/4e350ea1d74cc90158e7bc3b8ce273bf9b6a5c0f) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.8 | neon-0.8.3.crate | Direct | neon - 0.10.1 | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> WS-2022-0133</summary>


###  Vulnerable Library - <b>neon-0.8.3.crate</b></p>

<p>A safe abstraction layer for Node.js.</p>
<p>Library home page: <a href="https://crates.io/api/v1/crates/neon/0.8.3/download">https://crates.io/api/v1/crates/neon/0.8.3/download</a></p>
<p>

Dependency Hierarchy:
  - :x: **neon-0.8.3.crate** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Use after free in Neon external buffers between 0.8.0 and before 0.10.1.
Neon provides functionality for creating JavaScript ArrayBuffer (and the Buffer subtype) instances backed by bytes allocated outside of V8/Node. The JsArrayBuffer::external and JsBuffer::external did not require T: 'static prior to Neon 0.10.1. This allowed creating an externally backed buffer from types that may be freed while they are still referenced by a JavaScript ArrayBuffer

<p>Publish Date: 2022-05-22
<p>URL: <a href=https://github.com/neon-bindings/neon/commit/4e350ea1d74cc90158e7bc3b8ce273bf9b6a5c0f>WS-2022-0133</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://rustsec.org/advisories/RUSTSEC-2022-0028.html">https://rustsec.org/advisories/RUSTSEC-2022-0028.html</a></p>
<p>Release Date: 2022-05-22</p>
<p>Fix Resolution: neon - 0.10.1</p>

</p>

<p></p>

</details>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"Crate","packageName":"neon","packageVersion":"0.8.3","packageFilePaths":[],"isTransitiveDependency":false,"dependencyTree":"neon:0.8.3","isMinimumFixVersionAvailable":true,"minimumFixVersion":"neon - 0.10.1","isBinary":true}],"baseBranches":["main"],"vulnerabilityIdentifier":"WS-2022-0133","vulnerabilityDetails":"Use after free in Neon external buffers between 0.8.0 and before 0.10.1.\nNeon provides functionality for creating JavaScript ArrayBuffer (and the Buffer subtype) instances backed by bytes allocated outside of V8/Node. The JsArrayBuffer::external and JsBuffer::external did not require T: \u0027static prior to Neon 0.10.1. This allowed creating an externally backed buffer from types that may be freed while they are still referenced by a JavaScript ArrayBuffer","vulnerabilityUrl":"https://github.com/neon-bindings/neon/commit/4e350ea1d74cc90158e7bc3b8ce273bf9b6a5c0f","cvss3Severity":"high","cvss3Score":"7.8","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"High","UI":"Required","AV":"Local","I":"High"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-05-31 17:07:23.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="659"></a>

### #659: [Bug] instanceof doesn't work with WorkflowInfo fields

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/659 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-20 17:29:56.000 UTC (3y 7m ago) |
| **Updated** | 2023-01-23 23:46:09.000 UTC |
| **Closed** | 2023-01-23 23:46:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

Determine types of `WorkflowInfo` fields inside Workflow.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Things like this are `false`, since the info object is created outside the vm:

```
// searchAttributes: { CustomIntField: [1,2] }
workflowInfo().searchAttributes.CustomIntField instanceof Array
workflowInfo().executionExpirationTime instanceof Date
```


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-05-22 03:01:15.000 UTC</summary>

I‚Äôd just dump to json and back

</details>


---

<a id="620"></a>

### #620: [Bug] OpenTelemetry interceptors patch global runtime outside workflow isolate too

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/620 |
| **State** | CLOSED |
| **Author** | airhorns (Harry Brundage) |
| **Created** | 2022-04-29 01:32:22.000 UTC (3y 8m ago) |
| **Updated** | 2022-05-02 21:24:57.000 UTC |
| **Closed** | 2022-05-02 21:24:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | 1.0 |

#### Description

### What are you really trying to do?

Run an existing, large node.js project that starts Temporal workers, where some of the existing node code depends on `typeof window == "undefined"`.

### Describe the bug

The OpenTelemetry interceptors package modifies the global object to have a `window` property here: https://github.com/temporalio/sdk-typescript/blob/main/packages/interceptors-opentelemetry/src/workflow/runtime.ts 

This modification may be necessary within the workflow isolate, but, this code is also required outside the workflow isolate when just booting the worker and passing the interceptors because of this import: https://github.com/temporalio/sdk-typescript/blob/main/packages/interceptors-opentelemetry/src/worker/index.ts#L8

This violates a lot of existing code's assumptions and in the case of my project breaks a lot of things. `typeof window == "undefined"` is a generally pretty common way of checking if a piece of code is running within node or within the browser, and this global modification confuses all that code, because now in the whole node process `typeof window == "object"`. 

Is there a way that the interceptors could only modify the code inside the workflow isolate, or better yet, not modify the globals at all?

### Minimal Reproduction

Gonna skip this for now but if the issue is unclear let me know and I can put something together

### Environment/Versions

- OS and processor: macOS 12.1.3
- Temporal Version: temporalite + `@temporalio/worker@0.20.2`
- No docker, no k8s

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-04-29 14:26:16.000 UTC</summary>

Should be easy to fix

</details>


---

<a id="618"></a>

### #618: We have a regression in our tests where we can no longer run tests from forks:

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/618 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-04-26 19:56:22.000 UTC (3y 8m ago) |
| **Updated** | 2022-08-17 18:37:50.000 UTC |
| **Closed** | 2022-07-19 00:51:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

We have a regression in our tests where we can no longer run tests from forks:
https://github.com/temporalio/sdk-typescript/runs/6182355808?check_suite_focus=true#step:13:25

_Originally posted by @bergundy in https://github.com/temporalio/sdk-typescript/issues/613#issuecomment-1110191994_

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-19 00:51:13.000 UTC</summary>

@lorensr I'm pretty sure you fixed this already.
Reopen if I'm wrong please.

Reactions: üëç 1

</details>


---

<a id="610"></a>

### #610: [Bug] Sink API appears to create circular JSON

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/610 |
| **State** | CLOSED |
| **Author** | alex-dixon (Alex Dixon) |
| **Created** | 2022-04-22 18:53:06.000 UTC (3y 8m ago) |
| **Updated** | 2022-04-22 20:07:32.000 UTC |
| **Closed** | 2022-04-22 20:07:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
Send data through a sink and call JSON stringify on it on the receiving (sink) end.


### Describe the bug
When I call a sink with data and stringify the result on the receiving end I sometimes receive a `TypeError: Converting circular structure` type error. I do not appear to receive this error if I stringify the the data on the sending end, before it is sent through the sink (so it doesn't seem the data actually has a circular structure before entering the sink, but it does after?). 

### Minimal Reproduction
I've avoided creating this issue because haven't had time to set one set up.... :) I wanted to at least post the issue. I will try to recreate it in isolation. I'd expect it would be reproducible by calling any sink with a fair amount of data. I don't know for sure the size of the payload matters. The app I've seen this in has pretty rapid sink writes also.


### Environment/Versions

- OS and processor: Linux
- Temporal Version: 0.20.1
- Are you using Docker or Kubernetes or building Temporal from source?
Docker + Kubernetes + Temporal Cloud
`node:16-bullseye`

### Additional context



#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-04-22 20:07:14.000 UTC</summary>

This is a limitation of the [`postMessage`](https://nodejs.org/api/worker_threads.html#portpostmessagevalue-transferlist) API.
We use this API because the workflow runs in a worker thread and the sink function runs on the main Node.js thread.

See also these architecture diagrams:
- https://github.com/temporalio/sdk-typescript/blob/main/docs/arch.svg
- https://github.com/temporalio/sdk-typescript/blob/main/docs/activation.mermaid

</details>


---

<a id="606"></a>

### #606: [Bug] Test env tests fail on windows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/606 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-04-21 23:10:39.000 UTC (3y 8m ago) |
| **Updated** | 2023-05-29 17:46:17.000 UTC |
| **Closed** | 2023-05-29 17:46:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Started seeing these CI failures during #551 

- TestEnvironment sleep can be used to delay activity completion
- node 14 windows

https://github.com/temporalio/sdk-typescript/runs/6103699027?check_suite_focus=true
https://github.com/temporalio/sdk-typescript/runs/6103869154?check_suite_focus=true

Happened 3x in a row in CI. 

I skipped that test, and then ran locally, and next test failed, so I skipped that as well.


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-03-09 00:20:11.000 UTC</summary>

I haven't seen these in a while.
@mjameswh can we close this?

</details>


---

<a id="601"></a>

### #601: core-2.0.0-beta.18.tgz: 9 vulnerabilities (highest severity is: 7.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/601 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-20 16:43:51.000 UTC (3y 8m ago) |
| **Updated** | 2022-07-07 19:53:31.000 UTC |
| **Closed** | 2022-07-07 19:53:29.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>core-2.0.0-beta.18.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2021-43138](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-43138) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.8 | async-2.6.3.tgz | Transitive | N/A | &#10060; |
| [CVE-2021-3807](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3807) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | ansi-regex-5.0.0.tgz | Transitive | N/A | &#10060; |
| [CVE-2020-7753](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-7753) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | trim-0.0.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-24772](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24772) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | node-forge-1.2.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-24771](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24771) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | node-forge-1.2.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2021-3803](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3803) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | nth-check-1.0.2.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-33987](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-9.6.0.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-24773](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24773) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | node-forge-1.2.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2021-44906](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.0 | minimist-1.2.5.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-43138</summary>


###  Vulnerable Library - <b>async-2.6.3.tgz</b></p>

<p>Higher-order functions and common patterns for asynchronous code</p>
<p>Library home page: <a href="https://registry.npmjs.org/async/-/async-2.6.3.tgz">https://registry.npmjs.org/async/-/async-2.6.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/async/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - portfinder-1.0.28.tgz
        - :x: **async-2.6.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
In Async before 2.6.4 and 3.x before 3.2.2, a malicious user can obtain privileges via the mapValues() method, aka lib/internal/iterator.js createObjectIterator prototype pollution.

<p>Publish Date: 2022-04-06
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-43138>CVE-2021-43138</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-43138">https://nvd.nist.gov/vuln/detail/CVE-2021-43138</a></p>
<p>Release Date: 2022-04-06</p>
<p>Fix Resolution: async - 2.6.4,3.2.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-3807</summary>


###  Vulnerable Library - <b>ansi-regex-5.0.0.tgz</b></p>

<p>Regular expression for matching ANSI escape codes</p>
<p>Library home page: <a href="https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.0.tgz">https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/ansi-regex/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - cli-table3-0.6.2.tgz
      - string-width-4.2.2.tgz
        - strip-ansi-6.0.0.tgz
          - :x: **ansi-regex-5.0.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
ansi-regex is vulnerable to Inefficient Regular Expression Complexity

<p>Publish Date: 2021-09-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3807>CVE-2021-3807</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://huntr.dev/bounties/5b3cf33b-ede0-4398-9974-800876dfd994/">https://huntr.dev/bounties/5b3cf33b-ede0-4398-9974-800876dfd994/</a></p>
<p>Release Date: 2021-09-17</p>
<p>Fix Resolution: ansi-regex - 5.0.1,6.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2020-7753</summary>


###  Vulnerable Library - <b>trim-0.0.1.tgz</b></p>

<p>Trim string whitespace</p>
<p>Library home page: <a href="https://registry.npmjs.org/trim/-/trim-0.0.1.tgz">https://registry.npmjs.org/trim/-/trim-0.0.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/trim/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - mdx-loader-2.0.0-beta.18.tgz
      - mdx-1.6.22.tgz
        - remark-parse-8.0.3.tgz
          - :x: **trim-0.0.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().

<p>Publish Date: 2020-10-27
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-7753>CVE-2020-7753</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2020-10-27</p>
<p>Fix Resolution: trim - 0.0.3</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-24772</summary>


###  Vulnerable Library - <b>node-forge-1.2.1.tgz</b></p>

<p>JavaScript implementations of network transports, cryptography, ciphers, PKI, message digests, and various utilities.</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz">https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - selfsigned-2.0.0.tgz
        - :x: **node-forge-1.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code does not check for tailing garbage bytes after decoding a `DigestInfo` ASN.1 structure. This can allow padding bytes to be removed and garbage data added to forge a signature when a low public exponent is being used. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.

<p>Publish Date: 2022-03-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24772>CVE-2022-24772</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24772">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24772</a></p>
<p>Release Date: 2022-03-18</p>
<p>Fix Resolution: node-forge - 1.3.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-24771</summary>


###  Vulnerable Library - <b>node-forge-1.2.1.tgz</b></p>

<p>JavaScript implementations of network transports, cryptography, ciphers, PKI, message digests, and various utilities.</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz">https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - selfsigned-2.0.0.tgz
        - :x: **node-forge-1.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code is lenient in checking the digest algorithm structure. This can allow a crafted structure that steals padding bytes and uses unchecked portion of the PKCS#1 encoded message to forge a signature when a low public exponent is being used. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.

<p>Publish Date: 2022-03-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24771>CVE-2022-24771</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24771">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24771</a></p>
<p>Release Date: 2022-03-18</p>
<p>Fix Resolution: node-forge - 1.3.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-3803</summary>


###  Vulnerable Library - <b>nth-check-1.0.2.tgz</b></p>

<p>performant nth-check parser & compiler</p>
<p>Library home page: <a href="https://registry.npmjs.org/nth-check/-/nth-check-1.0.2.tgz">https://registry.npmjs.org/nth-check/-/nth-check-1.0.2.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/@slorber/static-site-generator-webpack-plugin/node_modules/nth-check/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - static-site-generator-webpack-plugin-4.0.4.tgz
      - cheerio-0.22.0.tgz
        - css-select-1.2.0.tgz
          - :x: **nth-check-1.0.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
nth-check is vulnerable to Inefficient Regular Expression Complexity

<p>Publish Date: 2021-09-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3803>CVE-2021-3803</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2021-09-17</p>
<p>Fix Resolution: nth-check - v2.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-9.6.0.tgz</b></p>

<p>Simplified HTTP requests</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-9.6.0.tgz">https://registry.npmjs.org/got/-/got-9.6.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - :x: **got-9.6.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution: got - 11.8.5,12.1.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-24773</summary>


###  Vulnerable Library - <b>node-forge-1.2.1.tgz</b></p>

<p>JavaScript implementations of network transports, cryptography, ciphers, PKI, message digests, and various utilities.</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz">https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - selfsigned-2.0.0.tgz
        - :x: **node-forge-1.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code does not properly check `DigestInfo` for a proper ASN.1 structure. This can lead to successful verification with signatures that contain invalid structures but a valid digest. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.

<p>Publish Date: 2022-03-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24773>CVE-2022-24773</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24773">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24773</a></p>
<p>Release Date: 2022-03-18</p>
<p>Fix Resolution: node-forge - 1.3.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2021-44906</summary>


###  Vulnerable Library - <b>minimist-1.2.5.tgz</b></p>

<p>parse argument options</p>
<p>Library home page: <a href="https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz">https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/minimist/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.18.tgz (Root Library)
    - wait-on-6.0.1.tgz
      - :x: **minimist-1.2.5.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/fd77ceda0a8ab39fc542f3e9ee2875d074496775">fd77ceda0a8ab39fc542f3e9ee2875d074496775</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Minimist <=1.2.5 is vulnerable to Prototype Pollution via file index.js, function setKey() (lines 69-95).

<p>Publish Date: 2022-03-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906>CVE-2021-44906</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.0</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: High
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: Low
  - Integrity Impact: Low
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Release Date: 2022-03-17</p>
<p>Fix Resolution: minimist - 1.2.6</p>

</p>

<p></p>

</details>

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-07-07 19:53:31.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by Mend because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the Mend inventory.

</details>


---

<a id="593"></a>

### #593: swc-loader-0.1.15.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/593 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-15 21:08:17.000 UTC (3y 8m ago) |
| **Updated** | 2022-04-28 21:37:20.000 UTC |
| **Closed** | 2022-04-28 21:37:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>swc-loader-0.1.15.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/worker/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/minimist/package.json,/packages/worker/node_modules/minimist/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/51f2001a34f24d566e699d82731cb71701808011">51f2001a34f24d566e699d82731cb71701808011</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2021-44906](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | minimist-1.2.5.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-44906</summary>


###  Vulnerable Library - <b>minimist-1.2.5.tgz</b></p>

<p>parse argument options</p>
<p>Library home page: <a href="https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz">https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/minimist/package.json,/packages/worker/node_modules/minimist/package.json</p>
<p>

Dependency Hierarchy:
  - swc-loader-0.1.15.tgz (Root Library)
    - loader-utils-2.0.2.tgz
      - json5-2.2.0.tgz
        - :x: **minimist-1.2.5.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/51f2001a34f24d566e699d82731cb71701808011">51f2001a34f24d566e699d82731cb71701808011</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Minimist <=1.2.5 is vulnerable to Prototype Pollution via file index.js, function setKey() (lines 69-95).

<p>Publish Date: 2022-03-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906>CVE-2021-44906</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/substack/minimist/issues/164">https://github.com/substack/minimist/issues/164</a></p>
<p>Release Date: 2022-03-17</p>
<p>Fix Resolution: minimist - 1.2.6</p>

</p>

<p></p>

</details>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"minimist","packageVersion":"1.2.5","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"swc-loader:0.1.15;loader-utils:2.0.2;json5:2.2.0;minimist:1.2.5","isMinimumFixVersionAvailable":true,"minimumFixVersion":"minimist - 1.2.6","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-44906","vulnerabilityDetails":"Minimist \u003c\u003d1.2.5 is vulnerable to Prototype Pollution via file index.js, function setKey() (lines 69-95).","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906","cvss3Severity":"high","cvss3Score":"9.8","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"High","UI":"None","AV":"Network","I":"High"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-28 21:37:20.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>


---

<a id="576"></a>

### #576: [Feature Request] Return string for Workflow status

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/576 |
| **State** | CLOSED |
| **Author** | rupalivohra (Rupali Vohra) |
| **Created** | 2022-04-05 18:35:55.000 UTC (3y 9m ago) |
| **Updated** | 2022-10-11 08:53:58.000 UTC |
| **Closed** | 2022-06-01 17:58:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->
We leverage `handle.describe()` to see the status of a workflow. Today, we have to build a wrapper around the response to translate the gRPC code (a number) to a meaningful status (a string).

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->
Return a string type to represent status in the `WorkflowExecutionDescription`.

More explicitly, this:
```typescript
export interface WorkflowExecutionDescription {
    ...
    status: temporal.api.enums.v1.WorkflowExecutionStatus;
    ...
}

enum WorkflowExecutionStatus {
    WORKFLOW_EXECUTION_STATUS_UNSPECIFIED = 0,
    WORKFLOW_EXECUTION_STATUS_RUNNING = 1,
    WORKFLOW_EXECUTION_STATUS_COMPLETED = 2,
    WORKFLOW_EXECUTION_STATUS_FAILED = 3,
    WORKFLOW_EXECUTION_STATUS_CANCELED = 4,
    WORKFLOW_EXECUTION_STATUS_TERMINATED = 5,
    WORKFLOW_EXECUTION_STATUS_CONTINUED_AS_NEW = 6,
    WORKFLOW_EXECUTION_STATUS_TIMED_OUT = 7
}
```

turns into this:

```typescript
export interface WorkflowExecutionDescription {
  ...
  status: WorkflowExecutionStatus
  ...
}

export type WorkflowExecutionStatus = 'Canceled' | 'Completed' | 'Continued_As_New' | 'Failed' | ...
```


#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-10-11 08:53:57.000 UTC</summary>

Great idea, thanks!

On Tue, Apr 5, 2022 at 1:36 PM Rupali Vohra ***@***.***>
wrote:

> Is your feature request related to a problem? Please describe.
>
> We leverage handle.describe() to see the status of a workflow. Today, we
> have to build a wrapper around the response to translate the gRPC code (a
> number) to a meaningful status (a string).
> Describe the solution you'd like
>
> Return a string type to represent status in the
> WorkflowExecutionDescription.
>
> More explicitly, this:
>
> export interface WorkflowExecutionDescription {
>     ...
>     status: temporal.api.enums.v1.WorkflowExecutionStatus;
>     ...}
> enum WorkflowExecutionStatus {
>     WORKFLOW_EXECUTION_STATUS_UNSPECIFIED = 0,
>     WORKFLOW_EXECUTION_STATUS_RUNNING = 1,
>     WORKFLOW_EXECUTION_STATUS_COMPLETED = 2,
>     WORKFLOW_EXECUTION_STATUS_FAILED = 3,
>     WORKFLOW_EXECUTION_STATUS_CANCELED = 4,
>     WORKFLOW_EXECUTION_STATUS_TERMINATED = 5,
>     WORKFLOW_EXECUTION_STATUS_CONTINUED_AS_NEW = 6,
>     WORKFLOW_EXECUTION_STATUS_TIMED_OUT = 7}
>
> turns into this:
>
> export interface WorkflowExecutionDescription {
>   ...
>   status: WorkflowExecutionStatus
>   ...}
> export type WorkflowExecutionStatus = 'Canceled' | 'Completed' | 'Continued_As_New' | 'Failed' | ...
>
> ‚Äî
> Reply to this email directly, view it on GitHub
> <https://github.com/temporalio/sdk-typescript/issues/576>, or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AAB5LGB7LCKGU4LFPKAZDUDVDSBZPANCNFSM5STUKRXA>
> .
> You are receiving this because you are subscribed to this thread.Message
> ID: ***@***.***>
>


</details>


---

<a id="574"></a>

### #574: core-2.0.0-beta.15.tgz: 8 vulnerabilities (highest severity is: 7.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/574 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-01 03:20:05.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-20 16:43:59.000 UTC |
| **Closed** | 2022-04-20 16:43:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>core-2.0.0-beta.15.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2021-43138](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-43138) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.8 | async-2.6.3.tgz | Transitive | N/A | &#10060; |
| [CVE-2021-3807](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3807) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | multiple | Transitive | N/A | &#10060; |
| [CVE-2022-24772](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24772) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | node-forge-1.2.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2020-7753](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-7753) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | trim-0.0.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-24771](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24771) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | node-forge-1.2.1.tgz | Transitive | N/A | &#10060; |
| [CVE-2021-3803](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3803) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | nth-check-1.0.2.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-0144](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-0144) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.1 | shelljs-0.8.4.tgz | Transitive | N/A | &#10060; |
| [CVE-2022-24773](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24773) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | node-forge-1.2.1.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-43138</summary>


###  Vulnerable Library - <b>async-2.6.3.tgz</b></p>

<p>Higher-order functions and common patterns for asynchronous code</p>
<p>Library home page: <a href="https://registry.npmjs.org/async/-/async-2.6.3.tgz">https://registry.npmjs.org/async/-/async-2.6.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/async/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - portfinder-1.0.28.tgz
        - :x: **async-2.6.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A vulnerability exists in Async through 3.2.1 (fixed in 3.2.2) , which could let a malicious user obtain privileges via the mapValues() method.

<p>Publish Date: 2022-04-06
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-43138>CVE-2021-43138</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: Required
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-43138">https://nvd.nist.gov/vuln/detail/CVE-2021-43138</a></p>
<p>Release Date: 2022-04-06</p>
<p>Fix Resolution: async - v3.2.2</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-3807</summary>


###  Vulnerable Libraries - <b>ansi-regex-5.0.0.tgz</b>, <b>ansi-regex-4.1.0.tgz</b></p>
<p>


### <b>ansi-regex-5.0.0.tgz</b></p>

<p>Regular expression for matching ANSI escape codes</p>
<p>Library home page: <a href="https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.0.tgz">https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/ansi-regex/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - strip-ansi-6.0.0.tgz
      - :x: **ansi-regex-5.0.0.tgz** (Vulnerable Library)


### <b>ansi-regex-4.1.0.tgz</b></p>

<p>Regular expression for matching ANSI escape codes</p>
<p>Library home page: <a href="https://registry.npmjs.org/ansi-regex/-/ansi-regex-4.1.0.tgz">https://registry.npmjs.org/ansi-regex/-/ansi-regex-4.1.0.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/ansi-align/node_modules/ansi-regex/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - boxen-5.0.1.tgz
      - ansi-align-3.0.0.tgz
        - string-width-3.1.0.tgz
          - strip-ansi-5.2.0.tgz
            - :x: **ansi-regex-4.1.0.tgz** (Vulnerable Library)


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
ansi-regex is vulnerable to Inefficient Regular Expression Complexity

<p>Publish Date: 2021-09-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3807>CVE-2021-3807</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://huntr.dev/bounties/5b3cf33b-ede0-4398-9974-800876dfd994/">https://huntr.dev/bounties/5b3cf33b-ede0-4398-9974-800876dfd994/</a></p>
<p>Release Date: 2021-09-17</p>
<p>Fix Resolution: ansi-regex - 5.0.1,6.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-24772</summary>


###  Vulnerable Library - <b>node-forge-1.2.1.tgz</b></p>

<p>JavaScript implementations of network transports, cryptography, ciphers, PKI, message digests, and various utilities.</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz">https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - selfsigned-2.0.0.tgz
        - :x: **node-forge-1.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code does not check for tailing garbage bytes after decoding a `DigestInfo` ASN.1 structure. This can allow padding bytes to be removed and garbage data added to forge a signature when a low public exponent is being used. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.

<p>Publish Date: 2022-03-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24772>CVE-2022-24772</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24772">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24772</a></p>
<p>Release Date: 2022-03-18</p>
<p>Fix Resolution: node-forge - 1.3.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2020-7753</summary>


###  Vulnerable Library - <b>trim-0.0.1.tgz</b></p>

<p>Trim string whitespace</p>
<p>Library home page: <a href="https://registry.npmjs.org/trim/-/trim-0.0.1.tgz">https://registry.npmjs.org/trim/-/trim-0.0.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/trim/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - mdx-loader-2.0.0-beta.15.tgz
      - mdx-1.6.22.tgz
        - remark-parse-8.0.3.tgz
          - :x: **trim-0.0.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().

<p>Publish Date: 2020-10-27
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-7753>CVE-2020-7753</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/component/trim/pull/8">https://github.com/component/trim/pull/8</a></p>
<p>Release Date: 2020-10-27</p>
<p>Fix Resolution: trim - 0.0.3</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-24771</summary>


###  Vulnerable Library - <b>node-forge-1.2.1.tgz</b></p>

<p>JavaScript implementations of network transports, cryptography, ciphers, PKI, message digests, and various utilities.</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz">https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - selfsigned-2.0.0.tgz
        - :x: **node-forge-1.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code is lenient in checking the digest algorithm structure. This can allow a crafted structure that steals padding bytes and uses unchecked portion of the PKCS#1 encoded message to forge a signature when a low public exponent is being used. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.

<p>Publish Date: 2022-03-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24771>CVE-2022-24771</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: High
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24771">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24771</a></p>
<p>Release Date: 2022-03-18</p>
<p>Fix Resolution: node-forge - 1.3.0</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-3803</summary>


###  Vulnerable Library - <b>nth-check-1.0.2.tgz</b></p>

<p>performant nth-check parser & compiler</p>
<p>Library home page: <a href="https://registry.npmjs.org/nth-check/-/nth-check-1.0.2.tgz">https://registry.npmjs.org/nth-check/-/nth-check-1.0.2.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/nth-check/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - static-site-generator-webpack-plugin-4.0.1.tgz
      - cheerio-0.22.0.tgz
        - css-select-1.2.0.tgz
          - :x: **nth-check-1.0.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
nth-check is vulnerable to Inefficient Regular Expression Complexity

<p>Publish Date: 2021-09-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3803>CVE-2021-3803</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/fb55/nth-check/compare/v2.0.0...v2.0.1">https://github.com/fb55/nth-check/compare/v2.0.0...v2.0.1</a></p>
<p>Release Date: 2021-09-17</p>
<p>Fix Resolution: nth-check - v2.0.1</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-0144</summary>


###  Vulnerable Library - <b>shelljs-0.8.4.tgz</b></p>

<p>Portable Unix shell commands for Node.js</p>
<p>Library home page: <a href="https://registry.npmjs.org/shelljs/-/shelljs-0.8.4.tgz">https://registry.npmjs.org/shelljs/-/shelljs-0.8.4.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/shelljs/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - :x: **shelljs-0.8.4.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
shelljs is vulnerable to Improper Privilege Management

<p>Publish Date: 2022-01-11
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-0144>CVE-2022-0144</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.1</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Local
  - Attack Complexity: Low
  - Privileges Required: Low
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/shelljs/shelljs/commit/d919d22dd6de385edaa9d90313075a77f74b338c">https://github.com/shelljs/shelljs/commit/d919d22dd6de385edaa9d90313075a77f74b338c</a></p>
<p>Release Date: 2022-01-11</p>
<p>Fix Resolution: shelljs - 0.8.5</p>

</p>

<p></p>

</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-24773</summary>


###  Vulnerable Library - <b>node-forge-1.2.1.tgz</b></p>

<p>JavaScript implementations of network transports, cryptography, ciphers, PKI, message digests, and various utilities.</p>
<p>Library home page: <a href="https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz">https://registry.npmjs.org/node-forge/-/node-forge-1.2.1.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/node-forge/package.json</p>
<p>

Dependency Hierarchy:
  - core-2.0.0-beta.15.tgz (Root Library)
    - webpack-dev-server-4.7.4.tgz
      - selfsigned-2.0.0.tgz
        - :x: **node-forge-1.2.1.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code does not properly check `DigestInfo` for a proper ASN.1 structure. This can lead to successful verification with signatures that contain invalid structures but a valid digest. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.

<p>Publish Date: 2022-03-18
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24773>CVE-2022-24773</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24773">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24773</a></p>
<p>Release Date: 2022-03-18</p>
<p>Fix Resolution: node-forge - 1.3.0</p>

</p>

<p></p>

</details>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"async","packageVersion":"2.6.3","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;webpack-dev-server:4.7.4;portfinder:1.0.28;async:2.6.3","isMinimumFixVersionAvailable":true,"minimumFixVersion":"async - v3.2.2","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-43138","vulnerabilityDetails":"A vulnerability exists in Async through 3.2.1 (fixed in 3.2.2) , which could let a malicious user obtain privileges via the mapValues() method.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-43138","cvss3Severity":"high","cvss3Score":"7.8","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"High","UI":"Required","AV":"Local","I":"High"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"ansi-regex","packageVersion":"5.0.0","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;strip-ansi:6.0.0;ansi-regex:5.0.0","isMinimumFixVersionAvailable":true,"minimumFixVersion":"ansi-regex - 5.0.1,6.0.1","isBinary":false},{"packageType":"javascript/Node.js","packageName":"ansi-regex","packageVersion":"4.1.0","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;boxen:5.0.1;ansi-align:3.0.0;string-width:3.1.0;strip-ansi:5.2.0;ansi-regex:4.1.0","isMinimumFixVersionAvailable":true,"minimumFixVersion":"ansi-regex - 5.0.1,6.0.1","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-3807","vulnerabilityDetails":"ansi-regex is vulnerable to Inefficient Regular Expression Complexity","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3807","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"node-forge","packageVersion":"1.2.1","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;webpack-dev-server:4.7.4;selfsigned:2.0.0;node-forge:1.2.1","isMinimumFixVersionAvailable":true,"minimumFixVersion":"node-forge - 1.3.0","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2022-24772","vulnerabilityDetails":"Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code does not check for tailing garbage bytes after decoding a `DigestInfo` ASN.1 structure. This can allow padding bytes to be removed and garbage data added to forge a signature when a low public exponent is being used. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24772","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"None","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"High"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"trim","packageVersion":"0.0.1","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;@docusaurus/mdx-loader:2.0.0-beta.15;@mdx-js/mdx:1.6.22;remark-parse:8.0.3;trim:0.0.1","isMinimumFixVersionAvailable":true,"minimumFixVersion":"trim - 0.0.3","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2020-7753","vulnerabilityDetails":"All versions of package trim are vulnerable to Regular Expression Denial of Service (ReDoS) via trim().","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2020-7753","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"node-forge","packageVersion":"1.2.1","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;webpack-dev-server:4.7.4;selfsigned:2.0.0;node-forge:1.2.1","isMinimumFixVersionAvailable":true,"minimumFixVersion":"node-forge - 1.3.0","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2022-24771","vulnerabilityDetails":"Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code is lenient in checking the digest algorithm structure. This can allow a crafted structure that steals padding bytes and uses unchecked portion of the PKCS#1 encoded message to forge a signature when a low public exponent is being used. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24771","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"None","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"High"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"nth-check","packageVersion":"1.0.2","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;@slorber/static-site-generator-webpack-plugin:4.0.1;cheerio:0.22.0;css-select:1.2.0;nth-check:1.0.2","isMinimumFixVersionAvailable":true,"minimumFixVersion":"nth-check - v2.0.1","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-3803","vulnerabilityDetails":"nth-check is vulnerable to Inefficient Regular Expression Complexity","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-3803","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"shelljs","packageVersion":"0.8.4","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;shelljs:0.8.4","isMinimumFixVersionAvailable":true,"minimumFixVersion":"shelljs - 0.8.5","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2022-0144","vulnerabilityDetails":"shelljs is vulnerable to Improper Privilege Management","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-0144","cvss3Severity":"high","cvss3Score":"7.1","cvss3Metrics":{"A":"High","AC":"Low","PR":"Low","S":"Unchanged","C":"High","UI":"None","AV":"Local","I":"None"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"node-forge","packageVersion":"1.2.1","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":true,"dependencyTree":"@docusaurus/core:2.0.0-beta.15;webpack-dev-server:4.7.4;selfsigned:2.0.0;node-forge:1.2.1","isMinimumFixVersionAvailable":true,"minimumFixVersion":"node-forge - 1.3.0","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2022-24773","vulnerabilityDetails":"Forge (also called `node-forge`) is a native implementation of Transport Layer Security in JavaScript. Prior to version 1.3.0, RSA PKCS#1 v1.5 signature verification code does not properly check `DigestInfo` for a proper ASN.1 structure. This can lead to successful verification with signatures that contain invalid structures but a valid digest. The issue has been addressed in `node-forge` version 1.3.0. There are currently no known workarounds.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-24773","cvss3Severity":"medium","cvss3Score":"5.3","cvss3Metrics":{"A":"None","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"Low"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-20 16:43:59.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>


---

<a id="572"></a>

### #572: json5-2.2.0.tgz: 1 vulnerabilities (highest severity is: 9.8) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/572 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-01 03:20:01.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-15 21:08:20.000 UTC |
| **Closed** | 2022-04-15 21:08:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>json5-2.2.0.tgz</b></p></summary>

<p></p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/3a257e89f945fcdb6df742f8f804370c60925918">3a257e89f945fcdb6df742f8f804370c60925918</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2021-44906](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 9.8 | minimist-1.2.5.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-44906</summary>


###  Vulnerable Library - <b>minimist-1.2.5.tgz</b></p>

<p>parse argument options</p>
<p>Library home page: <a href="https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz">https://registry.npmjs.org/minimist/-/minimist-1.2.5.tgz</a></p>
<p>

Dependency Hierarchy:
  - json5-2.2.0.tgz (Root Library)
    - :x: **minimist-1.2.5.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/3a257e89f945fcdb6df742f8f804370c60925918">3a257e89f945fcdb6df742f8f804370c60925918</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Minimist <=1.2.5 is vulnerable to Prototype Pollution via file index.js, function setKey() (lines 69-95).

<p>Publish Date: 2022-03-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906>CVE-2021-44906</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: High
  - Integrity Impact: High
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/substack/minimist/issues/164">https://github.com/substack/minimist/issues/164</a></p>
<p>Release Date: 2022-03-17</p>
<p>Fix Resolution: minimist - 1.2.6</p>

</p>

<p></p>

</details>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"minimist","packageVersion":"1.2.5","packageFilePaths":[],"isTransitiveDependency":true,"dependencyTree":"json5:2.2.0;minimist:1.2.5","isMinimumFixVersionAvailable":true,"minimumFixVersion":"minimist - 1.2.6","isBinary":true}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-44906","vulnerabilityDetails":"Minimist \u003c\u003d1.2.5 is vulnerable to Prototype Pollution via file index.js, function setKey() (lines 69-95).","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44906","cvss3Severity":"high","cvss3Score":"9.8","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"High","UI":"None","AV":"Network","I":"High"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-15 21:08:20.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>


---

<a id="571"></a>

### #571: typedoc-0.21.6.tgz: 2 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/571 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-01 03:19:59.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-20 16:43:56.000 UTC |
| **Closed** | 2022-04-20 16:43:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>typedoc-0.21.6.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/marked/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-21681](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-21681) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | marked-2.1.3.tgz | Transitive | 0.22.11 | &#9989; |
| [CVE-2022-21680](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-21680) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | marked-2.1.3.tgz | Transitive | 0.22.11 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-21681</summary>


###  Vulnerable Library - <b>marked-2.1.3.tgz</b></p>

<p>A markdown parser built for speed</p>
<p>Library home page: <a href="https://registry.npmjs.org/marked/-/marked-2.1.3.tgz">https://registry.npmjs.org/marked/-/marked-2.1.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/marked/package.json</p>
<p>

Dependency Hierarchy:
  - typedoc-0.21.6.tgz (Root Library)
    - :x: **marked-2.1.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Marked is a markdown parser and compiler. Prior to version 4.0.10, the regular expression `inline.reflinkSearch` may cause catastrophic backtracking against some strings and lead to a denial of service (DoS). Anyone who runs untrusted markdown through a vulnerable version of marked and does not use a worker with a time limit may be affected. This issue is patched in version 4.0.10. As a workaround, avoid running untrusted markdown through marked or run marked on a worker thread and set a reasonable time limit to prevent draining resources.

<p>Publish Date: 2022-01-14
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-21681>CVE-2022-21681</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-5v2h-r2cx-5xgj">https://github.com/advisories/GHSA-5v2h-r2cx-5xgj</a></p>
<p>Release Date: 2022-01-14</p>
<p>Fix Resolution (marked): 4.0.10</p>
<p>Direct dependency fix Resolution (typedoc): 0.22.11</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details><details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2022-21680</summary>


###  Vulnerable Library - <b>marked-2.1.3.tgz</b></p>

<p>A markdown parser built for speed</p>
<p>Library home page: <a href="https://registry.npmjs.org/marked/-/marked-2.1.3.tgz">https://registry.npmjs.org/marked/-/marked-2.1.3.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/marked/package.json</p>
<p>

Dependency Hierarchy:
  - typedoc-0.21.6.tgz (Root Library)
    - :x: **marked-2.1.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/eb5901f47e16f8c8fe36c1154d5176c5f3205efc">eb5901f47e16f8c8fe36c1154d5176c5f3205efc</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
Marked is a markdown parser and compiler. Prior to version 4.0.10, the regular expression `block.def` may cause catastrophic backtracking against some strings and lead to a regular expression denial of service (ReDoS). Anyone who runs untrusted markdown through a vulnerable version of marked and does not use a worker with a time limit may be affected. This issue is patched in version 4.0.10. As a workaround, avoid running untrusted markdown through marked or run marked on a worker thread and set a reasonable time limit to prevent draining resources.

<p>Publish Date: 2022-01-14
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-21680>CVE-2022-21680</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://github.com/advisories/GHSA-rrrm-qjm4-v8hf">https://github.com/advisories/GHSA-rrrm-qjm4-v8hf</a></p>
<p>Release Date: 2022-01-14</p>
<p>Fix Resolution (marked): 4.0.10</p>
<p>Direct dependency fix Resolution (typedoc): 0.22.11</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"typedoc","packageVersion":"0.21.6","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":false,"dependencyTree":"typedoc:0.21.6","isMinimumFixVersionAvailable":true,"minimumFixVersion":"0.22.11","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2022-21681","vulnerabilityDetails":"Marked is a markdown parser and compiler. Prior to version 4.0.10, the regular expression `inline.reflinkSearch` may cause catastrophic backtracking against some strings and lead to a denial of service (DoS). Anyone who runs untrusted markdown through a vulnerable version of marked and does not use a worker with a time limit may be affected. This issue is patched in version 4.0.10. As a workaround, avoid running untrusted markdown through marked or run marked on a worker thread and set a reasonable time limit to prevent draining resources.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-21681","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}},{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"typedoc","packageVersion":"0.21.6","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":false,"dependencyTree":"typedoc:0.21.6","isMinimumFixVersionAvailable":true,"minimumFixVersion":"0.22.11","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2022-21680","vulnerabilityDetails":"Marked is a markdown parser and compiler. Prior to version 4.0.10, the regular expression `block.def` may cause catastrophic backtracking against some strings and lead to a regular expression denial of service (ReDoS). Anyone who runs untrusted markdown through a vulnerable version of marked and does not use a worker with a time limit may be affected. This issue is patched in version 4.0.10. As a workaround, avoid running untrusted markdown through marked or run marked on a worker thread and set a reasonable time limit to prevent draining resources.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-21680","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-20 16:43:56.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>


---

<a id="570"></a>

### #570: webpack-5.5.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/570 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-01 03:19:57.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-14 05:34:54.000 UTC |
| **Closed** | 2022-04-14 05:34:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>webpack-5.5.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/svgo/node_modules/css-what/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/3a257e89f945fcdb6df742f8f804370c60925918">3a257e89f945fcdb6df742f8f804370c60925918</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2021-33587](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-33587) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | css-what-3.4.2.tgz | Transitive | 6.0.0-alpha.0 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-33587</summary>


###  Vulnerable Library - <b>css-what-3.4.2.tgz</b></p>

<p>a CSS selector parser</p>
<p>Library home page: <a href="https://registry.npmjs.org/css-what/-/css-what-3.4.2.tgz">https://registry.npmjs.org/css-what/-/css-what-3.4.2.tgz</a></p>
<p>Path to dependency file: /packages/docs/package.json</p>
<p>Path to vulnerable library: /packages/docs/node_modules/svgo/node_modules/css-what/package.json</p>
<p>

Dependency Hierarchy:
  - webpack-5.5.0.tgz (Root Library)
    - plugin-svgo-5.5.0.tgz
      - svgo-1.3.2.tgz
        - css-select-2.1.0.tgz
          - :x: **css-what-3.4.2.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/3a257e89f945fcdb6df742f8f804370c60925918">3a257e89f945fcdb6df742f8f804370c60925918</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The css-what package 4.0.0 through 5.0.0 for Node.js does not ensure that attribute parsing has Linear Time Complexity relative to the size of the input.

<p>Publish Date: 2021-05-28
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-33587>CVE-2021-33587</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-33587">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-33587</a></p>
<p>Release Date: 2021-05-28</p>
<p>Fix Resolution (css-what): 5.0.1</p>
<p>Direct dependency fix Resolution (@svgr/webpack): 6.0.0-alpha.0</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"@svgr/webpack","packageVersion":"5.5.0","packageFilePaths":["/packages/docs/package.json"],"isTransitiveDependency":false,"dependencyTree":"@svgr/webpack:5.5.0","isMinimumFixVersionAvailable":true,"minimumFixVersion":"6.0.0-alpha.0","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-33587","vulnerabilityDetails":"The css-what package 4.0.0 through 5.0.0 for Node.js does not ensure that attribute parsing has Linear Time Complexity relative to the size of the input.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-33587","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-14 05:34:54.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>


---

<a id="569"></a>

### #569: lerna-4.0.0.tgz: 1 vulnerabilities (highest severity is: 7.5) - autoclosed

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/569 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-04-01 03:19:55.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-14 22:38:56.000 UTC |
| **Closed** | 2022-04-14 22:38:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>lerna-4.0.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/request/node_modules/qs/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/3a257e89f945fcdb6df742f8f804370c60925918">3a257e89f945fcdb6df742f8f804370c60925918</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2021-44907](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44907) | <img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> High | 7.5 | qs-6.5.3.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/high_vul.png' width=19 height=20> CVE-2021-44907</summary>


###  Vulnerable Library - <b>qs-6.5.3.tgz</b></p>

<p>A querystring parser that supports nesting and arrays, with a depth limit</p>
<p>Library home page: <a href="https://registry.npmjs.org/qs/-/qs-6.5.3.tgz">https://registry.npmjs.org/qs/-/qs-6.5.3.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/request/node_modules/qs/package.json</p>
<p>

Dependency Hierarchy:
  - lerna-4.0.0.tgz (Root Library)
    - bootstrap-4.0.0.tgz
      - run-lifecycle-4.0.0.tgz
        - npm-lifecycle-3.1.5.tgz
          - node-gyp-5.1.1.tgz
            - request-2.88.2.tgz
              - :x: **qs-6.5.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/3a257e89f945fcdb6df742f8f804370c60925918">3a257e89f945fcdb6df742f8f804370c60925918</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
A Denial of Service vulnerability exists in qs up to 6.8.0 due to insufficient sanitization of property in the gs.parse function. The merge() function allows the assignment of properties on an array in the query. For any property being assigned, a value in the array is converted to an object containing these properties. Essentially, this means that the property whose expected type is Array always has to be checked with Array.isArray() by the user. This may not be obvious to the user and can cause unexpected behavior.

<p>Publish Date: 2022-03-17
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44907>CVE-2021-44907</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>7.5</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: High
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44907">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44907</a></p>
<p>Release Date: 2022-03-17</p>
<p>Fix Resolution: qs - 6.8.1</p>

</p>

<p></p>

</details>
<!-- <REMEDIATE>[{"isOpenPROnVulnerability":true,"isPackageBased":true,"isDefaultBranch":true,"packages":[{"packageType":"javascript/Node.js","packageName":"qs","packageVersion":"6.5.3","packageFilePaths":["/package.json"],"isTransitiveDependency":true,"dependencyTree":"lerna:4.0.0;@lerna/bootstrap:4.0.0;@lerna/run-lifecycle:4.0.0;npm-lifecycle:3.1.5;node-gyp:5.1.1;request:2.88.2;qs:6.5.3","isMinimumFixVersionAvailable":true,"minimumFixVersion":"qs - 6.8.1","isBinary":false}],"baseBranches":["main"],"vulnerabilityIdentifier":"CVE-2021-44907","vulnerabilityDetails":"A Denial of Service vulnerability exists in qs up to 6.8.0 due to insufficient sanitization of property in the gs.parse function. The merge() function allows the assignment of properties on an array in the query. For any property being assigned, a value in the array is converted to an object containing these properties. Essentially, this means that the property whose expected type is Array always has to be checked with Array.isArray() by the user. This may not be obvious to the user and can cause unexpected behavior.","vulnerabilityUrl":"https://vuln.whitesourcesoftware.com/vulnerability/CVE-2021-44907","cvss3Severity":"high","cvss3Score":"7.5","cvss3Metrics":{"A":"High","AC":"Low","PR":"None","S":"Unchanged","C":"None","UI":"None","AV":"Network","I":"None"},"extraData":{}}]</REMEDIATE> -->

#### Comments (1)

<details>
<summary><strong>mend-for-github-com</strong> commented on 2022-04-14 22:38:56.000 UTC</summary>

:heavy_check_mark: This issue was automatically closed by WhiteSource because the vulnerable library in the specific branch(es) was either marked as ignored or it is no longer part of the WhiteSource inventory.

</details>


---

<a id="562"></a>

### #562: [Feature Request] Use options object for ApplicationFailure

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/562 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-25 23:30:44.000 UTC (3y 9m ago) |
| **Updated** | 2022-07-09 01:17:19.000 UTC |
| **Closed** | 2022-07-09 01:17:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Problem

Hard to know meaning of args when looking at call site, and you have to provide unnecessary ones to get to later ones you want to use:

![image](https://user-images.githubusercontent.com/251288/160212982-d291b1c2-6a79-4559-80c4-d65844173aef.png)

### Solution options

```ts
new ApplicationFailure('my message', {
  type: 'old-cookie', 
  nonRetryable: true, 
  cause: e
})
```

- Having `message` as first param matches `Error` constructor, but it's optional and sometimes I'd only use `type`. 
- `nonRetryable`: having a negated boolean name feels awk to me

So I'd prefer:

```ts
new ApplicationFailure({
  message: 'my message',
  type: 'old-cookie', 
  retryable: false, 
  cause: e
})
```

And:

```ts
ApplicationFailure.nonRetryable({
  message: 'my message',
  type: 'old-cookie', 
  cause: e
})
```

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-09 00:38:42.000 UTC</summary>

It's way too late to change now IMO, can we close this?

</details>


---

<a id="557"></a>

### #557: [Bug] WithWorkflowArgs is not exported

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/557 |
| **State** | CLOSED |
| **Author** | rupalivohra (Rupali Vohra) |
| **Created** | 2022-03-24 20:31:59.000 UTC (3y 9m ago) |
| **Updated** | 2022-03-25 05:47:11.000 UTC |
| **Closed** | 2022-03-25 05:46:37.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am using `WithWorkflowArgs` to get strong typing in a wrapper around the `SignalWithStart` client call.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->
This type used to be exported under @temporalio/common, but no longer is. It's also not available in @temporalio/client, which is the other place I'd expect it. Following the instructions from the [CHANGELOG](https://github.com/temporalio/sdk-typescript/blob/main/CHANGELOG.md#features-1), I'm opening this bug to track re-exporting the type.

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->
![Screen Shot 2022-03-24 at 1 28 28 PM](https://user-images.githubusercontent.com/5040637/160004724-8d0ebc85-c98e-467e-9431-d942df7121c0.png)

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: MB Pro 2019, Monterey
- Temporal Version: 0.19.x
- Are you using Docker or Kubernetes or building Temporal from source? This fails during compilation

### Additional Context

For now, I'm doing: `import { WithWorkflowArgs } from '@temporalio/internal-workflow-common';`

#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-03-25 05:47:11.000 UTC</summary>

Thanks for reporting! ‚ò∫Ô∏è

</details>


---

<a id="556"></a>

### #556: [Feature Request] Move BuildKite builds to GH Actions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/556 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-03-24 16:17:23.000 UTC (3y 9m ago) |
| **Updated** | 2022-06-03 22:31:17.000 UTC |
| **Closed** | 2022-06-03 22:31:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Currently we have 2 build jobs: per change and nightly in BuildKite.
The nightly job is failing because of a BuildKite docker-compose plugin bug.
Once we get self hosted GH actions runners, we should move those jobs for better public visibility.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-06-03 22:31:17.000 UTC</summary>

This was done already

</details>


---

<a id="553"></a>

### #553: [Feature Request] Error when Workflow APIs are used outside of vm

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/553 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-21 19:20:14.000 UTC (3y 9m ago) |
| **Updated** | 2023-05-30 18:53:25.000 UTC |
| **Closed** | 2023-05-30 18:53:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

We should provide better error messages to save users some headache. Currently they get like

```
WorkflowFailedError [WorkflowExecutionFailedError]: Workflow execution failed
  cause: [TemporalFailure: Activity execution failed] {
    cause: TypeError: exports.storage.getStore is not a function
```    
    
when using `condition` in an Activity

#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2023-02-01 16:01:48.000 UTC</summary>

Ran into this again‚Äîuser using `import { sleep } from '@temporalio/workflow';` in an Activity, getting IllegalStateError, and not knowing what's wrong.

Repro: https://github.com/lorensr/workflow-statuses/blob/repro-illegal-state/src/activities/sleep.ts

![image](https://user-images.githubusercontent.com/251288/216096156-75eb1c04-17db-4215-a65f-a793a9da7cb7.png)


</details>


---

<a id="548"></a>

### #548: [Feature Request] Use protobufjs global for deserializing protobufs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/548 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-19 03:16:30.000 UTC (3y 9m ago) |
| **Updated** | 2022-06-17 22:56:45.000 UTC |
| **Closed** | 2022-06-17 22:56:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |

#### Description

Given that protobufjs has a global `module.roots` field that gets added to by `pbjs`-generated code, I think we could drop the `root` arg to our `Protobuf*PayloadConverter` classes. Instead, we would go through `module.roots.*` and use the first valid `root.lookup(messageName)`. 

The user requirements changes for this working would be:

## Removed

- Must pass `root` arg to constructor
- Must use custom data converter (because we can add proto to default converter)

## Added

- If there are duplicate message names, they must be the same type (since we may find either one first). (Alternatively, we could search in sorted order, and let users know that they should give the root with the version of the message we should use a name that's before others alphabetically.
- Must use a compatible version of `protobufjs` (we're currently on `^6.11.2` but we could probably switch to `^6.0.0`) and a package manager that dedups (so the same code is run, so we share `module.roots` with them)
- Must run `pbjs -t json-modules` to generate their `root.js`, and require `root.js` in their worker and workflow code.



#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-06-17 22:56:45.000 UTC</summary>

I worked on adding protobuf payload converters to default payload converter in the https://github.com/temporalio/sdk-typescript/tree/use-global branch, but we decided to not complete it. The issue was:

- It requires importing `protobufjs/light`, which doubles the bundle size (.25 to .5 MB)
- In order to not import ^ into bundles of those not using protobufs: 
  - the user has to import `protobufjs` into their workflow code (so in cases in which only protobufjs types are used, an extra import statement has to be added)
  - we have do to some TBD hack to get webpack to not look at our import of `protobufjs`, but it to still work at runtime if the user imported `protobufjs`
  
  

</details>


---

<a id="530"></a>

### #530: [Bug] test-npm-init hangs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/530 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-12 02:22:54.000 UTC (3y 10m ago) |
| **Updated** | 2022-03-20 03:00:42.000 UTC |
| **Closed** | 2022-03-20 03:00:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

On step `Test run a workflow`, but there's no output:

<img width="1531" alt="image" src="https://user-images.githubusercontent.com/251288/158000147-6a41bfde-3dcc-4d8f-beca-66ddc1d0c0bf.png">


https://github.com/temporalio/sdk-typescript/runs/5519135758?check_suite_focus=true

#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-03-20 03:00:41.000 UTC</summary>

Fixed by https://github.com/temporalio/sdk-typescript/pull/535

</details>


---

<a id="528"></a>

### #528: [Bug] CI tests skipped due to an issue with core build?

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/528 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-11 21:58:43.000 UTC (3y 10m ago) |
| **Updated** | 2022-10-11 23:38:42.000 UTC |
| **Closed** | 2022-10-11 23:38:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

From Roey, when no tests are found like this:
```
@temporalio/test:   √ó No tests found in lib\test-integration-codec.js
@temporalio/test:   √ó No tests found in lib\test-integration.js
@temporalio/test:   √ó No tests found in lib\test-interceptors.js
@temporalio/test:   ‚àö logger ¬ª DefaultLogger logs messages according to configured level
@temporalio/test:   √ó No tests found in lib\test-otel.js
```

[build-and-test (14, windows-latest)](https://github.com/temporalio/sdk-typescript/runs/5505915111?check_suite_focus=true#logs)

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:38:41.000 UTC</summary>

I don't remember what this is anymore, closing.

</details>


---

<a id="505"></a>

### #505: [Bug] Failed Activity heartbeat data conversion can crash the worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/505 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-03-01 00:40:00.000 UTC (3y 10m ago) |
| **Updated** | 2022-07-09 00:40:09.000 UTC |
| **Closed** | 2022-07-09 00:40:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We don't catch DC errors, we should instead report those back as activity cancellations.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-07-09 00:40:09.000 UTC</summary>

This was fixed a while back

</details>


---

<a id="491"></a>

### #491: [Feature Request] Encode baggage part of trace

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/491 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-19 00:46:32.000 UTC (3y 10m ago) |
| **Updated** | 2022-04-04 03:38:45.000 UTC |
| **Closed** | 2022-04-04 03:38:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<img width="841" alt="image" src="https://user-images.githubusercontent.com/251288/154778881-9baab3e1-b9a9-4d17-bb6d-33709823a925.png">


#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-04-04 03:38:45.000 UTC</summary>

See #514, which has more info

</details>


---

<a id="490"></a>

### #490: [Feature Request] Add setDefaultDataConverter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/490 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-18 20:00:10.000 UTC (3y 10m ago) |
| **Updated** | 2023-05-11 17:31:03.000 UTC |
| **Closed** | 2023-05-11 17:31:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

<img width="771" alt="image" src="https://user-images.githubusercontent.com/251288/154753187-0b96645a-1b58-4f14-991a-2026d617bd2c.png">


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 17:31:03.000 UTC</summary>

Let's drop this one, hasn't been requested

</details>


---

<a id="488"></a>

### #488: [Feature Request] Add all-method interceptors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/488 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-02-17 19:58:16.000 UTC (3y 10m ago) |
| **Updated** | 2022-10-11 23:40:03.000 UTC |
| **Closed** | 2022-10-11 23:40:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

The specific use case bringing this to mind is [handling all errors that flow through the client](https://github.com/temporalio/sdk-typescript/pull/484#issuecomment-1043352024).

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

The ability to define middleware for all communication with the client or worker. 

In Apollo Client, this is done with "Network Link"s, which makes it simple to write an `onError` handler:

https://www.apollographql.com/docs/react/api/link/apollo-link-error/

(Simpler than implementing all the methods in [WorkflowClientCallsInterceptor](https://typescript.temporal.io/api/interfaces/client.workflowclientcallsinterceptor/))

In Apollo Server, there's a dedicated middleware for errors: https://www.apollographql.com/docs/apollo-server/data/errors/#for-client-responses



#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:40:02.000 UTC</summary>

I don't think we've gotten any requests for this.
gRPC interceptors can achieve this IIUC.
Closing.

</details>


---

<a id="480"></a>

### #480: [Feature Request] sleepUntil and UpdatableTimer utils

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/480 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2022-02-15 17:29:47.000 UTC (3y 10m ago) |
| **Updated** | 2023-05-11 17:28:13.000 UTC |
| **Closed** | 2023-05-11 17:28:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

sleepuntil is needed because most users will probably have to write it themselves. especially when they try to do anything on a monthly basis https://github.com/temporalio/documentation/pull/902#pullrequestreview-883249803

updatabletimer is needed because the very next thing you want after setting a sleep is to change it midflight and right now its a pretty gnarly lift

perhaps we can modify the two apis so that they compose

### Describe the solution you'd like

already in the docs

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-05-11 17:28:13.000 UTC</summary>

Leaving as samples for now, might make this an auxiliary lib eventually

</details>


---

<a id="471"></a>

### #471: [Feature Request] Log when in activity-only mode

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/471 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2022-02-09 00:42:28.000 UTC (3y 11m ago) |
| **Updated** | 2023-01-11 20:02:26.000 UTC |
| **Closed** | 2023-01-11 20:02:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

A user encountered great confusion when they accidentally stopped initializing their workflow bundle and it looked like their worker was just hung. The reality is it simply wasn't polling for any workflow work. 

### Describe the solution you'd like

We should log at the `INFO` level something like "This worker has no workflows registered and will not poll for workflow tasks!"

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-11 20:02:25.000 UTC</summary>

https://github.com/temporalio/sdk-typescript/blob/fe15daa6e64f82d6c764ada6f7fe8549ec39bd75/packages/worker/src/worker.ts#L1542

</details>


---

<a id="455"></a>

### #455: [Bug] serverNameOverride in tlsConfig does not have expected effect on grpc request

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/455 |
| **State** | CLOSED |
| **Author** | jbreiding (Jeremy) |
| **Created** | 2022-01-27 21:29:16.000 UTC (3y 11m ago) |
| **Updated** | 2022-03-12 17:19:46.000 UTC |
| **Closed** | 2022-03-12 17:19:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->
Use SNI with nodejs sdk that sends the correct grpc authority header.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->
Understanding how the go-sdk allows for SNI to be configured for clients and following the similar documentation:

nodejs
https://nodejs.temporal.io/api/interfaces/common.tlsconfig/#servernameoverride

go
https://pkg.go.dev/go.temporal.io/sdk@v1.12.0/internal#ConnectionOptions

the go sdk correctly sets SNI and for grpc this means the authority header.

nodejs does not update the authority header when setting the serverNameOverride.
This is visible from grpc verbose logging.

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->
@bergundy has helped with reproducing and also identified a configuration that does work correctly.

```
  const connection = new Connection({
    address,
    tls: {
      clientCertPair: {
        crt: fs.readFileSync(clientCertPath),
        key: fs.readFileSync(clientKeyPath),
      },
    },
    channelArgs: { 'grpc.default_authority': serverNameOverride },
  });
  await connection.untilReady();
```
### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: [e.g. M1 Mac, x86 Windows, Linux]
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Are you using Docker or Kubernetes or building Temporal from source?

nodejs client connecting to temporal-cloud hosted namespace.

### Additional context

<!-- Add any other context about the problem here. -->
Bringing this issue to attention to try and bring configuration consistent across sdk languages if possible.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-01-27 22:17:19.000 UTC</summary>

Apparently Rust Core needs extra parameters to add the authority header.
This functionality isn't exposed to TS.

</details>


---

<a id="384"></a>

### #384: [Feature Request] Add actual span time to spans create by workflow otel interceptors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/384 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-12 15:46:42.000 UTC (4y 1m ago) |
| **Updated** | 2025-02-04 18:30:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Spans created in the workflow isolate use workflow task time which different than the actual processing time.
Getting the actual time is useful for getting a clear picture of how a system behaves.

After discussing with the SDK team, we've decided not to use the real time for spans because a span can start in one workflow task and end in another, running on different workers and going through replays.

* This means there's no way to reliably get the real start time when the span is finally emitted
* We can avoid this scenario for spans generated by the interceptors but it's unavoidable if we want to let users create their own spans in workflow
  * This will in fact make the TS SDK the only SDK that supports user spans in Workflow code
  * Spans that span multiple workflow tasks require full determinism of workflow code in order for their IDs to be deterministically generated when replaying, if a user deploys a non deterministic update to their workflow code, tracing might break



#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-10 17:41:48.000 UTC</summary>

Use `workflowInfo().unsafe.now()`

</details>


---

<a id="377"></a>

### #377: Improve error message: Workflow executionsRow not found

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/377 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-11-11 01:27:09.000 UTC (4y 2m ago) |
| **Updated** | 2022-02-09 20:25:18.000 UTC |
| **Closed** | 2022-02-09 20:25:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

In [this scenario](https://github.com/temporalio/samples-typescript/issues/56), the error from the Worker that had the correct code was:

```
Task not found when completing: status: NotFound, message: "Workflow executionsRow not found."
```

### Describe the solution you'd like

 Say what's going wrong in the Worker at a higher level and suggest possible reasons.
 
 Migrated from #359

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-11 02:16:56.000 UTC</summary>

This is a problem with the server AFAICT, I think you get a different error message if you use postgres instead of cassandra.

</details>


---

<a id="373"></a>

### #373: [Feature Request] Deprecate patch for condition timer cancellation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/373 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-10 22:07:19.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-23 01:57:02.000 UTC |
| **Closed** | 2021-11-23 01:57:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

#372 added a patch for timer cancellation in condition, this should be removed at a later release.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 01:57:02.000 UTC</summary>

We decided not to use a patch in the end.

</details>


---

<a id="334"></a>

### #334: [Feature Request] Add built-in "getHandlers" query

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/334 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-25 15:49:24.000 UTC (4y 2m ago) |
| **Updated** | 2023-05-26 16:03:00.000 UTC |
| **Closed** | 2023-05-26 16:03:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

See original issue here: temporalio/sdk-features#51

#### Comments (1)

<details>
<summary><strong>mjameswh</strong> commented on 2023-05-26 16:03:00.000 UTC</summary>

Closing in favor of duplicated #1081 (that other one provide more details).

</details>


---

<a id="329"></a>

### #329: [Feature Request] Accept prebuilt bundles in Workers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/329 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-22 06:33:27.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-22 21:17:10.000 UTC |
| **Closed** | 2021-10-22 21:17:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Is your feature request related to a problem? Please describe.

![image](https://user-images.githubusercontent.com/6764957/138404578-2217a900-8d3b-43e5-b3b9-2fd520237e62.png)


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-22 21:17:03.000 UTC</summary>

Duplicate of #310 

</details>


---

<a id="319"></a>

### #319: [Feature Request] Use the newer `Context.SetPromiseHooks` API for the workflow isolate extension.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/319 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-20 19:55:59.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-23 02:06:01.000 UTC |
| **Closed** | 2021-11-23 02:06:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

The new API is bound to a single context and uses JS function which are faster than c++ functions.
The current implementation overrides the promise hook for each context which is a redundant (yet seemingly harmless) operation.

This is all based on information I got from @Qard on the Node.js slack (thanks :)).

This issue might not be relevant if we manage to transition to `vm` and use node's `AsyncLocalStorage` implementation.

API reference: https://v8.github.io/api/head/classv8_1_1Context.html#a216ef605c502da6559fff96209e4c9a9

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:06:01.000 UTC</summary>

Not relevant since we ended up using `AsyncLocalStorage`

</details>


---

<a id="316"></a>

### #316: [Bug] undelete WeakMap and WeakSet

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/316 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-19 21:17:05.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-25 19:47:20.000 UTC |
| **Closed** | 2021-10-25 19:47:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Describe the bug

just filing as a reminder for Roey. need this to use private variables in typescript (lol... so random)

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-20 21:10:31.000 UTC</summary>

We should also delete [FinalizationRegistry](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry).

</details>


---

<a id="299"></a>

### #299: [Bug] INVALID_ARGUMENT: Workflow did not register a handler for getSecret in IT

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/299 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-13 14:43:19.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-14 17:38:27.000 UTC |
| **Closed** | 2021-10-14 17:38:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Describe the bug

There seems to be an issue with interceptors and query registration.

Interceptors integration test is flaky.

https://github.com/temporalio/sdk-node/pull/296/checks?check_run_id=3883673737

```
@temporalio/test:     message: '3 INVALID_ARGUMENT: Workflow did not register a handler for getSecret',
```

### To Reproduce

I thought this was fixed because it stopped reproducing locally.
Should be reproducible by running the entire test suite.

### Expected behavior

Queries and interceptors should be compatible.

### Versions

main branch

### Additional context

This is probably due to interceptors running async functions causing a race when start workflow, signal and query are all delivered in a single activation.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-14 15:16:28.000 UTC</summary>

Managed to reproduce this locally pretty consistently by not awaiting the signal before sending the query to the workflow.
This results in an activation that looks like this:
```
2021-10-14T15:14:29.440Z [DEBUG] Got workflow activation {
  runId: 'be16eb44-9585-42bb-bac8-2099a8d829d5',
  jobs: [
    WFActivationJob { startWorkflow: [StartWorkflow] },
    WFActivationJob { signalWorkflow: [SignalWorkflow] },
    WFActivationJob { queryWorkflow: [QueryWorkflow] }
  ],
  timestamp: Timestamp {
    seconds: Long { low: 1634224469, high: 0, unsigned: false },
    nanos: 359507511
  }
}
```
I think the solution here is to buffer the query until workflow function has been invoked.

</details>


---

<a id="286"></a>

### #286: [Feature Request] WorkflowClient and WorkflowHandle execute params are inconsistent

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/286 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-07 00:48:16.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 20:10:22.000 UTC |
| **Closed** | 2021-10-07 20:10:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

`WorkflowClient` takes the options first while `WorkflowHandle` takes the workflow type first.
`WorkflowClient` should use the same signature as `WorkflowHandle`.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 14:10:33.000 UTC</summary>

I've thought about this a bit more.

The difference between the handle and the client is that `client.execute` takes the workflow type, args and options, and the handle already has the workflow type and options built-in so `handle.execute` requires only the arguments.

```ts
import { myWorkflow } from './workflows';
const client = new WorkflowClient();
client.execute<typeof myWorkflow>({ taskQueue: 'q' }, 'myWorkflow', arg1, arg2);
// vs.
const handle = client.createWorkflowHandle(myWorkflow, { taskQueue: 'q' });
handle.execute(arg1, arg2);
```

A couple of ideas I've had are:
1. Passing the arguments in an array:
```ts
client.execute<typeof myWorkflow>('myWorkflow', [arg1, arg2], { taskQueue: 'q' });
```
2. Switching the order of the workflow type and options parameters:
```ts
client.execute<typeof myWorkflow>('myWorkflow', { taskQueue: 'q' }, arg1, arg2);
```

NOTES:
- `taskQueue` is optional if `WorkflowClient` receives it in `workflowDefaults`
- We should have a variant of `WorfklowClient.execute` that takes a workflow function:
   `client.execute({ taskQueue: 'q' }, myWorkflow, arg1, arg2);`

I'm leaning toward the 2nd solution, the only caveat is that it always requires options to be passed even though they're are not required (for handle), e.g the following is valid:
```ts
const handle = client.createWorkflowHandle(myWorkflow);
```

While this will not be:
```ts
client.execute<typeof myWorkflow>('myWorkflow');
```

With the 1st solution we could make the options not required:
```ts
client.execute<typeof myWorkflow>('myWorkflow', [arg1, arg2]);
```

</details>


---

<a id="276"></a>

### #276: [Feature Request] Provide better error message when creating a child workflow which is not registered

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/276 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-29 06:08:52.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 20:10:22.000 UTC |
| **Closed** | 2021-10-07 20:10:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Add a check in createChildWorkflowHandle that it gets a registered workflow (e.g. exported) and verify that the function name matches the export name.

As brought up here: https://temporalio.slack.com/archives/C01DKSMU94L/p1632714328118100

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 15:52:16.000 UTC</summary>

Note that we cannot validate in cases where the handle is created for a different task queue (Worker), adding a check for child handles on the same Worker.

</details>


---

<a id="265"></a>

### #265: [Bug] publish-to-verdaccio fails

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/265 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-24 00:59:11.000 UTC (4y 3m ago) |
| **Updated** | 2021-09-24 01:45:27.000 UTC |
| **Closed** | 2021-09-24 01:45:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

When I run `node scripts/publish-to-verdaccio.js` locally, I get `ECONNREFUSED` and it edits `packages/*/package.json`.

First run:

```
$ node scripts/publish-to-verdaccio.js --registry-dir /tmp/registry
Starting local registry
Local registry ready
Need to install the following packages:
  verdaccio
Ok to proceed? (y) ylerna notice cli v4.0.0
lerna info versioning independent
lerna WARN Unable to determine published version, assuming "@temporalio/activity" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/client" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/common" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/core-bridge" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/create" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/interceptors-opentelemetry" unpublished.
lerna WARN Unable to determine published version, assuming "temporalio" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/proto" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/worker" unpublished.
lerna WARN Unable to determine published version, assuming "@temporalio/workflow" unpublished.

Found 10 packages to publish:
 - @temporalio/activity => 0.4.0
 - @temporalio/client => 0.7.0
 - @temporalio/common => 0.3.0
 - @temporalio/core-bridge => 0.4.0
 - @temporalio/create => 0.5.1
 - @temporalio/interceptors-opentelemetry => 0.2.0
 - temporalio => 0.4.2
 - @temporalio/proto => 0.3.2
 - @temporalio/worker => 0.9.0
 - @temporalio/workflow => 0.8.0

lerna info auto-confirmed 
lerna info publish Publishing packages to npm...
lerna notice Skipping all user and access validation due to third-party registry
lerna notice Make sure you're authenticated properly ¬Ø\_(„ÉÑ)_/¬Ø
lerna WARN ECYCLE Dependency cycles detected, you should fix these!
lerna WARN ECYCLE @temporalio/common -> @temporalio/proto -> @temporalio/core-bridge -> @temporalio/common
lerna WARN ECYCLE Dependency cycles detected, you should fix these!
lerna WARN ECYCLE @temporalio/common -> @temporalio/proto -> @temporalio/core-bridge -> @temporalio/common
lerna ERR! ECONNREFUSED request to http://localhost:4873/@temporalio%2factivity failed, reason: connect ECONNREFUSED 127.0.0.1:4873
lerna ERR! FetchError: request to http://localhost:4873/@temporalio%2factivity failed, reason: connect ECONNREFUSED 127.0.0.1:4873
lerna ERR!     at ClientRequest.<anonymous> (/Users/me/gh/sdk-node/node_modules/minipass-fetch/lib/index.js:110:14)
lerna ERR!     at ClientRequest.emit (node:events:394:28)
lerna ERR!     at Socket.socketErrorListener (node:_http_client:447:9)
lerna ERR!     at Socket.emit (node:events:406:35)
lerna ERR!     at emitErrorNT (node:internal/streams/destroy:157:8)
lerna ERR!     at emitErrorCloseNT (node:internal/streams/destroy:122:3)
lerna ERR! lerna request to http://localhost:4873/@temporalio%2factivity failed, reason: connect ECONNREFUSED 127.0.0.1:4873
Error: Failed to publish to registry
    at /Users/me/gh/sdk-node/scripts/publish-to-verdaccio.js:15:13
    at withRegistry (/Users/me/gh/sdk-node/scripts/registry.js:79:18)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at async main (/Users/me/gh/sdk-node/scripts/publish-to-verdaccio.js:6:3)
```

Second run fails due to uncommited changes:
    
```
sdk-node git:(create-from-repo 1‚Üë) 10M $ node scripts/publish-to-verdaccio.js --registry-dir /tmp/registry
Starting local registry
Local registry ready
Need to install the following packages:
  verdaccio
Ok to proceed? (y) lerna notice cli v4.0.0
lerna info versioning independent
lerna ERR! EUNCOMMIT Working tree has uncommitted changes, please commit or remove the following changes before continuing:
lerna ERR! EUNCOMMIT  M packages/activity/package.json
lerna ERR! EUNCOMMIT  M packages/client/package.json
lerna ERR! EUNCOMMIT  M packages/common/package.json
lerna ERR! EUNCOMMIT  M packages/core-bridge/package.json
lerna ERR! EUNCOMMIT  M packages/create-project/package.json
lerna ERR! EUNCOMMIT  M packages/interceptors-opentelemetry/package.json
lerna ERR! EUNCOMMIT  M packages/meta/package.json
lerna ERR! EUNCOMMIT  M packages/proto/package.json
lerna ERR! EUNCOMMIT  M packages/worker/package.json
lerna ERR! EUNCOMMIT  M packages/workflow/package.json
Error: Failed to publish to registry
    at /Users/me/gh/sdk-node/scripts/publish-to-verdaccio.js:15:13
    at withRegistry (/Users/me/gh/sdk-node/scripts/registry.js:79:18)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at async main (/Users/me/gh/sdk-node/scripts/publish-to-verdaccio.js:6:3)
```

### To Reproduce

```
rm /tmp/registry/storage
npm ci
npm run rebuild
node scripts/publish-to-verdaccio.js --registry-dir /tmp/registry
```



#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2021-09-24 01:45:27.000 UTC</summary>

Fixed by changing `rm /tmp/registry/storage` to `rm /tmp/registry`

</details>


---

<a id="250"></a>

### #250: [Bug] Failure to gather logs from core on Worker shutdown

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/250 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-19 12:51:04.000 UTC (4y 3m ago) |
| **Updated** | 2021-09-22 15:40:33.000 UTC |
| **Closed** | 2021-09-22 15:40:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | Sushisource |
| **Milestone** | beta |

#### Description

### Describe the bug

Getting a warning about failure to gather forwarded logs from core:  

2021-09-19T08:38:43.051Z [WARNING] Error gathering forwarded logs from core RangeError: Maximum call stack size exceeded

### To Reproduce

Happens when running an integration test.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-20 20:04:06.000 UTC</summary>

Looks like `takeWhile` and `repeat` are conflicting: https://github.com/temporalio/sdk-node/blob/5a0f780b9cb4c0dae265c08ca99fbc1f58c4ab83/packages/worker/src/core.ts#L89

</details>


---

<a id="249"></a>

### #249: [Feature Request] Hide isolateExecutionTimeout Worker option

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/249 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-19 12:47:04.000 UTC (4y 3m ago) |
| **Updated** | 2021-11-23 02:13:22.000 UTC |
| **Closed** | 2021-11-23 02:13:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

There are already a lot of exposed options, it'd be better to default to the workflow task timeout.
If anyone ever requests more fine grained control we can add this back.

Note that an isolate is entered multiple times in a single Workflow task execution.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-11-23 02:13:21.000 UTC</summary>

This was done in #264 

</details>


---

<a id="245"></a>

### #245: Flaky integration test

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/245 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-17 14:44:48.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 23:30:34.000 UTC |
| **Closed** | 2021-10-07 23:30:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

another flake https://github.com/temporalio/sdk-node/pull/224/checks?check_run_id=3614424338

![image](https://user-images.githubusercontent.com/251288/133538350-f7b4ca02-719b-49eb-bbd4-038e1a2509c3.png)

_Originally posted by @lorensr in https://github.com/temporalio/sdk-node/issues/224#issuecomment-920521363_

#### Comments (1)

<details>
<summary><strong>Sushisource</strong> commented on 2021-10-07 23:30:34.000 UTC</summary>

Pretty sure I fixed this actually. It was a problem with shutdown ordering in Core. Closing and we can re-open if it happens again.

</details>


---

<a id="240"></a>

### #240: [Feature Request] Add `defaults` for workflow handle creation on `WorkflowClient` constructor

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/240 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-14 11:52:08.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 16:59:43.000 UTC |
| **Closed** | 2021-10-07 16:59:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

It would be nice to provide the task queue once on `WorkflowClient` creation instead of every time when a WorkflowHandle is created.

### Describe the solution you'd like

Add a `defaults` attribute to `WorkflowClientOptions` interface for users to pass in the default `WorkflowOptions` for creating new handles.
`createWorkflowHandle`'s `options` parameter becomes optional.

- TODO: Check how to avoid overload conflict with attaching to an existing WF by workflow ID ([link](https://github.com/temporalio/sdk-node/blob/main/packages/client/src/workflow-client.ts#L448))

### Additional context

https://github.com/temporalio/documentation/pull/627#discussion_r707574870

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-07 16:59:43.000 UTC</summary>

This was done already, `WorkflowClient` has a `workflowDefaults` option.

</details>


---

<a id="229"></a>

### #229: [Feature Request] Improve Context API docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/229 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-09-08 17:04:01.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-08 18:39:13.000 UTC |
| **Closed** | 2021-09-08 18:39:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Could this show up as `Context` instead of `ContextImpl`, so it's easier to find?

![image](https://user-images.githubusercontent.com/251288/132553046-2116ee5c-6989-42e7-8b54-11828530bc6f.png)

And can it list default activity options either here:

https://nodejs.temporal.io/api/classes/workflow.ContextImpl#configureactivities

or here:

https://nodejs.temporal.io/api/namespaces/worker#activityoptions

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-09-08 18:39:13.000 UTC</summary>

This goes away in #225, your input on it is more than welcome 

</details>


---

<a id="210"></a>

### #210: [Bug] GH actions sometimes fails due to DEADLINE EXCEEDED

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/210 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-26 11:28:21.000 UTC (4y 4m ago) |
| **Updated** | 2021-10-26 20:50:22.000 UTC |
| **Closed** | 2021-10-26 20:50:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

Probably due to reuse of the same client connection for all concurrent tests.
Does not happen in local dev environment, only on the weak GH actions executors, needs further investigation.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-21 14:22:10.000 UTC</summary>

Once temporalio/temporal#2033 is released we should make sure to update the GH workflow definitions to use the latest docker-compose tag.

</details>


---

<a id="201"></a>

### #201: [Feature Request] Make deadline for workflow client and stub calls configurable

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/201 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-24 12:44:00.000 UTC (4y 4m ago) |
| **Updated** | 2022-10-11 23:36:46.000 UTC |
| **Closed** | 2022-10-11 23:36:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

Requires a bit of design to figure out the best way to expose this.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2022-10-11 23:36:46.000 UTC</summary>

This was done a while ago.

</details>


---

<a id="196"></a>

### #196: [Feature Request] Clarify namespace version menu items

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/196 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-08-22 00:57:27.000 UTC (4y 4m ago) |
| **Updated** | 2021-08-25 07:24:22.000 UTC |
| **Closed** | 2021-08-25 07:24:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

The repeated `v1`s in the image below appears at first like a bug. It might help if the menu items were:

```
command
command.v1
common
common.v1
```

Or since `command` and `common` pages are so little, combining to:

```
command.v1
common.v1
```

![image](https://user-images.githubusercontent.com/251288/130338526-b77bcc86-e016-43c1-80fa-e5fc83f19e2d.png)


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-22 06:47:26.000 UTC</summary>

Same as the previous issue, we might just want to omit the generated protobuf types from the API reference.
Let's consider our options.
Also related is #115 

</details>


---

<a id="195"></a>

### #195: [Feature Request] Sort docs menu items

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/195 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-08-22 00:53:09.000 UTC (4y 4m ago) |
| **Updated** | 2021-08-25 07:24:22.000 UTC |
| **Closed** | 2021-08-25 07:24:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

My impulse is to scroll looking for a particular thing, and then I realize it's not in alphabetical order, so I `Cmd-F`.

![image](https://user-images.githubusercontent.com/251288/130338440-7399c5fa-05a5-40ca-9576-2ace9e3d2875.png)


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-22 06:45:06.000 UTC</summary>

Yeah, we might just want to not output any of the generated protobuf type defs in the API reference.

</details>


---

<a id="180"></a>

### #180: Use incremental sequence number for correlation IDs between core and lang

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/180 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-09 13:25:39.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-24 07:47:41.000 UTC |
| **Closed** | 2021-08-24 07:47:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

*No description provided.*

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-08-09 13:35:13.000 UTC</summary>

Depends on https://github.com/temporalio/sdk-core/issues/164

</details>


---

<a id="148"></a>

### #148: [Bug] Query handler should not be async

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/148 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-06 14:37:41.000 UTC (4y 6m ago) |
| **Updated** | 2021-07-08 23:22:33.000 UTC |
| **Closed** | 2021-07-08 23:22:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

ATM the workflow query handler type is allowed to return a Promise which is problematic because query methods should not create commands (e.g timers / activities) or mutate state because they are not recorded in the workflow history and thus will break determinism.
The only reason a function would be async in the workflow isolate is to create a command.

**Expected behavior**
The SDK should throw an `DeterminismViolationError` if a query handler returns a Promise.
Ideally we could perform static type checking but this form of exclusion is not supported by typescript and the following does not work:

```ts
export type WorkflowQueryType = (...args: any[]) => Exclude<any, Promise<any>>;
```

See also:
https://github.com/microsoft/TypeScript/pull/29317


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-07-08 23:22:32.000 UTC</summary>

Closed via #149 

</details>


---

<a id="143"></a>

### #143: [Feature Request] Implement search attributes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/143 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-30 17:12:19.000 UTC (4y 6m ago) |
| **Updated** | 2022-06-09 14:55:32.000 UTC |
| **Closed** | 2022-06-09 14:55:31.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |

#### Description

Once they are supported in sdk-core

#### Comments (1)

<details>
<summary><strong>lorensr</strong> commented on 2022-06-09 14:55:31.000 UTC</summary>

Fixed by #657 

</details>


---

<a id="140"></a>

### #140: [Bug] Increase Workflow isolate timeout to handle slow Github Actions worker nodes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/140 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-26 16:27:22.000 UTC (4y 6m ago) |
| **Updated** | 2021-10-15 04:43:46.000 UTC |
| **Closed** | 2021-10-15 04:43:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Example of failed CI job here:
https://github.com/temporalio/sdk-node/runs/2910468730?check_suite_focus=true

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 04:43:46.000 UTC</summary>

Haven't seen this recently

</details>


---

<a id="117"></a>

### #117: [Bug] 14 UNAVAILABLE error against Cloud deployment

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/117 |
| **State** | CLOSED |
| **Author** | jmoseley (Jeremy Moseley) |
| **Created** | 2021-06-02 16:56:53.000 UTC (4y 7m ago) |
| **Updated** | 2021-07-29 16:51:16.000 UTC |
| **Closed** | 2021-07-29 16:51:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**
When executing RPC requests against the cloud deployment, we receive an error `14 UNAVAILABLE: Connection dropped`.

```
Error: 14 UNAVAILABLE: Connection dropped
    at Object.callErrorFromStatus (/atlas-event-service/node_modules/@grpc/grpc-js/src/call.ts:81:24)
    at Object.onReceiveStatus (/atlas-event-service/node_modules/@grpc/grpc-js/src/client.ts:338:36)
    at Object.onReceiveStatus (/atlas-event-service/node_modules/@grpc/grpc-js/src/client-interceptors.ts:426:34)
    at Object.onReceiveStatus (/atlas-event-service/node_modules/@grpc/grpc-js/src/client-interceptors.ts:389:48)
    at /atlas-event-service/node_modules/@grpc/grpc-js/src/call-stream.ts:276:24
    at processTicksAndRejections (internal/process/task_queues.js:75:11)
```

**To Reproduce**
I am unable to reproduce this error running the same code against a local service.

**Expected behavior**
I expect the RPC call to succeed.

**Versions (please complete the following information where relevant):**
 - OS: Linux
 - Temporal Version: Cloud
 - Node SDK version: 0.3.0

**Additional context**
* Before executing the RPC call, I first call `untilReady` to ensure that the gRPC client is connected, and this succeeds.
* When I receive this error, I close the connection, open a new connection (call `untilReady` again), and retry the call. It fails with the same error.
* I have also configured keep alive checks to ensure the connection does not go stale.

Here is some sample code:

```
export class TemporalClientImpl implements TemporalClient {
  // This is assigned in createConnection.
  private connection!: Connection;
  private ready = false;
  private log: ReturnType<typeof newLogger>;

  private untilReadyPromise: Promise<void> | undefined = undefined;

  constructor(
    private options: {
      address: string;
      credentials: grpc.ChannelCredentials;
      namespace: string;
    },
  ) {
    this.log = newLogger(this.constructor.name);
    this.createConnection();
  }

  private createConnection() {
    this.connection = new Connection({
      address: this.options.address,
      credentials: this.options.credentials,
      channelArgs: {
        'grpc.keepalive_time_ms': TEMPORAL_KEEP_ALIVE_INTERVAL_MS,
        'grpc.keepalive_permit_without_calls': 1,
        'grpc.keepalive_timeout_ms': TEMPORAL_KEEP_ALIVE_TIMEOUT_MS,
      },
    });
  }

  private async reconnect() {
    this.ready = false;
    if (this.connection) {
      try {
        this.connection.client.close();
      } catch (error) {
        this.log.error('Error closing client connection.', error);
      }
    }
    this.createConnection();

    return await this.waitForReady();
  }

  async waitForReady() {
    if (this.ready) {
      return;
    }

    if (this.untilReadyPromise) {
      return await this.untilReadyPromise;
    }

    this.untilReadyPromise = this.connection.untilReady(TEMPORAL_CONNECTION_TIMEOUT_MS);

    return this.untilReadyPromise;
  }

  async completeActivity(taskToken: string, payload: object | null, isRetry = false): Promise<void> {
    if (!this.ready) {
      await this.waitForReady();
    }

    try {
      const req = temporal.api.workflowservice.v1.RespondActivityTaskCompletedRequest.fromObject({
        taskToken,
        namespace: this.options.namespace,
        result: {
          payloads: this.connection.options.dataConverter.toPayloads(JSON.stringify(payload)),
        },
      });

      await this.connection.service.respondActivityTaskCompleted(req);

      this.log.info(`Successfully completed activity task.`);
    } catch (error) {
      if (error.message.includes('workflow execution already completed')) {
        throw new ActivityAlreadyCompleteError(taskToken);
      }

      if (error.message.includes('invalid activityID')) {
        throw new ActivityNotFoundError(taskToken);
      }

      if (error.details && error.details.includes('Connection dropped')) {
        this.log.error('Received connection dropped error, attempting to reconnect.');
        await this.reconnect();
        if (!isRetry) {
          this.log.error('Retrying call to completeActivity');
          return await this.completeActivity(taskToken, payload, true);
        }
      }

      this.log.info('Unknown RPC error', error);

      throw error;
    }
  }
}
```

#### Comments (1)

<details>
<summary><strong>jmoseley</strong> commented on 2021-07-29 16:51:16.000 UTC</summary>

I was eventually able to solve this by switching from using `grpc.Credentials` to use `TLSConfig` for specifying the TLS certs:

Before:
```
let grpcCredentials: grpc.ChannelCredentials = grpc.credentials.createInsecure();
if (temporalConfig.clientCert && temporalConfig.clientCertKey) {
  // The secrets manager encodes the new lines, so unencode them to make these valid PEM
  const cert = temporalConfig.clientCert.replace(/\\n/g, '\n');
  const certKey = temporalConfig.clientCertKey.replace(/\\n/g, '\n');
  const rootCa = temporalConfig.rootCa
    ? Buffer.from(temporalConfig.rootCa.replace(/\\n/g, '\n'))
    : undefined;

  grpcCredentials = grpc.credentials.createSsl(rootCa, Buffer.from(certKey), Buffer.from(cert));
} else {
  LOG.info('No TLS configuration provided for Temporal, not using mTLS.');
}

const address = `${temporalConfig.host}:${temporalConfig.port}`;

const connection =  new Connection({
  address,
  credentials,
  channelArgs: {
    'grpc.keepalive_time_ms': TEMPORAL_KEEP_ALIVE_INTERVAL_MS,
    'grpc.keepalive_permit_without_calls': 1,
    'grpc.keepalive_timeout_ms': TEMPORAL_KEEP_ALIVE_TIMEOUT_MS,
  },
});
```

After:
```
let tlsConfig: TLSConfig | boolean = false;
if (temporalConfig.clientCert && temporalConfig.clientCertKey) {
  // The secrets manager encodes the new lines, so unencode them to make these valid PEM
  const cert = temporalConfig.clientCert.replace(/\\n/g, '\n');
  const certKey = temporalConfig.clientCertKey.replace(/\\n/g, '\n');
  const rootCa = temporalConfig.rootCa
    ? Buffer.from(temporalConfig.rootCa.replace(/\\n/g, '\n'))
    : undefined;

  tlsConfig = {
    serverRootCACertificate: rootCa,
    clientCertPair: {
      crt: Buffer.from(cert),
      key: Buffer.from(certKey),
    },
  };
} else {
  LOG.info('No TLS configuration provided for Temporal, not using mTLS.');
}

const address = `${temporalConfig.host}:${temporalConfig.port}`;

const connection = new Connection({
  address,
  tls: tlsConfig,
  channelArgs: {
    'grpc.keepalive_time_ms': TEMPORAL_KEEP_ALIVE_INTERVAL_MS,
    'grpc.keepalive_permit_without_calls': 1,
    'grpc.keepalive_timeout_ms': TEMPORAL_KEEP_ALIVE_TIMEOUT_MS,
  },
});
```

</details>


---

<a id="116"></a>

### #116: [Feature Request] Auto compile project on worker run

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/116 |
| **State** | CLOSED |
| **Author** | rylandg (Ryland Goldstein) |
| **Created** | 2021-06-01 23:42:40.000 UTC (4y 7m ago) |
| **Updated** | 2021-08-31 14:03:11.000 UTC |
| **Closed** | 2021-08-31 14:03:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Right now it's expected for the user to maintain a terminal process that watches a directory and invokes the TypeScript compiler on any recognized change. Separately, when they want to run their workflow they are expected to start a worker. This worker needs to be restarted on any change to the workflow or activity code.

It would be great if running a worker did the compilation too. That way I could only run the worker in some cases.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-06-03 11:41:32.000 UTC</summary>

That's a great idea, would definitely simplify the local development environment by a lot.
I was already thinking we'd compile Workflow typescript code as part of the webpack step in-worker for improving the generated source maps.

We should get back to this as soon as the outstanding proposals are implemented.


</details>


---

<a id="103"></a>

### #103: [Bug] `npm init @temporalio ...` might fail if out-of-date

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/103 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-18 11:57:21.000 UTC (4y 7m ago) |
| **Updated** | 2021-10-15 04:41:49.000 UTC |
| **Closed** | 2021-10-15 04:41:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**

Users running `npm init @temporalio ...` a second time when a new version of `@temporalio/create` has been released may not succeed.
This is due to `npm init` not updating the `@temporalio/create` package that installs `temporalio@latest` which might require an updated project template.

**Expected behavior**
We should make sure `npm init @temporalio` does not break, possibly by hardcoding the `temporalio` version in the published `@temporalio/create`.
Ideally we should be able to install the latest version or at least warn when a user is installing an out-of-date version with `npm init`.
From some initial testing, seems like `npx @temporalio/create@latest` updates the package if there's a newer version so that might be the recommended way to initialize new Temporal projects.


#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-10-15 04:41:49.000 UTC</summary>

We stopped recommending `npm init @temporalio` for the package initializer due to this limitation.

</details>


---

<a id="88"></a>

### #88: [Bug] Remove snipsync comments from generated code when creating a new package

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/88 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-10 07:42:10.000 UTC (4y 8m ago) |
| **Updated** | 2021-05-13 13:39:06.000 UTC |
| **Closed** | 2021-05-13 13:39:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the bug**
`// @@@SNIP{START,END}` comment show up in generated code.

**To Reproduce**
Steps to reproduce the behavior:
`npm init @temporalio`

**Expected behavior**
Comments should be stripped away

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-05-13 13:39:06.000 UTC</summary>

Closed by #91 

</details>


---

<a id="68"></a>

### #68: [Feature Request] Support workflow versioning

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/68 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-04-20 13:33:08.000 UTC (4y 8m ago) |
| **Updated** | 2021-08-24 13:15:27.000 UTC |
| **Closed** | 2021-08-24 13:15:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | Sushisource |
| **Milestone** | beta |

#### Description

Other SDKs support workflow versioning in order to support code changes for running workflows.
We must add this functionality to the Node SDK too shortly after the alpha.
Some possible solutions would be:
1. Do what we do in [Java](https://docs.temporal.io/docs/java-versioning) and record a marker in the WF history.
2. Bundle workflows with their dependencies using a bundler such as [webpack](https://webpack.js.org/) and include all workflow relevant versions in the worker's workflows directory.
3. Keep using modules and add versioning capabilities to the loader (requires a way to store loaded modules).

#### Comments (1)

<details>
<summary><strong>Sushisource</strong> commented on 2021-08-10 22:38:26.000 UTC</summary>

See https://github.com/temporalio/sdk-core/pull/156

</details>


---

<a id="66"></a>

### #66: [Feature Request] Publish API docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/66 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-04-12 13:42:25.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-22 17:02:50.000 UTC |
| **Closed** | 2021-04-22 17:02:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

Should be added to the release flow, build docs and push to `docs` branch under package version folder.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-04-19 12:57:58.000 UTC</summary>

Docs will be integrated into the docs site: https://github.com/temporalio/documentation/pull/354.
We'll add versioned docs once the documentation repo supports it.

</details>


---

<a id="53"></a>

### #53: Figure out how to propagate logs out of the workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/53 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-25 07:29:06.000 UTC (4y 9m ago) |
| **Updated** | 2021-06-08 11:17:30.000 UTC |
| **Closed** | 2021-06-08 11:17:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Currently we inject `console.log` into the workflow but this isn't optimal, as the workflow internals need logging capabilities as well as user workflow code.

Come up with a design for this.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-05-23 12:06:57.000 UTC</summary>

Workflow internals do not and should **never** use `console.log` for logging, instead we should integrate with the worker logger.

</details>


---

<a id="50"></a>

### #50: Implement workflow cleanup

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/50 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-25 05:13:59.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-29 09:46:19.000 UTC |
| **Closed** | 2021-04-29 09:46:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

Currently there's no method to cleanup a completed workflow, decide how that works in terms of core<->lang responsibilities. 

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-04-29 09:46:19.000 UTC</summary>

Closed by #74 

</details>


---

<a id="34"></a>

### #34: Add utility to turn exceptions into `temporal.api.failure.v1.IFailureIFailure`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/34 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-11 09:37:48.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-23 09:40:55.000 UTC |
| **Closed** | 2021-03-23 09:40:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Use it everywhere in the codebase (most places should have a TODO comment).

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-03-23 09:40:55.000 UTC</summary>

Exceptions are now express via `coresdk.common.IUserCodeFailure`, updated the relevant occurrences.

</details>


---

<a id="26"></a>

### #26: Fix worker crash when workflow file not found

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/26 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-02 14:47:12.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-09 12:51:21.000 UTC |
| **Closed** | 2021-03-09 12:51:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Getting this when changing the [example](https://github.com/temporalio/sdk-node/blob/f0a33b7152f2a84598f0b32c109ea73ca6ad13e9/packages/create-project/samples/client.ts#L6) to run `not-found`:
```
LoaderError: Could not find file: /private/tmp/example/lib/workflows/not-found.js
```

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-03-02 15:19:25.000 UTC</summary>

Added a test and error handling on the node side and seems like core is not handling the failure correctly.
https://github.com/temporalio/sdk-node/compare/activation-job-proto-changes...test-workflow-not-found?expand=1&w=1

</details>


---

<a id="24"></a>

### #24: Set up publish from CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/24 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-02 14:30:07.000 UTC (4y 10m ago) |
| **Updated** | 2023-01-10 17:11:17.000 UTC |
| **Closed** | 2023-01-10 17:11:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Need to first consider:
- When to publish packages (on merge to main?)
- Which version to bump: patch, minor, major?
- Auto generate changelogs: https://github.com/lerna/lerna-changelog

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2023-01-10 17:11:16.000 UTC</summary>

Duplicate of #170 

</details>


---

<a id="17"></a>

### #17: error running through README

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/17 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-03-01 16:18:15.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-02 13:33:00.000 UTC |
| **Closed** | 2021-03-02 13:32:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

this is what i get when i run thru the readme instructions:

```bash
npm init @temporalio ./example
cd example

npm notice 
npm notice New minor version of npm available! 7.3.0 -> 7.6.0
npm notice Changelog: https://github.com/npm/cli/releases/tag/v7.6.0
npm notice Run npm install -g npm@7.6.0 to update!
npm notice 
npm ERR! code E404
npm ERR! 404 Not Found - GET https://registry.npmjs.org/@temporalio%2fcreate - Not found
npm ERR! 404 
npm ERR! 404  '@temporalio/create@latest' is not in the npm registry.
npm ERR! 404 You should bug the author to publish it (or use the name yourself!)
npm ERR! 404 
npm ERR! 404 Note that you can also install from a
npm ERR! 404 tarball, folder, http url, or git url.

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/swyx/.npm/_logs/2021-03-01T16_16_58_919Z-debug.log
cd: no such file or directory: example
```

i think we should also document how the @ aliases are set up in the README

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-03-01 17:05:08.000 UTC</summary>

This is because we haven't published anything to `npm` yet.
I'll do that soon.
I agree we should document the different packages in this repo.
We'll need a README for each of them so they have docs in the npm page too.

</details>


---

<a id="12"></a>

### #12: Fix CI on windows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/12 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-02-28 11:47:30.000 UTC (4y 10m ago) |
| **Updated** | 2021-11-17 15:25:11.000 UTC |
| **Closed** | 2021-11-17 15:25:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 1 |
| **Priority Score** | 1 |
| **Labels** | good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Last attempt to run github actions with `windows-latest` failed during building of the `workflow-isolate-extension` due to errors that seem to originate in `isolated-vm/lib`.
Logs seem to have been lost because in github actions when force pushing.

#### Comments (1)

<details>
<summary><strong>bergundy</strong> commented on 2021-03-01 14:50:09.000 UTC</summary>

Logs can be found [here](https://github.com/temporalio/sdk-node/runs/1997890826)

</details>


---

<a id="1867"></a>

### #1867: [Feature Request] Per-Worker Logger

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1867 |
| **State** | OPEN |
| **Author** | TastyPi (Graham Rogers) |
| **Created** | 2025-12-30 10:57:00.000 UTC (10 days ago) |
| **Updated** | 2025-12-30 10:58:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

When we run tests, we create a new Temporal Namespace for each test, and have that test's Worker connect to that namespace. This ensures tests can be run in parallel while being isolated from each other.

It also means we have a Worker per test. There are some things related to logs that we would like to be able to test, for example:
- Assert on log output
- Suppress Activity failure logs when they are expected

However, because the logger is configured by `Runtime.install`, which is global, it is not possible to have multiple Workers running in the same process using different logger instances so we can have per-test behaviour.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Allow the Logger to be configured at the Worker level. This would allow us to create a "test logger" instance for each test to enable what we want.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1862"></a>

### #1862: [Feature Request] importing workflow into activity dependency causes ‚ÄúgRPC failed to connect before the deadline‚Äù error

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1862 |
| **State** | OPEN |
| **Author** | deepika-awasthi |
| **Created** | 2025-12-12 19:10:26.000 UTC (27 days ago) |
| **Updated** | 2025-12-12 19:10:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Improve error messages when:

workflow code ends up in an activity dependency / non-sandboxed side, or
activities and workflows end up mixed in a way that breaks the sandbox assumptions.

Current error message is `Failed to connect before the deadline` which points connectivity or cloud auth issues and sends down the wrong debugging path.

attached issue :- https://app.usepylon.com/issues?conversationID=aa9077dd-17e0-4e89-8ae8-737828d47860


---

<a id="1860"></a>

### #1860: [Bug] Performance regression from 1.13.1 -> 1.13.2

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1860 |
| **State** | OPEN |
| **Author** | mnahkies (Michael Nahkies) |
| **Created** | 2025-12-10 09:32:18.000 UTC (1 months ago) |
| **Updated** | 2025-12-10 09:40:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
We expect consistent worker performance, as we have a roughly constant load of workflows being processed.

### Describe the bug

We've been running our worker with this patch applied https://github.com/temporalio/sdk-typescript/pull/1834 using the `1.13.1` SDK.

OTEL interceptors are in use, as well as some custom interceptors. All `AsyncLocalStorage` instances created during workflow execution are being disposed by an Internals interceptor.

When we use the patched `1.13.1` SDK we see steady metrics. Updating to `1.13.2` shows a significant degradation in performance.

On the screenshot you can see on the left the workers CPU usage when running the patched `1.13.2` SDK, on the right reverting to the patched `1.13.1` SDK.

<img width="886" height="252" alt="Image" src="https://github.com/user-attachments/assets/85757cd2-3a2b-42be-b31d-27aab30a7b4c" />

It's worth noting that the projects dependency tree has no duplicated temporal packages (eg: only a single version of each is in use), and there were no changes to other dependencies (eg: OTEL core packages) between the two builds compared.

I've scanned through the PR's linked in the release notes for `1.13.2`, and whilst there are notable changes around the new plugin functionality, nothing screamed out as obviously responsible for this regression. It's quite possible I've missed something though.

### Minimal Reproduction
TBD

### Environment/Versions

- OS and processor: Linux
- Temporal Version: 1.25.2
- Self hosted in kubernetes

### Additional context

Semi-related: https://github.com/temporalio/sdk-typescript/issues/1859


---

<a id="1858"></a>

### #1858: [Bug] unable to import reflect-metadata within workflow bundle

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1858 |
| **State** | OPEN |
| **Author** | hmvien (Hien Vien) |
| **Created** | 2025-12-05 23:25:41.000 UTC (1 months ago) |
| **Updated** | 2025-12-08 18:01:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Our Temporal TypeScript worker bundles class-based workflows that use [Inversify‚Äôs](https://github.com/inversify/InversifyJS) decorators (and therefore reflect-metadata). These workflows are instantiated within the workflow entry point using `container.get(WorkflowIdentifier)`. 

We implement workflows as classes to enhance workflow and activity modularity and to make it easier to write unit tests.

### Describe the bug

When `reuseV8Context` remains enabled (the default), the workflow is unable to start up with error
```
TypeError: Cannot define property decorate, object is not extensible
    at Function.defineProperty (<anonymous>)
    at reflect-metadata/Reflect.js:35:0
    at reflect-metadata/Reflect.js:146:0
    at reflect-metadata/Reflect.js:29:0
    at reflect-metadata/Reflect.js:55:5
```

This used to work in temporal-sdk 1.11.8, but breaks as soon as we upgrade to a later sdk version.

Temporal freezes the global Reflect object inside the reusable workflow isolate, so reflect-metadata cannot add its helpers.

Setting `reuseV8Context` to false fixes the issue, but does increase our memory and cpu footprint.

### Minimal Reproduction

`workflows.ts`
```
import "reflect-metadata";

import { Container, injectable } from "inversify";

@injectable()
class Workflows {
  async execute(): Promise<void> {
    // This workflow doesn't need to do anything; the error occurs as soon as
    // reflect-metadata tries to patch the frozen Reflect object.
  }
}

const container = new Container();
container.bind(Workflows).toSelf();

export default async function () {
  const workflow = container.get(Workflows);
  return await workflow.execute();
}
```

`worker.ts`
```
import path from "node:path";
import { fileURLToPath } from "node:url";

import { NativeConnection, Worker } from "@temporalio/worker";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function main(): Promise<void> {
  const reuseV8Context = process.env.REUSE_V8_CONTEXT !== "false";

  console.info(
    `[repro] Starting worker with reuseV8Context=${reuseV8Context.toString()}`,
  );

  const connection = await NativeConnection.connect({
    address: "localhost:7233",
  });
  const worker = await Worker.create({
    connection,
    namespace: "dev",
    taskQueue: "dev",
    reuseV8Context,
    workflowsPath: path.join(__dirname, "workflows.ts"),
  });

  await worker.run();
}

main().catch((error) => {
  console.error("[repro] Worker creation failed with error:");
  console.error(error);
  process.exitCode = 1;
});
```

Execute with
```
1. tsx worker.ts
2. temporal workflow start --task-queue dev --type TestWorkflow
```

### Environment/Versions

- OS and processor: macOS
- Temporal Version: 1.13
- Are you using Docker or Kubernetes or building Temporal from source? No

### Additional context




---

<a id="1856"></a>

### #1856: [Bug] Cannot build `@temporalio/core-bridge` rust from source

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1856 |
| **State** | CLOSED |
| **Author** | stathis-alexander (Alexander Stathis) |
| **Created** | 2025-12-04 18:54:31.000 UTC (1 months ago) |
| **Updated** | 2025-12-05 20:14:27.000 UTC |
| **Closed** | 2025-12-05 20:14:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

We are trying to build `@temporalio/core-bridge`'s rust from source. 

### Describe the bug

We run our application in Alpine images (I know, I know), and so we rely on being able to build the rust binary from source. This broke after 0.12.0, since the `bridge-macros` were refactored into a separate top level folder which is not included in the `files` in the `package.json`, and thus are not contained in the installed package. 

I tried to patch them in, but there is an [issue in our package manager](https://github.com/oven-sh/bun/issues/13330), bun, that prevents this from working. I've worked around it in our build pipeline by committing these files to our repo directly where they're needed, but it's less than ideal.

These files should be included in the `core-bridge` package along with the other rust source files so that we can build them from source. 

### Environment/Versions

We're building in alpine. 

### Additional context

I've opened this PR to address this issue: https://github.com/temporalio/sdk-typescript/pull/1852

Additionally, I could open another PR to enable building alpine / musl binaries if desired. The documentation suggests this would be very difficult, but it is not so hard to do. 

We use the following patch:
```
diff --git a/Cargo.toml b/Cargo.toml
index ecc4e78e0321e2df5d1045e1a1607f4256a9e478..5e9bcb4165ac27ded9933c9dd91352a496e21033 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -18,6 +18,7 @@ opt-level = 3
 debug = false
 lto = true
 incremental = false
+strip = true
 
 [dependencies]
 anyhow = "1.0"
diff --git a/common.js b/common.js
index 7ffd6da0af2b0362d91d669578ef21e126323f20..065d88e4a17e4861329384bad7fadc05ece286ce 100644
--- a/common.js
+++ b/common.js
@@ -14,13 +14,20 @@ const targets = [
   'aarch64-apple-darwin',
   'x86_64-unknown-linux-gnu',
   'aarch64-unknown-linux-gnu',
+  'x86_64-unknown-linux-musl',
+  'aarch64-unknown-linux-musl',
   // TODO: this is not supported on macos
   'x86_64-pc-windows-msvc',
   'x86_64-pc-windows-gnu',
 ];
 
 const archAlias = { x64: 'x86_64', arm64: 'aarch64' };
-const platformMapping = { darwin: 'apple-darwin', linux: 'unknown-linux-gnu', win32: 'pc-windows-msvc' };
+const platformMapping = {
+  darwin: 'apple-darwin',
+  linux: 'unknown-linux-gnu',
+  linux_musl: 'unknown-linux-musl',
+  win32: 'pc-windows-msvc',
+};
 
 class PrebuildError extends Error {
   constructor(message) {
@@ -29,12 +36,16 @@ class PrebuildError extends Error {
   }
 }
 
+function isMuslSystem() {
+  return process.report.getReport().sharedObjects.some((lib) => lib.includes('musl'));
+}
+
 function getPrebuiltTargetName() {
   const arch = archAlias[os.arch()];
   if (arch === undefined) {
     throw new PrebuildError(`No prebuilt module for arch ${os.arch()}`);
   }
-  const platform = platformMapping[os.platform()];
+  const platform = isMuslSystem() ? platformMapping[`${os.platform()}_musl`] : platformMapping[os.platform()];
   if (platform === undefined) {
     throw new PrebuildError(`No prebuilt module for platform ${os.platform()}`);
   }
@@ -50,4 +61,12 @@ function getPrebuiltPath() {
   }
 }
 
-module.exports = { targets, archAlias, platformMapping, PrebuildError, getPrebuiltPath, getPrebuiltTargetName };
+module.exports = {
+  targets,
+  archAlias,
+  platformMapping,
+  PrebuildError,
+  getPrebuiltPath,
+  getPrebuiltTargetName,
+  isMuslSystem,
+};
diff --git a/scripts/build.js b/scripts/build.js
index a6271fcb72c25a08caa5a6388c9b82e4e1ede186..c7ab17df5ca3c73c49540ed681afd3889ec950d3 100644
--- a/scripts/build.js
+++ b/scripts/build.js
@@ -93,6 +93,8 @@ function compile(requestedTarget) {
   if (status !== 0 || error) {
     throw new Error(`Failed to build${target ? ' for ' + target : ''}: status code ${status}`, error);
   }
+
+  try { fs.rmdirSync('target', { recursive: true });  } catch (err) {}
 }
 
 if (requestedTargets.length > 0) {
```
 along with 
```

RUN <<EOF
  apk add --no-cache build-base cmake protoc protobuf-dev rustup

  rustup-init -y
EOF

ENV RUSTFLAGS="-C target-feature=-crt-static"
ENV PATH="/root/.cargo/bin:$PATH"
ENV BUILD_CORE_RELEASE="true"
```
in the docker file. 


---

<a id="1854"></a>

### #1854: [Feature Request] Correct docs for OtelCollectorExporter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1854 |
| **State** | OPEN |
| **Author** | clintonb (Clinton Blackburn) |
| **Created** | 2025-12-04 01:17:12.000 UTC (1 months ago) |
| **Updated** | 2025-12-04 01:17:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

The docstring for the Otel `url` is incorrect/confusing. It states that `OTEL_EXPORTER_OTLP_ENDPOINT` will override the value provided. This appears to be incorrect given that there is no code that references the environment variable. Additionally, if such code existed, it would break metrics export since `OTEL_EXPORTER_OTLP_ENDPOINT` for HTTP is typically `http://localhost:4318` but this package expects a URL with the path (e.g., `http://localhost:4318/v1/metrics`).

https://github.com/temporalio/sdk-typescript/blob/6b89dfc95ebb8554e439a0f2b2c26d5783bfa1d7/packages/worker/src/runtime-options.ts#L225-L236

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Remove this note to avoid confusion.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->
N/A



---

<a id="1851"></a>

### #1851: [Feature Request] Support non-workflow activities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1851 |
| **State** | OPEN |
| **Author** | maciejdudko (Maciej Dudkowski) |
| **Created** | 2025-12-02 17:20:06.000 UTC (1 months ago) |
| **Updated** | 2025-12-02 17:20:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Allow executing activities without a workflow. The clients must support the new (upcoming) server APIs for starting, managing and getting results of activities. The workers must support running activities outside of workflow context.

### Additional context

Server API PR (WIP): https://github.com/temporalio/api/pull/640


---

<a id="1850"></a>

### #1850: [Feature Request] Implement OTel interceptors v1 as Plugin

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1850 |
| **State** | OPEN |
| **Author** | chris-olszewski (Chris Olszewski) |
| **Created** | 2025-12-02 15:09:54.000 UTC (1 months ago) |
| **Updated** | 2025-12-02 15:09:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

OTEL interceptors are awkward to use

### Describe the solution you'd like

Setting up OTEL should be as easy as
```
const plugin = new OpenTelemetryPlugin({resource: staticResource, traceExporter});
const worker = await Worker.create({
    workflowsPath: require.resolve('./workflows'),
    activities,
    taskQueue: 'test-otel',
    plugins: [plugin],
});

const client = new Client({
    plugins: [plugin],
});
```

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1843"></a>

### #1843: Default maxCachedWorkflows calculation doesn't account for VM isolate memory being outside V8 heap

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1843 |
| **State** | OPEN |
| **Author** | alonp99 (Alon Peretz) |
| **Created** | 2025-11-27 04:41:54.000 UTC (1 months ago) |
| **Updated** | 2025-11-27 04:41:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

  The default maxCachedWorkflows formula uses maxHeapMemory (--max-old-space-size) to calculate
  how many workflows to cache. However, workflow VM isolates allocate native memory outside
  the V8 heap, not inside it.

  This causes unexpected OOMs in containerized environments where:
  1. --max-old-space-size is set high (e.g., 4.6GB) relative to container limit (5Gi)
  2. Temporal calculates maxCachedWorkflows = ~2600
  3. VM isolates consume ~2.6GB of NATIVE memory (not heap)
  4. Total memory = heap + VM cache + overhead > container limit ‚Üí OOMKill

  Suggested improvements:
  1. Documentation: Warn that VM isolates use native memory, not heap memory
  2. Default calculation: Consider using a more conservative default, or factor in
     that VM cache is additive to heap usage
  3. Logging: Log a warning if calculated maxCachedWorkflows * ~1MB + maxHeapMemory
     exceeds available system memory

  Environment: TypeScript SDK 1.11.7, Node.js 22, Kubernetes


---

<a id="1838"></a>

### #1838: [Bug] `WorkflowExecutionAlreadyStartedError` should contain `runId` if provided by server

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1838 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-11-21 23:12:54.000 UTC (1 months ago) |
| **Updated** | 2025-11-21 23:12:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

In most cases, on `WorkflowExecutionAlreadyStartedError`, the server provides the `runId` of the already running workflow execution. However, the TS SDK does not currently include that `runId` in the thrown `WorkflowExecutionAlreadyStartedError`. It should be.

### Misc

The `runId` is stored as part of the protobuf-encoded error details, which the TS SDK already knows how to decode. Extracting this extra detail should therefore be reasonably easy.


---

<a id="1832"></a>

### #1832: [Bug] Worker crashes with "async hook stack has become corrupted" when Prometheus metrics enabled under high concurrency

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1832 |
| **State** | CLOSED |
| **Author** | tshtark |
| **Created** | 2025-11-19 15:21:13.000 UTC (1 months ago) |
| **Updated** | 2025-11-20 18:42:15.000 UTC |
| **Closed** | 2025-11-20 18:42:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

 We're running a production Temporal worker in Kubernetes that processes workflows with moderate-to-high concurrency (up to 100
  concurrent workflow tasks). We want to monitor worker health and performance using Prometheus metrics exposed by the Temporal SDK's built-in
  metrics exporter.

### Describe the bug

 Workers crash repeatedly with Error: `async hook stack has become corrupted` when Prometheus metrics are enabled.

  When we enable Prometheus metrics in RuntimeOptions.telemetryOptions, our production workers crash within minutes to hours with async hook
  stack corruption. The error occurs in Node.js worker threads and causes continuous pod restarts, making the worker completely unstable.

  Configuration that triggers the crash:

```ts
  const runtimeOptions: RuntimeOptions = {
      logger: nestLoggerToTemporalLoggerAdapter(this.logger),
      telemetryOptions: {
          metrics: {
              metricPrefix: `svc_${serviceName}_temporal__`,
              prometheus: {
                  bindAddress: '0.0.0.0:9292'
              }
          },
          logging: {
              filter: { core: 'INFO', other: 'INFO' }
          }
      }
  }

  // Worker configuration
  {
      tuner: {
          activityTaskSlotOptions: {
              minimumSlots: 5,
              maximumSlots: 40,
          },
          workflowTaskSlotOptions: {
              minimumSlots: 2,
              maximumSlots: 100,
          }
      },
      workflowThreadPoolSize: os.cpus().length,
      reuseV8Context: true,
  }
```

  Error output:

```
  Error: async hook stack has become corrupted (actual: 54451, expected: 4)
  ----- Native stack trace -----

   1: 0xee115d node::AsyncHooks::FailWithCorruptedAsyncStack(double) [node]
   2: 0xee2698 node::AsyncHooks::pop_async_context(double) [node]
   3: 0xe714aa node::InternalCallbackScope::Close() [node]
   4: 0xe7193b node::InternalMakeCallback(...) [node]
   5: 0xe8b2e2 node::AsyncWrap::MakeCallback(...) [node]
   6: 0xfd515d node::worker::MessagePort::OnMessage(...) [node]
   7: 0x1d2bc43  [node]
   8: 0x1d40974  [node]
   9: 0x1d2c967 uv_run [node]
  10: 0xe726d6 node::SpinEventLoopInternal(node::Environment*) [node]
  11: 0x10aa387 node::worker::Worker::Run() [node]
```

### Minimal Reproduction

 I don't have a minimal reproduction yet, but the issue can be reproduced with:

  1. Start with the https://github.com/temporalio/samples-typescript/tree/main/hello-world
  2. Add Prometheus metrics configuration to RuntimeOptions:
  
```
  telemetryOptions: {
      metrics: {
          prometheus: { bindAddress: '0.0.0.0:9292' }
      }
  }
```
  3. Configure worker with high concurrency:
```
  workflowTaskSlotOptions: {
      maximumSlots: 100
  }
```
  4. Generate significant concurrent workflow load (run 50+ workflows simultaneously)
  5. Worker should crash with async hook corruption after some time

  Note: The issue is load-dependent and may require production-level traffic to reproduce consistently.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Linux x86_64 (Debian GNU/Linux 11 bullseye) in AWS EKS Kubernetes cluster
  - Node.js Version: v22.11.0
  - Temporal SDK Version: @temporalio/worker@1.13.1 (latest as of 2025-11-19)
    - Also using: @temporalio/client@1.13.1, @temporalio/workflow@1.13.1, @temporalio/activity@1.13.1, @temporalio/common@1.13.1
  - Deployment: Kubernetes (Docker containers in AWS EKS)
  - Temporal Server: Temporal Cloud


---

<a id="1824"></a>

### #1824: [Feature Request] Allow overriding of the Worker Deployment Version when invoking a Child Workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1824 |
| **State** | OPEN |
| **Author** | chris-olszewski (Chris Olszewski) |
| **Created** | 2025-11-12 16:24:56.000 UTC (1 months ago) |
| **Updated** | 2025-11-12 16:24:56.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Users want to override the target version on a workflow, especially when doing pre-deployment testing.  This should work the same as it does when creating a Workflow from a client.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1810"></a>

### #1810: [Feature Request] Enable Worker Heartbeating

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1810 |
| **State** | CLOSED |
| **Author** | yuandrew (Andrew Yuan) |
| **Created** | 2025-10-28 02:00:27.000 UTC (2 months ago) |
| **Updated** | 2025-12-17 00:00:41.000 UTC |
| **Closed** | 2025-12-17 00:00:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Worker heartbeating is implemented in Core, need to enable worker heartbeating by allowing users to specify the worker heartbeat interval when initializing Core Runtime

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1782"></a>

### #1782: [Feature Request] Ensure tests exist to confirm custom slot supplier slot info has proper fields

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1782 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-09-05 12:31:02.000 UTC (4 months ago) |
| **Updated** | 2025-09-05 12:31:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/672


---

<a id="1779"></a>

### #1779: [Bug] `@temporalio/interceptors-opentelemetry` OTEL bypasses a required SDK component

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1779 |
| **State** | OPEN |
| **Author** | sdedovic (Stevan Dedovic) |
| **Created** | 2025-08-29 16:56:46.000 UTC (4 months ago) |
| **Updated** | 2025-08-29 16:56:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
When using the `@temporalio/interceptors-opentelemetry` library I am seeing TONS of these errors:

```
ERROR --- node_modules/@opentelemetry/api/build/src/api/diag.js : ["Accessing resource attributes before async attributes settled"]
```

which are caused by the Temporal SDKs improper use of the OTEL SDK.

### Describe the bug
See this comment on the issue in the OTEL SDK: https://github.com/open-telemetry/opentelemetry-js/issues/5828#issuecomment-3227403161. To quote the linked comment, from one of the OTEL maintainers

> Looking at the code it looks like the following is happening:\
> -    @temporalio/interceptors-opentelemetry bypasses the SpanProcessor which is supposed to await the async attributes and passes spans directly to SpanExporter
> -    the SpanExporter then assumes that the resource was already awaited by the SpanProcessor, but since @temporalio/interceptors-opentelemetry bypassed the SpanProcessor this never happened.
> -    during normal operation of an OTel SDK, this log is not written - this happens since @temporalio/interceptors-opentelemetry bypasses a required SDK component.
>
> **Recommendation**: @temporalio/interceptors-opentelemetry should accept a SpanProcessor instead of a SpanExporter in [makeWorkflowExporter()](https://github.com/temporalio/sdk-typescript/blob/7c88cc7ab0d02f0002178ba03a349503d5bc481c/packages/interceptors-opentelemetry/src/worker/index.ts#L73-L90), and pass the spans to SpanProcessor#onEnd(Span) instead. This will properly await the resource attributes before exporting them, log errors and and handle batching in a user-configurable way, which may be desirable.



### Minimal Reproduction
See last comment on this issue: https://github.com/open-telemetry/opentelemetry-js/issues/5828#event-19364472301

```ts
export function makeWorkflowExporter(
  spanProcessor: SpanProcessor, // used with a BatchSpanProcessor for instance, which forwards to a SpanExporter
  resource: Resource
): InjectedSink<OpenTelemetryWorkflowExporter> {
  // note: somehow, `SpanProcessor#shutdown()` needs to be wired up somewhere to avoid data loss on shutdown.
  return {
    export: {
      fn: (info, spanData) => {
        const spans = spanData.forEach((serialized) => {
          Object.assign(serialized.attributes, info);
          // Spans are copied over from the isolate and are converted to ReadableSpan instances
          spanProcessor.onEnd(extractReadableSpan(serialized, resource));
        });
      },
    },
  };
}
```

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: x86_64-linux
- Temporal Version: [e.g. 1.14.0?] and/or SDK version
- Temporal from source

### Additional context
This will affect https://github.com/temporalio/sdk-typescript/pull/1741



---

<a id="1778"></a>

### #1778: [Feature Request] Ensure gRPC binary metadata headers are supported

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1778 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-08-27 20:15:10.000 UTC (4 months ago) |
| **Updated** | 2025-10-15 21:43:18.000 UTC |
| **Closed** | 2025-10-15 21:43:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/671. This is likely only a problem for native connection. Probably just need to accept `Uint8Array` as metadata value and send as binary to Tonic for -bin keys.


---

<a id="1776"></a>

### #1776: [Feature Request] Reclassify Benign Application errors in OpenTelemetry

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1776 |
| **State** | CLOSED |
| **Author** | THardy98 (Thomas Hardy) |
| **Created** | 2025-08-26 20:39:46.000 UTC (4 months ago) |
| **Updated** | 2025-09-22 21:12:08.000 UTC |
| **Closed** | 2025-09-22 21:12:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See issue description here:

https://github.com/temporalio/sdk-python/issues/1041


---

<a id="1775"></a>

### #1775: [Feature Request] Support for creating v7 UUIDs from within Workflow Tasks

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1775 |
| **State** | OPEN |
| **Author** | roberto-retool |
| **Created** | 2025-08-26 17:59:35.000 UTC (4 months ago) |
| **Updated** | 2025-08-26 17:59:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.
We currently use the `uuid4()` function pretty heavily to generate unique ids within Workflow Tasks. For some use cases we want to generate UUIDv7 IDs for better indexing and sorting semantics. We cannot use the `uuid` npm package because it depends on the `crypto` module.
We've already added this function to our codebase, but it'd be helpful to merge upstream to expand the functionality provided by `uuid4`. 

### Describe the solution you'd like

The function can have an identical signature to the [uuid4 function](https://github.com/temporalio/sdk-typescript/blob/5473ebd3442d00624fb0ed20fa82f8d5bd78e8fd/packages/workflow/src/workflow.ts#L1067).

e.g. our implementation is:
```
export function uuid7() {
  // Return the hexadecimal text representation of number `n`, padded with zeroes to be of length `p`
  const ho = (n: number, p: number) => n.toString(16).padStart(p, '0')

  // Get current timestamp in milliseconds since Unix epoch
  const msecs = Date.now()

  // Create a view backed by a 16-byte buffer
  const view = new DataView(new ArrayBuffer(16))

  // byte 0-5: timestamp (48 bits)
  // DataView only allows setting bits in 8, 16, 32, 64 increments, so set using 32 + 16 chunks.
  view.setUint32(0, Math.floor(msecs / 0x10000))
  view.setUint16(4, msecs & 0xffff)
  // byte 6-7: version (4 bits, 0x7) + random (12 bits)
  view.setUint16(6, (0x7 << 12) | ((Math.random() * 0x1000) >>> 0))
  // byte 8-9: variant (2 bits, we always use 0x2) + random (14 bits)
  view.setUint16(8, (0x2 << 14) | (((Math.random() * 0x100000) >>> 0) & 0x3fff))
  // bytes 10-15: random (48 bits)
  view.setUint32(10, (Math.random() * 0x100000000) >>> 0)
  view.setUint16(14, (Math.random() * 0x10000) >>> 0)

  // Compile the canonical textual form from the array data
  return `${ho(view.getUint32(0), 8)}-${ho(view.getUint16(4), 4)}-${ho(view.getUint16(6), 4)}-${ho(
    view.getUint16(8),
    4,
  )}-${ho(view.getUint32(10), 8)}${ho(view.getUint16(14), 4)}`
}
```

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1764"></a>

### #1764: [Feature Request] Plugin support

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1764 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-08-15 14:33:15.000 UTC (4 months ago) |
| **Updated** | 2025-11-10 18:24:17.000 UTC |
| **Closed** | 2025-11-10 18:24:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/652


---

<a id="1753"></a>

### #1753: [Bug] Calling a Workflow with Worker Versioning and PINNED behavior in versionOverrides fails in Temporal Server >=1.28.0

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1753 |
| **State** | CLOSED |
| **Author** | jbrody-nexxa |
| **Created** | 2025-07-30 23:46:00.000 UTC (5 months ago) |
| **Updated** | 2025-07-31 16:38:07.000 UTC |
| **Closed** | 2025-07-31 16:38:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Call a Workflow with Worker Versioning and PINNED behavior using the TypeScript SDK client

### Describe the bug

Starting in Temporal Server version 1.28.0, the validation logic for versioning overrides in the API expects either of the following structures for pinned behavior:

```
{
  pinned: {
    version: 'pinned-version', // v0.32
    behavior: temporal.api.workflow.v1.VersioningOverride.PinnedOverrideBehavior.PINNED_OVERRIDE_BEHAVIOR_PINNED, // v0.32  
  },
}
```
or:
```
{
  behavior: temporal.api.enums.v1.VersioningBehavior.VERSIONING_BEHAVIOR_PINNED, // v0.31
  pinnedVersion: 'pinned-version', // v0.31
}
```

Since TS SDK version 1.12, the client is sending versioning overrides in the following format:
```
{
  pinned: {
      version: 'pinned-version', // v0.32
  },
  behavior: temporal.api.enums.v1.VersioningBehavior.VERSIONING_BEHAVIOR_PINNED, // v0.31
  pinnedVersion: 'pinned-version', // v0.31
}
```

This fails validation, as the server prefers validation of the v0.32 structure over the deprecated v0.31 structure. The error message from the server is: `ServiceError: must specify pinned override behavior if override is pinned.`

See server validation code in https://github.com/temporalio/temporal/blob/fcd84c4be64104ca8b9b670f50539a027e77aa78/common/worker_versioning/worker_versioning.go#L483

### Minimal Reproduction

1. Start a Workflow Worker with the following workerDeploymentOptions:
`{   useWorkerVersioning: true,   defaultVersioningBehavior: 'AUTO_UPGRADE',   version: {   deploymentName: deploymentName,   buildId: buildId, }`
2. Call `WorkflowClient.start()` from the TypeScript SDK with the following versioningOverride:
`{   pinnedTo: { deploymentName: deploymentName, buildId: buildId,   }, }`
3. Workflow does not start, and client produces the error: `ServiceError: must specify pinned override behavior if override is pinned.`

### Environment/Versions

- OS and processor: Mac, Linux
- Temporal Version: TS SDK version 1.12.1; works on server 1.27.1, fails on sever 1.28.0 and 1.29.0
- Are you using Docker or Kubernetes or building Temporal from source? Using Kubernetes and brew on Mac

### Additional context

See the discussion thread with Carly on the issue in the server repo: https://github.com/temporalio/temporal/issues/8114



---

<a id="1752"></a>

### #1752: [Feature Request] Add Activity support for Worker Versioning

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1752 |
| **State** | CLOSED |
| **Author** | jbrody-nexxa |
| **Created** | 2025-07-29 18:51:21.000 UTC (5 months ago) |
| **Updated** | 2025-07-29 18:57:19.000 UTC |
| **Closed** | 2025-07-29 18:57:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

My team has Workflows and Activities developed on different release cycles. We use Worker Versioning to either pin or use latest version of a Workflow. However, when a Workflow calls an Activity, even if the Activity Worker uses Worker Versioning, there is no way for the Workflow to specify the version of the Activity to use. We have resorted to baking the Activity version into the task queue name, which is not ideal as our Workers are already using Deployments and Versioning.

### Describe the solution you'd like

Add `versioningOverride` to `ActivityOptions`, and have the Temporal Service use the `versioningOverride` (as well as the worker defaults specified in `WorkerDeploymentOptions`) to resolve the scheduled Activity to a Worker Deployment.

### Additional context

This would mostly leverage the work already done for [Workflow Versioning](https://github.com/temporalio/sdk-typescript/issues/1659).



---

<a id="1746"></a>

### #1746: [Feature Request] Add Summary to LocalActivityOptions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1746 |
| **State** | CLOSED |
| **Author** | yuandrew (Andrew Yuan) |
| **Created** | 2025-07-18 00:01:37.000 UTC (5 months ago) |
| **Updated** | 2025-08-11 23:56:47.000 UTC |
| **Closed** | 2025-08-11 23:56:47.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

See `features` repo issue for more info

### Describe the solution you'd like

Add Summary to LocalActivityOptions

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1739"></a>

### #1739: [Feature Request] Add `ActivityContext.workerShuttingDown`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1739 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-07-08 19:10:36.000 UTC (6 months ago) |
| **Updated** | 2025-07-08 19:10:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Other SDKs expose a way on activity context to know that a Worker is shutting down, before expiration of the grace period. TS doesn't.

That would be a `workerShuttingDown: Promise<never>` and `workerShuttingDownSignal: AbortSignal` on the activity Context, similar to how we handle cancellation, as well as matching functions as top level exports on `activity/index.ts`.

### Additional context

- https://docs.temporal.io/encyclopedia/workers/worker-shutdown
- https://pkg.go.dev/go.temporal.io/sdk/activity#GetWorkerStopChannel
- https://python.temporal.io/temporalio.activity.html#wait_for_worker_shutdown
- https://dotnet.temporal.io/api/Temporalio.Activities.ActivityExecutionContext.html#Temporalio_Activities_ActivityExecutionContext_WorkerShutdownToken




---

<a id="1727"></a>

### #1727: [Feature Request] Environment Configuration

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1727 |
| **State** | CLOSED |
| **Author** | THardy98 (Thomas Hardy) |
| **Created** | 2025-06-17 19:58:31.000 UTC (6 months ago) |
| **Updated** | 2025-10-24 18:51:53.000 UTC |
| **Closed** | 2025-10-24 18:51:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the solution you'd like**

See https://github.com/temporalio/features/issues/441 and https://github.com/temporalio/proposals/blob/master/all-sdk/external-client-configuration.md



---

<a id="1722"></a>

### #1722: [Feature Request] Include error details on every errors thrown from Client API

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1722 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-06-03 17:05:14.000 UTC (7 months ago) |
| **Updated** | 2025-06-03 17:05:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

The concept of "error" at the grpc level is quite rigid and dry, consisting only of a message and an error code. To provide more context, the Temporal server sometime attaches an encoded error detail object as metadata on the error. We added support to decode these error details in #1147, which allows us to return specific, high level error classes to users in some specific cases (e.g. `NamespaceNotFoundFailure`).

It would not make sense to create a high level error classes for every error for which the server provides details, as the list of those errors is ever growing and many are very unlikely to ever happens in real life. Yet, users sometime need access to these error details to diagnose operational issues.

We should therefore always decode detailed error messages and make them available on the generic grpc errors, even if we don't make specific error classes for those details.

That however poses some challenges:

- Users wouldn't be able to use the `instanceof` operator to determine the exact type of error and which details are available, due to some oddities of how we do protobuf in the TS SDK;
 
- We'd likely want to see these details when an error is printed out, but they wouldn't be by default. Not even if doing `JSON.stringify`, unless the detailed properties are enumerable, which wouldn't be the case for objects coming from the protobuf library.
 
- Some error details may themselves contain other encoded protobuf objects, which needs to be decoded recursively. Can we dynamically determine which messages/properties contain recursively decodable messages, i.e. without implementing visitor logic for each of these error detail types?


---

<a id="1721"></a>

### #1721: [Bug] Error thrown from Client's Update-with-Start doesn't show proper message

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1721 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-06-03 15:56:11.000 UTC (7 months ago) |
| **Updated** | 2025-06-03 15:56:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Due to the composed nature of the Update-with-Start API, the server reports errors from that API in an aggregated form, containing only a generic error message, `MultiOperation could not be executed`. The list of actual errors are attached as details to the aggregated error, using the `MultiOperationExecutionFailure` protobuf message type, which itself needs to be decoded to obtain actual underlying errors.

The Workflow Client already does some work to decode and extract a proper error message out of `MultiOperationExecutionFailure`. It then replace the grpc error's generic message by that more specific error message. We have tests that confirm that this behavior works properly.

However, it appears that printing out the grpc error prints the original, generic message rather than the proper, detailed one.

For instance, printing out `error` gives:

```
Error: 8 RESOURCE_EXHAUSTED: MultiOperation could not be executed.
    at callErrorFromStatus
    at Object.onReceiveStatus
    // ...
```

even though `error.message` contains:

```
limit on number of concurrent in-flight updates has been reached (10)
```

As users generally don't print out `error.message` explicitly to their logs, a user is left without a clue of what actually went wrong. A better behavior would be for the error to print out with a composed message, such as:

```
Error: 8 RESOURCE_EXHAUSTED Update-with-Start could not be executed: limit on number of concurrent in-flight updates has been reached (10)
    at callErrorFromStatus
    at Object.onReceiveStatus
    // ...
```


---

<a id="1717"></a>

### #1717: [Bug] Protobuf Payload Converter is broken after upgrading to protobufjs 7.5.2

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1717 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-05-16 04:24:35.000 UTC (7 months ago) |
| **Updated** | 2025-05-16 05:05:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

After upgrading `protobufjs` to 7.5.2, our feature tests using Protobuf Payload converters have started failing with the following error message:

```
Feature data_converter/binary_protobuf failed with TypeError: Cannot read properties of undefined (reading '_fullyQualifiedObjects') TypeError: Cannot read properties of undefined (reading '_fullyQualifiedObjects')
    at Object.lookup (/home/runner/work/sdk-typescript/sdk-typescript/features/program-3122623612/node_modules/protobufjs/src/namespace.js:411:27)
    at Object.lookupType (/home/runner/work/sdk-typescript/sdk-typescript/features/program-3122623612/node_modules/protobufjs/src/namespace.js:491:22)
    at ProtobufBinaryPayloadConverter.validatePayload (/home/runner/work/sdk-typescript/sdk-typescript/sdk-ts/packages/common/lib/converter/protobuf-payload-converters.js:58:37)
    at ProtobufBinaryPayloadConverter.fromPayload (/home/runner/work/sdk-typescript/sdk-typescript/sdk-ts/packages/common/lib/converter/protobuf-payload-converters.js:99:44)
    at PayloadConverterWithProtobufs.fromPayload (/home/runner/work/sdk-typescript/sdk-typescript/sdk-ts/packages/common/lib/converter/payload-converter.js:113:26)
    at /home/runner/work/sdk-typescript/sdk-typescript/sdk-ts/packages/common/lib/converter/payload-converter.js:60:48
    at Array.map (<anonymous>)
    at arrayFromPayloads (/home/runner/work/sdk-typescript/sdk-typescript/sdk-ts/packages/common/lib/converter/payload-converter.js:60:21)
    at decodeArrayFromPayloads (/home/runner/work/sdk-typescript/sdk-typescript/sdk-ts/packages/common/lib/internal-non-workflow/codec-helpers.js:89:54)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
```

### Minimal Reproduction

The following feature tests demonstrate this issue:

- `data_converter/binary_protobuf`
- `json_protobuf`

All SDK integration tests still pass, including those testing the Protobuf Payload Converter feature. Our `protobufs` sample also execute without problem against 1.11.8 + protobufjs 7.5.2 (didn't test other combinations). Given that the latter are more representative of how users would normally use this feature, it seems reasonable to expect that this issue might not have any user visible impact.

### Misc

- The `_fullyQualifiedObjects` property [was introduced in protobufjs yesterday](https://github.com/protobufjs/protobuf.js/pull/2068/files).
- It seems likely that this upstream change may conflict with our ["Patch Protobuf Root"](https://github.com/temporalio/sdk-typescript/blob/3cbb5feae4188b1c5458d0edcfd2bb49c3feadff/packages/proto/src/patch-protobuf-root.ts#L20) logic.
- Due to technical constraints of our feature test harness, our feature tests reuse some protobuf message definitions of the SDK itself, rather than defining and compiling their own protobuf messages as one would normally do.


---

<a id="1716"></a>

### #1716: [TypeScript] Worker Versioning high level client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1716 |
| **State** | OPEN |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2025-05-14 22:46:37.000 UTC (7 months ago) |
| **Updated** | 2025-05-14 22:49:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Create the high-level client for control plane operations concerning worker deployments. See the Go one as an example (though it also needs some updating as of this writing)


---

<a id="1715"></a>

### #1715: If a serializable value is provided as a SearchAttribute, serialize it instead of throwing the error: "SearchAttribute values must arrays of strings, numbers, booleans, or Dates. The value * at index 0 is of type object"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1715 |
| **State** | OPEN |
| **Author** | JCMais (Jonathan Cardoso) |
| **Created** | 2025-05-14 19:29:55.000 UTC (7 months ago) |
| **Updated** | 2025-05-14 20:55:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

If an object is passed as a SearchAttribute, and it is not a Date, and it has a `toJSON` method, the `toJSON`method should be called, and only then should the validation happen.

E.g: this allows passing MongoDB ObjectIds as search attributes, as they have a `toJSON` that serializes to a String.


---

<a id="1713"></a>

### #1713: [Feature Request] Pass webpack obj as the second parameter when calling webpackConfigHook

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1713 |
| **State** | OPEN |
| **Author** | JCMais (Jonathan Cardoso) |
| **Created** | 2025-05-10 22:47:20.000 UTC (8 months ago) |
| **Updated** | 2025-05-10 22:47:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Right now `webpackConfigHook` only receives the current webpack config, which means if we need to use things like `DefinePlugin`, the caller has to import webpack directly. This may cause issues as the caller may wrongly use a webpack version different from the one used by `@temporalio/worker`.

Ideally, we can do something like this:
```ts
webpackConfigHook(config, webpack) {
  // ... do something with webpack, such as 
  config.plugins.push(
      new webpack.DefinePlugin({
          'someValue': {},
      })
  )

  return config
}
```



---

<a id="1710"></a>

### #1710: [Feature Request] Better type inference for `MockActivityEnvironment.run`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1710 |
| **State** | OPEN |
| **Author** | TastyPi (Graham Rogers) |
| **Created** | 2025-05-08 16:58:48.000 UTC (8 months ago) |
| **Updated** | 2025-05-08 16:58:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

This code:

```typescript
async function foo(): Promise<string> {
  return "foo";
}
const result = await new MockActivityEnvironment().run(foo);
result.startsWith("foo");
```

Does not compile with strict types because `result` is inferred to be `unknown` instead of `string`.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Change the signature of `MockActivityEnvironment.run` from:

```typescript
run<P extends any[], R, F extends ActivityFunction<P, R>>(fn: F, ...args: P): Promise<R>;
```

to

```typescript
run<F extends ActivityFunction>(fn: F, ...args: Parameters<F>): ReturnType<F>
```

I've checked this locally and it makes my example infer the type of `result` correctly.



---

<a id="1706"></a>

### #1706: [Bug] MockActivityEnvironment's activityInfo().workflowExecution.runId is not a UUID

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1706 |
| **State** | CLOSED |
| **Author** | TastyPi (Graham Rogers) |
| **Created** | 2025-05-07 11:02:50.000 UTC (8 months ago) |
| **Updated** | 2025-08-19 23:28:25.000 UTC |
| **Closed** | 2025-08-19 23:28:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

I want to generate a UUID deterministically in an Activity ([Slack](https://temporalio.slack.com/archives/C04S80QKB2Q/p1744292722045169)). It works in a real Temporal instance because the `activityInfo().workflowExecution.runId` is a UUID, however the `MockActivityEnvironment` does not generate UUIDs.

I need to know whether the Workflow run ID is always a UUID, and I can depend on that. If so, the `MockActivityEnvironment` should be updated to match that behaviour.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

```typescript
import { activityInfo } from "@temporalio/activity"
import * as uuid from "uuid"

export async myActivity(): Promise<string> {
  const info = activityInfo()
  return uuid.v5(info.activityId, info.workflowExecution.runId)
}
```

Run this activity in a real instance and it works. Run it with `WorkflowTestEnvironment` and it fails with `TypeError: Invalid UUID`.


### Environment/Versions

<!-- Please complete the following information where relevant. -->

`@temporalio/testing`: `1.11.7`




---

<a id="1703"></a>

### #1703: [Feature Request] Complete work on supporting `Client` over `NativeConnection`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1703 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2025-05-01 19:56:26.000 UTC (8 months ago) |
| **Updated** | 2025-07-01 21:10:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

In #1699 we introduced partial support for `Client` over a `NativeConnection`. In particular, the following items still have to be implemented to provide a complete and reliable DX.

- [ ] Add support `OperatorService` and `HealthService`.
- [ ] Add bridge side support for accepting an inbound `AbortSignal`.
- [ ] Add support for missing Core's `Client` options that were meaningless for Worker-only use cases (e.g. `identity` and `retry_config`, anything else?). Double check with what we expose on `Connection` and what is exposed by other SDKs on their own `Client`.
- [ ] Ensure that any existing `Client` test covers both `Connection` and `NativeConnection` use cases.

Using `Client` over `NativeConnection` will be required to support Eager Workflow Start, which means that this usage may become dominant in some environments.




---

<a id="1702"></a>

### #1702: [Bug] Test suite timeout on first run

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1702 |
| **State** | OPEN |
| **Author** | NavaraKoen |
| **Created** | 2025-05-01 15:19:23.000 UTC (8 months ago) |
| **Updated** | 2025-05-01 15:19:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Running a unit test in either Jest / Mocha on a bad internet connection / not-so-nice proxy :)

### Describe the bug

When running a unit test for the first time, it seems that the (latest?) SDK is being downloaded in the background first. The default timeout of mocha / Jest is like 2000ms, which is way less than the 20s timeout that is set for the download itself.
There is no informational message about this download being started, which would be a great debug starter.

In some cases, the download gets corrupted because of the abrupt interrupt. If you increase the jest / mocha timeout to >20s, you'll be able to spot the following message:
```
Failed to start ephemeral server: Temp download file at /var/folders/3w/4_q0ch0n763141t1zb61z_z80000gn/T/temporal-sdk-typescript-1.11.7.downloading not complete after 20 seconds. Make sure another download isn't running for too long and delete the temp file.
```

### Minimal Reproduction

- Pull the 102 project, for example: https://github.com/temporalio/edu-102-typescript-code
- Remove the existing SDK if it already exists
- `npm i` in any solution dir
- Break your internet connection, or throttle it significantly
- Run the test suite for the first time

Without any indication about a download going on - you'll receive a jest / mocha timeout after 2000ms, indicating that some test did not complete.

### Environment/Versions

- OS and processor: Mac M2
- Temporal Version: 1.11.7, temporal cli version 1.2.0 (I guess not relevant here, but putting it down anyways)

### Additional context

My suggestion is to trigger an informational message, but only when the download is required of course. Would have been an immense timesaver for our team, as we are behind a very unfriendly proxy that will block the download every now and then, causing all tests to fail for no apparent reason :)

Thanks in advance!



---

<a id="1697"></a>

### #1697: [Feature Request] Put `temporal-namespace` header on all requests from pure JS client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1697 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-04-29 15:39:47.000 UTC (8 months ago) |
| **Updated** | 2025-05-09 23:07:26.000 UTC |
| **Closed** | 2025-05-09 23:07:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Pure JS client needs to have a gRPC interceptor that takes the `namespace` field out of the request object if present (do not try to use the `namespace` from client options), and if it is present, set the `temporal-namespace` header with that value.

Also include a CI test that only runs for non-forked PRs that runs a very simple workflow against cloud with API key (can see Ruby CI or ask for clarification and I (@cretz) would be happy to help clarify how).

See https://github.com/temporalio/features/issues/475


---

<a id="1696"></a>

### #1696: [Feature Request] Otel exporter error handling

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1696 |
| **State** | OPEN |
| **Author** | cirias |
| **Created** | 2025-04-27 14:45:05.000 UTC (8 months ago) |
| **Updated** | 2025-04-28 02:13:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Temporal SDK silently ignores the error when the upstream exporter fails to export the spans. I ran into a issue that the `RunWorkflow` span is not exported when the upstream gRPC otel exporter was misconfigured (`concurrentLimit` was set to 1). The problem is otel exporter returns the error through the callback function while temporal sdk just ignores it which makes it harder to debug.

- https://github.com/temporalio/sdk-typescript/blob/5ff22f0f7f0ac9ed543bbd5dea3f6205cadafff5/packages/interceptors-opentelemetry/src/worker/index.ts#L86

- https://github.com/open-telemetry/opentelemetry-js/blob/6f753cca7e48466d8dad1ddf372f0e6caa60c256/experimental/packages/otlp-exporter-base/src/otlp-export-delegate.ts#L62

### Describe the solution you'd like

Add an optional callback parameter to the `makeWorkflowExporter`, and just pass it to the upstream exporter as its callback. This is the easiest solution. User will at least have a way to know about the error. We can also have a default implementation for it. Take `SimpleSpanProcessor` as an example, the default can just be [`globalErrorHandler`](https://github.com/open-telemetry/opentelemetry-js/blob/6f753cca7e48466d8dad1ddf372f0e6caa60c256/packages/opentelemetry-sdk-trace-base/src/export/SimpleSpanProcessor.ts#L65).


### Additional context

It will be an API change, but shouldn't be a breaking change, since the new callback parameter will be optional.

I can help to add this if you think this is a good approach. 


---

<a id="1689"></a>

### #1689: [Feature Request] Change get static summary/details on workflow in client to be lazy

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1689 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-04-22 14:15:34.000 UTC (8 months ago) |
| **Updated** | 2025-08-11 23:55:57.000 UTC |
| **Closed** | 2025-08-11 23:55:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Today we eagerly decode these, change to be lazy upon request.


---

<a id="1687"></a>

### #1687: [Bug] Temporal local env cannot be connected in unit tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1687 |
| **State** | OPEN |
| **Author** | eyal-ringwald-orchid |
| **Created** | 2025-04-22 08:48:21.000 UTC (8 months ago) |
| **Updated** | 2025-04-22 08:48:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

this is a bug report raised after opening a support issue #11853

During our unit tests we run local env (as part of the beforeAll of a suite) of temporal to run the workflow on the service and those tests became flaky since on the worker initialization the worker could not connect to the new temporal env.

### Describe the bug

the following code got an exception : 
      this.connection = await NativeConnection.connect(connectionOptions);

TransportError: tonic::transport::Error(Transport, ConnectError(ConnectError("tcp connect error", Os { code: 60, kind: TimedOut, message: "Operation timed out" })))            
    120 |         this.options.temporalConfig,
     121 |       );
 > 122 |       this.connection = await NativeConnection.connect(connectionOptions);
           |                         ^
    123 |     }
    124 |     return this.connection;
    125 |   }


the test looks like this : 
this is a sample of the test beforeAll beforeEach afterAll and afterEach , the test basically runs a service with temporal worker and its beforeAll fails on starting up the worker since it does not connect.

beforeAll(async () => {
    const port = await getFreePort();
    originalEndpoint = process.env.TEMPORAL_ENDPOINT;
    process.env.TEMPORAL_ENDPOINT = `localhost:${port}`;
    env = await TestWorkflowEnvironment.createLocal({
      server: { namespace: 'default', port, ui: false },
    });
 })
 beforeEach(async () => {

    jest.clearAllMocks();
    installSpy.mockImplementation();
    getCreationCycleIdSpy = jest
      .spyOn(GetEntitiesUpdatesService.prototype, 'getCreationCycleId')
      .mockResolvedValue({
        [Entities.APPLICATIONS]: creationCycleId,
        [Entities.GROUPS]: creationCycleId,
        [Entities.POLICIES]: creationCycleId,
        [Entities.SERVICE_PRINCIPALS]: creationCycleId,
        [Entities.USERS]: creationCycleId,
      });

    getAppsByIdsSpy = jest
      .spyOn(
        InitIntegrationForSpecificIdsService.prototype,
        'getAppsByIds',
      )
      .mockResolvedValue({
        dataPersistentResult: {
          failed: [
            { entityName: '1', id: '1', success: false },
            { entityName: '2', id: '2', success: false },
          ],
          originalNumberOfPayloads: 3,
          success: [{ entityName: '3', id: '3', success: true }],
        },
      });
   ....

    const module: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();
    app = module.createNestApplication();
    await app.init();
  });

  afterEach(async () => {
    await app?.close();
    })

  afterAll(async () => {
    process.env.TEMPORAL_ENDPOINT = originalEndpoint;
    await env?.teardown();
  });


### Minimal Reproduction

this is not reproducible in simple test , but only when a large set of suites running together. we run the jest tests in band for the service. it smells that the number of tests is the cause for the issue so it might be related to resources issue.
we have around 10 suites that running such tests with same pattern of running the local env in each suite.

### Environment/Versions

- OS and processor: Apple M3 Pro sequia 15.3.2
- Temporal Version: 1.11.3
- Are you using Docker or Kubernetes or building Temporal from source? we use packages from npm. our services are deployed on docker in kubernetes , but the issue is about running a test in my development computer.

### Additional context

we use nestjs.
the test does not fail when runing it singularily.
I tried to create the local env for each test as well but it did not help.
we use runInBand option to run the tests sequentially and not in parallel.
as a workaround i was advised  by the support team to do retries until i can connect to the local env. it works.


---

<a id="1680"></a>

### #1680: [Feature Request] Show retry policy on activity info

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1680 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-04-17 12:23:47.000 UTC (8 months ago) |
| **Updated** | 2025-10-01 21:36:02.000 UTC |
| **Closed** | 2025-10-01 21:36:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the solution you'd like**

See https://github.com/temporalio/features/issues/615


---

<a id="1673"></a>

### #1673: [Feature Request] Add support for batched result retrieval executions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1673 |
| **State** | OPEN |
| **Author** | akaNightmare (Ivan) |
| **Created** | 2025-04-10 06:52:30.000 UTC (9 months ago) |
| **Updated** | 2025-04-10 06:52:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Hello,
for some reason need to create the report (CSV) from the ALL workflow execution results, how it looks now:
```ts
async function* fetchWorkflowExecutionResults({ workflowClient, namespace, companyId }) {
  let nextPageToken: Uint8Array | undefined;
  do {
        const workflows = await workflowClient.workflowService.listWorkflowExecutions({
            namespace,
            query: `ExecutionStatus="Completed" AND WorkflowType="createCompanyWorkflow" AND companyId="${companyId}`,
            nextPageToken,
        });
        nextPageToken = workflows.nextPageToken;

        for (const wf of workflows.executions) {
          const result = await workflowClient
                    .getHandle(wf.execution.workflowId, wf.execution.runId)
                    .result();
          yield {
            company_id: result.company_id,
            field1: result.field1,
            field2: result.field2,
            another_field: result.another_field,
          };
        }
  } while (nextPageToken?.byteLength);
}
```
it's working as expected for any amount of the executions, but it takes around ~1min to process 1000 executions, so for 1KK executions -> ~1000 minutes, which is not acceptable for my purposes.

### Describe the solution you'd like
For faster processing, I can chunk workflows.executions (e.g., in batches of 50 or 100) using Promise.all(). However, I'm not sure if this is the correct behavior ‚Äî it might make more sense to add a separate method for this.



---

<a id="1672"></a>

### #1672: [Feature Request] Apply application failure logging and metrics behaviour according to ApplicationErrorCategory

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1672 |
| **State** | CLOSED |
| **Author** | THardy98 (Thomas Hardy) |
| **Created** | 2025-04-09 18:26:35.000 UTC (9 months ago) |
| **Updated** | 2025-05-30 18:53:42.000 UTC |
| **Closed** | 2025-05-30 18:53:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See corresponding features issue:
https://github.com/temporalio/features/issues/614

Will need to wait for core:
https://github.com/temporalio/sdk-core/issues/897

Core-based SDKs only need to apply corresponding logging behaviour, core handles metrics.



---

<a id="1665"></a>

### #1665: Heartbeating activities should be interrupted when the activities are paused.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1665 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2025-04-01 23:43:14.000 UTC (9 months ago) |
| **Updated** | 2025-08-18 19:26:25.000 UTC |
| **Closed** | 2025-08-18 19:26:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | THardy98 |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/features/issues/602


---

<a id="1659"></a>

### #1659: [Feature Request] Support New Worker Versioning API

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1659 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2025-03-24 18:08:42.000 UTC (9 months ago) |
| **Updated** | 2025-05-16 16:42:12.000 UTC |
| **Closed** | 2025-05-16 16:42:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

We need to add annotations to workflows to support the new versioning APIs. Refer to temporalio/features#548 for the Go equivalents.

### Describe the solution you'd like
There are some designs for all SDK languages (including TS) here: https://docs.google.com/document/d/1QGacjnlFwrfFtAvv9besx6sEdr36kJ3zQ9J7bGLRwk4/edit?usp=sharing




---

<a id="1653"></a>

### #1653: [Bug] Broken Documentation Link

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1653 |
| **State** | OPEN |
| **Author** | sdedovic (Stevan Dedovic) |
| **Created** | 2025-03-17 21:01:52.000 UTC (9 months ago) |
| **Updated** | 2025-03-17 21:01:52.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am learning how to build and deploy typescript workers. Some examples use code that has doctoring with broken links. I have been unable to find the documentation anywhere on the docs site. Guidance is appreciated.

### Describe the bug

The following link is in the docstrings: https://docs.temporal.io/typescript/production-deploy#pre-build-code

and it does not resolve. I cannot find any supplemental documentation, but this seems quite important from the code.

This is the code: https://github.com/temporalio/sdk-typescript/blob/main/packages/worker/src/worker-options.ts#L158 

### Minimal Reproduction

Interaface `WorkerOptions`, field `workflowBundle`,

```ts
  /**
     * Use a pre-built bundle for Workflow code. Use {@link bundleWorkflowCode} to generate the bundle. The version of
     * `@temporalio/worker` used when calling `bundleWorkflowCode` must be the exact same version used when calling
     * `Worker.create`.
     *
     * This is the recommended way to deploy Workers to production.
     *
     * See https://docs.temporal.io/typescript/production-deploy#pre-build-code for more information.
     *
     * When using this option, {@link workflowsPath}, {@link bundlerOptions} and any Workflow interceptors modules
     * provided in * {@link interceptors} are not used. To use workflow interceptors, pass them via
     * {@link BundleOptions.workflowInterceptorModules} when calling {@link bundleWorkflowCode}.
     */
    workflowBundle?: WorkflowBundleOption;
```




---

<a id="1647"></a>

### #1647: [Feature Request] Add summary to Nexus operation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1647 |
| **State** | OPEN |
| **Author** | Quinn-With-Two-Ns (Quinn Klassen) |
| **Created** | 2025-03-11 18:41:55.000 UTC (10 months ago) |
| **Updated** | 2025-03-11 18:41:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

https://github.com/temporalio/features/issues/610


---

<a id="1635"></a>

### #1635: [Feature Request] Rehydrate TypedSearchAttributes for sinks or provide WorkflowInfo variant

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1635 |
| **State** | OPEN |
| **Author** | THardy98 (Thomas Hardy) |
| **Created** | 2025-02-28 20:31:45.000 UTC (10 months ago) |
| **Updated** | 2025-02-28 20:31:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Result of discussion in #1612

Relevant comment: https://github.com/temporalio/sdk-typescript/pull/1612#discussion_r1965918825




---

<a id="1634"></a>

### #1634: [Feature Request] Custom metric bucket sizes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1634 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-02-26 19:50:21.000 UTC (10 months ago) |
| **Updated** | 2025-05-05 21:18:42.000 UTC |
| **Closed** | 2025-05-05 21:18:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/606. Need to expose histogram bucket overrides made available in https://github.com/temporalio/sdk-core/pull/844.



---

<a id="1633"></a>

### #1633: [Feature Request] Expose root workflow execution

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1633 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-02-25 14:17:14.000 UTC (10 months ago) |
| **Updated** | 2025-04-28 16:38:17.000 UTC |
| **Closed** | 2025-04-28 16:38:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | THardy98 |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/605, but needs to wait on https://github.com/temporalio/sdk-core/issues/881



---

<a id="1631"></a>

### #1631: [Feature Request] Add error message to OpenTelemetry span setStatus

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1631 |
| **State** | CLOSED |
| **Author** | xavierroma (Xavier Roma) |
| **Created** | 2025-02-24 23:08:15.000 UTC (10 months ago) |
| **Updated** | 2025-02-27 18:17:12.000 UTC |
| **Closed** | 2025-02-27 18:17:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

When using OpenTelemetry with Temporal, error spans only include the error code without the actual error message, making it cumbersome to troubleshoot issues in observability tools.

### Describe the solution you'd like
In file: packages/interceptors-opentelemetry/src/instrumentation.ts
Enhance the `wrapWithSpan` function to include error messages in span status:
```ts
// Current implementation
span.setStatus({ code: otel.SpanStatusCode.ERROR });

// Proposed change
span.setStatus({ code: otel.SpanStatusCode.ERROR, message: err instanceof Error ? err.message : String(err) });
```


---

<a id="1630"></a>

### #1630: [Feature Request] Built-in query responses should use "RawValue"

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1630 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-02-21 20:33:21.000 UTC (10 months ago) |
| **Updated** | 2025-07-31 19:52:46.000 UTC |
| **Closed** | 2025-07-31 19:52:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/604. When #1629 is done, make sure built-in queries return a raw value


---

<a id="1629"></a>

### #1629: [Feature Request] Support "RawValue" non-converted values

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1629 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-02-21 20:27:18.000 UTC (10 months ago) |
| **Updated** | 2025-07-31 19:51:00.000 UTC |
| **Closed** | 2025-07-31 19:51:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | THardy98 |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/603, need a simple payload wrapper that tells converters not to apply conversion.


---

<a id="1626"></a>

### #1626: Expose Workflow cancel cause/reason

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1626 |
| **State** | OPEN |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2025-02-11 20:44:20.000 UTC (11 months ago) |
| **Updated** | 2025-02-11 20:44:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

WorkflowExecutionCancelRequestedEventAttributes has a cause field that should be exposed when workflows receive cancels, and we should additionally expose this as an input when users are issuing cancels from clients or commands


---

<a id="1620"></a>

### #1620: [Feature Request] Support Priority Annotations

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1620 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2025-02-03 18:21:16.000 UTC (11 months ago) |
| **Updated** | 2025-04-18 21:02:36.000 UTC |
| **Closed** | 2025-04-18 21:02:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Is your feature request related to a problem? Please describe.**
Add support for attaching priority to workflows/activities

**Describe the solution you'd like**
See https://github.com/temporalio/features/issues/593 for details



---

<a id="1616"></a>

### #1616: [Feature Request] Add memoization support to the`patched()` API

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1616 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2025-01-29 23:43:01.000 UTC (11 months ago) |
| **Updated** | 2025-01-29 23:43:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

In short:

- Add a `memoized` argument to the `patched` and `deprecatePatch` APIs.

- Keep backward compatibility on those functions for non-specifying the `memoized` argument, but deprecate those signatures. Make sure documentation clearly indicate how existing calls may safely get converted.

- Delegate handling of the `patched` logic to Core.

See temporalio/features#591 for details.


---

<a id="1611"></a>

### #1611: [Feature Request] Allow customization of dev server UI port

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1611 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-01-24 13:27:24.000 UTC (11 months ago) |
| **Updated** | 2025-02-07 23:41:10.000 UTC |
| **Closed** | 2025-02-07 23:41:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/588



---

<a id="1599"></a>

### #1599: [Feature Request] Special behavior for Temporal built-in prefixes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1599 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2025-01-15 13:13:35.000 UTC (11 months ago) |
| **Updated** | 2025-08-01 18:11:29.000 UTC |
| **Closed** | 2025-08-01 18:11:29.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/576


---

<a id="1592"></a>

### #1592: [Bug] Reusable VM allows context leak due to global symbol properties

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1592 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-12-27 19:28:42.000 UTC (1 years ago) |
| **Updated** | 2025-01-24 00:39:36.000 UTC |
| **Closed** | 2025-01-24 00:39:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | ‚ù§Ô∏è 1 |

#### Description

### Describe the bug

When the `reuseV8Context` option is enabled, the logic that swaps global variables in and out for a specific Workflow Execution only look at "regular" properties on `globalThis`, but ignores `symbol` properties. Symbol properties may therefore leak from one Workflow Execution to another.

In a [recent investigation](https://github.com/izakfilmalter/temporal-effect-oom), this was identified as the cause of a memory leak when using [Effect](https://github.com/Effect-TS/effect) in Workflow Code, as Effect was storing its own "global store" as a symbol property on `globalThis`. Though this specific case has just been [fixed on Effect's side](https://github.com/Effect-TS/effect/pull/4196), we recognize that there was nothing wrong in them using global symbol properties this way, and that other libraries are likely to do so. We must therefore ensure that Temporal SDK is able to properly handle global symbol properties.

Huge thanks to @izakfilmalter for his work in preparing a repro project for this issue, capturing heap dumps, and coordinating efforts between Effect's and Temporal's teams, as well as to @mikearnaldi from [Effect](https://github.com/Effect-TS/effect) for his precious collaboration in investigating this through.


---

<a id="1575"></a>

### #1575: [Bug] CI build is broken due to GHA dropping support for node16-based actions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1575 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-11-26 23:01:54.000 UTC (1y 1m ago) |
| **Updated** | 2024-12-03 05:30:59.000 UTC |
| **Closed** | 2024-12-03 05:30:59.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

GitHub Action‚Äôs just started enforcing the long-announced EOL on Node16-based actions. Basically, the latest release of GHA‚Äôs Runner agent ignores the fact that an action is requesting node16, and instead just calls node20 anyway. 

Until now, we were relying on GLIBC 2.24 Docker images or runners in very specific places to ensure that the native artifacts included in our official SDK releases would run on some older Linux distros that some of our customers were still using.

However, given that Node20 is incompatible with GLIBC 2.27 or earlier, this no longer works, and our CI workflows are now failing.


---

<a id="1564"></a>

### #1564: [Feature Request] Expose `AbortController` in Workflow sandbox

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1564 |
| **State** | CLOSED |
| **Author** | lukeramsden (Luke Ramsden) |
| **Created** | 2024-11-15 18:39:58.000 UTC (1y 1m ago) |
| **Updated** | 2024-12-18 20:07:18.000 UTC |
| **Closed** | 2024-12-18 20:07:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

[xstate](https://github.com/statelyai/xstate) is a very useful library for implementing state machines in TypeScript codebases. There is a specific feature that is particularly prudent to my usecase - `fromPromise`. Internally this uses an `AbortController` as part of it's implementation (see [here](https://github.com/statelyai/xstate/blob/65088b6a595a0c69f312fec5f91916e1dbc81b46/packages/core/src/actors/promise.ts#L184)). In the same vein as #1550, I have a patch locally that exposes AbortController to the vm sandbox, and everything seems to work fine (at least for my usage of xstate currently). From reading [the docs](https://nodejs.org/api/globals.html#class-abortcontroller) this seems like a perfectly safe API to expose to the sandbox.

### Describe the solution you'd like

Expose `AbortController` to the worker workflow sandbox.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1549"></a>

### #1549: [Feature Request] Auto-skip time in time-skipping testing environment when waiting on update result

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1549 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-10-21 16:30:16.000 UTC (1y 2m ago) |
| **Updated** | 2024-12-17 21:16:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

We auto-skip time when waiting on workflow result, we need to do the same when waiting on update result. See https://github.com/temporalio/features/issues/551.


---

<a id="1542"></a>

### #1542: [Feature Request] Allow Update Validators to be async

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1542 |
| **State** | OPEN |
| **Author** | mloffer (Micah Loffer) |
| **Created** | 2024-10-09 00:22:40.000 UTC (1y 3m ago) |
| **Updated** | 2024-10-09 00:22:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

I would like to be able to use async operations inside of [Update Validators](https://docs.temporal.io/develop/typescript/message-passing#updates).

#### Use Case
I need to check complex access controls via a database query (e.g. state of an object in the database; ACL/ABAC/etc), and return an error to the caller if not allowed.

### Describe the solution you'd like

Asynchronous Update Validators.

### Additional context

While the Temporal documentation is fairly clear that Validators must be synchronous, there still seems to be a reasonable expectation that any and everything can be async, as demonstrated by this line in the [temporalio/samples-typescript](https://github.com/temporalio/samples-typescript/blob/486d428b2b56701e7eaa976e40dc55f3abc25c79/message-passing/safe-message-handlers/src/workflows.ts#L30) repo. I originally copied this pattern before discovering that Temporal treats async validators as though they are Activities, i.e. logging them to the Workflow Event History and not returning errors to the caller. (So if this feature request is rejected, that code should at least be updated so as not to be misleading.)

#### Alternatives
I can convert my access control validators (or anything else that requires async logic) to Activities and call them from their respective Update handlers. However, this will litter the Workflow Event History with largely irrelevant information, and will also require additional logic to poll the Workflow for the result of the access control Activity to see if the Update was even allowed.


---

<a id="1536"></a>

### #1536: [Bug] Worker keeps accepting WFT after Worker Thread terminates due to ERR_WORKER_OUT_OF_MEMORY

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1536 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-09-26 16:27:41.000 UTC (1y 3m ago) |
| **Updated** | 2024-10-17 16:58:13.000 UTC |
| **Closed** | 2024-10-17 16:58:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Describe the bug

A user reported the following sequence of events:

- They have a TS Workflow Worker running normally;
- At some point, they get the following ERROR-level log message: `{ code:"ERR_WORKER_OUT_OF_MEMORY" }`.
- After that point, it appears that the Worker is no longer making any progress on pending Workflow Tasks, despite the fact that the Worker process is still running.
- From the Server side, metrics indicate a considerable increase in calls to `PollWorkflowExecutionHistory` and a considerable reduction in calls to `PollWorkflowTaskQueue`. Provided data doesn't allow identifying the exact provenance of those calls (they normally operate ~12 active Workers on that NS).
- The situation continues until the Worker process is restarted, after which Workflow progress resumes.

### Analysis

`ERR_WORKER_OUT_OF_MEMORY` is an error from Node itself. That means that Node terminated a Worker Thread due to running out of memory.

Given the symptoms, it is sensible to assume that the Worker Thread killed by Node would be the Workflow Worker Thread, which means the Temporal Worker will no longer be able to process incoming Workflow Task.

What happens next is not clear, but the correct behavior would be for the Worker to initiate shutdown. There‚Äôs very little we can do at that point, but at least, let‚Äôs not pretend that everything‚Äôs all right. Should probably print a clear CRITICAL level message to the log, and terminate the process ASAP.


---

<a id="1533"></a>

### #1533: [Bug] NDE while replaying Workflows in 1.11.1 with same code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1533 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-09-24 16:44:10.000 UTC (1y 3m ago) |
| **Updated** | 2024-09-25 01:10:47.000 UTC |
| **Closed** | 2024-09-25 01:10:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Describe the bug

Using TS SDK 1.11.0 and 1.11.1, some Workflows may result in NDE on replay, even though there's been no change to Workflow Code.

The NDE will generally involves:
 
    A TimerCanceled command; or
    A change in the ordering of some commands.



---

<a id="1532"></a>

### #1532: Show update handler and ID in logging context

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1532 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-09-24 16:37:39.000 UTC (1y 3m ago) |
| **Updated** | 2025-01-10 21:20:16.000 UTC |
| **Closed** | 2025-01-10 21:20:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/features/issues/466 for more details


---

<a id="1512"></a>

### #1512: [Bug] Payload converter error can crash worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1512 |
| **State** | OPEN |
| **Author** | ikonst (Ilya Priven) |
| **Created** | 2024-09-11 18:55:27.000 UTC (1y 3m ago) |
| **Updated** | 2024-09-11 18:55:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Use the EJSON payload converter to serialize all my payload (including error details) without risking my workers crashing.

**Why?** I'm using `ApplicationError`'s `details` to marshal exceptions from activity to workflow. Sometimes due to our own bugs and inattentiveness, we'd try to pass arbitrary objects (non necessarily JSONfiable) as the "details".

### Describe the bug

I've used the EJSON payload converter almost verbatim in my code. The converter throws an error when the payload cannot be converted (due to unknown type, cyclic JSON etc.):
```ts
throw new UnsupportedEjsonTypeError(
  `Can't run EJSON.stringify on this value: ${value}. Either convert it (or its properties) to EJSON-serializable values (see https://docs.meteor.com/api/ejson.html ), or create a custom data converter. EJSON.stringify error message: ${
    errorMessage(
      e,
    )
  }`,
  e as Error,
);
```

If this occurs when converting an activity's response, no harm done since this will be caught by the try-catch that's responsible for catching all of the activity's errors.

However, if this happens when encoding e.g. the `details` of an `ApplicationError`, this error will escape the `Worker.run` and effectively crash the worker.

### Minimal Reproduction

From your activity:
```
const cyclic: any = {};
cyclic["self"] = cyclic;
throw ApplicationFailure.create({
  message: "some error",
  type: "SomeError",
  nonRetryable: true,
  details: [cyclic],
});
```

### Environment/Versions

Version 1.9.3


---

<a id="1511"></a>

### #1511: [Feature Request] Update Core SDK: expect `initializeWorkflow` instead of `startWorkflow` jobs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1511 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-09-10 19:47:32.000 UTC (1y 4m ago) |
| **Updated** | 2024-09-12 19:03:31.000 UTC |
| **Closed** | 2024-09-12 19:03:31.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Description

Core recently renamed the `startWorkflow` activation job to `initializeWorkflow`, with a different ordering and expectations (see [Core's PR](https://github.com/temporalio/sdk-core/pull/789)). We need to update activation handling logic. 


---

<a id="1495"></a>

### #1495: [Bug] Reenable OTLP export tests

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1495 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-08-14 15:27:59.000 UTC (1y 4m ago) |
| **Updated** | 2025-05-05 21:18:41.000 UTC |
| **Closed** | 2025-05-05 21:18:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

- [Two of our TS integration tests](https://github.com/temporalio/sdk-typescript/blob/56207d8bb19e813e405a9530eed1dc44b6d8466a/packages/test/src/test-otel.ts#L65-L229) for Core OTLP metrics exports have recently started being extremely noisy (warnings: `OpenTelemetry metrics error occurred. Metrics exporter otlp failed with the grpc server returns error (Internal error): , detailed error message: Missing response message.`). Those tests are using a bare HTTP2 server to grossly emulate a OTLP collector grpc-service. Due to a recent update to Core (maybe to one of its underlying dependencies), the OTLP emitter now reports failure to get a proper grpc response form the collector service.

- These error messages have coincided with one case where our integration tests completely hanged in CI (I stopped them after 3.5 hours), though I don't know at this point either there is an actual connection between the these two symptoms.

- Until we can rewrite those tests to use a more convincing mock collector, I have disabled those tests.


---

<a id="1486"></a>

### #1486: Review use of `untrackPromise` in update implementation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1486 |
| **State** | OPEN |
| **Author** | dandavison (Dan Davison) |
| **Created** | 2024-08-06 16:00:11.000 UTC (1y 5m ago) |
| **Updated** | 2024-08-06 16:06:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See e.g. https://github.com/temporalio/sdk-typescript/pull/1459#discussion_r1705660588 and https://github.com/temporalio/sdk-typescript/pull/1459#discussion_r1705654386


---

<a id="1479"></a>

### #1479: [Bug] Nightly Stress CI is failing consistently

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1479 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-07-30 16:41:56.000 UTC (1y 5m ago) |
| **Updated** | 2024-08-05 13:50:16.000 UTC |
| **Closed** | 2024-08-05 13:50:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Describe the bug

Nightly Stress CI have been failing consistently for the last two months. This appears to be due to a server-side issue (specific to in-memory sqlite database).

We need that job to be reliable so that we can detect performance regressions in SDK.


---

<a id="1476"></a>

### #1476: [Bug] Reusable VM allows context leak due to global variable reassignment

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1476 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-07-24 19:39:06.000 UTC (1y 5m ago) |
| **Updated** | 2025-01-24 00:39:36.000 UTC |
| **Closed** | 2025-01-24 00:39:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

### Describe the bug

When the `reuseV8Context` option is enabled, we freeze global objects to prevent modifications from leaking from one Workflow execution context to another one.

However, we do not prevent reassignment of global variables. And since context switching is based solely on global variable names, the engine will leave those reassigned global variable untouched.

For example, the following test fails:

```
export async function sharedGlobalReassignment(): Promise<[string, string]> {
  type ConsoleExtended = Console & { wfid: string };
  globalThis.console = { ...console, wfid: workflowInfo().workflowId } as ConsoleExtended;
  await sleep(1);
  return [workflowInfo().workflowId, (console as ConsoleExtended).wfid];
}

test('Shared global state', withReusableContext, async (t) => {
  const { createWorker, taskQueue, env } = t.context;
  const worker = await createWorker();
  await worker.runUntil(async () => {
    const [res1, res2] = await Promise.all([
      env.client.workflow.execute(sharedGlobalReassignment, { taskQueue, workflowId: randomUUID() }),
      env.client.workflow.execute(sharedGlobalReassignment, { taskQueue, workflowId: randomUUID() }),
    ]);
    t.deepEqual(res1[0], res1[1]);
    t.deepEqual(res2[0], res2[1]);
  });
});
```

Deleting a global variable also fails, as the variable "reappears" on the next context switch. For example, the following test fails:

```
export async function globalMutatorAndDestructor(): Promise<number> {
  const global = globalThis as { a?: number };
  global.a = (global.a || 0) + 1;
  await sleep(1);
  delete global.a;
  await sleep(1);
  global.a = (global.a || 0) + 1;
  return global.a;
}

test('Set then Delete a global property', withReusableContext, async (t) => {
  const { createWorker, taskQueue, env } = t.context;
  const worker = await createWorker();
  await worker.runUntil(async () => {
    const res = await env.client.workflow.execute(globalMutatorAndDestructor, { taskQueue, workflowId: randomUUID() });
    t.is(res, 1);
  });
});
```



---

<a id="1475"></a>

### #1475: [Feature Request] Support schedule search attribute update

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1475 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-07-24 19:24:19.000 UTC (1y 5m ago) |
| **Updated** | 2025-03-19 17:59:51.000 UTC |
| **Closed** | 2025-03-19 17:59:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/512 and the Go implementation at https://github.com/temporalio/sdk-go/issues/1561



---

<a id="1474"></a>

### #1474: [Bug] Workflows can be constructed in which update handlers do not, but should, execute

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1474 |
| **State** | CLOSED |
| **Author** | dandavison (Dan Davison) |
| **Created** | 2024-07-24 00:02:45.000 UTC (1y 5m ago) |
| **Updated** | 2024-08-14 21:59:20.000 UTC |
| **Closed** | 2024-08-14 21:59:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

If the workflow below is started, and then a signal and an update are sent in the 2nd Workflow task, the workflow exits without the update handler ever being executed. See @bergundy's original comment https://github.com/temporalio/sdk-typescript/pull/1459#pullrequestreview-2184277781

```typescript
export async function workflow(): Promise<string> {
  var numFoos = 0;

  wf.setHandler(fooSignal, () => {
    numFoos++;
  });

  wf.setHandler(fooUpdate, () => {
    numFoos++;
  });

  await wf.condition(() => numFoos > 0);
  return `foos: ${numFoos}`;
}
```

The fix will be to group update activation jobs together with signals here:

 https://github.com/temporalio/sdk-typescript/blob/ce0532f9be2d47db48c00ebbf17a39063ae42753/packages/worker/src/workflow/vm-shared.ts#L314-L317

Fixing this will be backwards incompatible w.r.t. replay of existing workflows, so will need to use an SDK flag.

We did not update that code when we implemented update because core orders the activation jobs and we were planning to eliminate this typescript code, but this decision overlooked the fact that update and signal activation jobs need to be placed into the same batch in order for them all to be executed before giving the chance for an awaitable such as the `workflow.condition()` above to be unblocked.




---

<a id="1472"></a>

### #1472: [Feature Request] Add website documentation for updates

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1472 |
| **State** | OPEN |
| **Author** | Cyberuben (Ruben Rutten) |
| **Created** | 2024-07-22 22:24:40.000 UTC (1y 5m ago) |
| **Updated** | 2024-07-22 22:24:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

The [TypeScript SDK documentation](https://docs.temporal.io/develop/typescript/message-passing) doesn't contain any documentation on how to use updates. The Go, Java, PHP, Python and .NET docs seem to cover this, so I was able to read into some information.

### Describe the solution you'd like

TypeScript documentation to be added, with code snippets on how to use updates.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1471"></a>

### #1471: [Feature Request] Update schedule catchup window default value in documentation

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1471 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-07-22 16:10:38.000 UTC (1y 5m ago) |
| **Updated** | 2024-07-25 21:36:10.000 UTC |
| **Closed** | 2024-07-25 21:36:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Per https://github.com/temporalio/api/pull/308, https://github.com/temporalio/sdk-typescript/blob/9d31dbd6f1bb6f2afa4bc2193365140aca149314/packages/client/src/schedule-types.ts#L44 should now be 1 year.


---

<a id="1470"></a>

### #1470: [Bug] Client should accept responses up to 128MB

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1470 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-07-22 14:23:17.000 UTC (1y 5m ago) |
| **Updated** | 2024-07-25 21:36:10.000 UTC |
| **Closed** | 2024-07-25 21:36:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

#1469 and elsewhere has reported that gRPC inbound message size is limited to 4MB. To match other SDKs, _inbound_ message size limit from server should be 128MB (not to be confused with outbound).


---

<a id="1453"></a>

### #1453: Refactor stack trace queries to use new protos

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1453 |
| **State** | CLOSED |
| **Author** | twin-drill (divy) |
| **Created** | 2024-07-01 20:39:58.000 UTC (1y 6m ago) |
| **Updated** | 2024-07-12 00:55:36.000 UTC |
| **Closed** | 2024-07-12 00:55:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | twin-drill |
| **Milestone** | None |

#### Description

Found in:
https://github.com/temporalio/api/commit/29b1f4eebbf90d5ef034d7cb75b30b6ae0d623ab

Small reminder to refactor TS query protos regarding stack traces -- we have to rename a few objects and fields + add the `internal_code` flag to `FileLocation`s.

Files that need to be changed at first glance:
packages/workflow/src/internals.ts


---

<a id="1447"></a>

### #1447: [Feature Request]  Accept search attributes in dev server startup

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1447 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-06-20 20:32:34.000 UTC (1y 6m ago) |
| **Updated** | 2025-03-19 17:26:45.000 UTC |
| **Closed** | 2025-03-19 17:26:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

See https://github.com/temporalio/features/issues/494. With https://github.com/temporalio/cli/pull/593 deployed, users should be allowed to set search attributes in dev server option that translate to `--search-attribute` calls.



---

<a id="1446"></a>

### #1446: Workflow-friendly concurrency control

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1446 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-06-18 17:14:13.000 UTC (1y 6m ago) |
| **Updated** | 2024-09-04 12:04:34.000 UTC |
| **Closed** | 2024-09-04 12:04:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We need a mechanism for concurrency control (mutex/semaphore) that fits with the language but is reentrant and deterministic within workflow coroutines.  To be used within signal and update handlers and the main workflow coroutine.


---

<a id="1445"></a>

### #1445: Testing

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1445 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-06-18 03:54:57.000 UTC (1y 6m ago) |
| **Updated** | 2024-06-19 15:18:50.000 UTC |
| **Closed** | 2024-06-19 15:18:50.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

testing


---

<a id="1444"></a>

### #1444: Testing

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1444 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-06-18 03:52:59.000 UTC (1y 6m ago) |
| **Updated** | 2024-06-19 15:18:55.000 UTC |
| **Closed** | 2024-06-19 15:18:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

testing


---

<a id="1440"></a>

### #1440: [Bug] Emitted client metrics missing temporal_ prefix

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1440 |
| **State** | CLOSED |
| **Author** | tsurdilo (Tihomir Surdilovic) |
| **Created** | 2024-06-12 15:56:02.000 UTC (1y 7m ago) |
| **Updated** | 2024-06-12 20:02:17.000 UTC |
| **Closed** | 2024-06-12 20:02:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

With TS release 1.10.1
looks like client metrics like request_failure, long_request_failure etc are missing the default temporal_ prefix in the metric name

Request to add this back. Thanks.


---

<a id="1430"></a>

### #1430: [Feature Request] Call Core worker.validate

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1430 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-05-28 12:11:58.000 UTC (1y 7m ago) |
| **Updated** | 2024-06-12 22:59:08.000 UTC |
| **Closed** | 2024-06-12 22:59:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

`validate` added in https://github.com/temporalio/sdk-core/pull/750, make sure to call it on worker start/run and if it errors, error to the user


---

<a id="1420"></a>

### #1420: [Feature Request] Clean API to intentionally fail an activity in long-polling patterns

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1420 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-05-15 19:26:25.000 UTC (1y 7m ago) |
| **Updated** | 2024-05-15 19:26:25.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Description

A common Temporal pattern is to have an activity that periodically polls an external service, and only completing successfully if the external service returned new data. That is, the activity will intentionally fail with a retryable failure if the poll operation returned nothing new. At present, the SDK's activity worker logs each of these intentional activity failures at WARN level, which creates undesirable noise.

It would be nice to have a specific API for activities to "intentionally fail so that the activity task is retried", which would not cause extra logging. This could take the form of a special type of exception, similar to `CompleteAsyncError`, a special return value that could be returned from the activity function, or some function attached to the activity context that would internally throw the exception (similar to how `continueAsNew()` currently works).


---

<a id="1418"></a>

### #1418: [Feature Request] Failures thrown from within the update handler should be able to fail the workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1418 |
| **State** | OPEN |
| **Author** | ThomasBurgess2000 (Thomas Burgess) |
| **Created** | 2024-05-14 04:04:46.000 UTC (1y 8m ago) |
| **Updated** | 2024-05-14 04:04:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Currently it's a bit clumsy to fail a workflow from within an update. You have to set a flag in your updateMethod, and then in the workflow code watch for that flag and throw the failure from there (according to [this post](https://community.temporal.io/t/fail-workflow-form-updatemethod/11441/3) re: the java sdk at least).

### Describe the solution you'd like

`throw ApplicationFailure` should return (or at least have the option to return) `WorkflowFailedError` instead of `WorkflowUpdateFailedError`.

### Additional context

There is a similar issue active in the Java SDK repo: https://github.com/temporalio/features/issues/650



---

<a id="1413"></a>

### #1413: [Feature Request] Warn when runtime can't shutdown due left over `NativeConnection`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1413 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-05-07 00:47:11.000 UTC (1y 8m ago) |
| **Updated** | 2025-05-05 21:18:41.000 UTC |
| **Closed** | 2025-05-05 21:18:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

By API contract, the user is responsible to `close()` `NativeConnection` objects they created explicitly (implicitly created connections are closed when its owner `Worker` is closed).

It is however too easy to forget doing so, and be left wondering why the process isn't completing as expected. With little work, we could emit warn messages when a `NativeConnection` is left opened for a few seconds after completion of the last associated Worker.


---

<a id="1412"></a>

### #1412: [Feature Request] Client replacement in worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1412 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-05-03 20:15:30.000 UTC (1y 8m ago) |
| **Updated** | 2024-05-03 20:20:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Need to be able to replace the worker client with a new client that may be connected with different options (e.g. a new TLS cert). See https://github.com/temporalio/features/issues/11.



---

<a id="1405"></a>

### #1405: [Bug] Check worker code for unsafe type assertions

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1405 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2024-04-30 14:46:22.000 UTC (1y 8m ago) |
| **Updated** | 2024-04-30 14:46:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

There are some places in the SDK where we expect some protobuf fields to be non-null (because the server effectively never return a null value for that field), even though the field isn't technically _guaranteed_ to be non-null. This might result in unexpected errors if the server code's behavior is eventually modified.

We need to review all type assertions, and determine either these assertions are justified, and fix any case where they aren't.


---

<a id="1403"></a>

### #1403: [Feature Request] Make startUpdate users aware that it's synchronous w/ worker

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1403 |
| **State** | CLOSED |
| **Author** | drewhoskins-temporal (Drew Hoskins) |
| **Created** | 2024-04-25 01:45:36.000 UTC (1y 8m ago) |
| **Updated** | 2024-07-09 18:32:16.000 UTC |
| **Closed** | 2024-07-09 18:32:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

See https://github.com/temporalio/features/issues/469
<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

### Describe the solution you'd like

https://github.com/temporalio/sdk-typescript/blob/e41596bf3d78852c342f3f36b4ea21514f133c21/packages/client/src/workflow-client.ts#L162
Shouldn't be optional to pass what you'll wait for.

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->



---

<a id="1395"></a>

### #1395: Expose defaultConnection() method to switch between localhost and cloud based on env

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1395 |
| **State** | CLOSED |
| **Author** | josh-berry (Josh Berry) |
| **Created** | 2024-04-12 23:54:39.000 UTC (1y 9m ago) |
| **Updated** | 2025-10-06 21:10:16.000 UTC |
| **Closed** | 2025-10-06 21:04:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Expose a defaultConnection() method or similar that switches between localhost (default) and cloud based on some environment variable, so that we can use it in the samples repos to allow people to easily run samples in the cloud. See: https://github.com/temporalio/features/issues/454




---

<a id="1380"></a>

### #1380: [Feature Request] Support metric option for using seconds (and other recent core metric changes)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1380 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-03-26 15:17:09.000 UTC (1y 9m ago) |
| **Updated** | 2024-03-27 17:01:32.000 UTC |
| **Closed** | 2024-03-27 17:01:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Need to at least expose `use_seconds_for_duration` option on Prometheus metrics from https://github.com/temporalio/sdk-core/pull/706, may also have to update other things due to changes made by that PR.


---

<a id="1372"></a>

### #1372: [Feature Request] SDK should not return an update handle if the update has not reached the desired state 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1372 |
| **State** | CLOSED |
| **Author** | Quinn-With-Two-Ns (Quinn Klassen) |
| **Created** | 2024-03-06 18:21:49.000 UTC (1y 10m ago) |
| **Updated** | 2024-06-17 16:27:09.000 UTC |
| **Closed** | 2024-06-17 16:27:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

See https://github.com/temporalio/features/issues/432


---

<a id="1367"></a>

### #1367: [Feature Request] API key client option

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1367 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-02-27 15:23:31.000 UTC (1y 10m ago) |
| **Updated** | 2024-04-01 17:11:41.000 UTC |
| **Closed** | 2024-04-01 17:11:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Describe the solution you'd like**

See https://github.com/temporalio/features/issues/426


---

<a id="1359"></a>

### #1359: [Feature request] WorkerStatus does not have numInFlightLocalActivities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1359 |
| **State** | CLOSED |
| **Author** | Irvenae (Irven Aelbrecht) |
| **Created** | 2024-02-15 23:23:48.000 UTC (1y 10m ago) |
| **Updated** | 2024-11-14 23:37:27.000 UTC |
| **Closed** | 2024-11-14 23:37:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I want to determine current load of the worker. We have 3 types of task slots (workflow / activities / local activities) in the worker each with a concurrency limit. However, I have no way of finding out how many concurrent local activities are running.

We have a similar field in WorkerStatus -> numInFlightActivities


---

<a id="1358"></a>

### #1358: [Feature Request] Configurable workflow failure exception types

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1358 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2024-02-12 14:24:42.000 UTC (1y 11m ago) |
| **Updated** | 2025-01-29 16:21:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |
| **Reactions** | üëÄ 2 |

#### Description

### Describe the solution you'd like
See https://github.com/temporalio/features/issues/322




---

<a id="1349"></a>

### #1349: Expose next retry delay on Application Failure in all SDKs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1349 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2024-02-02 22:32:08.000 UTC (1y 11m ago) |
| **Updated** | 2024-06-12 22:57:39.000 UTC |
| **Closed** | 2024-06-12 22:57:39.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We recently added the ability for an activity to specify the next retry delay on failure via a [field on ](https://github.com/temporalio/api/blob/822966d29758cba3462d6f5ff198257fbaa426f6/temporal/api/failure/v1/message.proto#L49).

Expose this in the SDK.



---

<a id="1343"></a>

### #1343: [Feature Request] Prevent overriding of built-in query handlers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1343 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2024-01-17 23:08:15.000 UTC (1y 11m ago) |
| **Updated** | 2025-01-28 21:52:11.000 UTC |
| **Closed** | 2025-01-28 21:52:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Built-in query handlers should not be modified by application code to ensure that, e.g., the temporal UI still works.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

### Describe the solution you'd like

Disable changes to handlers with names starting by `__temporal` and other well known built-in names.


---

<a id="1339"></a>

### #1339: [Bug] Malformed Page for `workflow.Trigger` in TypeScript SDK API Reference

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1339 |
| **State** | CLOSED |
| **Author** | tomwheeler (Tom Wheeler) |
| **Created** | 2024-01-12 20:50:08.000 UTC (1y 12m ago) |
| **Updated** | 2024-01-17 18:28:57.000 UTC |
| **Closed** | 2024-01-17 18:28:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to learn about `workflow.Trigger` by reading the [page](https://typescript.temporal.io/api/classes/workflow.Trigger) in the TypeScript SDK API reference that describes it.

### Describe the bug

The code shown below the **Example** heading contains invalid content (an HTML comment, followed by three backticks and `ts` which is markdown being displayed as a literal string instead of being interpreted as a rendering instruction). Although the rest of that code sample looks OK, nearly everything that follows it is raw markdown. This is illustrated in the screenshot below:

![image](https://github.com/temporalio/sdk-typescript/assets/2183904/3f8987e4-92f6-496f-a2f8-7af2bbc84999)


### Minimal Reproduction

1. View that [page](https://typescript.temporal.io/api/classes/workflow.Trigger) in your browser to observe what I have described. 

### Environment/Versions

Not relevant (not a client-side problem).

### Additional context


---

<a id="1337"></a>

### #1337: [Feature Request] Add workflow update tests to nightly suite

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1337 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2024-01-10 18:12:35.000 UTC (1y 12m ago) |
| **Updated** | 2024-01-10 18:12:35.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We added the feature without running stress tests for it in CI


---

<a id="1306"></a>

### #1306: Add getUpdateHandle

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1306 |
| **State** | CLOSED |
| **Author** | dandavison (Dan Davison) |
| **Created** | 2023-11-28 16:29:11.000 UTC (2y 1m ago) |
| **Updated** | 2023-12-07 22:12:37.000 UTC |
| **Closed** | 2023-12-07 22:12:37.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | dandavison |
| **Milestone** | None |

#### Description

Add `workflowHandle.getUpdateHandle(...)` method to obtain an `UpdateHandle` given update and workflow execution identifiers.

See also https://github.com/temporalio/sdk-python/issues/424


---

<a id="1301"></a>

### #1301: [chore] test: Upgrade the CLI to the latest

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1301 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2023-11-21 18:57:07.000 UTC (2y 1m ago) |
| **Updated** | 2023-11-30 20:37:15.000 UTC |
| **Closed** | 2023-11-30 20:37:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

The test framework is using an old version of the cli to create ephemeral servers during testing, and these servers do not support 
the latest features such as #1300. 


---

<a id="1298"></a>

### #1298: [Feature Request] Support using the pure JS `Connection` to power a `Worker`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1298 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-11-20 20:51:01.000 UTC (2y 1m ago) |
| **Updated** | 2025-07-03 19:18:10.000 UTC |
| **Closed** | 2025-07-01 20:49:36.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Currently the SDK has two separate connection classes:

1. `NativeConnection` which is a JS representation of the Rust client object used to power workers.
2. `Connection` a grpc-js backed object that can only be used to power clients.

This is unnecessarily confusing and is blocking adding features such as:
1. exposing the worker's connection to activity implementations.
2. eager workflow start.

### Describe the solution you'd like

Merge the two classes.

`Connection` is the preferred implementation as it supports grpc interceptors and does not require any native code making it slimmer and better suited for client applications especially in FaaS platforms where the native code what increase the function size and increase cold start times.
Abstracting the Rust client trait takes us a step forward towards compiling Rust Core to WASM, which opens up supporting other JS runtimes with great ease.

### Additional context

Note that the `Connection` class does not record any metrics, that is a prerequisite for this issue.


---

<a id="1289"></a>

### #1289: [Feature Request] Allow manual pagination when listing workflows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1289 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2023-11-13 13:16:21.000 UTC (2y 1m ago) |
| **Updated** | 2023-11-13 13:16:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Users should be able to manually page one at a time if they choose. Some users are using this list to power a UI, but we are hiding the pagination. Python does this by accepting the token on the call if the user wants and providing the token and page information on the response. But this issue doesn't recommend a specific way to do this, just that manual pagination should be possible.


---

<a id="1258"></a>

### #1258: [Feature Request] Provide nicer error messages on TLS CA cert not found errors

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1258 |
| **State** | OPEN |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-10-10 18:05:13.000 UTC (2y 3m ago) |
| **Updated** | 2023-10-10 18:05:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

## Description

At the moment, if root CA certificates are not available locally (ie. running with `-slim` docker images), then the error message is cryptic and inconsistent depending if using client API or worker API, and its not clear for users what they need to do to fix this.

Also, some users are reporting that the documented solution for such cases (eg. install the `ca-certificates` package) is not sufficient in their environment to make Core SDK work.

Example of error message they see:

```
TransportError: tonic::transport::Error(Transport, hyper::Error(Connect, Custom { kind: InvalidData, error: InvalidCertificateData("invalid peer certificate: UnknownIssuer") }))
      at Function.connect (/usr/src/app/node_modules/@temporalio/worker/src/connection.ts:51:15)
```

We should make sure that SDK provides easy to understand error messages whenever that's possible.


---

<a id="1251"></a>

### #1251: [Bug] module is not defined

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1251 |
| **State** | CLOSED |
| **Author** | divmgl (Dexter Miguel) |
| **Created** | 2023-09-21 23:40:36.000 UTC (2y 3m ago) |
| **Updated** | 2023-09-26 16:46:58.000 UTC |
| **Closed** | 2023-09-22 02:20:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I'm trying to run a workflow bundle built by ESBuild with CommonJS format.

### Describe the bug

When I run the Temporal worker, I get this:
```
2023-09-21T23:40:48.516Z [ERROR] Failed to activate workflow {
  runId: 'cb5e8916-3094-4c75-bccc-cf6c174baf9e',
  error: /Users/dimgl/dev/sandbox/packages/temporal/dist/workflows.js:15482
  module.exports = __toCommonJS(entrypoint_exports);
  ^

  ReferenceError: module is not defined
      at ../src/entrypoint.ts:1:0
      at Script.runInContext (node:vm:141:12)
      at VMWorkflowCreator.getContext (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/vm.js:64:21)
      at VMWorkflowCreator.createWorkflow (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/vm.js:33:36)
      at handleRequest (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:42:35)
      at MessagePort.<anonymous> (/Users/dimgl/dev/sandbox/node_modules/.pnpm/@temporalio+worker@1.8.6_esbuild@0.19.2/node_modules/@temporalio/worker/lib/workflow/workflow-worker-thread.js:92:38)
      at [nodejs.internal.kHybridDispatch] (node:internal/event_target:737:20)
      at exports.emitMessage (node:internal/per_context/messageport:23:28),
  workflowExists: false
}
```

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction
```tsx
// dist/workflows.js
var workflows_exports = {};
__export(workflows_exports, {
  sendEmailWorkflow: () => sendEmailWorkflow
});
module.exports = __toCommonJS(workflows_exports);
var import_workflow2 = require("@temporalio/workflow");
```

And is generated by:
```tsx
// esbuild.mjs
await esbuild.build({
  entryPoints: ["src/entrypoint.ts"],
  bundle: true,
  outfile: "dist/workflows.js",
  platform: "node",
  packages: "external",
  sourcemap: "inline",
})
```
### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: macOS M1
- Temporal Version: 1.8
- Are you using Docker or Kubernetes or building Temporal from source? Temporalite.
### Additional context

We haven't fully made the switch yet to ESM, but we're using all of the ESM syntax. We're currently building to CommonJS to avoid the ESM pain. Is there a way to get this working inside of the Temporal TypeScript SDK?

Webpack is a non-starter for us due to the performance, and we can't make the switch to Temporal if it means fiddling with Webpack configuration to make our workflows work with our monorepo.


---

<a id="1247"></a>

### #1247: [Bug] Properties of `WorkflowInfo` and `Activity.Context` should not be mutable by user code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1247 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-09-14 08:48:49.000 UTC (2y 3m ago) |
| **Updated** | 2023-10-17 22:01:04.000 UTC |
| **Closed** | 2023-10-17 22:01:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

The objects returned by the `wf.workflowInfo()` and `act.Context.current()` functions can be mutated at will by user code. Though there might be arguably legitimate use cases for adding _custom_ properties into these objects, it appears undesirable, and even dangerous to allow mutating the value of existing properties.

The consequence of such mutations varies. As an extreme case, workflow code can actually flip the value of `wf.workflowInfo().unsafe.isReplaying`, which results in the `wf.patched()` API function to misbehave.

### Minimal Reproduction

```
export async function asyncActivityWorkflow(): Promise<string> {
  workflowInfo().attempt = 100;
  (workflowInfo() as any).something = 'something';
  
  workflowInfo().unsafe.isReplaying = true;
  if (patched('test')) {
    console.log(`This should be printed at least once`);
  }

  const answer = await completeSomethingAsync();

  console.log(`workflowInfo().attempt: ${workflowInfo().attempt}`);
  console.log(`workflowInfo().something: ${(workflowInfo() as any).something}`);

  return `The Peon says: ${answer}`;
}
```

produce the following output:

```
[asyncActivityWorkflow(activities-examples)] workflowInfo().attempt: 100
[asyncActivityWorkflow(activities-examples)] workflowInfo().something: something
```


---

<a id="1232"></a>

### #1232: [Feature Request] Typed Search Attributes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1232 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-08-31 22:16:50.000 UTC (2y 4m ago) |
| **Updated** | 2025-03-14 03:22:33.000 UTC |
| **Closed** | 2025-03-14 03:22:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | THardy98 |
| **Milestone** | None |

#### Description

Implementation of [typed search attributes](https://github.com/temporalio/proposals/blob/master/all-sdk/sdk-typed-search-attributes.md).


---

<a id="1219"></a>

### #1219: @temporalio/client-1.8.4.tgz: 1 vulnerabilities (highest severity is: 9.8)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1219 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2023-08-22 20:49:40.000 UTC (2y 4m ago) |
| **Updated** | 2023-08-29 17:12:40.000 UTC |
| **Closed** | 2023-08-29 17:12:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>@temporalio/client-1.8.4.tgz</b></p></summary>

<p></p>
<p>

<p>Found in HEAD commit: [9fb84945622c5dd5894a30af2157d4cba771d5d0](https://github.com/temporalio/sdk-typescript/commit/9fb84945622c5dd5894a30af2157d4cba771d5d0)</p></details>

## Vulnerabilities
| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (temporalio/client version) | Remediation Possible** |
|----|----|----|----|----|----|----|
|[CVE-2023-36665](https://www.mend.io/vulnerability-database/CVE-2023-36665) | <img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> Critical | 9.8 | protobufjs-7.2.3.tgz | Transitive | N/A* | &#10060; |

<p>_For some transitive vulnerabilities, there is no version of direct dependency with a fix. Check the "Details" section below to see if there is a version of transitive dependency where vulnerability is fixed.</p><p>_*In some cases, Remediation PR cannot be created automatically for a vulnerability despite the availability of remediation</p>

## Details
<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/critical_vul.png?' width=19 height=20> CVE-2023-36665</summary>

### Vulnerable Library - <b>protobufjs-7.2.3.tgz</b></p>
<p></p>
<p>Library home page: [https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz](https://registry.npmjs.org/protobufjs/-/protobufjs-7.2.3.tgz)</p>
<p>

Dependency Hierarchy:


* @temporalio/client-1.8.4.tgz (Root Library)
  * :x: **protobufjs-7.2.3.tgz** (Vulnerable Library)
<p>Found in HEAD commit: [9fb84945622c5dd5894a30af2157d4cba771d5d0](https://github.com/temporalio/sdk-typescript/commit/9fb84945622c5dd5894a30af2157d4cba771d5d0)</p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

### Vulnerability Details
<p>

protobuf.js (aka protobufjs) 6.10.0 through 7.x before 7.2.4 allows Prototype Pollution, a different vulnerability than CVE-2022-25878. A user-controlled protobuf message can be used by an attacker to pollute the prototype of Object.prototype by adding and overwriting its data and functions. Exploitation can involve: (1) using the function parse to parse protobuf messages on the fly, (2) loading .proto files by using load/loadSync functions, or (3) providing untrusted input to the functions ReflectionObject.setParsedOption and util.setProperty. NOTE: this CVE Record is about "Object.constructor.prototype.<new-property> = ...;" whereas CVE-2022-25878 was about "Object.**proto**.<new-property> = ...;" instead.

<p>Publish Date: 2023-07-05
<p>URL: [CVE-2023-36665](https://www.mend.io/vulnerability-database/CVE-2023-36665)</p>
</p>

<p></p>

### CVSS 3 Score Details (<b>9.8</b>)
<p>

Base Score Metrics:


* Exploitability Metrics:
  * Attack Vector: Network
  * Attack Complexity: Low
  * Privileges Required: None
  * User Interaction: None
  * Scope: Unchanged
* Impact Metrics:
  * Confidentiality Impact: High
  * Integrity Impact: High
  * Availability Impact: High
</p>
For more information on CVSS3 Scores, click [here](https://www.first.org/cvss/calculator/3.0).
</p>

<p></p>

### Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: [https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665](https://www.code-intelligence.com/blog/cve-protobufjs-prototype-pollution-cve-2023-36665)</p>
<p>Release Date: 2023-07-05</p>
<p>Fix Resolution: protobufjs - 7.2.4</p>

</p>

<p></p>

</details>




---

<a id="1185"></a>

### #1185: Bundling raw typescript fails

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1185 |
| **State** | CLOSED |
| **Author** | GauBen (Gautier Ben A√Øm) |
| **Created** | 2023-07-31 16:17:33.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-01 15:55:11.000 UTC |
| **Closed** | 2023-08-01 15:55:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

`Worker.create` does not support bundling ESM written in TypeScript (imports of `.ts` files with `.js`):

**workflows.ts**
```ts
import * from './users/workflows.js'; // This file does not exist
```

**users/workflows.ts**
```ts
export async function workflow() {
  // ...
}
```

```
Module not found: Error: Can't resolve './users/workflows.js' in '<app>'

resolve './users/workflows.js' in '<app>/src'
  using description file: <app>/package.json (relative path:

    Field 'browser' doesn't contain a valid alias configuration
    using description file: <app>/package.json (relative pat

      no extension
        Field 'browser' doesn't contain a valid alias configuration
        <app>/src/users/workflows.js doesn't exist
      .ts
        Field 'browser' doesn't contain a valid alias configuration
        <app>/src/users/workflows.js.ts doesn't exist
      .js
        Field 'browser' doesn't contain a valid alias configuration
        <app>/src/users/workflows.js.js doesn't exist
      as directory
        <app>/src/users/workflows.js doesn't exist
 @ ./src/workflows-autogenerated-entrypoint.cjs 9:9-113

webpack 5.88.2 compiled with 1 error in 1005 ms
```

Current workaround:

```ts
const worker = await Worker.create({
  workflowsPath: require.resolve("./workflows.js"),
  bundlerOptions: {
    webpackConfigHook(config) {
      config.resolve.extensionAlias = { ".js": [".ts", ".js"] }; // Workaround
      return config;
    },
  },
  taskQueue: "app",
  activities,
});
```

Source https://www.npmjs.com/package/resolve-typescript-plugin




---

<a id="1182"></a>

### #1182: [Bug] `Context.current().info.heartbeatTimeoutMs` is undefined

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1182 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-07-29 22:02:20.000 UTC (2y 5m ago) |
| **Updated** | 2023-08-01 15:17:16.000 UTC |
| **Closed** | 2023-08-01 15:17:15.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Minimal Reproduction

<!-- A clear and concise description of what the bug is. -->

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

Repro: https://github.com/temporalio/samples-typescript/tree/timeoutMs
Compare: https://github.com/temporalio/samples-typescript/compare/main...timeoutMs




---

<a id="1174"></a>

### #1174: [Bug] SDK should drop signals for which it cannot decode payloads

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1174 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-07-17 05:56:21.000 UTC (2y 5m ago) |
| **Updated** | 2025-02-07 03:46:34.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

In Go and Java we drop signals whose args can't be deserialized, we should here too. This is likely not considered a backwards incompatible behavior change.




---

<a id="1169"></a>

### #1169: [Bug] ProtobufJSONPayloadConverter needs Buffer to encode/decode binary protobuf fields

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1169 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2023-07-13 05:32:29.000 UTC (2y 6m ago) |
| **Updated** | 2023-07-24 17:35:28.000 UTC |
| **Closed** | 2023-07-24 17:35:28.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug
The workflow context does not have access to the node.js Buffer class, but the 
`proto3-json-serializer` library, used by the ProtobufJSONPayloadConverter, needs it to
convert binary fields to strings with base64 encoding.

The result is that workflows cannot encode/decode protobufs that contain binary data by using this converter. 

### Minimal Reproduction

 See features repo (`features/data_converter/json_protobuf/feature.ts`)

### Environment/Versions
All




---

<a id="1142"></a>

### #1142: [Bug] Binary and protobuf payload converters break Uint8Array type equality

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1142 |
| **State** | CLOSED |
| **Author** | antlai-temporal (Antonio Lain) |
| **Created** | 2023-06-22 00:40:42.000 UTC (2y 6m ago) |
| **Updated** | 2023-06-27 18:19:55.000 UTC |
| **Closed** | 2023-06-27 18:19:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Payload converters run in the workflow context but sometimes return objects, e.g., Uint8Array, that use constructors defined in the node context. This makes comparing objects with 'instanceof' unreliable, breaking some third-party libraries.

Also, some less commonly used converters rely on the Buffer class that is not visible in the workflow context.  

### Minimal Reproduction

See the temporalio/features repo under features/data_converters/{json_protobuf, binary_protobuf, and binary}

### Environment/Versions

All


---

<a id="1139"></a>

### #1139: [Feature Request] TemporalFailure from converters and codecs should be able to fail the workflow not task

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1139 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-06-20 18:47:21.000 UTC (2y 6m ago) |
| **Updated** | 2023-06-20 18:47:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

*No description provided.*


---

<a id="1105"></a>

### #1105: [Bug] `CalendarSpec` components not encoded correctly

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1105 |
| **State** | CLOSED |
| **Author** | florianmorath (Florian Morath) |
| **Created** | 2023-04-21 12:29:28.000 UTC (2y 8m ago) |
| **Updated** | 2023-05-25 19:36:01.000 UTC |
| **Closed** | 2023-05-25 19:36:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Creating a Temporal schedule using the calendar-based specifications of times.

### Describe the bug

When creating a Temporal schedule using the calendar-based specifications of times, there is an issue with the encoding of the input values.
According to the documentation the `dayOfMonth` should accept numbers from 1 to 31 but e.g. input value 21 is rejected with the following error message (https://typescript.temporal.io/api/interfaces/client.CalendarSpec#dayofmonth).

`Error: Invalid CalendarSpec component for field dayOfMonth: '21' of type 'number'`

### Minimal Reproduction

Use the code below in the following sample.
https://github.com/temporalio/samples-typescript/blob/main/schedules/src/start-schedule.ts

```typescript
// https://typescript.temporal.io/api/classes/client.ScheduleClient#create
const schedule = await client.schedule.create({
  action: {
    type: 'startWorkflow',
    workflowType: reminder,
    args: [''],
    taskQueue: 'schedules',
  },
  scheduleId: 'sample-schedule',
  policies: {
    catchupWindow: '1 day',
    overlap: ScheduleOverlapPolicy.ALLOW_ALL,
  },
  spec: {
    calendars: [
      {
        year: 2023,
        month: 'APRIL',
        dayOfMonth: 21, // 21st day of month
        hour: 12,
        minute: 0,
        second: 0,
      },
    ],
  },
});
```

### Environment/Versions

- OS and processor: Apple M2
- Temporal Version: `"@temporalio/client": "^1.7.2"`

### Additional context

Here is a diff that we use to fix the issue.

```diff
diff --git a/node_modules/@temporalio/client/src/schedule-helpers.ts b/node_modules/@temporalio/client/src/schedule-helpers.ts
index 14cddbe..6a5d05a 100644
--- a/node_modules/@temporalio/client/src/schedule-helpers.ts
+++ b/node_modules/@temporalio/client/src/schedule-helpers.ts
@@ -66,7 +66,7 @@ const [encodeMinute, decodeMinue] = makeCalendarSpecFieldCoders(
 
 const [encodeHour, decodeHour] = makeCalendarSpecFieldCoders(
   'hour',
-  (x: number) => (typeof x === 'number' && x >= 0 && x <= 59 ? x : undefined),
+  (x: number) => (typeof x === 'number' && x >= 0 && x <= 23 ? x : undefined),
   (x: number) => x,
   [{ start: 0, end: 0, step: 0 }], // default to 0
   [{ start: 0, end: 23, step: 1 }]
@@ -74,7 +74,7 @@ const [encodeHour, decodeHour] = makeCalendarSpecFieldCoders(
 
 const [encodeDayOfMonth, decodeDayOfMonth] = makeCalendarSpecFieldCoders(
   'dayOfMonth',
-  (x: number) => (typeof x === 'number' && x >= 0 && x <= 6 ? x : undefined),
+  (x: number) => (typeof x === 'number' && x >= 0 && x <= 31 ? x : undefined),
   (x: number) => x,
   [{ start: 1, end: 31, step: 1 }], // default to *
   [{ start: 1, end: 31, step: 1 }]

```


---

<a id="1092"></a>

### #1092: [Bug] Make `ScheduleUpdateOptions.action.workflowId` optional

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1092 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-03-31 23:13:33.000 UTC (2y 9m ago) |
| **Updated** | 2023-07-19 13:14:45.000 UTC |
| **Closed** | 2023-07-19 13:14:45.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Right now it's optional in `ScheduleOptionsStartWorkflowAction` but not in `ScheduleUpdateOptions`

https://typescript.temporal.io/api/namespaces/client#scheduleoptionsstartworkflowaction

![image](https://user-images.githubusercontent.com/251288/229248423-b38a6ec3-2580-4ed0-a0bf-0f4f702050a2.png)



---

<a id="1088"></a>

### #1088: [Bug] create-project cli doesn't take into account subdirectories when replacing node version

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1088 |
| **State** | CLOSED |
| **Author** | jhubbardsf (Josh Hubbard) |
| **Created** | 2023-03-30 20:37:42.000 UTC (2y 9m ago) |
| **Updated** | 2023-03-31 22:52:54.000 UTC |
| **Closed** | 2023-03-31 22:52:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?
Have the create-project cli work as intended (replace tsconfig/nodeX with whatever current version of node you're running).

### Describe the bug
If you create a sample project with node 18 that has subdirectory packages, like the monorepo example, it doesn't update tsconfig or package.json files properly.

### Minimal Reproduction
1. Clone this repository. 
2. Build. 
3. Run ./packages/create-project/cli.js and pick monorepo-folders.
4. Check to see if tsconfig.json or package.json files were updated correctly for node18.



---

<a id="1071"></a>

### #1071: [Feature Request] Add missing `repository` field to e.g. `@temporalio/activity`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1071 |
| **State** | CLOSED |
| **Author** | mcmxcdev (MCMXC) |
| **Created** | 2023-03-06 05:54:06.000 UTC (2y 10m ago) |
| **Updated** | 2023-03-31 20:14:09.000 UTC |
| **Closed** | 2023-03-31 20:14:09.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

I started using https://github.com/sandworm-hq/sandworm-audit and it detected the following issues in the temporalio monorepo:

```
üü° @temporalio/activity@1.6.0 Has no repository
üü° @temporalio/client@1.6.0 Has no repository
üü° @temporalio/common@1.6.0 Has no repository
üü° @temporalio/proto@1.6.0 Has no repository
üü° @temporalio/workflow@1.6.0 Has no repository
```

### Describe the solution you'd like

This should be easy to solve by providing a `repository` config to the `package.json` of each package.


---

<a id="1064"></a>

### #1064: [Feature Request] Return well-formed error OR success if Worker.runReplayHistories receives no histories

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1064 |
| **State** | CLOSED |
| **Author** | rupalivohra (Rupali Vohra) |
| **Created** | 2023-02-24 01:27:59.000 UTC (2y 10m ago) |
| **Updated** | 2023-03-02 22:10:46.000 UTC |
| **Closed** | 2023-03-02 22:10:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->
Today, it looks like if I pass a `histories` AsyncIterable that yields no results, I get an error like the one below, rather than one with a clear error code that I could catch/handle. Given that the goal is to find determinism errors, and that there wouldn't be any determinism errors if there are no histories, I question whether this should throw an error at all.

```
Error
    at _super (path/to/node_modules/rxjs/src/internal/util/createErrorClass.ts:13:22)
    at new EmptyErrorImpl (path/to/node_modules/rxjs/src/internal/util/EmptyError.ts:26:3)
    at Object.complete (path/to/node_modules/rxjs/src/internal/lastValueFrom.ts:71:18)
    at ConsumerObserver.complete (path/to/node_modules/rxjs/src/internal/Subscriber.ts:185:25)
    at SafeSubscriber.Subscriber._complete (path/to/node_modules/rxjs/src/internal/Subscriber.ts:132:24)
    at SafeSubscriber.Subscriber.complete (path/to/node_modules/rxjs/src/internal/Subscriber.ts:106:12)
    at checkComplete (path/to/node_modules/rxjs/src/internal/operators/mergeInternals.ts:48:18)
    at path/to/node_modules/rxjs/src/internal/operators/mergeInternals.ts:140:7
    at OperatorSubscriber._this._complete (path/to/node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts:92:13)
    at OperatorSubscriber.Subscriber.complete (path/to/node_modules/rxjs/src/internal/Subscriber.ts:106:12)
    at path/to/node_modules/rxjs/src/internal/observable/innerFrom.ts:131:14
    at step (path/to/node_modules/rxjs/dist/cjs/internal/observable/innerFrom.js:33:23)
    at Object.next (path/to/node_modules/rxjs/dist/cjs/internal/observable/innerFrom.js:14:53)
    at fulfilled (path/to/node_modules/rxjs/dist/cjs/internal/observable/innerFrom.js:5:58)
    at processTicksAndRejections (node:internal/process/task_queues:96:5) {
  message: 'no elements in sequence'
```

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->
Suppose I get histories like this:
```typescript
const query = `WorkflowType="${workflowType}" and ExecutionStatus = 'Running'
    ORDER BY StartTime ASC`;
const workflowList = this.workflowClient.list({
    query,
    pageSize: 50,
});
const histories = workflowList.intoHistories({ concurrency: 10 });
```

and call the replayer like this:
```typescript
const replayResults = await Worker.runReplayHistories(
    {
      workflowBundle,
      sinks,
      failFast: false, // can toggle to true if replay is slow, but will need to catch error
    },
    histories
);
```

If the # of `histories` returned from the query above happens to be 0, I'd like for the replay to succeed.
If there are reasons why the replayer should fail, I'd like for there to be a specific error code that I could handle from the `await Worker.runReplayHistories()` call.

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

n/a



---

<a id="1054"></a>

### #1054: Add `TelemetryOptions.logging` object format to API ref

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1054 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-02-12 19:34:56.000 UTC (2y 11m ago) |
| **Updated** | 2025-02-07 03:50:23.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | documentation |
| **Assignees** | None |
| **Milestone** | None |

#### Description

https://typescript.temporal.io/api/interfaces/worker.TelemetryOptions#logging

Currently it's just `Object`:

![](https://user-images.githubusercontent.com/251288/218332978-3dc84f54-1fac-41de-be1a-8ac427681c90.png)




---

<a id="1051"></a>

### #1051: [Feature Request] Retain type information for signal/query `_Args`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1051 |
| **State** | CLOSED |
| **Author** | josiah-roberts (Josiah "Rebase" Roberts) |
| **Created** | 2023-02-10 23:09:49.000 UTC (2y 11m ago) |
| **Updated** | 2023-02-23 05:27:02.000 UTC |
| **Closed** | 2023-02-23 05:27:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Everything here also applies to `QueryDefinition`, but I'll use `SignalDefinition` in these examples.

Because `SignalDefinition<Args>` does not use `_Args` in the resulting type, and because TypeScript is structurally typed, certain absurdities can arise. For example, the fact that a `SignalDefinition<[string]>` is a `SignalDefinition<[number]>`. The following is legal TS:

```typescript
function sendNumberSignal(s: SignalDefinition<[number]>, n: number) {
  // workflowHandle.signal(s, n)
}

const stringSignal = defineSignal<[string]>('some name');
sendNumberSignal(stringSignal, 21);
```

This creates some real problems when trying to perform type algebra or do higher-order reasoning about signal and query types for helpers and utility functions.

### Describe the solution you'd like

This issue can be fixed by no longer discarding the `<_Args>` type parameter, and instead using a virtual [type brand](https://medium.com/@KevinBGreene/surviving-the-typescript-ecosystem-branding-and-type-tagging-6cf6e516523d) to preserve the information within the type system.

This brand doesn't exist at run-time, and since the symbol is not exported it is not possible for consumers to access the "virtual" property.

`SignalDefinition` becomes:
```typescript
declare const argsBrand: unique symbol;
export interface SignalDefinition<Args extends any[] = []> {
  type: 'signal';
  [argsBrand]: Args;
}
```

And `defineSignal` becomes:
```typescript
export function defineSignal<Args extends any[] = [], Name extends string = string>(name: Name): SignalDefinition<Args, Name> {
  return {
    type: 'signal',
    name,
  } as SignalDefinition<Args, Name>;
}
```

Having made these changes, `SignalDefinition<[string]>` is no longer assignable to `SignalDefinition<[number]>`, and type-level logic over the arg types of symbols becomes possible.



---

<a id="1022"></a>

### #1022: [Bug] Schedule client does not infer args based on workflow type

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1022 |
| **State** | CLOSED |
| **Author** | mjameswh (James Watkins-Harvey) |
| **Created** | 2023-01-11 18:32:53.000 UTC (2y 12m ago) |
| **Updated** | 2023-01-13 03:43:04.000 UTC |
| **Closed** | 2023-01-13 03:43:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

<img width="320" alt="image" src="https://user-images.githubusercontent.com/6412169/211881665-17033439-158b-43dc-8bee-48903c796645.png">

This behaviour is observed both on schedule `create` and `update`.


---

<a id="1020"></a>

### #1020: [Feature Request] Start workers in debug mode if `TEMPORAL_DEBUG` env var is set

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1020 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2023-01-11 01:08:16.000 UTC (2y 12m ago) |
| **Updated** | 2023-01-23 23:46:07.000 UTC |
| **Closed** | 2023-01-23 23:46:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

I don't love that the use of env vars in libraries but I'd rather support this for consistency with the other SDKs.


---

<a id="1010"></a>

### #1010: Validate single version of packages

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1010 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2023-01-03 03:02:38.000 UTC (3 years ago) |
| **Updated** | 2025-02-07 03:50:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.
<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Users run into errors when they accidentally have multiple versions of our packages installed, [for example this](https://temporalio.slack.com/archives/C01DKSMU94L/p1652818373741859?thread_ts=1652817509.439369&cid=C01DKSMU94L).

### Describe the solution you'd like
Roey: 

* we should add some validation for this, e.g. export the version from worker-interface.ts and check on the worker side
* We should also verify in the workflow context that only 1 version of @temporalio/workflow is imported




---

<a id="1005"></a>

### #1005: [Feature Request] Add `workflowInfo().startTime`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/1005 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-12-21 02:26:22.000 UTC (3 years ago) |
| **Updated** | 2023-01-23 23:46:10.000 UTC |
| **Closed** | 2023-01-23 23:46:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

https://github.com/temporalio/sdk-typescript/blob/bf4ccdf3c7baae544297d19d66cf047957eedbdb/packages/workflow/src/interfaces.ts#L84-L88

Exposed in https://github.com/temporalio/sdk-core/pull/416


---

<a id="988"></a>

### #988: ava-3.15.0.tgz: 1 vulnerabilities (highest severity is: 5.3)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/988 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-12-06 13:53:21.000 UTC (3y 1m ago) |
| **Updated** | 2022-12-14 20:42:40.000 UTC |
| **Closed** | 2022-12-14 20:42:40.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>ava-3.15.0.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /packages/test/package.json</p>
<p>Path to vulnerable library: /node_modules/package-json/node_modules/got/package.json,/packages/docs/node_modules/got/package.json,/packages/test/node_modules/got/package.json</p>
<p>


<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/510c533ca4f0257a52f2fc558366e561fe0b0d73">510c533ca4f0257a52f2fc558366e561fe0b0d73</a></p></details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in (ava version) | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | ------------- | --- |
| [CVE-2022-33987](https://www.mend.io/vulnerability-database/CVE-2022-33987) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | got-9.6.0.tgz | Transitive | 4.0.0 | &#9989; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-33987</summary>


###  Vulnerable Library - <b>got-9.6.0.tgz</b></p>

<p>Simplified HTTP requests</p>
<p>Library home page: <a href="https://registry.npmjs.org/got/-/got-9.6.0.tgz">https://registry.npmjs.org/got/-/got-9.6.0.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/package-json/node_modules/got/package.json,/packages/docs/node_modules/got/package.json,/packages/test/node_modules/got/package.json</p>
<p>

Dependency Hierarchy:
  - ava-3.15.0.tgz (Root Library)
    - update-notifier-5.1.0.tgz
      - latest-version-5.1.0.tgz
        - package-json-6.5.0.tgz
          - :x: **got-9.6.0.tgz** (Vulnerable Library)
<p>Found in HEAD commit: <a href="https://github.com/temporalio/sdk-typescript/commit/510c533ca4f0257a52f2fc558366e561fe0b0d73">510c533ca4f0257a52f2fc558366e561fe0b0d73</a></p>
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The got package before 12.1.0 (also fixed in 11.8.5) for Node.js allows a redirect to a UNIX socket.

<p>Publish Date: 2022-06-18
<p>URL: <a href=https://www.mend.io/vulnerability-database/CVE-2022-33987>CVE-2022-33987</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: Low
  - Availability Impact: None
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-33987</a></p>
<p>Release Date: 2022-06-18</p>
<p>Fix Resolution (got): 12.2.0</p>
<p>Direct dependency fix Resolution (ava): 4.0.0</p>

</p>

<p></p>


:rescue_worker_helmet: Automatic Remediation is available for this issue
</details>

***

<p>:rescue_worker_helmet: Automatic Remediation is available for this issue.</p>


---

<a id="984"></a>

### #984: [Bug] Module '"@temporalio/workflow"' has no exported member 'proxyActivities'.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/984 |
| **State** | CLOSED |
| **Author** | irohitb (Rohit Bhatia) |
| **Created** | 2022-12-02 05:16:10.000 UTC (3y 1m ago) |
| **Updated** | 2022-12-02 14:52:17.000 UTC |
| **Closed** | 2022-12-02 14:52:17.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

import `proxyActivities`

### Describe the bug

Module '"@temporalio/workflow"' has no exported member 'proxyActivities'.

### Minimal Reproduction

import { proxyActivities } from '@temporalio/workflow';

### Environment/Versions


- OS and processor: M1 Pro Mac,
- Temporal Version: Node version 0.17.1
- Using docker





---

<a id="967"></a>

### #967: Context deadline exceeded on test `schedules > Can update schedule action`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/967 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-11-13 22:05:55.000 UTC (3y 1m ago) |
| **Updated** | 2023-01-25 21:51:12.000 UTC |
| **Closed** | 2023-01-25 21:51:12.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

[build-and-test (14, ubuntu-latest)](https://github.com/temporalio/sdk-typescript/actions/runs/3457023156/jobs/5770175142#logs)

```
@temporalio/test:   schedules ‚Ä∫ Can update schedule action
@temporalio/test:   Rejected promise returned by test. Reason:
@temporalio/test:   ServiceError {
@temporalio/test:     cause: Error {
@temporalio/test:       code: 4,
@temporalio/test:       details: 'context deadline exceeded',
@temporalio/test:       metadata: Metadata {
@temporalio/test:         internalRepr: Map { ‚Ä¶ },
@temporalio/test:         options: {},
@temporalio/test:       },
@temporalio/test:       message: '4 DEADLINE_EXCEEDED: context deadline exceeded',
@temporalio/test:     },
@temporalio/test:     message: 'Failed to describe schedule',
@temporalio/test:   }
@temporalio/test:   ‚Ä∫ ScheduleClient.rethrowGrpcError (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:508:13)
@temporalio/test:   ‚Ä∫ ScheduleClient._describeSchedule (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:278:12)
@temporalio/test:   ‚Ä∫ Object.describe (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:413:21)
@temporalio/test:   ‚Ä∫ Object.update (/home/runner/work/sdk-typescript/sdk-typescript/packages/client/src/schedule-client.ts:450:25)
@temporalio/test:   ‚Ä∫ src/test-schedules.ts:324:7
```


---

<a id="962"></a>

### #962: [Feature Request] Allow creating patches before the workflow has started

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/962 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-11-10 21:30:44.000 UTC (3y 2m ago) |
| **Updated** | 2022-11-10 21:30:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

With the current sandbox approach we apply patch notifications before user code is evaluated which means we could technically remove this restriction.
One thing to consider is that we won't be able to add interception capabilities to patch calls if we allow top level (static) patches.


---

<a id="953"></a>

### #953: [Bug] `connectTimeout` ignored when provisioning client connection

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/953 |
| **State** | CLOSED |
| **Author** | zygopleural (Lee) |
| **Created** | 2022-11-07 11:36:47.000 UTC (3y 2m ago) |
| **Updated** | 2022-11-08 20:22:26.000 UTC |
| **Closed** | 2022-11-08 20:22:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

I am trying to set a `connectionTimeout` of less than the [default 10s](https://github.com/temporalio/sdk-typescript/blob/main/packages/client/src/connection.ts#L74-L83). 

### Describe the bug

The `ConnectionOptions.connectionTimeout` seems to be ignored.

[Here](https://github.com/zygopleural/temporal-connection-timeout-repro/commit/fd9d4985069476750dbf46c13ad8d79352079757) I have set the `connectionTimeout` to `1000` ms (1s).

Below you can clearly see the timeout is still 10 seconds

```shell
npm run workflow

> temporal-hello-world@0.1.0 workflow
> ts-node src/client.ts

Creating connection { time: 2022-11-07T11:29:09.682Z }
Error creating connection {
  time: 2022-11-07T11:29:19.723Z,
  error: Error: Failed to connect before the deadline
      at checkState
```

### Minimal Reproduction

Repo is [here](https://github.com/zygopleural/temporal-connection-timeout-repro), my changes are [here](https://github.com/zygopleural/temporal-connection-timeout-repro/commit/fd9d4985069476750dbf46c13ad8d79352079757).

Need to make sure you actually don't have the server running so the connection times-out.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: M1 Mac
- Temporal Version:
```
npm explain @temporalio/client
@temporalio/client@1.4.4
node_modules/@temporalio/client
  @temporalio/client@"^1.0.0" from the root project
```
- Are you using Docker or Kubernetes or building Temporal from source? N/A

### Additional context


---

<a id="945"></a>

### #945: [Feature Request] Add client interceptor for `list` and `fetch_history`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/945 |
| **State** | OPEN |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-11-01 22:11:53.000 UTC (3y 2m ago) |
| **Updated** | 2024-09-27 16:42:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

`list` was implemented in https://github.com/temporalio/sdk-typescript/pull/942 and is missing an interceptor.
`fetch_history` is not yet implemented, make sure it is interceptable when done.


---

<a id="931"></a>

### #931: [Bug] Queries targeting a nonexistent handler fail WFTs on non-legacy path

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/931 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2022-10-19 21:57:56.000 UTC (3y 2m ago) |
| **Updated** | 2022-10-20 04:24:19.000 UTC |
| **Closed** | 2022-10-20 04:24:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->

### Describe the bug

If you query a workflow with a nonexistent query type, and the query is issued as part of a WFT (not a legacy query), then that causes the SDK to reject the workflow task, where it should instead complete the activation successfully and include a failed query result command.

### Minimal Reproduction

You have to get lucky and have server send the query the nonlegacy way, so inconsistently repros. Would be easy to write a UT for.
In sdk-features:

```typescript
export const finishSignal = wf.defineSignal('finish');
export const query = wf.defineQuery<string>('nonexistent');

export async function workflow(): Promise<void> {
  await new Promise((resolve) => wf.setHandler(finishSignal, () => resolve(null)));
}

export const feature = new Feature({
  workflow,
  checkResult: async (runner, handle) => {

    await assert.rejects(async () => {
      await handle.query(query);
    }, QueryNotRegisteredError);

    await handle.signal(finishSignal);
    await runner.waitForRunResult(handle);
  },
});
```

This miiiiight only happen if the query is part of the first start workflow activation, too. (Something to do with bufferedQueries)


---

<a id="923"></a>

### #923: [Bug] CI fails from forks

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/923 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-10-14 22:30:12.000 UTC (3y 2m ago) |
| **Updated** | 2022-10-24 21:48:54.000 UTC |
| **Closed** | 2022-10-24 21:48:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

Docs job should be skipped if no token secret is found.
https://github.com/temporalio/sdk-typescript/actions/runs/3253267762/jobs/5340372284


---

<a id="909"></a>

### #909: [Bug] Ignored shutdown signal causing stale workers during development

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/909 |
| **State** | CLOSED |
| **Author** | ricmatsui (Ricardo Matsui) |
| **Created** | 2022-10-07 20:17:58.000 UTC (3y 3m ago) |
| **Updated** | 2022-10-13 15:22:08.000 UTC |
| **Closed** | 2022-10-13 15:22:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

<!-- 
Tell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) 
-->
While developing using TS SDK, we run `npm run start.watch`. When we change the code in `src`, we want the worker to always restart. When we interrupt this task with `Ctrl+C`, we want the worker to always stop.

### Describe the bug

<!-- A clear and concise description of what the bug is. -->

1. If we interrupt with `Ctrl+C`, sometimes the worker will continue to run as an orphaned process.
2. Sometimes when we change the code in `src`, the worker ignores it and continues running.

This causes issues during development because old workers with old code are unexpectedly still running.

<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->

### Minimal Reproduction

<!-- 
Modify our hello world templates to demonstrate:

- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world
- Go: https://github.com/temporalio/money-transfer-project-template-go
- Java: https://github.com/temporalio/money-transfer-project-template-java
- PHP: https://github.com/temporalio/samples-php#samples
-->

Reproduction 1:
Run `npx @temporalio/create@latest temporal-hello-world  --sample hello-world`
Run `cd temporal-hello-world`
Run `npm run start.watch`
Hit `Ctrl+C` after "[INFO] Creating worker" appears in the logs
Run `ps -a | grep src/worker.js`
Sometimes the worker will continue running as an orphaned process

Video: https://www.loom.com/share/ff77941fd3d14940ba644759b1da0cd6

Reproduction 2:
Run `npx @temporalio/create@latest temporal-hello-world  --sample hello-world`
Run `npm run start.watch`
Change `src/activities.ts` and save (for example `return "Hello 1!"`)
Wait for the "[INFO] Creating worker" message in the logs
Immediately change `src/activities.ts` again and save (for example `return "Hello 2!"`)
Run `npm run workflow`
Sometimes the old activities code will run (`"Hello 1!"`)

It may be easier to reproduce with a larger codebase, etc.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Intel Mac
- Temporal Version: Temporal Server 1.15.0, TypeScript SDK 1.4.2
- Are you using Docker or Kubernetes or building Temporal from source? Temporal Server in Docker

### Additional context

<!-- Add any other context about the problem here. -->

nodemon: 2.0.20
ts-node: 10.9.1

One cause seems to be related to worker `Runtime` listening to process signals in `setupShutdownHook` without any shutdown signal callbacks registered:

https://github.com/temporalio/sdk-typescript/blob/cb1029537976c37270a61bc9744a566618c55e26/packages/worker/src/runtime.ts#L114-L124

https://github.com/temporalio/sdk-typescript/blob/cb1029537976c37270a61bc9744a566618c55e26/packages/worker/src/runtime.ts#L397-L404

When a listener to a process signal is added, the signal no longer causes the default behavior, so the signal is ignored. The shutdown signal callbacks are only added after the worker is started: 

https://github.com/temporalio/sdk-typescript/blob/cb1029537976c37270a61bc9744a566618c55e26/packages/worker/src/worker.ts#L1597-L1600

If the signal occurs before this, it may be ignored. There could be other issues possibly related to core, nodemon, or ts-node.

Workarounds could be:
- Patch `Runtime` to only add listener to process signal when there is a callback
- Add a listener for process signals that always exits for development only


---

<a id="898"></a>

### #898: [Feature Request] Give more info in `Webpack finished with errors` message

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/898 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-30 04:34:42.000 UTC (3y 3m ago) |
| **Updated** | 2025-11-18 19:30:47.000 UTC |
| **Closed** | 2025-11-18 19:30:47.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Getting the below opaque error when I do:

```
git clone https://github.com/temporalio/samples-typescript.git
cd samples-typescript/instrumentation
git checkout 42c3d81
npm start
```

[42c3d81](https://github.com/temporalio/samples-typescript/pull/197/commits/42c3d81deb8e389e6c88aac348ed01004f795d5e)

```
2022-09-30T04:30:17.299Z [undefined] error: Process failed Webpack finished with errors, if you're unsure what went wrong, visit our troubleshooting page at https://docs.temporal.io/typescript/troubleshooting#webpack-errors {
  stack: "Error: Webpack finished with errors, if you're unsure what went wrong, visit our troubleshooting page at https://docs.temporal.io/typescript/troubleshooting#webpack-errors\n" +
    '    at /Users/me/gh/samples-typescript/instrumentation/node_modules/@temporalio/worker/src/workflow/bundler.ts:267:17\n' +
    '    at finalCallback (/Users/me/gh/samples-typescript/instrumentation/node_modules/webpack/lib/Compiler.js:441:32)\n' +
    '    at /Users/me/gh/samples-typescript/instrumentation/node_modules/webpack/lib/Compiler.js:505:17\n' +
    '    at /Users/me/gh/samples-typescript/instrumentation/node_modules/webpack/lib/HookWebpackError.js:68:3\n' +
    '    at Hook.eval [as callAsync] (eval at create (/Users/me/gh/samples-typescript/instrumentation/node_modules/tapable/lib/HookCodeFactory.js:33:10), <anonymous>:6:1)\n' +
    '    at Hook.CALL_ASYNC_DELEGATE [as _callAsync] (/Users/me/gh/samples-typescript/instrumentation/node_modules/tapable/lib/Hook.js:18:14)\n' +
    '    at Cache.storeBuildDependencies (/Users/me/gh/samples-typescript/instrumentation/node_modules/webpack/lib/Cache.js:122:37)\n' +
    '    at /Users/me/gh/samples-typescript/instrumentation/node_modules/webpack/lib/Compiler.js:501:19\n' +
    '    at Hook.eval [as callAsync] (eval at create (/Users/me/gh/samples-typescript/instrumentation/node_modules/tapable/lib/HookCodeFactory.js:33:10), <anonymous>:6:1)\n' +
    '    at Hook.CALL_ASYNC_DELEGATE [as _callAsync] (/Users/me/gh/samples-typescript/instrumentation/node_modules/tapable/lib/Hook.js:18:14)'
}
```


---

<a id="890"></a>

### #890: [Feature Request] Don't warn about no activities during `Worker.runReplayHistory`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/890 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-09-27 16:13:05.000 UTC (3y 3m ago) |
| **Updated** | 2023-01-23 23:46:08.000 UTC |
| **Closed** | 2023-01-23 23:46:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Users see this in output and think something is wrong:

```
2022-09-27T16:09:43.579Z [WARN] No activities registered, not polling for activity tasks
```


---

<a id="884"></a>

### #884: [Feature Request] Support Otel temporality config

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/884 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2022-09-22 19:33:32.000 UTC (3y 3m ago) |
| **Updated** | 2022-09-28 18:00:55.000 UTC |
| **Closed** | 2022-09-28 18:00:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the solution you'd like

Expose temporality configuration from https://github.com/temporalio/sdk-core/pull/402


---

<a id="838"></a>

### #838: [Bug] Default `WorkerOptions.maxCachedWorkflows` is too low

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/838 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-08-22 20:20:34.000 UTC (3y 4m ago) |
| **Updated** | 2023-06-21 20:59:31.000 UTC |
| **Closed** | 2023-06-21 20:59:31.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Since #802 the default was significantly reduced.
For example on a 64GB machine it went down from 12600 to 761 and on a 16GB machine (nightly CI) from 2853 to 261.

We could in the future calculate this dynamically based on real usage instead of having a hard maximum but for now we should at least make the default a bit higher (details yet TBD).


---

<a id="830"></a>

### #830: [Feature Request] Remove `sourceMap` and `sourceMapPath`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/830 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-19 23:57:51.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-19 23:57:51.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, next-gen |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Made irrelevant in https://github.com/temporalio/sdk-typescript/pull/819
Deprecated in https://github.com/temporalio/sdk-typescript/pull/827


---

<a id="829"></a>

### #829: [Feature Request] Remove Long from client

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/829 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-19 23:55:57.000 UTC (3y 4m ago) |
| **Updated** | 2022-09-28 18:00:54.000 UTC |
| **Closed** | 2022-09-28 18:00:54.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, next-gen |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Originally implemented here: https://github.com/temporalio/sdk-typescript/pull/818
Reverted here: https://github.com/temporalio/sdk-typescript/pull/827


---

<a id="828"></a>

### #828: [Feature Request] Throw when `heartbeat()` is called from Local Activities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/828 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-19 23:54:28.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-19 23:54:37.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, next-gen |
| **Assignees** | None |
| **Milestone** | None |

#### Description

This is what Python does. It's a way to indicate to users that they don't need that line of code (which currently is ignored / has no effect).


---

<a id="825"></a>

### #825: [Feature Request] Add more `console.*` functions to Workflow vm

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/825 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-08-19 18:32:36.000 UTC (3y 4m ago) |
| **Updated** | 2022-08-20 02:06:53.000 UTC |
| **Closed** | 2022-08-20 02:06:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

User got `TypeError: console.warn is not a function`:

https://community.temporal.io/t/console-warn-is-not-a-function/5723

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Add some common functions like `console.warn`, `.error`, `.info`, `.debug`.

Currently just have `.log`:

https://github.com/temporalio/sdk-typescript/blob/a57df999bd41710c4137fd6ccfe872b145b9b117/packages/worker/src/workflow/vm.ts#L182-L190


---

<a id="795"></a>

### #795: [Bug] Breakpoints do not work for workflow code

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/795 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-07-29 23:55:43.000 UTC (3y 5m ago) |
| **Updated** | 2022-08-19 22:48:27.000 UTC |
| **Closed** | 2022-08-19 22:48:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Due to bundling of workflow code, it's impossible to set breakpoints on code that runs in workflow context.

There used to be a workaround for this before stack trace query was implemented by setting a `debugger` statement at the top of a workflow function but since that change we no longer inline the source-maps making it impossible to locate the source of the bundled code.

@mjameswh discovered that by setting a file name on the vm script we use to compile the code and having the file and source map available (on disk and possibly HTTP URL) the debugger can map back to the source and breakpoint work again.

Our proposed solution is to start an HTTP server in the worker when running in debug mode to serve the source map.
We'd debated whether to use http URLs or save the source map to a temporary directory and decided to go with HTTP since that will enable access when debugging remotely (for example when running a worker in a docker container).
The security implications of running an HTTP server in debug mode are minimal since a server has to be started regardless for the debugger to connect to the process.
The port to listen on should be configurable to enable remote access, if it is not provided, the server will listen on a random port.


---

<a id="782"></a>

### #782: [Feature Request] Put test server behind CDN to avoid `rate limit exceeded`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/782 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-27 03:59:47.000 UTC (3y 5m ago) |
| **Updated** | 2022-09-12 23:27:31.000 UTC |
| **Closed** | 2022-09-12 23:27:31.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Users using testing package may get:

`HTTPError: Response code 403 (rate limit exceeded)`

from: 

`node ./scripts/download-test-server.mjs`

https://temporalio.slack.com/archives/C01DKSMU94L/p1658887447564889

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Currently downloading straight from GH. Instead use CDN.



---

<a id="766"></a>

### #766: Remove terser

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/766 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-07-21 17:19:00.000 UTC (3y 5m ago) |
| **Updated** | 2022-12-19 15:30:03.000 UTC |
| **Closed** | 2022-12-19 15:30:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Once webpack updates and we update our webpack version, we can remove terser from `packages/worker/package.json` (added in #760)

![image](https://user-images.githubusercontent.com/251288/180274603-5ec12113-0b18-4121-9d49-c63cfa183285.png)



---

<a id="759"></a>

### #759: worker-1.0.0-rc.1.tgz: 1 vulnerabilities (highest severity is: 5.3)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/759 |
| **State** | CLOSED |
| **Author** | app/mend-for-github-com |
| **Created** | 2022-07-17 22:02:11.000 UTC (3y 5m ago) |
| **Updated** | 2022-07-21 17:19:18.000 UTC |
| **Closed** | 2022-07-21 17:19:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | Mend: dependency security vulnerability |
| **Assignees** | None |
| **Milestone** | None |

#### Description

<details><summary><img src='https://whitesource-resources.whitesourcesoftware.com/vulnerability_details.png' width=19 height=20> Vulnerable Library - <b>worker-1.0.0-rc.1.tgz</b></p></summary>

<p></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/terser/package.json</p>
<p>

</details>

## Vulnerabilities

| CVE | Severity | <img src='https://whitesource-resources.whitesourcesoftware.com/cvss3.png' width=19 height=20> CVSS | Dependency | Type | Fixed in | Remediation Available |
| ------------- | ------------- | ----- | ----- | ----- | --- | --- |
| [CVE-2022-25858](https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25858) | <img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> Medium | 5.3 | terser-5.14.1.tgz | Transitive | N/A | &#10060; |


## Details

<details>

<summary><img src='https://whitesource-resources.whitesourcesoftware.com/medium_vul.png' width=19 height=20> CVE-2022-25858</summary>


###  Vulnerable Library - <b>terser-5.14.1.tgz</b></p>

<p>JavaScript parser, mangler/compressor and beautifier toolkit for ES6+</p>
<p>Library home page: <a href="https://registry.npmjs.org/terser/-/terser-5.14.1.tgz">https://registry.npmjs.org/terser/-/terser-5.14.1.tgz</a></p>
<p>Path to dependency file: /package.json</p>
<p>Path to vulnerable library: /node_modules/terser/package.json</p>
<p>

Dependency Hierarchy:
  - worker-1.0.0-rc.1.tgz (Root Library)
    - webpack-5.73.0.tgz
      - terser-webpack-plugin-5.3.3.tgz
        - :x: **terser-5.14.1.tgz** (Vulnerable Library)
<p>Found in base branch: <b>main</b></p>
</p>

<p></p>

###  Vulnerability Details
<p>  
  
The package terser before 4.8.1, from 5.0.0 and before 5.14.2 are vulnerable to Regular Expression Denial of Service (ReDoS) due to insecure usage of regular expressions.

<p>Publish Date: 2022-07-15
<p>URL: <a href=https://vuln.whitesourcesoftware.com/vulnerability/CVE-2022-25858>CVE-2022-25858</a></p>
</p>

<p></p>

###  CVSS 3 Score Details (<b>5.3</b>)
<p>

Base Score Metrics:
- Exploitability Metrics:
  - Attack Vector: Network
  - Attack Complexity: Low
  - Privileges Required: None
  - User Interaction: None
  - Scope: Unchanged
- Impact Metrics:
  - Confidentiality Impact: None
  - Integrity Impact: None
  - Availability Impact: Low
</p>
For more information on CVSS3 Scores, click <a href="https://www.first.org/cvss/calculator/3.0">here</a>.
</p>

<p></p>

###  Suggested Fix
<p>

<p>Type: Upgrade version</p>
<p>Origin: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25858">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25858</a></p>
<p>Release Date: 2022-07-15</p>
<p>Fix Resolution: terser - 4.8.1,5.14.2</p>

</p>

<p></p>

</details>


---

<a id="730"></a>

### #730: [Docs] Make method overloads more obvious in docs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/730 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-27 23:48:48.000 UTC (3y 6m ago) |
| **Updated** | 2022-11-23 22:37:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | documentation |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

Hard to notice that a fn has overloads, for example:

![image](https://user-images.githubusercontent.com/251288/176055679-46021141-9da7-4b14-bed4-dfdbf2bf7397.png)


### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

Some visual change, and maybe a list of options (preferably linked) under the header:

<img width="197" alt="image" src="https://user-images.githubusercontent.com/251288/176055907-6f5f1c27-b9f6-4614-a464-64d6fcf736ed.png">

Like 

```
# condition

- condition(fn, timeout)
- condition(fn)

## condition(fn, timeout)

...

## condition(fn)

...
```


---

<a id="694"></a>

### #694: [Feature Request] Add `WorkflowInfo.runStartTime`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/694 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-06-13 18:24:36.000 UTC (3y 7m ago) |
| **Updated** | 2023-01-23 23:46:10.000 UTC |
| **Closed** | 2023-01-23 23:46:10.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

- Go: `WorkflowStartTime` https://pkg.go.dev/go.temporal.io/sdk@v1.15.0/internal#WorkflowInfo
- Java: [getRunStartedTimestampMillis](https://www.javadoc.io/static/io.temporal/temporal-sdk/1.0.2/io/temporal/workflow/WorkflowInfo.html#getRunStartedTimestampMillis--)()



---

<a id="685"></a>

### #685: [Bug] TypeScript: When workflow code imports built-in Node modules, worker logs the problem instead of loudly failing

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/685 |
| **State** | CLOSED |
| **Author** | davidtheclark (David Clark) |
| **Created** | 2022-06-06 19:55:16.000 UTC (3y 7m ago) |
| **Updated** | 2022-06-10 19:52:48.000 UTC |
| **Closed** | 2022-06-10 19:52:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### What are you really trying to do?

Debug workflow failures.

### Describe the bug

When workflow code imports built-in Node modules, worker logs the problem instead of loudly failing.

In these logs from worker startup, you'll see that the problem is detected but then just logged:

```
2022-06-06T19:26:13.471Z [INFO]   modules by path ../config/environments/*.ts 13.1 KiB 5 modules
2022-06-06T19:26:13.471Z [INFO]   modules by path ../config/*.ts 5.6 KiB 3 modules
2022-06-06T19:26:13.471Z [INFO] modules by path ../shared-universal/ 130 KiB
2022-06-06T19:26:13.472Z [INFO]   modules by path ../shared-universal/report/ 62.2 KiB 6 modules
2022-06-06T19:26:13.472Z [INFO]   modules by path ../shared-universal/utils/*.ts 20.6 KiB 5 modules
2022-06-06T19:26:13.472Z [INFO]   ../shared-universal/generated/graphql.ts 46.7 KiB [built] [code generated]
2022-06-06T19:26:13.472Z [INFO] __temporal_custom_payload_converter (ignored) 15 bytes [built] [code generated]
2022-06-06T19:26:13.472Z [INFO] child_process (ignored) 15 bytes [built] [code generated]
2022-06-06T19:26:13.474Z [INFO] path (ignored) 15 bytes [built] [code generated]
2022-06-06T19:26:13.474Z [INFO] webpack 5.65.0 compiled successfully in 644 ms
2022-06-06T19:26:13.474Z [WARN] Your Workflow code (or a library used by your Workflow code) is importing the following built-in Node modules:
  - 'child_process'
  - 'path'
Workflow code doesn't have access to built-in Node modules (in order to help enforce determinism). If you are certain these modules will not be used at runtime, then you may add their names to 'WorkerOptions.bundlerOptions.ignoreModules' in order to dismiss this warning. However, if your code execution actually depends on these modules, then you must change the codeor remove the library.
See https://typescript.temporal.io/api/interfaces/worker.workeroptions/#bundleroptions for details.
2022-06-06T19:26:13.480Z [INFO] Workflow bundle created { size: '3.29MB' }
2022-06-06T19:26:13.684Z [INFO] Worker state changed { state: 'RUNNING' }
```

### Minimal Reproduction

Import `path` into workflow code and start the worker.

### Environment/Versions

<!-- Please complete the following information where relevant. -->

- OS and processor: Mac
- Temporal Version: 0.21.0
- Are you using Docker or Kubernetes or building Temporal from source? Docker



---

<a id="677"></a>

### #677: [Bug] Node client does not send the client-name and client-version HTTP headers

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/677 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-05-31 16:17:30.000 UTC (3y 7m ago) |
| **Updated** | 2022-06-06 21:17:05.000 UTC |
| **Closed** | 2022-06-06 21:17:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Only the worker connection does, needs to be applied to the client connection too.


---

<a id="667"></a>

### #667: [Bug] Update isReplaying in main thread

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/667 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-27 15:23:51.000 UTC (3y 7m ago) |
| **Updated** | 2022-05-29 20:58:16.000 UTC |
| **Closed** | 2022-05-29 20:58:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | 1.0 |

#### Description

https://github.com/temporalio/sdk-typescript/pull/657#discussion_r882297608


---

<a id="656"></a>

### #656: [Feature Request] Validate retry policy `maxAttempts` is an integer (e.g. not `Infinity`)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/656 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-05-19 19:15:55.000 UTC (3y 7m ago) |
| **Updated** | 2022-05-31 04:18:44.000 UTC |
| **Closed** | 2022-05-31 04:18:44.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

*No description provided.*


---

<a id="648"></a>

### #648: [Feature Request] Make docs breadcrumbs clickable

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/648 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-05-13 04:26:52.000 UTC (3y 8m ago) |
| **Updated** | 2022-06-13 18:56:11.000 UTC |
| **Closed** | 2022-06-13 18:56:11.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Currently only the house emoji is clickable:

<img width="583" alt="image" src="https://user-images.githubusercontent.com/251288/168211111-6f29d60a-b79a-4ad1-8280-81d748ed4f6c.png">



---

<a id="642"></a>

### #642: [Feature Request] Expose grpc static headers in NativeConnection

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/642 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-05-10 03:58:42.000 UTC (3y 8m ago) |
| **Updated** | 2022-05-11 20:09:49.000 UTC |
| **Closed** | 2022-05-11 20:09:49.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | 1.0 |

#### Description

This is already supported by the core client, need to expose in NativeConnection and hook it up in the bridge


---

<a id="608"></a>

### #608: [Feature Request] Better balancing of workflows between worker threads

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/608 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-04-22 00:53:50.000 UTC (3y 8m ago) |
| **Updated** | 2023-06-21 20:59:32.000 UTC |
| **Closed** | 2023-06-21 20:59:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | mjameswh |
| **Milestone** | None |

#### Description

Currently the SDK worker uses round robin to dispatch workflows to the different worker threads in the pool.
Due to the fact that workflows can be evicted, worker threads might be in a fairly unbalanced state where a single thread takes on significantly more work than the others.

A simple refactoring of this dispatcher to choose the worker thread with least workflows would improve the overall balancing of work between the threads.


---

<a id="597"></a>

### #597: [Feature Request] Assert single version of `@temporalio/workflow` is loaded into the workflow runtime

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/597 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-04-19 22:27:14.000 UTC (3y 8m ago) |
| **Updated** | 2025-11-18 19:33:08.000 UTC |
| **Closed** | 2025-11-18 19:33:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We've seen cases where a library depends on a different version of our runtime which is not supported because we store workflow state in a module static variable.


---

<a id="595"></a>

### #595: [Feature Request] codec -> codecs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/595 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-04-18 21:43:19.000 UTC (3y 8m ago) |
| **Updated** | 2022-05-11 03:25:02.000 UTC |
| **Closed** | 2022-05-11 03:25:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | lorensr |
| **Milestone** | 1.0 |

#### Description

*No description provided.*


---

<a id="594"></a>

### #594: Upsertsearchattributes

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/594 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-04-18 21:42:11.000 UTC (3y 8m ago) |
| **Updated** | 2022-04-18 21:42:20.000 UTC |
| **Closed** | 2022-04-18 21:42:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

*No description provided.*


---

<a id="555"></a>

### #555: [Feature Request] Remote codec converter

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/555 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-22 15:34:53.000 UTC (3y 9m ago) |
| **Updated** | 2025-10-06 15:12:04.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Add the equivalent of `NewRemoteDataConverter` in Go

https://github.com/temporalio/sdk-go/blob/706516c7077ba2e9b40304aeddbed47e25b2a68f/converter/codec.go#L350


---

<a id="544"></a>

### #544: [Bug] Fix snipsync

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/544 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-17 03:21:08.000 UTC (3y 9m ago) |
| **Updated** | 2022-04-29 18:58:08.000 UTC |
| **Closed** | 2022-04-29 18:58:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Snip comments don't show up in API docs:

<img width="968" alt="image" src="https://user-images.githubusercontent.com/251288/158729960-bea39289-ccdc-40c1-819f-bbdb3f13e71f.png">
<img width="750" alt="image" src="https://user-images.githubusercontent.com/251288/158729978-efe50b3e-a9ed-4044-a842-a383ecb3e425.png">

Config: https://github.com/temporalio/sdk-typescript/blob/b52999382ea72bc0bac45ed37cfaa9daf4bc6336/packages/docs/docusaurus.config.js#L130-L142


---

<a id="521"></a>

### #521: Activity not found and activity arg conversion errors should be retryable.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/521 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2022-03-09 19:50:14.000 UTC (3y 10m ago) |
| **Updated** | 2022-03-10 07:27:01.000 UTC |
| **Closed** | 2022-03-10 07:27:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | lorensr |
| **Milestone** | None |

#### Description

### Describe the bug

Marked as non-retryable at https://github.com/temporalio/sdk-typescript/blob/v0.18.0/packages/worker/src/worker.ts#L474 and https://github.com/temporalio/sdk-typescript/blob/v0.18.0/packages/worker/src/worker.ts#L496 but after checking our other SDKs, this should be a retryable error.


---

<a id="514"></a>

### #514: [Feature Request] Run headers through codec

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/514 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-03-07 23:33:47.000 UTC (3y 10m ago) |
| **Updated** | 2022-06-30 17:08:47.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

As discussed on slack: by default, don't put headers through codec / custom data converter, except for otel baggage.

Putting otel baggage through the codec requires passing contextual info to `Codec.encode/decode`. And if we're going to do that, perhaps we want to allow users to have the codec be run on their other headers?

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

For future reference, `setBaggage` returns a new context:

```ts
import { context, propagation } from '@opentelemetry/api';
    const baggage = propagation.createBaggage({ test: { value: 'true' } });
    const newContext = propagation.setBaggage(context.active(), baggage);
```


---

<a id="493"></a>

### #493: [Bug] CHANGELOG for 0.18.0 doesn't reflect breaking change for client error handling

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/493 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-02-22 19:39:15.000 UTC (3y 10m ago) |
| **Updated** | 2022-02-23 00:52:47.000 UTC |
| **Closed** | 2022-02-23 00:52:47.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Before 0.18.0 users could rely on grpc error code for handling errors, after the change they need to catch specific errors.


---

<a id="464"></a>

### #464: [Bug] WorkflowExecutionFailedEventAttributes.retry_state not respected

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/464 |
| **State** | CLOSED |
| **Author** | cretz (Chad Retz) |
| **Created** | 2022-02-03 18:13:04.000 UTC (3y 11m ago) |
| **Updated** | 2022-02-09 20:25:18.000 UTC |
| **Closed** | 2022-02-09 20:25:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

Seems during workflow result, retry state is hardcoded instead of using that field


---

<a id="457"></a>

### #457: [Bug] Pre-built Rust bridge does not seem to be used on Windows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/457 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-02-01 23:33:08.000 UTC (3y 11m ago) |
| **Updated** | 2022-02-02 07:34:41.000 UTC |
| **Closed** | 2022-02-02 07:34:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

According to the build logs here it take a lot longer to install the SDK on Windows than Ubuntu / MacOS.
https://github.com/temporalio/sdk-typescript/runs/4959704412?check_suite_focus=true

Also reported in the forums: https://community.temporal.io/t/typescript-sdk-help/3865


---

<a id="452"></a>

### #452: [Feature Request] Support easily injecting headers into the grpc connection

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/452 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2022-01-26 22:49:38.000 UTC (3y 11m ago) |
| **Updated** | 2022-06-06 21:17:05.000 UTC |
| **Closed** | 2022-06-06 21:17:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

This currently requires an interceptor, a simpler API should be exposed for this common pattern.

For reference this is where metadata should be injected: https://github.com/temporalio/sdk-typescript/blob/690ea3c1ca0887b957b5b672689489daa6b77f55/packages/client/src/connection.ts#L128


---

<a id="444"></a>

### #444: [Feature Request] Warn user when sending unregistered signal

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/444 |
| **State** | OPEN |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2022-01-10 02:27:41.000 UTC (4 years ago) |
| **Updated** | 2024-12-17 21:30:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

When a user sends an unregistered signal, `handle.signal()` succeeds.

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->

They likely meant to send a registered signal and are wondering why their signal handler isn't running. We can provide clarity by logging a warning in development. It would be nice if the Client logged, but I don't think there's currently a [way for it to know](temporalio/sdk-features#51), so the Worker can log:

```
Warning: Workflow "my-workflow-id" received signal "fooSignal" but does not have a handler registered for "fooSignal". This may be due to:
- "fooSignal" is misspelled, either on the Client or in the Workflow.
- You haven't yet called `setHandler` for "fooSignal" in the Workflow.
- This Worker is running with an outdated version of your Workflow code that doesn't call `setHandler`. Try restarting this Worker process.
```

### Additional context

<!-- Add any other context or screenshots about the feature request here. -->

Slack discussion: https://temporaltechnologies.slack.com/archives/C01FT8U10GK/p1640455191114100

Note that this isn't an issue for queries. `await handle.query(unregisterdQuery)` throws with: `Workflow did not register a handler for unregisterdQuery`


---

<a id="434"></a>

### #434: [Feature Request] Create new shared package not used by workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/434 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-12-24 21:01:26.000 UTC (4 years ago) |
| **Updated** | 2022-03-02 19:57:53.000 UTC |
| **Closed** | 2022-03-02 19:57:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->

The `proto3-json-serializer` dep added to `common` in #430 resulted in an increase in workflow bundle size (from 0.75MB to 0.86MB in the script below).

`node packages/test/lib/run-a-worker.js`

### Describe the solution you'd like

<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->
Create a new package for shared code and deps that are not used in `workflow` package in order to reduce workflow bundle size.


---

<a id="420"></a>

### #420: [Feature Request] DSL example

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/420 |
| **State** | CLOSED |
| **Author** | viperfx (Tharshan Muthulingam) |
| **Created** | 2021-12-05 23:48:34.000 UTC (4y 1m ago) |
| **Updated** | 2021-12-05 23:49:32.000 UTC |
| **Closed** | 2021-12-05 23:49:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

To do add a TS example for the DSL workflow similar to Go and Java.




---

<a id="418"></a>

### #418: [Feature Request] Generic workflow defaults: T extends Workflow = Workflow

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/418 |
| **State** | CLOSED |
| **Author** | JoshuaKGoldberg (Josh Goldberg ‚ú®) |
| **Created** | 2021-12-05 02:37:49.000 UTC (4y 1m ago) |
| **Updated** | 2021-12-05 20:44:53.000 UTC |
| **Closed** | 2021-12-05 20:44:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Copying a [message on the community Slack](https://temporaltechnologies.slack.com/archives/C01FT8U10GK/p1638670600004800): `WorkflowHandle` requires an explicit `T extends Workflow`. It'd be nice to make it `T extends Workflow = Workflow` for using workflow handles that don't care about their workflow type specifics.

### Describe the solution you'd like

```ts
interface WorkflowHandle<T extends Workflow = Workflow>
```


---

<a id="417"></a>

### #417: [Feature Request] Export SDK version

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/417 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2021-12-03 15:33:47.000 UTC (4y 1m ago) |
| **Updated** | 2024-12-10 19:29:46.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Is your feature request related to a problem? Please describe.

Need version at runtime like other SDKs

### Describe the solution you'd like

Currently can get at a worker level via `import pkg from '@temporalio/worker/lib/pkg';` and `pkg.version` or by using the `package.json` directly, but should be in a more blessed/official place. Unsure whether this is in the meta package or common package or what.


---

<a id="408"></a>

### #408: [Bug] `npx @temporalio/create` fails for some users

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/408 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-29 14:46:06.000 UTC (4y 1m ago) |
| **Updated** | 2021-11-29 22:09:38.000 UTC |
| **Closed** | 2021-11-29 22:09:38.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | None |

#### Description

As reported on the community slack.

<img width="1085" alt="Screen Shot 2021-11-26 at 10 46 46 AM" src="https://user-images.githubusercontent.com/52304/143888525-08686661-6123-4684-a959-ee2307302e3c.png">

Node 14.15.0.


---

<a id="397"></a>

### #397: [Bug] ContinueAsNew shouldn't occur as error in Otel traces

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/397 |
| **State** | CLOSED |
| **Author** | schickling (Johannes Schickling) |
| **Created** | 2021-11-22 09:04:37.000 UTC (4y 1m ago) |
| **Updated** | 2022-02-22 22:09:19.000 UTC |
| **Closed** | 2022-02-22 22:09:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

It‚Äôs quite irritating to see this error in my workflow traces

![CleanShot 2021-11-22 at 10 03 32](https://user-images.githubusercontent.com/1567498/142832831-8b5cd090-2fd7-4f9f-a910-4719dcc78616.png)



---

<a id="386"></a>

### #386: Add an integration test to verify Workflows are retried in case of multiple consecutive timeouts

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/386 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-12 17:22:37.000 UTC (4y 1m ago) |
| **Updated** | 2023-01-10 17:43:08.000 UTC |
| **Closed** | 2023-01-10 17:43:08.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

WFT timeout is configurable and server behavior might change and make this test obsolete but this is good enough.
I'll add an integration test to the TS SDK so we know this actually works E2E.

_Originally posted by @bergundy in https://github.com/temporalio/sdk-core/issues/219#issuecomment-967284546_


---

<a id="364"></a>

### #364: [Feature Request] Rename external dependencies to sinks

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/364 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-09 17:14:10.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-10 23:36:07.000 UTC |
| **Closed** | 2021-11-10 23:36:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

The name is no longer accurate because this mechanism cannot be used to return values into the workflow


---

<a id="363"></a>

### #363: [Bug] Timer is not cancelled when condition resolves

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/363 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-11-09 17:11:33.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-11 04:03:00.000 UTC |
| **Closed** | 2021-11-11 04:03:00.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

It is better to cancel in order to reduce load on the system.


---

<a id="360"></a>

### #360: Make tracing tags consistent across SDKs

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/360 |
| **State** | OPEN |
| **Author** | cretz (Chad Retz) |
| **Created** | 2021-11-08 14:35:52.000 UTC (4y 2m ago) |
| **Updated** | 2025-02-04 18:24:27.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Is your feature request related to a problem? Please describe.**

Tracing tags are not consistent across SDKs.

**Describe the solution you'd like**

Make tracing tags consistent across SDKs.

**Additional context**

* Go: https://github.com/temporalio/sdk-go/issues/619
* Java: https://github.com/temporalio/sdk-java/issues/862




---

<a id="348"></a>

### #348: [Bug] Algolia broken

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/348 |
| **State** | CLOSED |
| **Author** | lorensr (Loren ‚ò∫Ô∏è) |
| **Created** | 2021-10-30 19:12:12.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-03 19:03:42.000 UTC |
| **Closed** | 2021-11-03 19:03:42.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

### Describe the bug

403 Error: `Index not allowed with this API key`

![image](https://user-images.githubusercontent.com/251288/139555719-863e6802-d4bd-45c0-8f5f-8be19441c247.png)



---

<a id="345"></a>

### #345: [Feature Request] Add SIGUSR2 to list of default worker shutdownSignals

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/345 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-29 15:38:36.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-01 22:26:57.000 UTC |
| **Closed** | 2021-11-01 22:26:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |
| **Reactions** | ‚ù§Ô∏è 1 |

#### Description

This is the signal nodemon uses for graceful shutdown, it should be in the default list.


---

<a id="323"></a>

### #323: [Feature Request] Use single Error type for WorkflowClient errors.

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/323 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-21 20:17:37.000 UTC (4y 2m ago) |
| **Updated** | 2021-11-02 18:43:58.000 UTC |
| **Closed** | 2021-11-02 18:43:58.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Is your feature request related to a problem? Please describe.

Currently we have a separate error class for each type of workflow failure.
This was implemented before failure classes were ported to the SDK.

### Describe the solution you'd like

Unify these errors into a single Error class and add a Failure class to its `cause` attribute.

### Additional context

This is the way it's done in Java, it makes sense to reuse the failure classes in this case instead of duplicating this functionality.


---

<a id="311"></a>

### #311: [Bug] Core bridge crashes when given invalid options

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/311 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-19 16:08:35.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-25 19:13:20.000 UTC |
| **Closed** | 2021-10-25 19:13:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### To Reproduce

```ts
await Core.install({ serverOptions: { tls: { clientCertPair: {} as any } } });
```

### Expected behavior

An informative error should be thrown.

### Screenshots/Terminal output

```
thread '<unnamed>' panicked at 'called `Option::unwrap()` on a `None` value', src/conversions.rs:108:88
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
Error: internal error in Neon module: called `Option::unwrap()` on a `None` value
    at node:internal/util:360:7
    at new Promise (<anonymous>)
    ...
```

### Versions

0.11.1 to current [`main`](https://github.com/temporalio/sdk-node/tree/23ce7a8ad12bade2eaa1a95fa7afdbfd1f7387eb) branch.

### Additional context

NOTE: Typescript protects from these errors but we should provide good JS support too.


---

<a id="308"></a>

### #308: [Bug] Unhandled grpc error: BadStartTimerAttributes: A valid StartToFireTimeout is not set on command

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/308 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-19 06:19:00.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-22 14:49:01.000 UTC |
| **Closed** | 2021-10-22 14:49:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Describe the bug

https://github.com/temporalio/samples-node/pull/35/files#diff-62a7b228ee5aaa8ce2fa31a9e59eeb54e75d9ddcbf0ad1209e640770bed2f7a9R10

```

2021-10-18T10:45:31.311Z [ERROR] Worker failed {
  error: [TransportError: Unhandled grpc error when completing workflow task: Status { code: InvalidArgument, message: "BadStartTimerAttributes: A valid StartToFireTimeout is not set on command.", metadata: MetadataMap { headers: {"content-type": "application/grpc"} }, source: None }]
}
```

https://temporaltechnologies.slack.com/archives/C01FT8U10GK/p1634554295343100?thread_ts=1634553998.342600&cid=C01FT8U10GK

![image](https://user-images.githubusercontent.com/6764957/137854307-baf27529-bf26-4e5f-b9e8-aa46d6444800.png)


### To Reproduce

go here https://github.com/temporalio/samples-node/pull/35/files#diff-62a7b228ee5aaa8ce2fa31a9e59eeb54e75d9ddcbf0ad1209e640770bed2f7a9R10

and run the updatable timer workflow

### Expected behavior

proper error


---

<a id="307"></a>

### #307: [Feature Request] activity.Context.sleep args should pass through ms 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/307 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-10-18 09:40:53.000 UTC (4y 2m ago) |
| **Updated** | 2021-10-21 20:20:41.000 UTC |
| **Closed** | 2021-10-21 20:20:41.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | beta |

#### Description

### Describe the bug

https://nodejs.temporal.io/api/classes/activity.Context#sleep this should take a string too

similar to #270 


---

<a id="287"></a>

### #287: [Bug] workflowIdReusePolicy default should not be set by the SDK

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/287 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-10-07 13:02:01.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-07 20:10:22.000 UTC |
| **Closed** | 2021-10-07 20:10:22.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

The default is set by the server already.

References:
- https://github.com/temporalio/sdk-node/blob/2d7d0ff6ca155008fc9eeb41e271339ab478db38/packages/client/src/workflow-options.ts#L40
- https://temporalio.slack.com/archives/C01DKSMU94L/p1633570826148600



---

<a id="271"></a>

### #271: [Bug] activity heartbeat options are double documented

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/271 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-09-27 19:45:17.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-01 08:02:32.000 UTC |
| **Closed** | 2021-10-01 08:02:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

is this a symptom that something is wrong?

https://nodejs.temporal.io/api/classes/activity.context/#heartbeat

![image](https://user-images.githubusercontent.com/6764957/134974699-c6b7e1c0-0347-4c40-a90d-87ec8de2cd59.png)



---

<a id="270"></a>

### #270: [Feature Request] workflow.sleep args should pass through `ms`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/270 |
| **State** | CLOSED |
| **Author** | swyxio (swyx.io) |
| **Created** | 2021-09-27 19:39:00.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-01 08:02:32.000 UTC |
| **Closed** | 2021-10-01 08:02:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

for consistent api with our timeouts

just tracking something i proposed to roey


---

<a id="246"></a>

### #246: Add timestamps to logger interface

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/246 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-09-17 15:01:06.000 UTC (4y 3m ago) |
| **Updated** | 2021-10-01 08:02:32.000 UTC |
| **Closed** | 2021-10-01 08:02:32.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

If you want I'll add that after this PR or just DIY

_Originally posted by @bergundy in https://github.com/temporalio/sdk-node/pull/231#r708861439_


---

<a id="227"></a>

### #227: [Bug] Worker.create fails with activities undefined

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/227 |
| **State** | CLOSED |
| **Author** | joebowbeer (Joe Bowbeer) |
| **Created** | 2021-09-07 20:01:17.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-15 05:54:18.000 UTC |
| **Closed** | 2021-09-15 05:54:18.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

### Describe the bug

Worker.create with workDir and activities undefined does not work.

_Originally posted by @joebowbeer in https://github.com/temporalio/temporal-pendulum/pull/2#discussion_r702903504_

### To Reproduce

https://github.com/temporalio/temporal-pendulum/blob/main/position-node/src/worker.ts#L5-L7

```suggestion
    workDir: __dirname,
    activities: undefined,
```

I tried this^ simpler form, but it failed because of activities MODULE_NOT_FOUND: 

```
Error: Cannot find module '[...]/temporal-pendulum/position-node/src/activities'
```

### Versions

- Temporal Node SDK 0.4.1


---

<a id="222"></a>

### #222: [Bug] Perform execution-chain following behavior in later server versions 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/222 |
| **State** | CLOSED |
| **Author** | Sushisource (Spencer Judge) |
| **Created** | 2021-09-03 18:39:25.000 UTC (4y 4m ago) |
| **Updated** | 2021-09-22 16:50:43.000 UTC |
| **Closed** | 2021-09-22 16:50:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

See details from the Go fix here: https://github.com/temporalio/sdk-go/pull/527


---

<a id="203"></a>

### #203: [Feature Request] Remove broken Worker suspend and resume polling methods

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/203 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-24 12:58:13.000 UTC (4y 4m ago) |
| **Updated** | 2021-08-24 14:07:06.000 UTC |
| **Closed** | 2021-08-24 14:07:06.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | beta |

#### Description

Since implemented we've decided to change WFT polling in Core to run in the background regardless of lang polling requests.
This change will break the suspend and resume methods.

Since suspend and resume is not a high priority feature, it'd better to disable it for now and implement this properly in core at a later time.


---

<a id="178"></a>

### #178: Remove `CancelledError` from WF lib, use `CancelledFailure` for cancelling a cancellation scope

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/178 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-09 10:50:24.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-12 15:22:01.000 UTC |
| **Closed** | 2021-08-12 15:22:01.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Now that we've ported the failure classes from the Java SDK we should use them.


---

<a id="174"></a>

### #174: [Bug] Worker fails to start with no workflows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/174 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-08-05 06:38:11.000 UTC (4y 5m ago) |
| **Updated** | 2021-08-28 06:34:57.000 UTC |
| **Closed** | 2021-08-28 06:34:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | beta |

#### Description

### Current behavior
Creating a Worker with no workflows dir throws:

```js
TypeError(
  'Could not build isolates for the worker due to missing WorkerOptions. Make sure you specify the `workDir` option, or both the `workflowsPath` and `nodeModulesPath` options.'
)
```

If the workflows dir is empty, webpack complains with:

```
ERROR in ./lib/workflows/ sync ^\.\/.*\.js$
ENOENT: no such file or directory, readdir '/Users/bergundy/example/lib/workflows'
caused by plugins in ContextModule.resolveDependencies
```

### Expected behavior
Worker starts with no configured `workflowsPath` or `nodeModulesPath`, does not create Workflow isolates.


---

<a id="166"></a>

### #166: [Bug] perf jaeger export is broken

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/166 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-26 07:13:06.000 UTC (4y 5m ago) |
| **Updated** | 2023-01-10 17:09:16.000 UTC |
| **Closed** | 2023-01-10 17:09:16.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | None |

#### Description

It's clear that spans are missing in jaeger after running perf.
Symptoms:

![Untitled](https://user-images.githubusercontent.com/52304/126947433-eae74374-dcd7-4d2d-bf6a-d81a1a7cdb9a.png)
![download](https://user-images.githubusercontent.com/52304/126947574-9f09553b-01c7-46d9-a5f2-3030dddbd760.png)

Fix this or try [collector exporter](https://github.com/open-telemetry/opentelemetry-js/tree/main/packages/opentelemetry-exporter-collector) instead.




---

<a id="153"></a>

### #153: [Feature Request] Implement WorkflowStub.signalWithStart

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/153 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-07-09 20:05:56.000 UTC (4y 6m ago) |
| **Updated** | 2021-07-12 18:27:03.000 UTC |
| **Closed** | 2021-07-12 18:27:03.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Missing from the client package


---

<a id="146"></a>

### #146: [Feature Request] Port Workflow error classes from Java SDK

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/146 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-30 22:16:21.000 UTC (4y 6m ago) |
| **Updated** | 2021-08-08 12:04:33.000 UTC |
| **Closed** | 2021-08-08 12:04:33.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

- For instance for activity failures.
- Errors should have an `isRetryable` attributes.


---

<a id="142"></a>

### #142: [Feature Request] Implement child workflows

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/142 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-30 17:10:51.000 UTC (4y 6m ago) |
| **Updated** | 2021-08-26 16:43:13.000 UTC |
| **Closed** | 2021-08-26 16:43:13.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

Once they are supported by sdk-core


---

<a id="141"></a>

### #141: [Feature Request] Implement ContinueAsNew

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/141 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-30 17:09:28.000 UTC (4y 6m ago) |
| **Updated** | 2021-07-09 19:39:53.000 UTC |
| **Closed** | 2021-07-09 19:39:53.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Once it is supported by sdk-core


---

<a id="129"></a>

### #129: [Feature Request] Add missing `ActivityCancellationType` to `ActivityOptions`

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/129 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-18 19:46:48.000 UTC (4y 6m ago) |
| **Updated** | 2021-07-25 15:08:05.000 UTC |
| **Closed** | 2021-07-25 15:08:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

https://github.com/temporalio/sdk-core/blob/5dc0d721210b8472b1b2952371508f989cbff2a4/protos/local/workflow_commands.proto#L77


---

<a id="120"></a>

### #120: Run clippy as part of CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/120 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-06-07 12:03:54.000 UTC (4y 7m ago) |
| **Updated** | 2022-11-30 16:48:07.000 UTC |
| **Closed** | 2022-11-30 16:48:07.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

I just your pipeline doesn't run clippy which would be a nice thing to do. Probably there's a handful of suggestions in here that'd be useful. You can check out the buildkite definition in Core for how we run clippy in pipelines.

_Originally posted by @Sushisource in https://github.com/temporalio/sdk-node/pull/114#discussion_r645034429_


---

<a id="109"></a>

### #109: [Bug] Activity identifier should not include the activity module name

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/109 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-24 17:00:17.000 UTC (4y 7m ago) |
| **Updated** | 2021-08-31 10:30:19.000 UTC |
| **Closed** | 2021-08-31 10:30:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug, good first issue |
| **Assignees** | bergundy |
| **Milestone** | beta |

#### Description

**Describe the bug**

Currently the Node SDK uses `JSON.stringify([module, functionName])` for activity names in order to avoid conflicts.

**Expected behavior**

We should be consistent with the other SDKs and use only the function name.
The Worker should throw an error if multiple activities are registered with the same name.

NOTE: that the main reason for using only function name as the identifier is so functions can easily be refactored to a different location.



---

<a id="108"></a>

### #108: [Feature Request] Limit Workflow activation time

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/108 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-24 13:37:21.000 UTC (4y 7m ago) |
| **Updated** | 2021-06-08 11:17:30.000 UTC |
| **Closed** | 2021-06-08 11:17:30.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Is your feature request related to a problem? Please describe.**

If a Workflow gets stuck for example by going into an infinite loop, it might cause the Worker to become unresponsive eating up precious CPU and occupying a thread in the isolate thread pool.

**Describe the solution you'd like**

Use a configurable [`timeout`](https://github.com/laverdet/isolated-vm#referenceapplyreceiver-arguments-options-promise) to limit the WF activation time. 

**Additional context**

https://github.com/temporalio/proposals/pull/22


---

<a id="100"></a>

### #100: Create a shared dependency for the worker and client packages

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/100 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-18 11:11:13.000 UTC (4y 7m ago) |
| **Updated** | 2021-08-03 11:27:14.000 UTC |
| **Closed** | 2021-08-03 11:27:14.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Any reason not to just make a lower dep they can share?

_Originally posted by @Sushisource in https://github.com/temporalio/sdk-node/pull/97#discussion_r631968959_


---

<a id="99"></a>

### #99: Clean up Js->Rust value conversion code in native bridge

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/99 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-18 11:09:27.000 UTC (4y 7m ago) |
| **Updated** | 2021-05-23 09:56:19.000 UTC |
| **Closed** | 2021-05-23 09:56:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement, good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

This 3 line preamble is a bit visually noisy. What do you think about replacing it with this (written off my head, not guaranteed to compile :smile: )

```rust
macro_rules! js_value {
    ($js_obj:ident, $js_cx:ident, $prop_name:expr, $js_type:ty) => {
        $js_obj
            .get(&mut $js_cx, $prop_name)?
            .downcast_or_throw::<$js_type, _>(&mut $js_cx)?
            .value(&mut $js_cx)
    }
}
```

Then you can just say `js_value!(server_options, cx, "namespace", JsString)`

_Originally posted by @Sushisource in https://github.com/temporalio/sdk-node/pull/97#discussion_r631968292_


---

<a id="87"></a>

### #87: [Feature Request] Provide way to specify SSL configuration for Worker->Service connection

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/87 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-09 11:54:22.000 UTC (4y 8m ago) |
| **Updated** | 2021-05-12 13:43:05.000 UTC |
| **Closed** | 2021-05-12 13:43:05.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | None |

#### Description

**Is your feature request related to a problem? Please describe.**

This feature is missing in order for the Worker to function in production environments.
Currently only the Client supports this.

**Describe the solution you'd like**

We should come up with something that looks like the node grpc API for convenience.
https://grpc.github.io/grpc/node/grpc.credentials.html#.createSsl__anchor

**Additional context**

Brought up in the community slack channel.
https://temporalio.slack.com/archives/C01DKSMU94L/p1620333054020200


---

<a id="79"></a>

### #79: [Feature Request] Run a stress test

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/79 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-05-02 11:28:04.000 UTC (4y 8m ago) |
| **Updated** | 2021-05-06 06:01:43.000 UTC |
| **Closed** | 2021-05-06 06:01:43.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | enhancement |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

To make sure we operate correctly under mild load and don't crash or leak memory.
We should publish the results so people know what to expect from the alpha release.


---

<a id="63"></a>

### #63: Use snipsync for all code snippets in docs 

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/63 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-04-12 09:07:44.000 UTC (4y 9m ago) |
| **Updated** | 2023-01-10 17:07:02.000 UTC |
| **Closed** | 2023-01-10 17:07:02.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | good first issue |
| **Assignees** | None |
| **Milestone** | None |

#### Description

We have quite a few code snippets in the docs, they're bound to break due to code changes, [snipsync](https://github.com/temporalio/snipsync) should help us test our snippets.




---

<a id="61"></a>

### #61: [Bug] Worker times out when trying to shutdown gracefully

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/61 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-04-08 11:07:55.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-27 08:40:26.000 UTC |
| **Closed** | 2021-04-27 08:40:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | bug |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

Easily reproducible via starting a worker and hitting Ctrl-C.
E2E tests should cover this once #58 is merged.


---

<a id="51"></a>

### #51: Handle errors returned from core correctly

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/51 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-25 05:15:20.000 UTC (4y 9m ago) |
| **Updated** | 2021-05-02 11:20:20.000 UTC |
| **Closed** | 2021-05-02 11:20:20.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

There are different types of errors that might be returned from the different core methods, define a clear strategy of handling these errors.


---

<a id="49"></a>

### #49: Complete API documentation for all public packages

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/49 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-24 14:58:00.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-19 13:41:19.000 UTC |
| **Closed** | 2021-04-19 13:41:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

- [x] worker
- [x] client
- [x] workflow
- [x] activity
- [x] proto
- [x] create

Make sure to publish the docs


---

<a id="47"></a>

### #47: Get integration tests passing for activities

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/47 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-24 14:49:42.000 UTC (4y 9m ago) |
| **Updated** | 2021-04-27 08:40:26.000 UTC |
| **Closed** | 2021-04-27 08:40:26.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

Get all of the cases from the [test activities](https://github.com/temporalio/sdk-node/blob/19703305a1a8874a13d50429b6cdf20fb65b8e68/packages/test-activities/src/index.ts) covered.

Make sure to test all of the `ActivityResult` variants on the workflow side and heartbeat timeout on the workflow side.


---

<a id="38"></a>

### #38: Add connection options to worker constructor

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/38 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-16 07:19:31.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-23 17:31:57.000 UTC |
| **Closed** | 2021-03-23 17:31:57.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

And pass them to core init.

Currently can only connect to localhost.


---

<a id="33"></a>

### #33: Don't buffer poll results in core-lang bridge (lib.rs)

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/33 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-11 07:06:23.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-18 15:54:55.000 UTC |
| **Closed** | 2021-03-18 15:54:55.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

At the moment we poll in a separate thread and push results into a queue to callback into the JS thread.
We should change this to either have a bounded blocking queue or only poll when JS is ready for the next result.

The reason for this is that buffering events could have negative effects. For example, activities are automatically considered started when a poll request returns and if the worker is busy it might not actually start them in time.


---

<a id="32"></a>

### #32: Detect and throw on cyclic module dependencies

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/32 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-10 13:10:35.000 UTC (4y 10m ago) |
| **Updated** | 2021-05-11 07:57:48.000 UTC |
| **Closed** | 2021-05-11 07:57:48.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Discovered while working on https://github.com/temporalio/sdk-node/pull/31, the loader will hang when a cycle is found.


---

<a id="21"></a>

### #21: Review the various README.md files in the project

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/21 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-03-02 12:54:19.000 UTC (4y 10m ago) |
| **Updated** | 2021-04-19 13:41:19.000 UTC |
| **Closed** | 2021-04-19 13:41:19.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | alpha |

#### Description

See also #17 and #20.

We should provide better explanations for what the various packages in this project contain.


---

<a id="14"></a>

### #14: Run integration tests in CI

| Field | Value |
|-------|-------|
| **URL** | https://github.com/temporalio/sdk-typescript/issues/14 |
| **State** | CLOSED |
| **Author** | bergundy (Roey Berman) |
| **Created** | 2021-02-28 17:55:36.000 UTC (4y 10m ago) |
| **Updated** | 2021-03-02 09:42:21.000 UTC |
| **Closed** | 2021-03-02 09:42:21.000 UTC |
| **Upvotes** | 0 |
| **Comments** | 0 |
| **Priority Score** | 0 |
| **Labels** | None |
| **Assignees** | None |
| **Milestone** | None |

#### Description

Currently integration tests are disabled via the env var `RUN_INTEGRATION_TESTS`.
Run server with compose as part of CI.


