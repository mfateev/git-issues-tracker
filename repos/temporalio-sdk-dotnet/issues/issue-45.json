{"assignees":[],"author":{"id":"MDQ6VXNlcjI4NzY0MQ==","is_bot":false,"login":"jakejscott","name":"Jake Scott"},"body":"### What are you really trying to do?\r\n\r\nI created a \"worker\" project template that uses the `IHostedService` and `BackgroundService`.  I added the ITemporalClient to the services container as a singleton.  If I construct the client within the Worker class it works.\r\n \r\nhttps://learn.microsoft.com/en-us/dotnet/core/extensions/workers\r\n\r\n### Describe the bug\r\n\r\nStarting the worker seems to hang\r\n\r\n### Minimal Reproduction\r\n\r\n**Program.cs**\r\n\r\n```csharp\r\nusing Temporalio.Client;\r\n\r\nvar client = await TemporalClient.ConnectAsync(new TemporalClientConnectOptions\r\n{\r\n    TargetHost = \"localhost:7233\",\r\n    Namespace = \"default\",\r\n});\r\n\r\nIHost host = Host.CreateDefaultBuilder(args)\r\n    .ConfigureServices(services =>\r\n    {\r\n        services.AddLogging(x =>\r\n        {\r\n            x.AddSimpleConsole(options =>\r\n            {\r\n                options.TimestampFormat = \"yyyy-mm-ddTHH:mm:ss.ff \";\r\n                options.UseUtcTimestamp = true;\r\n                options.IncludeScopes = false;\r\n                options.SingleLine = true;\r\n            });\r\n        });\r\n\r\n        services.AddSingleton<ITemporalClient>(client);\r\n\r\n        services.AddHostedService<Worker>();\r\n    })\r\n    .Build();\r\n\r\nhost.Run();\r\n```\r\n\r\n**Worker.cs**\r\n\r\n```csharp\r\nusing Temporalio.Client;\r\nusing Temporalio.Worker;\r\n\r\npublic class Worker : BackgroundService\r\n{\r\n    private readonly ILoggerFactory _loggerFactory;\r\n    private readonly ILogger<Worker> _logger;\r\n    private readonly ITemporalClient _client;\r\n\r\n    public Worker(ILoggerFactory loggerFactory, ILogger<Worker> logger, ITemporalClient client)\r\n    {\r\n        _loggerFactory = loggerFactory;\r\n        _logger = logger;\r\n        _client = client;\r\n    }\r\n\r\n    protected override async Task ExecuteAsync(CancellationToken stoppingToken)\r\n    {\r\n        _logger.LogInformation(\"Starting worker\");\r\n        \r\n        // NOTE: If I connect like this it works. If I use dependency injection it doesn't. \r\n        // var client = await TemporalClient.ConnectAsync(new TemporalClientConnectOptions\r\n        // {\r\n        //     TargetHost = \"localhost:7233\",\r\n        //     Namespace = \"default\",\r\n        // });\r\n\r\n        using var worker = new TemporalWorker(_client, new TemporalWorkerOptions\r\n        {\r\n            TaskQueue = \"my-task-queue\",\r\n            LoggerFactory = _loggerFactory,\r\n            Workflows = new List<Type>\r\n            {\r\n                typeof(SimpleWorkflow)\r\n            }\r\n        });\r\n\r\n        await worker.ExecuteAsync(stoppingToken);\r\n        \r\n        _logger.LogInformation(\"Shutdown worker\");\r\n    }\r\n}\r\n```\r\nx86 Windows\r\ntemporal cli\r\n\r\n\r\n","closedAt":"2023-07-25T12:30:37Z","comments":[{"id":"IC_kwDOInL6Hs5ZhcEF","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is surely the same issue as #44. Creating a client on the outside of a DI container is not working (and it's not best practice). See https://github.com/temporalio/sdk-dotnet/issues/44#issuecomment-1501936301 for the suggested alternative currently. In the meantime I'll try to find out why the external creation is having an issue (even if it is bad practice).","createdAt":"2023-04-10T15:12:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-dotnet/issues/45#issuecomment-1501937925","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5iVSYh","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Closing in favor of #44","createdAt":"2023-07-25T12:30:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/45#issuecomment-1649747489","viewerDidAuthor":false}],"createdAt":"2023-04-10T08:36:07Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":45,"reactionGroups":[],"state":"CLOSED","title":"Using dependency injection in a \"worker\" project hangs","updatedAt":"2023-07-25T12:30:37Z","url":"https://github.com/temporalio/sdk-dotnet/issues/45"}
