{"assignees":[],"author":{"id":"MDQ6VXNlcjExMjc1","is_bot":false,"login":"mnichols","name":"Mike Nichols"},"body":"This test hangs because of a grpc reported missing TaskQueue (see below for error message):\r\n```\r\nusing Temporalio.Client;\r\nusing Temporalio.Exceptions;\r\nusing Temporalio.Testing;\r\nusing Temporalio.Worker;\r\nusing Temporalio.Worker.Interceptors;\r\nusing Temporalio.Workflows;\r\nusing Xunit.Abstractions;\r\n\r\nnamespace Temporal.Curriculum.Timers.Tests.Orchestrations;\r\n[Workflow]\r\npublic class Continued\r\n{\r\n    [WorkflowRun]\r\n    public async Task  RunAsync(string arg)\r\n    {\r\n        if (string.Equals(\"can\", arg))\r\n        {\r\n            return;\r\n        }\r\n        await Workflow.DelayAsync(2000);\r\n        var canOpts = new ContinueAsNewOptions();\r\n        throw Workflow.CreateContinueAsNewException<Continued>(wf => wf.RunAsync(\"can\"), canOpts);\r\n    }\r\n}\r\npublic class ContinueAsNewTests : TestBase\r\n{\r\n    [Fact]\r\n    public async Task CAN_WorksWithNoTaskQueue()\r\n    {\r\n        await using var env = await WorkflowEnvironment.StartTimeSkippingAsync();\r\n        var workerOptions = new TemporalWorkerOptions(\"test\") { LoggerFactory = LoggerFactory };\r\n        workerOptions.AddWorkflow<Continued>(); \r\n\r\n        using var worker = new TemporalWorker(\r\n            env.Client,\r\n            workerOptions\r\n        );\r\n        await worker.ExecuteAsync(async () =>\r\n        {\r\n            var handle = await env.Client.StartWorkflowAsync<Continued>(wf => wf.RunAsync(\"first\"),\r\n                new WorkflowOptions(\"can1\", worker.Options.TaskQueue!));\r\n\r\n            var e = await Assert.ThrowsAsync<ContinueAsNewException>(async () =>\r\n            {\r\n                await handle.GetResultAsync();\r\n            });\r\n\r\n        });\r\n    }\r\n\r\n    public ContinueAsNewTests(ITestOutputHelper output) : base(output)\r\n    {\r\n    }\r\n}\r\n```\r\n\r\nThe error that prints before the test server hangs is:\r\n```\r\n2024-06-18T15:49:38.964086Z  WARN temporal_sdk_core::worker::workflow: Error while completing workflow activation error=status: InvalidArgument, message: \"Missing TaskQueue.\", details: [], metadata: MetadataMap { headers: {\"content-type\": \"application/grpc\"} }\r\n```\r\n\r\nIt makes sense the test server hangs but the TaskQueue should really be getting auto-assigned by the Workflow if not provided explicitly.\r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs6Bu3KI","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is caused/blocked by https://github.com/temporalio/sdk-java/issues/1424","createdAt":"2024-06-18T16:46:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/280#issuecomment-2176545416","viewerDidAuthor":false}],"createdAt":"2024-06-18T15:59:30Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":280,"reactionGroups":[],"state":"OPEN","title":"[Bug] TaskQueue not forwarded when using Test Environment, breaks ContinueAsNew (hangs)","updatedAt":"2024-06-18T16:46:20Z","url":"https://github.com/temporalio/sdk-dotnet/issues/280"}
