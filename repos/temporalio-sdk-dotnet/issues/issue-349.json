{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the bug\r\n\r\nIn https://github.com/temporalio/sdk-dotnet/blob/5141c2cb1330cdce1ab88f1bffd246012d5e1aa7/src/Temporalio/Worker/ActivityWorker.cs#L222-L234 we have an extra catch if something happened that even the other catches couldn't catch (such as a failure while processing a failure), but we are not logging nor are we setting the task token. Make sure we do both and add test coverage to try and reach this code (i.e. try to fail while processing a failure).","closedAt":"2024-10-08T17:22:41Z","comments":[{"id":"IC_kwDOInL6Hs6NLq2B","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This seems to occur on context cancel failing. To replicate the swallowing of this, try to do something like `ActivityExecutionContext.Current.CancellationToken.Register(() => throw new InvalidOperationException(\"intentional failure\"))`. The fix of course is to log the exception here and make sure the task token is set on this.","createdAt":"2024-09-23T15:29:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/349#issuecomment-2368646529","viewerDidAuthor":false}],"createdAt":"2024-09-16T15:27:01Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":349,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Failing to build completion does not use task token when creating failure","updatedAt":"2024-10-08T17:22:41Z","url":"https://github.com/temporalio/sdk-dotnet/issues/349"}
