{"assignees":[],"author":{"id":"MDQ6VXNlcjMxMDU5Nzk=","is_bot":false,"login":"alrz","name":"Alireza Habibi"},"body":"### What are you really trying to do?\r\n\r\n### Describe the bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n### Minimal Reproduction\r\n\r\n```cs\r\n[Workflow]\r\npublic class TestWorkflow\r\n{\r\n   [WorkflowUpdate]\r\n   public Task Update() => Task.CompletedTask;\r\n   [WorkflowRun]\r\n   public Task RunAsync() => Workflow.DelayAsync(TimeSpan.FromSeconds(3));\r\n}\r\npublic async Task Test() {\r\n    await using var env = await WorkflowEnvironment.StartTimeSkippingAsync();\r\n    using var worker = new TemporalWorker(\r\n        env.Client,\r\n        new TemporalWorkerOptions($\"tq-{Guid.NewGuid()}\").\r\n            AddWorkflow<TestWorkflow>());\r\n    await worker.ExecuteAsync(async () =>\r\n    {\r\n        var h = await env.Client.StartWorkflowAsync(\r\n            (TestWorkflow wf) => wf.RunAsync(),\r\n            new(id: $\"workflow-{Guid.NewGuid()}\", taskQueue: worker.Options.TaskQueue!));\r\n        await h.ExecuteUpdateAsync(wf => wf.Update());\r\n        await h.GetResultAsync();\r\n    });\r\n}\r\n```\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: Windows x64\r\n- Temporal Version: Temporal nuget package 1.0.0\r\n- Are you using Docker or Kubernetes or building Temporal from source? N/A\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs5xfaxo","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I have replicated and we have an outstanding issue in the Java SDK (where our time-skipping test server implementation lives): https://github.com/temporalio/sdk-java/issues/1903. Updates are experimental/unstable currently, but in the meantime you should be able to use a normal local server if you must use them and need to test them. I will leave this issue open pending a fix.","createdAt":"2024-01-22T13:58:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-1904061544","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5xfesu","author":{"login":"alrz"},"authorAssociation":"NONE","body":"> where our time-skipping test server implementation lives\r\n\r\nGood to know, thanks! BTW is there any issue to track progress on workflow updates? If I'm not mistaken it seems like this is not sdk-related and the server implementation is actually experimental for the time being.\r\n\r\nI thought signals would handle concurrent ops but turns out I had to use updates for this. The workaround is to use a combination of query/signal but I'm not comfortable doing that because the logic would be outside of the workflow itself and that would be hard to reason about.","createdAt":"2024-01-22T14:07:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-1904077614","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5xqzX9","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> BTW is there any issue to track progress on workflow updates?\r\n\r\nI am not aware of an issue to track this. You can see the status at the top of https://docs.temporal.io/workflows#update.\r\n\r\n> I thought signals would handle concurrent ops but turns out I had to use updates for this.\r\n\r\nSignals can handle concurrent pieces, they just don't have results to return\r\n\r\n> The workaround is to use a combination of query/signal but I'm not comfortable doing that because the logic would be outside of the workflow itself and that would be hard to reason about.\r\n\r\nThere's also an advanced approach to \"push\" results to activity workers hosted by the caller. See https://github.com/temporalio/samples-go/tree/main/reqrespactivity for a description of the pattern.","createdAt":"2024-01-23T22:46:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-1907045885","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5xueBa","author":{"login":"alrz"},"authorAssociation":"NONE","body":"> Signals can handle concurrent pieces, they just don't have results to return\r\n\r\nRight, I was confused by \"asynchronous\" mentioned in the docs. I supposed that means we don't wait for the signal method to complete on the client side, however the call itself is synchronized inside the workflow.\r\n\r\nJust one more question, where do we expect the signal to be received by the workflow? If I had to guess, between each `await` there's a chance that a signal would be received and get executed and then a workflow-run would be scheduled so we need to keep track of the state between each `await` and check it either in the update validator or via a query, is that correct?\r\n\r\nContext: I'm trying to handle a concurrent timeout and signal using `WhenAny(Delay,WaitCondition)`, the happy path is that the signal would be received before the timeout. But if the timeout occurred beforehand we need to run a compensating operation. \r\n","createdAt":"2024-01-24T12:12:18Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-1908007002","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5xu-hR","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> Just one more question, where do we expect the signal to be received by the workflow? If I had to guess, between each await there's a chance that a signal would be received and get executed and then a workflow-run would be scheduled so we need to keep track of the state between each await and check it either in the update validator or via a query, is that correct?\r\n\r\nThis is deviating from the issue and it may be better for a discussion place like the #dotnet-sdk channel in https://t.mp/slack or our forums.\r\n\r\nYes, signals are received from server at potentially any yield point. Yes, most users simply set a class field from their signal and have their `Workflow.WaitConditionAsync` wait for that value to get set to a certain value. Your use case of wait-for-signal-or-timeout is a very normal one and the proper approach.","createdAt":"2024-01-24T13:37:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-1908140113","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs6FUWup","author":{"login":"DovydasNavickas"},"authorAssociation":"NONE","body":"@cretz\r\n>Updates are experimental/unstable currently, but in the meantime you should be able to use a normal local server if you must use them and need to test them.\r\n\r\nLocally run server with temporal CLI has the same problem as the update never returns a value, even though in the dashboard the result is already visible. The update throws an exception:\r\n```\r\nTemporalio.Exceptions.RpcException: workflow execution already completed\r\n```","createdAt":"2024-07-18T14:29:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-2236705705","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs6FV7YR","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This sounds like a separate issue. Can you make a new issue with your .NET SDK version, CLI version, and (if you can) a replication? Can just alter https://github.com/temporalio/samples-dotnet/tree/main/src/WorkflowUpdate to demonstrate what you're seeing.","createdAt":"2024-07-18T17:20:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-2237117969","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs6HtWpE","author":{"login":"DovydasNavickas"},"authorAssociation":"NONE","body":"@cretz, I've been busy with things, but this turned out for the better: I've updated the Temporal CLI and the WorkflowUpdate sample started working. Probably there was a bug 3 weeks ago and it has been fixed.","createdAt":"2024-08-08T22:53:55Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-dotnet/issues/179#issuecomment-2276813380","viewerDidAuthor":false}],"createdAt":"2024-01-21T20:01:01Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":179,"reactionGroups":[],"state":"OPEN","title":"[Bug] Workflow Update hangs on time skipping environment","updatedAt":"2024-08-08T22:54:09Z","url":"https://github.com/temporalio/sdk-dotnet/issues/179"}
