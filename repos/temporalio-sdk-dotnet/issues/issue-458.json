{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the bug\n\nThere was a bug in older CLI where persistence may fail and the worker was getting something like this warning:\n\n    2025-04-17T18:56:22.257529Z  WARN temporal_sdk_core::worker::workflow: Task not found when completing error=status: NotFound, message: \"Namespace 0196451a-5a35-7546-9b8d-84a40f52f73e is not found.\"\n\nNotice the namespace not found. This may be causing a panic/segfault somewhere in the code. Try to replicate this situation, maybe by deleting the namespace while running.","closedAt":"2025-10-10T14:01:33Z","comments":[{"id":"IC_kwDOInL6Hs6rvj9c","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Here's a segfault on Windows after this came from the server:\n\n```\nFatal error. System.AccessViolationException: Attempted to read or write protected memory. This is often an indication that other memory is corrupt.\n   at Temporalio.Bridge.CustomSlotSupplier.ReserveCtxFromBridge(Temporalio.Bridge.Interop.SlotReserveCtx*)\n   at Temporalio.Bridge.CustomSlotSupplier+<>c__DisplayClass8_0+<<SafeReserve>b__0>d.MoveNext()\n   at System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.Threading.Tasks.VoidTaskResult, System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.__Canon, System.Private.CoreLib, Version=6.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].MoveNext(System.Threading.Thread)\n   at System.Runtime.CompilerServices.TaskAwaiter+<>c.<OutputWaitEtwEvents>b__12_0(System.Action, System.Threading.Tasks.Task)\n   at System.Threading.Tasks.AwaitTaskContinuation.RunOrScheduleAction(System.Action, Boolean)\n   at System.Threading.Tasks.Task.RunContinuations(System.Object)\n   at System.Threading.Tasks.Task.TrySetResult()\n   at System.Threading.Tasks.Task+DelayPromise.CompleteTimedOut()\n   at System.Threading.TimerQueueTimer.Fire(Boolean)\n   at System.Threading.TimerQueue.FireNextTimers()\n   at System.Threading.UnmanagedThreadPoolWorkItem.ExecuteUnmanagedThreadPoolWorkItem(IntPtr, IntPtr)\n   at System.Threading.UnmanagedThreadPoolWorkItem.ExecuteUnmanagedThreadPoolWorkItem(IntPtr, IntPtr)\n   at System.Threading.UnmanagedThreadPoolWorkItem.System.Threading.IThreadPoolWorkItem.Execute()\n   at System.Threading.ThreadPoolWorkQueue.Dispatch()\n   at System.Threading.PortableThreadPool+WorkerThread.WorkerThreadStart()\n```","createdAt":"2025-05-14T19:47:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/458#issuecomment-2881371996","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs62_epU","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"There are also issues after the server leaves like:\n\n```\n[10:49:12] fail: Temporalio.Bridge.CustomSlotSupplier[0]\n      Error reserving slot\n      System.ArgumentNullException: Array cannot be null. (Parameter 'bytes')\n         at System.Text.Encoding.GetString(Byte* bytes, Int32 byteCount)\n         at Temporalio.Bridge.ByteArrayRef.ToUtf8(TemporalCoreByteArrayRef byteArray) in c:\\work\\tem\\sdk-dotnet\\c-bridge-client\\temporal-sdk-dotnet\\src\\Temporalio\\Bridge\\ByteArrayRef.cs:line 94\n         at Temporalio.Bridge.CustomSlotSupplier.ReserveCtxFromBridge(TemporalCoreSlotReserveCtx* ctx) in c:\\work\\tem\\sdk-dotnet\\c-bridge-client\\temporal-sdk-dotnet\\src\\Temporalio\\Bridge\\CustomSlotSupplier.cs:line 213\n         at Temporalio.Bridge.CustomSlotSupplier.<>c__DisplayClass8_0.<<SafeReserve>b__0>d.MoveNext() in c:\\work\\tem\\sdk-dotnet\\c-bridge-client\\temporal-sdk-dotnet\\src\\Temporalio\\Bridge\\CustomSlotSupplier.cs:line 97\n```\nand\n```\n[10:49:12] fail: Temporalio.Bridge.CustomSlotSupplier[0]\n      Error reserving slot\n      System.ArgumentOutOfRangeException: Specified argument was out of the range of valid values. (Parameter 'ctx')\n         at Temporalio.Bridge.CustomSlotSupplier.ReserveCtxFromBridge(TemporalCoreSlotReserveCtx* ctx) in c:\\work\\tem\\sdk-dotnet\\c-bridge-client\\temporal-sdk-dotnet\\src\\Temporalio\\Bridge\\CustomSlotSupplier.cs:line 219\n         at Temporalio.Bridge.CustomSlotSupplier.<>c__DisplayClass8_0.<<SafeReserve>b__0>d.MoveNext() in c:\\work\\tem\\sdk-dotnet\\c-bridge-client\\temporal-sdk-dotnet\\src\\Temporalio\\Bridge\\CustomSlotSupplier.cs:line 97\n```","createdAt":"2025-07-14T15:51:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/458#issuecomment-3070093908","viewerDidAuthor":false}],"createdAt":"2025-04-17T19:43:07Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":458,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Issues with ReserveCtxFromBridge","updatedAt":"2025-10-10T14:01:33Z","url":"https://github.com/temporalio/sdk-dotnet/issues/458"}
