{"assignees":[],"author":{"id":"MDQ6VXNlcjMwMzUwMjUw","is_bot":false,"login":"mehaKumar","name":"Meha Kumar"},"body":"### What are you really trying to do?\n\nDeploy a dotnet temporal worker with various libraries, each containing some Workflow and Activity definitions.\n\n### Describe the bug\n\nWhen our worker starts up, we register activities using several calls to [TemporalWorkerOptions.AddAllActivities<T>](https://dotnet.temporal.io/api/Temporalio.Worker.TemporalWorkerOptions.html#Temporalio_Worker_TemporalWorkerOptions_AddAllActivities__1___0_). We had two calls to this method, each containing a class with name `ActivityA`, same signature. The startup did not fail with any error, but we saw that no worker was registered on the task queue from Temporal UI. \n\nWe would like `AddAllActivities` to throw when a duplicate activity is found.\n\n### Minimal Reproduction\n\n<!-- \nModify our hello world templates to demonstrate:\n\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\n- Go: https://github.com/temporalio/money-transfer-project-template-go\n- Java: https://github.com/temporalio/money-transfer-project-template-java\n- PHP: https://github.com/temporalio/samples-php#samples\n-->\n\n### Environment/Versions\n\n- Temporal SDK Version: 1.3.0\n\n### Additional context\n\n<!-- Add any other context about the problem here. -->\n","closedAt":"2025-08-29T19:07:04Z","comments":[{"id":"IC_kwDOInL6Hs6-Jq9z","author":{"login":"huytt621"},"authorAssociation":"NONE","body":"Just providing some more details and some digging that I did.\n\nWe noticed this also when there are two workflows with the same name.\n\nI dug into the code a little bit and found that there is a de-duping mechanism and an exception is thrown:\n[ActivityWorker](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio/Worker/ActivityWorker.cs#L56)\n[WorkflowWorker](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio/Worker/WorkflowWorker.cs#L76)\n\nFollowing up the stack trace, I see that there should've been an exception thrown when [TemporalWorker](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio/Worker/TemporalWorker.cs) is instantiated. This instantiation happens after initializing [TemporalWorkerService](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio.Extensions.Hosting/TemporalWorkerService.cs) and calling `ExecuteAsync()`. My theory about what happened is that after we instantiated `TemporalWorkerService` and started it with `TemporalWorkerService.StartAsync()`, a successful task is returned so things looked fine, but it silently fails because of the exception. A symptom of this issue was that tasks on the same queue weren't being picked up.\n\nI noticed that the approach we went with (instantiating `TemporalWorkerService` directly then calling `StartAsync`) was slightly different than the sample on the [README](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio.Extensions.Hosting/README.md), but I haven't tested whether this bug happens with the README approach.","createdAt":"2025-08-14T23:39:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/506#issuecomment-3190206323","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs6-PBrH","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"When using `TemporalWorker` directly, the constructor will throw on duplicate activity/workflow. However, `TemporalWorkerService` intentionally does not instantiate the worker in its constructor, it does it as part of `ExecuteAsync` since it may have to also connect a client which is an async operation and cannot be done in a constructor. So `ExecuteAsync` throws, but you can't see it if you're only using start/stop.\n\n.NET `BackgroundService` (https://learn.microsoft.com/en-us/dotnet/core/extensions/workers) is designed to have services that fail throw from `ExecuteAsync`. You will need to make sure you get exceptions from `ExecuteAsync`. There are other fatal exceptions that can happen with the running of the worker that you will miss if you only use start/stop. This is one of the reasons that `BackgroundService` is preferred over `IHostedService` - the former can throw, the latter has nowhere for exceptions to go. If you use host building (e.g. approach in the [README](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio.Extensions.Hosting/README.md)), `IHost` is smart enough to stop the application on `ExecuteAsync` failure (see [this code](https://github.com/dotnet/runtime/blob/v9.0.8/src/libraries/Microsoft.Extensions.Hosting/src/Internal/Host.cs#L175-L206)).\n\nSo overall, use .NET host (https://learn.microsoft.com/en-us/dotnet/core/extensions/workers) or direct `ExecuteAsync` to not have errors silently swallowed like they are via start/stop directly.","createdAt":"2025-08-15T14:16:36Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-dotnet/issues/506#issuecomment-3191610055","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs7A_z2_","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"(closing as non-issue, but feel free to keep commenting here or join us in `#dotnet-sdk` in [Slack](https://t.mp/slack).","createdAt":"2025-08-29T19:07:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/506#issuecomment-3237952959","viewerDidAuthor":false}],"createdAt":"2025-08-14T22:39:35Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":506,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Duplicate activity registration does not throw","updatedAt":"2025-08-29T19:07:04Z","url":"https://github.com/temporalio/sdk-dotnet/issues/506"}
