{"assignees":[],"author":{"id":"MDQ6VXNlcjkxMjQ2NTA=","is_bot":false,"login":"adeal","name":"Austin Deal"},"body":"### What are you really trying to do?\n<!-- \nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \n-->\n\n### Describe the bug\nThe non-generic `ExecuteAsync(Func<Task>)` overload loses exceptions thrown by the user's task and instead throws `TaskCanceledException`. This only affects workflows that return `Task (void)`, not `Task<T>`.\n\n### Minimal Reproduction\n```csharp\n[Workflow]\npublic class VoidWorkflow\n{\n    [WorkflowRun]\n    public async Task RunAsync()  // Returns Task, not Task<T>\n    {\n        throw new ApplicationFailureException(\"This exception is lost\", nonRetryable: true);\n    }\n}\n\n[Fact]\npublic async Task ExceptionIsLost()\n{\n    await using var env = await WorkflowEnvironment.StartLocalAsync();\n    using var worker = new TemporalWorker(\n        env.Client,\n        new TemporalWorkerOptions($\"tq-{Guid.NewGuid()}\").AddWorkflow<VoidWorkflow>());\n\n    // This throws TaskCanceledException instead of WorkflowFailedException\n    var ex = await Assert.ThrowsAsync<WorkflowFailedException>(async () =>\n        await worker.ExecuteAsync(async () =>\n            await env.Client.ExecuteWorkflowAsync(\n                (VoidWorkflow wf) => wf.RunAsync(),\n                new($\"wf-{Guid.NewGuid()}\", worker.Options.TaskQueue!))));\n  }\n```\n\n#### Expected behavior\nWorkflowFailedException is thrown (wrapping the ApplicationFailureException).\n\n#### Actual behavior\nTaskCanceledException: A task was canceled. is thrown. The original exception is lost.\n\n#### Workaround\nUse the generic overload by returning a value:\n\n```csharp\nawait worker.ExecuteAsync(async () =>\n{\n    await client.ExecuteWorkflowAsync(...);\n    return ValueTuple.Create();\n});\n```\n\n### Environment/Versions\nI've tracked this down to #548, which was first released in https://github.com/temporalio/sdk-dotnet/releases/tag/1.10.0\n\n### Additional context\nThe ExecuteAsync(Func<Task>) overload uses ContinueWith with OnlyOnRanToCompletion:\n\n```csharp\npublic Task ExecuteAsync(\n    Func<Task> untilComplete, CancellationToken stoppingToken = default) =>\n    ExecuteInternalAsync(\n        () => untilComplete().ContinueWith(\n            _ => ValueTuple.Create(),\n            default,\n            TaskContinuationOptions.ExecuteSynchronously | TaskContinuationOptions.OnlyOnRanToCompletion,\n            TaskScheduler.Current),\n        stoppingToken);\n```\n\nWhen untilComplete() throws, OnlyOnRanToCompletion prevents the continuation from running, and the resulting task is canceled (not faulted). The original exception is discarded.\n\n","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs7hmVDA","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks! Reviewing PR.","createdAt":"2026-01-22T15:09:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/599#issuecomment-3784921280","viewerDidAuthor":false}],"createdAt":"2026-01-21T23:40:10Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":599,"reactionGroups":[],"state":"OPEN","title":"[Bug] TemporalWorker::ExecuteAsync(Func<Task>) swallows exceptions, throws TaskCanceledException instead","updatedAt":"2026-01-22T15:09:12Z","url":"https://github.com/temporalio/sdk-dotnet/issues/599"}
