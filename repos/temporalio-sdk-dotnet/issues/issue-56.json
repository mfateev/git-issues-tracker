{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNjM5Ng==","is_bot":false,"login":"cretz","name":"Chad Retz"},"body":"### Describe the solution you'd like\r\n\r\nNeed OpenTelemetry interceptor as separately published project\r\n","closedAt":"2023-06-07T21:39:13Z","comments":[{"id":"IC_kwDOInL6Hs5dQbht","author":{"login":"johnkattenhorn"},"authorAssociation":"NONE","body":"Sounds like a good idea. Do you have any design thoughts on this yet, I'm thinking about this too, I think it should be possible to do Spans, Tracing and Metrics.\r\n\r\nAny ideas of what Metrics would be useful to track? Could we contribute on this one ? ","createdAt":"2023-05-26T15:45:43Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564588141","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5dQm-E","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"This is only for tracing. OTel is already supported for metrics (you can create your own `TemporalRuntime` w/ metrics telemetry options set to an OTel gRPC URL and use it throughout the life of your application). https://docs.temporal.io/references/sdk-metrics are the metrics we track.\r\n\r\nI have been working on the tracing part just this morning and I'll jot some notes down here. So it will be interceptor powered (like Python's, see https://github.com/temporalio/sdk-python/blob/main/temporalio/contrib/opentelemetry.py and https://github.com/temporalio/samples-python/tree/main/open_telemetry), but I am struggling with how best to split the project up.\r\n\r\nSo I was first thinking of a separate project for `Temporalio.Extensions.OpenTelemetry`, but since OTel support is basically just using https://learn.microsoft.com/en-us/dotnet/core/diagnostics/distributed-tracing, a more generic `Temporalio.Extensions.Tracing` project may make more sense (didn't want it part of main project because our oldest supported .NET versions would require `System.Diagnostics.DiagnosticSource` as an explicit dependency which I was wanting to avoid).\r\n\r\nThe problem I am at now is that I have to use https://github.com/open-telemetry/opentelemetry-dotnet/blob/main/src/OpenTelemetry.Api/Context/Propagation/BaggagePropagator.cs and https://github.com/open-telemetry/opentelemetry-dotnet/blob/main/src/OpenTelemetry.Api/Context/Propagation/CompositeTextMapPropagator.cs to serialize spans to Temporal headers that are compatible with other languages who have OTel too. I am digging into if I can use .NET's `DistributedContextPropagator` easily without making the user do too much work or if I am going to need to make OTel helpers for them and therefore an OTel specific project again.\r\n\r\nActive research is ongoing.","createdAt":"2023-05-26T16:24:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564635012","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5dQqvB","author":{"login":"johnkattenhorn"},"authorAssociation":"NONE","body":"On the Span tracking I was thinking about the same earlier today too.\r\n\r\nThe only other solution I’ve used before was specific to AppInsights Spans so not going to work with OTel.\r\n\r\nLet me know where you land, and I can ask our team to get involved and share some opinion / insight.\r\n\r\nThanks\r\n\r\nJK\r\n\r\nFrom: Chad Retz ***@***.***>\r\nSent: Friday, May 26, 2023 9:24 AM\r\nTo: temporalio/sdk-dotnet ***@***.***>\r\nCc: John Kattenhorn ***@***.***>; Comment ***@***.***>\r\nSubject: [EXTERNAL]:Re: [temporalio/sdk-dotnet] [Feature Request] OpenTelemetry support (Issue #56)\r\n\r\nCAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.\r\n\r\n\r\nThis is only for tracing. OTel is already supported for metrics (you can create your own TemporalRuntime w/ metrics telemetry options set to an OTel gRPC URL and use it throughout the life of your application). https://docs.temporal.io/references/sdk-metrics are the metrics we track.\r\n\r\nI have been working on the tracing part just this morning and I'll jot some notes down here. So it will be interceptor powered (like Python's, see https://github.com/temporalio/sdk-python/blob/main/temporalio/contrib/opentelemetry.py and https://github.com/temporalio/samples-python/tree/main/open_telemetry), but I am struggling with how best to split the project up.\r\n\r\nSo I was first thinking of a separate project for Temporalio.Extensions.OpenTelemetry, but since OTel support is basically just using https://learn.microsoft.com/en-us/dotnet/core/diagnostics/distributed-tracing, a more generic Temporalio.Extensions.Tracing project may make more sense (didn't want it part of main project because our oldest supported .NET versions would require System.Diagnostics.DiagnosticSource as an explicit dependency which I was wanting to avoid).\r\n\r\nThe problem I am at now is that I have to use https://github.com/open-telemetry/opentelemetry-dotnet/blob/main/src/OpenTelemetry.Api/Context/Propagation/BaggagePropagator.cs and https://github.com/open-telemetry/opentelemetry-dotnet/blob/main/src/OpenTelemetry.Api/Context/Propagation/CompositeTextMapPropagator.cs to serialize spans to Temporal headers that are compatible with other languages who have OTel too. I am digging into if I can use .NET's DistributedContextPropagator easily without making the user do too much work or if I am going to need to make OTel helpers for them and therefore an OTel specific project again.\r\n\r\nActive research is ongoing.\r\n\r\n—\r\nReply to this email directly, view it on GitHub<https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564635012>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/AAEWOOJVLRCQPGEILTCT5ATXIDKLFANCNFSM6AAAAAAXLGDOCM>.\r\nYou are receiving this because you commented.Message ID: ***@***.******@***.***>>\r\n","createdAt":"2023-05-26T16:39:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564650433","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5dRxou","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"@johnkattenhorn - Maybe you can help me here. I have restored an activity context and baggage via propagation similar to [this](https://github.com/open-telemetry/opentelemetry-dotnet/blob/a5b14aa76d5d8880368a0f4ce9b5225296e660fc/examples/MicroserviceExample/Utils/Messaging/MessageReceiver.cs#L57). This has the [ActivityContext](https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.activitycontext) but there's no way I see to [attach current context](https://opentelemetry.io/docs/specs/otel/context/#attach-context) in OpenTelemetry terms given the `ActivityContext` only. Other OTel SDKs let me set the \"current\" context, but .NET only allows the \"current\" activity and I don't want to create a new activity with the parent, I just want to restore the parent to \"current\". Any ideas?","createdAt":"2023-05-26T20:55:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564940846","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5dR0Jt","author":{"login":"johnkattenhorn"},"authorAssociation":"NONE","body":"Oh man sound like it works like AppInsights, inthink we had to recreate the activity as you could only set the parentID in the constructor and copy everything across.\n\nI'm going to ask someone from our team but just boarding a flight back to the UK so might be a delay.","createdAt":"2023-05-26T21:05:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564951149","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5dR3MI","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks! Definitely no rush (can be days/weeks, don't waste weekend time). I also have a question out on `#otel-dotnet` on CNCF Slack. I am sure I'm just missing something. Maybe that's what I have to do is create the activity and just set all the fields I can and know about and set it as `Activity.Current`.","createdAt":"2023-05-26T21:13:50Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/56#issuecomment-1564963592","viewerDidAuthor":false}],"createdAt":"2023-04-25T15:42:09Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7znQ","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":56,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Feature Request] OpenTelemetry support","updatedAt":"2023-06-07T21:39:13Z","url":"https://github.com/temporalio/sdk-dotnet/issues/56"}
