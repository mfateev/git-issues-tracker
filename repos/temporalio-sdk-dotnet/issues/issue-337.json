{"assignees":[],"author":{"id":"MDQ6VXNlcjExNDc5MzI5","is_bot":false,"login":"robcao","name":"Robert Cao"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\n<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->\r\n\r\nFailures from client_rpc_call invocations currently only contain the message from the failure.\r\n\r\nThe stack trace from a failure to check health for instance, looks like this:\r\n\r\n```C#\r\nTemporalio.Exceptions.RpcException: transport error\r\n   at Temporalio.Bridge.Client.CallAsync[T](RpcService service, String rpc, IMessage req, MessageParser`1 resp, Boolean retry, IEnumerable`1 metadata, Nullable`1 timeout, Nullable`1 cancellationToken)\r\n   at Temporalio.Client.TemporalConnection.CheckHealthAsync(RpcService service, RpcOptions options)\r\n```\r\n\r\nIn comparison, the stack trace from a failure to connect the client is more informative, and looks like this:\r\n\r\n```C#\r\nSystem.InvalidOperationException: Connection failed: Server connection error: tonic::transport::Error(Transport, ConnectError(ConnectError(\"tcp connect error\", Os { code: 10061, kind: ConnectionRefused, message: \"No connection could be made because the target machine actively refused it.\" })))\r\n   at Temporalio.Bridge.Client.ConnectAsync(Runtime runtime, TemporalConnectionOptions options)\r\n   at Temporalio.Client.TemporalConnection.GetBridgeClientAsync()\r\n```\r\n\r\n\r\n### Describe the solution you'd like\r\n\r\n<!-- A clear and concise description of what you want to happen. SCREENSHOTS OR CODE SAMPLES ARE VERY HELPFUL -->\r\n\r\nI would like instances of `RpcException` raised from the `client_rpc_callback` method to contain more information about the failure, comparative to what is currently raised from failures in the `client_connect` method.\r\n\r\nFor example, instead of `transport error`, perhaps the exception could contain more information, such as\r\n\r\n`Error: Status { code: Unknown, message: \"transport error\", source: Some(tonic::transport::Error(Transport, hyper::Error(Io, Kind(BrokenPipe)))) }`\r\n\r\nHaving this kind of additional context available is very helpful for debugging problems. Doing a cursory search shows that `transport error` can have multiple different root causes.\r\n\r\nHaving the gRPC status code surfaced in the error message is helpful too.\r\n\r\n\r\n### Additional context\r\n\r\nhttps://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio/Bridge/src/client.rs#L258\r\n\r\nIt looks like here, the `failureDetails` is always being sent back to the .NET side as null. I am not sure if this is intentional or not (maybe the Rust side is always sending null), or maybe `failureDetails` here references the Temporal API FailureDetails proto, in which case it wouldn't be applicable at all.\r\n\r\nI'm not certain if this will require work to be on in the core sdk first.\r\n","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs6LlOYs","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Sorry it took me so long to see this. This is due to the default error string of Tonic in cases where it's not a status. There is a difference between connection errors and RPC errors in this case.\r\n\r\n> perhaps the exception could contain more information, such as\r\n\r\n> Error: Status { code: Unknown, message: \"transport error\", source: Some(tonic::transport::Error(Transport, hyper::Error(Io, Kind(BrokenPipe)))) }\r\n\r\nBut it's not a `Status` with a code and a source. We will investigate and see if there's more we can extract from the non-status error beyond it's default `fmt::Display`.\r\n\r\n> It looks like here, the failureDetails is always being sent back to the .NET side as null\r\n\r\nThis is very specifically for gRPC \"details\" which is additional protobuf information, it's not for general purpose use","createdAt":"2024-09-10T19:00:20Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/337#issuecomment-2341791276","viewerDidAuthor":false}],"createdAt":"2024-08-28T15:38:18Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7znQ","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":337,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Include more details from tonic from failed client_rpc_call invocations","updatedAt":"2024-09-10T19:01:32Z","url":"https://github.com/temporalio/sdk-dotnet/issues/337"}
