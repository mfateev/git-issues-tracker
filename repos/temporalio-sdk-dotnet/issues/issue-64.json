{"assignees":[],"author":{"id":"MDQ6VXNlcjI3MDQxMzk=","is_bot":false,"login":"cgillum","name":"Chris Gillum"},"body":"### What are you really trying to do?\r\n\r\nTrying to run a workflow that doesn't do anything (as a test).\r\n\r\n### Describe the bug\r\n\r\nThe `[WorkflowRun]` method starts and completes, but is replayed continuously until it times out.\r\n\r\nThe dashboard then shows the following failure details in the `WorkflowTaskFailed` event.\r\n\r\n```json\r\n{\r\n  \"message\": \"Workflow with ID eaa5ad6b-764a-486d-9d49-65a2b2adbf12 deadlocked after 00:00:02\",\r\n  \"source\": \"\",\r\n  \"stackTrace\": \"   at Temporalio.Worker.WorkflowWorker.HandleActivationAsync(IPayloadCodec codec, WorkflowActivation act)\",\r\n  \"encodedAttributes\": null,\r\n  \"cause\": null,\r\n  \"applicationFailureInfo\": {\r\n    \"type\": \"InvalidOperationException\",\r\n    \"nonRetryable\": false,\r\n    \"details\": null\r\n  }\r\n}\r\n```\r\n\r\nAdditionally, I get this warning banner asking me to open a support request:\r\n\r\n![image](https://user-images.githubusercontent.com/2704139/236961543-841de8c6-7cee-408d-85fa-4af49b37df8a.png)\r\n\r\n\r\n### Minimal Reproduction\r\n\r\nI can't easily share the full project since it's very advanced/complicated. However, this is basically the workflow that reproduces the problem:\r\n\r\n```csharp\r\n[Workflow]\r\nclass WorkflowShim\r\n{\r\n    public WorkflowShim() { }\r\n\r\n    [WorkflowRun]\r\n    public Task Run() { return Task.CompletedTask; }\r\n}\r\n```\r\n\r\nAdding a simple delay to the `[WorkflowRun]` fixes the problem - e.g.:\r\n\r\n```csharp\r\n[WorkflowRun]\r\npublic async Task Run()\r\n{\r\n    await Workflow.DelayAsync(TimeSpan.FromSeconds(3));\r\n}\r\n```\r\n\r\nObviously not a big issue since an empty workflow isn't a real use case, but it is a confusing error message. It might be realistic if, for example, a developer writes code that only conditionally causes a workflow to actually take some action.\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: **Windows 11, x64**\r\n- Temporal Version: `temporal version 0.8.0 (server 1.20.1) (ui 2.13.3)`\r\n- SDK version: `0.1.0-alpha4`\r\n- Are you using Docker or Kubernetes or building Temporal from source? **Running from the `temporal` CLI.**\r\n\r\n### Additional context\r\n\r\n\r\n","closedAt":"2023-06-08T13:44:48Z","comments":[{"id":"IC_kwDOInL6Hs5by_VB","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Thanks for the report! I'll investigate soon.\r\n\r\nI know we have test cases (e.g. https://github.com/temporalio/sdk-dotnet/blob/53e3862dbc0a426f3d6b30fc80fd73f4ccc8d43b/tests/Temporalio.Tests/Worker/WorkflowWorkerTests.cs#L32) and samples (e.g. https://github.com/temporalio/samples-dotnet/blob/2b9d8e300b9cac8634d1963c967009567de15269/src/AspNet/Worker/MyWorkflow.workflow.cs#L13) that just return `Task.FromResult`. I wonder if I just messed something up for `Task` sans return type. I will replicate and fix","createdAt":"2023-05-09T13:07:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/64#issuecomment-1540093249","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5cZ_bT","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"I cannot replicate this. In my `tests/Temporalio.Tests/Worker/WorkflowWorkerTests.cs` I added:\r\n\r\n```csharp\r\n    [Workflow]\r\n    public class CompletedTaskWorkflow\r\n    {\r\n        public static readonly CompletedTaskWorkflow Ref = WorkflowRefs.Create<CompletedTaskWorkflow>();\r\n\r\n        [WorkflowRun]\r\n        public Task RunAsync() => Task.CompletedTask;\r\n    }\r\n\r\n    [Fact]\r\n    public async Task ExecuteWorkflowAsync_CompletedTask_Succeeds()\r\n    {\r\n        await ExecuteWorkerAsync<CompletedTaskWorkflow>(async worker =>\r\n        {\r\n            await Env.Client.ExecuteWorkflowAsync(\r\n                CompletedTaskWorkflow.Ref.RunAsync,\r\n                new(id: $\"workflow-{Guid.NewGuid()}\", taskQueue: worker.Options.TaskQueue!));\r\n        });\r\n    }\r\n```\r\n\r\nAnd it succeeds as expected. Granted this is against `main` but I don't know of any changes since last release that would have affected this. Can you provide a standalone replication?","createdAt":"2023-05-16T20:29:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/64#issuecomment-1550317267","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs5eVKhX","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Closing due to no response.","createdAt":"2023-06-08T13:44:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/64#issuecomment-1582606423","viewerDidAuthor":false}],"createdAt":"2023-05-09T00:05:53Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":64,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Workflow that completes with no actions times out with deadlock error","updatedAt":"2023-06-08T13:44:49Z","url":"https://github.com/temporalio/sdk-dotnet/issues/64"}
