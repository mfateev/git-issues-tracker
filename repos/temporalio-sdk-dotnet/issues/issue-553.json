{"assignees":[],"author":{"id":"MDQ6VXNlcjU3NTEwOQ==","is_bot":false,"login":"kimpenhaus","name":"Marcus Kimpenhaus"},"body":"### Is your feature request related to a problem? Please describe.\n\nWe are using the ITemporalClient -> OperatorService and WorkflowService to create/make modifications on Temporal namespaces from within a Kubernetes operator. To verify our logic runs as intended we would like to write unit test (we are using NSubstitute). To setup and mock each use-case we need to substitute the corresponding services e.g OperatorService (ITemporalClient and ITemporalConnection are already interfaces).\n\nTo substitute the intended methods they need to be either virtual or come from an interface.\n\n### Describe the solution you'd like\n\nFrom what I saw you already did something similar in #419 - so marking the methods in OperatorService.Rpc and WorkflowService.Rpc virtual would be a good enough solution,  extracting interfaces would maybe be even better.","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs7OT_FI","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> so marking the methods in OperatorService.Rpc and WorkflowService.Rpc virtual would be a good enough solution\n\nWe would rather not mark every method in there as virtual unless we really have to. We usually discourage mocking these kinds of things instead of using an ephemeral dev server in your tests (e.g. `Temporalio.Testing.WorkflowEnvironment.StartLocalAsync`) since that will truly test your calls as opposed to assuming how Temporal server behavior is. Regardless, all of these calls delegate to the abstract `InvokeRpcAsync`, which is what others have used to mock/impl when they must, does that work for you?","createdAt":"2025-10-29T12:48:37Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/553#issuecomment-3461345608","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs7OUDti","author":{"login":"kimpenhaus"},"authorAssociation":"NONE","body":"@cretz thanks for getting back such quickly. could you point me to a sample for both:\n\n- the using of an ephemeral dev server \n- mock of the `InvokeRpcAsync`\n\nthat would be highly appreciated and I could check if that will already help us - thanks!","createdAt":"2025-10-29T12:52:12Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/553#issuecomment-3461364578","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs7OUPBH","author":{"login":"kimpenhaus"},"authorAssociation":"NONE","body":"I checked with the `InvokeRpcAsync`: main problem with [NSubstitute](https://github.com/nsubstitute/NSubstitute) is that it only supports public api and as far as I can see `InvokeRpcAsync` is `protected` so I don't think this will work out.","createdAt":"2025-10-29T13:03:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/553#issuecomment-3461410887","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs7OUb2G","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> the using of an ephemeral dev server\n\nAll tests in samples that need servers use https://github.com/temporalio/samples-dotnet/blob/main/tests/WorkflowEnvironment.cs with xunit. But you can simply use it in individual tests like https://github.com/temporalio/samples-dotnet/blob/4e185e8917166ace5875f46ff9c1e913e63bf910/tests/WorkflowUpdate/WorkflowUpdateTests.cs#L17-L42. The client from that environment has the operator service working/available.\n\nIf you need general support or have questions about how to use certain SDK aspects, feel free to join us on the `#dotnet-sdk` channel on [Slack](https://t.mp/slack) or [the forums](https://community.temporal.io/).\n\n> main problem with [NSubstitute](https://github.com/nsubstitute/NSubstitute) is that it only supports public api and as far as I can see InvokeRpcAsync is protected so I don't think this will work out.\n\nThat seems to be a limitation of that one library. But can't you do something like:\n\n```csharp\n    public abstract class MyWorkflowService : WorkflowService\n    {\n        protected override Task<T> InvokeRpcAsync<T>(\n            string rpc, IMessage req, MessageParser<T> resp, RpcOptions? options = null) =>\n            InvokeRpcPublicAsync(rpc, req, resp, options);\n\n        public abstract Task<T> InvokeRpcPublicAsync<T>(\n            string rpc, IMessage req, MessageParser<T> resp, RpcOptions? options = null)\n            where T : IMessage<T>;\n    }\n```\n\nor\n\n```csharp\n    public class MyWorkflowService(\n        Func<string, IMessage, MessageParser, RpcOptions?, Task<IMessage>> OnInvoke) : WorkflowService\n    {\n        protected override async Task<T> InvokeRpcAsync<T>(\n            string rpc, IMessage req, MessageParser<T> resp, RpcOptions? options = null) =>\n            (T)await OnInvoke(rpc, req, resp, options);\n    }\n```\n\nor similar to make it suitable?","createdAt":"2025-10-29T13:16:01Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/553#issuecomment-3461463430","viewerDidAuthor":false}],"createdAt":"2025-10-29T12:21:36Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7znQ","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":553,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] OperatorService (RPC) and WorkflowService (RPC) members are marked virtual or inherit from interface","updatedAt":"2025-10-29T13:18:55Z","url":"https://github.com/temporalio/sdk-dotnet/issues/553"}
