{"assignees":[],"author":{"id":"MDQ6VXNlcjExODg5NjI3","is_bot":false,"login":"marcusbooyah","name":"Marcus Bowyer"},"body":"### What are you really trying to do?\r\n\r\nTrying to add two versions of the same workflow using dependency injection.\r\n\r\n### Describe the bug\r\n\r\nIt's possible to add multiple workflows using this method, the part that makes it break is having two workflows with the same name in the `WorkflowAttribute`, even though they are being registered with different build IDs.\r\n\r\n I talked with @cretz who said:\r\n> Yes, this is a bug. This is because the DI setup predates versioning, so we only supported one worker per task queue in a service collection: [https://github.com/temporalio/sdk-dotnet/blob/c6b7aca05cdd2b61e4b99098f3f390469232[â€¦]3a4a/src/Temporalio.Extensions.Hosting/TemporalWorkerService.cs](https://github.com/temporalio/sdk-dotnet/blob/c6b7aca05cdd2b61e4b99098f3f3904692323a4a/src/Temporalio.Extensions.Hosting/TemporalWorkerService.cs#L90). We need to change what we uniquely identify options set as on the container to include build ID\r\n\r\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\r\n\r\n### Minimal Reproduction\r\n```csharp\r\n[Workflow(\"my-workflow\")]\r\npublic class TestWorkflow\r\n{\r\n    [WorkflowRun]\r\n    public Task RunAsync() => Workflow.DelayAsync(TimeSpan.FromSeconds(3));\r\n}\r\n\r\n[Workflow(\"my-workflow\")]\r\npublic class TestWorkflowV2\r\n{\r\n    [WorkflowRun]\r\n    public Task RunAsync() => Workflow.DelayAsync(TimeSpan.FromSeconds(1));\r\n}\r\n\r\nstatic async Task Main(string[] args)\r\n{\r\n    await using var env = await WorkflowEnvironment.StartTimeSkippingAsync();\r\n\r\n    IHost host = Host.CreateDefaultBuilder()\r\n        .ConfigureServices(services =>\r\n        {\r\n            services.AddSingleton(env.Client);\r\n            services\r\n                .AddHostedTemporalWorker(\"task-queue\")\r\n                    .ConfigureOptions(options =>\r\n                    {\r\n                        options.UseWorkerVersioning  = true;\r\n                        options.BuildId                            = \"1.0\";\r\n                    })\r\n                    .AddWorkflow<TestWorkflow>();\r\n\r\n            services\r\n                .AddHostedTemporalWorker(\"task-queue\")\r\n                    .ConfigureOptions(options =>\r\n                    {\r\n                        options.UseWorkerVersioning  = true;\r\n                        options.BuildId                           = \"2.0\";\r\n                    })\r\n                    .AddWorkflow<TestWorkflowV2>();\r\n        })\r\n        .Build();\r\n\r\n    host.Run();\r\n}\r\n```\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: [Windows]\r\n- Temporal Version: SDK 1.0.0\r\n\r\n","closedAt":"2024-04-16T12:47:43Z","comments":[{"id":"IC_kwDOInL6Hs6mmKPY","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"ðŸ’¥ Note, in #451 we have changed some behavior here where we now no longer assume this non-GA-will-be-removed form versioning when build ID is present.","createdAt":"2025-04-10T19:55:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/212#issuecomment-2795021272","viewerDidAuthor":false}],"createdAt":"2024-03-28T20:12:11Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":212,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] Cannot add multiple versions of a workflow using DI","updatedAt":"2025-04-10T19:55:25Z","url":"https://github.com/temporalio/sdk-dotnet/issues/212"}
