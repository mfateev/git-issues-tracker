{"assignees":[],"author":{"id":"MDQ6VXNlcjIzMTY5ODk=","is_bot":false,"login":"tdg5","name":"Danny Guinther"},"body":"### Is your feature request related to a problem? Please describe.\r\n\r\nInterceptors offer a means of handling cross-cutting concerns in a way that insulates any given Activity instance from those cross-cutting concerns. However, if a given cross-cutting concern depends on a service provided by the scoped `IServiceProvider` instance, this insolation can't be maintained because only Activities can have dependencies injected via constructor injection.\r\n\r\nAs far as I understand things, there's no philosophical reason an `ActivityInboundInterceptor` couldn't have the scoped `IServiceProvider` instance made available when the `ExecuteActivityAsync` method is invoked.\r\n\r\n### Describe the solution you'd like\r\n\r\nConstructor injection wouldn't work for `ActivityInboundInterceptor` because the interceptors don't share the same lifetime as an Activity. However, I believe that when `ExecuteActivityAsync`, it should be in the context of an Activity. I'm not looking for method signature injection, I'd be satisfied with just getting access to the `IServiceProvider` instance and having to pull out dependencies by other means.\r\n\r\nThat said, this is all complicated by the fact that `Temporalio.Worker.Interceptors` is agnostic of `IServiceProvider` and or `Microsoft.Extensions.DependencyInjection` and the creation of the scoped `IServiceProvider` is locked up in [`Temporalio.Extensions.Hosting.ServiceProviderExtensions`](https://github.com/temporalio/sdk-dotnet/blob/main/src/Temporalio.Extensions.Hosting/ServiceProviderExtensions.cs#L66-L70).\r\n\r\nSomething like ASP.NET's [`HttpContextAccessor`](https://github.com/dotnet/aspnetcore/blob/main/src/Http/Http/src/HttpContextAccessor.cs) could be repurposed as a ServiceLocator for the scoped `IServiceProvider` instance, but it's not so elegant.\r\n\r\n### Additional context\r\n\r\nI'm happy to help make this happen if there's a path forward, but I don't see an implementation I can obviously make a pull request from.\r\n","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs6SgKrK","author":{"login":"tdg5"},"authorAssociation":"NONE","body":"Thinking about this some more, I think I'd vote against changing the method signature of `ExecuteActivityAsync`. I think some mechanism completely separate from the `ActivityInboundInterceptor` is the cleanest (er, decoupled?) option that allows for keeping the knowledge about `IServiceProvider` hidden from the more agnostic portions of `Temporalio`.\r\n\r\nI opened https://github.com/temporalio/sdk-dotnet/pull/364 with a sketch for discussion.","createdAt":"2024-11-05T18:39:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/363#issuecomment-2457905866","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs6TRmlD","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":":+1: Discussing on PR.","createdAt":"2024-11-12T15:38:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/363#issuecomment-2470865219","viewerDidAuthor":false}],"createdAt":"2024-11-05T15:39:28Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7znQ","name":"enhancement","description":"New feature or request","color":"a2eeef"}],"milestone":null,"number":363,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"[Feature Request] Make scoped IServiceProvider available to ActivityInboundInterceptor","updatedAt":"2024-11-12T15:38:03Z","url":"https://github.com/temporalio/sdk-dotnet/issues/363"}
