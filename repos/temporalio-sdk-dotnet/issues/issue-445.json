{"assignees":[],"author":{"id":"MDQ6VXNlcjEzMDY0NzY=","is_bot":false,"login":"sgeraud","name":"Stephane Geraud"},"body":"### What are you really trying to do?\n\n<!-- \nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \n-->\n\nI am trying to execute a Go Child Workflow from a .NET Parent Workflow and wait for its completion before moving forward with the rest of the code.\n\n### Describe the bug\n\n<!-- A clear and concise description of what the bug is. -->\n\n<!-- If applicable, add screenshots or code blocks to help explain your problem. You can also use [Loom](http://loom.com/) to do short, free video bug reports. -->\n\nIn the .NET Parent Workflow, awaiting for the completion of a Go Child Workflow will hang if this Child Workflow does not return a value. The rest of the code won't be executed.\n\nIt looks like there is an interaction issue between Workflows using different SDKs Go and .NET, because if both Parent and Child Workflows are using the .NET SDK, there won't be any issue.\n\n### Minimal Reproduction\n\n<!-- \nModify our hello world templates to demonstrate:\n\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\n- Go: https://github.com/temporalio/money-transfer-project-template-go\n- Java: https://github.com/temporalio/money-transfer-project-template-java\n- PHP: https://github.com/temporalio/samples-php#samples\n-->\n\nLet's take a .NET Workflow that is doing two simple things:\n\n1. Call a Child Workflow\n2. Pause the execution using a Timer\n\n```csharp\n[Workflow]\npublic class SampleParentWorkflow\n{\n    [WorkflowRun]\n    public async Task RunAsync()\n    {\n        await Workflow.ExecuteChildWorkflowAsync(\n            \"SampleChildWorkflow\",\n            [],\n            new ChildWorkflowOptions\n            {\n                Id = \"example\",\n            });\n\n        await Workflow.DelayAsync(TimeSpan.FromSeconds(5));\n    }\n}\n```\n\nLet's define `SampleChildWorkflow` as a very simple Go Workflow. It does nothing, and does not return any error.\n\n```go\nfunc SampleChildWorkflow(ctx Workflow.Context) error {\n\treturn nil\n}\n```\n\nIf we run the `SampleParentWorkflow` Workflow, the Child Workflow will complete successfully but the `DelayAsync` will never be executed.\n\nHere is the value of the _Child Workflow Execution Completed_ in the Event History:\n\n```json\n{\n  \"eventId\": \"10\",\n  \"eventTime\": \"2025-04-07T16:13:29.783225435Z\",\n  \"eventType\": \"ChildWorkflowExecutionCompleted\",\n  \"taskId\": \"1050489\",\n  \"childWorkflowExecutionCompletedEventAttributes\": {\n    \"namespace\": \"default\",\n    \"namespaceId\": \"13bf8056-cbc3-4fb1-87d8-44e4baa6a3a5\",\n    \"WorkflowExecution\": {\n      \"WorkflowId\": \"d5fd70a5-faf4-4f19-9148-9f748c58274a-sample\",\n      \"runId\": \"5b932430-6e56-4b81-85e3-ba6409994820\"\n    },\n    \"WorkflowType\": { \"name\": \"SampleChildWorkflow\" },\n    \"initiatedEventId\": \"5\",\n    \"startedEventId\": \"6\"\n  },\n  \"links\": []\n}\n```\n\nPlease note that `childWorkflowExecutionCompletedEventAttributes.result.payloads` is missing.\n\nLet's update the Child Workflow to return a `nil` value alongside with an eventual error:\n\n```go\nfunc SampleChildWorkflow(ctx Workflow.Context) ([]int, error) {\n\treturn nil, nil\n}\n```\n\nIn the Event History, `childWorkflowExecutionCompletedEventAttributes.result.payloads` now equals `[null]`.\n\nFinally, let's update the Child Workflow to return a non-null value. I chose `struct{}{}` because it is the smallest value we can return, but we would observe the same behavior with any other non-null value.\n\n```go\nfunc SampleChildWorkflow(ctx Workflow.Context) (struct{}, error) {\n\treturn struct{}{}, nil\n}\n```\n\nIf we run again the `SampleParentWorkflow` Workflow, the Child Workflow will complete successfully and the `DelayAsync` will now be executed as expected.\n\nIn the Event History, `childWorkflowExecutionCompletedEventAttributes.result.payloads` now equals `[{}]`.\n\nIf a Parent Workflow calls a similar child Workflow, with both Parent and Child Workflows using the .NET SDK, there won't be any issue.\nWe would see `childWorkflowExecutionCompletedEventAttributes.result.payloads` set to `[{}]` in the Event History when the .NET Child Workflow does not return any value.\n\nIt looks like the Go SDK is omitting the `result` field when the Child Workflow return a `nil` value and that the .NET SDK is not expecting this field to be missing, which prevents the async task to complete.\n\n### Environment/Versions\n\n<!-- Please complete the following information where relevant. -->\n\n- OS and processor: Linux amd64\n- Temporal Version: `temporalio/server 1.27.2.0`, `sdk-dotnet 1.4.0`, `sdk-go 1.33.1`\n- Are you using Docker or Kubernetes or building Temporal from source? Temporal on Kubernetes, and also reproducible locally using `temporalio/cli 1.3.0`\n\n### Additional context\n\n<!-- Add any other context about the problem here. -->\n\nEdited: It was initially mentioned that the problem occurs with a nil value, whereas it actually happens when the return value is missing.","closedAt":"2025-04-10T17:43:55Z","comments":[{"id":"IC_kwDOInL6Hs6mFEOf","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"> I am trying to execute a Go Child Workflow from a .NET Parent Workflow\n\nMay be obvious, but you need to make sure the Go worker and .NET worker are on different task queues.\n\n> It looks like the Go SDK is omitting the result field when the Child Workflow return a nil value and that the .NET SDK is not expecting this field to be missing, which prevents the async task to complete.\n\nThis is my guess too. Looking at the code, we are also not properly presenting the internal errors here. We will fix both of these issues, thanks for reporting!","createdAt":"2025-04-08T12:54:41Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-dotnet/issues/445#issuecomment-2786345887","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs6mGINd","author":{"login":"sgeraud"},"authorAssociation":"NONE","body":"Thank you for your quick response!\n\n> May be obvious, but you need to make sure the Go worker and .NET worker are on different task queues.\n\nYes, I confirm they are of different task queues.","createdAt":"2025-04-08T14:21:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/445#issuecomment-2786624349","viewerDidAuthor":false}],"createdAt":"2025-04-08T09:28:24Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":445,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] Go SDK Child Workflow returning no values causes await to hang in .NET","updatedAt":"2025-04-10T17:43:55Z","url":"https://github.com/temporalio/sdk-dotnet/issues/445"}
