{"assignees":[],"author":{"id":"MDQ6VXNlcjEyODY4MzQw","is_bot":false,"login":"cfauchere","name":"Clement"},"body":" ### What are you really trying to do?\n\n  Running integration tests for a .NET 8 application that uses Temporal workflows. Tests run in CI on Linux (Ubuntu) with an external Temporal server container (temporalio/temporal:latest).\n\n ### Describe the bug\n\n  The test host process crashes with SIGSEGV (signal 11) while the Temporal worker is polling for workflow activations. The crash happens intermittently (flaky) - tests pass locally on Windows but crash randomly in Linux CI.\n\n  Shortly before the crash, this warning appears in logs:\n  WARN temporal_sdk_core::worker: Activity heartbeat failed. task_token=... details=UnknownActivity\n\n  ### Stack trace from crash dump:\n  Temporalio.Bridge.Interop.Methods.temporal_core_worker_poll_workflow_activation(TemporalCoreWorker*, Void*, IntPtr)\n  ILStubClass.IL_STUB_PInvoke(TemporalCoreWorker*, Void*, IntPtr)\n  Temporalio.Bridge.Worker.PollWorkflowActivationAsync()\n  Temporalio.Worker.WorkflowWorker+<ExecuteAsync>d__10.MoveNext()\n  ...\n  System.Threading.PortableThreadPool+WorkerThread.WorkerThread\n\n  The crash occurs in the native Rust bridge during poll_workflow_activation, not during execution of any user workflow/activity code.\n\n  ### Minimal Reproduction\n\n  Unable to provide minimal repro - the crash is intermittent and only occurs in Linux CI environment, not locally on Windows. The test runs Temporal workflows with activities that use heartbeats.\n\n  ### Environment/Versions\n\n  - OS and processor: Linux x86_64 (Ubuntu, Azure DevOps hosted agent)\n  - Temporal .NET SDK Version: 1.8.0\n  - Temporal Server: temporalio/temporal:latest (Docker container, server start-dev)\n  - .NET Version: 8.0\n  - Works on: Windows x64 (local development)\n  - Fails on: Linux x64 (CI)","closedAt":null,"comments":[{"id":"IC_kwDOInL6Hs7amawb","author":{"login":"cfauchere"},"authorAssociation":"NONE","body":"```\nFull stack\n        Child SP               IP Call Site\n00007EF4E3FFA060 00007f364e710813 [InlinedCallFrame: 00007ef4e3ffa060] Temporalio.Bridge.Interop.Methods.temporal_core_worker_poll_workflow_activation(Temporalio.Bridge.Interop.TemporalCoreWorker*, Void*,\nIntPtr)\n00007EF4E3FFA060 00007f35d4478e06 [InlinedCallFrame: 00007ef4e3ffa060] Temporalio.Bridge.Interop.Methods.temporal_core_worker_poll_workflow_activation(Temporalio.Bridge.Interop.TemporalCoreWorker*, Void*,\nIntPtr)\n00007EF4E3FFA050 00007F35D4478E06 ILStubClass.IL_STUB_PInvoke(Temporalio.Bridge.Interop.TemporalCoreWorker*, Void*, IntPtr)\n00007EF4E3FFA0E0 00007F35D4A1B20C Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15.MoveNext()\n00007EF4E3FFA1E0 00007F35D44829BB System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15, Temporalio]](<PollWorkflowActivationAsync>d__15\nByRef) [/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncMethodBuilderCore.cs @ 38]\n00007EF4E3FFA250 00007F35D4482920 System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1[[System.__Canon, System.Private.CoreLib]].Start[[Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15,\nTemporalio]](<PollWorkflowActivationAsync>d__15 ByRef) [/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 35]\n00007EF4E3FFA280 00007F35D44828C2 Temporalio.Bridge.Worker.PollWorkflowActivationAsync()\n00007EF4E3FFA2D0 00007F35D44819AC Temporalio.Worker.WorkflowWorker+<ExecuteAsync>d__10.MoveNext()\n00007EF4E3FFA4B0 00007F35D4489021 System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.Threading.Tasks.VoidTaskResult,\nSystem.Private.CoreLib],[Temporalio.Worker.WorkflowWorker+<ExecuteAsync>d__10, Temporalio]].ExecutionContextCallback(System.Object)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 289]\n00007EF4E3FFA4D0 00007F35D478CBA2 System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n[/_/src/libraries/System.Private.CoreLib/src/System/Threading/ExecutionContext.cs @ 179]\n00007EF4E3FFA520 00007F35D4488ED4 System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.Threading.Tasks.VoidTaskResult,\nSystem.Private.CoreLib],[Temporalio.Worker.WorkflowWorker+<ExecuteAsync>d__10, Temporalio]].MoveNext(System.Threading.Thread)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 368]\n00007EF4E3FFA570 00007F35D4488DCA System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.Threading.Tasks.VoidTaskResult,\nSystem.Private.CoreLib],[Temporalio.Worker.WorkflowWorker+<ExecuteAsync>d__10, Temporalio]].MoveNext()\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 346]\n00007EF4E3FFA590 00007F35D478D003 System.Runtime.CompilerServices.TaskAwaiter+<>c.<OutputWaitEtwEvents>b__12_0(System.Action, System.Threading.Tasks.Task)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/TaskAwaiter.cs @ 273]\n00007EF4E3FFA610 00007F35D47D20E5 System.Threading.Tasks.AwaitTaskContinuation.RunOrScheduleAction(System.Action, Boolean)\n[/_/src/libraries/System.Private.CoreLib/src/System/Threading/Tasks/TaskContinuation.cs @ 743]\n00007EF4E3FFA660 00007F35D478BA9B System.Threading.Tasks.Task.RunContinuations(System.Object) [/_/src/libraries/System.Private.CoreLib/src/System/Threading/Tasks/Task.cs @ 3483]\n00007EF4E3FFA700 00007F35D4994AA8 System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1[[System.__Canon, System.Private.CoreLib]].SetResult(System.__Canon)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 474]\n00007EF4E3FFA750 00007F35D4A1B3E9 Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15.MoveNext()\n00007EF4E3FFA850 00007F35D4484577 System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.__Canon,\nSystem.Private.CoreLib],[Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15, Temporalio]].ExecutionContextCallback(System.Object)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 289]\n00007EF4E3FFA870 00007F35D478CBA2 System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n[/_/src/libraries/System.Private.CoreLib/src/System/Threading/ExecutionContext.cs @ 179]\n00007EF4E3FFA8C0 00007F35D44843D6 System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.__Canon,\nSystem.Private.CoreLib],[Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15, Temporalio]].MoveNext(System.Threading.Thread)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 368]\n00007EF4E3FFA940 00007F35D448428A System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1+AsyncStateMachineBox`1[[System.__Canon,\nSystem.Private.CoreLib],[Temporalio.Bridge.Worker+<PollWorkflowActivationAsync>d__15, Temporalio]].MoveNext()\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/AsyncTaskMethodBuilderT.cs @ 346]\n00007EF4E3FFA960 00007F35D478D003 System.Runtime.CompilerServices.TaskAwaiter+<>c.<OutputWaitEtwEvents>b__12_0(System.Action, System.Threading.Tasks.Task)\n[/_/src/libraries/System.Private.CoreLib/src/System/Runtime/CompilerServices/TaskAwaiter.cs @ 273]\n00007EF4E3FFA9E0 00007F35D4A2300D System.Threading.Tasks.AwaitTaskContinuation.System.Threading.IThreadPoolWorkItem.Execute()\n[/_/src/libraries/System.Private.CoreLib/src/System/Threading/Tasks/TaskContinuation.cs @ 647]\n00007EF4E3FFAA40 00007F35D4764369 System.Threading.ThreadPoolWorkQueue.Dispatch() [/_/src/libraries/System.Private.CoreLib/src/System/Threading/ThreadPoolWorkQueue.cs @ 1010]\n00007EF4E3FFAAB0 00007F35CF08258B System.Threading.PortableThreadPool+WorkerThread.WorkerThread\n```","createdAt":"2025-12-17T22:52:03Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/579#issuecomment-3667504155","viewerDidAuthor":false},{"id":"IC_kwDOInL6Hs7azGi3","author":{"login":"cretz"},"authorAssociation":"MEMBER","body":"Interesting. We are also tracking a test flake at #577 that may be related (but maybe not, only thing they have in common is a segfault on tests, mostly non-Windows).","createdAt":"2025-12-18T15:22:21Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-dotnet/issues/579#issuecomment-3670829239","viewerDidAuthor":false}],"createdAt":"2025-12-17T22:50:42Z","labels":[{"id":"LA_kwDOInL6Hs8AAAABJH7zkA","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":579,"reactionGroups":[],"state":"OPEN","title":"[Bug] SIGSEGV crash in temporal_core_worker_poll_workflow_activation on Linux","updatedAt":"2025-12-18T15:28:10Z","url":"https://github.com/temporalio/sdk-dotnet/issues/579"}
