{"assignees":[],"author":{"id":"MDQ6VXNlcjIyMzI1MjQ=","is_bot":false,"login":"alexshtin","name":"Alex Shtin"},"body":"Currently we have `common` and `enums` packages which has all enums and shared messages. This was done basically to match Thrift layout and simplify migration process. This approach has some issues:\r\n1. Some messages are used by server only but lives in [this](https://github.com/temporalio/temporal-proto) shared repo.\r\n2. Enums values have to use prefixes to avoid conflicts.\r\n3. Package names as `common` is a bad practice and should not be used.\r\n\r\nThe proposal is to split `common` and `enums` packages into the many specific packages having messages and enums in them. And move server specific messages to [server repo](https://github.com/temporalio/temporal). This will:\r\n1. Make the repo looks nicer with clean names and only require messages/enums.\r\n2. Allow to avoid enum collisions and remove prefixes. Initial understanding was that it is not a big deal but now we see these bad names in CLI and on the Web. Also we are locked to gogo compiler and when we want to switch to protobuf v2 it's might be problematic.\r\n\r\nNew directory layout:\r\n```\r\npackagename\r\n  enum.proto\r\n  message.proto \r\n```\r\nFile names doesn't really matter for generated code but helps to organize proto objects themselves.\r\n\r\nI was able to extract following packages:\r\n```\r\ncommon\r\ndecision\r\nevent\r\nexecution\r\nfilter\r\nnamespace\r\nquery\r\nreplication\r\ntasklist\r\nversion\r\n```\r\nWith best of my knowledge I will move proto objects to these packages. Unfortunately `common` is still there, because for some objects I can't find a better place.\r\n\r\nServer will have same packages (as needed). Although due to `protoc` limitations file names can't be the same. Therefore server directory layout will be:\r\n```\r\npackagename\r\n  server_enum.proto\r\n  server_message.proto \r\n```\r\nOn Go side proto package imports should always use package alias with `pb` (very common among protobuf users) suffix:\r\n```\r\ncommonpb \"go.temporal.io/temporal-proto/common\"\r\neventpb \"go.temporal.io/temporal-proto/event\"\r\nexecutionpb \"go.temporal.io/temporal-proto/execution\"\r\nfilterpb \"go.temporal.io/temporal-proto/filter\"\r\nnamespacepb \"go.temporal.io/temporal-proto/namespace\"\r\nquerypb \"go.temporal.io/temporal-proto/query\"\r\n```\r\nand `genpb` suffix for server protos:\r\n```\r\neventgenpb \"github.com/temporalio/temporal/.gen/proto/event\"\r\ntokengenpb \"github.com/temporalio/temporal/.gen/proto/token\"\r\n```\r\n`commonproto` alias goes away.\r\n\r\nThis repo reorg is done by #16.","closedAt":"2020-04-14T19:16:06Z","comments":[],"createdAt":"2020-04-03T22:29:51Z","labels":[],"milestone":null,"number":18,"reactionGroups":[],"state":"CLOSED","title":"Decompose common and enums packages","updatedAt":"2020-04-14T19:16:06Z","url":"https://github.com/temporalio/api/issues/18"}
