{"assignees":[{"id":"MDQ6VXNlcjgwNDAzMzg=","login":"rustatian","name":"Valery Piashchynski","databaseId":0},{"id":"MDQ6VXNlcjk5NTk3NjE=","login":"seregazhuk","name":"Sergey Zhuk","databaseId":0}],"author":{"id":"MDQ6VXNlcjg3NzE0OQ==","is_bot":false,"login":"mzavatsky","name":"Maxim Zavatsky"},"body":"### What are you really trying to do?\r\n\r\nWe've started a quite complex workflow with timers and signals in production, and faced with unstable behaviour: some workflow executions are OK, some lead to workers' crashes and stuck forever.\r\n\r\n### Describe the bug\r\n\r\nAfter worker's restart the behaviour of queries and signals becomes unstable.\r\n\r\n### Minimal Reproduction\r\n\r\nTest workflow:\r\n```php\r\n#[WorkflowInterface]\r\nclass DummyWorkflow\r\n{\r\n    private int $startAtTimestamp;\r\n\r\n    private bool $shouldStop = false;\r\n\r\n    #[WorkflowMethod]\r\n    #[ReturnType(Type::TYPE_STRING)]\r\n    public function start(): string|\\Generator\r\n    {\r\n        $this->startAtTimestamp = Workflow::now()->getTimestamp();\r\n\r\n        yield Workflow::awaitWithTimeout(\r\n            120,\r\n            fn () => $this->shouldStop,\r\n        );\r\n\r\n        if ($this->shouldStop) {\r\n            return 'Stopped';\r\n        }\r\n\r\n        return 'Completed';\r\n    }\r\n\r\n    #[SignalMethod]\r\n    public function stop(): void\r\n    {\r\n        $this->shouldStop = true;\r\n    }\r\n\r\n    #[QueryMethod('payload')]\r\n    public function query(): object\r\n    {\r\n        return (object)[\r\n            'secondsFromStart' => time() - $this->startAtTimestamp,\r\n        ];\r\n    }\r\n}\r\n```\r\n\r\n#### Case 1: worker restart (e.g. after crash)\r\n1. Start workflow\r\n2. Reload workers with `rr reset`\r\n3. Try to query workflow\r\n\r\ntctl output:\r\n```\r\n$ tcl wf query -qt payload -w e5da1aee-a9fb-412b-9b96-35182203526b\r\nError: Query workflow failed.\r\nError Details: rpc error: code = InvalidArgument desc = workflow_process_handle_query: Workflow with the specified run identifier \"effaf1ce-82d8-4bc3-b9df-f66fd2e9ca61\" not found (type: LogicException, retryable: true)\r\n```\r\nTemporal log:\r\n```\r\n{\"level\":\"error\",\"ts\":\"2022-05-12T05:44:49.095Z\",\"msg\":\"query directly though matching on sticky failed, will not attempt query on non-sticky\",\"service\":\"history\",\"shard-id\":1,\"address\":\"172.19.0.14:7234\",\"shard-item\":\"0xc0004bac80\",\"component\":\"history-engine\",\"wf-namespace\":\"default\",\"wf-id\":\"e5da1aee-a9fb-412b-9b96-35182203526b\",\"wf-run-id\":\"55901692-8758-4870-a66a-a637d79d4698\",\"wf-query-type\":\"payload\",\"error\":\"workflow_process_handle_query: Workflow with the specified run identifier \\\"55901692-8758-4870-a66a-a637d79d4698\\\" not found (type: LogicException, retryable: true)\",\"logging-call-at\":\"historyEngine.go:884\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/service/history.(*historyEngineImpl).queryDirectlyThroughMatching\\n\\t/temporal/service/history/historyEngine.go:884\\ngo.temporal.io/server/service/history.(*historyEngineImpl).QueryWorkflow\\n\\t/temporal/service/history/historyEngine.go:790\\ngo.temporal.io/server/service/history.(*Handler).QueryWorkflow.func1\\n\\t/temporal/service/history/handler.go:968\\ngo.temporal.io/server/common/backoff.RetryContext\\n\\t/temporal/common/backoff/retry.go:125\\ngo.temporal.io/server/service/history.(*Handler).QueryWorkflow\\n\\t/temporal/service/history/handler.go:966\\ngo.temporal.io/server/api/historyservice/v1._HistoryService_QueryWorkflow_Handler.func1\\n\\t/temporal/api/historyservice/v1/service.pb.go:1401\\ngo.temporal.io/server/common/rpc/interceptor.(*RateLimitInterceptor).Intercept\\n\\t/temporal/common/rpc/interceptor/rate_limit.go:83\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1113\\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryInterceptor).Intercept\\n\\t/temporal/common/rpc/interceptor/telemetry.go:108\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngo.temporal.io/server/common/metrics.NewServerMetricsTrailerPropagatorInterceptor.func1\\n\\t/temporal/common/metrics/grpc.go:113\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngo.temporal.io/server/common/metrics.NewServerMetricsContextInjectorInterceptor.func1\\n\\t/temporal/common/metrics/grpc.go:66\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngo.temporal.io/server/common/rpc.ServiceErrorInterceptor\\n\\t/temporal/common/rpc/grpc.go:131\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1118\\ngo.temporal.io/server/api/historyservice/v1._HistoryService_QueryWorkflow_Handler\\n\\t/temporal/api/historyservice/v1/service.pb.go:1403\\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1279\\ngoogle.golang.org/grpc.(*Server).handleStream\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1608\\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:923\"}\r\n```\r\n\r\nRoadrunner log:\r\n```\r\n2022-05-12T05:44:49.078Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nR\\^H\\t\\^R\\u000bInvokeQuery\\^ZA{\\\"runId\\\":\\\"55901692-8758-4870-a66a-a637d79d4698\\\",\\\"name\\\":\\\"payload\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T05:44:20Z\\\"}\"}\r\n2022-05-12T05:44:49.094Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\ufffd\\r\\^H\\t\\\"\\ufffd\\r\\n[Workflow with the specified run identifier \\\"55901692-8758-4870-a66a-a637d79d4698\\\" not found\\^R\\^GPHP_SDK\\^Z\\ufffd\\^LLogicException: Workflow with the specified run identifier \\\"55901692-8758-4870-a66a-a637d79d4698\\\" not found in /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/WorkflowProcessAwareRoute.php:58\\nStack trace:\\n#0 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/WorkflowProcessAwareRoute.php(44): Temporal\\\\Internal\\\\Transport\\\\Router\\\\WorkflowProcessAwareRoute->findProcessOrFail('55901692-8758-4...')\\n#1 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/InvokeQuery.php(55): Temporal\\\\Internal\\\\Transport\\\\Router\\\\WorkflowProcessAwareRoute->findInstanceOrFail('55901692-8758-4...')\\n#2 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router.php(81): Temporal\\\\Internal\\\\Transport\\\\Router\\\\InvokeQuery->handle(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array, Object(React\\\\Promise\\\\Deferred))\\n#3 /opt/app/vendor/temporal/sdk/src/Worker/Worker.php(93): Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#4 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(413): Temporal\\\\Worker\\\\Worker->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#5 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Server.php(60): Temporal\\\\WorkerFactory->onRequest(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#6 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(387): Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#7 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\nR\\\\x08\\\\t\\\\x12\\\\vInvokeQue...', Array)\\n#8 /opt/app/bin/worker(45): Temporal\\\\WorkerFactory->run()\\n#9 {main}*\\^P\\n\\^NLogicException\"}\r\n```\r\n\r\n4. Try to send signal\r\n\r\nWeb UI:\r\nSignal has been written into event history, workflow tasks seems to be executed, but **nothing actually happens** (workflow continues to run):\r\n![image](https://user-images.githubusercontent.com/877149/168001512-6451fe87-f83d-4158-a8bf-d15add9cada6.png)\r\n\r\nRoadrunner log:\r\n```\r\n2022-05-12T05:48:07.728Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nY\\^H\\n\\^R\\^LInvokeSignal\\^ZG{\\\"runId\\\":\\\"55901692-8758-4870-a66a-a637d79d4698\\\",\\\"name\\\":\\\"stop\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T05:48:07Z\\\"}\"}\r\n2022-05-12T05:48:07.730Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\ufffd\\r\\^H\\n\\\"\\ufffd\\r\\n[Workflow with the specified run identifier \\\"55901692-8758-4870-a66a-a637d79d4698\\\" not found\\^R\\^GPHP_SDK\\^Z\\ufffd\\^LLogicException: Workflow with the specified run identifier \\\"55901692-8758-4870-a66a-a637d79d4698\\\" not found in /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/WorkflowProcessAwareRoute.php:58\\nStack trace:\\n#0 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/WorkflowProcessAwareRoute.php(44): Temporal\\\\Internal\\\\Transport\\\\Router\\\\WorkflowProcessAwareRoute->findProcessOrFail('55901692-8758-4...')\\n#1 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/InvokeSignal.php(45): Temporal\\\\Internal\\\\Transport\\\\Router\\\\WorkflowProcessAwareRoute->findInstanceOrFail('55901692-8758-4...')\\n#2 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router.php(81): Temporal\\\\Internal\\\\Transport\\\\Router\\\\InvokeSignal->handle(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array, Object(React\\\\Promise\\\\Deferred))\\n#3 /opt/app/vendor/temporal/sdk/src/Worker/Worker.php(93): Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#4 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(413): Temporal\\\\Worker\\\\Worker->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#5 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Server.php(60): Temporal\\\\WorkerFactory->onRequest(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#6 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(387): Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#7 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\nY\\\\x08\\\\n\\\\x12\\\\fInvokeSig...', Array)\\n#8 /opt/app/bin/worker(45): Temporal\\\\WorkerFactory->run()\\n#9 {main}*\\^P\\n\\^NLogicException\"}\r\n```\r\n\r\n#### Case 2: roadrunner restarts (e.g. after redeploy)\r\n1. Start workflow\r\n2. Restart roadrunner server with `docker restart roadrunner_container`\r\n3. Try to query workflow ‚Üí got expected result\r\n\r\nTemporal log:\r\n```\r\n{\"level\":\"info\",\"ts\":\"2022-05-12T05:59:19.961Z\",\"msg\":\"query direct through matching failed on sticky, clearing sticky before attempting on non-sticky\",\"service\":\"history\",\"shard-id\":1,\"address\":\"172.19.0.14:7234\",\"shard-item\":\"0xc0004bac80\",\"component\":\"history-engine\",\"wf-namespace\":\"default\",\"wf-id\":\"teacher_16522_remove_slots\",\"wf-run-id\":\"dccef09e-51f6-4a94-b852-48244932eccc\",\"wf-query-type\":\"payload\",\"logging-call-at\":\"historyEngine.go:893\"}\r\n{\"level\":\"info\",\"ts\":\"2022-05-12T05:59:19.961Z\",\"msg\":\"query directly through matching on sticky timed out, attempting to query on non-sticky\",\"service\":\"history\",\"shard-id\":1,\"address\":\"172.19.0.14:7234\",\"shard-item\":\"0xc0004bac80\",\"component\":\"history-engine\",\"wf-namespace\":\"default\",\"wf-id\":\"teacher_16522_remove_slots\",\"wf-run-id\":\"dccef09e-51f6-4a94-b852-48244932eccc\",\"wf-query-type\":\"payload\",\"wf-task-queue-name\":\"c55a0d6a348f:dcc25f94-63bf-4c1e-b42d-cc6e680fede9\",\"wf-next-event-id\":6,\"logging-call-at\":\"historyEngine.go:923\"}\r\n```\r\n\r\nRoadrunner log (workflow is replaying):\r\n```\r\n2022-05-12T05:59:19.965Z\tDEBUG\ttemporal    \tworkflow execute\t{\"runID\": \"dccef09e-51f6-4a94-b852-48244932eccc\", \"workflow info\": {\"WorkflowExecution\":{\"ID\":\"XXXXX\",\"RunID\":\"dccef09e-51f6-4a94-b852-48244932eccc\"},\"WorkflowType\":{\"Name\":\"DummyWorkflow\"},\"TaskQueueName\":\"default\",\"WorkflowExecutionTimeout\":0,\"WorkflowRunTimeout\":0,\"WorkflowTaskTimeout\":10000000000,\"Namespace\":\"default\",\"Attempt\":1,\"WorkflowStartTime\":\"2022-05-12T05:57:38.056903166Z\",\"CronSchedule\":\"\",\"ContinuedExecutionRunID\":\"\",\"ParentWorkflowNamespace\":\"\",\"ParentWorkflowExecution\":null,\"Memo\":null,\"SearchAttributes\":{\"indexed_fields\":{\"SkyTeacherId\":{\"metadata\":{\"encoding\":\"anNvbi9wbGFpbg==\",\"type\":\"SW50\"},\"data\":\"MTY1MjI=\"}}},\"BinaryChecksum\":\"366aad4717fdb22d55eebef7c454528a\"}}\r\n2022-05-12T05:59:19.965Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 0}\r\n2022-05-12T05:59:19.965Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 1}\r\n2022-05-12T05:59:19.965Z\tDEBUG\ttemporal    \tworkflow task started\t{\"time\": \"1s\"}\r\n2022-05-12T05:59:19.966Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\n\\ufffd\\^F\\^H\\^A\\^R\\rStartWorkflow\\^Z\\ufffd\\^E{\\\"info\\\":{\\\"WorkflowExecution\\\":{\\\"ID\\\":\\\"teacher_16522_remove_slots\\\",\\\"RunID\\\":\\\"dccef09e-51f6-4a94-b852-48244932eccc\\\"},\\\"WorkflowType\\\":{\\\"Name\\\":\\\"DummyWorkflow\\\"},\\\"TaskQueueName\\\":\\\"default\\\",\\\"WorkflowExecutionTimeout\\\":0,\\\"WorkflowRunTimeout\\\":0,\\\"WorkflowTaskTimeout\\\":10000000000,\\\"Namespace\\\":\\\"default\\\",\\\"Attempt\\\":1,\\\"WorkflowStartTime\\\":\\\"2022-05-12T05:57:38.056903166Z\\\",\\\"CronSchedule\\\":\\\"\\\",\\\"ContinuedExecutionRunID\\\":\\\"\\\",\\\"ParentWorkflowNamespace\\\":\\\"\\\",\\\"ParentWorkflowExecution\\\":null,\\\"Memo\\\":null,\\\"SearchAttributes\\\":{\\\"indexed_fields\\\":{\\\"SkyTeacherId\\\":{\\\"metadata\\\":{\\\"encoding\\\":\\\"anNvbi9wbGFpbg==\\\",\\\"type\\\":\\\"SW50\\\"},\\\"data\\\":\\\"MTY1MjI=\\\"}}},\\\"BinaryChecksum\\\":\\\"366aad4717fdb22d55eebef7c454528a\\\"}}*D\\n\\^_\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^E16522\\n!\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^G2592000 {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T05:57:38Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T05:59:19.979Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\\"\\^H\\ufffdF\\^R\\^HNewTimer\\^Z\\^Q{\\\"ms\\\":2592000000}*\\^@\\n\\^_\\^H\\^A*\\^[\\n\\^Y\\n\\^W\\n\\^Hencoding\\^R\\u000bbinary/null\"}\r\n2022-05-12T05:59:19.979Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 1}\r\n2022-05-12T05:59:19.979Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 2}\r\n2022-05-12T05:59:19.979Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nR\\^H\\^B\\^R\\u000bInvokeQuery\\^ZA{\\\"runId\\\":\\\"dccef09e-51f6-4a94-b852-48244932eccc\\\",\\\"name\\\":\\\"payload\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T05:57:38Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T05:59:19.983Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\nd\\^H\\^B*`\\n^\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^RD{\\\"teacherId\\\":16522,\\\"removalScheduledOn\\\":\\\"2022-06-11T05:57:38+00:00\\\"}\"}\r\n```\r\n\r\n4. Try to query workflow **again** ‚Üí got `context deadline exceeded` error\r\n\r\nTemporal log:\r\n```\r\n{\"level\":\"info\",\"ts\":\"2022-05-12T06:04:51.831Z\",\"msg\":\"query directly through matching on sticky timed out, attempting to query on non-sticky\",\"service\":\"history\",\"shard-id\":1,\"address\":\"172.19.0.14:7234\",\"shard-item\":\"0xc0004bac80\",\"component\":\"history-engine\",\"wf-namespace\":\"default\",\"wf-id\":\"XXX\",\"wf-run-id\":\"dccef09e-51f6-4a94-b852-48244932eccc\",\"wf-query-type\":\"payload\",\"wf-task-queue-name\":\"\",\"wf-next-event-id\":6,\"logging-call-at\":\"historyEngine.go:923\"}\r\n{\"level\":\"error\",\"ts\":\"2022-05-12T06:05:21.830Z\",\"msg\":\"query directly though matching on non-sticky failed\",\"service\":\"history\",\"shard-id\":1,\"address\":\"172.19.0.14:7234\",\"shard-item\":\"0xc0004bac80\",\"component\":\"history-engine\",\"wf-namespace\":\"default\",\"wf-id\":\"XXX\",\"wf-run-id\":\"dccef09e-51f6-4a94-b852-48244932eccc\",\"wf-query-type\":\"payload\",\"error\":\"context deadline exceeded\",\"logging-call-at\":\"historyEngine.go:941\",\"stacktrace\":\"go.temporal.io/server/common/log.(*zapLogger).Error\\n\\t/temporal/common/log/zap_logger.go:142\\ngo.temporal.io/server/service/history.(*historyEngineImpl).queryDirectlyThroughMatching\\n\\t/temporal/service/history/historyEngine.go:941\\ngo.temporal.io/server/service/history.(*historyEngineImpl).QueryWorkflow\\n\\t/temporal/service/history/historyEngine.go:790\\ngo.temporal.io/server/service/history.(*Handler).QueryWorkflow.func1\\n\\t/temporal/service/history/handler.go:968\\ngo.temporal.io/server/common/backoff.RetryContext\\n\\t/temporal/common/backoff/retry.go:125\\ngo.temporal.io/server/service/history.(*Handler).QueryWorkflow\\n\\t/temporal/service/history/handler.go:966\\ngo.temporal.io/server/api/historyservice/v1._HistoryService_QueryWorkflow_Handler.func1\\n\\t/temporal/api/historyservice/v1/service.pb.go:1401\\ngo.temporal.io/server/common/rpc/interceptor.(*RateLimitInterceptor).Intercept\\n\\t/temporal/common/rpc/interceptor/rate_limit.go:83\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1113\\ngo.temporal.io/server/common/rpc/interceptor.(*TelemetryInterceptor).Intercept\\n\\t/temporal/common/rpc/interceptor/telemetry.go:108\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngo.temporal.io/server/common/metrics.NewServerMetricsTrailerPropagatorInterceptor.func1\\n\\t/temporal/common/metrics/grpc.go:113\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngo.temporal.io/server/common/metrics.NewServerMetricsContextInjectorInterceptor.func1\\n\\t/temporal/common/metrics/grpc.go:66\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngo.temporal.io/server/common/rpc.ServiceErrorInterceptor\\n\\t/temporal/common/rpc/grpc.go:131\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1.1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1116\\ngoogle.golang.org/grpc.chainUnaryInterceptors.func1\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1118\\ngo.temporal.io/server/api/historyservice/v1._HistoryService_QueryWorkflow_Handler\\n\\t/temporal/api/historyservice/v1/service.pb.go:1403\\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1279\\ngoogle.golang.org/grpc.(*Server).handleStream\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:1608\\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\\n\\t/go/pkg/mod/google.golang.org/grpc@v1.41.0/server.go:923\"}\r\n```\r\n\r\nRoadrunner log:\r\n```\r\n2022-05-12T06:04:51.834Z\tDEBUG\ttemporal    \tworkflow execute\t{\"runID\": \"dccef09e-51f6-4a94-b852-48244932eccc\", \"workflow info\": {\"WorkflowExecution\":{\"ID\":\"XXX\",\"RunID\":\"dccef09e-51f6-4a94-b852-48244932eccc\"},\"WorkflowType\":{\"Name\":\"DummyWorkflow\"},\"TaskQueueName\":\"default\",\"WorkflowExecutionTimeout\":0,\"WorkflowRunTimeout\":0,\"WorkflowTaskTimeout\":10000000000,\"Namespace\":\"default\",\"Attempt\":1,\"WorkflowStartTime\":\"2022-05-12T05:57:38.056903166Z\",\"CronSchedule\":\"\",\"ContinuedExecutionRunID\":\"\",\"ParentWorkflowNamespace\":\"\",\"ParentWorkflowExecution\":null,\"Memo\":null,\"SearchAttributes\":{\"indexed_fields\":{\"SkyTeacherId\":{\"metadata\":{\"encoding\":\"anNvbi9wbGFpbg==\",\"type\":\"SW50\"},\"data\":\"MTY1MjI=\"}}},\"BinaryChecksum\":\"366aad4717fdb22d55eebef7c454528a\"}}\r\n2022-05-12T06:04:51.834Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 2}\r\n2022-05-12T06:04:51.834Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 3}\r\n2022-05-12T06:04:51.834Z\tDEBUG\ttemporal    \tworkflow task started\t{\"time\": \"1s\"}\r\n2022-05-12T06:04:51.834Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\n\\ufffd\\^F\\^H\\^C\\^R\\rStartWorkflow\\^Z\\ufffd\\^E{\\\"info\\\":{\\\"WorkflowExecution\\\":{\\\"ID\\\":\\\"XXX\\\",\\\"RunID\\\":\\\"dccef09e-51f6-4a94-b852-48244932eccc\\\"},\\\"WorkflowType\\\":{\\\"Name\\\":\\\"DummyWorkflow\\\"},\\\"TaskQueueName\\\":\\\"default\\\",\\\"WorkflowExecutionTimeout\\\":0,\\\"WorkflowRunTimeout\\\":0,\\\"WorkflowTaskTimeout\\\":10000000000,\\\"Namespace\\\":\\\"default\\\",\\\"Attempt\\\":1,\\\"WorkflowStartTime\\\":\\\"2022-05-12T05:57:38.056903166Z\\\",\\\"CronSchedule\\\":\\\"\\\",\\\"ContinuedExecutionRunID\\\":\\\"\\\",\\\"ParentWorkflowNamespace\\\":\\\"\\\",\\\"ParentWorkflowExecution\\\":null,\\\"Memo\\\":null,\\\"SearchAttributes\\\":{\\\"indexed_fields\\\":{\\\"SkyTeacherId\\\":{\\\"metadata\\\":{\\\"encoding\\\":\\\"anNvbi9wbGFpbg==\\\",\\\"type\\\":\\\"SW50\\\"},\\\"data\\\":\\\"MTY1MjI=\\\"}}},\\\"BinaryChecksum\\\":\\\"366aad4717fdb22d55eebef7c454528a\\\"}}*D\\n\\^_\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^E16522\\n!\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^G2592000 {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T05:57:38Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T06:04:51.837Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\ufffd\\^L\\^H\\^C\\\"\\ufffd\\^L\\n{Workflow \\\"DummyWorkflow\\\" with run id \\\"dccef09e-51f6-4a94-b852-48244932eccc\\\" has been already started\\^R\\^GPHP_SDK\\^Z\\ufffd\\u000bLogicException: Workflow \\\"DummyWorkflow\\\" with run id \\\"dccef09e-51f6-4a94-b852-48244932eccc\\\" has been already started in /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php:95\\nStack trace:\\n#0 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php(63): Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->findWorkflowOrFail(Object(Temporal\\\\Workflow\\\\WorkflowInfo))\\n#1 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router.php(81): Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->handle(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array, Object(React\\\\Promise\\\\Deferred))\\n#2 /opt/app/vendor/temporal/sdk/src/Worker/Worker.php(93): Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#3 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(413): Temporal\\\\Worker\\\\Worker->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#4 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Server.php(60): Temporal\\\\WorkerFactory->onRequest(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#5 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(387): Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#6 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\n\\\\x80\\\\x06\\\\x08\\\\x03\\\\x12\\\\rStartWor...', Array)\\n#7 /opt/app/bin/worker(45): Temporal\\\\WorkerFactory->run()\\n#8 {main}*\\^P\\n\\^NLogicException\"}\r\n2022-05-12T06:04:51.837Z\tERROR\ttemporal    \tWorkflow panic\t{\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"default:7ddcc910-a81a-4d88-95bc-7eda895b5b91\", \"WorkflowType\": \"DummyWorkflow\", \"WorkflowID\": \"XXX\", \"RunID\": \"dccef09e-51f6-4a94-b852-48244932eccc\", \"Attempt\": 1, \"Error\": \"unknown command CommandType: Timer, ID: 5, possible causes are nondeterministic workflow definition code or incompatible change in the workflow definition\", \"StackTrace\": \"process event for default [panic]:\\ngithub.com/spiral/sdk-go/internal.panicIllegalState(...)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_decision_state_machine.go:395\\ngithub.com/spiral/sdk-go/internal.(*commandsHelper).getCommand(0x0, {0x0, {0x26565e8, 0xc000d11950}})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_decision_state_machine.go:856 +0x119\\ngithub.com/spiral/sdk-go/internal.(*commandsHelper).handleTimerStarted(0xc000145260, {0x26565e8, 0xc00007cfb0})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_decision_state_machine.go:1250 +0x29\\ngithub.com/spiral/sdk-go/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0xc0000e5080, 0xc000aaa4c0, 0xc0, 0x0)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_event_handlers.go:833 +0x3fd\\ngithub.com/spiral/sdk-go/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0xc00015ca10, 0xc000a2c540)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_handlers.go:874 +0xca8\\ngithub.com/spiral/sdk-go/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0xc00019a580, 0xc000a2c540, 0xc0009eb6b0)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_handlers.go:723 +0x493\\ngithub.com/spiral/sdk-go/internal.(*workflowTaskPoller).processWorkflowTask(0xc0000d51e0, 0xc000a2c540)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_pollers.go:284 +0x2cd\\ngithub.com/spiral/sdk-go/internal.(*workflowTaskPoller).ProcessTask(0xc0000d51e0, {0x1594180, 0xc000a2c540})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_pollers.go:255 +0x6c\\ngithub.com/spiral/sdk-go/internal.(*baseWorker).processTask(0xc000185000, {0x1593d40, 0xc000520cc0})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_worker_base.go:362 +0x167\\ncreated by github.com/spiral/sdk-go/internal.(*baseWorker).runTaskDispatcher\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_worker_base.go:282 +0xba\"}\r\n2022-05-12T06:04:51.837Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 3}\r\n2022-05-12T06:04:51.837Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 4}\r\n2022-05-12T06:04:51.837Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nE\\^H\\^D\\^R\\^ODestroyWorkflow\\^Z0{\\\"runId\\\":\\\"dccef09e-51f6-4a94-b852-48244932eccc\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T05:57:38Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T06:04:51.838Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\^_\\^H\\^D*\\^[\\n\\^Y\\n\\^W\\n\\^Hencoding\\^R\\u000bbinary/null\"}\r\n2022-05-12T06:04:51.838Z\tWARN\ttemporal    \tFailed to process workflow task.\t{\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"default:7ddcc910-a81a-4d88-95bc-7eda895b5b91\", \"WorkflowType\": \"DummyWorkflow\", \"WorkflowID\": \"XXX\", \"RunID\": \"dccef09e-51f6-4a94-b852-48244932eccc\", \"Attempt\": 1, \"Error\": \"unknown command CommandType: Timer, ID: 5, possible causes are nondeterministic workflow definition code or incompatible change in the workflow definition\"}\r\n2022-05-12T06:04:51.840Z\tINFO\ttemporal    \tTask processing failed with error\t{\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"default:7ddcc910-a81a-4d88-95bc-7eda895b5b91\", \"WorkerType\": \"WorkflowWorker\", \"Error\": \"Workflow executionsRow not found.  WorkflowId: default, RunId: 1620e0fd-7a80-4d11-acfb-bb1fe4a509f3\"}\r\n```\r\n\r\nIf we continue making queries, we'll again get OK answer, then `context deadline exceeded` error, etc.\r\n\r\n5. Try to query again and get expected answer\r\n6. Try to send signal7. \r\n\r\nWeb UI:\r\nSignal is processed correctly, but after an error:\r\n![image](https://user-images.githubusercontent.com/877149/168004819-aabcb33b-1607-45b9-92bd-887e75fcc858.png)\r\n\r\nRoadrunner log:\r\n```\r\n2022-05-12T06:15:35.240Z\tDEBUG\ttemporal    \tworkflow execute\t{\"runID\": \"5a1bfd24-70e9-4cef-863e-5a2f0377223c\", \"workflow info\": {\"WorkflowExecution\":{\"ID\":\"XXX\",\"RunID\":\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\"},\"WorkflowType\":{\"Name\":\"DummyWorkflow\"},\"TaskQueueName\":\"default\",\"WorkflowExecutionTimeout\":0,\"WorkflowRunTimeout\":0,\"WorkflowTaskTimeout\":10000000000,\"Namespace\":\"default\",\"Attempt\":1,\"WorkflowStartTime\":\"2022-05-12T06:14:46.868631545Z\",\"CronSchedule\":\"\",\"ContinuedExecutionRunID\":\"\",\"ParentWorkflowNamespace\":\"\",\"ParentWorkflowExecution\":null,\"Memo\":null,\"SearchAttributes\":{\"indexed_fields\":{\"SkyTeacherId\":{\"metadata\":{\"encoding\":\"anNvbi9wbGFpbg==\",\"type\":\"SW50\"},\"data\":\"MTY1MjI=\"}}},\"BinaryChecksum\":\"366aad4717fdb22d55eebef7c454528a\"}}\r\n2022-05-12T06:15:35.240Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 2}\r\n2022-05-12T06:15:35.240Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 3}\r\n2022-05-12T06:15:35.240Z\tDEBUG\ttemporal    \tworkflow task started\t{\"time\": \"1s\"}\r\n2022-05-12T06:15:35.240Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\n\\ufffd\\^F\\^H\\^C\\^R\\rStartWorkflow\\^Z\\ufffd\\^E{\\\"info\\\":{\\\"WorkflowExecution\\\":{\\\"ID\\\":\\\"XXX\\\",\\\"RunID\\\":\\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\"},\\\"WorkflowType\\\":{\\\"Name\\\":\\\"DummyWorkflow\\\"},\\\"TaskQueueName\\\":\\\"default\\\",\\\"WorkflowExecutionTimeout\\\":0,\\\"WorkflowRunTimeout\\\":0,\\\"WorkflowTaskTimeout\\\":10000000000,\\\"Namespace\\\":\\\"default\\\",\\\"Attempt\\\":1,\\\"WorkflowStartTime\\\":\\\"2022-05-12T06:14:46.868631545Z\\\",\\\"CronSchedule\\\":\\\"\\\",\\\"ContinuedExecutionRunID\\\":\\\"\\\",\\\"ParentWorkflowNamespace\\\":\\\"\\\",\\\"ParentWorkflowExecution\\\":null,\\\"Memo\\\":null,\\\"SearchAttributes\\\":{\\\"indexed_fields\\\":{\\\"SkyTeacherId\\\":{\\\"metadata\\\":{\\\"encoding\\\":\\\"anNvbi9wbGFpbg==\\\",\\\"type\\\":\\\"SW50\\\"},\\\"data\\\":\\\"MTY1MjI=\\\"}}},\\\"BinaryChecksum\\\":\\\"366aad4717fdb22d55eebef7c454528a\\\"}}*D\\n\\^_\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^E16522\\n!\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^G2592000 {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T06:14:46Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T06:15:35.243Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\ufffd\\^L\\^H\\^C\\\"\\ufffd\\^L\\n{Workflow \\\"DummyWorkflow\\\" with run id \\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\" has been already started\\^R\\^GPHP_SDK\\^Z\\ufffd\\u000bLogicException: Workflow \\\"DummyWorkflow\\\" with run id \\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\" has been already started in /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php:95\\nStack trace:\\n#0 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php(63): Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->findWorkflowOrFail(Object(Temporal\\\\Workflow\\\\WorkflowInfo))\\n#1 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Router.php(81): Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->handle(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array, Object(React\\\\Promise\\\\Deferred))\\n#2 /opt/app/vendor/temporal/sdk/src/Worker/Worker.php(93): Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#3 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(413): Temporal\\\\Worker\\\\Worker->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#4 /opt/app/vendor/temporal/sdk/src/Internal/Transport/Server.php(60): Temporal\\\\WorkerFactory->onRequest(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#5 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(387): Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Request), Array)\\n#6 /opt/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\n\\\\x80\\\\x06\\\\x08\\\\x03\\\\x12\\\\rStartWor...', Array)\\n#7 /opt/app/bin/worker(45): Temporal\\\\WorkerFactory->run()\\n#8 {main}*\\^P\\n\\^NLogicException\"}\r\n2022-05-12T06:15:35.243Z\tERROR\ttemporal    \tWorkflow panic\t{\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"default:4fe939cb-4f79-47c6-a1e9-8b6dad29ef7f\", \"WorkflowType\": \"DummyWorkflow\", \"WorkflowID\": \"XXX\", \"RunID\": \"5a1bfd24-70e9-4cef-863e-5a2f0377223c\", \"Attempt\": 1, \"Error\": \"unknown command CommandType: Timer, ID: 5, possible causes are nondeterministic workflow definition code or incompatible change in the workflow definition\", \"StackTrace\": \"process event for default [panic]:\\ngithub.com/spiral/sdk-go/internal.panicIllegalState(...)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_decision_state_machine.go:395\\ngithub.com/spiral/sdk-go/internal.(*commandsHelper).getCommand(0x0, {0x0, {0x26565e8, 0x7fcb0d7c0228}})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_decision_state_machine.go:856 +0x119\\ngithub.com/spiral/sdk-go/internal.(*commandsHelper).handleTimerStarted(0x7fcb346c15b8, {0x26565e8, 0xc0005b4000})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_decision_state_machine.go:1250 +0x29\\ngithub.com/spiral/sdk-go/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0xc00079e750, 0xc000918e00, 0xc0, 0x0)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_event_handlers.go:833 +0x3fd\\ngithub.com/spiral/sdk-go/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0xc0009288c0, 0xc000116ed0)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_handlers.go:874 +0xca8\\ngithub.com/spiral/sdk-go/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0xc0001e4a50, 0xc000116ed0, 0xc0009dee70)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_handlers.go:723 +0x493\\ngithub.com/spiral/sdk-go/internal.(*workflowTaskPoller).processWorkflowTask(0xc0000b45b0, 0xc000116ed0)\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_pollers.go:284 +0x2cd\\ngithub.com/spiral/sdk-go/internal.(*workflowTaskPoller).ProcessTask(0xc0000b45b0, {0x1594180, 0xc000116ed0})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_task_pollers.go:255 +0x6c\\ngithub.com/spiral/sdk-go/internal.(*baseWorker).processTask(0xc000200400, {0x1593d40, 0xc000122250})\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_worker_base.go:362 +0x167\\ncreated by github.com/spiral/sdk-go/internal.(*baseWorker).runTaskDispatcher\\n\\tgithub.com/spiral/sdk-go@v1.12.0/internal/internal_worker_base.go:282 +0xba\"}\r\n2022-05-12T06:15:35.243Z\tWARN\ttemporal    \tFailed to process workflow task.\t{\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"default:4fe939cb-4f79-47c6-a1e9-8b6dad29ef7f\", \"WorkflowType\": \"DummyWorkflow\", \"WorkflowID\": \"XXX\", \"RunID\": \"5a1bfd24-70e9-4cef-863e-5a2f0377223c\", \"Attempt\": 1, \"Error\": \"unknown command CommandType: Timer, ID: 5, possible causes are nondeterministic workflow definition code or incompatible change in the workflow definition\"}\r\n2022-05-12T06:15:35.243Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 3}\r\n2022-05-12T06:15:35.243Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 4}\r\n2022-05-12T06:15:35.243Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nE\\^H\\^D\\^R\\^ODestroyWorkflow\\^Z0{\\\"runId\\\":\\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T06:14:46Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T06:15:35.244Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\^_\\^H\\^D*\\^[\\n\\^Y\\n\\^W\\n\\^Hencoding\\^R\\u000bbinary/null\"}\r\n2022-05-12T06:15:35.254Z\tDEBUG\ttemporal    \tworkflow execute\t{\"runID\": \"5a1bfd24-70e9-4cef-863e-5a2f0377223c\", \"workflow info\": {\"WorkflowExecution\":{\"ID\":\"XXX\",\"RunID\":\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\"},\"WorkflowType\":{\"Name\":\"DummyWorkflow\"},\"TaskQueueName\":\"default\",\"WorkflowExecutionTimeout\":0,\"WorkflowRunTimeout\":0,\"WorkflowTaskTimeout\":10000000000,\"Namespace\":\"default\",\"Attempt\":1,\"WorkflowStartTime\":\"2022-05-12T06:14:46.868631545Z\",\"CronSchedule\":\"\",\"ContinuedExecutionRunID\":\"\",\"ParentWorkflowNamespace\":\"\",\"ParentWorkflowExecution\":null,\"Memo\":null,\"SearchAttributes\":{},\"BinaryChecksum\":\"366aad4717fdb22d55eebef7c454528a\"}}\r\n2022-05-12T06:15:35.254Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 4}\r\n2022-05-12T06:15:35.254Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 5}\r\n2022-05-12T06:15:35.254Z\tDEBUG\ttemporal    \tworkflow task started\t{\"time\": \"1s\"}\r\n2022-05-12T06:15:35.254Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\n\\ufffd\\^F\\^H\\^E\\^R\\rStartWorkflow\\^Z\\ufffd\\^E{\\\"info\\\":{\\\"WorkflowExecution\\\":{\\\"ID\\\":\\\"XXX\\\",\\\"RunID\\\":\\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\"},\\\"WorkflowType\\\":{\\\"Name\\\":\\\"DummyWorkflow\\\"},\\\"TaskQueueName\\\":\\\"default\\\",\\\"WorkflowExecutionTimeout\\\":0,\\\"WorkflowRunTimeout\\\":0,\\\"WorkflowTaskTimeout\\\":10000000000,\\\"Namespace\\\":\\\"default\\\",\\\"Attempt\\\":1,\\\"WorkflowStartTime\\\":\\\"2022-05-12T06:14:46.868631545Z\\\",\\\"CronSchedule\\\":\\\"\\\",\\\"ContinuedExecutionRunID\\\":\\\"\\\",\\\"ParentWorkflowNamespace\\\":\\\"\\\",\\\"ParentWorkflowExecution\\\":null,\\\"Memo\\\":null,\\\"SearchAttributes\\\":{\\\"indexed_fields\\\":{\\\"SkyTeacherId\\\":{\\\"metadata\\\":{\\\"encoding\\\":\\\"anNvbi9wbGFpbg==\\\",\\\"type\\\":\\\"SW50\\\"},\\\"data\\\":\\\"MTY1MjI=\\\"}}},\\\"BinaryChecksum\\\":\\\"366aad4717fdb22d55eebef7c454528a\\\"}}*D\\n\\^_\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^E16522\\n!\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\^G2592000 {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T06:14:46Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T06:15:35.255Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\\"\\^H\\ufffdF\\^R\\^HNewTimer\\^Z\\^Q{\\\"ms\\\":2592000000}*\\^@\\n\\^_\\^H\\^E*\\^[\\n\\^Y\\n\\^W\\n\\^Hencoding\\^R\\u000bbinary/null\"}\r\n2022-05-12T06:15:35.255Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 5}\r\n2022-05-12T06:15:35.255Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 6}\r\n2022-05-12T06:15:35.255Z\tDEBUG\ttemporal    \tworkflow task started\t{\"time\": \"1s\"}\r\n2022-05-12T06:15:35.255Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nY\\^H\\^F\\^R\\^LInvokeSignal\\^ZG{\\\"runId\\\":\\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\",\\\"name\\\":\\\"cancelRemoval\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T06:15:35Z\\\"}\"}\r\n2022-05-12T06:15:35.257Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\^_\\^H\\^F*\\^[\\n\\^Y\\n\\^W\\n\\^Hencoding\\^R\\u000bbinary/null\\nB\\^H\\ufffdF\\^R\\^PCompleteWorkflow\\^Z\\^B{}*'\\n%\\n\\^V\\n\\^Hencoding\\^R\\njson/plain\\^R\\u000b\\\"CANCELLED\\\"\"}\r\n2022-05-12T06:15:35.257Z\tDEBUG\ttemporal    \tsequenceID\t{\"before\": 6}\r\n2022-05-12T06:15:35.257Z\tDEBUG\ttemporal    \tsequenceID\t{\"after\": 7}\r\n2022-05-12T06:15:35.257Z\tDEBUG\ttemporal    \toutgoing message\t{\"data\": \"\\nE\\^H\\^G\\^R\\^ODestroyWorkflow\\^Z0{\\\"runId\\\":\\\"5a1bfd24-70e9-4cef-863e-5a2f0377223c\\\"} {\\\"taskQueue\\\":\\\"default\\\",\\\"tickTime\\\":\\\"2022-05-12T06:15:35Z\\\",\\\"replay\\\":true}\"}\r\n2022-05-12T06:15:35.257Z\tDEBUG\ttemporal    \treceived message\t{\"data\": \"\\n\\^_\\^H\\^G*\\^[\\n\\^Y\\n\\^W\\n\\^Hencoding\\^R\\u000bbinary/null\"}\r\n```\r\n\r\n### Environment/Versions\r\n- Temporal Version: 1.13.0,  SDK version 1.1.1\r\n","closedAt":"2022-06-03T12:21:03Z","comments":[{"id":"IC_kwDOEY5HBM5DJ-EE","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"@mzavatsky thank you for the issue üëç Yes, there is a problem with reset and we are working on it.","createdAt":"2022-05-14T10:25:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1126686980","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5DeUdz","author":{"login":"bergundy"},"authorAssociation":"MEMBER","body":"As far as query deadline goes, you may have encountered this server issue which was recently fixed and not yet released: https://github.com/temporalio/temporal/issues/2363","createdAt":"2022-05-19T18:02:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"EYES","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1132021619","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5D4uX0","author":{"login":"rustatian"},"authorAssociation":"COLLABORATOR","body":"Hey @mzavatsky üëãüèª. What RR version are you using? ","createdAt":"2022-05-26T19:41:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1138943476","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5D6xmg","author":{"login":"mzavatsky"},"authorAssociation":"CONTRIBUTOR","body":"> Hey @mzavatsky üëãüèª. What RR version are you using?\r\n\r\n2.7.0 and 2.10.0 (we have two projects using temporal now)\r\n\r\n","createdAt":"2022-05-27T10:15:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1139480992","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5D7k7A","author":{"login":"rustatian"},"authorAssociation":"COLLABORATOR","body":"2.10.0 is fine, but 2.7.0 is reasonably outdated and unsupported.","createdAt":"2022-05-27T14:49:12Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1139691200","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5EAxpy","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"@mzavatsky we have found a problem. It will be fixed this Thursday with a new RR release! üí™ Stay tuned üòâ ","createdAt":"2022-05-30T11:41:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1141054066","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5EPKBa","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"@mzavatsky please try to update RR to `v2.10.3` and sdk to `v1.3.2`. Hope, it will help you.","createdAt":"2022-06-02T12:47:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"ROCKET","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1144823898","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5ETSEF","author":{"login":"mzavatsky"},"authorAssociation":"CONTRIBUTOR","body":"I've tried updated versions, everything looks good now.\r\nThank you very much!!!","createdAt":"2022-06-03T12:19:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}},{"content":"HOORAY","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1145905413","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5ETST_","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"Great! üéâ ","createdAt":"2022-06-03T12:20:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/170#issuecomment-1145906431","viewerDidAuthor":false}],"createdAt":"2022-05-12T06:23:37Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":170,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"state":"CLOSED","title":"[Bug] Issues with sticky execution/queries/signals","updatedAt":"2022-06-03T12:21:03Z","url":"https://github.com/temporalio/sdk-php/issues/170"}
