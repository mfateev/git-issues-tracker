{"assignees":[{"id":"MDQ6VXNlcjQxNTI0ODE=","login":"roxblnfk","name":"Aleksei Gagarin","databaseId":0}],"author":{"id":"MDQ6VXNlcjgwMjQxNzI=","is_bot":false,"login":"Neznaykas","name":"Сергей"},"body":"Hi! When I try use workflows us\r\n\r\nMainWorkflow -> Run ChildWorkflows -> Run ChildWorkflows -> Run Activities\r\n\r\nI get error\r\n\r\nClass Generator is an internal class marked as final that cannot be instantiated without invoking its constructor\r\n\r\nif this is the correct behavior, how do I call a non-child workflow?\r\n\r\nSDK: v2.3.0\r\nServer: 1.8.5\r\n\r\nTrace:\r\n```\r\n{\r\n  \"message\": \"Class Generator is an internal class marked as final that cannot be instantiated without invoking its constructor\",\r\n  \"source\": \"PHP_SDK\",\r\n  \"stackTrace\": \"ReflectionException: Class Generator is an internal class marked as final that cannot be instantiated without invoking its constructor in /var/app/vendor/temporal/sdk/src/DataConverter/JsonConverter.php:150\\nStack trace:\\n#0 /var/app/vendor/temporal/sdk/src/DataConverter/JsonConverter.php(150): ReflectionClass->newInstanceWithoutConstructor()\\n#1 /var/app/vendor/temporal/sdk/src/DataConverter/DataConverter.php(53): Temporal\\\\DataConverter\\\\JsonConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#2 /var/app/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(80): Temporal\\\\DataConverter\\\\DataConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#3 /var/app/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(169): Temporal\\\\DataConverter\\\\EncodedValues->getValue(0, Object(Temporal\\\\DataConverter\\\\Type))\\n#4 /var/app/vendor/react/promise/src/FulfilledPromise.php(28): Temporal\\\\DataConverter\\\\EncodedValues::Temporal\\\\DataConverter\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#5 /var/app/vendor/react/promise/src/Promise.php(134): React\\\\Promise\\\\FulfilledPromise->then(Object(Closure), NULL)\\n#6 /var/app/vendor/react/promise/src/Promise.php(168): React\\\\Promise\\\\Promise::React\\\\Promise\\\\{closure}(Object(React\\\\Promise\\\\FulfilledPromise))\\n#7 /var/app/vendor/react/promise/src/Promise.php(231): React\\\\Promise\\\\Promise->settle(Object(React\\\\Promise\\\\FulfilledPromise))\\n#8 /var/app/vendor/react/promise/src/Deferred.php(36): React\\\\Promise\\\\Promise::React\\\\Promise\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#9 /var/app/vendor/temporal/sdk/src/Internal/Transport/CompletableResult.php(137): React\\\\Promise\\\\Deferred->resolve(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#10 /var/app/vendor/temporal/sdk/src/Internal/Events/EventEmitterTrait.php(47): Temporal\\\\Internal\\\\Transport\\\\CompletableResult->Temporal\\\\Internal\\\\Transport\\\\{closure}()\\n#11 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(278): Temporal\\\\WorkerFactory->emit('tick')\\n#12 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(393): Temporal\\\\WorkerFactory->tick()\\n#13 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\n'\\\\x08\\\\xA9F*\\\"\\\\n \\\\n\\\\x16\\\\n\\\\x08en...', Array)\\n#14 /var/app/worker.php(57): Temporal\\\\WorkerFactory->run()\\n#15 {main}\\n\\nNext Temporal\\\\Exception\\\\DataConverterException: Class Generator is an internal class marked as final that cannot be instantiated without invoking its constructor in /var/app/vendor/temporal/sdk/src/DataConverter/JsonConverter.php:152\\nStack trace:\\n#0 /var/app/vendor/temporal/sdk/src/DataConverter/DataConverter.php(53): Temporal\\\\DataConverter\\\\JsonConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#1 /var/app/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(80): Temporal\\\\DataConverter\\\\DataConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#2 /var/app/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(169): Temporal\\\\DataConverter\\\\EncodedValues->getValue(0, Object(Temporal\\\\DataConverter\\\\Type))\\n#3 /var/app/vendor/react/promise/src/FulfilledPromise.php(28): Temporal\\\\DataConverter\\\\EncodedValues::Temporal\\\\DataConverter\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#4 /var/app/vendor/react/promise/src/Promise.php(134): React\\\\Promise\\\\FulfilledPromise->then(Object(Closure), NULL)\\n#5 /var/app/vendor/react/promise/src/Promise.php(168): React\\\\Promise\\\\Promise::React\\\\Promise\\\\{closure}(Object(React\\\\Promise\\\\FulfilledPromise))\\n#6 /var/app/vendor/react/promise/src/Promise.php(231): React\\\\Promise\\\\Promise->settle(Object(React\\\\Promise\\\\FulfilledPromise))\\n#7 /var/app/vendor/react/promise/src/Deferred.php(36): React\\\\Promise\\\\Promise::React\\\\Promise\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#8 /var/app/vendor/temporal/sdk/src/Internal/Transport/CompletableResult.php(137): React\\\\Promise\\\\Deferred->resolve(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#9 /var/app/vendor/temporal/sdk/src/Internal/Events/EventEmitterTrait.php(47): Temporal\\\\Internal\\\\Transport\\\\CompletableResult->Temporal\\\\Internal\\\\Transport\\\\{closure}()\\n#10 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(278): Temporal\\\\WorkerFactory->emit('tick')\\n#11 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(393): Temporal\\\\WorkerFactory->tick()\\n#12 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\n'\\\\x08\\\\xA9F*\\\"\\\\n \\\\n\\\\x16\\\\n\\\\x08en...', Array)\\n#13 /var/app/worker.php(57): Temporal\\\\WorkerFactory->run()\\n#14 {main}\",\r\n  \"encodedAttributes\": null,\r\n  \"cause\": {\r\n    \"message\": \"Class Generator is an internal class marked as final that cannot be instantiated without invoking its constructor\",\r\n    \"source\": \"PHP_SDK\",\r\n    \"stackTrace\": \"ReflectionException: Class Generator is an internal class marked as final that cannot be instantiated without invoking its constructor in /var/app/vendor/temporal/sdk/src/DataConverter/JsonConverter.php:150\\nStack trace:\\n#0 /var/app/vendor/temporal/sdk/src/DataConverter/JsonConverter.php(150): ReflectionClass->newInstanceWithoutConstructor()\\n#1 /var/app/vendor/temporal/sdk/src/DataConverter/DataConverter.php(53): Temporal\\\\DataConverter\\\\JsonConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#2 /var/app/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(80): Temporal\\\\DataConverter\\\\DataConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#3 /var/app/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(169): Temporal\\\\DataConverter\\\\EncodedValues->getValue(0, Object(Temporal\\\\DataConverter\\\\Type))\\n#4 /var/app/vendor/react/promise/src/FulfilledPromise.php(28): Temporal\\\\DataConverter\\\\EncodedValues::Temporal\\\\DataConverter\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#5 /var/app/vendor/react/promise/src/Promise.php(134): React\\\\Promise\\\\FulfilledPromise->then(Object(Closure), NULL)\\n#6 /var/app/vendor/react/promise/src/Promise.php(168): React\\\\Promise\\\\Promise::React\\\\Promise\\\\{closure}(Object(React\\\\Promise\\\\FulfilledPromise))\\n#7 /var/app/vendor/react/promise/src/Promise.php(231): React\\\\Promise\\\\Promise->settle(Object(React\\\\Promise\\\\FulfilledPromise))\\n#8 /var/app/vendor/react/promise/src/Deferred.php(36): React\\\\Promise\\\\Promise::React\\\\Promise\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#9 /var/app/vendor/temporal/sdk/src/Internal/Transport/CompletableResult.php(137): React\\\\Promise\\\\Deferred->resolve(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#10 /var/app/vendor/temporal/sdk/src/Internal/Events/EventEmitterTrait.php(47): Temporal\\\\Internal\\\\Transport\\\\CompletableResult->Temporal\\\\Internal\\\\Transport\\\\{closure}()\\n#11 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(278): Temporal\\\\WorkerFactory->emit('tick')\\n#12 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(393): Temporal\\\\WorkerFactory->tick()\\n#13 /var/app/vendor/temporal/sdk/src/WorkerFactory.php(261): Temporal\\\\WorkerFactory->dispatch('\\\\n'\\\\x08\\\\xA9F*\\\"\\\\n \\\\n\\\\x16\\\\n\\\\x08en...', Array)\\n#14 /var/app/worker.php(57): Temporal\\\\WorkerFactory->run()\\n#15 {main}\",\r\n    \"encodedAttributes\": null,\r\n    \"cause\": null,\r\n    \"applicationFailureInfo\": {\r\n      \"type\": \"ReflectionException\",\r\n      \"nonRetryable\": false,\r\n      \"details\": null\r\n    }\r\n  },\r\n  \"applicationFailureInfo\": {\r\n    \"type\": \"Temporal\\\\Exception\\\\DataConverterException\",\r\n    \"nonRetryable\": false,\r\n    \"details\": null\r\n  }\r\n}\r\n```\r\n","closedAt":"2023-09-01T11:41:56Z","comments":[{"id":"IC_kwDOEY5HBM5PDXva","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"Please follow the standard bug report template which must include:\r\n- minimal way to reproduce the error\r\n- information about SDK version","createdAt":"2022-11-24T10:54:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/264#issuecomment-1326283738","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5PEBzE","author":{"login":"Neznaykas"},"authorAssociation":"CONTRIBUTOR","body":"an approximate path\r\n\r\n```php\r\nclass ParentWorkflow implements ParentWorkflowInterface\r\n{\r\n    public function greet(string $name)\r\n    {\r\n        $child = Workflow::newChildWorkflowStub(ChildWorkflow::class);\r\n\r\n        // This is a non blocking call that returns immediately.\r\n        // Use yield $child->greet(name) to call synchronously.\r\n        $childGreet = $child->greet($name);\r\n\r\n        // Do something else here.\r\n\r\n        return 'Hello ' . $name . ' from parent; ' . yield $childGreet;\r\n    }\r\n\r\nclass ChildWorkflow\r\n{\r\n    #[WorkflowMethod(\"Child.greet\")]\r\n    public function greet(\r\n        string $name\r\n    ) {\r\n\r\n        $child = Workflow::newChildWorkflowStub(SubChildWorkflow::class);\r\n\r\n        // This is a non blocking call that returns immediately.\r\n        // Use yield $child->greet(name) to call synchronously.\r\n        $childGreet = $child->greet($name);\r\n\r\n        return yield $childGreet;\r\n    }\r\n}\r\n\r\nclass SubChildWorkflow\r\n{\r\n    #[WorkflowMethod(\"SubChild.greet\")]\r\n    public function greet(\r\n        string $name\r\n    ) {\r\n        return 'Hello ' . $name . ' from child workflow!';\r\n    }\r\n}\r\n\r\n```\r\nI'll try to write a better example a little later","createdAt":"2022-11-24T13:27:46Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/264#issuecomment-1326456004","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5WOWjm","author":{"login":"ruscon"},"authorAssociation":"CONTRIBUTOR","body":"Have the same issue.\r\n\r\n@Neznaykas Have you found how to solve the problem?","createdAt":"2023-02-27T16:06:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/264#issuecomment-1446602982","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5gqYh4","author":{"login":"msmakouz"},"authorAssociation":"COLLABORATOR","body":"@Neznaykas I tried to reproduce the issue.\r\nCopied the code you provided (only added required attributes) and added a console command to start a workflow.\r\n\r\n**SDK version: v2.5.1**\r\n**PHP: 8.0.15** (from PHP samples: https://github.com/temporalio/samples-php)\r\n\r\n### ChildWorkflow\r\n\r\n```php\r\nuse Temporal\\Workflow;\r\nuse Temporal\\Workflow\\WorkflowMethod;\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\n\r\n#[WorkflowInterface]\r\nclass ChildWorkflow\r\n{\r\n    #[WorkflowMethod(\"Child.greet\")]\r\n    public function greet(\r\n        string $name\r\n    ) {\r\n\r\n        $child = Workflow::newChildWorkflowStub(SubChildWorkflow::class);\r\n\r\n        // This is a non blocking call that returns immediately.\r\n        // Use yield $child->greet(name) to call synchronously.\r\n        $childGreet = $child->greet($name);\r\n\r\n        return yield $childGreet;\r\n    }\r\n}\r\n```\r\n\r\n### ParentWorkflow\r\n\r\n```php\r\nuse Temporal\\Workflow;\r\n\r\nclass ParentWorkflow implements ParentWorkflowInterface\r\n{\r\n    public function greet(string $name)\r\n    {\r\n        $child = Workflow::newChildWorkflowStub(ChildWorkflow::class);\r\n\r\n        // This is a non blocking call that returns immediately.\r\n        // Use yield $child->greet(name) to call synchronously.\r\n        $childGreet = $child->greet($name);\r\n\r\n        // Do something else here.\r\n\r\n        return 'Hello ' . $name . ' from parent; ' . yield $childGreet;\r\n    }\r\n}\r\n```\r\n\r\n### ParentWorkflowInterface\r\n\r\n```php\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\nuse Temporal\\Workflow\\WorkflowMethod;\r\n\r\n#[WorkflowInterface]\r\ninterface ParentWorkflowInterface\r\n{\r\n    #[WorkflowMethod(\"Parent.greet\")]\r\n    public function greet(string $name);\r\n}\r\n```\r\n\r\n### SubChildWorkflow\r\n\r\n```php\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\nuse Temporal\\Workflow\\WorkflowMethod;\r\n\r\n#[WorkflowInterface]\r\nclass SubChildWorkflow\r\n{\r\n    #[WorkflowMethod(\"SubChild.greet\")]\r\n    public function greet(\r\n        string $name\r\n    ) {\r\n        return 'Hello ' . $name . ' from child workflow!';\r\n    }\r\n}\r\n```\r\n\r\nThe code ran successfully. Didn't reproduce the error:\r\n\r\n<img width=\"1496\" alt=\"web\" src=\"https://github.com/temporalio/sdk-php/assets/67324318/6e1f6711-cc5c-4fc5-98e5-e56540824993\">\r\n\r\n<img width=\"904\" alt=\"console-command\" src=\"https://github.com/temporalio/sdk-php/assets/67324318/e5bfdeb4-450a-4c1d-a652-14cd253e0b75\">\r\n\r\nCould you double check?\r\n\r\n\r\n\r\n","createdAt":"2023-07-05T13:06:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/264#issuecomment-1621723256","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5h7kdV","author":{"login":"Neznaykas"},"authorAssociation":"CONTRIBUTOR","body":"Yes, error has if return class Generator in SubChild\r\n\r\nfixed set return type Iterable","createdAt":"2023-07-20T02:16:58Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/264#issuecomment-1643005781","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5le9lS","author":{"login":"rustatian"},"authorAssociation":"COLLABORATOR","body":"Closing as fixed","createdAt":"2023-09-01T11:41:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/264#issuecomment-1702615378","viewerDidAuthor":false}],"createdAt":"2022-11-24T10:32:32Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTkx","name":"Question","description":"Further information is requested","color":"0173a0"}],"milestone":{"number":3,"title":"2.8.0","description":"","dueOn":null},"number":264,"reactionGroups":[],"state":"CLOSED","title":"Class Generator is an internal class marked as final that cannot be instantiated without invoking its constructor","updatedAt":"2023-09-01T11:41:57Z","url":"https://github.com/temporalio/sdk-php/issues/264"}
