{"assignees":[{"id":"MDQ6VXNlcjk5NTk3NjE=","login":"seregazhuk","name":"Sergey Zhuk","databaseId":0}],"author":{"id":"MDQ6VXNlcjY2Mzk3Mjg=","is_bot":false,"login":"benkelukas","name":"Lukas Benke"},"body":"### What are you really trying to do?\r\n\r\nWhen using CRON scheduled workflow and returning a protobuf message from said workflow, the message cannot be parsed when trying to fetch previous workflow result via `Workflow::getLastCompletionResult()`\r\n\r\n### Describe the bug\r\n\r\n1. Create a CRON scheduled workflow\r\n2. Return a protobuf message from workflow as it's result\r\n3. Fetch last completion result using `Workflow::getLastCompletionResult()`\r\n4. There is an error:\r\n\r\n```json\r\n{\r\n  \"message\": \"Unable to decode value using protobuf converter - \",\r\n  \"source\": \"PHP_SDK\",\r\n  \"stackTrace\": \"Temporal\\\\Exception\\\\DataConverterException: Unable to decode value using protobuf converter -  in /app/vendor/temporal/sdk/src/DataConverter/ProtoJsonConverter.php:50\\nStack trace:\\n#0 /app/vendor/temporal/sdk/src/DataConverter/DataConverter.php(53)... [omitted for brewity]\r\n  \"cause\": null,\r\n  \"applicationFailureInfo\": {\r\n    \"type\": \"Temporal\\\\Exception\\\\DataConverterException\",\r\n    \"nonRetryable\": false,\r\n    \"details\": null\r\n  },\r\n  \"failureInfo\": \"applicationFailureInfo\"\r\n}\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\n[https://github.com/benkelukas/samples-php/commit/620139f033bc68ae97db1b92bf65b6d4397c08d9](https://github.com/benkelukas/samples-php/commit/620139f033bc68ae97db1b92bf65b6d4397c08d9)\r\n\r\nSimpleActivity is modified to use CRON schedules.\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- OS and processor: Intel MacOS, Catalina\r\n- Temporal Version: 1.14.4, PHP SDK 1.1.1\r\n- Docker setup\r\n\r\n### Additional context\r\n\r\n[Slack thread](https://temporalio.slack.com/archives/C01LK9FAMM0/p1643973542928279)\r\n","closedAt":"2022-02-09T08:21:47Z","comments":[{"id":"IC_kwDOEY5HBM49kuSP","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"@benkelukas I have investigated the problem. Try to do the following:\r\n1. In your `WorkflowInterface` add explicit attribute for the return type:\r\n\r\n```php\r\ninterface GreetingWorkflowInterface\r\n{\r\n    /**\r\n     * @param string $name\r\n     * @return WorkflowResult\r\n     */\r\n    #[WorkflowMethod(name: \"SimpleActivity.greet\")]\r\n    #[ReturnType(WorkflowResult::class)]\r\n    public function greet(string $name);\r\n}\r\n```\r\n2. In the command don't forget that the result object is now `WorkflowResult`. Don't try to print it, and use on of the getters:\r\n```php\r\n$output->writeln(sprintf(\"Result:\\n<info>%s</info>\", $run->getResult()->getGreeting()));\r\n```\r\n\r\nHope, it will help you. Waiting for you feedback.","createdAt":"2022-02-08T20:34:27Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/141#issuecomment-1033036943","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM49mZ2d","author":{"login":"benkelukas"},"authorAssociation":"NONE","body":"Hi @seregazhuk \r\n\r\nthanks a lot for taking a look at this, it works! :)\r\n\r\nI suppose I could've tried this by myself, however, there is the `ExpectedType` attribute on the `ReturnType` attribute's type argument, so I kinda supposed (wrongly) that this is not possible.\r\n\r\nMaybe it would be also good to update docs to mention that one can, in fact, use PHP protobuf messages and what to do when one wants to use it for Workflow return types, as I think it's a pretty good way how to structure data passing between activities / worfklows - but I understand that not everybody wants to go through the hassle of generating PHP code from `.proto` files - not sure if it is in scope for the docs.\r\n\r\nThere remains one little caveat for me: PHPStorm complains that I've provided unexpected type to the `ReturnType` annotation, it's nothing serious and I can disable inspections for statement, but maybe the attribute could be expanded to allow custom types somehow?\r\n\r\nThanks again for taking the time to help me, You guys rock! :)\r\n\r\nI'm closing the issue, cheers!","createdAt":"2022-02-09T08:21:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/141#issuecomment-1033477533","viewerDidAuthor":false}],"createdAt":"2022-02-07T07:29:52Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":141,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Cannot decode value using Protobuf converter when fetching previous workflow result","updatedAt":"2022-02-09T08:21:48Z","url":"https://github.com/temporalio/sdk-php/issues/141"}
