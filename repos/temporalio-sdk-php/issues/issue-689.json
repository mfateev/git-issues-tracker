{"assignees":[],"author":{"id":"MDQ6VXNlcjU4NzAxOA==","is_bot":false,"login":"adepretis","name":"Andreas de Pretis"},"body":"### What are you really trying to do?\n\nInstalling the Temporal PHP SDK using composer with `--ignore-platform-reqs`.\n\n### Describe the bug\n\nThe Temporal PHP SDK does not adhere to common practices for composer installations and is checking `grpc` availability in the code.\n\nThere are plenty of use-cases to run `composer install --ignore-platform-reqs` which allows installing composer packages without checking for e.g. installed PHP extensions.\n\nA PHP package would typically define its platform requirements in `composer.json`. Temporal does that too for the correct PHP version and PHP's `curl` and `json` extension.\n\n```\n    \"require\": {\n        \"php\": \">=8.1\",\n        \"ext-curl\": \"*\",\n        \"ext-json\": \"*\",\n```\n\nWhat is missing here though is\n\n```\n    \"require\": {\n        \"php\": \">=8.1\",\n        \"ext-curl\": \"*\",\n        \"ext-json\": \"*\",\n        \"ext-grpc\": \"*\",\n```\n\nInstead the `grpc` availability is check in https://github.com/temporalio/sdk-php/blob/master/src/Client/GRPC/BaseClient.php#L99-L101.\n\nNormally this is not an issue, but in case of [Laravel's package discovery](https://greasy.dev/en/blog/laravel-package-auto-discovery-explained) the PHP code seems to be executed and fails - wether `--ignore-platform-reqs` is given or not.\n\n```\n   RuntimeException\n\n  The gRPC extension is required to use Temporal Client.\n\n  at vendor/temporal/sdk/src/Client/GRPC/BaseClient.php:72\n     68▕      */\n     69▕     public static function create(string $address): static\n     70▕     {\n     71▕         if (!\\extension_loaded('grpc')) {\n  ➜  72▕             throw new \\RuntimeException('The gRPC extension is required to use Temporal Client.');\n     73▕         }\n     74▕\n     75▕         return new static(static fn(): WorkflowServiceClient => new WorkflowServiceClient(\n     76▕             $address,\n```\n\nAlso, for some reason, adding `temporal/sdk` to `composer.json` doesn't help either:\n\n```\n      \"extra\": {\n          \"laravel\": {\n              \"dont-discover\": [\"temporal/sdk\"]\n          }\n      },\n```\n\n### Minimal Reproduction\n\n- create a Laravel project\n- if not created by Laravel bootstrapping add the following to `composer.json`\n\n```\n    \"scripts\": {\n        \"post-autoload-dump\": [\n            \"Illuminate\\\\Foundation\\\\ComposerScripts::postAutoloadDump\",\n            \"@php artisan package:discover --ansi\"\n        ],\n```\n\n- run `composer install --ignore-platform-reqs` with no `grpc` extension installed\n\n\n### Environment/Versions\n\n- Temporal SDK version: 2.16.0\n","closedAt":null,"comments":[{"id":"IC_kwDOEY5HBM7dqKOE","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"Related issue: https://github.com/temporalio/sdk-php/issues/394","createdAt":"2026-01-07T13:14:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/689#issuecomment-3718816644","viewerDidAuthor":false}],"createdAt":"2026-01-07T12:19:49Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":689,"reactionGroups":[],"state":"OPEN","title":"[Bug] Temporal PHP SDK doing its own extension check, breaking composer's `--ignore-platform-reqs`","updatedAt":"2026-01-07T13:14:34Z","url":"https://github.com/temporalio/sdk-php/issues/689"}
