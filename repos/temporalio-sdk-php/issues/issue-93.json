{"assignees":[],"author":{"id":"MDQ6VXNlcjkyNzU5OTE=","is_bot":false,"login":"khoerintus","name":""},"body":"**Describe the bug**\r\nActivity return associative array, but when the return result is used in workflow, it became an object, not an array.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. In Activity method, return associative array. Example:\r\n```\r\n        return [\r\n            'Peter' => '123',\r\n            'Ben' => '234',\r\n            'Joe' => '345'\r\n        ];\r\n```\r\n2. Use the return value as associative array in workflow. Example:\r\n```\r\n        $simple = Workflow::newActivityStub(\r\n            SimpleActivity::class,\r\n            ActivityOptions::new()\r\n                ->withStartToCloseTimeout(300)\r\n                ->withRetryOptions(\r\n                    RetryOptions::new()->withMaximumAttempts(1)\r\n                )\r\n        );\r\n        $assocArray = yield $simple->getAssocArray($input);\r\n\r\n        return $assocArray['Peter'];\r\n```\r\n\r\n**Expected behavior**\r\nI can use the return value, as an array, not as an object.\r\n\r\n**Screenshots/Terminal ouput**\r\n```\r\nWARN    temporal        Failed to process workflow task.        {\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"209439@khoerintus-Lenovo-G40-80@default@1\", \"WorkflowType\": \"SimpleWorkflow.handle\", \"WorkflowID\": \"d411c5ae-32a7-4879-873b-704dc270eef8\", \"RunID\": \"dcf2fa14-ceb2-4c99-9b17-a7d214e4d84f\", \"Attempt\": 9, \"Error\": \"Cannot use object of type stdClass as array (type: Error, retryable: true)\"}\r\n\r\nERROR   temporal        Workflow panic  {\"Namespace\": \"default\", \"TaskQueue\": \"default\", \"WorkerID\": \"209439@khoerintus-Lenovo-G40-80@default@1\", \"WorkflowType\": \"SimpleWorkflow.handle\", \"WorkflowID\": \"d411c5ae-32a7-4879-873b-704dc270eef8\", \"RunID\": \"dcf2fa14-ceb2-4c99-9b17-a7d214e4d84f\", \"Attempt\": 10, \"Error\": \"Cannot use object of type stdClass as array (type: Error, retryable: true)\", \"StackTrace\": \"process event for default [panic]:\\ngithub.com/temporalio/roadrunner-temporal/workflow.(*workflowProcess).OnWorkflowTaskStarted(0xc000629400)\\n\\tgithub.com/temporalio/roadrunner-temporal@v1.0.1/workflow/process.go:95 +0x2b9\\ngo.temporal.io/sdk/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0xc000584d08, 0xc0005a3d00, 0x100, 0x0, 0x0)\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_event_handlers.go:791 +0x3b8\\ngo.temporal.io/sdk/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0xc000aa6e10, 0xc000314990, 0x1d0f740, 0xc000515c70, 0xc000aa6e10, 0x0)\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_task_handlers.go:876 +0x72c\\ngo.temporal.io/sdk/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0xc000134420, 0xc000314990, 0xc0002e8db0, 0x0, 0x0, 0x0, 0x0)\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_task_handlers.go:727 +0x6d9\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).processWorkflowTask(0xc0004f8750, 0xc000314990, 0x0, 0x0)\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_task_pollers.go:288 +0x4ae\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).ProcessTask(0xc0004f8750, 0x1190c80, 0xc000314990, 0xc000aa6d80, 0xc0006c1800)\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_task_pollers.go:259 +0x85\\ngo.temporal.io/sdk/internal.(*baseWorker).processTask(0xc0002fe2d0, 0x1190840, 0xc0004f7f90)\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_worker_base.go:343 +0xb8\\ncreated by go.temporal.io/sdk/internal.(*baseWorker).runTaskDispatcher\\n\\tgo.temporal.io/sdk@v1.5.0/internal/internal_worker_base.go:270 +0xff\"}\r\n```\r\n\r\n**Versions (please complete the following information where relevant):**\r\n - OS: Linux\r\n - Temporal Version: 1.7.0\r\n - are you using Docker or Kubernetes or building Temporal from source? Using Docker\r\n\r\n**Additional context**\r\n","closedAt":"2021-03-23T04:52:55Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgwNDAwODM5OQ==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"Hello!\r\n\r\nIt is worth noting that Temporal can communicate with external services that can be written in an arbitrary language. The default codec used is JSON, where there is no such thing as an associative array, as in most programming languages existing in the world.\r\n\r\nTherefore, when packing such data into this format, the types are converted from an hash-map to an object:\r\n```php\r\n['key' => 'value'] \r\n// ->\r\n{\"key\": \"value\"}\r\n```\r\n\r\nWhich is the representation of the anonymous object.\r\n\r\nThat is, in this case, this is not an bug, but rather a limitation of the transport protocol.\r\n\r\nTo solve this problem, you should convert the result explicitly back from anonymous object to PHP hash-map:\r\n```php\r\n$assocArray = (array)(yield $simple->getAssocArray($input));\r\n```\r\n\r\n@wolfy-j perhaps can tell if switching to a different codec will help solve this problem. And if so, how to do it technically.","createdAt":"2021-03-22T12:00:25Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/93#issuecomment-804008399","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwNDEwNTAxNg==","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"I would strongly recommend using proper DTO for such purposes. You can create objects with public properties. Temporal should typecast it if this object is set as the return type of the activity.","createdAt":"2021-03-22T14:26:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/93#issuecomment-804105016","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwNDYxNTEzNA==","author":{"login":"khoerintus"},"authorAssociation":"NONE","body":"Hi @SerafimArts,\r\nNoted. Thanks for your explanation and suggestion.\r\nI will update my code to use DTO suggested by @wolfy-j instead of using associative array.","createdAt":"2021-03-23T04:52:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/93#issuecomment-804615134","viewerDidAuthor":false}],"createdAt":"2021-03-22T11:34:48Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":93,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Activity return an associative array, but in workflow, the return value is parsed as an object","updatedAt":"2021-03-23T04:52:55Z","url":"https://github.com/temporalio/sdk-php/issues/93"}
