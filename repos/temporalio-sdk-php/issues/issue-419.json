{"assignees":[{"id":"MDQ6VXNlcjUxNzY4Mw==","login":"Sushisource","name":"Spencer Judge","databaseId":0},{"id":"MDQ6VXNlcjc5NjEzNg==","login":"wolfy-j","name":"Anton Tsitou","databaseId":0},{"id":"MDQ6VXNlcjQxNTI0ODE=","login":"roxblnfk","name":"Aleksei Gagarin","databaseId":0}],"author":{"id":"MDQ6VXNlcjQxNTI0ODE=","is_bot":false,"login":"roxblnfk","name":"Aleksei Gagarin"},"body":"## I have an idea\r\n\r\nI suggest adjusting the Workflow Client interface: introduce a distinction between the concepts of Stub and Proxy.\r\n\r\nCurrently, as a result of calling the method `WorkflowClient::newWorkflowStub($class)` (or `WorkflowClient::newRunningWorkflowStub($class)`), we do not receive a Workflow Stub ([WorkflowStubInterface](https://github.com/temporalio/sdk-php/blob/master/src/Client/WorkflowStubInterface.php)), but a proxy object that redirects calls of Workflow methods related to the Workflow interface. That is, the user interacts with the proxy object as with an implementation of the user's Workflow interface.\r\n\r\nAt the same time, we have methods `WorkflowClient::newUntypedWorkflowStub()`, `WorkflowClient::newUntypedRunningWorkflowStub()`, which return the very [WorkflowStubInterface](https://github.com/temporalio/sdk-php/blob/master/src/Client/WorkflowStubInterface.php) (type-level guarantee). That is, they work as expected.\r\n\r\n> [!NOTE]\r\n> `WorkflowStubInterface` is convenient when, for example, you need to call the Describe method or the Update method with your own WaitPolicy.\r\n\r\nWe face two problems:\r\n- methods with the `Stub` postfix work differently: two out of four return `WorkflowStubInterface`, the other two return a proxy.\r\n- there is no proper way to get `WorkflowStubInterface` from a Workflow class. Both methods that accept a class return us a proxy.\r\n\r\nIn this commit, you can see changes in the `WorkflowClientInterface` interface. \r\nhttps://github.com/temporalio/sdk-php/commit/1847f723ff5ece0320dccfc30312da387c032b96\r\nIn the methods that currently return a Proxy, I've considered backward compatibility through the `$proxy` parameter. This will all be cleaned up in the next major version.\r\nCalls to create stubs with `$proxy=true` will throw deprecation notices.\r\n\r\nWe can also discuss replacing the naming of Stub with Handle. Then we'll just make all the *Stub methods deprecated :)\r\n","closedAt":null,"comments":[{"id":"IC_kwDOEY5HBM56vRLU","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"@Sushisource, I propose to introduce new methods instead. Can we hop on a call to discuss it?","createdAt":"2024-04-16T14:18:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/419#issuecomment-2059211476","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM56vbQE","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"New methods might be:\r\n\r\n```php\r\n// Return WorkflowStubInterface\r\n$wfClient->newWorkflow($class, ...);\r\n$wfClient->newRunningWorkflow($class, ...);\r\n\r\n// Return Proxy objects. There is `Proxy` suffix\r\n$wfClient->newWorkflowProxy($class, ...);\r\n$wfClient->newRunningWorkflowProxy($class, ...);\r\n\r\n// Untyped (unknown class name). Return WorkflowStubInterface\r\n$wfClient->newUntypedWorkflow($type, ...);\r\n$wfClient->newUntypedRunningWorkflow($type, ...);\r\n\r\n// DEPRECATED\r\n$wfClient->newWorkflowStub($class, ...); // Proxy object\r\n$wfClient->newRunningWorkflowStub($class, ...); // Proxy object\r\n$wfClient->newUntypedWorkflowStub($type, ...); // WorkflowStubInterface\r\n$wfClient->newUntypedRunningWorkflowStub($type, ...); // WorkflowStubInterface\r\n```","createdAt":"2024-04-16T14:36:40Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/419#issuecomment-2059252740","viewerDidAuthor":false}],"createdAt":"2024-04-12T13:28:38Z","labels":[{"id":"MDU6TGFiZWw0MDMxNTY5NTYw","name":"enhancement","description":"","color":"a2eeef"}],"milestone":null,"number":419,"reactionGroups":[],"state":"OPEN","title":"[Feature Request] Divide Workflow stub objects and Workflow proxy objects","updatedAt":"2024-04-16T14:37:09Z","url":"https://github.com/temporalio/sdk-php/issues/419"}
