{"assignees":[],"author":{"id":"MDQ6VXNlcjEzODE2NzA0","is_bot":false,"login":"root-aza","name":"Vlad Shashkov"},"body":"### What are you really trying to do?\r\n\r\nWe are trying to start a workflow with a class descendant\r\n\r\n### Describe the bug\r\n\r\n\r\n### Minimal Reproduction\r\n\r\n<details>\r\n  <summary>Code</summary>\r\n\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nnamespace App\\LoanApplication\\Workflow;\r\n\r\nuse Generator;\r\nuse Temporal\\Workflow;\r\nuse Temporal\\Workflow\\WorkflowMethod;\r\n\r\nabstract class AbstractWorkflow\r\n{\r\n    #[WorkflowMethod]\r\n    final public function start(string $id): Generator\r\n    {\r\n        $workflow = Workflow::newExternalWorkflowStub(\r\n            RootWorkflow::class,\r\n            new Workflow\\WorkflowExecution($id)\r\n        );\r\n\r\n\r\n        yield from $this->go($workflow);\r\n    }\r\n\r\n\r\n    /**\r\n     * @param RootWorkflow $workflow\r\n     */\r\n    abstract protected function go($workflow): Generator;\r\n}\r\n```\r\n\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nnamespace App\\LoanApplication\\Workflow;\r\n\r\nuse Generator;\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\nuse Vanta\\Integration\\Symfony\\Temporal\\Attribute\\AssignWorker;\r\n\r\n#[WorkflowInterface]\r\n#[AssignWorker('bus.bank_application')]\r\nfinal class AWorkflow extends AbstractWorkflow\r\n{\r\n    protected function go($workflow): Generator\r\n    {\r\n        yield $workflow->ok();\r\n    }\r\n}\r\n```\r\n\r\n\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nnamespace App\\LoanApplication\\Workflow;\r\n\r\nuse Generator;\r\nuse Temporal\\Workflow;\r\nuse Temporal\\Workflow\\ChildWorkflowOptions;\r\nuse Temporal\\Workflow\\ParentClosePolicy;\r\nuse Temporal\\Workflow\\SignalMethod;\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\nuse Temporal\\Workflow\\WorkflowMethod;\r\nuse Vanta\\Integration\\Symfony\\Temporal\\Attribute\\AssignWorker;\r\n\r\n#[WorkflowInterface]\r\n#[AssignWorker('bus.bank_application')]\r\nfinal class RootWorkflow\r\n{\r\n    private bool $status = false;\r\n\r\n\r\n    #[WorkflowMethod]\r\n    public function start(): Generator\r\n    {\r\n        $workflow = Workflow::newChildWorkflowStub(\r\n            AWorkflow::class,\r\n            ChildWorkflowOptions::new()\r\n                ->withNamespace(Workflow::getInfo()->namespace)\r\n                ->withTaskQueue('bus.bank_application')\r\n                ->withParentClosePolicy(ParentClosePolicy::POLICY_ABANDON)\r\n        );\r\n\r\n\r\n        $workflow->start(Workflow::getInfo()->execution->getID());\r\n\r\n\r\n        yield Workflow::await(fn(): bool => $this->status);\r\n    }\r\n\r\n\r\n    #[SignalMethod]\r\n    public function ok(): null\r\n    {\r\n        $this->status = true;\r\n\r\n        return null;\r\n    }\r\n}\r\n```\r\n\r\n</details>\r\n\r\n\r\n\r\n<details>\r\n  <summary>StackTrace</summary>\r\n\r\n```json\r\n\r\n{\r\n  \"message\": \"The given stub class \\\"App\\\\LoanApplication\\\\Workflow\\\\AWorkflow\\\" does not contain a workflow method named \\\"start\\\"\",\r\n  \"source\": \"PHP_SDK\",\r\n  \"stackTrace\": \"#0  /var/www/api/src/LoanApplication/Workflow/RootWorkflow.php:41\\n    Temporal\\\\Internal\\\\Workflow\\\\ChildWorkflowProxy->__call(\\\"start\\\",array(1))\\n#1  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Scope.php:363\\n    App\\\\LoanApplication\\\\Workflow\\\\RootWorkflow->start()\\n#2  [internal function]\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Scope->call(Closure,Temporal\\\\DataConverter\\\\EncodedValues)\\n#3  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Scope.php:452\\n    Generator->valid()\\n#4  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Scope.php:186\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Scope->next()\\n#5  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Process.php:183\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Scope->start(Closure,Temporal\\\\DataConverter\\\\EncodedValues)\\n#6  /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php:91\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Process->start(Closure,Temporal\\\\DataConverter\\\\EncodedValues)\\n#7  /var/www/api/vendor/temporal/sdk/src/Internal/Interceptor/Pipeline.php:95\\n    Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->Temporal\\\\Internal\\\\Transport\\\\Router\\\\{closure}(Temporal\\\\Interceptor\\\\WorkflowInbound\\\\WorkflowInput)\\n#8  /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php:104\\n    Temporal\\\\Internal\\\\Interceptor\\\\Pipeline->__invoke(Temporal\\\\Interceptor\\\\WorkflowInbound\\\\WorkflowInput)\\n#9  /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router.php:82\\n    Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->handle(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4),React\\\\Promise\\\\Deferred)\\n#10 /var/www/api/vendor/temporal/sdk/src/Worker/Worker.php:91\\n    Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#11 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php:422\\n    Temporal\\\\Worker\\\\Worker->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#12 /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Server.php:63\\n    Temporal\\\\WorkerFactory->onRequest(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#13 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php:399\\n    Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#14 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php:269\\n    Temporal\\\\WorkerFactory->dispatch(\\\"\\\\n\\ufffd\\\\^E\\\\b\\\\^A\\\\^R\\\\rStartWorkflow\\\\^Z\\ufffd\\\\^E{\\\\\\\"info\\\\\\\":{\\\\\\\"WorkflowExecution...\\\",array(4))\\n#15 /var/www/api/vendor/vanta/temporal-bundle/src/Runtime/Runtime.php:32\\n    Temporal\\\\WorkerFactory->run()\\n#16 /var/www/api/vendor/vanta/temporal-bundle/src/Runtime/TemporalRunner.php:25\\n    Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Runtime\\\\Runtime->run()\\n#17 /var/www/api/vendor/autoload_runtime.php:29\\n    Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Runtime\\\\TemporalRunner->run()\\n#18 /var/www/api/public/index.php:7\\n    require_once(\\\"\\\\/var\\\\/www\\\\/api\\\\/vendor\\\\/autoload_runtime.php\\\")\",\r\n  \"encodedAttributes\": null,\r\n  \"cause\": null,\r\n  \"applicationFailureInfo\": {\r\n    \"type\": \"BadMethodCallException\",\r\n    \"nonRetryable\": false,\r\n    \"details\": null\r\n  }\r\n}\r\n```\r\n</details>\r\n\r\n\r\n\r\n<details>\r\n  <summary>Events Workflow</summary>\r\n\r\n```json\r\n{\r\n  \"events\": [\r\n    {\r\n      \"eventId\": \"1\",\r\n      \"eventTime\": \"2024-05-17T07:44:33.985056926Z\",\r\n      \"eventType\": \"WorkflowExecutionStarted\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048714\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowExecutionStartedEventAttributes\": {\r\n        \"workflowType\": {\r\n          \"name\": \"RootWorkflow\"\r\n        },\r\n        \"parentWorkflowNamespace\": \"\",\r\n        \"parentWorkflowNamespaceId\": \"\",\r\n        \"parentWorkflowExecution\": null,\r\n        \"parentInitiatedEventId\": \"0\",\r\n        \"taskQueue\": {\r\n          \"name\": \"bus.bank_application\",\r\n          \"kind\": \"Normal\",\r\n          \"normalName\": \"\"\r\n        },\r\n        \"input\": null,\r\n        \"workflowExecutionTimeout\": \"0s\",\r\n        \"workflowRunTimeout\": \"0s\",\r\n        \"workflowTaskTimeout\": \"10s\",\r\n        \"continuedExecutionRunId\": \"\",\r\n        \"initiator\": \"Unspecified\",\r\n        \"continuedFailure\": null,\r\n        \"lastCompletionResult\": null,\r\n        \"originalExecutionRunId\": \"a675ae9a-f0af-426b-b48e-83a530ff2bc5\",\r\n        \"identity\": \"35@6e8cab123894\",\r\n        \"firstExecutionRunId\": \"a675ae9a-f0af-426b-b48e-83a530ff2bc5\",\r\n        \"retryPolicy\": null,\r\n        \"attempt\": 1,\r\n        \"workflowExecutionExpirationTime\": null,\r\n        \"cronSchedule\": \"\",\r\n        \"firstWorkflowTaskBackoff\": \"0s\",\r\n        \"memo\": null,\r\n        \"searchAttributes\": null,\r\n        \"prevAutoResetPoints\": null,\r\n        \"header\": {\r\n          \"fields\": {}\r\n        },\r\n        \"parentInitiatedEventVersion\": \"0\",\r\n        \"workflowId\": \"346c4917-9559-4043-9cfd-49da7afcbdff\",\r\n        \"sourceVersionStamp\": null\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"2\",\r\n      \"eventTime\": \"2024-05-17T07:44:33.985092009Z\",\r\n      \"eventType\": \"WorkflowTaskScheduled\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048715\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowTaskScheduledEventAttributes\": {\r\n        \"taskQueue\": {\r\n          \"name\": \"bus.bank_application\",\r\n          \"kind\": \"Normal\",\r\n          \"normalName\": \"\"\r\n        },\r\n        \"startToCloseTimeout\": \"10s\",\r\n        \"attempt\": 1\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"3\",\r\n      \"eventTime\": \"2024-05-17T07:44:33.991138217Z\",\r\n      \"eventType\": \"WorkflowTaskStarted\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048720\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowTaskStartedEventAttributes\": {\r\n        \"scheduledEventId\": \"2\",\r\n        \"identity\": \"bus.bank_application:7eaf76d2-14b7-4138-b2ec-5b96cfa7e42d\",\r\n        \"requestId\": \"21da69d4-e7fb-4efa-bac0-9f2f228f72ce\",\r\n        \"suggestContinueAsNew\": false,\r\n        \"historySizeBytes\": \"278\"\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"4\",\r\n      \"eventTime\": \"2024-05-17T07:44:34.088138134Z\",\r\n      \"eventType\": \"WorkflowTaskCompleted\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048724\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowTaskCompletedEventAttributes\": {\r\n        \"scheduledEventId\": \"2\",\r\n        \"startedEventId\": \"3\",\r\n        \"identity\": \"bus.bank_application:7eaf76d2-14b7-4138-b2ec-5b96cfa7e42d\",\r\n        \"binaryChecksum\": \"\",\r\n        \"workerVersion\": {\r\n          \"buildId\": \"3850375e06e98d90ebe249b19dfded53\",\r\n          \"bundleId\": \"\",\r\n          \"useVersioning\": false\r\n        },\r\n        \"sdkMetadata\": {\r\n          \"coreUsedFlags\": [],\r\n          \"langUsedFlags\": [\r\n            3\r\n          ],\r\n          \"sdkName\": \"temporal-go\",\r\n          \"sdkVersion\": \"1.26.0\"\r\n        },\r\n        \"meteringMetadata\": {\r\n          \"nonfirstLocalActivityExecutionAttempts\": 0\r\n        }\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"5\",\r\n      \"eventTime\": \"2024-05-17T07:44:34.088162967Z\",\r\n      \"eventType\": \"WorkflowExecutionFailed\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048725\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowExecutionFailedEventAttributes\": {\r\n        \"failure\": {\r\n          \"message\": \"The given stub class \\\"App\\\\LoanApplication\\\\Workflow\\\\AWorkflow\\\" does not contain a workflow method named \\\"start\\\"\",\r\n          \"source\": \"PHP_SDK\",\r\n          \"stackTrace\": \"#0  /var/www/api/src/LoanApplication/Workflow/RootWorkflow.php:41\\n    Temporal\\\\Internal\\\\Workflow\\\\ChildWorkflowProxy->__call(\\\"start\\\",array(1))\\n#1  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Scope.php:363\\n    App\\\\LoanApplication\\\\Workflow\\\\RootWorkflow->start()\\n#2  [internal function]\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Scope->call(Closure,Temporal\\\\DataConverter\\\\EncodedValues)\\n#3  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Scope.php:452\\n    Generator->valid()\\n#4  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Scope.php:186\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Scope->next()\\n#5  /var/www/api/vendor/temporal/sdk/src/Internal/Workflow/Process/Process.php:183\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Scope->start(Closure,Temporal\\\\DataConverter\\\\EncodedValues)\\n#6  /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php:91\\n    Temporal\\\\Internal\\\\Workflow\\\\Process\\\\Process->start(Closure,Temporal\\\\DataConverter\\\\EncodedValues)\\n#7  /var/www/api/vendor/temporal/sdk/src/Internal/Interceptor/Pipeline.php:95\\n    Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->Temporal\\\\Internal\\\\Transport\\\\Router\\\\{closure}(Temporal\\\\Interceptor\\\\WorkflowInbound\\\\WorkflowInput)\\n#8  /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router/StartWorkflow.php:104\\n    Temporal\\\\Internal\\\\Interceptor\\\\Pipeline->__invoke(Temporal\\\\Interceptor\\\\WorkflowInbound\\\\WorkflowInput)\\n#9  /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router.php:82\\n    Temporal\\\\Internal\\\\Transport\\\\Router\\\\StartWorkflow->handle(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4),React\\\\Promise\\\\Deferred)\\n#10 /var/www/api/vendor/temporal/sdk/src/Worker/Worker.php:91\\n    Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#11 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php:422\\n    Temporal\\\\Worker\\\\Worker->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#12 /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Server.php:63\\n    Temporal\\\\WorkerFactory->onRequest(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#13 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php:399\\n    Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest,array(4))\\n#14 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php:269\\n    Temporal\\\\WorkerFactory->dispatch(\\\"\\\\n\\ufffd\\\\^E\\\\b\\\\^A\\\\^R\\\\rStartWorkflow\\\\^Z\\ufffd\\\\^E{\\\\\\\"info\\\\\\\":{\\\\\\\"WorkflowExecution...\\\",array(4))\\n#15 /var/www/api/vendor/vanta/temporal-bundle/src/Runtime/Runtime.php:32\\n    Temporal\\\\WorkerFactory->run()\\n#16 /var/www/api/vendor/vanta/temporal-bundle/src/Runtime/TemporalRunner.php:25\\n    Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Runtime\\\\Runtime->run()\\n#17 /var/www/api/vendor/autoload_runtime.php:29\\n    Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Runtime\\\\TemporalRunner->run()\\n#18 /var/www/api/public/index.php:7\\n    require_once(\\\"\\\\/var\\\\/www\\\\/api\\\\/vendor\\\\/autoload_runtime.php\\\")\",\r\n          \"encodedAttributes\": null,\r\n          \"cause\": null,\r\n          \"applicationFailureInfo\": {\r\n            \"type\": \"BadMethodCallException\",\r\n            \"nonRetryable\": false,\r\n            \"details\": null\r\n          }\r\n        },\r\n        \"retryState\": \"RetryPolicyNotSet\",\r\n        \"workflowTaskCompletedEventId\": \"4\",\r\n        \"newExecutionRunId\": \"\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n</details>\r\n\r\n\r\n\r\n### Environment/Versions\r\n\r\ntemporal/sdk v2.8.1\r\ntemporal server v1.22.4\r\n","closedAt":"2024-10-07T19:39:54Z","comments":[{"id":"IC_kwDOEY5HBM6GCZkh","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"The current bypass approach is to clearly define workflow method attribute at descendant. ","createdAt":"2024-07-24T19:45:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/435#issuecomment-2248775969","viewerDidAuthor":false}],"createdAt":"2024-05-17T07:54:30Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":22,"title":"2.12.0","description":"","dueOn":null},"number":435,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] Abstract Workflow not started","updatedAt":"2024-10-07T19:44:42Z","url":"https://github.com/temporalio/sdk-php/issues/435"}
