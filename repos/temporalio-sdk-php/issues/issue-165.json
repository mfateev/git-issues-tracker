{"assignees":[{"id":"MDQ6VXNlcjk5NTk3NjE=","login":"seregazhuk","name":"Sergey Zhuk","databaseId":0}],"author":{"id":"MDQ6VXNlcjE3MjI4MjMx","is_bot":false,"login":"OlegKuro","name":"Khayatov Oleg"},"body":"### What are you really trying to do?\r\n\r\nI'm trying to divide one process into two workflows: the first one starts the process and then spawns the second one (child workflow) and immediately completes. Then the second workflows works, but the first should be completed.\r\n\r\n### Describe the bug\r\n\r\nInstead of spawning and immediate completion parent workflow waits for child workflow resolution.\r\nI've tried to find any documentation about correct behavior in this case and found [golang temporal notes](https://docs.temporal.io/docs/go/how-to-spawn-a-child-workflow-execution-in-go/#asynchronous-execution):\r\n\r\n> To asynchronously spawn a Child Workflow Execution, the Child Workflow must have an \"Abandon\" Parent Close Policy set in the Child Workflow Options. Additionally, the Parent Workflow Execution must wait for the \"ChildWorkflowExecutionStarted\" event to appear in its event history before it completes.\r\n\r\n> If the Parent makes the ExecuteChildWorkflow call and then immediately completes, the Child Workflow Execution will not spawn.\r\n\r\nDoes it mean that parent workflow should not wait? ü§î \r\n\r\n### Minimal Reproduction\r\n\r\n```\r\nclass ExampleWorkflow {\r\n\r\n    public function run()\r\n    {\r\n        $child = Workflow::newChildWorkflowStub(\r\n            ChildWorkflowExampleInterface::class,\r\n            ChildWorkflowOptions::new()\r\n                ->withWorkflowId(bin2hex(random_bytes(18)))\r\n                ->withWorkflowIdReusePolicy(WorkflowIdReusePolicy::WORKFLOW_ID_REUSE_POLICY_ALLOW_DUPLICATE)\r\n                ->withParentClosePolicy(ParentClosePolicy::POLICY_ABANDON)\r\n        );\r\n        $child->run();\r\n\r\n        return 'COMPLETED';\r\n    }\r\n}\r\n```\r\n\r\n### Environment/Versions\r\n\r\n- Temporal SDK Version: 1.1.1\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\nWorkflow also waits for activities completion too... I mean I can start an activity and then do some stuff in workflow body. But it seems to not finish while spawned in this workflow activities won't complete. Is it ok?","closedAt":"2022-05-11T09:03:58Z","comments":[{"id":"IC_kwDOEY5HBM5CehTK","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"@OlegKuro thank you! Yes, we have a bug here. Will be fixed in #167 üí™ \r\n","createdAt":"2022-05-02T19:51:21Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/165#issuecomment-1115296970","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5Cj5uE","author":{"login":"OlegKuro"},"authorAssociation":"CONTRIBUTOR","body":"@seregazhuk thank you for fix! üôè ‚ù§Ô∏è \r\n\r\nBut I think I had created too many issues (sorry üòÖ) so you confused #166 and this issue (#165)\r\n\r\n> @OlegKuro the parent should wait for its child. Using abandon policy means that once parent is canceled/terminated the child continues working.\r\n> Related docs:\r\n> \r\n> [Policy](https://docs.temporal.io/docs/concepts/what-is-a-parent-close-policy/)\r\n> [Execution concepts](https://docs.temporal.io/docs/concepts/what-is-a-child-workflow-execution/)\r\n\r\nThank you, got it ü§î . \r\nBut I can create an activity capable of running another workflow via workflow client injected into it. \r\nWould it be more convenient legalizing this hack? \r\n\r\nFor example,\r\nI accumulate requests by `sourceId` in the parent workflow. When I get a certain condition matched, I start another workflow which processes accumulated data and finish execution of parent workflow since this condition is matched until I get a new request with this `sourceId`. \r\nParent workflow id is `sourceId`. Child workflow id is `sourceId-processingStartedAt`. \r\nIn this case I need an opportunity to spawn another workflow and then finish parent workflow execution (or even better to perform these actions simultaneously)","createdAt":"2022-05-03T22:06:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/165#issuecomment-1116707716","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5EtMZg","author":{"login":"seregazhuk"},"authorAssociation":"CONTRIBUTOR","body":"@OlegKuro if it is still relevant to you... your code from this issue should work now üëç  Please, try to update to the latest SDK version. The parent only waits for child to start. Once the child is started, the parent (with abandon policy) can be completed.","createdAt":"2022-06-10T20:04:18Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/165#issuecomment-1152697952","viewerDidAuthor":false}],"createdAt":"2022-04-27T21:49:04Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":165,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Parent workflow waits for child completion","updatedAt":"2022-06-10T20:04:18Z","url":"https://github.com/temporalio/sdk-php/issues/165"}
