{"assignees":[],"author":{"id":"MDQ6VXNlcjI5NDI2MjE=","is_bot":false,"login":"Dirst","name":"Dmitriy Suniaikin"},"body":"Hello, the tests are not working though I did everything according to readme. \r\n\r\nI have symfony app.\r\n\r\nMy worker.test.php\r\n```\r\nrequire dirname(__DIR__) . '/vendor/autoload.php';\r\n\r\nuse App\\ProductImportProcess\\App\\Activity\\ProductImportFlowActivity;\r\nuse App\\ProductImportProcess\\App\\Workflow\\ProductImportWorkflow;\r\nuse RoadRunner\\VersionChecker\\Version\\Installed;\r\nuse RoadRunner\\VersionChecker\\VersionChecker;\r\nuse Temporal\\Testing\\WorkerFactory;\r\nuse Temporal\\Worker\\Transport\\RoadRunner;\r\nuse Temporal\\Worker\\Transport\\RoadRunnerVersionChecker;\r\n\r\n$factory = WorkerFactory::create();\r\n$worker = $factory->newWorker();\r\n\r\n/**\r\n * @TODO Сделать добавление автоматическим.\r\n */\r\n$worker->registerWorkflowTypes(ProductImportWorkflow::class);\r\n$worker->registerActivity(ProductImportFlowActivity::class);\r\n//$worker->registerActivity(FetchProductTemplateActivity::class);\r\n$factory->run(\r\n    RoadRunner::create(\r\n        versionChecker: new RoadRunnerVersionChecker(\r\n            checker: new VersionChecker(\r\n                installedVersion: new Installed(executablePath: 'rr')\r\n            )\r\n        )\r\n    )\r\n);\r\n```\r\n\r\nMy tests/.rr.test.yaml\r\n```\r\nversion: \"3\"\r\n\r\nrpc:\r\n    listen: tcp://127.0.0.1:6001\r\n\r\nserver:\r\n    command: \"php /srv/app/tests/worker.test.php\"\r\n\r\nkv:\r\n    test:\r\n        driver: memory\r\n        config:\r\n            interval: 10\r\n```\r\n\r\nMy tests bootstrap.php\r\n\r\n```\r\nuse Symfony\\Component\\Dotenv\\Dotenv;\r\nuse Temporal\\Testing\\Environment;\r\n\r\nrequire dirname(__DIR__) . '/vendor/autoload.php';\r\n\r\nif (file_exists(dirname(__DIR__) . '/config/bootstrap.php')) {\r\n    require dirname(__DIR__) . '/config/bootstrap.php';\r\n} elseif (method_exists(Dotenv::class, 'bootEnv')) {\r\n    (new Dotenv())->bootEnv(dirname(__DIR__) . '/.env');\r\n}\r\n\r\nif ($_SERVER['APP_DEBUG']) {\r\n    umask(0);\r\n}\r\n\r\n$environment = Environment::create();\r\n\r\n$environment->startTemporalTestServer();\r\n$environment->startRoadRunner('tests/rr serve -c .rr.test.yaml -w tests');\r\n\r\nregister_shutdown_function(fn () => $environment->stop());\r\n```\r\n\r\nMy test\r\n```\r\nnamespace App\\Tests\\New\\Functional\\Temporal;\r\n\r\nuse App\\ProductImportProcess\\App\\Workflow\\ProductImportWorkflow;\r\nuse PHPUnit\\Framework\\TestCase;\r\nuse Ramsey\\Uuid\\Uuid;\r\nuse Temporal\\Client\\GRPC\\ServiceClient;\r\nuse Temporal\\Client\\WorkflowClient;\r\nuse Temporal\\Testing\\ActivityMocker;\r\n\r\nclass ProductImportWorkflowTest extends TestCase\r\n{\r\n    private WorkflowClient $workflowClient;\r\n    private ActivityMocker $activityMocks;\r\n\r\n    protected function setUp(): void\r\n    {\r\n        $this->workflowClient = new WorkflowClient(ServiceClient::create(getenv('TEMPORAL_ADDRESS')));\r\n        $this->activityMocks = new ActivityMocker();\r\n\r\n        parent::setUp();\r\n    }\r\n\r\n    protected function tearDown(): void\r\n    {\r\n        $this->activityMocks->clear();\r\n        parent::tearDown();\r\n    }\r\n\r\n    public function testWorkflow(): void\r\n    {\r\n        $this->activityMocks->expectCompletion('ProductImportFlowActivity.assertCategoryAssigned', 'world');\r\n        $workflow = $this->workflowClient->newWorkflowStub(ProductImportWorkflow::class);\r\n        $run = $this->workflowClient->start($workflow, Uuid::uuid4());\r\n\r\n        $this->assertSame('world', $run->getResult('string'));\r\n    }\r\n}\r\n```\r\n\r\nI run my test with php unit and getting this - it just hangs\r\n![image](https://github.com/temporalio/sdk-php/assets/2942621/b2506464-8ffb-4e8c-988b-8565cb8e6fc1)\r\n","closedAt":"2025-12-26T15:19:35Z","comments":[{"id":"IC_kwDOEY5HBM5-5sE1","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"There is an example https://github.com/wolfy-j/temporal-simple-test-example/","createdAt":"2024-05-24T09:22:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/441#issuecomment-2129051957","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5-5s16","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"> My tests/.rr.test.yaml\r\n\r\nThere is no `temporal` section in config","createdAt":"2024-05-24T09:24:12Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/441#issuecomment-2129055098","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5-6O63","author":{"login":"Dirst"},"authorAssociation":"NONE","body":"Thanks, this is working now, may it is worth to add this information in Readme for testing framework.","createdAt":"2024-05-24T10:28:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/441#issuecomment-2129194679","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM7cHsr-","author":{"login":"xepozz"},"authorAssociation":"COLLABORATOR","body":"Next time, please review the [testing guide](https://github.com/temporalio/sdk-php/blob/master/testing/README.md).\n\nIf you have any questions, feel free to open another issue.","createdAt":"2025-12-26T15:19:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/441#issuecomment-3693005566","viewerDidAuthor":false}],"createdAt":"2024-05-24T07:16:16Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTkx","name":"Question","description":"Further information is requested","color":"0173a0"},{"id":"LA_kwDOEY5HBM8AAAABMGprrQ","name":"Tests","description":"Update tests or testing tools","color":"0E8A16"}],"milestone":null,"number":441,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Can't run the tests according to documentation","updatedAt":"2025-12-26T15:19:35Z","url":"https://github.com/temporalio/sdk-php/issues/441"}
