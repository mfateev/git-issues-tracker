{"assignees":[],"author":{"id":"U_kgDOBYFlyQ","is_bot":false,"login":"pfy-oleksii-storozhylov","name":"Oleksii Storozhylov"},"body":"### What are you really trying to do?\r\n\r\nCall `Update` method for `UntypedRunningWorkflowStub`\r\n\r\n### Describe the bug\r\n\r\nType error is thrown by the WorkflowClient\r\n\r\n### Minimal Reproduction\r\n\r\n- run workflow which supports `\\Temporal\\Workflow\\UpdateMethod` method\r\n- create untyped workflow stub using `\\Temporal\\Client\\WorkflowClientInterface::newUntypedRunningWorkflowStub`\r\n- execute update method\r\n\r\nExample of the code with issue https://github.com/pfy-oleksii-storozhylov/samples-php/blob/workflow-type-issue/app/src/Signal/ExecuteCommand.php#L61-L68\r\n\r\nOutcome\r\n```sh\r\n$ docker compose exec app php app.php Signal\r\n\r\nStarting SignalWorkflow... \r\nStarted: WorkflowID=852126e7-f633-401b-8e86-253eb4eeb8e5, RunID=8b0c185f-7660-4db7-8b19-92e63d91946d\r\nAdd from workflow stub: Name1\r\nResult: Name1 was added\r\nAdd from running workflow stub: Name2\r\nResult: Name2 was added\r\nAdd from untyped running workflow stub: Name3\r\nError: Temporal\\Internal\\Client\\ResponseToResultMapper::mapUpdateWorkflowResponse(): Argument #3 ($workflowType) must be of type string, null given, called in /var/app/vendor/temporal/sdk/src/Internal/Client/WorkflowStub.php on line 310\r\nSignal exit\r\nResult:\r\nArray\r\n(\r\n    [0] => Hello, Name1!\r\n    [1] => Hello, Name2!\r\n    [2] => Hello, Name3!\r\n)\r\n```\r\n\r\nThe `Update` request was processed by the workflow, but the error was thrown in the WorkflowClient\r\n\r\n### Environment/Versions\r\n\r\n- Temporal PHP SDK version 2.12.0\r\n\r\n### Additional context\r\n\r\nIt seems that the problem happens here https://github.com/temporalio/sdk-php/blob/master/src/Internal/Client/WorkflowStub.php#L309-L315 because `$input->workflowType` is nullable string (and it is null for untyped workflows), but `mapUpdateWorkflowResponse` requires not nullable workflowType\r\n\r\nWith the following patch, the WorkflowClient behaves as expected without issues\r\n\r\n```patch\r\nIndex: src/Internal/Client/ResponseToResultMapper.php\r\nIDEA additional info:\r\nSubsystem: com.intellij.openapi.diff.impl.patch.CharsetEP\r\n<+>UTF-8\r\n===================================================================\r\ndiff --git a/src/Internal/Client/ResponseToResultMapper.php b/src/Internal/Client/ResponseToResultMapper.php\r\n--- a/src/Internal/Client/ResponseToResultMapper.php\t(revision 6598397606937c0b51f26ec225748eb8889abcc4)\r\n+++ b/src/Internal/Client/ResponseToResultMapper.php\t(date 1736240478158)\r\n@@ -25,7 +25,7 @@\r\n     public function mapUpdateWorkflowResponse(\r\n         UpdateWorkflowExecutionResponse $result,\r\n         string $updateName,\r\n-        string $workflowType,\r\n+        ?string $workflowType,\r\n         WorkflowExecution $workflowExecution,\r\n     ): StartUpdateOutput {\r\n         $outcome = $result->getOutcome();\r\n```\r\n","closedAt":"2025-01-07T15:00:04Z","comments":[],"createdAt":"2025-01-07T09:48:40Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":28,"title":"2.12.1","description":"","dueOn":null},"number":544,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"CLOSED","title":"[Bug] WorkflowClient throws type error when update method of untyped workflow stub is called","updatedAt":"2025-01-07T15:00:05Z","url":"https://github.com/temporalio/sdk-php/issues/544"}
