{"assignees":[],"author":{"id":"MDQ6VXNlcjEzODE2NzA0","is_bot":false,"login":"root-aza","name":"Vlad Shashkov"},"body":"### What are you really trying to do?\r\n\r\nPass null value to activity\r\n\r\n\r\n<!-- \r\nTell us at a high level what you're doing, to avoid XY problem (https://en.wikipedia.org/wiki/XY_problem) \r\n-->\r\n\r\n### Minimal Reproduction\r\n\r\n\r\n<details>\r\n  <summary>Code</summary>\r\n\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nnamespace App\\Workflow;\r\n\r\nuse Carbon\\CarbonInterval;\r\nuse Temporal\\Activity\\ActivityInterface;\r\nuse Temporal\\Activity\\ActivityMethod;\r\nuse Temporal\\Activity\\ActivityOptions;\r\nuse Temporal\\Workflow;\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\nuse Vanta\\Integration\\Symfony\\Temporal\\Attribute\\AssignWorker;\r\n\r\n#[ActivityInterface]\r\n#[AssignWorker('test')]\r\nfinal class TestActivity\r\n{\r\n    #[ActivityMethod]\r\n    public function foo(?string $pupa): ?string\r\n    {\r\n        return $pupa;\r\n    }\r\n}\r\n\r\n#[WorkflowInterface]\r\n#[AssignWorker('test')]\r\nfinal class TestWorkflow\r\n{\r\n    /**\r\n     * @var TestActivity\r\n     */\r\n    private $activity;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->activity = Workflow::newActivityStub(\r\n            TestActivity::class,\r\n            ActivityOptions::new()\r\n                ->withStartToCloseTimeout(CarbonInterval::minutes(5))\r\n                ->withTaskQueue('test')\r\n        );\r\n    }\r\n\r\n\r\n    #[Workflow\\WorkflowMethod]\r\n    public function start(): \\Generator\r\n    {\r\n        yield $this->activity->foo(null);\r\n    }\r\n}\r\n```\r\n</details>\r\n\r\n<!-- \r\nModify our hello world templates to demonstrate:\r\n\r\n- TypeScript: https://github.com/temporalio/samples-typescript/tree/main/hello-world\r\n- Go: https://github.com/temporalio/money-transfer-project-template-go\r\n- Java: https://github.com/temporalio/money-transfer-project-template-java\r\n- PHP: https://github.com/temporalio/samples-php#samples\r\n-->\r\n\r\n### Environment/Versions\r\n\r\n<!-- Please complete the following information where relevant. -->\r\n\r\n- Temporal Server: 1.22.3, SDK: v2.7.0\r\n\r\n### Additional context\r\n\r\n<details>\r\n  <summary>StackTrace</summary>\r\n\r\n```json\r\n{\r\n  \"message\": \"Failure exceeds size limit.\",\r\n  \"source\": \"\",\r\n  \"stackTrace\": \"\",\r\n  \"encodedAttributes\": null,\r\n  \"cause\": {\r\n    \"message\": \"The passed value of type \\\"null\\\" can not be converted to required type \\\"string\\\"\",\r\n    \"source\": \"PHP_SDK\",\r\n    \"stackTrace\": \"Temporal\\\\Exception\\\\DataConverterException: The passed value of type \\\"null\\\" can not be converted to required type \\\"string\\\" in /var/www/api/vendor/temporal/sdk/src/DataConverter/JsonConverter.php:226\\nStack trace:\\n#0 /var/www/api/vendor/temporal/sdk/src/DataConverter/JsonConverter.php(110): Temporal\\\\DataConverter\\\\JsonConverter->errorInvalidType(Object(Temporal\\\\DataConverter\\\\Type), NULL)\\n#1 /var/www/api/vendor/temporal/sdk/src/DataConverter/DataConverter.php(57): Temporal\\\\DataConverter\\\\JsonConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#2 /var/www/api/vendor/temporal/sdk/src/DataConverter/EncodedValues.php(137): Temporal\\\\DataConverter\\\\DataConverter->fromPayload(Object(Temporal\\\\Api\\\\Common\\\\V1\\\\Payload), Object(Temporal\\\\DataConverter\\\\Type))\\n#3 /var/www/api/vendor/temporal/sdk/src/Internal/Declaration/Dispatcher/AutowiredPayloads.php(32): Temporal\\\\DataConverter\\\\EncodedValues->getValue(0, Object(ReflectionNamedType))\\n#4 /var/www/api/vendor/temporal/sdk/src/Internal/Declaration/Instance.php(76): Temporal\\\\Internal\\\\Declaration\\\\Dispatcher\\\\AutowiredPayloads->dispatchValues(Object(App\\\\LoanApplication\\\\VantaBankWorkflow\\\\Workflow\\\\NewLoanApplicationB2pos\\\\TestActivity), Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#5 /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router/InvokeActivity.php(101): Temporal\\\\Internal\\\\Declaration\\\\Instance::Temporal\\\\Internal\\\\Declaration\\\\{closure}(Object(Temporal\\\\DataConverter\\\\EncodedValues))\\n#6 /var/www/api/vendor/temporal/sdk/src/Internal/Interceptor/Pipeline.php(95): Temporal\\\\Internal\\\\Transport\\\\Router\\\\InvokeActivity::Temporal\\\\Internal\\\\Transport\\\\Router\\\\{closure}(Object(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput))\\n#7 /var/www/api/vendor/vanta/temporal-bundle/src/Interceptor/DoctrineActivityInboundInterceptor.php(34): Temporal\\\\Internal\\\\Interceptor\\\\Pipeline->__invoke(Object(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput))\\n#8 /var/www/api/vendor/temporal/sdk/src/Internal/Interceptor/Pipeline.php(101): Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Interceptor\\\\DoctrineActivityInboundInterceptor->handleActivityInbound(Object(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput), Object(Temporal\\\\Internal\\\\Interceptor\\\\Pipeline))\\n#9 /var/www/api/vendor/vanta/temporal-bundle/src/Interceptor/SentryActivityInboundInterceptor.php(41): Temporal\\\\Internal\\\\Interceptor\\\\Pipeline->__invoke(Object(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput))\\n#10 /var/www/api/vendor/temporal/sdk/src/Internal/Interceptor/Pipeline.php(101): Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Interceptor\\\\SentryActivityInboundInterceptor->handleActivityInbound(Object(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput), Object(Temporal\\\\Internal\\\\Interceptor\\\\Pipeline))\\n#11 /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router/InvokeActivity.php(105): Temporal\\\\Internal\\\\Interceptor\\\\Pipeline->__invoke(Object(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput))\\n#12 /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Router.php(82): Temporal\\\\Internal\\\\Transport\\\\Router\\\\InvokeActivity->handle(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest), Array, Object(React\\\\Promise\\\\Deferred))\\n#13 /var/www/api/vendor/temporal/sdk/src/Worker/Worker.php(93): Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest), Array)\\n#14 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php(422): Temporal\\\\Worker\\\\Worker->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest), Array)\\n#15 /var/www/api/vendor/temporal/sdk/src/Internal/Transport/Server.php(61): Temporal\\\\WorkerFactory->onRequest(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest), Array)\\n#16 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php(399): Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Object(Temporal\\\\Worker\\\\Transport\\\\Command\\\\ServerRequest), Array)\\n#17 /var/www/api/vendor/temporal/sdk/src/WorkerFactory.php(270): Temporal\\\\WorkerFactory->dispatch('\\\\n\\\\xDD\\\\x05\\\\x08\\\\x07\\\\x12\\\\x0EInvokeAc...', Array)\\n#18 /var/www/api/vendor/vant\",\r\n    \"encodedAttributes\": null,\r\n    \"cause\": null,\r\n    \"applicationFailureInfo\": {\r\n      \"type\": \"Temporal\\\\Exception\\\\InvalidArgumentException\",\r\n      \"nonRetryable\": false,\r\n      \"details\": null\r\n    }\r\n  },\r\n  \"serverFailureInfo\": {\r\n    \"nonRetryable\": false\r\n  }\r\n}\r\n```\r\n</details>\r\n","closedAt":"2024-01-15T17:13:25Z","comments":[],"createdAt":"2024-01-13T09:07:24Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":7,"title":"2.7.3","description":"","dueOn":null},"number":385,"reactionGroups":[{"content":"CONFUSED","users":{"totalCount":2}}],"state":"CLOSED","title":"[Bug] Failed hydrate null value","updatedAt":"2024-01-15T18:14:58Z","url":"https://github.com/temporalio/sdk-php/issues/385"}
