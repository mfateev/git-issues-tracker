{"assignees":[],"author":{"id":"MDQ6VXNlcjM5NTIyMzM4","is_bot":false,"login":"zemkogabor","name":""},"body":"### What are you really trying to do?\r\n\r\nCreate scheduled workflow without start and end time.\r\n\r\n### Describe the bug\r\n\r\nIf startTime and endTime not declared in Schedule spec, I got this error:\r\n\r\n```\r\nUncaught Exception TypeError: \"Given value is not an instance of Google\\Protobuf\\Timestamp.\"\r\n```\r\n\r\n### Minimal Reproduction\r\n\r\nWorking code:\r\n```\r\n        $handleSubscriptionRenewal = $this->scheduleClient->createSchedule(\r\n            Schedule::new()->withAction(\r\n                StartWorkflowAction::new(SubscriptionRenewalWorkflow::WORKFLOW_TYPE)\r\n                    ->withRetryPolicy(\r\n                        RetryOptions::new()\r\n                            ->withInitialInterval(CarbonInterval::seconds(10))\r\n                            ->withMaximumAttempts(3)\r\n                    )\r\n                    ->withWorkflowId(SubscriptionRenewalWorkflow::WORKFLOW_ID)\r\n                    ->withWorkflowRunTimeout(CarbonInterval::minute(10))\r\n            )->withSpec(\r\n                ScheduleSpec::new()->withAddedCronString('15 7 * * *')\r\n                    ->withStartTime(new \\DateTime('now'))\r\n                    ->withEndTime(new \\DateTime('+ 1 month'))\r\n            ),\r\n            scheduleId: SubscriptionRenewalWorkflow::SCHEDULE_ID,\r\n        );\r\n```\r\n\r\nTypeError Exception:\r\n\r\n```\r\n        $handleSubscriptionRenewal = $this->scheduleClient->createSchedule(\r\n            Schedule::new()->withAction(\r\n                StartWorkflowAction::new(SubscriptionRenewalWorkflow::WORKFLOW_TYPE)\r\n                    ->withRetryPolicy(\r\n                        RetryOptions::new()\r\n                            ->withInitialInterval(CarbonInterval::seconds(10))\r\n                            ->withMaximumAttempts(3)\r\n                    )\r\n                    ->withWorkflowId(SubscriptionRenewalWorkflow::WORKFLOW_ID)\r\n                    ->withWorkflowRunTimeout(CarbonInterval::minute(10))\r\n            )->withSpec(\r\n                ScheduleSpec::new()->withAddedCronString('15 7 * * *')\r\n            ),\r\n            scheduleId: SubscriptionRenewalWorkflow::SCHEDULE_ID,\r\n        );\r\n```\r\n\r\nIf I unset these keys in the V1/ScheduleSpec file, the schedule is successful created:\r\n\r\n```\r\n   public function __construct($data = NULL) {\r\n        unset($data['start_time']);\r\n        unset($data['end_time']);\r\n        \\GPBMetadata\\Temporal\\Api\\Schedule\\V1\\Message::initOnce();\r\n        parent::__construct($data);\r\n    }\r\n```\r\n\r\n### Environment/Versions\r\n- Docker\r\n- PHP: 8.3.1\r\n- Protobuf: 3.25.1\r\n- Temporal SDK Version: 2.7.1\r\n- Roadrunner: 2023.3.8\r\n- OS and processor: M1 Mac","closedAt":"2024-01-09T11:52:21Z","comments":[{"id":"IC_kwDOEY5HBM5wAMKX","author":{"login":"zemkogabor"},"authorAssociation":"NONE","body":"I also noticed that I also get an error when listing:\r\n\r\n<img width=\"855\" alt=\"Screenshot 2024-01-05 at 19 28 21\" src=\"https://github.com/temporalio/sdk-php/assets/39522338/bdd800f0-6710-4ca2-a7fa-45535cdf09d0\">\r\n\r\n\r\n\r\nCode:\r\n\r\n```\r\n...\r\n\r\n    public function execute(InputInterface $input, OutputInterface $output): int\r\n    {\r\n        $schedules = $this->scheduleClient->listSchedules();\r\n\r\n        if (count($schedules->getPageItems()) === 0) {\r\n            $output->writeln('<fg=red>No Schedules found</fg=red>');\r\n            return self::FAILURE;\r\n        }\r\n\r\n        $rows = [];\r\n        foreach ($schedules as $schedule) {\r\n            $previous = count($schedule->info->recentActions) === 0\r\n                ? null\r\n                : $schedule->info->recentActions[array_key_last($schedule->info->recentActions)];\r\n            $rows[] = [\r\n                $schedule->scheduleId,\r\n                $schedule->info->workflowType->name,\r\n                number_format((float)$schedule->info->futureActionTimes[0]\r\n                    ->diff(new DateTimeImmutable())->format('%s.%F'), 3) . 's',\r\n                $previous === null\r\n                    ? 'N/A'\r\n                    : number_format((float)$previous->actualTime\r\n                        ->diff(new DateTimeImmutable())->format('%s.%F'), 3) . 's',\r\n            ];\r\n        }\r\n\r\n        (new Table($output))\r\n            ->setHeaderTitle('Recent Actions')\r\n            ->setHeaders(['ID', 'WF Type', 'Next run in', 'Last run'])\r\n            ->setRows($rows)\r\n            ->render();\r\n\r\n        return self::SUCCESS;\r\n    }\r\n\r\n...\r\n\r\n```\r\n","createdAt":"2024-01-05T18:31:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/383#issuecomment-1879098007","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5wAP45","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"Do you use PHP protobuf extension? Or composer package only?","createdAt":"2024-01-05T18:44:30Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/383#issuecomment-1879113273","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5wAQvf","author":{"login":"zemkogabor"},"authorAssociation":"NONE","body":"Yes, I use extension (no protobuf composer package). Here is part of my Dockerfile:\r\n\r\n```\r\n# Protobuf\r\nENV PROTOBUF_VERSION \"3.25.1\"\r\nRUN pecl channel-update pecl.php.net\r\nRUN pecl install protobuf-${PROTOBUF_VERSION} grpc \\\r\n    && docker-php-ext-enable protobuf grpc\r\n\r\n# Roadrunner binary\r\n# https://roadrunner.dev/docs/app-server-images/current/en\r\nCOPY --from=ghcr.io/roadrunner-server/roadrunner:2023.3.8 /usr/bin/rr /usr/local/bin/rr\r\nRUN chmod +x /usr/local/bin/rr\r\n```","createdAt":"2024-01-05T18:47:45Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/383#issuecomment-1879116767","viewerDidAuthor":false}],"createdAt":"2024-01-05T18:21:47Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":6,"title":"2.7.2","description":"","dueOn":null},"number":383,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Schedule API: Schedule creating without start and end time not working","updatedAt":"2024-01-09T11:52:22Z","url":"https://github.com/temporalio/sdk-php/issues/383"}
