{"assignees":[{"id":"MDQ6VXNlcjc5NjEzNg==","login":"wolfy-j","name":"Anton Tsitou","databaseId":0},{"id":"MDQ6VXNlcjQxNTI0ODE=","login":"roxblnfk","name":"Aleksei Gagarin","databaseId":0}],"author":{"id":"MDQ6VXNlcjE0NzIzNDk=","is_bot":false,"login":"num213","name":""},"body":"### Is your feature request related to a problem? Please describe.\nFor PHP-SDK we can use `ActivityMocker` and `expectCompletion()` to mock an activity call result. And it works great if we don't call the activity inside the loop.\n\nIf we call it inside the loop than we can't set `expectCompletion()` for each of the Activity call inside the loop.\n\nFor example consider we have the following phpunit test:\n\n```php\npublic function testWorkflowSend()\n{\n    $workflow = $this->workflowClient->newWorkflowStub(SomeWorkflow::class);\n    $run = $this->workflowClient->start($workflow, ['value1', 'value2', 'value3']);\n    $this->assertSame(['someResult1', 'someResult2', 'someResult3'], $run->getResult('array'));\n}\n```\n\nThe workflow method:\n\n```php\npublic function send(array $values)\n{\n    $results = [];\n    foreach ($values as $value) {\n        $results[] = yield $this->activity->doSomething($value);\n    }\n    return $results;\n}\n```\n\nAnd we want to mock the activity calls like this:\n\n```php\n$this->activityMocks->expectCompletion(\n    'SomeActivity.doSomething', ['someResult1', 'someResult2', 'someResult3']\n);\n```\n\nThe result of running the workflow inside this test will be:\n\n```php\narray(3) {\n[0] => array(3) {\n    [0] => string(11) \"someResult1\",\n    [1] => string(11) \"someResult2\",\n    [2] => string(11) \"someResult3\",\n}, \n[1] => array(3) {\n    [0] => string(11) \"someResult1\",\n    [1] => string(11) \"someResult2\",\n    [2] => string(11) \"someResult3\",\n}, \n[2] => array(3) {\n    [0] => string(11) \"someResult1\",\n    [1] => string(11) \"someResult2\",\n    [2] => string(11) \"someResult3\",\n}\n```\n\nInstead of:\n\n```php\narray(9) {\n    [0] => string(11) \"someResult1\",\n    [1] => string(11) \"someResult2\",\n    [2] => string(11) \"someResult3\",\n}\n```\n\nEven if we mock the activity calls like this:\n\n```php\n$this->activityMocks->expectCompletion('SomeActivity.doSomething', 'someResult1');\n$this->activityMocks->expectCompletion('SomeActivity.doSomething', 'someResult2');\n$this->activityMocks->expectCompletion('SomeActivity.doSomething', 'someResult3');\n```\n\nThe result will be:\n\n```php\narray(9) {\n    [0] => string(11) \"someResult3\",\n    [1] => string(11) \"someResult3\",\n    [2] => string(11) \"someResult3\",\n}\n```\n\n### Describe the solution you'd like\nIt will be great if we have a choice to set `expectCompletion` result for each call of the Activity inside the loop. For example:\n\n```php\n$this->activityMocks->expectCompletion(\n    'SomeActivity.doSomething', 'someResult1', 1\n); // for the first call\n\n$this->activityMocks->expectCompletion(\n    'SomeActivity.doSomething', 'someResult2', 2\n); // for the second\n\n$this->activityMocks->expectCompletion(\n    'SomeActivity.doSomething', 'someResult3', 3\n); // for the third\n```\n\nAnd the same with `expectFailure()`:\n\n```php\n$this->activityMocks->expectCompletion(\n    'SomeActivity.doSomething', 'someResult1', 1\n); // for the first call\n$this->activityMocks->expectFailure(\n    'SomeActivity.doSomething', new Error(), 2\n); // except error for the second call\n```\n\n","closedAt":null,"comments":[{"id":"IC_kwDOEY5HBM58IBzK","author":{"login":"rafaelemi"},"authorAssociation":"NONE","body":"any news about this? ","createdAt":"2024-04-29T11:31:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/302#issuecomment-2082479306","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM58JeiD","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"Hello. There are no updates yet, but the task of improving testing tools is included in the roadmap.","createdAt":"2024-04-29T14:09:14Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-php/issues/302#issuecomment-2082859139","viewerDidAuthor":false}],"createdAt":"2023-04-27T11:33:19Z","labels":[{"id":"MDU6TGFiZWw0MDMxNTY5NTYw","name":"enhancement","description":"","color":"a2eeef"},{"id":"LA_kwDOEY5HBM8AAAABMGprrQ","name":"Tests","description":"Update tests or testing tools","color":"0E8A16"}],"milestone":null,"number":302,"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"[Feature Request] Set the expectCompletion result for each Activity call inside the loop","updatedAt":"2024-04-29T14:09:15Z","url":"https://github.com/temporalio/sdk-php/issues/302"}
