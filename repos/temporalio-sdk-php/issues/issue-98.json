{"assignees":[{"id":"MDQ6VXNlcjI0NjEyNTc=","login":"SerafimArts","name":"Kirill Nesmeyanov","databaseId":0}],"author":{"id":"MDQ6VXNlcjE3MzUwOTc=","is_bot":false,"login":"Rastusik","name":"Martin Fris"},"body":"Hi, I'm trying to run temporal-sdk with php 7.4 (which is minimum supported version according to composer.json), but the SDK is unable to parse my workflows because I'm not using PHP 8 style attributes, but older PHP 7.4 docblock style. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. try to work with this workflow interface:\r\n```\r\nuse Temporal\\Workflow\\WorkflowInterface;\r\nuse Temporal\\Workflow\\WorkflowMethod;\r\n\r\n/**\r\n * @WorkflowInterface()\r\n */\r\ninterface SomeWorkflow\r\n{\r\n    /**\r\n     * @return void\r\n     * @WorkflowMethod(name=\"fork\")\r\n     */\r\n    public function something();\r\n}\r\n```\r\n4. When the workflow client tries to work with the mentioned worklfow, it throws this error: `Workflow class SomeWorkflow or one of his parents (i.e. class, interface or trait) must contain #[Temporal\\Workflow\\WorkflowInterface] attribute`\r\n\r\n**Expected behavior**\r\nWell, the attribute/annotation should be found if minimum supported PHP version is 7.4\r\n\r\n","closedAt":"2021-04-13T12:22:44Z","comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgxODY2NzExNA==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"Hello!\r\n1) Do you install a `doctrine/annotations` driver for annotation work?\r\n2) Attributes work on any version of PHP.","createdAt":"2021-04-13T11:37:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818667114","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY3Mjk5OA==","author":{"login":"Rastusik"},"authorAssociation":"NONE","body":"Hi, yes, I have `doctrine/annotations:^1.12` installed","createdAt":"2021-04-13T11:48:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818672998","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY3NTc5Mw==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"Hmm, this is weird as this functionality has been tested by unit tests: https://github.com/temporalio/sdk-php/blob/master/tests/Unit/Declaration/DeclarationTestCase.php#L33","createdAt":"2021-04-13T11:53:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818675793","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY3ODE5MA==","author":{"login":"Rastusik"},"authorAssociation":"NONE","body":"from what I've been able to find out it looks like the Spiral Attribute reader doesn't even use doctrine annotation reader","createdAt":"2021-04-13T11:58:07Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818678190","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY3ODk4Ng==","author":{"login":"Rastusik"},"authorAssociation":"NONE","body":"but the spiral FallbackAttributeReader is being used, and it looks lik it doesn't work properly... maybe there has to be a specific version of `spiral/attributes` installed?","createdAt":"2021-04-13T11:59:33Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818678986","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY4MTYwNg==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"> from what I've been able to find out it looks like the Spiral Attribute reader doesn't even use doctrine annotation reader\r\n\r\nUsed to read annotations if a dependency is installed: https://github.com/temporalio/sdk-php/blob/master/src/WorkerFactory.php#L299-L306\r\n\r\n> but the spiral FallbackAttributeReader is being used, and it looks lik it doesn't work properly...\r\n\r\nThis is a PHP 8 \"emulator\" that allows you to read attributes on any version of the PHP.","createdAt":"2021-04-13T12:04:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818681606","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY4MzQ1MA==","author":{"login":"Rastusik"},"authorAssociation":"NONE","body":"btw I'm creating the Workflow client according to documentation: \r\n```\r\nfn (): WorkflowClientInterface => WorkflowClient::create(\r\n                ServiceClient::create($this->config->getTemporalHost())\r\n            )\r\n```\r\n\r\nMaybe I should hack the dependencies somehow?\r\n\r\n> Used to read annotations if a dependency is installed: https://github.com/temporalio/sdk-php/blob/master/src/WorkerFactory.php#L299-L306\r\n> \r\n\r\nI haven't used the WorkerFactory yet, as the first step I'm trying to send a workflow to temporal, without any running workers\r\n\r\n","createdAt":"2021-04-13T12:07:25Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818683450","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY4NTM5Nw==","author":{"login":"Rastusik"},"authorAssociation":"NONE","body":"shouldn't the same decision be made here? https://github.com/temporalio/sdk-php/blob/master/src/Client/WorkflowClient.php#L57","createdAt":"2021-04-13T12:10:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818685397","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY4NjIyNQ==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"> I haven't used the WorkerFactory yet, as the first step I'm trying to send a workflow to temporal, without any running workers\r\n\r\nYeah, I think I get it now. You are using only the client, and there is only support for attributes. We seem to have found the problem.","createdAt":"2021-04-13T12:12:09Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818686225","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY4NjcwMg==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"> shouldn't the same decision be made here?\r\n\r\nYeah! This is exactly the problematic section of the code.","createdAt":"2021-04-13T12:12:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HOORAY","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818686702","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY5Nzg3Mw==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"Thanks for the feedback!\r\n\r\nFixed in [SDK 1.0.2+](https://github.com/temporalio/sdk-php/releases/tag/v1.0.2)","createdAt":"2021-04-13T12:31:10Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818697873","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxODY5ODQ5OQ==","author":{"login":"Rastusik"},"authorAssociation":"NONE","body":"thanks for the prompt fix! :)","createdAt":"2021-04-13T12:32:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/98#issuecomment-818698499","viewerDidAuthor":false}],"createdAt":"2021-04-13T10:12:27Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":98,"reactionGroups":[],"state":"CLOSED","title":"[Bug] PHP 7.4 docblock anotations don't work (or documentation missing?)","updatedAt":"2021-04-13T12:32:10Z","url":"https://github.com/temporalio/sdk-php/issues/98"}
