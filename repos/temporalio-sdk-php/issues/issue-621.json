{"assignees":[],"author":{"id":"MDQ6VXNlcjEzODE2NzA0","is_bot":false,"login":"root-aza","name":"Vlad Shashkov"},"body":"### What are you really trying to do?\n\nCall Workflow::getInfo() in ActivityInboundInterceptor\n\n\n### Describe the bug\n\nI know that this shouldn't be done, but it seems to me that there should be a \"friendly error\" here as an exception, and not a typing error. \n\n### Minimal Reproduction\n\n\n```php\n<?php\n/**\n * Vanta Cash Bus\n *\n * @author Vlad Shashkov <v.shashkov@pos-credit.ru>\n * @copyright Copyright (c) 2025, The Vanta\n */\n\ndeclare(strict_types=1);\n\nnamespace App\\Bus\\Infrastructure\\Temporal;\n\nuse App\\Bus\\Infrastructure\\Logger\\BankIntegrationProcessor;\nuse Symfony\\Component\\Uid\\Uuid;\nuse Temporal\\Interceptor\\ActivityInbound\\ActivityInput;\nuse Temporal\\Interceptor\\ActivityInboundInterceptor;\nuse Temporal\\Workflow;\n\nfinal readonly class BankIntegrationActivityInboundInterceptor implements ActivityInboundInterceptor\n{\n    public function __construct(\n        private BankIntegrationProcessor $applicationIdProcessor,\n    ) {\n    }\n\n\n    public function handleActivityInbound(ActivityInput $input, callable $next): mixed\n    {\n        $rawApplicationId = Workflow::getInfo()->searchAttributes['applicationId'] ?? null;\n        $bankId           = Workflow::getInfo()->searchAttributes['bankId'] ?? null;\n\n\n        if (is_string($rawApplicationId) && is_string($bankId) && $bankId != '' ) {\n            $this->applicationIdProcessor->witBankIntegration(\n                Uuid::fromString($rawApplicationId),\n                $bankId\n            );\n        }\n\n        try {\n            return $next($input);\n        } finally {\n            $this->applicationIdProcessor->reset();\n        }\n    }\n}\n```\n\n\nstacktrace:  \n\n```json\n{\n  \"message\": \"Temporal\\\\Workflow::getInfo(): Return value must be of type Temporal\\\\Workflow\\\\WorkflowInfo, Temporal\\\\Activity\\\\ActivityInfo returned\",\n  \"source\": \"PHP_SDK\",\n  \"stackTrace\": \"#0  /app/src/Bus/Infrastructure/Temporal/BankIntegrationActivityInboundInterceptor.php:29\\n    Temporal\\\\Workflow::getInfo()\\n#1  /app/vendor/temporal/sdk/src/Internal/Interceptor/Pipeline.php:98\\n    App\\\\Bus\\\\Infrastructure\\\\Temporal\\\\BankIntegrationActivityInboundInterceptor->handleActivityInbound(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput,Temporal\\\\Internal\\\\Interceptor\\\\Pipeline)\\n#2  /app/vendor/temporal/sdk/src/Internal/Transport/Router/InvokeActivity.php:97\\n    Temporal\\\\Internal\\\\Interceptor\\\\Pipeline->__invoke(Temporal\\\\Interceptor\\\\ActivityInbound\\\\ActivityInput)\\n#3  /app/vendor/temporal/sdk/src/Internal/Transport/Router.php:69\\n    Temporal\\\\Internal\\\\Transport\\\\Router\\\\InvokeActivity->handle(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Server\\\\ServerRequest,array(3),React\\\\Promise\\\\Deferred)\\n#4  /app/vendor/temporal/sdk/src/Worker/Worker.php:59\\n    Temporal\\\\Internal\\\\Transport\\\\Router->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Server\\\\ServerRequest,array(3))\\n#5  /app/vendor/temporal/sdk/src/WorkerFactory.php:308\\n    Temporal\\\\Worker\\\\Worker->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Server\\\\ServerRequest,array(3))\\n#6  /app/vendor/temporal/sdk/src/Internal/Transport/Server.php:57\\n    Temporal\\\\WorkerFactory->onRequest(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Server\\\\ServerRequest,array(3))\\n#7  /app/vendor/temporal/sdk/src/WorkerFactory.php:290\\n    Temporal\\\\Internal\\\\Transport\\\\Server->dispatch(Temporal\\\\Worker\\\\Transport\\\\Command\\\\Server\\\\ServerRequest,array(3))\\n#8  /app/vendor/temporal/sdk/src/WorkerFactory.php:187\\n    Temporal\\\\WorkerFactory->dispatch(\\\"\\\\n\\ufffd7\\\\b\\\\^S\\\\^R\\\\^NInvokeActivity\\\\^Z\\ufffd\\\\^F{\\\\\\\"name\\\\\\\":\\\\\\\"MigApplicationAct...\\\",array(3))\\n#9  /app/vendor/vanta/temporal-bundle/src/Runtime/Runtime.php:33\\n    Temporal\\\\WorkerFactory->run()\\n#10 /app/vendor/vanta/temporal-bundle/src/Runtime/TemporalRunner.php:26\\n    Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Runtime\\\\Runtime->run()\\n#11 /app/vendor/autoload_runtime.php:29\\n    Vanta\\\\Integration\\\\Symfony\\\\Temporal\\\\Runtime\\\\TemporalRunner->run()\\n#12 /app/public/index.php:8\\n    require_once(\\\"\\\\/app\\\\/vendor\\\\/autoload_runtime.php\\\")\",\n  \"applicationFailureInfo\": {\n    \"type\": \"TypeError\"\n  }\n}\n```\n\n\n\n### Environment/Versions\n\ntemporal/sdk: 2.13.4\n","closedAt":"2025-10-30T09:07:12Z","comments":[],"createdAt":"2025-05-23T06:41:02Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":39,"title":"2.17.0","description":"","dueOn":null},"number":621,"reactionGroups":[],"state":"CLOSED","title":"[Bug] return type mismatch in Workflow::getInfo()","updatedAt":"2025-10-30T09:07:12Z","url":"https://github.com/temporalio/sdk-php/issues/621"}
