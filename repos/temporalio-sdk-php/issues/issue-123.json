{"assignees":[],"author":{"id":"MDQ6VXNlcjE5NzQ3Mw==","is_bot":false,"login":"mixadior","name":"Diordienko Mykhail"},"body":"### Describe the bug\r\n\r\nIf worker started with `->withEnableSessionWorker(true)` requesting any activity from it causes `ActivityNotRegisteredError`\r\n\r\n### To Reproduce\r\n\r\nphp worker\r\n\r\n```php\r\n\r\n<?php\r\n\r\nrequire_once __DIR__.\"/vendor/autoload.php\";\r\n\r\nuse NetworkRequestTemporalPhpServices\\Services\\RequestLight\\GuzzleRequestExecutor;\r\nuse NetworkRequestTemporalPhpServices\\Services\\RequestLight\\RequestResultDto;\r\nuse Temporal\\Activity\\ActivityInterface;\r\nuse Temporal\\WorkerFactory;\r\nuse Temporal\\Client\\GRPC\\ServiceClient;\r\nuse Temporal\\Client\\WorkflowClient;\r\n\r\n$factory = WorkerFactory::create();\r\n\r\n$workflowClient = WorkflowClient::create(ServiceClient::create('host.docker.internal:7233'));\r\n$worker = $factory->newWorker(\r\n    'workers_test_sessions',\r\n    \\Temporal\\Worker\\WorkerOptions::new()\r\n        ->withMaxConcurrentActivityTaskPollers(8)\r\n        ->withMaxConcurrentWorkflowTaskPollers(8)\r\n        ->withEnableSessionWorker(true)\r\n);\r\n\r\n#[ActivityInterface(prefix: \"test_sessions_act.\")]\r\nclass SessionTestActivity {\r\n    public function makeRequest(string $name): string\r\n    {\r\n        return \"sessioned \".$name;\r\n    }\r\n\r\n}\r\n\r\n$worker->registerActivityImplementations(new SessionTestActivity());\r\n$factory->run();\r\n\r\n```\r\n\r\ngolang workflow\r\n\r\n```go\r\npackage app\r\n\r\nimport (\r\n\t\"errors\"\r\n\t\"fmt\"\r\n\t\"go.temporal.io/sdk/workflow\"\r\n\t\"strings\"\r\n\t\"time\"\r\n)\r\n\r\nfunc Test123Workflow(ctx workflow.Context) error {\r\n\tao2 := workflow.ActivityOptions{\r\n\t\tTaskQueue: \"workers_test_sessions\",\r\n\t\tScheduleToCloseTimeout: time.Second * 60,\r\n\t\tScheduleToStartTimeout: time.Second * 60,\r\n\t\tStartToCloseTimeout: time.Second * 60,\r\n\t\tHeartbeatTimeout: time.Second * 10,\r\n\t\tWaitForCancellation: false,\r\n\t}\r\n\r\n\tactivityRunCtx2 := workflow.WithActivityOptions(ctx, ao2)\r\n\r\n\tso := &workflow.SessionOptions{\r\n\t\tCreationTimeout:  time.Minute,\r\n\t\tExecutionTimeout: 10 * time.Minute,\r\n\t}\r\n\r\n\tsessionCtx, errSess := workflow.CreateSession(activityRunCtx2, so)\r\n\tif errSess != nil {\r\n\t\treturn errSess\r\n\t}\r\n\tdefer workflow.CompleteSession(sessionCtx)\r\n\r\n\tvar t interface{}\r\n\tworkflow.ExecuteActivity(sessionCtx, \"test_sessions_act.makeRequest\", \"testname\").Get(sessionCtx, &t)\r\n\r\n\treturn nil\r\n}\r\n\r\n```\r\n\r\ngolang workflow worker:\r\n\r\n```go\r\n\r\n\r\n// @@@SNIPSTART hello-world-project-template-go-worker\r\npackage main\r\n\r\nimport (\r\n    \"log\"\r\n\r\n    \"go.temporal.io/sdk/client\"\r\n    \"go.temporal.io/sdk/worker\"\r\n\r\n    \"hello-world-project-template-go\"\r\n)\r\n\r\nfunc main() {\r\n    // Create the client object just once per process\r\n    c, err := client.NewClient(client.Options{})\r\n    if err != nil {\r\n        log.Fatalln(\"unable to create Temporal client\", err)\r\n    }\r\n    defer c.Close()\r\n    // This worker hosts both Worker and Activity functions\r\n    w := worker.New(c, \"workers_test_sessions_worklow_q\", worker.Options{})\r\n    w.RegisterWorkflow(app.Test123Workflow)\r\n\r\n    // Start listening to the Task Queue\r\n    err = w.Run(worker.InterruptCh())\r\n    if err != nil {\r\n        log.Fatalln(\"unable to start Worker\", err)\r\n    }\r\n}\r\n// @@@SNIPEND\r\n\r\n```\r\n\r\ngolang workflow starter:\r\n\r\n```go\r\n\r\n// @@@SNIPSTART hello-world-project-template-go-start-workflow\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"log\"\r\n\r\n\t\"go.temporal.io/sdk/client\"\r\n\r\n\t\"hello-world-project-template-go\"\r\n)\r\n\r\nfunc main() {\r\n\t// Create the client object just once per process\r\n\tc, err := client.NewClient(client.Options{})\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"unable to create Temporal client\", err)\r\n\t}\r\n\tdefer c.Close()\r\n\toptions := client.StartWorkflowOptions{\r\n\t\tTaskQueue: \"workers_test_sessions_worklow_q\",\r\n\t}\r\n\r\n\twe, err := c.ExecuteWorkflow(context.Background(), options, app.Test123Workflow)\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"unable to complete Workflow\", err)\r\n\t}\r\n\tvar greeting string\r\n\terr = we.Get(context.Background(), &greeting)\r\n\tif err != nil {\r\n\t\tlog.Fatalln(\"unable to get Workflow result\", err)\r\n\t}\r\n\tprintResults(greeting, we.GetID(), we.GetRunID())\r\n}\r\n\r\nfunc printResults(greeting string, workflowID, runID string) {\r\n\tfmt.Printf(\"\\nWorkflowID: %s RunID: %s\\n\", workflowID, runID)\r\n\tfmt.Printf(\"\\n%s\\n\\n\", greeting)\r\n}\r\n// @@@SNIPEND\r\n\r\n\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nActivity written in php (`test_sessions_act.makeRquest`) executed.\r\n\r\n### Screenshots/Terminal output\r\n\r\nActivityNotRegisteredError: unable to find activityType=test_sessions_act.makeRequest. Supported types: [internalSessionCreationActivity, internalSessionCompletionActivity]\r\n\r\nFull workflow execution exported here: http://feodosian.com/wfd.json \r\n\r\n### Versions\r\n\r\n- OS: MacOS 11\r\n- Temporal Version 1.9.0 for golang code\r\n- Roadrunner 2.4 \r\n- Docker-compose official (https://github.com/temporalio/docker-compose) with temporal 1.12 \r\n\r\n","closedAt":null,"comments":[{"id":"IC_kwDOEY5HBM42vTyv","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"Hi,\r\n\r\nit's semi-bug at the moment since we exposed the configuration option for sessions ahead of the actual implementation. Since there a no exists implementation in Java SDK we will have to invent an OOP approach to sessions first. This work schedule is for later this year for 1.1.0 update of Temporal SDK.\r\n\r\nDoes your use case depend on this feature now?\r\n\r\nJD","createdAt":"2021-09-13T16:36:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/123#issuecomment-918371503","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM42xqcl","author":{"login":"mixadior"},"authorAssociation":"NONE","body":"Hi, \r\n\r\n> it's semi-bug at the moment since we exposed the configuration option for sessions ahead of the actual implementation. Since there a no exists implementation in Java SDK we will have to invent an OOP approach to sessions first. This work schedule is for later this year for 1.1.0 update of Temporal SDK.\r\n\r\nthanks for explaining. As i see php-sdk is actually go-sdk bundled into roadrunner and called via some protocol from php code. I cloned roadrunner-temporal plugin code and saw here, that temporal worker created (in golang code) with session worker and session creating activity works correctly (if don't restart RR), i failed  on finding problem why it doesn't register user activities. \r\n\r\n> Does your use case depend on this feature now?\r\n\r\nActually not, at this moment i'm investigating if i can use php-sdk, how it's documentation and examples cover cases which can meet our team if we choose it as tool for porting our php legacy code. I saw example with fileprocessing, which uses approach with separate taskqueues for every worker, i will check this approach. \r\n\r\n\r\n","createdAt":"2021-09-14T09:41:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/123#issuecomment-918988581","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5lfFZi","author":{"login":"rustatian"},"authorAssociation":"COLLABORATOR","body":"Hey @mixadior, have you tried to test this feature on the latest PHP-SDK/RR versions?","createdAt":"2023-09-01T12:10:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/123#issuecomment-1702647394","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM7bg029","author":{"login":"xepozz"},"authorAssociation":"COLLABORATOR","body":"@mixadior could you please check again?","createdAt":"2025-12-22T16:27:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/123#issuecomment-3682815421","viewerDidAuthor":false}],"createdAt":"2021-09-13T14:44:40Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":123,"reactionGroups":[],"state":"OPEN","title":"[Bug] withEnableSessionWorker causes to ActivityNotRegisteredError","updatedAt":"2025-12-22T16:27:59Z","url":"https://github.com/temporalio/sdk-php/issues/123"}
