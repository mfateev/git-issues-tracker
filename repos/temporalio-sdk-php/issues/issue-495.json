{"assignees":[],"author":{"id":"MDQ6VXNlcjEyNzUyMDY=","is_bot":false,"login":"Nyholm","name":"Tobias Nyholm"},"body":"## Is your feature request related to a problem? Please describe.\r\n\r\nI started to use Temporal a few months ago and I really like it and this SDK. I think you (the maintainers and community) have done an excellent job and I am impressed by many things. The use of Generators in `Scope::next()` is genius. \r\n\r\nI am doing a private Symfony bundle around this package and I've found it a little difficult to work with. \r\n\r\n### Issue 1\r\n\r\nWe break backwards compatibility between releases. Here are some examples, but there are many more. \r\n\r\n#### 2.9.0\r\n\r\n- `Temporal\\Client\\ScheduleClient::getHandle()` changed signature. \r\n- `Temporal\\Client\\ServerCapabilities` was removed in a way that breaks BC. \r\n- `Temporal\\Client\\WorkflowExecutionHistory` was moved to `Temporal\\Client\\Workflow\\WorkflowExecutionHistory`\r\n- `Temporal\\Client\\WorkflowClient` have many methods changing their signatures. \r\n\r\n#### 2.10.0\r\n\r\n- `Temporal\\Activity\\ActivityCancellationType` was converted to enum\r\n- `Temporal\\Workflow\\ChildWorkflowCancellationType` was converted to enum\r\n- `Temporal\\Activity\\ActivityOptions::withCancellationType()` has changed signature\r\n- `Temporal\\Worker\\ChildWorkflowCancellationType` was removed in a way that breaks BC. \r\n\r\n### Issue 2\r\n\r\nWe have a bunch of classes in the `internal` namespace. I suggest all of them should be marked with `@internal` for better IDE support. But I also see parts of our public API returning internal classes. Example: \r\n\r\n`Temporal\\Worker\\Worker::getWorkflows(): RepositoryInterface`\r\n\r\n## Describe the solution you'd like\r\n\r\nI would like us, staring with the next minor release, to follow BC very strictly. I suggest to write down a BC promise what it means for us and what third party libraries and application authors can expect from us. Ie, we don't need to be super generous, but we need to be predictable. \r\n\r\n## Additional context\r\n\r\nThere is no secret that I am a big fan of [Symfony's BC promise](https://symfony.com/doc/current/contributing/code/bc.html). In the best of all worlds, I think we should follow the same promise. Just write a statement in our readme that we follow the same practices. \r\n\r\nThere is also the [Roave/BackwardCompatibilityCheck](https://github.com/Roave/BackwardCompatibilityCheck) that will check for any BC breaks as part of the CI workflow. \r\n","closedAt":null,"comments":[{"id":"IC_kwDOEY5HBM6JtRVB","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"Hi.\r\n\r\nRegarding Issue 1:\r\n\r\nI checked your comments on BC between minor releases. Am I correct in understanding that they were obtained automatically using [Roave/BackwardCompatibilityCheck](https://github.com/Roave/BackwardCompatibilityCheck)?\r\n\r\n2.9.0\r\n- `Temporal\\Client\\ScheduleClient::getHandle()` changed signature.\r\n  Final class, signature changed without breaking usage.\r\n- `Temporal\\Client\\ServerCapabilities` was removed in a way that breaks BC.\r\n  Moved to another location with an alias to the old class.\r\n- `Temporal\\Client\\WorkflowExecutionHistory` was moved to `Temporal\\Client\\Workflow\\WorkflowExecutionHistory`\r\n  Alias to the old class is present.\r\n- `Temporal\\Client\\WorkflowClient` has many methods changing their signatures.\r\n  Signatures changed without breaking usage.\r\n  âš ï¸ **Class is not final, should be made `@final`.**\r\n\r\n2.10.0\r\n- `Temporal\\Activity\\ActivityCancellationType` was converted to enum\r\n  Was a final class, constants not affected.\r\n- `Temporal\\Workflow\\ChildWorkflowCancellationType` was converted to enum\r\n  Was a final class, constants not affected.\r\n- `Temporal\\Activity\\ActivityOptions::withCancellationType()` has changed signature\r\n  Type extended, does not affect usage.\r\n  âš ï¸ **Class is not final, should be made `@final`.**\r\n- `Temporal\\Worker\\ChildWorkflowCancellationType` was removed in a way that breaks BC.\r\n  Made an alias, as it was a duplicate.\r\n\r\nIf we pay attention to the presence of aliases for removed classes or the previous work done with the marshaller, it becomes clear that we strive to adhere to semver and maintain backward compatibility where possible, without making various promises.\r\n\r\nIf we strictly follow [Symfony's BC promise](https://symfony.com/doc/current/contributing/code/bc.html), I'm afraid the PHP SDK code might become legacy-laden, and we won't be able to provide functionality on par with other SDKs.\r\nMoreover, there are things that may look like breaking changes but are not considered as such in the context of the SDK. This includes configuration classes and API gateway interfaces to Temporal, which may and will change their signatures. We expect that these interfaces will not be inherited or implemented by the user (such as ActivityOptions, WorkflowClientInterface, WorkflowClient, etc).\r\nAt the same time, interceptor interfaces are also supplemented with new functions, but they come with traits that must be used in user implementations.\r\n\r\nPerhaps we should consider marking classes/interfaces as risky for extension/implementation.","createdAt":"2024-08-26T14:23:51Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/495#issuecomment-2310346049","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM6Ju4UA","author":{"login":"Nyholm"},"authorAssociation":"CONTRIBUTOR","body":"> I checked your comments on BC between minor releases. Am I correct in understanding that they were obtained automatically using [Roave/BackwardCompatibilityCheck](https://github.com/Roave/BackwardCompatibilityCheck)?\r\n\r\nNo, most of them were obtained by my Symfony Bundle's CI started to fail. Then I looked at the diff and found some more to give some examples in this issue. \r\n\r\n-------\r\n\r\n> Moved to another location with an alias to the old class.\r\n\r\nI saw that it was an attempt, but it was incorrectly done. \r\n\r\n> Was a final class, constants not affected.\r\n\r\nWhat if I have instantiated that class? Then it would break if the class was removed. \r\n\r\n---------\r\n\r\n> If we strictly follow [Symfony's BC promise](https://symfony.com/doc/current/contributing/code/bc.html), I'm afraid the PHP SDK code might become legacy-laden, and we won't be able to provide functionality on par with other SDKs.\r\n\r\nWith all respect, I think you are wrong. There are always a way forward with keeping BC, but the \"effort\" might not be worth it. In such cases, write a good UPGRADE.md and tag a new major release. We wont run out of integers. =)\r\n\r\n\r\n> Perhaps we should consider marking classes/interfaces as risky for extension/implementation.\r\n\r\nYes, I believe so. We want to be helpful to all users of this SDK, that means we must be predictable. If I use an `@internal` class or extend a class marked with `@final`, then I only have myself to blame. \r\n\r\nIf we dont want to adjust how we do code changes, then this issue can be solved with documentation/comments only. But maybe some adjustments are needed. \r\n\r\n**Suggestion**: We add the BC promise CI job, that will make (too many) comments on each PR. These can then be discussed and fixed/ignored.  ","createdAt":"2024-08-26T18:03:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/495#issuecomment-2310767872","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM6JvoV6","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"> I saw that it was an attempt, but it was incorrectly done.\r\n\r\nWhat do you mean? May be it should be fixed?\r\n\r\n> What if I have instantiated that class? Then it would break if the class was removed.\r\n\r\nIn the case of a DTO or another working class, this would make sense, but in the case of an enum class, it looks like this:\r\n![image](https://github.com/user-attachments/assets/2d439774-8a07-4cb0-a768-c1738284ce23) ðŸ˜ƒ \r\n\r\n> write a good UPGRADE.md and tag a new major release. We wont run out of integers. =)\r\n\r\nIf it were that simple, the SDK would already be at version 4.x. ðŸ¤” \r\n\r\n> Suggestion: We add the BC promise CI job, that will make (too many) comments on each PR. These can then be discussed and fixed/ignored.\r\n\r\nSounds good ðŸ‘ Would you like to take this on? I'll return to working on the SDK next week.","createdAt":"2024-08-26T19:52:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/495#issuecomment-2310964602","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM6JvzGv","author":{"login":"Nyholm"},"authorAssociation":"CONTRIBUTOR","body":"> What do you mean? May be it should be fixed?\r\n\r\nIf we want to move a class. we need to make sure the old class is still working. That means as extend, instantiate, return values etc. \r\nI can make a PR and we can discuss the details there. \r\n\r\n> In the case of a DTO or another working class, \r\n\r\nHaha, yes. You are correct, but it is still a BC break. \r\n\r\n> If it were that simple, the SDK would already be at version 4.x. ðŸ¤”\r\n\r\nThat is fine. There is no harm in that. The most important thing is to be predictable and it should always work for all weird use cases. There is no gold medal if you keep version 2.x for 10 years. \r\n\r\n> Would you like to take this on?\r\n\r\nSure, I would be happy to. ","createdAt":"2024-08-26T20:17:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-php/issues/495#issuecomment-2311008687","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM6KfNUe","author":{"login":"root-aza"},"authorAssociation":"CONTRIBUTOR","body":"> I am doing a private Symfony bundle around this package and I've found it a little difficult to work with.\r\n\r\n@Nyholm hi. Why weren't you happy with this decision?\r\n\r\nhttps://github.com/VantaFinance/temporal-bundle ","createdAt":"2024-09-01T17:37:20Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/495#issuecomment-2323436830","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM6KfQqz","author":{"login":"Nyholm"},"authorAssociation":"CONTRIBUTOR","body":"That looks like a nice bundle. \r\n\r\nWe (the company I work for) started our own Symfony bundle back in 2021 and we are doing a lot of custom stuff that does not make sense to open source. \r\n\r\nIf we were just starting our Temporal journey we should definitely consider that bundle. ","createdAt":"2024-09-01T18:23:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/temporalio/sdk-php/issues/495#issuecomment-2323450547","viewerDidAuthor":false}],"createdAt":"2024-08-25T20:19:59Z","labels":[{"id":"MDU6TGFiZWw0MDMxNTY5NTYw","name":"enhancement","description":"","color":"a2eeef"}],"milestone":null,"number":495,"reactionGroups":[],"state":"OPEN","title":"[Discussion] Define a backwards compatibility promise","updatedAt":"2024-09-01T18:24:00Z","url":"https://github.com/temporalio/sdk-php/issues/495"}
