{"assignees":[],"author":{"id":"MDQ6VXNlcjEzODE2NzA0","is_bot":false,"login":"root-aza","name":"Vlad Shashkov"},"body":"### Minimal Reproduction\r\n\r\n```php\r\n#[WorkflowInterface]\r\nfinal class AWorkflow\r\n{\r\n    #[WorkflowMethod]\r\n    public function start(bool $child = false): \\Generator\r\n    {\r\n        if ($child){\r\n            return;\r\n        }\r\n        \r\n        \r\n        yield Workflow::newChildWorkflowStub(\r\n            self::class,\r\n            ChildWorkflowOptions::new()\r\n                ->withSearchAttributes([]) // bang ðŸ’¥\r\n        )->start(true);\r\n    }\r\n}\r\n```\r\n\r\n### Environment/Versions\r\n\r\nversion rr: 2024.2.1\r\nversion sdk: 2.11\r\n\r\n### Additional context\r\n\r\n```json\r\n{\r\n  \"message\": \"proto_codec_parse_message: expected { character for map value\",\r\n  \"source\": \"GoSDK\",\r\n  \"stackTrace\": \"process event for default [panic]:\\ngithub.com/temporalio/roadrunner-temporal/v5/aggregatedpool.(*Workflow).OnWorkflowTaskStarted(0x4000e9e460, 0x3?)\\n\\tgithub.com/temporalio/roadrunner-temporal/v5@v5.1.1/aggregatedpool/workflow.go:194 +0x360\\ngo.temporal.io/sdk/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0x4000e80be8, 0x4000cb33b0, 0x20?, 0x1)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_event_handlers.go:1208 +0x1f0\\ngo.temporal.io/sdk/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0x4000c49400, 0x40008f6a20)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_handlers.go:1152 +0x13f0\\ngo.temporal.io/sdk/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0x4000e98b60, 0x40008f6a20, 0x4000c49400, 0x40005f1b30)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_handlers.go:917 +0x2b8\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).processWorkflowTask(0x4000e8e900, 0x40008f6a20)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_pollers.go:363 +0x334\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).ProcessTask(0x4000e8e900, {0x17926a0, 0x40008f6a20})\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_pollers.go:325 +0x70\\ngo.temporal.io/sdk/internal.(*baseWorker).processTaskAsync.func1()\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_worker_base.go:444 +0x104\\ncreated by go.temporal.io/sdk/internal.(*baseWorker).processTaskAsync in goroutine 45\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_worker_base.go:423 +0x90\",\r\n  \"encodedAttributes\": null,\r\n  \"cause\": null,\r\n  \"applicationFailureInfo\": {\r\n    \"type\": \"PanicError\",\r\n    \"nonRetryable\": true,\r\n    \"details\": null\r\n  }\r\n\r\n```\r\n\r\n<details>\r\n  <summary>Workflow events</summary>\r\n\r\n```json\r\n{\r\n  \"events\": [\r\n    {\r\n      \"eventId\": \"1\",\r\n      \"eventTime\": \"2024-10-05T19:01:43.920084426Z\",\r\n      \"eventType\": \"WorkflowExecutionStarted\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048647\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowExecutionStartedEventAttributes\": {\r\n        \"workflowType\": {\r\n          \"name\": \"ActivityRetry.greet\"\r\n        },\r\n        \"parentWorkflowNamespace\": \"\",\r\n        \"parentWorkflowNamespaceId\": \"\",\r\n        \"parentWorkflowExecution\": null,\r\n        \"parentInitiatedEventId\": \"0\",\r\n        \"taskQueue\": {\r\n          \"name\": \"default\",\r\n          \"kind\": \"Normal\",\r\n          \"normalName\": \"\"\r\n        },\r\n        \"input\": {\r\n          \"payloads\": [\r\n            {\r\n              \"metadata\": {\r\n                \"encoding\": \"anNvbi9wbGFpbg==\"\r\n              },\r\n              \"data\": \"IkFudG9ueSI=\"\r\n            }\r\n          ]\r\n        },\r\n        \"workflowExecutionTimeout\": \"60s\",\r\n        \"workflowRunTimeout\": \"60s\",\r\n        \"workflowTaskTimeout\": \"10s\",\r\n        \"continuedExecutionRunId\": \"\",\r\n        \"initiator\": \"Unspecified\",\r\n        \"continuedFailure\": null,\r\n        \"lastCompletionResult\": null,\r\n        \"originalExecutionRunId\": \"2f36f4fc-035d-47d1-8526-90bc35c70b48\",\r\n        \"identity\": \"88@28ca3010650c\",\r\n        \"firstExecutionRunId\": \"2f36f4fc-035d-47d1-8526-90bc35c70b48\",\r\n        \"retryPolicy\": null,\r\n        \"attempt\": 1,\r\n        \"workflowExecutionExpirationTime\": \"2024-10-05T19:02:43.920Z\",\r\n        \"cronSchedule\": \"\",\r\n        \"firstWorkflowTaskBackoff\": \"0s\",\r\n        \"memo\": null,\r\n        \"searchAttributes\": {\r\n          \"indexedFields\": {}\r\n        },\r\n        \"prevAutoResetPoints\": null,\r\n        \"header\": {\r\n          \"fields\": {}\r\n        },\r\n        \"parentInitiatedEventVersion\": \"0\",\r\n        \"workflowId\": \"dba488dc-d4e2-4f7c-8d0b-8f85b857b834\",\r\n        \"sourceVersionStamp\": null\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"2\",\r\n      \"eventTime\": \"2024-10-05T19:01:43.920196051Z\",\r\n      \"eventType\": \"WorkflowTaskScheduled\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048648\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowTaskScheduledEventAttributes\": {\r\n        \"taskQueue\": {\r\n          \"name\": \"default\",\r\n          \"kind\": \"Normal\",\r\n          \"normalName\": \"\"\r\n        },\r\n        \"startToCloseTimeout\": \"10s\",\r\n        \"attempt\": 1\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"3\",\r\n      \"eventTime\": \"2024-10-05T19:01:43.927352301Z\",\r\n      \"eventType\": \"WorkflowTaskStarted\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048654\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowTaskStartedEventAttributes\": {\r\n        \"scheduledEventId\": \"2\",\r\n        \"identity\": \"default:a2ba3d21-00b5-44c1-bfef-1700289170ab\",\r\n        \"requestId\": \"6c1d2a10-b8d8-400e-8e0d-59d1cdf4671b\",\r\n        \"suggestContinueAsNew\": false,\r\n        \"historySizeBytes\": \"319\"\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"4\",\r\n      \"eventTime\": \"2024-10-05T19:01:43.952319551Z\",\r\n      \"eventType\": \"WorkflowTaskFailed\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048658\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowTaskFailedEventAttributes\": {\r\n        \"scheduledEventId\": \"2\",\r\n        \"startedEventId\": \"3\",\r\n        \"cause\": \"WorkflowWorkerUnhandledFailure\",\r\n        \"failure\": {\r\n          \"message\": \"proto_codec_parse_message: expected { character for map value\",\r\n          \"source\": \"GoSDK\",\r\n          \"stackTrace\": \"process event for default [panic]:\\ngithub.com/temporalio/roadrunner-temporal/v5/aggregatedpool.(*Workflow).OnWorkflowTaskStarted(0x4000e9e460, 0x3?)\\n\\tgithub.com/temporalio/roadrunner-temporal/v5@v5.1.1/aggregatedpool/workflow.go:194 +0x360\\ngo.temporal.io/sdk/internal.(*workflowExecutionEventHandlerImpl).ProcessEvent(0x4000e80be8, 0x4000cb33b0, 0x20?, 0x1)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_event_handlers.go:1208 +0x1f0\\ngo.temporal.io/sdk/internal.(*workflowExecutionContextImpl).ProcessWorkflowTask(0x4000c49400, 0x40008f6a20)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_handlers.go:1152 +0x13f0\\ngo.temporal.io/sdk/internal.(*workflowTaskHandlerImpl).ProcessWorkflowTask(0x4000e98b60, 0x40008f6a20, 0x4000c49400, 0x40005f1b30)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_handlers.go:917 +0x2b8\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).processWorkflowTask(0x4000e8e900, 0x40008f6a20)\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_pollers.go:363 +0x334\\ngo.temporal.io/sdk/internal.(*workflowTaskPoller).ProcessTask(0x4000e8e900, {0x17926a0, 0x40008f6a20})\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_task_pollers.go:325 +0x70\\ngo.temporal.io/sdk/internal.(*baseWorker).processTaskAsync.func1()\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_worker_base.go:444 +0x104\\ncreated by go.temporal.io/sdk/internal.(*baseWorker).processTaskAsync in goroutine 45\\n\\tgo.temporal.io/sdk@v1.29.1/internal/internal_worker_base.go:423 +0x90\",\r\n          \"encodedAttributes\": null,\r\n          \"cause\": null,\r\n          \"applicationFailureInfo\": {\r\n            \"type\": \"PanicError\",\r\n            \"nonRetryable\": true,\r\n            \"details\": null\r\n          }\r\n        },\r\n        \"identity\": \"default:a2ba3d21-00b5-44c1-bfef-1700289170ab\",\r\n        \"baseRunId\": \"\",\r\n        \"newRunId\": \"\",\r\n        \"forkEventVersion\": \"0\",\r\n        \"binaryChecksum\": \"\",\r\n        \"workerVersion\": null\r\n      }\r\n    },\r\n    {\r\n      \"eventId\": \"5\",\r\n      \"eventTime\": \"2024-10-05T19:02:43.923306759Z\",\r\n      \"eventType\": \"WorkflowExecutionTimedOut\",\r\n      \"version\": \"0\",\r\n      \"taskId\": \"1048675\",\r\n      \"workerMayIgnore\": false,\r\n      \"workflowExecutionTimedOutEventAttributes\": {\r\n        \"retryState\": \"Timeout\",\r\n        \"newExecutionRunId\": \"\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\n```\r\n\r\n</details>\r\n\r\n","closedAt":"2024-10-08T05:47:35Z","comments":[],"createdAt":"2024-10-07T04:43:31Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTc0","name":"Bug","description":"Something isn't working","color":"d73a4a"}],"milestone":{"number":22,"title":"2.12.0","description":"","dueOn":null},"number":514,"reactionGroups":[],"state":"CLOSED","title":"[Bug]  proto_codec_parse_message Empty searchAttributes child workflow","updatedAt":"2024-10-08T05:47:35Z","url":"https://github.com/temporalio/sdk-php/issues/514"}
