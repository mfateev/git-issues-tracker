{"assignees":[],"author":{"id":"MDQ6VXNlcjE4NDE4NjA3","is_bot":false,"login":"igancev","name":"Ivan Gantsev"},"body":"### What are you really trying to do?\n\nI create multiple workflows (in [code example](https://github.com/igancev/temporal-example-errors)) that each start a child workflow with several activities. The child workflows await signals and should unblock upon receiving them.\n\nI deliberately set up an environment with insufficient workers to handle the submitted workflow volume quickly, creating high-concurrency conditions.\n\nI expected all workflows to eventually reach `Completed` status (as guaranteed by **Durable Execution**), but this doesn't occur:\n\n- Some workflows immediately show `Failed` status\n- **After processing**: When Roadrunner workers finish handling payloads, a portion of workflows remain stuck in `Running` state. These suspended workflows should unblock and complete after receiving signals, but fail to do so.\n\nI'm want to achieve stable steps execution in Temporal Workflows since it promises me \"Durable Execution\", **even if the workers are working in a high concurrency environment**.\n\nI assume that in the provided codebase, I'm following the documentation precisely without deviations, and rightfully expect every workflow to complete without errors. However, if I'm misusing the SDK capabilities or implementing something incorrectly, please point out the logical flaws in my examples.\n\n### Describe the bug\n\nUnder high-concurrency conditions (2000+ workflows, with one instance of Roadrunner, with 4 activity workers, on the [code example](https://github.com/igancev/temporal-example-errors)), the PHP SDK exhibits unexpected failures and workflow suspensions despite proper signal handling logic. Approximately 5% of workflows end in `Failed` state or remain indefinitely suspended (`Running`) when they should complete after receiving signals.\n\nExamples of errors (more detailed in [code example](https://github.com/igancev/temporal-example-errors))):\n\n```\n\"The passed value of type \\\"int\\\" can not be converted to required type \\\"array\\\"\"\n\n\"The passed value of type \\\"array\\\" can not be converted to required type \\\"int\\\"\"\n\n\"undefined response: Got the response to undefined request 12695\"\n\"process event for default [panic]\"\n```\n\n### Minimal Reproduction\n\nI prepared [repository with demo application](https://github.com/igancev/temporal-example-errors), where created high-concurency environment and reproduced bugs and unexpected behavior.\n\n### Environment/Versions\n\n- OS and processor: \n        - `OS: Arch Linux x86_64, CPU: AMD Ryzen 5 4600H`\n- Temporal Version:\n        - `Temporal: 1.25.0, Roadrunner: 2025.1.1, PHP temporal/sdk: v2.14.1`\n- Are you using Docker or Kubernetes or building Temporal from source?\n\t- `Docker environment are prepared in demo application repository`\n\n\n### Additional context\n\n- https://github.com/igancev/temporal-example-errors\n- Screen recording video of script launching: [Link](https://www.dropbox.com/scl/fi/wrjg95j88f2ktexdwha7w/demonstrate-temporal-errors-2025-07-02_11.07.52.mp4?rlkey=pkj58ql56pfdphl26h9cdr3bn&e=2&st=rz8k5l2x&dl=0)\n","closedAt":"2025-07-08T16:32:44Z","comments":[{"id":"IC_kwDOEY5HBM60emKH","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"Try to set `cache_size` to `100` in `.rr.yaml` and `WorkerOptions::withMaxConcurrentWorkflowTaskExecutionSize` to `100`\n[PR](https://github.com/igancev/temporal-example-errors/pull/1)","createdAt":"2025-07-02T13:36:26Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"HOORAY","users":{"totalCount":1}},{"content":"ROCKET","users":{"totalCount":1}},{"content":"EYES","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/633#issuecomment-3027919495","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM61vCER","author":{"login":"igancev"},"authorAssociation":"CONTRIBUTOR","body":"@roxblnfk, thanks, it's really works! üëçüôå It's awesome! üöÄ\n\nUnfortunately, with the default settings, we experience the behavior described above.\n\nTwo questions in this regard:\n\n1. Do you have any recommendations on how to precisely calculate the `cache_size` and `MaxConcurrentWorkflowTaskExecutionSize` parameters in a PHP + Roadrunner setup?\n\n2. Also, are there plans to change the default settings for Roadrunner due to current issues with the default values?","createdAt":"2025-07-08T13:36:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/633#issuecomment-3049005329","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM61w75l","author":{"login":"roxblnfk"},"authorAssociation":"COLLABORATOR","body":"1. No I don't\n2. You can create an issue about it in the RoadRunner repo. I think it would be nice to decrease the default value from 10K to 1K","createdAt":"2025-07-08T16:01:12Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/633#issuecomment-3049504357","viewerDidAuthor":false}],"createdAt":"2025-07-02T09:56:08Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTkx","name":"Question","description":"Further information is requested","color":"0173a0"}],"milestone":null,"number":633,"reactionGroups":[],"state":"CLOSED","title":"[Bug] Unexpected failures and hanging workflows under high concurrency in parent-child workflows with signals","updatedAt":"2025-07-09T08:02:05Z","url":"https://github.com/temporalio/sdk-php/issues/633"}
