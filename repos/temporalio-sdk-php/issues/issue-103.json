{"assignees":[],"author":{"id":"MDQ6VXNlcjkyNzU5OTE=","is_bot":false,"login":"khoerintus","name":""},"body":"Is there any best practice to integrate temporal with sentry for error logging?\r\nI know that I can use sentry php sdk, try catch in my code, and send the error.\r\nBut is there any global error handler that catch every error (from Workflow or Activity), so I can just send the error from there?\r\nOr I can integrate roadrunner with sentry?","closedAt":null,"comments":[{"id":"MDEyOklzc3VlQ29tbWVudDgyMzM3MTMzNg==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"Good question. We did not provide a separate interceptor for errors, so you will have to override the transport to handle them, like:\r\n```php\r\nuse Spiral\\RoadRunner\\Worker;\r\nuse Temporal\\Worker\\Transport\\HostConnectionInterface;\r\nuse Temporal\\WorkerFactory;\r\n\r\n$worker = WorkerFactory::create()\r\n    ->newWorker();\r\n\r\n/// ...\r\n\r\n$worker->run(new class implements HostConnectionInterface {\r\n    public function error(\\Throwable $e) { ... } // Intercept errors\r\n});\r\n```\r\n\r\nI agree that this functionality should be added. But while it is not there, you will have to write your own transport decorator.","createdAt":"2021-04-20T15:33:11Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-823371336","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgyMzM4MjE5Mg==","author":{"login":"khoerintus"},"authorAssociation":"NONE","body":"Thanks @SerafimArts for the answer. I will try it later.","createdAt":"2021-04-20T15:46:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-823382192","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgyNDc4OTkyMQ==","author":{"login":"khoerintus"},"authorAssociation":"NONE","body":"Hi @SerafimArts , I've tried to write my own transport decorator and use it. But the error function is never called.\r\n\r\nI found that Exception thrown in Workflow class, is caught in Temporal\\Internal\\Workflow\\Process\\start(),\r\nand Exception thrown in Activity class, is caught in Temporal\\Internal\\Transport\\Router\\handle().\r\nIf I put the code to send the error to sentry in those functions, it sent successfully.","createdAt":"2021-04-22T12:19:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-824789921","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgyNDk1MjI0MA==","author":{"login":"SerafimArts"},"authorAssociation":"CONTRIBUTOR","body":"Yes, that's right. The example I showed only intercepts fatal SDK errors (e.g. errors connecting to the server), and all \"business logic\" errors inside Workflows and Activities are considered \"normal work\" and sent directly to the Temporal.\r\n\r\nHmmm... @mfateev perhaps it makes sense to add APM (Sentry, New Relic, Kibana, etc) support to the Temporal Server? This will allow to nicely structure such errors for all SDKs at once.","createdAt":"2021-04-22T15:40:11Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-824952240","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgyNjkxNjA0Ng==","author":{"login":"changwuf31"},"authorAssociation":"NONE","body":"Meanwhile, what is the current solution if we want to use sentry for temporal and php sdk ?","createdAt":"2021-04-26T15:10:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-826916046","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgyNjkyNzc3Nw==","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"None. We are still thinking how would that look like. Most likely we can provide you hook entry point for activities, but not for the workflows as I don't think Sentry SDK can work in async mode.","createdAt":"2021-04-26T15:23:58Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-826927777","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3NDIwODQ1Ng==","author":{"login":"kozlice"},"authorAssociation":"NONE","body":"I ran into the same issue, except I have multiple handlers in monolog (file log + Sentry). Doing a try-catch with logging & re-throwing inside an activity is not very convenient.\r\n\r\nThe proposal document mentions the idea of injecting a PSR-3-compatible logger into a worker: https://github.com/temporalio/proposals/blob/master/php/php-rr-sdk.md#logging Was it rejected or it's just not implemented yet?\r\n","createdAt":"2021-07-05T15:55:06Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-874208456","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg3NDIxMDM5Nw==","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"Not implemented due to the fact that you create activity classes manually, so you control injections to them.\r\n\r\nThe container refactor planned later this year, with some internal changes and optimizations, including the ability to intercept activity call (for exception catching or state resets).\r\n\r\nP.S. Proposal does not cover all the functions from 1.0 of SDK and has some extra features kept for the later day. It was not 1-to-1 architecture plan.","createdAt":"2021-07-05T15:58:53Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-874210397","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM4-WYTg","author":{"login":"wolfy-j"},"authorAssociation":"COLLABORATOR","body":"You can find an example of integration here: https://github.com/spiral/temporal-bridge/blob/master/src/InvokeActivityRouter.php\r\n\r\nEssentially you can intercept the activity call and manipulate it with input or output parameters, or handle exceptions.","createdAt":"2022-02-19T16:24:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-1046054112","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM4_afOs","author":{"login":"changwuf31"},"authorAssociation":"NONE","body":"@wolfy-j :+1:  Superb, however it will be much better, if some of the sdk properties are made protected, so we can simply override the necessary functions.","createdAt":"2022-03-10T10:37:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-1063908268","viewerDidAuthor":false},{"id":"IC_kwDOEY5HBM5J278N","author":{"login":"programmador"},"authorAssociation":"NONE","body":"The link above is broken as that functionality was removed from temporal-bridge.\r\nAnyway, [here](https://github.com/spiral/temporal-bridge/commit/2de00229c26e35a7cb83d7e6027270464ecbb996#diff-c6622530d00ec62cd9f77427ade1d89488623a20917ffa1066323dab91e460a9)'s how it looked like.\r\nThough fully copying the whole WorkerFactory instead of just extending is redundant as for me. The only reason was to access `$this->queues` which is private. Accessing parent's private field is tricky, I've embraced [this library](https://github.com/ivastly/php-reflection).\r\n\r\nAnd yes, this is really-really hacky, \"don't do that at home\".\r\n\r\nBTW You may ask why was that functionality removed from temporal-bridge. The reason is introducing \"finalizers\" functionality which is enough for example for cleaning resources to avoid memory leaks but not enough for error handling as finalizers are working similar to `final` block after `try-catch`. So You cannot access errors in finalizers.","createdAt":"2022-09-07T09:25:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"EYES","users":{"totalCount":1}}],"url":"https://github.com/temporalio/sdk-php/issues/103#issuecomment-1239138061","viewerDidAuthor":false}],"createdAt":"2021-04-20T15:17:42Z","labels":[{"id":"MDU6TGFiZWwyMzM5NDMzMTgw","name":"Feature","description":"New feature or request","color":"8e3cc4"},{"id":"MDU6TGFiZWwyMzM5NDMzMTkx","name":"Question","description":"Further information is requested","color":"0173a0"}],"milestone":null,"number":103,"reactionGroups":[],"state":"OPEN","title":"[Question] Sentry Integration for error logging","updatedAt":"2023-09-01T12:12:44Z","url":"https://github.com/temporalio/sdk-php/issues/103"}
